<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.github.pockethub.android.util</a> &gt; <span class="el_source">ImageUtils.java</span></div><h1>ImageUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 PocketHub
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.pockethub.android.util;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.BitmapFactory.Options;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Point;
import android.graphics.PorterDuffXfermode;
import android.graphics.RectF;
import android.util.Log;
import android.widget.ImageView;
import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;
import static android.graphics.Bitmap.Config.ARGB_8888;
import static android.graphics.Color.WHITE;
import static android.graphics.PorterDuff.Mode.DST_IN;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * Image utilities
 */
<span class="nc" id="L39">public class ImageUtils {</span>

    private static final String TAG = &quot;ImageUtils&quot;;

    /**
     * Get a bitmap from the image path
     *
     * @param imagePath
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final String imagePath) {
<span class="nc" id="L50">        return getBitmap(imagePath, 1);</span>
    }

    /**
     * Get a bitmap from the image path
     *
     * @param imagePath
     * @param sampleSize
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final String imagePath, int sampleSize) {
<span class="nc" id="L61">        final Options options = new Options();</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1752)) {</span>
<span class="nc" id="L63">            options.inDither = false;</span>
        }
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1753)) {</span>
<span class="nc" id="L66">            options.inSampleSize = sampleSize;</span>
        }
<span class="nc" id="L68">        RandomAccessFile file = null;</span>
        try {
<span class="nc bnc" id="L70" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(1758)) {</span>
<span class="nc" id="L71">                file = new RandomAccessFile(imagePath, &quot;r&quot;);</span>
            }
<span class="nc" id="L73">            return BitmapFactory.decodeFileDescriptor(file.getFD(), null, options);</span>
<span class="nc" id="L74">        } catch (IOException e) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(1754)) {</span>
<span class="nc" id="L76">                Log.d(TAG, e.getMessage(), e);</span>
            }
<span class="nc" id="L78">            return null;</span>
        } finally {
<span class="nc bnc" id="L80" title="All 6 branches missed.">            if (!ListenerUtil.mutListener.listen(1757)) {</span>
<span class="nc bnc" id="L81" title="All 6 branches missed.">                if (file != null) {</span>
                    try {
<span class="nc bnc" id="L83" title="All 6 branches missed.">                        if (!ListenerUtil.mutListener.listen(1756)) {</span>
<span class="nc" id="L84">                            file.close();</span>
                        }
<span class="nc" id="L86">                    } catch (IOException e) {</span>
<span class="nc bnc" id="L87" title="All 6 branches missed.">                        if (!ListenerUtil.mutListener.listen(1755)) {</span>
<span class="nc" id="L88">                            Log.d(TAG, e.getMessage(), e);</span>
                        }
<span class="nc" id="L90">                    }</span>
                }
            }
<span class="nc" id="L93">        }</span>
    }

    /**
     * Get a bitmap from the image
     *
     * @param image
     * @param sampleSize
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final byte[] image, int sampleSize) {
<span class="nc" id="L104">        final Options options = new Options();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1759)) {</span>
<span class="nc" id="L106">            options.inDither = false;</span>
        }
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1760)) {</span>
<span class="nc" id="L109">            options.inSampleSize = sampleSize;</span>
        }
<span class="nc" id="L111">        return BitmapFactory.decodeByteArray(image, 0, image.length, options);</span>
    }

    /**
     * Get scale for image of size and max height/width
     *
     * @param size
     * @param width
     * @param height
     * @return scale
     */
    public static int getScale(Point size, int width, int height) {
<span class="nc bnc" id="L123" title="All 90 branches missed.">        if ((ListenerUtil.mutListener.listen(1771) ? ((ListenerUtil.mutListener.listen(1765) ? (size.x &gt;= width) : (ListenerUtil.mutListener.listen(1764) ? (size.x &lt;= width) : (ListenerUtil.mutListener.listen(1763) ? (size.x &lt; width) : (ListenerUtil.mutListener.listen(1762) ? (size.x != width) : (ListenerUtil.mutListener.listen(1761) ? (size.x == width) : (size.x &gt; width)))))) &amp;&amp; (ListenerUtil.mutListener.listen(1770) ? (size.y &gt;= height) : (ListenerUtil.mutListener.listen(1769) ? (size.y &lt;= height) : (ListenerUtil.mutListener.listen(1768) ? (size.y &lt; height) : (ListenerUtil.mutListener.listen(1767) ? (size.y != height) : (ListenerUtil.mutListener.listen(1766) ? (size.y == height) : (size.y &gt; height))))))) : ((ListenerUtil.mutListener.listen(1765) ? (size.x &gt;= width) : (ListenerUtil.mutListener.listen(1764) ? (size.x &lt;= width) : (ListenerUtil.mutListener.listen(1763) ? (size.x &lt; width) : (ListenerUtil.mutListener.listen(1762) ? (size.x != width) : (ListenerUtil.mutListener.listen(1761) ? (size.x == width) : (size.x &gt; width)))))) || (ListenerUtil.mutListener.listen(1770) ? (size.y &gt;= height) : (ListenerUtil.mutListener.listen(1769) ? (size.y &lt;= height) : (ListenerUtil.mutListener.listen(1768) ? (size.y &lt; height) : (ListenerUtil.mutListener.listen(1767) ? (size.y != height) : (ListenerUtil.mutListener.listen(1766) ? (size.y == height) : (size.y &gt; height))))))))) {</span>
<span class="nc bnc" id="L124" title="All 16 branches missed.">            return Math.max(Math.round((ListenerUtil.mutListener.listen(1775) ? ((float) size.y % (float) height) : (ListenerUtil.mutListener.listen(1774) ? ((float) size.y * (float) height) : (ListenerUtil.mutListener.listen(1773) ? ((float) size.y - (float) height) : (ListenerUtil.mutListener.listen(1772) ? ((float) size.y + (float) height) : ((float) size.y / (float) height)))))), Math.round((ListenerUtil.mutListener.listen(1779) ? ((float) size.x % (float) width) : (ListenerUtil.mutListener.listen(1778) ? ((float) size.x * (float) width) : (ListenerUtil.mutListener.listen(1777) ? ((float) size.x - (float) width) : (ListenerUtil.mutListener.listen(1776) ? ((float) size.x + (float) width) : ((float) size.x / (float) width)))))));</span>
        } else {
<span class="nc" id="L126">            return 1;</span>
        }
    }

    /**
     * Get size of image
     *
     * @param imagePath
     * @return size
     */
    public static Point getSize(final String imagePath) {
<span class="nc" id="L137">        final Options options = new Options();</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1780)) {</span>
<span class="nc" id="L139">            options.inJustDecodeBounds = true;</span>
        }
<span class="nc" id="L141">        RandomAccessFile file = null;</span>
        try {
<span class="nc bnc" id="L143" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(1785)) {</span>
<span class="nc" id="L144">                file = new RandomAccessFile(imagePath, &quot;r&quot;);</span>
            }
<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(1786)) {</span>
<span class="nc" id="L147">                BitmapFactory.decodeFileDescriptor(file.getFD(), null, options);</span>
            }
<span class="nc" id="L149">            return new Point(options.outWidth, options.outHeight);</span>
<span class="nc" id="L150">        } catch (IOException e) {</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(1781)) {</span>
<span class="nc" id="L152">                Log.d(TAG, e.getMessage(), e);</span>
            }
<span class="nc" id="L154">            return null;</span>
        } finally {
<span class="nc bnc" id="L156" title="All 6 branches missed.">            if (!ListenerUtil.mutListener.listen(1784)) {</span>
<span class="nc bnc" id="L157" title="All 6 branches missed.">                if (file != null) {</span>
                    try {
<span class="nc bnc" id="L159" title="All 6 branches missed.">                        if (!ListenerUtil.mutListener.listen(1783)) {</span>
<span class="nc" id="L160">                            file.close();</span>
                        }
<span class="nc" id="L162">                    } catch (IOException e) {</span>
<span class="nc bnc" id="L163" title="All 6 branches missed.">                        if (!ListenerUtil.mutListener.listen(1782)) {</span>
<span class="nc" id="L164">                            Log.d(TAG, e.getMessage(), e);</span>
                        }
<span class="nc" id="L166">                    }</span>
                }
            }
<span class="nc" id="L169">        }</span>
    }

    /**
     * Get size of image
     *
     * @param image
     * @return size
     */
    public static Point getSize(final byte[] image) {
<span class="nc" id="L179">        final Options options = new Options();</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1787)) {</span>
<span class="nc" id="L181">            options.inJustDecodeBounds = true;</span>
        }
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1788)) {</span>
<span class="nc" id="L184">            BitmapFactory.decodeByteArray(image, 0, image.length, options);</span>
        }
<span class="nc" id="L186">        return new Point(options.outWidth, options.outHeight);</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param imagePath
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final String imagePath, int width, int height) {
<span class="nc" id="L198">        Point size = getSize(imagePath);</span>
<span class="nc" id="L199">        return getBitmap(imagePath, getScale(size, width, height));</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param image
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final byte[] image, int width, int height) {
<span class="nc" id="L211">        Point size = getSize(image);</span>
<span class="nc" id="L212">        return getBitmap(image, getScale(size, width, height));</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param image
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final File image, int width, int height) {
<span class="nc" id="L224">        return getBitmap(image.getAbsolutePath(), width, height);</span>
    }

    /**
     * Get a bitmap from the image file
     *
     * @param image
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final File image) {
<span class="nc" id="L234">        return getBitmap(image.getAbsolutePath());</span>
    }

    /**
     * Load a {@link Bitmap} from the given path and set it on the given
     * {@link ImageView}
     *
     * @param imagePath
     * @param view
     */
    public static void setImage(final String imagePath, final ImageView view) {
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1789)) {</span>
<span class="nc" id="L246">            setImage(new File(imagePath), view);</span>
        }
<span class="nc" id="L248">    }</span>

    /**
     * Load a {@link Bitmap} from the given {@link File} and set it on the given
     * {@link ImageView}
     *
     * @param image
     * @param view
     */
    public static void setImage(final File image, final ImageView view) {
<span class="nc" id="L258">        Bitmap bitmap = getBitmap(image);</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1791)) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (bitmap != null) {</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1790)) {</span>
<span class="nc" id="L262">                    view.setImageBitmap(bitmap);</span>
                }
            }
        }
<span class="nc" id="L266">    }</span>

    /**
     * Round the corners of a {@link Bitmap}
     *
     * @param source
     * @param radius
     * @return rounded corner bitmap
     */
    public static Bitmap roundCorners(final Bitmap source, final float radius) {
<span class="nc" id="L276">        int width = source.getWidth();</span>
<span class="nc" id="L277">        int height = source.getHeight();</span>
<span class="nc" id="L278">        Paint paint = new Paint();</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1792)) {</span>
<span class="nc" id="L280">            paint.setAntiAlias(true);</span>
        }
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1793)) {</span>
<span class="nc" id="L283">            paint.setColor(WHITE);</span>
        }
<span class="nc" id="L285">        Bitmap clipped = Bitmap.createBitmap(width, height, ARGB_8888);</span>
<span class="nc" id="L286">        Canvas canvas = new Canvas(clipped);</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1794)) {</span>
<span class="nc" id="L288">            canvas.drawRoundRect(new RectF(0, 0, width, height), radius, radius, paint);</span>
        }
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1795)) {</span>
<span class="nc" id="L291">            paint.setXfermode(new PorterDuffXfermode(DST_IN));</span>
        }
<span class="nc" id="L293">        Bitmap rounded = Bitmap.createBitmap(width, height, ARGB_8888);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1796)) {</span>
<span class="nc" id="L295">            canvas = new Canvas(rounded);</span>
        }
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1797)) {</span>
<span class="nc" id="L298">            canvas.drawBitmap(source, 0, 0, null);</span>
        }
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1798)) {</span>
<span class="nc" id="L301">            canvas.drawBitmap(clipped, 0, 0, paint);</span>
        }
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1799)) {</span>
<span class="nc" id="L304">            source.recycle();</span>
        }
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1800)) {</span>
<span class="nc" id="L307">            clipped.recycle();</span>
        }
<span class="nc" id="L309">        return rounded;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.6.1</div></body></html>