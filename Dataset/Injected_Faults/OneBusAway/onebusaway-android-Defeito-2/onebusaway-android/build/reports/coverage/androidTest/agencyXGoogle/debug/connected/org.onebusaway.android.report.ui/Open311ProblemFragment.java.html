<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Open311ProblemFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.report.ui</a> &gt; <span class="el_source">Open311ProblemFragment.java</span></div><h1>Open311ProblemFragment.java</h1><pre class="source lang-java linenums">/*
* Copyright (C) 2014-2015 University of South Florida (sjbarbeau@gmail.com)
*
* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

package org.onebusaway.android.report.ui;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.database.Cursor;
import android.graphics.Bitmap;
import android.graphics.Color;
import android.graphics.Typeface;
import android.graphics.drawable.BitmapDrawable;
import android.location.Location;
import android.net.Uri;
import android.os.Bundle;
import android.os.Parcelable;
import android.provider.MediaStore;
import android.text.InputType;
import android.text.Spannable;
import android.text.SpannableString;
import android.text.TextUtils;
import android.text.style.ForegroundColorSpan;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.RelativeLayout;
import android.widget.TextView;

import com.google.firebase.analytics.FirebaseAnalytics;

import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.io.elements.ObaArrivalInfo;
import org.onebusaway.android.io.elements.ObaStop;
import org.onebusaway.android.io.elements.ObaTripStatus;
import org.onebusaway.android.report.connection.ServiceDescriptionTask;
import org.onebusaway.android.report.connection.ServiceRequestTask;
import org.onebusaway.android.report.constants.ReportConstants;
import org.onebusaway.android.report.ui.model.AttributeValue;
import org.onebusaway.android.report.ui.util.IssueLocationHelper;
import org.onebusaway.android.report.ui.util.ServiceUtils;
import org.onebusaway.android.util.MyTextUtils;
import org.onebusaway.android.util.PreferenceUtils;
import org.onebusaway.android.util.UIUtils;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.text.DateFormat;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.PopupMenu;
import androidx.core.content.ContextCompat;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;
import edu.usf.cutr.open311client.Open311;
import edu.usf.cutr.open311client.constants.Open311DataType;
import edu.usf.cutr.open311client.models.Open311Attribute;
import edu.usf.cutr.open311client.models.Open311AttributePair;
import edu.usf.cutr.open311client.models.Open311User;
import edu.usf.cutr.open311client.models.Service;
import edu.usf.cutr.open311client.models.ServiceDescription;
import edu.usf.cutr.open311client.models.ServiceDescriptionRequest;
import edu.usf.cutr.open311client.models.ServiceRequest;
import edu.usf.cutr.open311client.models.ServiceRequestResponse;
import edu.usf.cutr.open311client.utils.Open311Validator;

<span class="nc" id="L106">public class Open311ProblemFragment extends BaseReportFragment implements</span>
        ServiceDescriptionTask.Callback, ServiceRequestTask.Callback {

    private ImageView mIssueImageView;

    private String mImagePath;

    private Open311 mOpen311;

    private Service mService;

    private String mAgencyName;

    // Block ID for the mArrivalInfo
    private String mBlockId;

    // Arrival information for trip problem
    private ObaArrivalInfo mArrivalInfo;

    // Captured image url
    private Uri mCapturedImageURI;

    // Open311 service description result for selected service code
    private ServiceDescription mServiceDescription;

    // Store ServiceDescription Task Result if host activity haven't been created
    private ServiceDescription mServiceDescriptionTaskResult;

    // Load dynamic open311 fields into info layout
    private LinearLayout mInfoLayout;

    private CheckBox mAnonymousReportingCheckBox;

    private EditText mContactNameView;

    private EditText mContactLastNameView;

    private EditText mContactEmailView;

    private EditText mContactPhoneView;

    private ProgressDialog mProgressDialog;

<span class="nc" id="L149">    private boolean mIsProgressDialogShowing = false;</span>

<span class="nc" id="L151">    private Map&lt;Integer, AttributeValue&gt; mAttributeValueHashMap = new HashMap&lt;&gt;();</span>

<span class="nc" id="L153">    private Map&lt;Integer, View&gt; mDynamicAttributeUIMap = new HashMap&lt;&gt;();</span>

    // Maps attribute name + id with its key
<span class="nc" id="L156">    private Map&lt;String, String&gt; mOpen311AttributeKeyNameMap = new HashMap&lt;&gt;();</span>

    private ServiceRequestTask mRequestTask;

    private ReportProblemFragmentCallback mCallback;

    public static final String TAG = &quot;Open311ProblemFragment&quot;;

    private static final String ATTRIBUTES = &quot;.attributes&quot;;

    private static final String IMAGE_PATH = &quot;.image&quot;;

    private static final String IMAGE_URI = &quot;.imageUri&quot;;

    private static final String IMAGE_THUMBNAIL = &quot;.imageThumbnail&quot;;

    private static final String TRIP_INFO = &quot;.tripInfo&quot;;

    private static final String SHOW_PROGRESS_DIALOG = &quot;.showProgressDialog&quot;;

    private static final String AGENCY_NAME = &quot;.agencyName&quot;;

    private static final String BLOCK_ID = &quot;.blockId&quot;;

    private FirebaseAnalytics mFirebaseAnalytics;

    public static void show(AppCompatActivity activity, Integer containerViewId,
                            Open311 open311, Service service, ObaArrivalInfo obaArrivalInfo,
            String agencyName, String blockId) {
<span class="nc" id="L185">        FragmentManager fm = activity.getSupportFragmentManager();</span>

<span class="nc" id="L187">        Open311ProblemFragment fragment = new Open311ProblemFragment();</span>
<span class="nc" id="L188">        fragment.setOpen311(open311);</span>
<span class="nc" id="L189">        fragment.setService(service);</span>
<span class="nc" id="L190">        fragment.setArrivalInfo(obaArrivalInfo);</span>
<span class="nc" id="L191">        fragment.setAgencyName(agencyName);</span>
<span class="nc" id="L192">        fragment.setBlockId(blockId);</span>

        try {
<span class="nc" id="L195">            FragmentTransaction ft = fm.beginTransaction();</span>
<span class="nc" id="L196">            ft.replace(containerViewId, fragment, TAG);</span>
<span class="nc" id="L197">            ft.addToBackStack(null);</span>
<span class="nc" id="L198">            ft.commit();</span>
<span class="nc" id="L199">        } catch (IllegalStateException e) {</span>
<span class="nc" id="L200">            Log.e(TAG, &quot;Cannot show Open311ProblemFragment after onSaveInstanceState has been called&quot;);</span>
<span class="nc" id="L201">        }</span>
<span class="nc" id="L202">    }</span>

    public static void show(AppCompatActivity activity, Integer containerViewId,
                            Open311 open311, Service service) {
<span class="nc" id="L206">        Open311ProblemFragment.show(activity, containerViewId, open311, service, null, null, null);</span>
<span class="nc" id="L207">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,
                             @Nullable Bundle savedInstanceState) {

<span class="nc" id="L213">        View rootView = inflater.inflate(R.layout.open311_issue, container, false);</span>

<span class="nc" id="L215">        setRetainInstance(true);</span>

<span class="nc" id="L217">        setHasOptionsMenu(Boolean.TRUE);</span>

<span class="nc" id="L219">        mFirebaseAnalytics = FirebaseAnalytics.getInstance(getActivity());</span>

<span class="nc" id="L221">        return rootView;</span>
    }

    @Override
    public void onViewCreated(View view, @Nullable Bundle savedInstanceState) {
<span class="nc" id="L226">        super.onViewCreated(view, savedInstanceState);</span>

<span class="nc" id="L228">        setupViews(savedInstanceState);</span>

<span class="nc" id="L230">        setupIconColors();</span>

<span class="nc" id="L232">        setUpContactInfoViews();</span>

<span class="nc" id="L234">        callServiceDescription();</span>
<span class="nc" id="L235">    }</span>

    @Override
    public void onSaveInstanceState(Bundle outState) {
<span class="nc" id="L239">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L240">        List&lt;AttributeValue&gt; attributeValues = createAttributeValues(mServiceDescription);</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (attributeValues.size() &gt; 0) {</span>
<span class="nc" id="L242">            outState.putParcelableArrayList(ATTRIBUTES, (ArrayList&lt;? extends Parcelable&gt;) attributeValues);</span>
        }

<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (mImagePath != null) {</span>
<span class="nc" id="L246">            outState.putParcelable(IMAGE_URI, mCapturedImageURI);</span>
<span class="nc" id="L247">            outState.putString(IMAGE_PATH, mImagePath);</span>
<span class="nc" id="L248">            Bitmap bitmap = ((BitmapDrawable) mIssueImageView.getDrawable()).getBitmap();</span>
<span class="nc" id="L249">            outState.putParcelable(IMAGE_THUMBNAIL, bitmap);</span>
        }

<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (mArrivalInfo != null) {</span>
<span class="nc" id="L253">            outState.putSerializable(TRIP_INFO, mArrivalInfo);</span>
        }
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (mIsProgressDialogShowing) {</span>
            // Dismiss the progress dialog when orientation change to prevent leaked window
<span class="nc" id="L257">            mProgressDialog.dismiss();</span>
        }
<span class="nc" id="L259">        outState.putBoolean(SHOW_PROGRESS_DIALOG, mIsProgressDialogShowing);</span>
<span class="nc" id="L260">        outState.putString(AGENCY_NAME, mAgencyName);</span>
<span class="nc" id="L261">        outState.putString(BLOCK_ID, mBlockId);</span>
<span class="nc" id="L262">    }</span>

    @Override
    public void onViewStateRestored(@Nullable Bundle savedInstanceState) {
<span class="nc" id="L266">        super.onViewStateRestored(savedInstanceState);</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (savedInstanceState != null) {</span>
<span class="nc" id="L268">            mCapturedImageURI = savedInstanceState.getParcelable(IMAGE_URI);</span>
<span class="nc" id="L269">            mImagePath = savedInstanceState.getString(IMAGE_PATH);</span>

<span class="nc" id="L271">            mArrivalInfo = (ObaArrivalInfo) savedInstanceState.getSerializable(TRIP_INFO);</span>
<span class="nc" id="L272">            mAgencyName = savedInstanceState.getString(AGENCY_NAME);</span>
<span class="nc" id="L273">            mBlockId = savedInstanceState.getString(BLOCK_ID);</span>

<span class="nc" id="L275">            List&lt;AttributeValue&gt; values = savedInstanceState.getParcelableArrayList(ATTRIBUTES);</span>
<span class="nc" id="L276">            mAttributeValueHashMap.clear();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">            if (values != null) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">                for (AttributeValue v : values) {</span>
<span class="nc" id="L279">                    mAttributeValueHashMap.put(v.getCode(), v);</span>
<span class="nc" id="L280">                }</span>
            }

<span class="nc" id="L283">            mIsProgressDialogShowing = savedInstanceState.getBoolean(SHOW_PROGRESS_DIALOG);</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">            if (mIsProgressDialogShowing) {</span>
<span class="nc" id="L285">                showProgressDialog(true);</span>
            }
        }
<span class="nc" id="L288">    }</span>

    @Override
    public void onAttach(Context context) {
<span class="nc" id="L292">        super.onAttach(context);</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">        if (mServiceDescriptionTaskResult != null) {</span>
            // Reload service description task if the activity restored
<span class="nc" id="L295">            this.onServiceDescriptionTaskCompleted(mServiceDescriptionTaskResult);</span>
<span class="nc" id="L296">            mServiceDescriptionTaskResult = null;</span>
        }

        try {
<span class="nc" id="L300">            mCallback = (ReportProblemFragmentCallback) context;</span>
<span class="nc" id="L301">        } catch (ClassCastException e) {</span>
<span class="nc" id="L302">            throw new ClassCastException(&quot;ReportProblemFragmentCallback should be implemented&quot; +</span>
                    &quot; in parent activity&quot;);
<span class="nc" id="L304">        }</span>
<span class="nc" id="L305">    }</span>

    /**
     * Initialize UI components
     */
    private void setupViews(Bundle bundle) {
<span class="nc" id="L311">        mIssueImageView = (ImageView) findViewById(R.id.ri_imageView);</span>
<span class="nc bnc" id="L312" title="All 4 branches missed.">        if (bundle != null &amp;&amp; bundle.getParcelable(IMAGE_THUMBNAIL) != null) {</span>
<span class="nc" id="L313">            mIssueImageView.setImageBitmap((Bitmap) bundle.getParcelable(IMAGE_THUMBNAIL));</span>
        }

<span class="nc" id="L316">        mInfoLayout = (LinearLayout) findViewById(R.id.ri_info_layout);</span>

<span class="nc" id="L318">        Button addImageButton = (Button) findViewById(R.id.ri_attach_image);</span>

<span class="nc" id="L320">        final PopupMenu popupMenu = new PopupMenu(getActivity(), addImageButton);</span>
<span class="nc" id="L321">        popupMenu.inflate(R.menu.report_issue_add_image);</span>
<span class="nc" id="L322">        addImageButton.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View v) {
<span class="nc" id="L325">                popupMenu.show();</span>
<span class="nc" id="L326">            }</span>
        });

<span class="nc" id="L329">        popupMenu.setOnMenuItemClickListener(</span>
<span class="nc" id="L330">                new PopupMenu.OnMenuItemClickListener() {</span>
                    @Override
                    public boolean onMenuItemClick(MenuItem item) {
<span class="nc bnc" id="L333" title="All 3 branches missed.">                        switch (item.getItemId()) {</span>
                            case R.id.ri_button_camera:
<span class="nc" id="L335">                                openCamera();</span>
<span class="nc" id="L336">                                break;</span>
                            case R.id.ri_button_gallery:
<span class="nc" id="L338">                                openGallery();</span>
<span class="nc" id="L339">                                break;</span>
                            default:
                                break;
                        }
<span class="nc" id="L343">                        return true;</span>
                    }
                });

<span class="nc" id="L347">        mAnonymousReportingCheckBox = (CheckBox) findViewById(R.id.rici_anonymous_checkbox);</span>
<span class="nc" id="L348">        mAnonymousReportingCheckBox.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {</span>
            @Override
            public void onCheckedChanged(CompoundButton compoundButton, boolean isChecked) {
<span class="nc" id="L351">                disableEnableContactInfoViews(isChecked);</span>
<span class="nc" id="L352">            }</span>
        });

        // Setup contact info views
<span class="nc" id="L356">        mContactNameView = ((EditText) findViewById(R.id.rici_name_editText));</span>
<span class="nc" id="L357">        mContactLastNameView = ((EditText) findViewById(R.id.rici_lastname_editText));</span>
<span class="nc" id="L358">        mContactEmailView = ((EditText) findViewById(R.id.rici_email_editText));</span>
<span class="nc" id="L359">        mContactPhoneView = ((EditText) findViewById(R.id.rici_phone_editText));</span>
<span class="nc" id="L360">    }</span>

    private void setupIconColors() {
<span class="nc" id="L363">        ((ImageView) findViewById(R.id.ri_ic_app_feedback)).setColorFilter(</span>
<span class="nc" id="L364">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L365">        ((ImageView) findViewById(R.id.ri_ic_image_picker)).setColorFilter(</span>
<span class="nc" id="L366">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L367">        ((ImageView) findViewById(R.id.ri_ic_username)).setColorFilter(</span>
<span class="nc" id="L368">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L369">        ((ImageView) findViewById(R.id.ri_ic_customer_service_email)).setColorFilter(</span>
<span class="nc" id="L370">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L371">        ((ImageView) findViewById(R.id.ri_ic_customer_service_phone)).setColorFilter(</span>
<span class="nc" id="L372">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L373">        ((ImageView) findViewById(R.id.ri_ic_anonymous)).setColorFilter(</span>
<span class="nc" id="L374">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L375">    }</span>

    private void callServiceDescription() {
<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (mOpen311 == null) {</span>
<span class="nc" id="L379">            return;</span>
        }

<span class="nc" id="L382">        showProgress(Boolean.TRUE);</span>
<span class="nc" id="L383">        Location location = getIssueLocationHelper().getIssueLocation();</span>
<span class="nc" id="L384">        ServiceDescriptionRequest sdr = new ServiceDescriptionRequest(location.getLatitude(),</span>
<span class="nc" id="L385">                location.getLongitude(), mOpen311.getJurisdiction(), mService.getService_code());</span>

<span class="nc" id="L387">        ServiceDescriptionTask sdt = new ServiceDescriptionTask(sdr, mOpen311,</span>
                Open311ProblemFragment.this);
<span class="nc" id="L389">        sdt.execute();</span>
<span class="nc" id="L390">    }</span>

    /**
     * Update ui if service description request is success
     */
    @Override
    public void onServiceDescriptionTaskCompleted(ServiceDescription serviceDescription) {
<span class="nc bnc" id="L397" title="All 2 branches missed.">        if (isActivityAttached()) {</span>
<span class="nc" id="L398">            showProgress(Boolean.FALSE);</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">            if (serviceDescription.isSuccess()) {</span>
<span class="nc" id="L400">                createServiceDescriptionUI(serviceDescription);</span>
            } else {
<span class="nc" id="L402">                createToastMessage(getString(R.string.ri_service_description_problem));</span>
                // Close open311 fragment
<span class="nc" id="L404">                ((InfrastructureIssueActivity) getActivity()).removeOpen311ProblemFragment();</span>
            }
        } else {
<span class="nc" id="L407">            mServiceDescriptionTaskResult = serviceDescription;</span>
        }
<span class="nc" id="L409">    }</span>

    /**
     * Show the result of the open311 issue submission
     */
    @Override
    public void onServiceRequestTaskCompleted(ServiceRequestResponse response) {
<span class="nc" id="L416">        showProgressDialog(false);</span>

<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (response.isSuccess()) {</span>
<span class="nc" id="L419">            mCallback.onReportSent();</span>
        } else {
<span class="nc" id="L421">            String message = response.getErrorMessage();</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">            if (TextUtils.isEmpty(message)) {</span>
<span class="nc" id="L423">                message = getString(R.string.ri_unsuccessful_submit);</span>
            }
<span class="nc" id="L425">            createToastMessage(message);</span>
        }
<span class="nc" id="L427">    }</span>

    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="nc" id="L431">        inflater.inflate(R.menu.report_issue_action, menu);</span>
<span class="nc" id="L432">        super.onCreateOptionsMenu(menu, inflater);</span>
<span class="nc" id="L433">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L437" title="All 2 branches missed.">        if (item.getItemId() == R.id.report_problem_send) {</span>
<span class="nc" id="L438">            submitReport();</span>
        }
<span class="nc" id="L440">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc" id="L445">        super.onActivityResult(requestCode, resultCode, data);</span>

<span class="nc bnc" id="L447" title="All 6 branches missed.">        if (requestCode == ReportConstants.GALLERY_INTENT &amp;&amp; resultCode == Activity.RESULT_OK &amp;&amp;</span>
                data != null) {
            // Get the gallery image info
<span class="nc" id="L450">            mCapturedImageURI = data.getData();</span>
<span class="nc" id="L451">            String[] filePathColumn = {MediaStore.Images.Media.DATA};</span>
<span class="nc" id="L452">            Cursor cursor = getActivity().getContentResolver().query(mCapturedImageURI,</span>
                    filePathColumn, null, null, null);
<span class="nc bnc" id="L454" title="All 2 branches missed.">            if (cursor == null) return;</span>
<span class="nc" id="L455">            cursor.moveToFirst();</span>
<span class="nc" id="L456">            int columnIndex = cursor.getColumnIndex(filePathColumn[0]);</span>
<span class="nc" id="L457">            mImagePath = cursor.getString(columnIndex);</span>
<span class="nc" id="L458">            cursor.close();</span>
        }

        // Whether image was from gallery or captured via camera, we need to downscale it for ImageView
<span class="nc bnc" id="L462" title="All 6 branches missed.">        if ((requestCode == ReportConstants.GALLERY_INTENT</span>
                || requestCode == ReportConstants.CAPTURE_PICTURE_INTENT)
                &amp;&amp; resultCode == Activity.RESULT_OK) {
            // Load thumbnail to avoid OutOfMemory issue on Galaxy S5 - see #730
<span class="nc" id="L466">            Bitmap thumbnail = null;</span>
            try {
<span class="nc" id="L468">                thumbnail = UIUtils.decodeSampledBitmapFromFile(mImagePath,</span>
<span class="nc" id="L469">                        mIssueImageView.getWidth(), mIssueImageView.getHeight());</span>
<span class="nc" id="L470">            } catch (IOException e) {</span>
<span class="nc" id="L471">                e.printStackTrace();</span>
<span class="nc" id="L472">            }</span>
<span class="nc" id="L473">            mIssueImageView.setImageBitmap(thumbnail);</span>
        }
<span class="nc" id="L475">    }</span>

    /**
     * Prepare submit forms and submit report
     */
    private void submitReport() {
        // Save the open311 user
<span class="nc" id="L482">        saveOpen311User();</span>

        // Prepare issue description
<span class="nc" id="L485">        String description = ((EditText) getActivity().findViewById(R.id.ri_editTextDesc)).getText().toString();</span>

        Open311User open311User;

<span class="nc bnc" id="L489" title="All 2 branches missed.">        if (!mAnonymousReportingCheckBox.isChecked()) {</span>
<span class="nc" id="L490">            open311User = getOpen311UserFromUI();</span>
        } else {
<span class="nc" id="L492">            open311User = getOpen311UserFromStrings();</span>
        }

<span class="nc" id="L495">        String appUid = PreferenceUtils.getString(Application.APP_UID);</span>

<span class="nc" id="L497">        IssueLocationHelper issueLocationHelper = getIssueLocationHelper();</span>

<span class="nc" id="L499">        ServiceRequest.Builder builder = new ServiceRequest.Builder();</span>
<span class="nc" id="L500">        builder.setJurisdiction_id(mOpen311.getJurisdiction()).setService_code(mService.getService_code()).</span>
<span class="nc" id="L501">                setService_name(mService.getService_name()).</span>
<span class="nc" id="L502">                setLatitude(issueLocationHelper.getIssueLocation().getLatitude()).</span>
<span class="nc" id="L503">                setLongitude(issueLocationHelper.getIssueLocation().getLongitude()).setSummary(null).</span>
<span class="nc" id="L504">                setDescription(description).setEmail(open311User.getEmail()).</span>
<span class="nc" id="L505">                setFirst_name(open311User.getName()).setLast_name(open311User.getLastName()).</span>
<span class="nc" id="L506">                setPhone(open311User.getPhone()).setAddress_string(getCurrentAddress()).</span>
<span class="nc" id="L507">                setDevice_id(appUid);</span>

<span class="nc bnc" id="L509" title="All 2 branches missed.">        if (mImagePath != null) {</span>
<span class="nc" id="L510">            attachImage(builder);</span>
        }

<span class="nc" id="L513">        ServiceRequest serviceRequest = builder.createServiceRequest();</span>
<span class="nc" id="L514">        List&lt;Open311AttributePair&gt; attributes = createOpen311Attributes(mServiceDescription);</span>
<span class="nc" id="L515">        serviceRequest.setAttributes(attributes);</span>

<span class="nc" id="L517">        int errorCode = Open311Validator.validateServiceRequest(serviceRequest,</span>
<span class="nc" id="L518">                mOpen311.getOpen311Option().getOpen311Type(), mServiceDescription);</span>


<span class="nc bnc" id="L521" title="All 2 branches missed.">        if (Open311Validator.isValid(errorCode)) {</span>
            // Append transit service parameters to issue description
<span class="nc bnc" id="L523" title="All 2 branches missed.">            if (ServiceUtils.isTransitServiceByType(mService.getType())) {</span>
<span class="nc" id="L524">                description += getTransitIssueParameters(mService);</span>
<span class="nc" id="L525">                serviceRequest.setDescription(description);</span>
            }

            // Start progress
<span class="nc" id="L529">            showProgressDialog(true);</span>

<span class="nc" id="L531">            mRequestTask = new ServiceRequestTask(mOpen311, serviceRequest, this);</span>
<span class="nc" id="L532">            mRequestTask.execute();</span>

<span class="nc" id="L534">            ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_problem), mService.getService_name());</span>
        } else {
<span class="nc" id="L536">            createToastMessage(Open311Validator.getErrorMessageForServiceRequestByErrorCode(errorCode));</span>
        }
<span class="nc" id="L538">    }</span>

    /**
     * Attaches the captured image saved in this fragment to the provided builder
     *
     * @param builder the builder to attach the image to
     */
    private void attachImage(ServiceRequest.Builder builder) {
        // Downsample the image file to avoid uploading huge images
<span class="nc" id="L547">        File smallImageFile = null;</span>
        try {
<span class="nc" id="L549">            smallImageFile = UIUtils.createImageFile(getContext(), &quot;-small&quot;);</span>
<span class="nc" id="L550">        } catch (IOException ex) {</span>
            // Error occurred while creating the File
<span class="nc" id="L552">            createToastMessage(getString(R.string.ri_resize_image_problem));</span>
<span class="nc" id="L553">            Log.e(TAG, &quot;Couldn't resize image - &quot; + ex);</span>
<span class="nc" id="L554">        }</span>

        // Continue only if the File was successfully created
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (smallImageFile != null) {</span>
            // Max SeeClickFix resolution image is &quot;800x600 image center cropped&quot;
<span class="nc" id="L559">            final int WIDTH = 800, HEIGHT = 800;</span>
            Bitmap smallImage;
<span class="nc" id="L561">            FileOutputStream out = null;</span>
            try {
<span class="nc" id="L563">                smallImage = UIUtils.decodeSampledBitmapFromFile(mImagePath, WIDTH, HEIGHT);</span>
<span class="nc" id="L564">                out = new FileOutputStream(smallImageFile);</span>
<span class="nc" id="L565">                smallImage.compress(Bitmap.CompressFormat.JPEG, 100, out);</span>
<span class="nc" id="L566">                out.flush();</span>
<span class="nc" id="L567">            } catch (IOException e) {</span>
<span class="nc" id="L568">                e.printStackTrace();</span>
                // Just use the full size image
<span class="nc" id="L570">                smallImageFile = new File(mImagePath);</span>
            } finally {
<span class="nc bnc" id="L572" title="All 2 branches missed.">                if (out != null) {</span>
                    try {
<span class="nc" id="L574">                        out.close();</span>
<span class="nc" id="L575">                    } catch (IOException e) {</span>
<span class="nc" id="L576">                        e.printStackTrace();</span>
<span class="nc" id="L577">                    }</span>
                }
            }
<span class="nc" id="L580">        } else {</span>
            // Just use the full size image
<span class="nc" id="L582">            smallImageFile = new File(mImagePath);</span>
        }

<span class="nc" id="L585">        builder.setMedia(smallImageFile);</span>
<span class="nc" id="L586">    }</span>

    /**
     * Generates stop and trip problem parameters for given open311 service
     *
     * @param service open311 service
     * @return a string containing parameters
     */
    private String getTransitIssueParameters(Service service) {
<span class="nc" id="L595">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L596">        ObaStop obaStop = getIssueLocationHelper().getObaStop();</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">        if (obaStop == null) {</span>
<span class="nc" id="L598">            return sb.toString();</span>
        }

<span class="nc" id="L601">        sb.append(getString(R.string.ri_append_start));</span>

<span class="nc bnc" id="L603" title="All 2 branches missed.">        if (ServiceUtils.isTransitStopServiceByType(service.getType())) {</span>
            // Append stop service params
<span class="nc" id="L605">            sb.append(getResources().getString(R.string.ri_append_gtfs_stop_id, obaStop.getId()));</span>
<span class="nc" id="L606">            sb.append(getResources().getString(R.string.ri_append_stop_name, obaStop.getName()));</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">        } else if (ServiceUtils.isTransitTripServiceByType(service.getType())) {</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">            if (mArrivalInfo != null) {</span>
                // Append trip service params
<span class="nc" id="L610">                DateFormat dateFormat = new SimpleDateFormat(&quot;MM-dd-yyyy&quot;);</span>

<span class="nc" id="L612">                sb.append(getResources().getString(R.string.ri_append_service_date,</span>
<span class="nc" id="L613">                        dateFormat.format(new Date(mArrivalInfo.getServiceDate()))));</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                if (mAgencyName != null) {</span>
<span class="nc" id="L615">                    sb.append(getResources().getString(R.string.ri_append_agency_name, mAgencyName));</span>
                }
<span class="nc" id="L617">                sb.append(getResources().getString(R.string.ri_append_gtfs_stop_id, obaStop.getId()));</span>
<span class="nc" id="L618">                sb.append(getResources().getString(R.string.ri_append_stop_name, obaStop.getName()));</span>

<span class="nc" id="L620">                sb.append(getResources().getString(R.string.ri_append_route_id, mArrivalInfo.getRouteId()));</span>
<span class="nc" id="L621">                String routeDisplayName = UIUtils.getRouteDisplayName(mArrivalInfo);</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">                if (!TextUtils.isEmpty(routeDisplayName)) {</span>
<span class="nc" id="L623">                    sb.append(getResources().getString(R.string.ri_append_route_display_name,</span>
                            routeDisplayName));
                }
<span class="nc bnc" id="L626" title="All 2 branches missed.">                if (mBlockId != null) {</span>
<span class="nc" id="L627">                    sb.append(getResources().getString(R.string.ri_append_block_id, mBlockId));</span>
                }

<span class="nc" id="L630">                sb.append(getResources().getString(R.string.ri_append_trip_id, mArrivalInfo.getTripId()));</span>
<span class="nc" id="L631">                sb.append(getResources().getString(R.string.ri_append_trip_name, mArrivalInfo.getHeadsign()));</span>

<span class="nc" id="L633">                sb.append(getResources().getString(R.string.ri_append_predicted,</span>
<span class="nc" id="L634">                        Boolean.valueOf(mArrivalInfo.getPredicted())));</span>

<span class="nc" id="L636">                ObaTripStatus tripStatus = mArrivalInfo.getTripStatus();</span>
<span class="nc bnc" id="L637" title="All 4 branches missed.">                if (tripStatus != null &amp;&amp; mArrivalInfo.getPredicted()) {</span>
<span class="nc" id="L638">                    sb.append(getResources().getString(R.string.ri_append_vehicle_id, mArrivalInfo.getVehicleId()));</span>

<span class="nc" id="L640">                    Location lastKnownLocation = tripStatus.getLastKnownLocation();</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">                    if (lastKnownLocation != null) {</span>
<span class="nc" id="L642">                        String locationString = lastKnownLocation.getLatitude() +</span>
<span class="nc" id="L643">                                &quot; &quot; + lastKnownLocation.getLongitude();</span>
<span class="nc" id="L644">                        sb.append(getResources().getString(R.string.ri_append_vehicle_location,</span>
                                locationString));
                    }

<span class="nc" id="L648">                    DecimalFormat numberFormat = new DecimalFormat(&quot;#.000&quot;);</span>
<span class="nc" id="L649">                    double scheduleDeviation = tripStatus.getScheduleDeviation() / 60.0;</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">                    if (scheduleDeviation == 0.0) {</span>
<span class="nc" id="L651">                        sb.append(getResources().getString(R.string.ri_append_schedule_deviation,</span>
                                &quot;0&quot;));
<span class="nc bnc" id="L653" title="All 2 branches missed.">                    } else if (scheduleDeviation &lt; 0) {</span>
<span class="nc" id="L654">                        sb.append(getResources().getString(R.string.ri_append_schedule_deviation_early,</span>
<span class="nc" id="L655">                                numberFormat.format(scheduleDeviation * -1.0)));</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">                    } else if (scheduleDeviation &gt; 0) {</span>
<span class="nc" id="L657">                        sb.append(getResources().getString(R.string.ri_append_schedule_deviation_late,</span>
<span class="nc" id="L658">                                numberFormat.format(scheduleDeviation)));</span>
                    }
                }

<span class="nc" id="L662">                dateFormat = new SimpleDateFormat(&quot;hh:mm a&quot;);</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                if (mArrivalInfo.getPredicted()) {</span>
<span class="nc" id="L664">                    sb.append(getResources().getString(R.string.ri_append_arrival_time,</span>
<span class="nc" id="L665">                            dateFormat.format(new Date(mArrivalInfo.getPredictedArrivalTime()))));</span>
<span class="nc" id="L666">                    sb.append(getResources().getString(R.string.ri_append_departure_time,</span>
<span class="nc" id="L667">                            dateFormat.format(new Date(mArrivalInfo.getPredictedDepartureTime()))));</span>
                } else {
<span class="nc" id="L669">                    sb.append(getResources().getString(R.string.ri_append_arrival_time,</span>
<span class="nc" id="L670">                            dateFormat.format(new Date(mArrivalInfo.getScheduledArrivalTime()))));</span>
<span class="nc" id="L671">                    sb.append(getResources().getString(R.string.ri_append_departure_time,</span>
<span class="nc" id="L672">                            dateFormat.format(new Date(mArrivalInfo.getScheduledDepartureTime()))));</span>
                }
            }

        }

<span class="nc" id="L678">        return sb.toString();</span>
    }

    /**
     * Creates open311 question and answer attributes to submit a report
     * Reads from dynamically created UI
     *
     * @param serviceDescription contains attribute types
     * @return List of code value pair of attributes
     */
    private List&lt;Open311AttributePair&gt; createOpen311Attributes(ServiceDescription serviceDescription) {
<span class="nc" id="L689">        List&lt;Open311AttributePair&gt; attributes = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L691" title="All 2 branches missed.">        for (Open311Attribute open311Attribute : serviceDescription.getAttributes()) {</span>

<span class="nc bnc" id="L693" title="All 2 branches missed.">            if (Boolean.valueOf(open311Attribute.getVariable())) {</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">                if (Open311DataType.STRING.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">                        || Open311DataType.TEXT.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                        || Open311DataType.NUMBER.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">                        || Open311DataType.DATETIME.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L698">                    EditText et = (EditText) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">                    if (et != null) {</span>
<span class="nc" id="L700">                        attributes.add(new Open311AttributePair(open311Attribute.getCode(),</span>
<span class="nc" id="L701">                                et.getText().toString(), open311Attribute.getDatatype()));</span>
                    }
<span class="nc bnc" id="L703" title="All 2 branches missed.">                } else if (Open311DataType.SINGLEVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L704">                    RadioGroup rg = (RadioGroup) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">                    if (rg != null) {</span>
<span class="nc" id="L706">                        int count = rg.getChildCount();</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">                        for (int i = 0; i &lt; count; i++) {</span>
<span class="nc" id="L708">                            RadioButton rb = (RadioButton) rg.getChildAt(i);</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">                            if (rb.isChecked()) {</span>
<span class="nc" id="L710">                                String attributeKey = mOpen311AttributeKeyNameMap.get(</span>
<span class="nc" id="L711">                                        open311Attribute.getCode() + rb.getText().toString());</span>
<span class="nc" id="L712">                                attributes.add(new Open311AttributePair(open311Attribute.getCode(),</span>
<span class="nc" id="L713">                                        attributeKey, open311Attribute.getDatatype()));</span>
<span class="nc" id="L714">                                break;</span>
                            }
                        }
                    }
<span class="nc bnc" id="L718" title="All 2 branches missed.">                } else if (Open311DataType.MULTIVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L719">                    LinearLayout ll = (LinearLayout) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">                    if (ll != null) {</span>
<span class="nc" id="L721">                        int count = ll.getChildCount();</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">                        for (int i = 0; i &lt; count; i++) {</span>
<span class="nc" id="L723">                            CheckBox cb = (CheckBox) ll.getChildAt(i);</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">                            if (cb.isChecked()) {</span>
<span class="nc" id="L725">                                String attributeKey = mOpen311AttributeKeyNameMap.get(</span>
<span class="nc" id="L726">                                        open311Attribute.getCode() + cb.getText().toString());</span>
<span class="nc" id="L727">                                attributes.add(new Open311AttributePair(open311Attribute.getCode(),</span>
<span class="nc" id="L728">                                        attributeKey, open311Attribute.getDatatype()));</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L734">        }</span>
<span class="nc" id="L735">        return attributes;</span>
    }

    /**
     * This method dynamically reads all user inputted the values from the screen and puts into a
     * list
     *
     * @param serviceDescription displayed service description
     * @return List of attribute values
     */
    private List&lt;AttributeValue&gt; createAttributeValues(ServiceDescription serviceDescription) {
<span class="nc" id="L746">        List&lt;AttributeValue&gt; values = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L748" title="All 2 branches missed.">        if (serviceDescription == null) {</span>
<span class="nc" id="L749">            return values;</span>
        }

<span class="nc bnc" id="L752" title="All 2 branches missed.">        for (Open311Attribute open311Attribute : serviceDescription.getAttributes()) {</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">            if (Boolean.valueOf(open311Attribute.getVariable())) {</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">                if (Open311DataType.STRING.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">                        || Open311DataType.TEXT.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">                        || Open311DataType.NUMBER.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">                        || Open311DataType.DATETIME.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L758">                    EditText et = (EditText) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">                    if (et != null) {</span>
<span class="nc" id="L760">                        AttributeValue value = new AttributeValue(open311Attribute.getCode());</span>
<span class="nc" id="L761">                        value.addValue(et.getText().toString());</span>
<span class="nc" id="L762">                        values.add(value);</span>
                    }
<span class="nc bnc" id="L764" title="All 2 branches missed.">                } else if (Open311DataType.SINGLEVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L765">                    RadioGroup rg = (RadioGroup) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">                    if (rg != null) {</span>
<span class="nc" id="L767">                        int count = rg.getChildCount();</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">                        for (int i = 0; i &lt; count; i++) {</span>
<span class="nc" id="L769">                            RadioButton rb = (RadioButton) rg.getChildAt(i);</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">                            if (rb.isChecked()) {</span>
<span class="nc" id="L771">                                AttributeValue value = new AttributeValue(open311Attribute.getCode());</span>
<span class="nc" id="L772">                                value.addValue(rb.getText().toString());</span>
<span class="nc" id="L773">                                values.add(value);</span>
<span class="nc" id="L774">                                break;</span>
                            }
                        }
                    }
<span class="nc bnc" id="L778" title="All 2 branches missed.">                } else if (Open311DataType.MULTIVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L779">                    LinearLayout ll = (LinearLayout) mDynamicAttributeUIMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">                    if (ll != null) {</span>
<span class="nc" id="L781">                        int count = ll.getChildCount();</span>
<span class="nc" id="L782">                        AttributeValue value = new AttributeValue(open311Attribute.getCode());</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">                        for (int i = 0; i &lt; count; i++) {</span>
<span class="nc" id="L784">                            CheckBox cb = (CheckBox) ll.getChildAt(i);</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">                            if (cb.isChecked()) {</span>
<span class="nc" id="L786">                                value.addValue(cb.getText().toString());</span>
                            }
                        }
<span class="nc bnc" id="L789" title="All 2 branches missed.">                        if (value.getValues().size() &gt; 0)</span>
<span class="nc" id="L790">                            values.add(value);</span>
                    }
                }
            }
<span class="nc" id="L794">        }</span>
<span class="nc" id="L795">        return values;</span>
    }

    /**
     * From https://developer.android.com/training/camera/photobasics.html#TaskPath
     */
    private void openCamera() {
<span class="nc" id="L802">        Intent takePictureIntent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);</span>

        // Ensure that there's a camera activity to handle the intent
<span class="nc bnc" id="L805" title="All 2 branches missed.">        if (takePictureIntent.resolveActivity(getActivity().getPackageManager()) != null) {</span>
            // Create the File where the photo should go
<span class="nc" id="L807">            File photoFile = null;</span>
            try {
<span class="nc" id="L809">                photoFile = UIUtils.createImageFile(getContext(), null);</span>
<span class="nc" id="L810">            } catch (IOException ex) {</span>
                // Error occurred while creating the File
<span class="nc" id="L812">                createToastMessage(getString(R.string.ri_open_camera_problem));</span>
<span class="nc" id="L813">                Log.e(TAG, &quot;Couldn't open camera - &quot; + ex);</span>
<span class="nc" id="L814">            }</span>

            // Continue only if the File was successfully created
<span class="nc bnc" id="L817" title="All 2 branches missed.">            if (photoFile != null) {</span>
                // Save a file: path for use with ACTION_VIEW intents
<span class="nc" id="L819">                mImagePath = photoFile.getAbsolutePath();</span>
<span class="nc" id="L820">                mCapturedImageURI = Uri.fromFile(photoFile);</span>
<span class="nc" id="L821">                takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT, mCapturedImageURI);</span>
<span class="nc" id="L822">                startActivityForResult(takePictureIntent, ReportConstants.CAPTURE_PICTURE_INTENT);</span>
            }
        }
<span class="nc" id="L825">    }</span>

    private void openGallery() {
<span class="nc" id="L828">        Intent intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span>
<span class="nc" id="L829">        startActivityForResult(intent, ReportConstants.GALLERY_INTENT);</span>
<span class="nc" id="L830">    }</span>

    /**
     * Dynamically creates Open311 questions from service description
     *
     * @param serviceDescription contains Open311 questions
     */
    public void createServiceDescriptionUI(ServiceDescription serviceDescription) {
<span class="nc" id="L838">        clearInfoField();</span>
<span class="nc" id="L839">        this.mServiceDescription = serviceDescription;</span>
<span class="nc bnc" id="L840" title="All 4 branches missed.">        if (!&quot;&quot;.equals(mService.getDescription()) &amp;&amp; mService.getDescription() != null) {</span>
<span class="nc" id="L841">            addDescriptionText(mService.getDescription());</span>
        }

<span class="nc bnc" id="L844" title="All 4 branches missed.">        if (mArrivalInfo != null &amp;&amp; ServiceUtils.isTransitTripServiceByType(mService.getType())) {</span>
<span class="nc" id="L845">            createTripHeadsign(mArrivalInfo.getHeadsign());</span>
        }

<span class="nc bnc" id="L848" title="All 2 branches missed.">        for (Open311Attribute open311Attribute : serviceDescription.getAttributes()) {</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">            if (!Boolean.valueOf(open311Attribute.getVariable())) {</span>
<span class="nc" id="L850">                addDescriptionText(open311Attribute.getDescription());</span>
            } else {
<span class="nc bnc" id="L852" title="All 2 branches missed.">                if (Open311DataType.STRING.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">                        || Open311DataType.TEXT.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L854" title="All 2 branches missed.">                        || Open311DataType.NUMBER.equals(open311Attribute.getDatatype())</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">                        || Open311DataType.DATETIME.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L856">                    createEditText(open311Attribute);</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">                } else if (Open311DataType.SINGLEVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L858">                    createSingleValueList(open311Attribute);</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">                } else if (Open311DataType.MULTIVALUELIST.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L860">                    createMultiValueList(open311Attribute);</span>
                }
            }
<span class="nc" id="L863">        }</span>
<span class="nc" id="L864">    }</span>

    /**
     * Dynamically creates an edit text
     *
     * @param open311Attribute contains the open311 attributes
     */
    private void createEditText(Open311Attribute open311Attribute) {
<span class="nc" id="L872">        LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc" id="L873">        RelativeLayout layout = (RelativeLayout) inflater.inflate(R.layout.report_issue_text_item, null, false);</span>

<span class="nc" id="L875">        ImageView icon = ((ImageView) layout.findViewById(R.id.ri_ic_question_answer));</span>
<span class="nc" id="L876">        icon.setColorFilter(getResources().getColor(R.color.material_gray));</span>

<span class="nc" id="L878">        Spannable desc = new SpannableString(MyTextUtils.toSentenceCase(open311Attribute.getDescription()));</span>
<span class="nc" id="L879">        EditText editText = ((EditText) layout.findViewById(R.id.riti_editText));</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">        if (open311Attribute.getRequired()) {</span>
<span class="nc" id="L881">            Spannable req = new SpannableString(&quot;(required)&quot;);</span>
<span class="nc" id="L882">            req.setSpan(new ForegroundColorSpan(Color.RED), 0, req.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span class="nc" id="L883">            editText.setHint(TextUtils.concat(desc, &quot; &quot;, req));</span>
<span class="nc" id="L884">        } else {</span>
<span class="nc" id="L885">            editText.setHint(desc);</span>
        }

<span class="nc bnc" id="L888" title="All 2 branches missed.">        if (Open311DataType.NUMBER.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L889">            editText.setInputType(InputType.TYPE_CLASS_NUMBER);</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">        } else if (Open311DataType.DATETIME.equals(open311Attribute.getDatatype())) {</span>
<span class="nc" id="L891">            editText.setInputType(InputType.TYPE_CLASS_DATETIME);</span>
        }

        // Restore view state from attribute result hash map
<span class="nc" id="L895">        AttributeValue av = mAttributeValueHashMap.get(open311Attribute.getCode());</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">        if (av != null) {</span>
<span class="nc" id="L897">            editText.setText(av.getSingleValue());</span>
        }

        // Dynamically fill stop id if this is a transit service
        // And if this is a bus stop field
<span class="nc bnc" id="L902" title="All 2 branches missed.">        if (ServiceUtils.isTransitServiceByType(mService.getType())</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">                &amp;&amp; ServiceUtils.isStopIdField(open311Attribute.getDescription())) {</span>

<span class="nc" id="L905">            icon.setImageDrawable(ContextCompat.getDrawable(getActivity(),</span>
                    R.drawable.ic_stop_flag_triangle));

<span class="nc" id="L908">            ObaStop obaStop = getIssueLocationHelper().getObaStop();</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">            if (obaStop != null) {</span>
<span class="nc" id="L910">                editText.setText(obaStop.getStopCode());</span>
            }
        }

<span class="nc" id="L914">        mInfoLayout.addView(layout);</span>
<span class="nc" id="L915">        mDynamicAttributeUIMap.put(open311Attribute.getCode(), editText);</span>
<span class="nc" id="L916">    }</span>

    /**
     * Dynamically creates radio buttons
     *
     * @param open311Attribute contains the open311 attributes
     */
    private void createSingleValueList(Open311Attribute open311Attribute) {
<span class="nc" id="L924">        ArrayList&lt;Object&gt; values = (ArrayList&lt;Object&gt;) open311Attribute.getValues();</span>
<span class="nc bnc" id="L925" title="All 4 branches missed.">        if (values != null &amp;&amp; values.size() &gt; 0) {</span>
<span class="nc" id="L926">            LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc" id="L927">            RelativeLayout layout = (RelativeLayout) inflater.inflate(</span>
                    R.layout.report_issue_single_value_list_item, null, false);
<span class="nc" id="L929">            layout.setSaveEnabled(true);</span>
<span class="nc" id="L930">            ((ImageView) layout.findViewById(R.id.ri_ic_radio)).setColorFilter(</span>
<span class="nc" id="L931">                    getResources().getColor(R.color.material_gray));</span>

<span class="nc" id="L933">            Spannable word = new SpannableString(open311Attribute.getDescription());</span>
<span class="nc" id="L934">            ((TextView) layout.findViewById(R.id.risvli_textView)).setText(word);</span>

<span class="nc bnc" id="L936" title="All 2 branches missed.">            if (open311Attribute.getRequired()) {</span>
<span class="nc" id="L937">                Spannable wordTwo = new SpannableString(&quot; *Required&quot;);</span>
<span class="nc" id="L938">                wordTwo.setSpan(new ForegroundColorSpan(Color.RED), 0, wordTwo.length(),</span>
                        Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
<span class="nc" id="L940">                ((TextView) layout.findViewById(R.id.risvli_textView)).append(wordTwo);</span>
            }

<span class="nc" id="L943">            RadioGroup rg = (RadioGroup) layout.findViewById(R.id.risvli_radioGroup);</span>
<span class="nc" id="L944">            rg.setOrientation(RadioGroup.VERTICAL);</span>

            // Restore view state from attribute result hash map
<span class="nc" id="L947">            AttributeValue av = mAttributeValueHashMap.get(open311Attribute.getCode());</span>
<span class="nc" id="L948">            String entryValue = null;</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">            if (av != null) {</span>
<span class="nc" id="L950">                entryValue = av.getSingleValue();</span>
            }

<span class="nc bnc" id="L953" title="All 2 branches missed.">            for (int i = 0; i &lt; values.size(); i++) {</span>
<span class="nc" id="L954">                LinkedHashMap&lt;String, String&gt; value = (LinkedHashMap&lt;String, String&gt;) values.get(i);</span>
<span class="nc" id="L955">                RadioButton rb = new RadioButton(getActivity());</span>
<span class="nc" id="L956">                rg.addView(rb); //the RadioButtons are added to the radioGroup instead of the layout</span>
<span class="nc" id="L957">                String attributeKey = &quot;&quot;;</span>
<span class="nc" id="L958">                String attributeValue = &quot;&quot;;</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">                for (LinkedHashMap.Entry&lt;String, String&gt; entry : value.entrySet()) {</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">                    if (Open311Attribute.NAME.equals(entry.getKey())) {</span>
<span class="nc" id="L961">                        rb.setText(entry.getValue());</span>
<span class="nc bnc" id="L962" title="All 4 branches missed.">                        if (entryValue != null &amp;&amp; entryValue.equalsIgnoreCase(entry.getValue())) {</span>
<span class="nc" id="L963">                            rb.setChecked(true);</span>
                        }
<span class="nc" id="L965">                        attributeKey = open311Attribute.getCode() + entry.getValue();</span>
<span class="nc bnc" id="L966" title="All 2 branches missed.">                    } else if (Open311Attribute.KEY.equals(entry.getKey())) {</span>
<span class="nc" id="L967">                        attributeValue = entry.getValue();</span>
                    }
<span class="nc" id="L969">                }</span>
<span class="nc" id="L970">                mOpen311AttributeKeyNameMap.put(attributeKey, attributeValue);</span>
            }

<span class="nc" id="L973">            mInfoLayout.addView(layout);</span>
<span class="nc" id="L974">            mDynamicAttributeUIMap.put(open311Attribute.getCode(), rg);</span>
        }
<span class="nc" id="L976">    }</span>

    /**
     * Dynamically creates checkboxes
     *
     * @param open311Attribute contains the open311 attributes
     */
    private void createMultiValueList(Open311Attribute open311Attribute) {
<span class="nc" id="L984">        ArrayList&lt;Object&gt; values = (ArrayList&lt;Object&gt;) open311Attribute.getValues();</span>
<span class="nc bnc" id="L985" title="All 4 branches missed.">        if (values != null &amp;&amp; values.size() &gt; 0) {</span>
<span class="nc" id="L986">            LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc" id="L987">            RelativeLayout layout = (RelativeLayout) inflater.inflate(</span>
                    R.layout.report_issue_multi_value_list_item, null, false);

<span class="nc" id="L990">            ((ImageView) layout.findViewById(R.id.ri_ic_checkbox)).setColorFilter(</span>
<span class="nc" id="L991">                    getResources().getColor(R.color.material_gray));</span>

<span class="nc" id="L993">            Spannable word = new SpannableString(open311Attribute.getDescription());</span>
<span class="nc" id="L994">            ((TextView) layout.findViewById(R.id.rimvli_textView)).setText(word);</span>

<span class="nc bnc" id="L996" title="All 2 branches missed.">            if (open311Attribute.getRequired()) {</span>
<span class="nc" id="L997">                Spannable wordTwo = new SpannableString(&quot; *Required&quot;);</span>
<span class="nc" id="L998">                wordTwo.setSpan(new ForegroundColorSpan(Color.RED), 0, wordTwo.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span class="nc" id="L999">                ((TextView) layout.findViewById(R.id.rimvli_textView)).append(wordTwo);</span>
            }

            // Restore view state from attribute result hash map
<span class="nc" id="L1003">            AttributeValue av = mAttributeValueHashMap.get(open311Attribute.getCode());</span>

<span class="nc" id="L1005">            LinearLayout cg = (LinearLayout) layout.findViewById(R.id.rimvli_checkBoxGroup);</span>
<span class="nc bnc" id="L1006" title="All 2 branches missed.">            for (int i = 0; i &lt; values.size(); i++) {</span>
<span class="nc" id="L1007">                LinkedHashMap&lt;String, String&gt; value = (LinkedHashMap&lt;String, String&gt;) values.get(i);</span>
<span class="nc" id="L1008">                CheckBox cb = new CheckBox(getActivity());</span>
<span class="nc" id="L1009">                cg.addView(cb);</span>
<span class="nc" id="L1010">                String attributeKey = &quot;&quot;;</span>
<span class="nc" id="L1011">                String attributeValue = &quot;&quot;;</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">                for (LinkedHashMap.Entry&lt;String, String&gt; entry : value.entrySet()) {</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">                    if (Open311Attribute.NAME.equals(entry.getKey())) {</span>
<span class="nc" id="L1014">                        cb.setText(entry.getValue());</span>
<span class="nc bnc" id="L1015" title="All 4 branches missed.">                        if (av != null &amp;&amp; av.getValues().contains(entry.getValue())) {</span>
<span class="nc" id="L1016">                            cb.setChecked(true);</span>
                        }
<span class="nc" id="L1018">                        attributeKey = open311Attribute.getCode() + entry.getValue();</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">                    } else if (Open311Attribute.KEY.equals(entry.getKey())) {</span>
<span class="nc" id="L1020">                        attributeValue = entry.getValue();</span>
                    }
<span class="nc" id="L1022">                }</span>
<span class="nc" id="L1023">                mOpen311AttributeKeyNameMap.put(attributeKey, attributeValue);</span>
            }

<span class="nc" id="L1026">            mInfoLayout.addView(layout);</span>
<span class="nc" id="L1027">            mDynamicAttributeUIMap.put(open311Attribute.getCode(), cg);</span>
        }
<span class="nc" id="L1029">    }</span>

    private void createTripHeadsign(String text) {
<span class="nc" id="L1032">        LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc" id="L1033">        RelativeLayout layout = (RelativeLayout) inflater.inflate(</span>
                R.layout.report_issue_description_item, null, false);

<span class="nc" id="L1036">        LinearLayout linear = (LinearLayout) findViewById(R.id.ri_report_stop_problem);</span>
<span class="nc" id="L1037">        TextView tv = ((TextView) layout.findViewById(R.id.riii_textView));</span>
<span class="nc" id="L1038">        tv.setText(UIUtils.formatDisplayText(text));</span>
<span class="nc" id="L1039">        tv.setTypeface(null, Typeface.NORMAL);</span>

<span class="nc" id="L1041">        linear.addView(layout, 0);</span>

<span class="nc" id="L1043">        ImageView imageView = (ImageView) layout.findViewById(R.id.ic_action_info);</span>
<span class="nc" id="L1044">        imageView.setImageResource(R.drawable.ic_trip_details);</span>
<span class="nc" id="L1045">        imageView.setColorFilter(getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L1046">    }</span>

    private void clearInfoField() {
<span class="nc" id="L1049">        mInfoLayout.removeAllViewsInLayout();</span>
<span class="nc" id="L1050">    }</span>

    private void addDescriptionText(String text) {
<span class="nc" id="L1053">        LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc" id="L1054">        RelativeLayout layout = (RelativeLayout) inflater.inflate(</span>
                R.layout.report_issue_description_item, null, false);

<span class="nc" id="L1057">        ((TextView) layout.findViewById(R.id.riii_textView)).setText(text);</span>
<span class="nc" id="L1058">        mInfoLayout.addView(layout);</span>

<span class="nc" id="L1060">        ((ImageView) layout.findViewById(R.id.ic_action_info)).setColorFilter(</span>
<span class="nc" id="L1061">                getResources().getColor(R.color.material_gray));</span>
<span class="nc" id="L1062">    }</span>

    /**
     * Set up USer contact information view
     */
    private void setUpContactInfoViews() {
<span class="nc" id="L1068">        Open311User open311User = getOpen311UserFromSharedPref();</span>
<span class="nc bnc" id="L1069" title="All 2 branches missed.">        if (open311User.getName() != null)</span>
<span class="nc" id="L1070">            mContactNameView.setText(open311User.getName());</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">        if (open311User.getLastName() != null)</span>
<span class="nc" id="L1072">            mContactLastNameView.setText(open311User.getLastName());</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">        if (open311User.getEmail() != null)</span>
<span class="nc" id="L1074">            mContactEmailView.setText(open311User.getEmail());</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">        if (open311User.getPhone() != null)</span>
<span class="nc" id="L1076">            mContactPhoneView.setText(open311User.getPhone());</span>
<span class="nc" id="L1077">    }</span>

    /**
     * This method disables or enables editing for contact info fields
     *
     * @param isDisabled true if you want to disable contact info fields
     */
    private void disableEnableContactInfoViews(boolean isDisabled) {
<span class="nc bnc" id="L1085" title="All 2 branches missed.">        mContactNameView.setEnabled(!isDisabled);</span>
<span class="nc bnc" id="L1086" title="All 2 branches missed.">        mContactLastNameView.setEnabled(!isDisabled);</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">        mContactEmailView.setEnabled(!isDisabled);</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">        mContactPhoneView.setEnabled(!isDisabled);</span>
<span class="nc" id="L1089">    }</span>

    /**
     * Get open311 user from shared preferences
     *
     * @return Open311User
     */
    private Open311User getOpen311UserFromSharedPref() {
<span class="nc" id="L1097">        return new Open311User(PreferenceUtils.getString(ReportConstants.PREF_NAME),</span>
<span class="nc" id="L1098">                PreferenceUtils.getString(ReportConstants.PREF_LAST_NAME),</span>
<span class="nc" id="L1099">                PreferenceUtils.getString(ReportConstants.PREF_EMAIL),</span>
<span class="nc" id="L1100">                PreferenceUtils.getString(ReportConstants.PREF_PHONE));</span>
    }

    /**
     * Get open311 user from fields on the screen
     *
     * @return Open311User
     */
    private Open311User getOpen311UserFromUI() {
<span class="nc" id="L1109">        String name = ((EditText) findViewById(R.id.rici_name_editText)).getText().toString();</span>
<span class="nc" id="L1110">        String lastName = ((EditText) findViewById(R.id.rici_lastname_editText)).getText().toString();</span>
<span class="nc" id="L1111">        String email = ((EditText) findViewById(R.id.rici_email_editText)).getText().toString();</span>
<span class="nc" id="L1112">        String phone = ((EditText) findViewById(R.id.rici_phone_editText)).getText().toString();</span>

<span class="nc" id="L1114">        return new Open311User(name, lastName, email, phone);</span>
    }


    /**
     * Get open311 user from static strings for anonymous reporting
     *
     * @return Open311User
     */
    public Open311User getOpen311UserFromStrings() {
<span class="nc" id="L1124">        String name = getString(R.string.ri_static_user_name);</span>
<span class="nc" id="L1125">        String lastName = getString(R.string.ri_static_user_last_name);</span>
<span class="nc" id="L1126">        String email = getString(R.string.ri_static_user_email);</span>
<span class="nc" id="L1127">        String phone = getString(R.string.ri_static_user_phone);</span>

<span class="nc" id="L1129">        return new Open311User(name, lastName, email, phone);</span>
    }

    /**
     * Save open311 user to shared prefs
     */
    private void saveOpen311User() {
<span class="nc" id="L1136">        String name = ((EditText) findViewById(R.id.rici_name_editText)).getText().toString();</span>
<span class="nc" id="L1137">        String lastName = ((EditText) findViewById(R.id.rici_lastname_editText)).getText().toString();</span>
<span class="nc" id="L1138">        String email = ((EditText) findViewById(R.id.rici_email_editText)).getText().toString();</span>
<span class="nc" id="L1139">        String phone = ((EditText) findViewById(R.id.rici_phone_editText)).getText().toString();</span>

<span class="nc" id="L1141">        PreferenceUtils.saveString(ReportConstants.PREF_NAME, name);</span>
<span class="nc" id="L1142">        PreferenceUtils.saveString(ReportConstants.PREF_LAST_NAME, lastName);</span>
<span class="nc" id="L1143">        PreferenceUtils.saveString(ReportConstants.PREF_EMAIL, email);</span>
<span class="nc" id="L1144">        PreferenceUtils.saveString(ReportConstants.PREF_PHONE, phone);</span>
<span class="nc" id="L1145">    }</span>

    private IssueLocationHelper getIssueLocationHelper() {
<span class="nc" id="L1148">        return ((InfrastructureIssueActivity) getActivity()).getIssueLocationHelper();</span>
    }

    private String getCurrentAddress() {
<span class="nc" id="L1152">        String address = ((InfrastructureIssueActivity) getActivity()).getCurrentAddress();</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">        if (TextUtils.isEmpty(address)) {</span>
<span class="nc" id="L1154">            return null;</span>
        } else {
<span class="nc" id="L1156">            return address;</span>
        }
    }

    /**
     * Show a progress icon on the action bar
     *
     * @param visible show or hide the progress icon based
     */
    private void showProgress(Boolean visible) {
<span class="nc" id="L1166">        InfrastructureIssueActivity activity = ((InfrastructureIssueActivity) getActivity());</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">        if (activity != null) {</span>
<span class="nc" id="L1168">            activity.showProgress(visible);</span>
        }
<span class="nc" id="L1170">    }</span>

    /**
     * Show a progress dialog on the screen
     *
     * @param visible show or hide the progress icon based
     */
    private void showProgressDialog(boolean visible) {
<span class="nc bnc" id="L1178" title="All 2 branches missed.">        if (visible) {</span>
<span class="nc" id="L1179">            mIsProgressDialogShowing = true;</span>
<span class="nc" id="L1180">            mProgressDialog = new ProgressDialog(getActivity());</span>
<span class="nc" id="L1181">            mProgressDialog.setMessage(getActivity().getString(R.string.ri_submitting_message));</span>
<span class="nc" id="L1182">            mProgressDialog.setIndeterminate(true);</span>
<span class="nc" id="L1183">            mProgressDialog.setCancelable(false);</span>
<span class="nc" id="L1184">            mProgressDialog.setCanceledOnTouchOutside(false);</span>
<span class="nc" id="L1185">            mProgressDialog.setButton(ProgressDialog.BUTTON_NEGATIVE, &quot;Cancel&quot;,</span>
<span class="nc" id="L1186">                    new DialogInterface.OnClickListener() {</span>
                        @Override
                        public void onClick(DialogInterface dialogInterface, int i) {
<span class="nc bnc" id="L1189" title="All 2 branches missed.">                            if (mRequestTask != null) {</span>
<span class="nc" id="L1190">                                mRequestTask.cancel(true);</span>
                            }
<span class="nc" id="L1192">                            mIsProgressDialogShowing = false;</span>
<span class="nc" id="L1193">                            mProgressDialog.dismiss();</span>
<span class="nc" id="L1194">                        }</span>
                    });
<span class="nc" id="L1196">            mProgressDialog.show();</span>
<span class="nc bnc" id="L1197" title="All 6 branches missed.">        } else if (mProgressDialog != null &amp;&amp; !visible &amp;&amp; mProgressDialog.isShowing()) {</span>
<span class="nc" id="L1198">            mIsProgressDialogShowing = false;</span>
<span class="nc" id="L1199">            mProgressDialog.dismiss();</span>
        }
<span class="nc" id="L1201">    }</span>

    private boolean isActivityAttached() {
<span class="nc bnc" id="L1204" title="All 2 branches missed.">        return getActivity() != null;</span>
    }

    public void setOpen311(Open311 open311) {
<span class="nc" id="L1208">        mOpen311 = open311;</span>
<span class="nc" id="L1209">    }</span>

    public void setService(Service service) {
<span class="nc" id="L1212">        mService = service;</span>
<span class="nc" id="L1213">    }</span>

    public void setArrivalInfo(ObaArrivalInfo arrivalInfo) {
<span class="nc" id="L1216">        mArrivalInfo = arrivalInfo;</span>
<span class="nc" id="L1217">    }</span>

    public void setAgencyName(String agencyName) {
<span class="nc" id="L1220">        this.mAgencyName = agencyName;</span>
<span class="nc" id="L1221">    }</span>

    public void setBlockId(String blockId) {
<span class="nc" id="L1224">        mBlockId = blockId;</span>
<span class="nc" id="L1225">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>