<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.github.pockethub.android.util</a> &gt; <span class="el_source">ImageUtils.java</span></div><h1>ImageUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 PocketHub
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.pockethub.android.util;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.BitmapFactory.Options;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Point;
import android.graphics.PorterDuffXfermode;
import android.graphics.RectF;
import android.util.Log;
import android.widget.ImageView;

import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;

import static android.graphics.Bitmap.Config.ARGB_8888;
import static android.graphics.Color.WHITE;
import static android.graphics.PorterDuff.Mode.DST_IN;

/**
 * Image utilities
 */
<span class="nc" id="L40">public class ImageUtils {</span>

    private static final String TAG = &quot;ImageUtils&quot;;

    /**
     * Get a bitmap from the image path
     *
     * @param imagePath
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final String imagePath) {
<span class="nc" id="L51">        return getBitmap(imagePath, 1);</span>
    }

    /**
     * Get a bitmap from the image path
     *
     * @param imagePath
     * @param sampleSize
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final String imagePath, int sampleSize) {
<span class="nc" id="L62">        final Options options = new Options();</span>
<span class="nc" id="L63">        options.inDither = false;</span>
<span class="nc" id="L64">        options.inSampleSize = sampleSize;</span>

<span class="nc" id="L66">        RandomAccessFile file = null;</span>
        try {
<span class="nc" id="L68">            file = new RandomAccessFile(imagePath, &quot;r&quot;);</span>
<span class="nc" id="L69">            return BitmapFactory.decodeFileDescriptor(file.getFD(), null,</span>
                    options);
<span class="nc" id="L71">        } catch (IOException e) {</span>
<span class="nc" id="L72">            Log.d(TAG, e.getMessage(), e);</span>
<span class="nc" id="L73">            return null;</span>
        } finally {
<span class="nc bnc" id="L75" title="All 6 branches missed.">            if (file != null) {</span>
                try {
<span class="nc" id="L77">                    file.close();</span>
<span class="nc" id="L78">                } catch (IOException e) {</span>
<span class="nc" id="L79">                    Log.d(TAG, e.getMessage(), e);</span>
<span class="nc" id="L80">                }</span>
            }
<span class="nc" id="L82">        }</span>
    }

    /**
     * Get a bitmap from the image
     *
     * @param image
     * @param sampleSize
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final byte[] image, int sampleSize) {
<span class="nc" id="L93">        final Options options = new Options();</span>
<span class="nc" id="L94">        options.inDither = false;</span>
<span class="nc" id="L95">        options.inSampleSize = sampleSize;</span>
<span class="nc" id="L96">        return BitmapFactory.decodeByteArray(image, 0, image.length, options);</span>
    }

    /**
     * Get scale for image of size and max height/width
     *
     * @param size
     * @param width
     * @param height
     * @return scale
     */
    public static int getScale(Point size, int width, int height) {
<span class="nc bnc" id="L108" title="All 4 branches missed.">        if (size.x &gt; width || size.y &gt; height) {</span>
<span class="nc" id="L109">            return Math.max(Math.round((float) size.y / (float) height),</span>
<span class="nc" id="L110">                    Math.round((float) size.x / (float) width));</span>
        } else {
<span class="nc" id="L112">            return 1;</span>
        }
    }

    /**
     * Get size of image
     *
     * @param imagePath
     * @return size
     */
    public static Point getSize(final String imagePath) {
<span class="nc" id="L123">        final Options options = new Options();</span>
<span class="nc" id="L124">        options.inJustDecodeBounds = true;</span>

<span class="nc" id="L126">        RandomAccessFile file = null;</span>
        try {
<span class="nc" id="L128">            file = new RandomAccessFile(imagePath, &quot;r&quot;);</span>
<span class="nc" id="L129">            BitmapFactory.decodeFileDescriptor(file.getFD(), null, options);</span>
<span class="nc" id="L130">            return new Point(options.outWidth, options.outHeight);</span>
<span class="nc" id="L131">        } catch (IOException e) {</span>
<span class="nc" id="L132">            Log.d(TAG, e.getMessage(), e);</span>
<span class="nc" id="L133">            return null;</span>
        } finally {
<span class="nc bnc" id="L135" title="All 6 branches missed.">            if (file != null) {</span>
                try {
<span class="nc" id="L137">                    file.close();</span>
<span class="nc" id="L138">                } catch (IOException e) {</span>
<span class="nc" id="L139">                    Log.d(TAG, e.getMessage(), e);</span>
<span class="nc" id="L140">                }</span>
            }
<span class="nc" id="L142">        }</span>
    }

    /**
     * Get size of image
     *
     * @param image
     * @return size
     */
    public static Point getSize(final byte[] image) {
<span class="nc" id="L152">        final Options options = new Options();</span>
<span class="nc" id="L153">        options.inJustDecodeBounds = true;</span>
<span class="nc" id="L154">        BitmapFactory.decodeByteArray(image, 0, image.length, options);</span>
<span class="nc" id="L155">        return new Point(options.outWidth, options.outHeight);</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param imagePath
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final String imagePath, int width, int height) {
<span class="nc" id="L167">        Point size = getSize(imagePath);</span>
<span class="nc" id="L168">        return getBitmap(imagePath, getScale(size, width, height));</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param image
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final byte[] image, int width, int height) {
<span class="nc" id="L180">        Point size = getSize(image);</span>
<span class="nc" id="L181">        return getBitmap(image, getScale(size, width, height));</span>
    }

    /**
     * Get bitmap with maximum height or width
     *
     * @param image
     * @param width
     * @param height
     * @return image
     */
    public static Bitmap getBitmap(final File image, int width, int height) {
<span class="nc" id="L193">        return getBitmap(image.getAbsolutePath(), width, height);</span>
    }

    /**
     * Get a bitmap from the image file
     *
     * @param image
     * @return bitmap or null if read fails
     */
    public static Bitmap getBitmap(final File image) {
<span class="nc" id="L203">        return getBitmap(image.getAbsolutePath());</span>
    }

    /**
     * Load a {@link Bitmap} from the given path and set it on the given
     * {@link ImageView}
     *
     * @param imagePath
     * @param view
     */
    public static void setImage(final String imagePath, final ImageView view) {
<span class="nc" id="L214">        setImage(new File(imagePath), view);</span>
<span class="nc" id="L215">    }</span>

    /**
     * Load a {@link Bitmap} from the given {@link File} and set it on the given
     * {@link ImageView}
     *
     * @param image
     * @param view
     */
    public static void setImage(final File image, final ImageView view) {
<span class="nc" id="L225">        Bitmap bitmap = getBitmap(image);</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (bitmap != null) {</span>
<span class="nc" id="L227">            view.setImageBitmap(bitmap);</span>
        }
<span class="nc" id="L229">    }</span>

    /**
     * Round the corners of a {@link Bitmap}
     *
     * @param source
     * @param radius
     * @return rounded corner bitmap
     */
    public static Bitmap roundCorners(final Bitmap source, final float radius) {
<span class="nc" id="L239">        int width = source.getWidth();</span>
<span class="nc" id="L240">        int height = source.getHeight();</span>

<span class="nc" id="L242">        Paint paint = new Paint();</span>
<span class="nc" id="L243">        paint.setAntiAlias(true);</span>
<span class="nc" id="L244">        paint.setColor(WHITE);</span>

<span class="nc" id="L246">        Bitmap clipped = Bitmap.createBitmap(width, height, ARGB_8888);</span>
<span class="nc" id="L247">        Canvas canvas = new Canvas(clipped);</span>
<span class="nc" id="L248">        canvas.drawRoundRect(new RectF(0, 0, width, height), radius, radius,</span>
                paint);
<span class="nc" id="L250">        paint.setXfermode(new PorterDuffXfermode(DST_IN));</span>

<span class="nc" id="L252">        Bitmap rounded = Bitmap.createBitmap(width, height, ARGB_8888);</span>
<span class="nc" id="L253">        canvas = new Canvas(rounded);</span>
<span class="nc" id="L254">        canvas.drawBitmap(source, 0, 0, null);</span>
<span class="nc" id="L255">        canvas.drawBitmap(clipped, 0, 0, paint);</span>

<span class="nc" id="L257">        source.recycle();</span>
<span class="nc" id="L258">        clipped.recycle();</span>

<span class="nc" id="L260">        return rounded;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.6.1</div></body></html>