<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HtmlUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.github.pockethub.android.util</a> &gt; <span class="el_source">HtmlUtils.java</span></div><h1>HtmlUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 PocketHub
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.pockethub.android.util;

import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Paint.Style;
import android.text.Editable;
import android.text.Html;
import android.text.Html.ImageGetter;
import android.text.Html.TagHandler;
import android.text.Layout;
import android.text.Spanned;
import android.text.TextUtils;
import android.text.style.LeadingMarginSpan;
import android.text.style.QuoteSpan;
import android.text.style.StrikethroughSpan;
import android.text.style.TypefaceSpan;

import org.xml.sax.XMLReader;

import java.util.LinkedList;

import static android.graphics.Paint.Style.FILL;
import static android.text.Spanned.SPAN_EXCLUSIVE_EXCLUSIVE;
import static android.text.Spanned.SPAN_MARK_MARK;

/**
 * HTML Utilities
 */
<span class="nc" id="L44">public class HtmlUtils {</span>

<span class="nc" id="L46">    private static class ReplySpan implements LeadingMarginSpan {</span>

<span class="nc" id="L48">        private final int color = 0xffDDDDDD;</span>

        @Override
        public int getLeadingMargin(boolean first) {
<span class="nc" id="L52">            return 18;</span>
        }

        @Override
        public void drawLeadingMargin(Canvas c, Paint p, int x, int dir,
                                      int top, int baseline, int bottom, CharSequence text,
                                      int start, int end, boolean first, Layout layout) {
<span class="nc" id="L59">            final Style style = p.getStyle();</span>
<span class="nc" id="L60">            final int color = p.getColor();</span>

<span class="nc" id="L62">            p.setStyle(FILL);</span>
<span class="nc" id="L63">            p.setColor(this.color);</span>

<span class="nc" id="L65">            c.drawRect(x, top, x + dir * 6, bottom, p);</span>

<span class="nc" id="L67">            p.setStyle(style);</span>
<span class="nc" id="L68">            p.setColor(color);</span>
<span class="nc" id="L69">        }</span>
    }

    private static final String TAG_ROOT = &quot;githubroot&quot;;

    private static final String ROOT_START = '&lt;' + TAG_ROOT + '&gt;';

    private static final String ROOT_END = &quot;&lt;/&quot; + TAG_ROOT + '&gt;';

    private static final String TOGGLE_START = &quot;&lt;span class=\&quot;email-hidden-toggle\&quot;&gt;&quot;;

    private static final String TOGGLE_END = &quot;&lt;/span&gt;&quot;;

    private static final String REPLY_START = &quot;&lt;div class=\&quot;email-quoted-reply\&quot;&gt;&quot;;

    private static final String REPLY_END = &quot;&lt;/div&gt;&quot;;

    private static final String SIGNATURE_START = &quot;&lt;div class=\&quot;email-signature-reply\&quot;&gt;&quot;;

    private static final String SIGNATURE_END = &quot;&lt;/div&gt;&quot;;

    private static final String EMAIL_START = &quot;&lt;div class=\&quot;email-fragment\&quot;&gt;&quot;;

    private static final String EMAIL_END = &quot;&lt;/div&gt;&quot;;

    private static final String HIDDEN_REPLY_START = &quot;&lt;div class=\&quot;email-hidden-reply\&quot; style=\&quot; display:none\&quot;&gt;&quot;;

    private static final String HIDDEN_REPLY_END = &quot;&lt;/div&gt;&quot;;

    private static final String BREAK = &quot;&lt;br&gt;&quot;;

    private static final String PARAGRAPH_START = &quot;&lt;p&gt;&quot;;

    private static final String PARAGRAPH_END = &quot;&lt;/p&gt;&quot;;

    private static final String BLOCKQUOTE_START = &quot;&lt;blockquote&gt;&quot;;

    private static final String BLOCKQUOTE_END = &quot;&lt;/blockquote&gt;&quot;;

    private static final String SPACE = &quot;&amp;nbsp;&quot;;

    private static final String PRE_START = &quot;&lt;pre&gt;&quot;;

    private static final String PRE_END = &quot;&lt;/pre&gt;&quot;;

    private static final String CODE_START = &quot;&lt;code&gt;&quot;;

    private static final String CODE_END = &quot;&lt;/code&gt;&quot;;

    private static class ListSeparator {

        private int count;

<span class="nc" id="L122">        public ListSeparator(boolean ordered) {</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">            count = ordered ? 1 : -1;</span>
<span class="nc" id="L124">        }</span>

        public ListSeparator append(Editable output, int indentLevel) {
<span class="nc" id="L127">            output.append('\n');</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">            for (int i = 0; i &lt; indentLevel * 2; i++) {</span>
<span class="nc" id="L129">                output.append(' ');</span>
            }
<span class="nc bnc" id="L131" title="All 2 branches missed.">            if (count != -1) {</span>
<span class="nc" id="L132">                output.append(Integer.toString(count)).append('.');</span>
<span class="nc" id="L133">                count++;</span>
            } else {
<span class="nc" id="L135">                output.append('\u2022');</span>
            }
<span class="nc" id="L137">            output.append(' ').append(' ');</span>
<span class="nc" id="L138">            return this;</span>
        }
    }

<span class="nc" id="L142">    private static final TagHandler TAG_HANDLER = new TagHandler() {</span>

        private static final String TAG_DEL = &quot;del&quot;;

        private static final String TAG_UL = &quot;ul&quot;;

        private static final String TAG_OL = &quot;ol&quot;;

        private static final String TAG_LI = &quot;li&quot;;

        private static final String TAG_CODE = &quot;code&quot;;

        private static final String TAG_PRE = &quot;pre&quot;;

        private int indentLevel;

<span class="nc" id="L158">        private final LinkedList&lt;ListSeparator&gt; listElements = new LinkedList&lt;&gt;();</span>

        @Override
        public void handleTag(final boolean opening, final String tag,
                              final Editable output, final XMLReader xmlReader) {
<span class="nc bnc" id="L163" title="All 2 branches missed.">            if (TAG_DEL.equalsIgnoreCase(tag)) {</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">                if (opening) {</span>
<span class="nc" id="L165">                    startSpan(new StrikethroughSpan(), output);</span>
                } else {
<span class="nc" id="L167">                    endSpan(StrikethroughSpan.class, output);</span>
                }
<span class="nc" id="L169">                return;</span>
            }

<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (TAG_UL.equalsIgnoreCase(tag)) {</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">                if (opening) {</span>
<span class="nc" id="L174">                    listElements.addFirst(new ListSeparator(false));</span>
<span class="nc" id="L175">                    indentLevel++;</span>
                } else {
<span class="nc" id="L177">                    listElements.removeFirst();</span>
<span class="nc" id="L178">                    indentLevel--;</span>
                }

<span class="nc bnc" id="L181" title="All 4 branches missed.">                if (!opening &amp;&amp; indentLevel == 0) {</span>
<span class="nc" id="L182">                    output.append('\n');</span>
                }
<span class="nc" id="L184">                return;</span>
            }

<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (TAG_OL.equalsIgnoreCase(tag)) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                if (opening) {</span>
<span class="nc" id="L189">                    listElements.addFirst(new ListSeparator(true));</span>
<span class="nc" id="L190">                    indentLevel++;</span>
                } else {
<span class="nc" id="L192">                    listElements.removeFirst();</span>
<span class="nc" id="L193">                    indentLevel--;</span>
                }
<span class="nc bnc" id="L195" title="All 4 branches missed.">                if (!opening &amp;&amp; indentLevel == 0) {</span>
<span class="nc" id="L196">                    output.append('\n');</span>
                }
<span class="nc" id="L198">                return;</span>
            }

<span class="nc bnc" id="L201" title="All 4 branches missed.">            if (TAG_LI.equalsIgnoreCase(tag) &amp;&amp; opening) {</span>
<span class="nc" id="L202">                listElements.getFirst().append(output, indentLevel);</span>
<span class="nc" id="L203">                return;</span>
            }

<span class="nc bnc" id="L206" title="All 2 branches missed.">            if (TAG_CODE.equalsIgnoreCase(tag)) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">                if (opening) {</span>
<span class="nc" id="L208">                    startSpan(new TypefaceSpan(&quot;monospace&quot;), output);</span>
                } else {
<span class="nc" id="L210">                    endSpan(TypefaceSpan.class, output);</span>
                }
<span class="nc" id="L212">                return;</span>
            }

<span class="nc bnc" id="L215" title="All 2 branches missed.">            if (TAG_PRE.equalsIgnoreCase(tag)) {</span>
<span class="nc" id="L216">                output.append('\n');</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">                if (opening) {</span>
<span class="nc" id="L218">                    startSpan(new TypefaceSpan(&quot;monospace&quot;), output);</span>
                } else {
<span class="nc" id="L220">                    endSpan(TypefaceSpan.class, output);</span>
                }
<span class="nc" id="L222">                return;</span>
            }

<span class="nc bnc" id="L225" title="All 4 branches missed.">            if (TAG_ROOT.equalsIgnoreCase(tag) &amp;&amp; !opening) {</span>
                // Remove leading newlines
<span class="nc bnc" id="L227" title="All 4 branches missed.">                while (output.length() &gt; 0 &amp;&amp; output.charAt(0) == '\n') {</span>
<span class="nc" id="L228">                    output.delete(0, 1);</span>
                }

                // Remove trailing newlines
<span class="nc" id="L232">                int last = output.length() - 1;</span>
<span class="nc bnc" id="L233" title="All 4 branches missed.">                while (last &gt;= 0 &amp;&amp; output.charAt(last) == '\n') {</span>
<span class="nc" id="L234">                    output.delete(last, last + 1);</span>
<span class="nc" id="L235">                    last = output.length() - 1;</span>
                }

<span class="nc" id="L238">                QuoteSpan[] quoteSpans = output.getSpans(0, output.length(),</span>
                        QuoteSpan.class);
<span class="nc bnc" id="L240" title="All 2 branches missed.">                for (QuoteSpan span : quoteSpans) {</span>
<span class="nc" id="L241">                    int start = output.getSpanStart(span);</span>
<span class="nc" id="L242">                    int end = output.getSpanEnd(span);</span>
<span class="nc" id="L243">                    output.removeSpan(span);</span>
<span class="nc" id="L244">                    output.setSpan(new ReplySpan(), start, end,</span>
                            SPAN_EXCLUSIVE_EXCLUSIVE);
                }
            }
<span class="nc" id="L248">        }</span>
    };

    private static Object getLast(final Spanned text, final Class&lt;?&gt; kind) {
<span class="nc" id="L252">        Object[] spans = text.getSpans(0, text.length(), kind);</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">        return spans.length &gt; 0 ? spans[spans.length - 1] : null;</span>
    }

    private static void startSpan(Object span, Editable output) {
<span class="nc" id="L257">        int length = output.length();</span>
<span class="nc" id="L258">        output.setSpan(span, length, length, SPAN_MARK_MARK);</span>
<span class="nc" id="L259">    }</span>

    private static void endSpan(Class&lt;?&gt; type, Editable output) {
<span class="nc" id="L262">        int length = output.length();</span>
<span class="nc" id="L263">        Object span = getLast(output, type);</span>
<span class="nc" id="L264">        int start = output.getSpanStart(span);</span>
<span class="nc" id="L265">        output.removeSpan(span);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (start != length) {</span>
<span class="nc" id="L267">            output.setSpan(span, start, length, SPAN_EXCLUSIVE_EXCLUSIVE);</span>
        }
<span class="nc" id="L269">    }</span>

    /**
     * Encode HTML
     *
     * @param html
     * @return html
     */
    public static CharSequence encode(final String html) {
<span class="nc" id="L278">        return encode(html, null);</span>
    }

    /**
     * Encode HTML
     *
     * @param html
     * @param imageGetter
     * @return html
     */
    public static CharSequence encode(final String html,
                                      final ImageGetter imageGetter) {
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (TextUtils.isEmpty(html)) {</span>
<span class="nc" id="L291">            return &quot;&quot;;</span>
        }

<span class="nc" id="L294">        return Html.fromHtml(html, imageGetter, TAG_HANDLER);</span>
    }

    /**
     * Format given HTML string so it is ready to be presented in a text view
     *
     * @param html
     * @return formatted HTML
     */
    public static final CharSequence format(final String html) {
<span class="nc bnc" id="L304" title="All 2 branches missed.">        if (html == null) {</span>
<span class="nc" id="L305">            return &quot;&quot;;</span>
        }
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (html.length() == 0) {</span>
<span class="nc" id="L308">            return &quot;&quot;;</span>
        }

<span class="nc" id="L311">        StringBuilder formatted = new StringBuilder(html);</span>

        // Remove e-mail toggle link
<span class="nc" id="L314">        strip(formatted, TOGGLE_START, TOGGLE_END);</span>

        // Remove signature
<span class="nc" id="L317">        strip(formatted, SIGNATURE_START, SIGNATURE_END);</span>

        // Replace div with e-mail content with block quote
<span class="nc" id="L320">        replace(formatted, REPLY_START, REPLY_END, BLOCKQUOTE_START,</span>
                BLOCKQUOTE_END);

        // Remove hidden div
<span class="nc" id="L324">        strip(formatted, HIDDEN_REPLY_START, HIDDEN_REPLY_END);</span>

        // Replace paragraphs with breaks
<span class="nc bnc" id="L327" title="All 2 branches missed.">        if (replace(formatted, PARAGRAPH_START, BREAK)) {</span>
<span class="nc" id="L328">            replace(formatted, PARAGRAPH_END, BREAK);</span>
        }

<span class="nc" id="L331">        formatPres(formatted);</span>

<span class="nc" id="L333">        formatEmailFragments(formatted);</span>

<span class="nc" id="L335">        trim(formatted);</span>

<span class="nc" id="L337">        formatted.insert(0, ROOT_START);</span>
<span class="nc" id="L338">        formatted.append(ROOT_END);</span>

<span class="nc" id="L340">        return formatted;</span>
    }

    private static StringBuilder strip(final StringBuilder input,
                                       final String prefix, final String suffix) {
<span class="nc" id="L345">        int start = input.indexOf(prefix);</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">        while (start != -1) {</span>
<span class="nc" id="L347">            int end = input.indexOf(suffix, start + prefix.length());</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">            if (end == -1) {</span>
<span class="nc" id="L349">                end = input.length();</span>
            }
<span class="nc" id="L351">            input.delete(start, end + suffix.length());</span>
<span class="nc" id="L352">            start = input.indexOf(prefix, start);</span>
<span class="nc" id="L353">        }</span>
<span class="nc" id="L354">        return input;</span>
    }

    private static boolean replace(final StringBuilder input,
                                   final String from, final String to) {
<span class="nc" id="L359">        int start = input.indexOf(from);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if (start == -1) {</span>
<span class="nc" id="L361">            return false;</span>
        }

<span class="nc" id="L364">        final int fromLength = from.length();</span>
<span class="nc" id="L365">        final int toLength = to.length();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">        while (start != -1) {</span>
<span class="nc" id="L367">            input.replace(start, start + fromLength, to);</span>
<span class="nc" id="L368">            start = input.indexOf(from, start + toLength);</span>
        }
<span class="nc" id="L370">        return true;</span>
    }

    private static void replaceTag(final StringBuilder input,
                                   final String from, final String to) {
<span class="nc bnc" id="L375" title="All 2 branches missed.">        if (replace(input, '&lt;' + from + '&gt;', '&lt;' + to + '&gt;')) {</span>
<span class="nc" id="L376">            replace(input, &quot;&lt;/&quot; + from + '&gt;', &quot;&lt;/&quot; + to + '&gt;');</span>
        }
<span class="nc" id="L378">    }</span>

    private static StringBuilder replace(final StringBuilder input,
                                         final String fromStart, final String fromEnd, final String toStart,
                                         final String toEnd) {
<span class="nc" id="L383">        int start = input.indexOf(fromStart);</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (start == -1) {</span>
<span class="nc" id="L385">            return input;</span>
        }

<span class="nc" id="L388">        final int fromStartLength = fromStart.length();</span>
<span class="nc" id="L389">        final int fromEndLength = fromEnd.length();</span>
<span class="nc" id="L390">        final int toStartLength = toStart.length();</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">        while (start != -1) {</span>
<span class="nc" id="L392">            input.replace(start, start + fromStartLength, toStart);</span>
<span class="nc" id="L393">            int end = input.indexOf(fromEnd, start + toStartLength);</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">            if (end != -1) {</span>
<span class="nc" id="L395">                input.replace(end, end + fromEndLength, toEnd);</span>
            }

<span class="nc" id="L398">            start = input.indexOf(fromStart);</span>
<span class="nc" id="L399">        }</span>
<span class="nc" id="L400">        return input;</span>
    }

    private static StringBuilder formatPres(final StringBuilder input) {
<span class="nc" id="L404">        int start = input.indexOf(PRE_START);</span>
<span class="nc" id="L405">        final int spaceAdvance = SPACE.length() - 1;</span>
<span class="nc" id="L406">        final int breakAdvance = BREAK.length() - 1;</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">        while (start != -1) {</span>
<span class="nc" id="L408">            int end = input.indexOf(PRE_END, start + PRE_START.length());</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            if (end == -1) {</span>
<span class="nc" id="L410">                break;</span>
            }

            // Skip over code element
<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (input.indexOf(CODE_START, start) == start) {</span>
<span class="nc" id="L415">                start += CODE_START.length();</span>
            }
<span class="nc bnc" id="L417" title="All 2 branches missed.">            if (input.indexOf(CODE_END, start) == end - CODE_END.length()) {</span>
<span class="nc" id="L418">                end -= CODE_END.length();</span>
            }

<span class="nc bnc" id="L421" title="All 2 branches missed.">            for (int i = start; i &lt; end; i++) {</span>
<span class="nc bnc" id="L422" title="All 4 branches missed.">                switch (input.charAt(i)) {</span>
                    case ' ':
<span class="nc" id="L424">                        input.deleteCharAt(i);</span>
<span class="nc" id="L425">                        input.insert(i, SPACE);</span>
<span class="nc" id="L426">                        start += spaceAdvance;</span>
<span class="nc" id="L427">                        end += spaceAdvance;</span>
<span class="nc" id="L428">                        break;</span>
                    case '\t':
<span class="nc" id="L430">                        input.deleteCharAt(i);</span>
<span class="nc" id="L431">                        input.insert(i, SPACE);</span>
<span class="nc" id="L432">                        start += spaceAdvance;</span>
<span class="nc" id="L433">                        end += spaceAdvance;</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">                        for (int j = 0; j &lt; 3; j++) {</span>
<span class="nc" id="L435">                            input.insert(i, SPACE);</span>
<span class="nc" id="L436">                            start += spaceAdvance + 1;</span>
<span class="nc" id="L437">                            end += spaceAdvance + 1;</span>
                        }
<span class="nc" id="L439">                        break;</span>
                    case '\n':
<span class="nc" id="L441">                        input.deleteCharAt(i);</span>
                        // Ignore if last character is a newline
<span class="nc bnc" id="L443" title="All 2 branches missed.">                        if (i + 1 &lt; end) {</span>
<span class="nc" id="L444">                            input.insert(i, BREAK);</span>
<span class="nc" id="L445">                            start += breakAdvance;</span>
<span class="nc" id="L446">                            end += breakAdvance;</span>
                        }
                        break;
                }
            }
<span class="nc" id="L451">            start = input.indexOf(PRE_START, end + PRE_END.length());</span>
<span class="nc" id="L452">        }</span>
<span class="nc" id="L453">        return input;</span>
    }

    /**
     * Remove email fragment 'div' tag and replace newlines with 'br' tags
     *
     * @param input
     * @return input
     */
    private static StringBuilder formatEmailFragments(final StringBuilder input) {
<span class="nc" id="L463">        int emailStart = input.indexOf(EMAIL_START);</span>
<span class="nc" id="L464">        int breakAdvance = BREAK.length() - 1;</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">        while (emailStart != -1) {</span>
<span class="nc" id="L466">            int startLength = EMAIL_START.length();</span>
<span class="nc" id="L467">            int emailEnd = input.indexOf(EMAIL_END, emailStart + startLength);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (emailEnd == -1) {</span>
<span class="nc" id="L469">                break;</span>
            }

<span class="nc" id="L472">            input.delete(emailEnd, emailEnd + EMAIL_END.length());</span>
<span class="nc" id="L473">            input.delete(emailStart, emailStart + startLength);</span>

<span class="nc" id="L475">            int fullEmail = emailEnd - startLength;</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">            for (int i = emailStart; i &lt; fullEmail; i++) {</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">                if (input.charAt(i) == '\n') {</span>
<span class="nc" id="L478">                    input.deleteCharAt(i);</span>
<span class="nc" id="L479">                    input.insert(i, BREAK);</span>
<span class="nc" id="L480">                    i += breakAdvance;</span>
<span class="nc" id="L481">                    fullEmail += breakAdvance;</span>
                }
            }

<span class="nc" id="L485">            emailStart = input.indexOf(EMAIL_START, fullEmail);</span>
<span class="nc" id="L486">        }</span>
<span class="nc" id="L487">        return input;</span>
    }

    /**
     * Remove leading and trailing whitespace
     *
     * @param input
     */
    private static StringBuilder trim(final StringBuilder input) {
<span class="nc" id="L496">        int length = input.length();</span>
<span class="nc" id="L497">        int breakLength = BREAK.length();</span>

<span class="nc bnc" id="L499" title="All 2 branches missed.">        while (length &gt; 0) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">            if (input.indexOf(BREAK) == 0) {</span>
<span class="nc" id="L501">                input.delete(0, breakLength);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">            } else if (length &gt;= breakLength</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">                    &amp;&amp; input.lastIndexOf(BREAK) == length - breakLength) {</span>
<span class="nc" id="L504">                input.delete(length - breakLength, length);</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">            } else if (Character.isWhitespace(input.charAt(0))) {</span>
<span class="nc" id="L506">                input.deleteCharAt(0);</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">            } else if (Character.isWhitespace(input.charAt(length - 1))) {</span>
<span class="nc" id="L508">                input.deleteCharAt(length - 1);</span>
            } else {
                break;
            }
<span class="nc" id="L512">            length = input.length();</span>
        }
<span class="nc" id="L514">        return input;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.6.1</div></body></html>