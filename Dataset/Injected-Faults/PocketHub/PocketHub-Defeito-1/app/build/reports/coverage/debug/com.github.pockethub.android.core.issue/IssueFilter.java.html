<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IssueFilter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.github.pockethub.android.core.issue</a> &gt; <span class="el_source">IssueFilter.java</span></div><h1>IssueFilter.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 PocketHub
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.pockethub.android.core.issue;

import android.os.Parcel;
import android.os.Parcelable;
import com.meisolsson.githubsdk.model.Label;
import com.meisolsson.githubsdk.model.Milestone;
import com.meisolsson.githubsdk.model.Repository;
import com.meisolsson.githubsdk.model.User;

import java.util.*;

import static java.lang.String.CASE_INSENSITIVE_ORDER;

/**
 * Issue filter containing at least one valid query
 */
public class IssueFilter implements Parcelable, Cloneable, Comparator&lt;Label&gt; {

    /**
     * Filter field key
     */
    public static final String FIELD_FILTER = &quot;filter&quot;; 

    /**
     * Filter by issue assignee
     */
    public static final String FILTER_ASSIGNEE = &quot;assignee&quot;; 

    /**
     * Filter by issue's milestone
     */
    public static final String FILTER_MILESTONE = &quot;milestone&quot;; 

    /**
     * Filter by user mentioned in issue
     */
    public static final String FILTER_MENTIONED = &quot;mentioned&quot;; 

    /**
     * Filter by subscribed issues for user
     */
    public static final String FILTER_SUBSCRIBED = &quot;subscribed&quot;; 

    /**
     * Filter by created issues by user
     */
    public static final String FILTER_CREATED = &quot;created&quot;; 

    /**
     * Filter by assigned issues for user
     */
    public static final String FILTER_ASSIGNED = &quot;assigned&quot;; 

    /**
     * Filter by issue's labels
     */
    public static final String FILTER_LABELS = &quot;labels&quot;; 

    /**
     * Filter by issue's state
     */
    public static final String FILTER_STATE = &quot;state&quot;; 

    /**
     * Issue open state filter value
     */
    public static final String STATE_OPEN = &quot;open&quot;; 

    /**
     * Issue closed state filter value
     */
    public static final String STATE_CLOSED = &quot;closed&quot;; 

    /**
     * Issue body field name
     */
    public static final String FIELD_BODY = &quot;body&quot;; 

    /**
     * Issue title field name
     */
    public static final String FIELD_TITLE = &quot;title&quot;; 

    /**
     * Since date field
     */
    public static final String FIELD_SINCE = &quot;since&quot;; 

    /**
     * Sort direction of output
     */
    public static final String FIELD_DIRECTION = &quot;direction&quot;; 

    /**
     * Ascending direction sort order
     */
    public static final String DIRECTION_ASCENDING = &quot;asc&quot;; 

    /**
     * Descending direction sort order
     */
    public static final String DIRECTION_DESCENDING = &quot;desc&quot;; 

    /**
     * Sort field key
     */
    public static final String FIELD_SORT = &quot;sort&quot;; 

    /**
     * Sort by created at
     */
    public static final String SORT_CREATED = &quot;created&quot;; 

    /**
     * Sort by updated at
     */
    public static final String SORT_UPDATED = &quot;updated&quot;; 

    /**
     * Sort by commented on at
     */
    public static final String SORT_COMMENTS = &quot;comments&quot;;

    private final Repository repository;

    private final String id;

<span class="nc" id="L143">    private List&lt;Label&gt; labels = new ArrayList&lt;&gt;();</span>

    private Milestone milestone;

    private User assignee;

    private boolean open;

    private String direction;

    private String sortType;

    /**
     * Create filter
     *
     * @param repository
     */
<span class="nc" id="L160">    public IssueFilter(final Repository repository, String id) {</span>
<span class="nc" id="L161">        this.id = id;</span>
<span class="nc" id="L162">        this.repository = repository;</span>
<span class="nc" id="L163">        open = true;</span>
<span class="nc" id="L164">        direction = DIRECTION_DESCENDING;</span>
<span class="nc" id="L165">        sortType = SORT_CREATED;</span>
<span class="nc" id="L166">    }</span>

<span class="nc" id="L168">    protected IssueFilter(Parcel in) {</span>
<span class="nc" id="L169">        id = in.readString();</span>
<span class="nc" id="L170">        repository = in.readParcelable(Repository.class.getClassLoader());</span>
<span class="nc" id="L171">        labels = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L172">        in.readList(labels, Label.class.getClassLoader());</span>
<span class="nc" id="L173">        milestone = in.readParcelable(Milestone.class.getClassLoader());</span>
<span class="nc" id="L174">        assignee = in.readParcelable(User.class.getClassLoader());</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        open = in.readByte() != 0;</span>
<span class="nc" id="L176">        direction = in.readString();</span>
<span class="nc" id="L177">        sortType = in.readString();</span>
<span class="nc" id="L178">    }</span>

<span class="nc" id="L180">    public static final Creator&lt;IssueFilter&gt; CREATOR = new Creator&lt;IssueFilter&gt;() {</span>
        @Override
        public IssueFilter createFromParcel(Parcel in) {
<span class="nc" id="L183">            return new IssueFilter(in);</span>
        }

        @Override
        public IssueFilter[] newArray(int size) {
<span class="nc" id="L188">            return new IssueFilter[size];</span>
        }
    };

    /**
     * Set only open issues to be returned
     *
     * @param open
     *            true for open issues, false for closed issues
     * @return this filter
     */
    public IssueFilter setOpen(final boolean open) {
<span class="nc" id="L200">        this.open = open;</span>
<span class="nc" id="L201">        return this;</span>
    }

    /**
     * Add label to filter
     *
     * @param label
     * @return this filter
     */
    public IssueFilter addLabel(Label label) {
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (label == null) {</span>
<span class="nc" id="L212">            return this;</span>
        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (labels == null) {</span>
<span class="nc" id="L215">            labels = new ArrayList&lt;&gt;();</span>
        }
<span class="nc" id="L217">        labels.add(label);</span>
<span class="nc" id="L218">        return this;</span>
    }

    /**
     * @param labels
     * @return this filter
     */
    public IssueFilter setLabels(Collection&lt;Label&gt; labels) {
<span class="nc bnc" id="L226" title="All 4 branches missed.">        if (labels != null &amp;&amp; !labels.isEmpty()) {</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">            if (this.labels == null) {</span>
<span class="nc" id="L228">                this.labels = new ArrayList&lt;&gt;();</span>
            } else {
<span class="nc" id="L230">                this.labels.clear();</span>
            }
<span class="nc" id="L232">            this.labels.addAll(labels);</span>
        } else {
<span class="nc" id="L234">            this.labels = null;</span>
        }
<span class="nc" id="L236">        return this;</span>
    }

    /**
     * @return labels
     */
    public List&lt;Label&gt; getLabels() {
<span class="nc" id="L243">        return labels;</span>
    }

    /**
     * @return repository
     */
    public Repository getRepository() {
<span class="nc" id="L250">        return repository;</span>
    }

    /**
     * @param milestone
     * @return this filter
     */
    public IssueFilter setMilestone(Milestone milestone) {
<span class="nc" id="L258">        this.milestone = milestone;</span>
<span class="nc" id="L259">        return this;</span>
    }

    /**
     * @return milestone
     */
    public Milestone getMilestone() {
<span class="nc" id="L266">        return milestone;</span>
    }

    /**
     * @param assignee
     * @return this filter
     */
    public IssueFilter setAssignee(User assignee) {
<span class="nc" id="L274">        this.assignee = assignee;</span>
<span class="nc" id="L275">        return this;</span>
    }

    /**
     * @param direction Can be either {@value DIRECTION_ASCENDING} or {@value DIRECTION_ASCENDING}.
     * @return this filter
     */
    public IssueFilter setDirection(String direction) {
<span class="nc" id="L283">        this.direction = direction;</span>
<span class="nc" id="L284">        return this;</span>
    }

    /**
     * @param sortType Can be either {@value SORT_COMMENTS}, {@value SORT_CREATED}
     *                 or {@value SORT_UPDATED}.
     * @return this filter
     */
    public IssueFilter setSortType(String sortType) {
<span class="nc" id="L293">        this.sortType = sortType;</span>
<span class="nc" id="L294">        return this;</span>
    }

    public String getSortType() {
<span class="nc" id="L298">        return sortType;</span>
    }

    public String getDirection() {
<span class="nc" id="L302">        return direction;</span>
    }

    /**
     * Are only open issues returned?
     *
     * @return true if open only, false if closed only
     */
    public boolean isOpen() {
<span class="nc" id="L311">        return open;</span>
    }

    /**
     * @return assignee
     */
    public User getAssignee() {
<span class="nc" id="L318">        return assignee;</span>
    }

    /**
     * Create a map of all the request parameters represented by this filter
     *
     * @return non-null map of filter request parameters
     */
    public Map&lt;String, Object&gt; toFilterMap() {
<span class="nc" id="L327">        final Map&lt;String, Object&gt; filter = new HashMap&lt;&gt;();</span>

<span class="nc" id="L329">        filter.put(FIELD_SORT, sortType);</span>
<span class="nc" id="L330">        filter.put(FIELD_DIRECTION, direction);</span>

<span class="nc bnc" id="L332" title="All 2 branches missed.">        if (assignee != null) {</span>
<span class="nc" id="L333">            filter.put(FILTER_ASSIGNEE, assignee.login());</span>
        }

<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (milestone != null) {</span>
<span class="nc" id="L337">            filter.put(FILTER_MILESTONE,</span>
<span class="nc" id="L338">                    Integer.toString(milestone.number()));</span>
        }

<span class="nc bnc" id="L341" title="All 4 branches missed.">        if (labels != null &amp;&amp; !labels.isEmpty()) {</span>
<span class="nc" id="L342">            StringBuilder labelsQuery = new StringBuilder();</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">            for (Label label : labels) {</span>
<span class="nc" id="L344">                labelsQuery.append(label.name()).append(',');</span>
<span class="nc" id="L345">            }</span>
<span class="nc" id="L346">            filter.put(FILTER_LABELS, labelsQuery.toString());</span>
        }

<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (open) {</span>
<span class="nc" id="L350">            filter.put(FILTER_STATE, STATE_OPEN);</span>
        } else {
<span class="nc" id="L352">            filter.put(FILTER_STATE, STATE_CLOSED);</span>
        }
<span class="nc" id="L354">        return filter;</span>
    }

    /**
     * Get display {@link CharSequence} representing this filter
     *
     * @return display
     */
    public CharSequence toDisplay() {
<span class="nc" id="L363">        List&lt;String&gt; segments = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (open) {</span>
<span class="nc" id="L365">            segments.add(&quot;Open issues&quot;);</span>
        } else {
<span class="nc" id="L367">            segments.add(&quot;Closed issues&quot;);</span>
        }

<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (assignee != null) {</span>
<span class="nc" id="L371">            segments.add(&quot;Assignee: &quot; + assignee.login());</span>
        }

<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (milestone != null) {</span>
<span class="nc" id="L375">            segments.add(&quot;Milestone: &quot; + milestone.title());</span>
        }

<span class="nc bnc" id="L378" title="All 4 branches missed.">        if (labels != null &amp;&amp; !labels.isEmpty()) {</span>
<span class="nc" id="L379">            StringBuilder builder = new StringBuilder(&quot;Labels: &quot;);</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">            for (Label label : labels) {</span>
<span class="nc" id="L381">                builder.append(label.name()).append(',').append(' ');</span>
<span class="nc" id="L382">            }</span>
<span class="nc" id="L383">            builder.deleteCharAt(builder.length() - 1);</span>
<span class="nc" id="L384">            builder.deleteCharAt(builder.length() - 1);</span>
<span class="nc" id="L385">            segments.add(builder.toString());</span>
        }

<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (segments.isEmpty()) {</span>
<span class="nc" id="L389">            return &quot;&quot;;</span>
        }

<span class="nc" id="L392">        StringBuilder all = new StringBuilder();</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">        for (String segment : segments) {</span>
<span class="nc" id="L394">            all.append(segment).append(',').append(' ');</span>
<span class="nc" id="L395">        }</span>
<span class="nc" id="L396">        all.deleteCharAt(all.length() - 1);</span>
<span class="nc" id="L397">        all.deleteCharAt(all.length() - 1);</span>
<span class="nc" id="L398">        return all;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L403">        return Arrays.hashCode(new Object[] { open,</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">                assignee != null ? assignee.id() : null,</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                milestone != null ? milestone.number() : null,</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">                assignee != null ? assignee.id() : null,</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                repository != null ? repository.id() : null,</span>
                labels, direction, sortType });
    }

    private boolean isEqual(Object a, Object b) {
<span class="nc bnc" id="L412" title="All 4 branches missed.">        if (a == null &amp;&amp; b == null) {</span>
<span class="nc" id="L413">            return true;</span>
        }
<span class="nc bnc" id="L415" title="All 4 branches missed.">        return a != null &amp;&amp; a.equals(b);</span>
    }

    private boolean isEqual(Milestone a, Milestone b) {
<span class="nc bnc" id="L419" title="All 4 branches missed.">        if (a == null &amp;&amp; b == null) {</span>
<span class="nc" id="L420">            return true;</span>
        }
<span class="nc bnc" id="L422" title="All 6 branches missed.">        return a != null &amp;&amp; b != null &amp;&amp; a.number() == b.number();</span>
    }

    private boolean isEqual(User a, User b) {
<span class="nc bnc" id="L426" title="All 4 branches missed.">        if (a == null &amp;&amp; b == null) {</span>
<span class="nc" id="L427">            return true;</span>
        }
<span class="nc bnc" id="L429" title="All 6 branches missed.">        return a != null &amp;&amp; b != null &amp;&amp; a.id() == b.id();</span>
    }

    private boolean isEqual(Repository a, Repository b) {
<span class="nc bnc" id="L433" title="All 6 branches missed.">        return a != null &amp;&amp; b != null &amp;&amp; a.id() == b.id();</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (o == this) {</span>
<span class="nc" id="L439">            return true;</span>
        }
<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (!(o instanceof IssueFilter)) {</span>
<span class="nc" id="L442">            return false;</span>
        }

<span class="nc" id="L445">        IssueFilter other = (IssueFilter) o;</span>
<span class="nc bnc" id="L446" title="All 4 branches missed.">        return open == other.open &amp;&amp; isEqual(milestone, other.milestone)</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">                &amp;&amp; isEqual(assignee, other.assignee)</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">                &amp;&amp; isEqual(repository, repository)</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">                &amp;&amp; isEqual(labels, other.labels)</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                &amp;&amp; isEqual(sortType, other.sortType)</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">                &amp;&amp; isEqual(direction, other.direction);</span>
    }

    @Override
    public IssueFilter clone() {
        try {
<span class="nc" id="L457">            return (IssueFilter) super.clone();</span>
<span class="nc" id="L458">        } catch (CloneNotSupportedException e) {</span>
            // This should never happen since this class implements Cloneable
<span class="nc" id="L460">            throw new IllegalArgumentException(e);</span>
        }
    }

    @Override
    public int compare(Label lhs, Label rhs) {
<span class="nc" id="L466">        return CASE_INSENSITIVE_ORDER.compare(lhs.name(), rhs.name());</span>
    }

    @Override
    public int describeContents() {
<span class="nc" id="L471">        return 0;</span>
    }

    @Override
    public void writeToParcel(Parcel dest, int flags) {
<span class="nc" id="L476">        dest.writeString(id);</span>
<span class="nc" id="L477">        dest.writeParcelable(repository, flags);</span>
<span class="nc" id="L478">        dest.writeList(labels);</span>
<span class="nc" id="L479">        dest.writeParcelable(milestone, flags);</span>
<span class="nc" id="L480">        dest.writeParcelable(assignee, flags);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        dest.writeByte((byte) (open ? 1 : 0));</span>
<span class="nc" id="L482">        dest.writeString(direction);</span>
<span class="nc" id="L483">        dest.writeString(sortType);</span>
<span class="nc" id="L484">    }</span>

    public String getId() {
<span class="nc" id="L487">        return id;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.6.1</div></body></html>