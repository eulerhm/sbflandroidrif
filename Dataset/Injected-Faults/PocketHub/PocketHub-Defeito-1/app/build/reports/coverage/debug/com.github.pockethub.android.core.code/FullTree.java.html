<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FullTree.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.github.pockethub.android.core.code</a> &gt; <span class="el_source">FullTree.java</span></div><h1>FullTree.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 PocketHub
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.pockethub.android.core.code;

import android.text.TextUtils;

import com.github.pockethub.android.core.commit.CommitUtils;
import com.github.pockethub.android.core.ref.RefUtils;
import com.meisolsson.githubsdk.model.git.GitEntryType;
import com.meisolsson.githubsdk.model.git.GitReference;
import com.meisolsson.githubsdk.model.git.GitTree;
import com.meisolsson.githubsdk.model.git.GitTreeEntry;

import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import static java.lang.String.CASE_INSENSITIVE_ORDER;

/**
 * {@link GitTree} with additional information
 */
public class FullTree {

    /**
     * Entry in a tree
     */
    public static class Entry implements Comparable&lt;Entry&gt; {

        /**
         * Parent folder
         */
        public final Folder parent;

        /**
         * Raw tree entry
         */
        public final GitTreeEntry entry;

        /**
         * Name
         */
        public final String name;

<span class="nc" id="L58">        private Entry() {</span>
<span class="nc" id="L59">            this.parent = null;</span>
<span class="nc" id="L60">            this.entry = null;</span>
<span class="nc" id="L61">            this.name = null;</span>
<span class="nc" id="L62">        }</span>

<span class="nc" id="L64">        private Entry(GitTreeEntry entry, Folder parent) {</span>
<span class="nc" id="L65">            this.entry = entry;</span>
<span class="nc" id="L66">            this.parent = parent;</span>
<span class="nc" id="L67">            this.name = CommitUtils.getName(entry.path());</span>
<span class="nc" id="L68">        }</span>

        public boolean isRoot() {
<span class="nc bnc" id="L71" title="All 2 branches missed.">            return parent == null;</span>
        }

        @Override
        public int compareTo(Entry another) {
<span class="nc" id="L76">            return CASE_INSENSITIVE_ORDER.compare(name, another.name);</span>
        }
    }

    /**
     * Folder in a tree
     */
    public static class Folder extends Entry {

        /**
         * Sub folders
         */
<span class="nc" id="L88">        public final Map&lt;String, Folder&gt; folders = new TreeMap&lt;&gt;();</span>

        /**
         * Files
         */
<span class="nc" id="L93">        public final Map&lt;String, Entry&gt; files = new TreeMap&lt;&gt;();</span>

        private Folder() {
<span class="nc" id="L96">            super();</span>
<span class="nc" id="L97">        }</span>

        private Folder(GitTreeEntry entry, Folder parent) {
<span class="nc" id="L100">            super(entry, parent);</span>
<span class="nc" id="L101">        }</span>

        private void addFile(GitTreeEntry entry, String[] pathSegments, int index) {
<span class="nc bnc" id="L104" title="All 2 branches missed.">            if (index == pathSegments.length - 1) {</span>
<span class="nc" id="L105">                Entry file = new Entry(entry, this);</span>
<span class="nc" id="L106">                files.put(file.name, file);</span>
<span class="nc" id="L107">            } else {</span>
<span class="nc" id="L108">                Folder folder = folders.get(pathSegments[index]);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">                if (folder != null) {</span>
<span class="nc" id="L110">                    folder.addFile(entry, pathSegments, index + 1);</span>
                }
            }
<span class="nc" id="L113">        }</span>

        private void addFolder(GitTreeEntry entry, String[] pathSegments, int index) {
<span class="nc bnc" id="L116" title="All 2 branches missed.">            if (index == pathSegments.length - 1) {</span>
<span class="nc" id="L117">                Folder folder = new Folder(entry, this);</span>
<span class="nc" id="L118">                folders.put(folder.name, folder);</span>
<span class="nc" id="L119">            } else {</span>
<span class="nc" id="L120">                Folder folder = folders.get(pathSegments[index]);</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if (folder != null) {</span>
<span class="nc" id="L122">                    folder.addFolder(entry, pathSegments, index + 1);</span>
                }
            }
<span class="nc" id="L125">        }</span>

        private void add(final GitTreeEntry entry) {
<span class="nc" id="L128">            String path = entry.path();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (TextUtils.isEmpty(path)) {</span>
<span class="nc" id="L130">                return;</span>
            }

<span class="nc bnc" id="L133" title="All 2 branches missed.">            if (entry.type() == GitEntryType.Blob) {</span>
<span class="nc" id="L134">                String[] segments = path.split(&quot;/&quot;);</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">                if (segments.length &gt; 1) {</span>
<span class="nc" id="L136">                    Folder folder = folders.get(segments[0]);</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">                    if (folder != null) {</span>
<span class="nc" id="L138">                        folder.addFile(entry, segments, 1);</span>
                    }
<span class="nc bnc" id="L140" title="All 2 branches missed.">                } else if (segments.length == 1) {</span>
<span class="nc" id="L141">                    Entry file = new Entry(entry, this);</span>
<span class="nc" id="L142">                    files.put(file.name, file);</span>
                }
<span class="nc bnc" id="L144" title="All 2 branches missed.">            } else if (entry.type() == GitEntryType.Tree) {</span>
<span class="nc" id="L145">                String[] segments = path.split(&quot;/&quot;);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                if (segments.length &gt; 1) {</span>
<span class="nc" id="L147">                    Folder folder = folders.get(segments[0]);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">                    if (folder != null) {</span>
<span class="nc" id="L149">                        folder.addFolder(entry, segments, 1);</span>
                    }
<span class="nc bnc" id="L151" title="All 2 branches missed.">                } else if (segments.length == 1) {</span>
<span class="nc" id="L152">                    Folder folder = new Folder(entry, this);</span>
<span class="nc" id="L153">                    folders.put(folder.name, folder);</span>
                }
            }
<span class="nc" id="L156">        }</span>
    }

    /**
     * Tree
     */
    public final GitTree tree;

    /**
     * Root folder
     */
    public final Folder root;

    /**
     * Reference
     */
    public final GitReference reference;

    /**
     * Branch where tree is present
     */
    public final String branch;

    /**
     * Create tree with branch
     *
     * @param tree
     * @param reference
     */
<span class="nc" id="L185">    public FullTree(final GitTree tree, final GitReference reference) {</span>
<span class="nc" id="L186">        this.tree = tree;</span>
<span class="nc" id="L187">        this.reference = reference;</span>
<span class="nc" id="L188">        this.branch = RefUtils.getName(reference);</span>

<span class="nc" id="L190">        root = new Folder();</span>
<span class="nc" id="L191">        List&lt;GitTreeEntry&gt; entries = tree.tree();</span>
<span class="nc bnc" id="L192" title="All 4 branches missed.">        if (entries != null &amp;&amp; !entries.isEmpty()) {</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">            for (GitTreeEntry entry : entries) {</span>
<span class="nc" id="L194">                root.add(entry);</span>
<span class="nc" id="L195">            }</span>
        }
<span class="nc" id="L197">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.6.1</div></body></html>