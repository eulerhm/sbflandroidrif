<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CheckBoxTriStates.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.nearby</a> &gt; <span class="el_source">CheckBoxTriStates.java</span></div><h1>CheckBoxTriStates.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.nearby;

import android.content.Context;
import android.util.AttributeSet;
import android.widget.CompoundButton;

import androidx.annotation.Nullable;
import androidx.appcompat.widget.AppCompatCheckBox;

import java.util.List;

import fr.free.nrw.commons.R;

/**
 * Base on https://stackoverflow.com/a/40939367/3950497 answer.
 */
public class CheckBoxTriStates extends AppCompatCheckBox {

    static public final int UNKNOWN = -1;

    static public final int UNCHECKED = 0;

    static public final int CHECKED = 1;

<span class="nc" id="L25">    private int state=UNKNOWN;</span>

    private Callback callback;

    public interface Callback{
        void filterByMarkerType(@Nullable List&lt;Label&gt; selectedLabels, int state, boolean b, boolean b1);
    }

    public void setCallback(Callback callback) {
<span class="nc" id="L34">        this.callback = callback;</span>
<span class="nc" id="L35">    }</span>

    /**
     * This is the listener set to the super class which is going to be evoke each
     * time the check state has changed.
     */
<span class="nc" id="L41">    private final OnCheckedChangeListener privateListener = new CompoundButton.OnCheckedChangeListener() {</span>

        // checkbox status is changed from uncheck to checked.
        public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
<span class="nc bnc" id="L45" title="All 4 branches missed.">            switch (state) {</span>
                case UNKNOWN:
<span class="nc" id="L47">                    setState(UNCHECKED);;</span>
<span class="nc" id="L48">                    break;</span>
                case UNCHECKED:
<span class="nc" id="L50">                    setState(CHECKED);</span>
<span class="nc" id="L51">                    break;</span>
                case CHECKED:
<span class="nc" id="L53">                    setState(UNKNOWN);</span>
                    break;
            }
<span class="nc" id="L56">        }</span>
    };

    /**
     * Holds a reference to the listener set by a client, if any.
     */
    private OnCheckedChangeListener clientListener;


    public CheckBoxTriStates(Context context) {
<span class="nc" id="L66">        super(context);</span>
<span class="nc" id="L67">        init();</span>
<span class="nc" id="L68">    }</span>

    public CheckBoxTriStates(Context context, AttributeSet attrs) {
<span class="nc" id="L71">        super(context, attrs);</span>
<span class="nc" id="L72">        init();</span>
<span class="nc" id="L73">    }</span>

    public CheckBoxTriStates(Context context, AttributeSet attrs, int defStyleAttr) {
<span class="nc" id="L76">        super(context, attrs, defStyleAttr);</span>
<span class="nc" id="L77">        init();</span>
<span class="nc" id="L78">    }</span>

    public int getState() {
<span class="nc" id="L81">        return state;</span>
    }

    public void setState(int state) {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if(this.state != state) {</span>
<span class="nc" id="L86">            this.state = state;</span>

<span class="nc bnc" id="L88" title="All 2 branches missed.">            if(this.clientListener != null) {</span>
<span class="nc" id="L89">                this.clientListener.onCheckedChanged(this, this.isChecked());</span>
            }

<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (NearbyController.currentLocation != null) {</span>
<span class="nc" id="L93">                callback.filterByMarkerType(null, state, false, true);</span>
            }
<span class="nc" id="L95">            updateBtn();</span>
        }
<span class="nc" id="L97">    }</span>

    @Override
    public void setOnCheckedChangeListener(@Nullable OnCheckedChangeListener listener) {

        // we never truly set the listener to the client implementation, instead we only hold
        // a reference to it and evoke it when needed.
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if(this.privateListener != listener) {</span>
<span class="nc" id="L105">            this.clientListener = listener;</span>
        }

        // always use our implementation
<span class="nc" id="L109">        super.setOnCheckedChangeListener(privateListener);</span>
<span class="nc" id="L110">    }</span>

    private void init() {
<span class="nc" id="L113">        state = UNKNOWN;</span>
<span class="nc" id="L114">        updateBtn();</span>
<span class="nc" id="L115">    }</span>

    public void addAction() {
<span class="nc" id="L118">        setOnCheckedChangeListener(this.privateListener);</span>
<span class="nc" id="L119">    }</span>

    private void updateBtn() {
<span class="nc" id="L122">        int btnDrawable = R.drawable.ic_indeterminate_check_box_black_24dp;</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">        switch (state) {</span>
            case UNKNOWN:
<span class="nc" id="L125">                btnDrawable = R.drawable.ic_indeterminate_check_box_black_24dp;</span>
<span class="nc" id="L126">                break;</span>
            case UNCHECKED:
<span class="nc" id="L128">                btnDrawable = R.drawable.ic_check_box_outline_blank_black_24dp;</span>
<span class="nc" id="L129">                break;</span>
            case CHECKED:
<span class="nc" id="L131">                btnDrawable = R.drawable.ic_check_box_black_24dp;</span>
                break;
        }
<span class="nc" id="L134">        setButtonDrawable(btnDrawable);</span>

<span class="nc" id="L136">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>