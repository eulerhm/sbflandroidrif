<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContributionsListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.contributions</a> &gt; <span class="el_source">ContributionsListFragment.java</span></div><h1>ContributionsListFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.contributions;

import static android.view.View.GONE;
import static android.view.View.VISIBLE;
import static fr.free.nrw.commons.di.NetworkingModule.NAMED_LANGUAGE_WIKI_PEDIA_WIKI_SITE;

import android.Manifest.permission;
import android.content.Context;
import android.content.res.Configuration;
import android.net.Uri;
import android.os.Bundle;
import android.os.Parcelable;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.Animation;
import android.view.animation.AnimationUtils;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.TextView;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.VisibleForTesting;
import androidx.appcompat.widget.AppCompatTextView;
import androidx.fragment.app.FragmentManager;
import androidx.recyclerview.widget.GridLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import androidx.recyclerview.widget.RecyclerView.AdapterDataObserver;
import androidx.recyclerview.widget.RecyclerView.ItemAnimator;
import androidx.recyclerview.widget.RecyclerView.OnItemTouchListener;
import androidx.recyclerview.widget.SimpleItemAnimator;
import com.google.android.material.floatingactionbutton.FloatingActionButton;
import fr.free.nrw.commons.CommonsApplication;
import fr.free.nrw.commons.Media;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.auth.SessionManager;
import fr.free.nrw.commons.databinding.FragmentContributionsListBinding;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.media.MediaClient;
import fr.free.nrw.commons.profile.ProfileActivity;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.SystemThemeUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import java.util.Locale;
import java.util.Map;
import java.util.Objects;
import javax.inject.Inject;
import javax.inject.Named;
import org.apache.commons.lang3.StringUtils;
import org.wikipedia.dataclient.WikiSite;


/**
 * Created by root on 01.06.2018.
 */

<span class="nc" id="L62">public class ContributionsListFragment extends CommonsDaggerSupportFragment implements</span>
    ContributionsListContract.View, ContributionsListAdapter.Callback,
    WikipediaInstructionsDialogFragment.Callback {

    private static final String RV_STATE = &quot;rv_scroll_state&quot;;

    @Inject
    SystemThemeUtils systemThemeUtils;
    @Inject
    ContributionController controller;
    @Inject
    MediaClient mediaClient;
    @Named(NAMED_LANGUAGE_WIKI_PEDIA_WIKI_SITE)
    @Inject
    WikiSite languageWikipediaSite;
    @Inject
    ContributionsListPresenter contributionsListPresenter;
    @Inject
    SessionManager sessionManager;

    private FragmentContributionsListBinding binding;
    private Animation fab_close;
    private Animation fab_open;
    private Animation rotate_forward;
    private Animation rotate_backward;
    private boolean isFabOpen;

    @VisibleForTesting
    protected RecyclerView rvContributionsList;

    @VisibleForTesting
    protected ContributionsListAdapter adapter;

    @Nullable
    @VisibleForTesting
    protected Callback callback;

<span class="nc" id="L99">    private final int SPAN_COUNT_LANDSCAPE = 3;</span>
<span class="nc" id="L100">    private final int SPAN_COUNT_PORTRAIT = 1;</span>

    private int contributionsSize;
    private String userName;

<span class="nc" id="L105">    private ActivityResultLauncher&lt;String[]&gt; inAppCameraLocationPermissionLauncher = registerForActivityResult(new ActivityResultContracts.RequestMultiplePermissions(), new ActivityResultCallback&lt;Map&lt;String, Boolean&gt;&gt;() {</span>
        @Override
        public void onActivityResult(Map&lt;String, Boolean&gt; result) {
<span class="nc" id="L108">            boolean areAllGranted = true;</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">            for (final boolean b : result.values()) {</span>
<span class="nc bnc" id="L110" title="All 4 branches missed.">                areAllGranted = areAllGranted &amp;&amp; b;</span>
<span class="nc" id="L111">            }</span>

<span class="nc bnc" id="L113" title="All 2 branches missed.">            if (areAllGranted) {</span>
<span class="nc" id="L114">                controller.locationPermissionCallback.onLocationPermissionGranted();</span>
            } else {
<span class="nc bnc" id="L116" title="All 2 branches missed.">                if (shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)) {</span>
<span class="nc" id="L117">                    controller.handleShowRationaleFlowCameraLocation(getActivity());</span>
                } else {
<span class="nc" id="L119">                    controller.locationPermissionCallback.onLocationPermissionDenied(</span>
<span class="nc" id="L120">                        getActivity().getString(R.string.in_app_camera_location_permission_denied));</span>
                }
            }
<span class="nc" id="L123">        }</span>
    });


    @Override
    public void onCreate(
        @Nullable @org.jetbrains.annotations.Nullable final Bundle savedInstanceState) {
<span class="nc" id="L130">        super.onCreate(savedInstanceState);</span>
        //Now that we are allowing this fragment to be started for
        // any userName- we expect it to be passed as an argument
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (getArguments() != null) {</span>
<span class="nc" id="L134">            userName = getArguments().getString(ProfileActivity.KEY_USERNAME);</span>
        }

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (StringUtils.isEmpty(userName)) {</span>
<span class="nc" id="L138">            userName = sessionManager.getUserName();</span>
        }
<span class="nc" id="L140">    }</span>

    @Override
    public View onCreateView(
        final LayoutInflater inflater, @Nullable final ViewGroup container,
        @Nullable final Bundle savedInstanceState) {
<span class="nc" id="L146">        binding = FragmentContributionsListBinding.inflate(</span>
            inflater, container, false
        );
<span class="nc" id="L149">        rvContributionsList = binding.contributionsList;</span>

<span class="nc" id="L151">        contributionsListPresenter.onAttachView(this);</span>
<span class="nc" id="L152">        binding.fabCustomGallery.setOnClickListener(v -&gt; launchCustomSelector());</span>

<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (Objects.equals(sessionManager.getUserName(), userName)) {</span>
<span class="nc" id="L155">            binding.tvContributionsOfUser.setVisibility(GONE);</span>
<span class="nc" id="L156">            binding.fabLayout.setVisibility(VISIBLE);</span>
        } else {
<span class="nc" id="L158">            binding.tvContributionsOfUser.setVisibility(VISIBLE);</span>
<span class="nc" id="L159">            binding.tvContributionsOfUser.setText(getString(R.string.contributions_of_user, userName));</span>
<span class="nc" id="L160">            binding.fabLayout.setVisibility(GONE);</span>
        }

<span class="nc" id="L163">        initAdapter();</span>

<span class="nc" id="L165">        return binding.getRoot();</span>
    }

    @Override
    public void onDestroyView() {
<span class="nc" id="L170">        binding = null;</span>
<span class="nc" id="L171">        super.onDestroyView();</span>
<span class="nc" id="L172">    }</span>

    @Override
    public void onAttach(Context context) {
<span class="nc" id="L176">        super.onAttach(context);</span>
<span class="nc bnc" id="L177" title="All 4 branches missed.">        if (getParentFragment() != null &amp;&amp; getParentFragment() instanceof ContributionsFragment) {</span>
<span class="nc" id="L178">            callback = ((ContributionsFragment) getParentFragment());</span>
        }
<span class="nc" id="L180">    }</span>

    @Override
    public void onDetach() {
<span class="nc" id="L184">        super.onDetach();</span>
<span class="nc" id="L185">        callback = null;//To avoid possible memory leak</span>
<span class="nc" id="L186">    }</span>

    private void initAdapter() {
<span class="nc" id="L189">        adapter = new ContributionsListAdapter(this, mediaClient);</span>
<span class="nc" id="L190">    }</span>

    @Override
    public void onViewCreated(final View view, @Nullable final Bundle savedInstanceState) {
<span class="nc" id="L194">        super.onViewCreated(view, savedInstanceState);</span>
<span class="nc" id="L195">        initRecyclerView();</span>
<span class="nc" id="L196">        initializeAnimations();</span>
<span class="nc" id="L197">        setListeners();</span>
<span class="nc" id="L198">    }</span>

    private void initRecyclerView() {
<span class="nc" id="L201">        final GridLayoutManager layoutManager = new GridLayoutManager(getContext(),</span>
<span class="nc" id="L202">            getSpanCount(getResources().getConfiguration().orientation));</span>
<span class="nc" id="L203">        rvContributionsList.setLayoutManager(layoutManager);</span>

        //Setting flicker animation of recycler view to false.
<span class="nc" id="L206">        final ItemAnimator animator = rvContributionsList.getItemAnimator();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if (animator instanceof SimpleItemAnimator) {</span>
<span class="nc" id="L208">            ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);</span>
        }

<span class="nc" id="L211">        contributionsListPresenter.setup(userName,</span>
<span class="nc" id="L212">            Objects.equals(sessionManager.getUserName(), userName));</span>
<span class="nc" id="L213">        contributionsListPresenter.contributionList.observe(getViewLifecycleOwner(), list -&gt; {</span>
<span class="nc" id="L214">            contributionsSize = list.size();</span>
<span class="nc" id="L215">            adapter.submitList(list);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">            if (callback != null) {</span>
<span class="nc" id="L217">                callback.notifyDataSetChanged();</span>
            }
<span class="nc" id="L219">        });</span>
<span class="nc" id="L220">        rvContributionsList.setAdapter(adapter);</span>
<span class="nc" id="L221">        adapter.registerAdapterDataObserver(new AdapterDataObserver() {</span>
            @Override
            public void onItemRangeInserted(int positionStart, int itemCount) {
<span class="nc" id="L224">                super.onItemRangeInserted(positionStart, itemCount);</span>
<span class="nc" id="L225">                contributionsSize = adapter.getItemCount();</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                if (callback != null) {</span>
<span class="nc" id="L227">                    callback.notifyDataSetChanged();</span>
                }
<span class="nc bnc" id="L229" title="All 4 branches missed.">                if (itemCount &gt; 0 &amp;&amp; positionStart == 0) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                    if (adapter.getContributionForPosition(positionStart) != null) {</span>
<span class="nc" id="L231">                        rvContributionsList</span>
<span class="nc" id="L232">                            .scrollToPosition(0);//Newly upload items are always added to the top</span>
                    }
                }
<span class="nc" id="L235">            }</span>

            /**
             * Called whenever items in the list have changed
             * Calls viewPagerNotifyDataSetChanged() that will notify the viewpager
             */
            @Override
            public void onItemRangeChanged(final int positionStart, final int itemCount) {
<span class="nc" id="L243">                super.onItemRangeChanged(positionStart, itemCount);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (callback != null) {</span>
<span class="nc" id="L245">                    callback.viewPagerNotifyDataSetChanged();</span>
                }
<span class="nc" id="L247">            }</span>
        });

        //Fab close on touch outside (Scrolling or taping on item triggers this action).
<span class="nc" id="L251">        rvContributionsList.addOnItemTouchListener(new OnItemTouchListener() {</span>

            /**
             * Silently observe and/or take over touch events sent to the RecyclerView before
             * they are handled by either the RecyclerView itself or its child views.
             */
            @Override
            public boolean onInterceptTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {
<span class="nc bnc" id="L259" title="All 2 branches missed.">                if (e.getAction() == MotionEvent.ACTION_DOWN) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">                    if (isFabOpen) {</span>
<span class="nc" id="L261">                        animateFAB(isFabOpen);</span>
                    }
                }
<span class="nc" id="L264">                return false;</span>
            }

            /**
             * Process a touch event as part of a gesture that was claimed by returning true
             * from a previous call to {@link #onInterceptTouchEvent}.
             *
             * @param rv
             * @param e  MotionEvent describing the touch event. All coordinates are in the
             *           RecyclerView's coordinate system.
             */
            @Override
            public void onTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {
                //required abstract method DO NOT DELETE
<span class="nc" id="L278">            }</span>

            /**
             * Called when a child of RecyclerView does not want RecyclerView and its ancestors
             * to intercept touch events with {@link ViewGroup#onInterceptTouchEvent(MotionEvent)}.
             *
             * @param disallowIntercept True if the child does not want the parent to intercept
             *                          touch events.
             */
            @Override
            public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {
                //required abstract method DO NOT DELETE
<span class="nc" id="L290">            }</span>

        });
<span class="nc" id="L293">    }</span>

    private int getSpanCount(final int orientation) {
<span class="nc bnc" id="L296" title="All 2 branches missed.">        return orientation == Configuration.ORIENTATION_LANDSCAPE ?</span>
<span class="nc" id="L297">            SPAN_COUNT_LANDSCAPE : SPAN_COUNT_PORTRAIT;</span>
    }

    @Override
    public void onConfigurationChanged(final Configuration newConfig) {
<span class="nc" id="L302">        super.onConfigurationChanged(newConfig);</span>
        // check orientation
<span class="nc bnc" id="L304" title="All 2 branches missed.">        binding.fabLayout.setOrientation(newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE ?</span>
<span class="nc" id="L305">            LinearLayout.HORIZONTAL : LinearLayout.VERTICAL);</span>
<span class="nc" id="L306">        rvContributionsList</span>
<span class="nc" id="L307">            .setLayoutManager(</span>
<span class="nc" id="L308">                new GridLayoutManager(getContext(), getSpanCount(newConfig.orientation)));</span>
<span class="nc" id="L309">    }</span>

    private void initializeAnimations() {
<span class="nc" id="L312">        fab_open = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_open);</span>
<span class="nc" id="L313">        fab_close = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_close);</span>
<span class="nc" id="L314">        rotate_forward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_forward);</span>
<span class="nc" id="L315">        rotate_backward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_backward);</span>
<span class="nc" id="L316">    }</span>

    private void setListeners() {
<span class="nc" id="L319">        binding.fabPlus.setOnClickListener(view -&gt; animateFAB(isFabOpen));</span>
<span class="nc" id="L320">        binding.fabCamera.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L321">            controller.initiateCameraPick(getActivity(), inAppCameraLocationPermissionLauncher);</span>
<span class="nc" id="L322">            animateFAB(isFabOpen);</span>
<span class="nc" id="L323">        });</span>
<span class="nc" id="L324">        binding.fabGallery.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L325">            controller.initiateGalleryPick(getActivity(), true);</span>
<span class="nc" id="L326">            animateFAB(isFabOpen);</span>
<span class="nc" id="L327">        });</span>
<span class="nc" id="L328">    }</span>

    /**
     * Launch Custom Selector.
     */
    protected void launchCustomSelector() {
<span class="nc" id="L334">        controller.initiateCustomGalleryPickWithPermission(getActivity());</span>
<span class="nc" id="L335">        animateFAB(isFabOpen);</span>
<span class="nc" id="L336">    }</span>

    public void scrollToTop() {
<span class="nc" id="L339">        rvContributionsList.smoothScrollToPosition(0);</span>
<span class="nc" id="L340">    }</span>

    private void animateFAB(final boolean isFabOpen) {
<span class="nc bnc" id="L343" title="All 2 branches missed.">        this.isFabOpen = !isFabOpen;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (binding.fabPlus.isShown()) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">            if (isFabOpen) {</span>
<span class="nc" id="L346">                binding.fabPlus.startAnimation(rotate_backward);</span>
<span class="nc" id="L347">                binding.fabCamera.startAnimation(fab_close);</span>
<span class="nc" id="L348">                binding.fabGallery.startAnimation(fab_close);</span>
<span class="nc" id="L349">                binding.fabCustomGallery.startAnimation(fab_close);</span>
<span class="nc" id="L350">                binding.fabCamera.hide();</span>
<span class="nc" id="L351">                binding.fabGallery.hide();</span>
<span class="nc" id="L352">                binding.fabCustomGallery.hide();</span>
            } else {
<span class="nc" id="L354">                binding.fabPlus.startAnimation(rotate_forward);</span>
<span class="nc" id="L355">                binding.fabCamera.startAnimation(fab_open);</span>
<span class="nc" id="L356">                binding.fabGallery.startAnimation(fab_open);</span>
<span class="nc" id="L357">                binding.fabCustomGallery.startAnimation(fab_open);</span>
<span class="nc" id="L358">                binding.fabCamera.show();</span>
<span class="nc" id="L359">                binding.fabGallery.show();</span>
<span class="nc" id="L360">                binding.fabCustomGallery.show();</span>
            }
<span class="nc bnc" id="L362" title="All 2 branches missed.">            this.isFabOpen = !isFabOpen;</span>
        }
<span class="nc" id="L364">    }</span>

    /**
     * Shows welcome message if user has no contributions yet i.e. new user.
     */
    @Override
    public void showWelcomeTip(final boolean shouldShow) {
<span class="nc bnc" id="L371" title="All 2 branches missed.">        binding.noContributionsYet.setVisibility(shouldShow ? VISIBLE : GONE);</span>
<span class="nc" id="L372">    }</span>

    /**
     * Responsible to set progress bar invisible and visible
     *
     * @param shouldShow True when contributions list should be hidden.
     */
    @Override
    public void showProgress(final boolean shouldShow) {
<span class="nc bnc" id="L381" title="All 2 branches missed.">        binding.loadingContributionsProgressBar.setVisibility(shouldShow ? VISIBLE : GONE);</span>
<span class="nc" id="L382">    }</span>

    @Override
    public void showNoContributionsUI(final boolean shouldShow) {
<span class="nc bnc" id="L386" title="All 2 branches missed.">        binding.noContributionsYet.setVisibility(shouldShow ? VISIBLE : GONE);</span>
<span class="nc" id="L387">    }</span>

    @Override
    public void onSaveInstanceState(@NonNull Bundle outState) {
<span class="nc" id="L391">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L392">        final GridLayoutManager layoutManager = (GridLayoutManager) rvContributionsList</span>
<span class="nc" id="L393">            .getLayoutManager();</span>
<span class="nc" id="L394">        outState.putParcelable(RV_STATE, layoutManager.onSaveInstanceState());</span>
<span class="nc" id="L395">    }</span>

    @Override
    public void onViewStateRestored(@Nullable Bundle savedInstanceState) {
<span class="nc" id="L399">        super.onViewStateRestored(savedInstanceState);</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (null != savedInstanceState) {</span>
<span class="nc" id="L401">            final Parcelable savedRecyclerLayoutState = savedInstanceState.getParcelable(RV_STATE);</span>
<span class="nc" id="L402">            rvContributionsList.getLayoutManager().onRestoreInstanceState(savedRecyclerLayoutState);</span>
        }
<span class="nc" id="L404">    }</span>

    @Override
    public void retryUpload(final Contribution contribution) {
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (null != callback) {//Just being safe, ideally they won't be called when detached</span>
<span class="nc" id="L409">            callback.retryUpload(contribution);</span>
        }
<span class="nc" id="L411">    }</span>

    @Override
    public void deleteUpload(final Contribution contribution) {
<span class="nc" id="L415">        DialogUtil.showAlertDialog(getActivity(),</span>
<span class="nc" id="L416">            String.format(Locale.getDefault(),</span>
<span class="nc" id="L417">                getString(R.string.cancelling_upload)),</span>
<span class="nc" id="L418">            String.format(Locale.getDefault(),</span>
<span class="nc" id="L419">                getString(R.string.cancel_upload_dialog)),</span>
<span class="nc" id="L420">            String.format(Locale.getDefault(), getString(R.string.yes)), String.format(Locale.getDefault(), getString(R.string.no)),</span>
            () -&gt; {
<span class="nc" id="L422">                ViewUtil.showShortToast(getContext(), R.string.cancelling_upload);</span>
<span class="nc" id="L423">                contributionsListPresenter.deleteUpload(contribution);</span>
<span class="nc" id="L424">                CommonsApplication.cancelledUploads.add(contribution.getPageId());</span>
<span class="nc" id="L425">            }, () -&gt; {</span>
                // Do nothing
<span class="nc" id="L427">            });</span>
<span class="nc" id="L428">    }</span>

    @Override
    public void openMediaDetail(final int position, boolean isWikipediaButtonDisplayed) {
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (null != callback) {//Just being safe, ideally they won't be called when detached</span>
<span class="nc" id="L433">            callback.showDetail(position, isWikipediaButtonDisplayed);</span>
        }
<span class="nc" id="L435">    }</span>

    /**
     * Handle callback for wikipedia icon clicked
     *
     * @param contribution
     */
    @Override
    public void addImageToWikipedia(Contribution contribution) {
<span class="nc" id="L444">        DialogUtil.showAlertDialog(getActivity(),</span>
<span class="nc" id="L445">            getString(R.string.add_picture_to_wikipedia_article_title),</span>
<span class="nc" id="L446">            getString(R.string.add_picture_to_wikipedia_article_desc),</span>
            () -&gt; {
<span class="nc" id="L448">                showAddImageToWikipediaInstructions(contribution);</span>
<span class="nc" id="L449">            }, () -&gt; {</span>
                // do nothing
<span class="nc" id="L451">            });</span>
<span class="nc" id="L452">    }</span>

    /**
     * Pauses the current upload
     *
     * @param contribution
     */
    @Override
    public void pauseUpload(Contribution contribution) {
<span class="nc" id="L461">        ViewUtil.showShortToast(getContext(), R.string.pausing_upload);</span>
<span class="nc" id="L462">        callback.pauseUpload(contribution);</span>
<span class="nc" id="L463">    }</span>

    /**
     * Resumes the current upload
     *
     * @param contribution
     */
    @Override
    public void resumeUpload(Contribution contribution) {
<span class="nc" id="L472">        ViewUtil.showShortToast(getContext(), R.string.resuming_upload);</span>
<span class="nc" id="L473">        callback.retryUpload(contribution);</span>
<span class="nc" id="L474">    }</span>

    /**
     * Display confirmation dialog with instructions when the user tries to add image to wikipedia
     *
     * @param contribution
     */
    private void showAddImageToWikipediaInstructions(Contribution contribution) {
<span class="nc" id="L482">        FragmentManager fragmentManager = getFragmentManager();</span>
<span class="nc" id="L483">        WikipediaInstructionsDialogFragment fragment = WikipediaInstructionsDialogFragment</span>
<span class="nc" id="L484">            .newInstance(contribution);</span>
<span class="nc" id="L485">        fragment.setCallback(this::onConfirmClicked);</span>
<span class="nc" id="L486">        fragment.show(fragmentManager, &quot;WikimediaFragment&quot;);</span>
<span class="nc" id="L487">    }</span>


    public Media getMediaAtPosition(final int i) {
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (adapter.getContributionForPosition(i) != null) {</span>
<span class="nc" id="L492">            return adapter.getContributionForPosition(i).getMedia();</span>
        }
<span class="nc" id="L494">        return null;</span>
    }

    public int getTotalMediaCount() {
<span class="nc" id="L498">        return contributionsSize;</span>
    }

    /**
     * Open the editor for the language Wikipedia
     *
     * @param contribution
     */
    @Override
    public void onConfirmClicked(@Nullable Contribution contribution, boolean copyWikicode) {
<span class="nc bnc" id="L508" title="All 2 branches missed.">        if (copyWikicode) {</span>
<span class="nc" id="L509">            String wikicode = contribution.getMedia().getWikiCode();</span>
<span class="nc" id="L510">            Utils.copy(&quot;wikicode&quot;, wikicode, getContext());</span>
        }

<span class="nc" id="L513">        final String url =</span>
<span class="nc" id="L514">            languageWikipediaSite.mobileUrl() + &quot;/wiki/&quot; + contribution.getWikidataPlace()</span>
<span class="nc" id="L515">                .getWikipediaPageTitle();</span>
<span class="nc" id="L516">        Utils.handleWebUrl(getContext(), Uri.parse(url));</span>
<span class="nc" id="L517">    }</span>

    public Integer getContributionStateAt(int position) {
<span class="nc" id="L520">        return adapter.getContributionForPosition(position).getState();</span>
    }

    public interface Callback {

        void notifyDataSetChanged();

        void retryUpload(Contribution contribution);

        void showDetail(int position, boolean isWikipediaButtonDisplayed);

        void pauseUpload(Contribution contribution);

        // Notify the viewpager that number of items have changed.
        void viewPagerNotifyDataSetChanged();
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>