<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoginActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.auth</a> &gt; <span class="el_source">LoginActivity.java</span></div><h1>LoginActivity.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.auth;

import android.accounts.AccountAuthenticatorActivity;
import android.app.ProgressDialog;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.KeyEvent;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.inputmethod.InputMethodManager;

import android.widget.TextView;
import androidx.annotation.ColorRes;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AppCompatDelegate;
import androidx.core.app.NavUtils;
import androidx.core.content.ContextCompat;

import fr.free.nrw.commons.auth.login.LoginClient;
import fr.free.nrw.commons.auth.login.LoginResult;
import fr.free.nrw.commons.databinding.ActivityLoginBinding;
import fr.free.nrw.commons.utils.ActivityUtils;
import java.util.Locale;
import org.wikipedia.dataclient.mwapi.MwQueryResponse;
import fr.free.nrw.commons.auth.login.LoginCallback;

import javax.inject.Inject;
import javax.inject.Named;

import fr.free.nrw.commons.BuildConfig;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.di.ApplicationlessInjection;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.utils.ConfigUtils;
import fr.free.nrw.commons.utils.SystemThemeUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import io.reactivex.disposables.CompositeDisposable;
import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;
import timber.log.Timber;

import static android.view.KeyEvent.KEYCODE_ENTER;
import static android.view.View.VISIBLE;
import static android.view.inputmethod.EditorInfo.IME_ACTION_DONE;

<span class="nc" id="L58">public class LoginActivity extends AccountAuthenticatorActivity {</span>

    @Inject
    SessionManager sessionManager;

    @Inject
    @Named(&quot;default_preferences&quot;)
    JsonKvStore applicationKvStore;

    @Inject
    LoginClient loginClient;

    @Inject
    SystemThemeUtils systemThemeUtils;

    private ActivityLoginBinding binding;
    ProgressDialog progressDialog;
    private AppCompatDelegate delegate;
<span class="nc" id="L76">    private LoginTextWatcher textWatcher = new LoginTextWatcher();</span>
<span class="nc" id="L77">    private CompositeDisposable compositeDisposable = new CompositeDisposable();</span>
    private Call&lt;MwQueryResponse&gt; loginToken;
<span class="nc" id="L79">    final  String saveProgressDailog=&quot;ProgressDailog_state&quot;;</span>
<span class="nc" id="L80">    final String saveErrorMessage =&quot;errorMessage&quot;;</span>
<span class="nc" id="L81">    final String saveUsername=&quot;username&quot;;</span>
<span class="nc" id="L82">    final  String savePassword=&quot;password&quot;;</span>

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L86">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L87">        ApplicationlessInjection</span>
<span class="nc" id="L88">                .getInstance(this.getApplicationContext())</span>
<span class="nc" id="L89">                .getCommonsApplicationComponent()</span>
<span class="nc" id="L90">                .inject(this);</span>

<span class="nc" id="L92">        boolean isDarkTheme = systemThemeUtils.isDeviceInNightMode();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        setTheme(isDarkTheme ? R.style.DarkAppTheme : R.style.LightAppTheme);</span>
<span class="nc" id="L94">        getDelegate().installViewFactory();</span>
<span class="nc" id="L95">        getDelegate().onCreate(savedInstanceState);</span>

<span class="nc" id="L97">        binding = ActivityLoginBinding.inflate(getLayoutInflater());</span>
<span class="nc" id="L98">        setContentView(binding.getRoot());</span>

<span class="nc" id="L100">        binding.loginUsername.addTextChangedListener(textWatcher);</span>
<span class="nc" id="L101">        binding.loginPassword.addTextChangedListener(textWatcher);</span>
<span class="nc" id="L102">        binding.loginTwoFactor.addTextChangedListener(textWatcher);</span>

<span class="nc" id="L104">        binding.skipLogin.setOnClickListener(view -&gt; skipLogin());</span>
<span class="nc" id="L105">        binding.forgotPassword.setOnClickListener(view -&gt; forgotPassword());</span>
<span class="nc" id="L106">        binding.aboutPrivacyPolicy.setOnClickListener(view -&gt; onPrivacyPolicyClicked());</span>
<span class="nc" id="L107">        binding.signUpButton.setOnClickListener(view -&gt; signUp());</span>
<span class="nc" id="L108">        binding.loginButton.setOnClickListener(view -&gt; performLogin());</span>

<span class="nc" id="L110">        binding.loginPassword.setOnEditorActionListener(this::onEditorAction);</span>
<span class="nc" id="L111">        binding.loginPassword.setOnFocusChangeListener(this::onPasswordFocusChanged);</span>

<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (ConfigUtils.isBetaFlavour()) {</span>
<span class="nc" id="L114">            binding.loginCredentials.setText(getString(R.string.login_credential));</span>
        } else {
<span class="nc" id="L116">            binding.loginCredentials.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L118">    }</span>
    /** 
     * Hides the keyboard if the user's focus is not on the password (hasFocus is false).
     * @param view The keyboard
     * @param hasFocus Set to true if the keyboard has focus
     */
    void onPasswordFocusChanged(View view, boolean hasFocus) {
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (!hasFocus) {</span>
<span class="nc" id="L126">            ViewUtil.hideKeyboard(view);</span>
        }
<span class="nc" id="L128">    }</span>

    boolean onEditorAction(TextView textView, int actionId, KeyEvent keyEvent) {
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (binding.loginButton.isEnabled()) {</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">            if (actionId == IME_ACTION_DONE) {</span>
<span class="nc" id="L133">                performLogin();</span>
<span class="nc" id="L134">                return true;</span>
<span class="nc bnc" id="L135" title="All 4 branches missed.">            } else if ((keyEvent != null) &amp;&amp; keyEvent.getKeyCode() == KEYCODE_ENTER) {</span>
<span class="nc" id="L136">                performLogin();</span>
<span class="nc" id="L137">                return true;</span>
            }
        }
<span class="nc" id="L140">        return false;</span>
    }


    protected void skipLogin() {
<span class="nc" id="L145">        new AlertDialog.Builder(this).setTitle(R.string.skip_login_title)</span>
<span class="nc" id="L146">                .setMessage(R.string.skip_login_message)</span>
<span class="nc" id="L147">                .setCancelable(false)</span>
<span class="nc" id="L148">                .setPositiveButton(R.string.yes, (dialog, which) -&gt; {</span>
<span class="nc" id="L149">                    dialog.cancel();</span>
<span class="nc" id="L150">                    performSkipLogin();</span>
<span class="nc" id="L151">                })</span>
<span class="nc" id="L152">                .setNegativeButton(R.string.no, (dialog, which) -&gt; dialog.cancel())</span>
<span class="nc" id="L153">                .show();</span>
<span class="nc" id="L154">    }</span>

    protected void forgotPassword() {
<span class="nc" id="L157">        Utils.handleWebUrl(this, Uri.parse(BuildConfig.FORGOT_PASSWORD_URL));</span>
<span class="nc" id="L158">    }</span>

    protected void onPrivacyPolicyClicked() {
<span class="nc" id="L161">        Utils.handleWebUrl(this, Uri.parse(BuildConfig.PRIVACY_POLICY_URL));</span>
<span class="nc" id="L162">    }</span>

    protected void signUp() {
<span class="nc" id="L165">        Intent intent = new Intent(this, SignupActivity.class);</span>
<span class="nc" id="L166">        startActivity(intent);</span>
<span class="nc" id="L167">    }</span>

    @Override
    protected void onPostCreate(Bundle savedInstanceState) {
<span class="nc" id="L171">        super.onPostCreate(savedInstanceState);</span>
<span class="nc" id="L172">        getDelegate().onPostCreate(savedInstanceState);</span>
<span class="nc" id="L173">    }</span>

    @Override
    protected void onResume() {
<span class="nc" id="L177">        super.onResume();</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">        if (sessionManager.getCurrentAccount() != null</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">                &amp;&amp; sessionManager.isUserLoggedIn()) {</span>
<span class="nc" id="L181">            applicationKvStore.putBoolean(&quot;login_skipped&quot;, false);</span>
<span class="nc" id="L182">            startMainActivity();</span>
        }

<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (applicationKvStore.getBoolean(&quot;login_skipped&quot;, false)) {</span>
<span class="nc" id="L186">            performSkipLogin();</span>
        }

<span class="nc" id="L189">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc" id="L193">        compositeDisposable.clear();</span>
        try {
            // To prevent leaked window when finish() is called, see http://stackoverflow.com/questions/32065854/activity-has-leaked-window-at-alertdialog-show-method
<span class="nc bnc" id="L196" title="All 4 branches missed.">            if (progressDialog != null &amp;&amp; progressDialog.isShowing()) {</span>
<span class="nc" id="L197">                progressDialog.dismiss();</span>
            }
<span class="nc" id="L199">        } catch (Exception e) {</span>
<span class="nc" id="L200">            e.printStackTrace();</span>
<span class="nc" id="L201">        }</span>
<span class="nc" id="L202">        binding.loginUsername.removeTextChangedListener(textWatcher);</span>
<span class="nc" id="L203">        binding.loginPassword.removeTextChangedListener(textWatcher);</span>
<span class="nc" id="L204">        binding.loginTwoFactor.removeTextChangedListener(textWatcher);</span>
<span class="nc" id="L205">        delegate.onDestroy();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if(null!=loginClient) {</span>
<span class="nc" id="L207">            loginClient.cancel();</span>
        }
<span class="nc" id="L209">        binding = null;</span>
<span class="nc" id="L210">        super.onDestroy();</span>
<span class="nc" id="L211">    }</span>

    public void performLogin() {
<span class="nc" id="L214">        Timber.d(&quot;Login to start!&quot;);</span>
<span class="nc" id="L215">        final String username = binding.loginUsername.getText().toString();</span>
<span class="nc" id="L216">        final String rawUsername = binding.loginUsername.getText().toString().trim();</span>
<span class="nc" id="L217">        final String password = binding.loginPassword.getText().toString();</span>
<span class="nc" id="L218">        String twoFactorCode = binding.loginTwoFactor.getText().toString();</span>

<span class="nc" id="L220">        showLoggingProgressBar();</span>
<span class="nc" id="L221">        doLogin(username, password, twoFactorCode);</span>
<span class="nc" id="L222">    }</span>

    private void doLogin(String username, String password, String twoFactorCode) {
<span class="nc" id="L225">        progressDialog.show();</span>
<span class="nc" id="L226">        loginToken = loginClient.getLoginToken();</span>
<span class="nc" id="L227">        loginToken.enqueue(</span>
<span class="nc" id="L228">                new Callback&lt;MwQueryResponse&gt;() {</span>
                    @Override
                    public void onResponse(Call&lt;MwQueryResponse&gt; call,
                                           Response&lt;MwQueryResponse&gt; response) {
<span class="nc" id="L232">                        loginClient.login(username, password, null, twoFactorCode,</span>
<span class="nc" id="L233">                                response.body().query().loginToken(), Locale.getDefault().getLanguage(), new LoginCallback() {</span>
                                    @Override
                                    public void success(@NonNull LoginResult result) {
<span class="nc" id="L236">                                        Timber.d(&quot;Login Success&quot;);</span>
<span class="nc" id="L237">                                        onLoginSuccess(result);</span>
<span class="nc" id="L238">                                    }</span>

                                    @Override
                                    public void twoFactorPrompt(@NonNull Throwable caught,
                                                                @Nullable String token) {
<span class="nc" id="L243">                                        Timber.d(&quot;Requesting 2FA prompt&quot;);</span>
<span class="nc" id="L244">                                        hideProgress();</span>
<span class="nc" id="L245">                                        askUserForTwoFactorAuth();</span>
<span class="nc" id="L246">                                    }</span>

                                    @Override
                                    public void passwordResetPrompt(@Nullable String token) {
<span class="nc" id="L250">                                        Timber.d(&quot;Showing password reset prompt&quot;);</span>
<span class="nc" id="L251">                                        hideProgress();</span>
<span class="nc" id="L252">                                        showPasswordResetPrompt();</span>
<span class="nc" id="L253">                                    }</span>

                                    @Override
                                    public void error(@NonNull Throwable caught) {
<span class="nc" id="L257">                                        Timber.e(caught);</span>
<span class="nc" id="L258">                                        hideProgress();</span>
<span class="nc" id="L259">                                        showMessageAndCancelDialog(caught.getLocalizedMessage());</span>
<span class="nc" id="L260">                                    }</span>
                                });
<span class="nc" id="L262">                    }</span>

                    @Override
                    public void onFailure(Call&lt;MwQueryResponse&gt; call, Throwable t) {
<span class="nc" id="L266">                        Timber.e(t);</span>
<span class="nc" id="L267">                        showMessageAndCancelDialog(t.getLocalizedMessage());</span>
<span class="nc" id="L268">                    }</span>
                });

<span class="nc" id="L271">    }</span>

    private void hideProgress() {
<span class="nc" id="L274">        progressDialog.dismiss();</span>
<span class="nc" id="L275">    }</span>

    private void showPasswordResetPrompt() {
<span class="nc" id="L278">        showMessageAndCancelDialog(getString(R.string.you_must_reset_your_passsword));</span>
<span class="nc" id="L279">    }</span>


    /**
     * This function is called when user skips the login.
     * It redirects the user to Explore Activity.
     */
    private void performSkipLogin() {
<span class="nc" id="L287">        applicationKvStore.putBoolean(&quot;login_skipped&quot;, true);</span>
<span class="nc" id="L288">        MainActivity.startYourself(this);</span>
<span class="nc" id="L289">        finish();</span>
<span class="nc" id="L290">    }</span>

    private void showLoggingProgressBar() {
<span class="nc" id="L293">        progressDialog = new ProgressDialog(this);</span>
<span class="nc" id="L294">        progressDialog.setIndeterminate(true);</span>
<span class="nc" id="L295">        progressDialog.setTitle(getString(R.string.logging_in_title));</span>
<span class="nc" id="L296">        progressDialog.setMessage(getString(R.string.logging_in_message));</span>
<span class="nc" id="L297">        progressDialog.setCanceledOnTouchOutside(false);</span>
<span class="nc" id="L298">        progressDialog.show();</span>
<span class="nc" id="L299">    }</span>

    private void onLoginSuccess(LoginResult loginResult) {
<span class="nc bnc" id="L302" title="All 2 branches missed.">        if (!progressDialog.isShowing()) {</span>
            // no longer attached to activity!
<span class="nc" id="L304">            return;</span>
        }
<span class="nc" id="L306">        compositeDisposable.clear();</span>
<span class="nc" id="L307">        sessionManager.setUserLoggedIn(true);</span>
<span class="nc" id="L308">        sessionManager.updateAccount(loginResult);</span>
<span class="nc" id="L309">        progressDialog.dismiss();</span>
<span class="nc" id="L310">        showSuccessAndDismissDialog();</span>
<span class="nc" id="L311">        startMainActivity();</span>
<span class="nc" id="L312">    }</span>

    @Override
    protected void onStart() {
<span class="nc" id="L316">        super.onStart();</span>
<span class="nc" id="L317">        delegate.onStart();</span>
<span class="nc" id="L318">    }</span>

    @Override
    protected void onStop() {
<span class="nc" id="L322">        super.onStop();</span>
<span class="nc" id="L323">        delegate.onStop();</span>
<span class="nc" id="L324">    }</span>

    @Override
    protected void onPostResume() {
<span class="nc" id="L328">        super.onPostResume();</span>
<span class="nc" id="L329">        getDelegate().onPostResume();</span>
<span class="nc" id="L330">    }</span>

    @Override
    public void setContentView(View view, ViewGroup.LayoutParams params) {
<span class="nc" id="L334">        getDelegate().setContentView(view, params);</span>
<span class="nc" id="L335">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L339" title="All 2 branches missed.">        switch (item.getItemId()) {</span>
            case android.R.id.home:
<span class="nc" id="L341">                NavUtils.navigateUpFromSameTask(this);</span>
<span class="nc" id="L342">                return true;</span>
        }
<span class="nc" id="L344">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    @NonNull
    public MenuInflater getMenuInflater() {
<span class="nc" id="L350">        return getDelegate().getMenuInflater();</span>
    }

    public void askUserForTwoFactorAuth() {
<span class="nc" id="L354">        progressDialog.dismiss();</span>
<span class="nc" id="L355">        binding.twoFactorContainer.setVisibility(VISIBLE);</span>
<span class="nc" id="L356">        binding.loginTwoFactor.setVisibility(VISIBLE);</span>
<span class="nc" id="L357">        binding.loginTwoFactor.requestFocus();</span>
<span class="nc" id="L358">        InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);</span>
<span class="nc" id="L359">        imm.toggleSoftInput(InputMethodManager.SHOW_FORCED, InputMethodManager.HIDE_IMPLICIT_ONLY);</span>
<span class="nc" id="L360">        showMessageAndCancelDialog(R.string.login_failed_2fa_needed);</span>
<span class="nc" id="L361">    }</span>

    public void showMessageAndCancelDialog(@StringRes int resId) {
<span class="nc" id="L364">        showMessage(resId, R.color.secondaryDarkColor);</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (progressDialog != null) {</span>
<span class="nc" id="L366">            progressDialog.cancel();</span>
        }
<span class="nc" id="L368">    }</span>

    public void showMessageAndCancelDialog(String error) {
<span class="nc" id="L371">        showMessage(error, R.color.secondaryDarkColor);</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if (progressDialog != null) {</span>
<span class="nc" id="L373">            progressDialog.cancel();</span>
        }
<span class="nc" id="L375">    }</span>

    public void showSuccessAndDismissDialog() {
<span class="nc" id="L378">        showMessage(R.string.login_success, R.color.primaryDarkColor);</span>
<span class="nc" id="L379">        progressDialog.dismiss();</span>
<span class="nc" id="L380">    }</span>

    public void startMainActivity() {
<span class="nc" id="L383">        ActivityUtils.startActivityWithFlags(this, MainActivity.class, Intent.FLAG_ACTIVITY_SINGLE_TOP);</span>
<span class="nc" id="L384">        finish();</span>
<span class="nc" id="L385">    }</span>

    private void showMessage(@StringRes int resId, @ColorRes int colorResId) {
<span class="nc" id="L388">        binding.errorMessage.setText(getString(resId));</span>
<span class="nc" id="L389">        binding.errorMessage.setTextColor(ContextCompat.getColor(this, colorResId));</span>
<span class="nc" id="L390">        binding.errorMessageContainer.setVisibility(VISIBLE);</span>
<span class="nc" id="L391">    }</span>

    private void showMessage(String message, @ColorRes int colorResId) {
<span class="nc" id="L394">        binding.errorMessage.setText(message);</span>
<span class="nc" id="L395">        binding.errorMessage.setTextColor(ContextCompat.getColor(this, colorResId));</span>
<span class="nc" id="L396">        binding.errorMessageContainer.setVisibility(VISIBLE);</span>
<span class="nc" id="L397">    }</span>

    private AppCompatDelegate getDelegate() {
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (delegate == null) {</span>
<span class="nc" id="L401">            delegate = AppCompatDelegate.create(this, null);</span>
        }
<span class="nc" id="L403">        return delegate;</span>
    }

<span class="nc" id="L406">    private class LoginTextWatcher implements TextWatcher {</span>
        @Override
        public void beforeTextChanged(CharSequence charSequence, int start, int count, int after) {
<span class="nc" id="L409">        }</span>

        @Override
        public void onTextChanged(CharSequence charSequence, int start, int count, int after) {
<span class="nc" id="L413">        }</span>

        @Override
        public void afterTextChanged(Editable editable) {
<span class="nc bnc" id="L417" title="All 2 branches missed.">            boolean enabled = binding.loginUsername.getText().length() != 0 &amp;&amp;</span>
<span class="nc bnc" id="L418" title="All 4 branches missed.">                binding.loginPassword.getText().length() != 0 &amp;&amp;</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                (BuildConfig.DEBUG || binding.loginTwoFactor.getText().length() != 0 ||</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">                    binding.loginTwoFactor.getVisibility() != VISIBLE);</span>
<span class="nc" id="L421">            binding.loginButton.setEnabled(enabled);</span>
<span class="nc" id="L422">        }</span>
    }

    public static void startYourself(Context context) {
<span class="nc" id="L426">        Intent intent = new Intent(context, LoginActivity.class);</span>
<span class="nc" id="L427">        context.startActivity(intent);</span>
<span class="nc" id="L428">    }</span>

    @Override
    protected void onSaveInstanceState(Bundle outState) {
        // if progressDialog is visible during the configuration change  then store state as  true else false so that
        // we maintain visibility of progressDailog after configuration change
<span class="nc bnc" id="L434" title="All 4 branches missed.">        if(progressDialog!=null&amp;&amp;progressDialog.isShowing()) {</span>
<span class="nc" id="L435">            outState.putBoolean(saveProgressDailog,true);</span>
        } else {
<span class="nc" id="L437">            outState.putBoolean(saveProgressDailog,false);</span>
        }
<span class="nc" id="L439">        outState.putString(saveErrorMessage,binding.errorMessage.getText().toString()); //Save the errorMessage</span>
<span class="nc" id="L440">        outState.putString(saveUsername,getUsername()); // Save the username</span>
<span class="nc" id="L441">        outState.putString(savePassword,getPassword()); // Save the password</span>
<span class="nc" id="L442">    }</span>
    private String getUsername() {
<span class="nc" id="L444">        return binding.loginUsername.getText().toString();</span>
    }
    private String getPassword(){
<span class="nc" id="L447">        return  binding.loginPassword.getText().toString();</span>
  }

    @Override
    protected void onRestoreInstanceState(final Bundle savedInstanceState) {
<span class="nc" id="L452">        super.onRestoreInstanceState(savedInstanceState);</span>
<span class="nc" id="L453">        binding.loginUsername.setText(savedInstanceState.getString(saveUsername));</span>
<span class="nc" id="L454">        binding.loginPassword.setText(savedInstanceState.getString(savePassword));</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">        if(savedInstanceState.getBoolean(saveProgressDailog)) {</span>
<span class="nc" id="L456">            performLogin();</span>
        }
<span class="nc" id="L458">        String errorMessage=savedInstanceState.getString(saveErrorMessage);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if(sessionManager.isUserLoggedIn()) {</span>
<span class="nc" id="L460">            showMessage(R.string.login_success, R.color.primaryDarkColor);</span>
        } else {
<span class="nc" id="L462">            showMessage(errorMessage, R.color.secondaryDarkColor);</span>
        }
<span class="nc" id="L464">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>