<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TransformGestureDetector.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.media.zoomControllers.gestures</a> &gt; <span class="el_source">TransformGestureDetector.java</span></div><h1>TransformGestureDetector.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.media.zoomControllers.gestures;

import android.view.MotionEvent;

/**
 * Component that detects translation, scale and rotation based on touch events.
 *
 * This class notifies its listeners whenever a gesture begins, updates or ends. The instance of
 * this detector is passed to the listeners, so it can be queried for pivot, translation, scale or
 * rotation.
 */
public class TransformGestureDetector implements MultiPointerGestureDetector.Listener {

    /** The listener for receiving notifications when gestures occur. */
    public interface Listener {
        /** A callback called right before the gesture is about to start. */
        public void onGestureBegin(TransformGestureDetector detector);

        /** A callback called each time the gesture gets updated. */
        public void onGestureUpdate(TransformGestureDetector detector);

        /** A callback called right after the gesture has finished. */
        public void onGestureEnd(TransformGestureDetector detector);
    }

    private final MultiPointerGestureDetector mDetector;

<span class="nc" id="L28">    private Listener mListener = null;</span>

<span class="nc" id="L30">    public TransformGestureDetector(MultiPointerGestureDetector multiPointerGestureDetector) {</span>
<span class="nc" id="L31">        mDetector = multiPointerGestureDetector;</span>
<span class="nc" id="L32">        mDetector.setListener(this);</span>
<span class="nc" id="L33">    }</span>

    /** Factory method that creates a new instance of TransformGestureDetector */
    public static TransformGestureDetector newInstance() {
<span class="nc" id="L37">        return new TransformGestureDetector(MultiPointerGestureDetector.newInstance());</span>
    }

    /**
     * Sets the listener.
     *
     * @param listener listener to set
     */
    public void setListener(Listener listener) {
<span class="nc" id="L46">        mListener = listener;</span>
<span class="nc" id="L47">    }</span>

    /** Resets the component to the initial state. */
    public void reset() {
<span class="nc" id="L51">        mDetector.reset();</span>
<span class="nc" id="L52">    }</span>

    /**
     * Handles the given motion event.
     *
     * @param event event to handle
     * @return whether or not the event was handled
     */
    public boolean onTouchEvent(final MotionEvent event) {
<span class="nc" id="L61">        return mDetector.onTouchEvent(event);</span>
    }

    @Override
    public void onGestureBegin(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (mListener != null) {</span>
<span class="nc" id="L67">            mListener.onGestureBegin(this);</span>
        }
<span class="nc" id="L69">    }</span>

    @Override
    public void onGestureUpdate(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L73" title="All 2 branches missed.">        if (mListener != null) {</span>
<span class="nc" id="L74">            mListener.onGestureUpdate(this);</span>
        }
<span class="nc" id="L76">    }</span>

    @Override
    public void onGestureEnd(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (mListener != null) {</span>
<span class="nc" id="L81">            mListener.onGestureEnd(this);</span>
        }
<span class="nc" id="L83">    }</span>

    private float calcAverage(float[] arr, int len) {
<span class="nc" id="L86">        float sum = 0;</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="nc" id="L88">            sum += arr[i];</span>
        }
<span class="nc bnc" id="L90" title="All 2 branches missed.">        return (len &gt; 0) ? sum / len : 0;</span>
    }

    /** Restarts the current gesture (if any). */
    public void restartGesture() {
<span class="nc" id="L95">        mDetector.restartGesture();</span>
<span class="nc" id="L96">    }</span>

    /** Gets whether there is a gesture in progress */
    public boolean isGestureInProgress() {
<span class="nc" id="L100">        return mDetector.isGestureInProgress();</span>
    }

    /** Gets the number of pointers after the current gesture */
    public int getNewPointerCount() {
<span class="nc" id="L105">        return mDetector.getNewPointerCount();</span>
    }

    /** Gets the number of pointers in the current gesture */
    public int getPointerCount() {
<span class="nc" id="L110">        return mDetector.getPointerCount();</span>
    }

    /** Gets the X coordinate of the pivot point */
    public float getPivotX() {
<span class="nc" id="L115">        return calcAverage(mDetector.getStartX(), mDetector.getPointerCount());</span>
    }

    /** Gets the Y coordinate of the pivot point */
    public float getPivotY() {
<span class="nc" id="L120">        return calcAverage(mDetector.getStartY(), mDetector.getPointerCount());</span>
    }

    /** Gets the X component of the translation */
    public float getTranslationX() {
<span class="nc" id="L125">        return calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount())</span>
<span class="nc" id="L126">                - calcAverage(mDetector.getStartX(), mDetector.getPointerCount());</span>
    }

    /** Gets the Y component of the translation */
    public float getTranslationY() {
<span class="nc" id="L131">        return calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount())</span>
<span class="nc" id="L132">                - calcAverage(mDetector.getStartY(), mDetector.getPointerCount());</span>
    }

    /** Gets the scale */
    public float getScale() {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (mDetector.getPointerCount() &lt; 2) {</span>
<span class="nc" id="L138">            return 1;</span>
        } else {
<span class="nc" id="L140">            float startDeltaX = mDetector.getStartX()[1] - mDetector.getStartX()[0];</span>
<span class="nc" id="L141">            float startDeltaY = mDetector.getStartY()[1] - mDetector.getStartY()[0];</span>
<span class="nc" id="L142">            float currentDeltaX = mDetector.getCurrentX()[1] - mDetector.getCurrentX()[0];</span>
<span class="nc" id="L143">            float currentDeltaY = mDetector.getCurrentY()[1] - mDetector.getCurrentY()[0];</span>
<span class="nc" id="L144">            float startDist = (float) Math.hypot(startDeltaX, startDeltaY);</span>
<span class="nc" id="L145">            float currentDist = (float) Math.hypot(currentDeltaX, currentDeltaY);</span>
<span class="nc" id="L146">            return currentDist / startDist;</span>
        }
    }

    /** Gets the rotation in radians */
    public float getRotation() {
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (mDetector.getPointerCount() &lt; 2) {</span>
<span class="nc" id="L153">            return 0;</span>
        } else {
<span class="nc" id="L155">            float startDeltaX = mDetector.getStartX()[1] - mDetector.getStartX()[0];</span>
<span class="nc" id="L156">            float startDeltaY = mDetector.getStartY()[1] - mDetector.getStartY()[0];</span>
<span class="nc" id="L157">            float currentDeltaX = mDetector.getCurrentX()[1] - mDetector.getCurrentX()[0];</span>
<span class="nc" id="L158">            float currentDeltaY = mDetector.getCurrentY()[1] - mDetector.getCurrentY()[0];</span>
<span class="nc" id="L159">            float startAngle = (float) Math.atan2(startDeltaY, startDeltaX);</span>
<span class="nc" id="L160">            float currentAngle = (float) Math.atan2(currentDeltaY, currentDeltaX);</span>
<span class="nc" id="L161">            return currentAngle - startAngle;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>