<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Place.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.nearby</a> &gt; <span class="el_source">Place.java</span></div><h1>Place.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.nearby;

import android.net.Uri;
import android.os.Parcel;
import android.os.Parcelable;

import android.text.TextUtils;
import androidx.annotation.Nullable;

import org.apache.commons.lang3.StringUtils;

import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.nearby.model.NearbyResultItem;
import fr.free.nrw.commons.utils.PlaceUtils;
import timber.log.Timber;

/**
 * A single geolocated Wikidata item
 */
public class Place implements Parcelable {

    public final String language;
    public final String name;
    private final Label label;
    private final String longDescription;
    public final LatLng location;
    private final String category;
    public final String pic;
    // exists boolean will tell whether the place exists or not,
    // For a place to be existing both destroyed and endTime property should be null but it is also not necessary for a non-existing place to have both properties either one property is enough (in such case that not given property will be considered as null).
    public final Boolean exists;

    public String distance;
    public final Sitelinks siteLinks;
    private boolean isMonument;
    private String thumb;

<span class="nc" id="L38">    public Place() {</span>
<span class="nc" id="L39">        language = null;</span>
<span class="nc" id="L40">        name = null;</span>
<span class="nc" id="L41">        label = null;</span>
<span class="nc" id="L42">        longDescription = null;</span>
<span class="nc" id="L43">        location = null;</span>
<span class="nc" id="L44">        category = null;</span>
<span class="nc" id="L45">        pic = null;</span>
<span class="nc" id="L46">        exists = null;</span>
<span class="nc" id="L47">        siteLinks = null;</span>
<span class="nc" id="L48">    }</span>

<span class="nc" id="L50">    public Place(String language,String name, Label label, String longDescription, LatLng location, String category, Sitelinks siteLinks, String pic, Boolean exists) {</span>
<span class="nc" id="L51">        this.language = language;</span>
<span class="nc" id="L52">        this.name = name;</span>
<span class="nc" id="L53">        this.label = label;</span>
<span class="nc" id="L54">        this.longDescription = longDescription;</span>
<span class="nc" id="L55">        this.location = location;</span>
<span class="nc" id="L56">        this.category = category;</span>
<span class="nc" id="L57">        this.siteLinks = siteLinks;</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">        this.pic = (pic == null) ? &quot;&quot;:pic;</span>
<span class="nc" id="L59">        this.exists = exists;</span>
<span class="nc" id="L60">    }</span>

<span class="nc" id="L62">    public Place(String name, String longDescription, LatLng location, String category, Sitelinks siteLinks, String pic, String thumb) {</span>
<span class="nc" id="L63">        this.name = name;</span>
<span class="nc" id="L64">        this.longDescription = longDescription;</span>
<span class="nc" id="L65">        this.location = location;</span>
<span class="nc" id="L66">        this.category = category;</span>
<span class="nc" id="L67">        this.siteLinks = siteLinks;</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">        this.pic = (pic == null) ? &quot;&quot;:pic;</span>
<span class="nc" id="L69">        this.thumb = thumb;</span>
<span class="nc" id="L70">        this.language = null;</span>
<span class="nc" id="L71">        this.label = null;</span>
<span class="nc" id="L72">        this.exists = true;</span>
<span class="nc" id="L73">    }</span>

<span class="nc" id="L75">    public Place(Parcel in) {</span>
<span class="nc" id="L76">        this.language = in.readString();</span>
<span class="nc" id="L77">        this.name = in.readString();</span>
<span class="nc" id="L78">        this.label = (Label) in.readSerializable();</span>
<span class="nc" id="L79">        this.longDescription = in.readString();</span>
<span class="nc" id="L80">        this.location = in.readParcelable(LatLng.class.getClassLoader());</span>
<span class="nc" id="L81">        this.category = in.readString();</span>
<span class="nc" id="L82">        this.siteLinks = in.readParcelable(Sitelinks.class.getClassLoader());</span>
<span class="nc" id="L83">        String picString = in.readString();</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">        this.pic = (picString == null) ? &quot;&quot;:picString;</span>
<span class="nc" id="L85">        String existString = in.readString();</span>
<span class="nc" id="L86">        this.exists = Boolean.parseBoolean(existString);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        this.isMonument = in.readInt() == 1;</span>
<span class="nc" id="L88">    }</span>
    public static Place from(NearbyResultItem item) {
<span class="nc" id="L90">        String itemClass = item.getClassName().getValue();</span>
<span class="nc" id="L91">        String classEntityId = &quot;&quot;;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if(!StringUtils.isBlank(itemClass)) {</span>
<span class="nc" id="L93">            classEntityId = itemClass.replace(&quot;http://www.wikidata.org/entity/&quot;, &quot;&quot;);</span>
        }
        // Set description when not null and not empty
<span class="nc bnc" id="L96" title="All 4 branches missed.">        String description = (item.getDescription().getValue() != null &amp;&amp; !item.getDescription().getValue().isEmpty()) ? item.getDescription().getValue() : &quot;&quot;;</span>
        // When description is &quot;?&quot; but we have a valid label, just use the label. So replace &quot;?&quot; by &quot;&quot; in description
<span class="nc bnc" id="L98" title="All 2 branches missed.">        description = (description.equals(&quot;?&quot;)</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">            &amp;&amp; (item.getLabel().getValue() != null</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">            &amp;&amp; !item.getLabel().getValue().isEmpty()) ? &quot;&quot; : description);</span>
        /*
         * If we have a valid label
         *     - If have a valid label add the description at the end of the string with parenthesis
         *     - If we don't have a valid label, string will include only the description. So add it without paranthesis
         */
<span class="nc bnc" id="L106" title="All 4 branches missed.">        description = ((item.getLabel().getValue() != null &amp;&amp; !item.getLabel().getValue().isEmpty())</span>
<span class="nc" id="L107">            ? item.getLabel().getValue()</span>
<span class="nc bnc" id="L108" title="All 4 branches missed.">                + ((description != null &amp;&amp; !description.isEmpty())</span>
<span class="nc" id="L109">                ? &quot; (&quot; + description + &quot;)&quot; : &quot;&quot;)</span>
<span class="nc" id="L110">            : description);</span>
<span class="nc" id="L111">        return new Place(</span>
<span class="nc" id="L112">            item.getLabel().getLanguage(),</span>
<span class="nc" id="L113">            item.getLabel().getValue(),</span>
<span class="nc" id="L114">            Label.fromText(classEntityId), // list</span>
            description, // description and label of Wikidata item
<span class="nc" id="L116">            PlaceUtils.latLngFromPointString(item.getLocation().getValue()),</span>
<span class="nc" id="L117">            item.getCommonsCategory().getValue(),</span>
            new Sitelinks.Builder()
<span class="nc" id="L119">                .setWikipediaLink(item.getWikipediaArticle().getValue())</span>
<span class="nc" id="L120">                .setCommonsLink(item.getCommonsArticle().getValue())</span>
<span class="nc" id="L121">                .setWikidataLink(item.getItem().getValue())</span>
<span class="nc" id="L122">                .build(),</span>
<span class="nc" id="L123">            item.getPic().getValue(),</span>
            // Checking if the place exists or not
<span class="nc bnc" id="L125" title="All 4 branches missed.">            (item.getDestroyed().getValue() == &quot;&quot;) &amp;&amp; (item.getEndTime().getValue() == &quot;&quot;));</span>
    }

    /**
     * Gets the language of the caption ie name.
     * @return language
     */
    public String getLanguage() {
<span class="nc" id="L133">        return language;</span>
    }

    /**
     * Gets the name of the place
     * @return name
     */
<span class="nc" id="L140">    public String getName() { return name; }</span>

    /** Gets the label of the place
     * e.g. &quot;building&quot;, &quot;city&quot;, etc
     * @return label
     */
    public Label getLabel() {
<span class="nc" id="L147">        return label;</span>
    }

    public LatLng getLocation() {
<span class="nc" id="L151">        return location;</span>
    }

    /**
     * Gets the long description of the place
     * @return long description
     */
    public String getLongDescription() {
<span class="nc" id="L159">        return longDescription;</span>
    }

    /**
     * Gets the Commons category of the place
     * @return Commons category
     */
<span class="nc" id="L166">    public String getCategory() {return category; }</span>

    /**
     * Sets the distance of the place from the user's location
     * @param distance distance of place from user's location
     */
    public void setDistance(String distance) {
<span class="nc" id="L173">        this.distance = distance;</span>
<span class="nc" id="L174">    }</span>

    /**
     * Extracts the entity id from the wikidata link
     * @return returns the entity id if wikidata link destroyed
     */
    @Nullable
    public String getWikiDataEntityId() {
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (!hasWikidataLink()) {</span>
<span class="nc" id="L183">            Timber.d(&quot;Wikidata entity ID is null for place with sitelink %s&quot;, siteLinks.toString());</span>
<span class="nc" id="L184">            return null;</span>
        }

<span class="nc" id="L187">        String wikiDataLink = siteLinks.getWikidataLink().toString();</span>
<span class="nc" id="L188">        return wikiDataLink.replace(&quot;http://www.wikidata.org/entity/&quot;, &quot;&quot;);</span>
    }

    /**
     * Checks if the Wikidata item has a Wikipedia page associated with it
     * @return true if there is a Wikipedia link
     */
    public boolean hasWikipediaLink() {
<span class="nc bnc" id="L196" title="All 4 branches missed.">        return !(siteLinks == null || Uri.EMPTY.equals(siteLinks.getWikipediaLink()));</span>
    }

    /**
     * Checks if the Wikidata item has a Wikidata page associated with it
     * @return true if there is a Wikidata link
     */
    public boolean hasWikidataLink() {
<span class="nc bnc" id="L204" title="All 4 branches missed.">        return !(siteLinks == null || Uri.EMPTY.equals(siteLinks.getWikidataLink()));</span>
    }

    /**
     * Checks if the Wikidata item has a Commons page associated with it
     * @return true if there is a Commons link
     */
    public boolean hasCommonsLink() {
<span class="nc bnc" id="L212" title="All 4 branches missed.">        return !(siteLinks == null || Uri.EMPTY.equals(siteLinks.getCommonsLink()));</span>
    }

    /**
     * Sets that this place in nearby is a WikiData monument
     * @param monument
     */
    public void setMonument(final boolean monument) {
<span class="nc" id="L220">        isMonument = monument;</span>
<span class="nc" id="L221">    }</span>

    /**
     * Returns if this place is a WikiData monument
     * @return
     */
    public boolean isMonument() {
<span class="nc" id="L228">        return isMonument;</span>
    }

    /**
     * Check if we already have the exact same Place
     * @param o Place being tested
     * @return true if name and location of Place is exactly the same
     */
    @Override
    public boolean equals(Object o) {
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (o instanceof Place) {</span>
<span class="nc" id="L239">            Place that = (Place) o;</span>
<span class="nc bnc" id="L240" title="All 4 branches missed.">            return this.name.equals(that.name) &amp;&amp; this.location.equals(that.location);</span>
        } else {
<span class="nc" id="L242">            return false;</span>
        }
    }

    @Override
    public int hashCode() {
<span class="nc" id="L248">        return this.name.hashCode() * 31 + this.location.hashCode();</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L253">        return &quot;Place{&quot; +</span>
                &quot;name='&quot; + name + '\'' +
                &quot;, lang='&quot; + language + '\'' +
                &quot;, label='&quot; + label + '\'' +
                &quot;, longDescription='&quot; + longDescription + '\'' +
                &quot;, location='&quot; + location + '\'' +
                &quot;, category='&quot; + category + '\'' +
                &quot;, distance='&quot; + distance + '\'' +
<span class="nc" id="L261">                &quot;, siteLinks='&quot; + siteLinks.toString() + '\'' +</span>
                &quot;, pic='&quot; + pic + '\'' +
<span class="nc" id="L263">                &quot;, exists='&quot; + exists.toString() + '\'' +</span>
                '}';
    }

    @Override
    public int describeContents() {
<span class="nc" id="L269">        return 0;</span>
    }

    @Override
    public void writeToParcel(Parcel dest, int flags) {
<span class="nc" id="L274">        dest.writeString(language);</span>
<span class="nc" id="L275">        dest.writeString(name);</span>
<span class="nc" id="L276">        dest.writeSerializable(label);</span>
<span class="nc" id="L277">        dest.writeString(longDescription);</span>
<span class="nc" id="L278">        dest.writeParcelable(location, 0);</span>
<span class="nc" id="L279">        dest.writeString(category);</span>
<span class="nc" id="L280">        dest.writeParcelable(siteLinks, 0);</span>
<span class="nc" id="L281">        dest.writeString(pic);</span>
<span class="nc" id="L282">        dest.writeString(exists.toString());</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        dest.writeInt(isMonument ? 1 : 0);</span>
<span class="nc" id="L284">    }</span>

<span class="nc" id="L286">    public static final Creator&lt;Place&gt; CREATOR = new Creator&lt;Place&gt;() {</span>
        @Override
        public Place createFromParcel(Parcel in) {
<span class="nc" id="L289">            return new Place(in);</span>
        }

        @Override
        public Place[] newArray(int size) {
<span class="nc" id="L294">            return new Place[size];</span>
        }
    };

    public String getThumb() {
<span class="nc" id="L299">        return thumb;</span>
    }

    public void setThumb(String thumb) {
<span class="nc" id="L303">        this.thumb = thumb;</span>
<span class="nc" id="L304">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>