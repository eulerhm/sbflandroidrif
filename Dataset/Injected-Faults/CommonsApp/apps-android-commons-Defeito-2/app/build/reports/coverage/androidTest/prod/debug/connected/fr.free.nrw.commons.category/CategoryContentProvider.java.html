<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CategoryContentProvider.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.category</a> &gt; <span class="el_source">CategoryContentProvider.java</span></div><h1>CategoryContentProvider.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.category;

import android.content.ContentValues;
import android.content.UriMatcher;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteQueryBuilder;
import android.net.Uri;
import android.text.TextUtils;

import androidx.annotation.NonNull;

import javax.inject.Inject;

import fr.free.nrw.commons.BuildConfig;
import fr.free.nrw.commons.data.DBOpenHelper;
import fr.free.nrw.commons.di.CommonsDaggerContentProvider;
import timber.log.Timber;

import static android.content.UriMatcher.NO_MATCH;
import static fr.free.nrw.commons.category.CategoryDao.Table.ALL_FIELDS;
import static fr.free.nrw.commons.category.CategoryDao.Table.COLUMN_ID;
import static fr.free.nrw.commons.category.CategoryDao.Table.TABLE_NAME;

<span class="fc" id="L25">public class CategoryContentProvider extends CommonsDaggerContentProvider {</span>

    // For URI matcher
    private static final int CATEGORIES = 1;
    private static final int CATEGORIES_ID = 2;
    private static final String BASE_PATH = &quot;categories&quot;;

<span class="fc" id="L32">    public static final Uri BASE_URI = Uri.parse(&quot;content://&quot; + BuildConfig.CATEGORY_AUTHORITY + &quot;/&quot; + BASE_PATH);</span>

<span class="fc" id="L34">    private static final UriMatcher uriMatcher = new UriMatcher(NO_MATCH);</span>

    static {
<span class="fc" id="L37">        uriMatcher.addURI(BuildConfig.CATEGORY_AUTHORITY, BASE_PATH, CATEGORIES);</span>
<span class="fc" id="L38">        uriMatcher.addURI(BuildConfig.CATEGORY_AUTHORITY, BASE_PATH + &quot;/#&quot;, CATEGORIES_ID);</span>
<span class="fc" id="L39">    }</span>

    public static Uri uriForId(int id) {
<span class="nc" id="L42">        return Uri.parse(BASE_URI.toString() + &quot;/&quot; + id);</span>
    }

    @Inject DBOpenHelper dbOpenHelper;

    @SuppressWarnings(&quot;ConstantConditions&quot;)
    @Override
    public Cursor query(@NonNull Uri uri, String[] projection, String selection,
                        String[] selectionArgs, String sortOrder) {
<span class="nc" id="L51">        SQLiteQueryBuilder queryBuilder = new SQLiteQueryBuilder();</span>
<span class="nc" id="L52">        queryBuilder.setTables(TABLE_NAME);</span>

<span class="nc" id="L54">        int uriType = uriMatcher.match(uri);</span>

<span class="nc" id="L56">        SQLiteDatabase db = dbOpenHelper.getReadableDatabase();</span>
        Cursor cursor;

<span class="nc bnc" id="L59" title="All 3 branches missed.">        switch (uriType) {</span>
            case CATEGORIES:
<span class="nc" id="L61">                cursor = queryBuilder.query(db, projection, selection, selectionArgs,</span>
                        null, null, sortOrder);
<span class="nc" id="L63">                break;</span>
            case CATEGORIES_ID:
<span class="nc" id="L65">                cursor = queryBuilder.query(db,</span>
                        ALL_FIELDS,
                        &quot;_id = ?&quot;,
<span class="nc" id="L68">                        new String[]{uri.getLastPathSegment()},</span>
                        null,
                        null,
                        sortOrder
                );
<span class="nc" id="L73">                break;</span>
            default:
<span class="nc" id="L75">                throw new IllegalArgumentException(&quot;Unknown URI&quot; + uri);</span>
        }

<span class="nc" id="L78">        cursor.setNotificationUri(getContext().getContentResolver(), uri);</span>

<span class="nc" id="L80">        return cursor;</span>
    }

    @Override
    public String getType(@NonNull Uri uri) {
<span class="nc" id="L85">        return null;</span>
    }

    @SuppressWarnings(&quot;ConstantConditions&quot;)
    @Override
    public Uri insert(@NonNull Uri uri, ContentValues contentValues) {
<span class="nc" id="L91">        int uriType = uriMatcher.match(uri);</span>
<span class="nc" id="L92">        SQLiteDatabase sqlDB = dbOpenHelper.getWritableDatabase();</span>
        long id;
<span class="nc bnc" id="L94" title="All 2 branches missed.">        switch (uriType) {</span>
            case CATEGORIES:
<span class="nc" id="L96">                id = sqlDB.insert(TABLE_NAME, null, contentValues);</span>
<span class="nc" id="L97">                break;</span>
            default:
<span class="nc" id="L99">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
<span class="nc" id="L101">        getContext().getContentResolver().notifyChange(uri, null);</span>
<span class="nc" id="L102">        return Uri.parse(BASE_URI + &quot;/&quot; + id);</span>
    }

    @Override
    public int delete(@NonNull Uri uri, String s, String[] strings) {
<span class="nc" id="L107">        return 0;</span>
    }

    @SuppressWarnings(&quot;ConstantConditions&quot;)
    @Override
    public int bulkInsert(@NonNull Uri uri, @NonNull ContentValues[] values) {
<span class="nc" id="L113">        Timber.d(&quot;Hello, bulk insert! (CategoryContentProvider)&quot;);</span>
<span class="nc" id="L114">        int uriType = uriMatcher.match(uri);</span>
<span class="nc" id="L115">        SQLiteDatabase sqlDB = dbOpenHelper.getWritableDatabase();</span>
<span class="nc" id="L116">        sqlDB.beginTransaction();</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">        switch (uriType) {</span>
            case CATEGORIES:
<span class="nc bnc" id="L119" title="All 2 branches missed.">                for (ContentValues value : values) {</span>
<span class="nc" id="L120">                    Timber.d(&quot;Inserting! %s&quot;, value);</span>
<span class="nc" id="L121">                    sqlDB.insert(TABLE_NAME, null, value);</span>
                }
<span class="nc" id="L123">                break;</span>
            default:
<span class="nc" id="L125">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
<span class="nc" id="L127">        sqlDB.setTransactionSuccessful();</span>
<span class="nc" id="L128">        sqlDB.endTransaction();</span>
<span class="nc" id="L129">        getContext().getContentResolver().notifyChange(uri, null);</span>
<span class="nc" id="L130">        return values.length;</span>
    }

    @SuppressWarnings(&quot;ConstantConditions&quot;)
    @Override
    public int update(@NonNull Uri uri, ContentValues contentValues, String selection,
                      String[] selectionArgs) {
        /*
        SQL Injection warnings: First, note that we're not exposing this to the
        outside world (exported=&quot;false&quot;). Even then, we should make sure to sanitize
        all user input appropriately. Input that passes through ContentValues
        should be fine. So only issues are those that pass in via concating.

        In here, the only concat created argument is for id. It is cast to an int,
        and will error out otherwise.
         */
<span class="nc" id="L146">        int uriType = uriMatcher.match(uri);</span>
<span class="nc" id="L147">        SQLiteDatabase sqlDB = dbOpenHelper.getWritableDatabase();</span>
        int rowsUpdated;
<span class="nc bnc" id="L149" title="All 2 branches missed.">        switch (uriType) {</span>
            case CATEGORIES_ID:
<span class="nc bnc" id="L151" title="All 2 branches missed.">                if (TextUtils.isEmpty(selection)) {</span>
<span class="nc" id="L152">                    int id = Integer.valueOf(uri.getLastPathSegment());</span>
<span class="nc" id="L153">                    rowsUpdated = sqlDB.update(TABLE_NAME,</span>
                            contentValues,
                            COLUMN_ID + &quot; = ?&quot;,
<span class="nc" id="L156">                            new String[]{String.valueOf(id)});</span>
<span class="nc" id="L157">                } else {</span>
<span class="nc" id="L158">                    throw new IllegalArgumentException(</span>
                            &quot;Parameter `selection` should be empty when updating an ID&quot;);
                }
                break;
            default:
<span class="nc" id="L163">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri + &quot; with type &quot; + uriType);</span>
        }
<span class="nc" id="L165">        getContext().getContentResolver().notifyChange(uri, null);</span>
<span class="nc" id="L166">        return rowsUpdated;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>