<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Utils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons</a> &gt; <span class="el_source">Utils.java</span></div><h1>Utils.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons;

import android.content.ClipData;
import android.content.ClipboardManager;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.net.Uri;
import android.text.SpannableString;
import android.text.style.UnderlineSpan;
import android.view.View;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.browser.customtabs.CustomTabColorSchemeParams;
import androidx.browser.customtabs.CustomTabsIntent;
import androidx.core.content.ContextCompat;

import fr.free.nrw.commons.kvstore.JsonKvStore;
import java.util.Calendar;
import java.util.Date;
import org.wikipedia.dataclient.WikiSite;
import org.wikipedia.page.PageTitle;

import java.util.Locale;
import java.util.regex.Pattern;

import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.settings.Prefs;
import fr.free.nrw.commons.utils.ViewUtil;
import timber.log.Timber;

import static android.widget.Toast.LENGTH_SHORT;
import static fr.free.nrw.commons.campaigns.CampaignView.CAMPAIGNS_DEFAULT_PREFERENCE;

<span class="nc" id="L37">public class Utils {</span>

    public static PageTitle getPageTitle(@NonNull String title) {
<span class="nc" id="L40">        return new PageTitle(title, new WikiSite(BuildConfig.COMMONS_URL));</span>
    }

    /**
     * Generates licence name with given ID
     * @param license License ID
     * @return Name of license
     */
    public static int licenseNameFor(String license) {
<span class="nc bnc" id="L49" title="All 6 branches missed.">        switch (license) {</span>
            case Prefs.Licenses.CC_BY_3:
<span class="nc" id="L51">                return R.string.license_name_cc_by;</span>
            case Prefs.Licenses.CC_BY_4:
<span class="nc" id="L53">                return R.string.license_name_cc_by_four;</span>
            case Prefs.Licenses.CC_BY_SA_3:
<span class="nc" id="L55">                return R.string.license_name_cc_by_sa;</span>
            case Prefs.Licenses.CC_BY_SA_4:
<span class="nc" id="L57">                return R.string.license_name_cc_by_sa_four;</span>
            case Prefs.Licenses.CC0:
<span class="nc" id="L59">                return R.string.license_name_cc0;</span>
        }
<span class="nc" id="L61">        throw new IllegalStateException(&quot;Unrecognized license value: &quot; + license);</span>
    }

    /**
     * Generates license url with given ID
     * @param license License ID
     * @return Url of license
     */


    @NonNull
    public static String licenseUrlFor(String license) {
<span class="nc bnc" id="L73" title="All 6 branches missed.">        switch (license) {</span>
            case Prefs.Licenses.CC_BY_3:
<span class="nc" id="L75">                return &quot;https://creativecommons.org/licenses/by/3.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_4:
<span class="nc" id="L77">                return &quot;https://creativecommons.org/licenses/by/4.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_SA_3:
<span class="nc" id="L79">                return &quot;https://creativecommons.org/licenses/by-sa/3.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_SA_4:
<span class="nc" id="L81">                return &quot;https://creativecommons.org/licenses/by-sa/4.0/&quot;;</span>
            case Prefs.Licenses.CC0:
<span class="nc" id="L83">                return &quot;https://creativecommons.org/publicdomain/zero/1.0/&quot;;</span>
            default:
<span class="nc" id="L85">                throw new IllegalStateException(&quot;Unrecognized license value: &quot; + license);</span>
        }
    }

    /**
     * Adds extension to filename. Converts to .jpg if system provides .jpeg, adds .jpg if no extension detected
     * @param title File name
     * @param extension Correct extension
     * @return File with correct extension
     */
    public static String fixExtension(String title, String extension) {
<span class="nc" id="L96">        Pattern jpegPattern = Pattern.compile(&quot;\\.jpeg$&quot;, Pattern.CASE_INSENSITIVE);</span>

        // People are used to &quot;.jpg&quot; more than &quot;.jpeg&quot; which the system gives us.
<span class="nc bnc" id="L99" title="All 4 branches missed.">        if (extension != null &amp;&amp; extension.toLowerCase(Locale.ENGLISH).equals(&quot;jpeg&quot;)) {</span>
<span class="nc" id="L100">            extension = &quot;jpg&quot;;</span>
        }
<span class="nc" id="L102">        title = jpegPattern.matcher(title).replaceFirst(&quot;.jpg&quot;);</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">        if (extension != null &amp;&amp; !title.toLowerCase(Locale.getDefault())</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                .endsWith(&quot;.&quot; + extension.toLowerCase(Locale.ENGLISH))) {</span>
<span class="nc" id="L105">            title += &quot;.&quot; + extension;</span>
        }

        // If extension is still null, make it jpg. (Hotfix for https://github.com/commons-app/apps-android-commons/issues/228)
        // If title has an extension in it, if won't be true
<span class="nc bnc" id="L110" title="All 4 branches missed.">        if (extension == null &amp;&amp; title.lastIndexOf(&quot;.&quot;)&lt;=0) {</span>
<span class="nc" id="L111">           extension = &quot;jpg&quot;;</span>
<span class="nc" id="L112">           title += &quot;.&quot; + extension;</span>
        }

<span class="nc" id="L115">        return title;</span>
    }

    /**
     * Launches intent to rate app
     * @param context
     */
    public static void rateApp(Context context) {
<span class="nc" id="L123">        final String appPackageName = context.getPackageName();</span>
        try {
<span class="nc" id="L125">            context.startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(Urls.PLAY_STORE_PREFIX + appPackageName)));</span>
        }
<span class="nc" id="L127">        catch (android.content.ActivityNotFoundException anfe) {</span>
<span class="nc" id="L128">            handleWebUrl(context, Uri.parse(Urls.PLAY_STORE_URL_PREFIX + appPackageName));</span>
<span class="nc" id="L129">        }</span>
<span class="nc" id="L130">    }</span>

    /**
     * Opens Custom Tab Activity with in-app browser for the specified URL.
     * Launches intent for web URL
     * @param context
     * @param url
     */
    public static void handleWebUrl(Context context, Uri url) {
<span class="nc" id="L139">        Timber.d(&quot;Launching web url %s&quot;, url.toString());</span>
<span class="nc" id="L140">        Intent browserIntent = new Intent(Intent.ACTION_VIEW, url);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (browserIntent.resolveActivity(context.getPackageManager()) == null) {</span>
<span class="nc" id="L142">            Toast toast = Toast.makeText(context, context.getString(R.string.no_web_browser), LENGTH_SHORT);</span>
<span class="nc" id="L143">            toast.show();</span>
<span class="nc" id="L144">            return;</span>
        }

<span class="nc" id="L147">        final CustomTabColorSchemeParams color = new CustomTabColorSchemeParams.Builder()</span>
<span class="nc" id="L148">            .setToolbarColor(ContextCompat.getColor(context, R.color.primaryColor))</span>
<span class="nc" id="L149">            .setSecondaryToolbarColor(ContextCompat.getColor(context, R.color.primaryDarkColor))</span>
<span class="nc" id="L150">            .build();</span>

<span class="nc" id="L152">        CustomTabsIntent.Builder builder = new CustomTabsIntent.Builder();</span>
<span class="nc" id="L153">        builder.setDefaultColorSchemeParams(color);</span>
<span class="nc" id="L154">        builder.setExitAnimations(context, android.R.anim.slide_in_left, android.R.anim.slide_out_right);</span>
<span class="nc" id="L155">        CustomTabsIntent customTabsIntent = builder.build();</span>
        // Clear previous browser tasks, so that back/exit buttons work as intended.
<span class="nc" id="L157">        customTabsIntent.intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK);</span>
<span class="nc" id="L158">        customTabsIntent.launchUrl(context, url);</span>
<span class="nc" id="L159">    }</span>

    /**
     * Util function to handle geo coordinates
     * It no longer depends on google maps and any app capable of handling the map intent can handle it
     * @param context
     * @param latLng
     */
    public static void handleGeoCoordinates(Context context, LatLng latLng) {
<span class="nc" id="L168">        Intent mapIntent = new Intent(Intent.ACTION_VIEW, latLng.getGmmIntentUri());</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (mapIntent.resolveActivity(context.getPackageManager()) != null) {</span>
<span class="nc" id="L170">            context.startActivity(mapIntent);</span>
        } else {
<span class="nc" id="L172">            ViewUtil.showShortToast(context, context.getString(R.string.map_application_missing));</span>
        }
<span class="nc" id="L174">    }</span>

    /**
     * To take screenshot of the screen and return it in Bitmap format
     *
     * @param view
     * @return
     */
    public static Bitmap getScreenShot(View view) {
<span class="nc" id="L183">        View screenView = view.getRootView();</span>
<span class="nc" id="L184">        screenView.setDrawingCacheEnabled(true);</span>
<span class="nc" id="L185">        Bitmap drawingCache = screenView.getDrawingCache();</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (drawingCache != null) {</span>
<span class="nc" id="L187">            Bitmap bitmap = Bitmap.createBitmap(drawingCache);</span>
<span class="nc" id="L188">            screenView.setDrawingCacheEnabled(false);</span>
<span class="nc" id="L189">            return bitmap;</span>
        }
<span class="nc" id="L191">        return null;</span>
    }

    /*
    *Copies the content to the clipboard
    *
    */
    public static void copy(String label,String text, Context context){
<span class="nc" id="L199">        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(Context.CLIPBOARD_SERVICE);</span>
<span class="nc" id="L200">        ClipData clip = ClipData.newPlainText(label, text);</span>
<span class="nc" id="L201">        clipboard.setPrimaryClip(clip);</span>
<span class="nc" id="L202">    }</span>

    /**
     * This method sets underlined string text to a TextView
     *
     * @param textView TextView associated with string resource
     * @param stringResourceName string resource name
     * @param context
     */
    public static void setUnderlinedText(TextView textView, int stringResourceName, Context context) {
<span class="nc" id="L212">        SpannableString content = new SpannableString(context.getString(stringResourceName));</span>
<span class="nc" id="L213">        content.setSpan(new UnderlineSpan(), 0, content.length(), 0);</span>
<span class="nc" id="L214">        textView.setText(content);</span>
<span class="nc" id="L215">    }</span>

    /**
     * For now we are enabling the monuments only when the date lies between 1 Sept &amp; 31 OCt
     * @param date
     * @return
     */
    public static boolean isMonumentsEnabled(final Date date) {
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (date.getMonth() == 8) {</span>
<span class="nc" id="L224">            return true;</span>
        }
<span class="nc" id="L226">        return false;</span>
    }

    /**
     * Util function to get the start date of wlm monument
     * For this release we are hardcoding it to be 1st September
     * @return
     */
    public static String getWLMStartDate() {
<span class="nc" id="L235">        return &quot;1 Sep&quot;;</span>
    }

    /***
     * Util function to get the end date of wlm monument
     * For this release we are hardcoding it to be 31st October
     * @return
     */
    public static String getWLMEndDate() {
<span class="nc" id="L244">        return &quot;30 Sep&quot;;</span>
    }

    /***
     * Function to get the current WLM year
     * It increments at the start of September in line with the other WLM functions
     * (No consideration of locales for now)
     * @param calendar
     * @return
     */
    public static int getWikiLovesMonumentsYear(Calendar calendar) {
<span class="nc" id="L255">        int year = calendar.get(Calendar.YEAR);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (calendar.get(Calendar.MONTH) &lt; Calendar.SEPTEMBER) {</span>
<span class="nc" id="L257">            year -= 1;</span>
        }
<span class="nc" id="L259">        return year;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>