<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExploreFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.explore</a> &gt; <span class="el_source">ExploreFragment.java</span></div><h1>ExploreFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.explore;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.viewpager.widget.ViewPager.OnPageChangeListener;
import butterknife.BindView;
import butterknife.ButterKnife;
import com.google.android.material.tabs.TabLayout;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.ViewPagerAdapter;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.theme.BaseActivity;
import fr.free.nrw.commons.utils.ActivityUtils;
import java.util.ArrayList;
import java.util.List;
import javax.inject.Inject;
import javax.inject.Named;

<span class="nc" id="L29">public class ExploreFragment extends CommonsDaggerSupportFragment {</span>

    private static final String FEATURED_IMAGES_CATEGORY = &quot;Featured_pictures_on_Wikimedia_Commons&quot;;
    private static final String MOBILE_UPLOADS_CATEGORY = &quot;Uploaded_with_Mobile/Android&quot;;
    private static final String EXPLORE_MAP = &quot;Map&quot;;
    private static final String MEDIA_DETAILS_FRAGMENT_TAG = &quot;MediaDetailsFragment&quot;;

    @BindView(R.id.tab_layout)
    TabLayout tabLayout;
    @BindView(R.id.viewPager)
    ParentViewPager viewPager;
    ViewPagerAdapter viewPagerAdapter;
    private ExploreListRootFragment featuredRootFragment;
    private ExploreListRootFragment mobileRootFragment;
    private ExploreMapRootFragment mapRootFragment;
    @Inject
    @Named(&quot;default_preferences&quot;)
    public JsonKvStore applicationKvStore;

    public void setScroll(boolean canScroll){
<span class="nc" id="L49">        viewPager.setCanScroll(canScroll);</span>
<span class="nc" id="L50">    }</span>

    @NonNull
    public static ExploreFragment newInstance() {
<span class="nc" id="L54">        ExploreFragment fragment = new ExploreFragment();</span>
<span class="nc" id="L55">        fragment.setRetainInstance(true);</span>
<span class="nc" id="L56">        return fragment;</span>
    }

    @Override
    public void onCreate(@Nullable final Bundle savedInstanceState) {
<span class="nc" id="L61">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L62">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,
        @Nullable Bundle savedInstanceState) {
<span class="nc" id="L67">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L68">        View view = inflater.inflate(R.layout.fragment_explore, container, false);</span>
<span class="nc" id="L69">        ButterKnife.bind(this, view);</span>
<span class="nc" id="L70">        viewPagerAdapter = new ViewPagerAdapter(getChildFragmentManager());</span>
<span class="nc" id="L71">        viewPager.setAdapter(viewPagerAdapter);</span>
<span class="nc" id="L72">        viewPager.setId(R.id.viewPager);</span>
<span class="nc" id="L73">        tabLayout.setupWithViewPager(viewPager);</span>
<span class="nc" id="L74">        viewPager.addOnPageChangeListener(new OnPageChangeListener() {</span>
            @Override
            public void onPageScrolled(int position, float positionOffset,
                int positionOffsetPixels) {

<span class="nc" id="L79">            }</span>

            @Override
            public void onPageSelected(int position) {
<span class="nc bnc" id="L83" title="All 2 branches missed.">                if (position == 2) {</span>
<span class="nc" id="L84">                    viewPager.setCanScroll(false);</span>
                } else {
<span class="nc" id="L86">                    viewPager.setCanScroll(true);</span>
                }
<span class="nc" id="L88">            }</span>

            @Override
            public void onPageScrollStateChanged(int state) {

<span class="nc" id="L93">            }</span>
        });
<span class="nc" id="L95">        setTabs();</span>
<span class="nc" id="L96">        setHasOptionsMenu(true);</span>
<span class="nc" id="L97">        return view;</span>
    }

    /**
     * Sets the titles in the tabLayout and fragments in the viewPager
     */
    public void setTabs() {
<span class="nc" id="L104">        List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L105">        List&lt;String&gt; titleList = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L107">        Bundle featuredArguments = new Bundle();</span>
<span class="nc" id="L108">        featuredArguments.putString(&quot;categoryName&quot;, FEATURED_IMAGES_CATEGORY);</span>

<span class="nc" id="L110">        Bundle mobileArguments = new Bundle();</span>
<span class="nc" id="L111">        mobileArguments.putString(&quot;categoryName&quot;, MOBILE_UPLOADS_CATEGORY);</span>

<span class="nc" id="L113">        Bundle mapArguments = new Bundle();</span>
<span class="nc" id="L114">        mapArguments.putString(&quot;categoryName&quot;, EXPLORE_MAP);</span>

<span class="nc" id="L116">        featuredRootFragment = new ExploreListRootFragment(featuredArguments);</span>
<span class="nc" id="L117">        mobileRootFragment = new ExploreListRootFragment(mobileArguments);</span>
<span class="nc" id="L118">        mapRootFragment = new ExploreMapRootFragment(mapArguments);</span>
<span class="nc" id="L119">        fragmentList.add(featuredRootFragment);</span>
<span class="nc" id="L120">        titleList.add(getString(R.string.explore_tab_title_featured).toUpperCase());</span>

<span class="nc" id="L122">        fragmentList.add(mobileRootFragment);</span>
<span class="nc" id="L123">        titleList.add(getString(R.string.explore_tab_title_mobile).toUpperCase());</span>

<span class="nc" id="L125">        fragmentList.add(mapRootFragment);</span>
<span class="nc" id="L126">        titleList.add(getString(R.string.explore_tab_title_map).toUpperCase());</span>

<span class="nc" id="L128">        ((MainActivity)getActivity()).showTabs();</span>
<span class="nc" id="L129">        ((BaseActivity) getActivity()).getSupportActionBar().setDisplayHomeAsUpEnabled(false);</span>

<span class="nc" id="L131">        viewPagerAdapter.setTabData(fragmentList, titleList);</span>
<span class="nc" id="L132">        viewPagerAdapter.notifyDataSetChanged();</span>
<span class="nc" id="L133">    }</span>

    public boolean onBackPressed() {
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (tabLayout.getSelectedTabPosition() == 0) {</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">            if (featuredRootFragment.backPressed()) {</span>
<span class="nc" id="L138">                ((BaseActivity) getActivity()).getSupportActionBar()</span>
<span class="nc" id="L139">                    .setDisplayHomeAsUpEnabled(false);</span>
<span class="nc" id="L140">                return true;</span>
            }
<span class="nc bnc" id="L142" title="All 2 branches missed.">        } else if (tabLayout.getSelectedTabPosition() == 1) { //Mobile root fragment</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">            if (mobileRootFragment.backPressed()) {</span>
<span class="nc" id="L144">                ((BaseActivity) getActivity()).getSupportActionBar()</span>
<span class="nc" id="L145">                    .setDisplayHomeAsUpEnabled(false);</span>
<span class="nc" id="L146">                return true;</span>
            }
        } else { //explore map fragment
<span class="nc bnc" id="L149" title="All 2 branches missed.">            if (mapRootFragment.backPressed()) {</span>
<span class="nc" id="L150">                ((BaseActivity) getActivity()).getSupportActionBar()</span>
<span class="nc" id="L151">                    .setDisplayHomeAsUpEnabled(false);</span>
<span class="nc" id="L152">                return true;</span>
            }
        }
<span class="nc" id="L155">        return false;</span>
    }

    /**
     * This method inflates the menu in the toolbar
     */
    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="nc" id="L163">        inflater.inflate(R.menu.menu_search, menu);</span>
<span class="nc" id="L164">        super.onCreateOptionsMenu(menu, inflater);</span>
<span class="nc" id="L165">    }</span>

    /**
     * This method handles the logic on ItemSelect in toolbar menu Currently only 1 choice is
     * available to open search page of the app
     */
    @Override
    public boolean onOptionsItemSelected(MenuItem item) {

        // Handle item selection
<span class="nc bnc" id="L175" title="All 2 branches missed.">        switch (item.getItemId()) {</span>
            case R.id.action_search:
<span class="nc" id="L177">                ActivityUtils.startActivityWithFlags(getActivity(), SearchActivity.class);</span>
<span class="nc" id="L178">                return true;</span>
            default:
<span class="nc" id="L180">                return super.onOptionsItemSelected(item);</span>
        }
    }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>