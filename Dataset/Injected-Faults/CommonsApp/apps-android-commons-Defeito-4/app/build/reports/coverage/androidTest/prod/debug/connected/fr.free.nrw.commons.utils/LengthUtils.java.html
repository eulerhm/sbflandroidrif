<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LengthUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.utils</a> &gt; <span class="el_source">LengthUtils.java</span></div><h1>LengthUtils.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.utils;

import androidx.annotation.NonNull;

import java.text.NumberFormat;

import fr.free.nrw.commons.location.LatLng;

<span class="nc" id="L9">public class LengthUtils {</span>
    /**
     * Returns a formatted distance string between two points.
     *
     * @param point1 LatLng type point1
     * @param point2 LatLng type point2
     * @return string distance
     */
    public static String formatDistanceBetween(LatLng point1, LatLng point2) {
<span class="nc bnc" id="L18" title="All 4 branches missed.">        if (point1 == null || point2 == null) {</span>
<span class="nc" id="L19">            return null;</span>
        }

<span class="nc" id="L22">        int distance = (int) Math.round(computeDistanceBetween(point1, point2));</span>
<span class="nc" id="L23">        return formatDistance(distance);</span>
    }

    /**
     * Format a distance (in meters) as a string
     * Example: 140 -&gt; &quot;140m&quot;
     * 3841 -&gt; &quot;3.8km&quot;
     *
     * @param distance Distance, in meters
     * @return A string representing the distance
     * @throws IllegalArgumentException If distance is negative
     */
    public static String formatDistance(int distance) {
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if (distance &lt; 0) {</span>
<span class="nc" id="L37">            throw new IllegalArgumentException(&quot;Distance must be non-negative&quot;);</span>
        }

<span class="nc" id="L40">        NumberFormat numberFormat = NumberFormat.getNumberInstance();</span>

        // Adjust to km if distance is over 1000m (1km)
<span class="nc bnc" id="L43" title="All 2 branches missed.">        if (distance &gt;= 1000) {</span>
<span class="nc" id="L44">            numberFormat.setMaximumFractionDigits(1);</span>
<span class="nc" id="L45">            return numberFormat.format(distance / 1000.0) + &quot;km&quot;;</span>
        }

        // Otherwise just return in meters
<span class="nc" id="L49">        return numberFormat.format(distance) + &quot;m&quot;;</span>
    }

    /**
     * Computes the distance between two points.
     *
     * @param point1 LatLng type point1
     * @param point2 LatLng type point2
     * @return distance between the points in meters
     * @throws NullPointerException if one or both the points are null
     */
    public static double computeDistanceBetween(@NonNull LatLng point1, @NonNull LatLng point2) {
<span class="nc" id="L61">        return computeAngleBetween(point1, point2) * 6371009.0D; // Earth's radius in meter</span>
    }

    /**
     * Computes angle between two points
     *
     * @param point1 one of the two end points
     * @param point2 one of the two end points
     * @return Angle in radius
     * @throws NullPointerException if one or both the points are null
     */
    private static double computeAngleBetween(@NonNull LatLng point1, @NonNull LatLng point2) {
<span class="nc" id="L73">        return distanceRadians(</span>
<span class="nc" id="L74">                Math.toRadians(point1.getLatitude()),</span>
<span class="nc" id="L75">                Math.toRadians(point1.getLongitude()),</span>
<span class="nc" id="L76">                Math.toRadians(point2.getLatitude()),</span>
<span class="nc" id="L77">                Math.toRadians(point2.getLongitude())</span>
        );
    }

    /**
     * Computes arc length between 2 points
     *
     * @param lat1 Latitude of point A
     * @param lng1 Longitude of point A
     * @param lat2 Latitude of point B
     * @param lng2 Longitude of point B
     * @return Arc length between the points
     */
    private static double distanceRadians(double lat1, double lng1, double lat2, double lng2) {
<span class="nc" id="L91">        return arcHav(havDistance(lat1, lat2, lng1 - lng2));</span>
    }

    /**
     * Computes inverse of haversine
     *
     * @param x Angle in radian
     * @return Inverse of haversine
     */
    private static double arcHav(double x) {
<span class="nc" id="L101">        return 2.0D * Math.asin(Math.sqrt(x));</span>
    }

    /**
     * Computes distance between two points that are on same Longitude
     *
     * @param lat1      Latitude of point A
     * @param lat2      Latitude of point B
     * @param longitude Longitude on which they lie
     * @return Arc length between points
     */
    private static double havDistance(double lat1, double lat2, double longitude) {
<span class="nc" id="L113">        return hav(lat1 - lat2) + hav(longitude) * Math.cos(lat1) * Math.cos(lat2);</span>
    }

    /**
     * Computes haversine
     *
     * @param x Angle in radians
     * @return Haversine of x
     */
    private static double hav(double x) {
<span class="nc" id="L123">        double sinHalf = Math.sin(x * 0.5D);</span>
<span class="nc" id="L124">        return sinHalf * sinHalf;</span>
    }

    /**
     * Computes bearing between the two given points
     *
     * @see &lt;a href=&quot;https://www.movable-type.co.uk/scripts/latlong.html&quot;&gt;Bearing&lt;/a&gt;
     * @param point1 Coordinates of first point
     * @param point2 Coordinates of second point
     * @return Bearing between the two end points in degrees
     * @throws NullPointerException if one or both the points are null
     */
    public static double computeBearing(@NonNull LatLng point1, @NonNull LatLng point2) {
<span class="nc" id="L137">        double diffLongitute = Math.toRadians(point2.getLongitude() - point1.getLongitude());</span>
<span class="nc" id="L138">        double lat1 = Math.toRadians(point1.getLatitude());</span>
<span class="nc" id="L139">        double lat2 = Math.toRadians(point2.getLatitude());</span>
<span class="nc" id="L140">        double y = Math.sin(diffLongitute) * Math.cos(lat2);</span>
<span class="nc" id="L141">        double x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(diffLongitute);</span>
<span class="nc" id="L142">        double bearing = Math.atan2(y, x);</span>
<span class="nc" id="L143">        return (Math.toDegrees(bearing) + 360) % 360;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>