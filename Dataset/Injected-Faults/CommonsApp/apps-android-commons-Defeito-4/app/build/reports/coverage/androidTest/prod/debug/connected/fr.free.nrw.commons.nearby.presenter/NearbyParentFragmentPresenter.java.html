<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NearbyParentFragmentPresenter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.nearby.presenter</a> &gt; <span class="el_source">NearbyParentFragmentPresenter.java</span></div><h1>NearbyParentFragmentPresenter.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.nearby.presenter;

import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.CUSTOM_QUERY;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.LOCATION_SIGNIFICANTLY_CHANGED;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.LOCATION_SLIGHTLY_CHANGED;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.MAP_UPDATED;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.SEARCH_CUSTOM_AREA;
import static fr.free.nrw.commons.nearby.CheckBoxTriStates.CHECKED;
import static fr.free.nrw.commons.nearby.CheckBoxTriStates.UNCHECKED;
import static fr.free.nrw.commons.nearby.CheckBoxTriStates.UNKNOWN;
import static fr.free.nrw.commons.wikidata.WikidataConstants.PLACE_OBJECT;

import android.location.Location;
import android.view.View;
import androidx.annotation.MainThread;
import androidx.annotation.Nullable;
import com.mapbox.mapboxsdk.annotations.Marker;
import fr.free.nrw.commons.bookmarks.locations.BookmarkLocationsDao;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType;
import fr.free.nrw.commons.location.LocationUpdateListener;
import fr.free.nrw.commons.nearby.CheckBoxTriStates;
import fr.free.nrw.commons.nearby.Label;
import fr.free.nrw.commons.nearby.MarkerPlaceGroup;
import fr.free.nrw.commons.nearby.NearbyBaseMarker;
import fr.free.nrw.commons.nearby.NearbyController;
import fr.free.nrw.commons.nearby.NearbyFilterState;
import fr.free.nrw.commons.nearby.contract.NearbyParentFragmentContract;
import fr.free.nrw.commons.utils.LocationUtils;
import fr.free.nrw.commons.wikidata.WikidataEditListener;
import java.lang.reflect.Proxy;
import java.util.HashMap;
import java.util.List;
import timber.log.Timber;

public class NearbyParentFragmentPresenter
    implements NearbyParentFragmentContract.UserActions,
    WikidataEditListener.WikidataP18EditListener,
    LocationUpdateListener {

    private boolean isNearbyLocked;
    private LatLng curLatLng;

    private boolean placesLoadedOnce;

    BookmarkLocationsDao bookmarkLocationDao;

    private @Nullable String customQuery;

<span class="nc" id="L51">    private static final NearbyParentFragmentContract.View DUMMY = (NearbyParentFragmentContract.View) Proxy.newProxyInstance(</span>
<span class="nc" id="L52">        NearbyParentFragmentContract.View.class.getClassLoader(),</span>
        new Class[]{NearbyParentFragmentContract.View.class}, (proxy, method, args) -&gt; {
<span class="nc bnc" id="L54" title="All 2 branches missed.">            if (method.getName().equals(&quot;onMyEvent&quot;)) {</span>
<span class="nc" id="L55">                return null;</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">            } else if (String.class == method.getReturnType()) {</span>
<span class="nc" id="L57">                return &quot;&quot;;</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">            } else if (Integer.class == method.getReturnType()) {</span>
<span class="nc" id="L59">                return Integer.valueOf(0);</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">            } else if (int.class == method.getReturnType()) {</span>
<span class="nc" id="L61">                return 0;</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">            } else if (Boolean.class == method.getReturnType()) {</span>
<span class="nc" id="L63">                return Boolean.FALSE;</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">            } else if (boolean.class == method.getReturnType()) {</span>
<span class="nc" id="L65">                return false;</span>
            } else {
<span class="nc" id="L67">                return null;</span>
            }
        }
    );
<span class="nc" id="L71">    private NearbyParentFragmentContract.View nearbyParentFragmentView = DUMMY;</span>


<span class="nc" id="L74">    public NearbyParentFragmentPresenter(BookmarkLocationsDao bookmarkLocationDao) {</span>
<span class="nc" id="L75">        this.bookmarkLocationDao = bookmarkLocationDao;</span>
<span class="nc" id="L76">    }</span>

    @Override
    public void attachView(NearbyParentFragmentContract.View view) {
<span class="nc" id="L80">        this.nearbyParentFragmentView = view;</span>
<span class="nc" id="L81">    }</span>

    @Override
    public void detachView() {
<span class="nc" id="L85">        this.nearbyParentFragmentView = DUMMY;</span>
<span class="nc" id="L86">    }</span>

    @Override
    public void removeNearbyPreferences(JsonKvStore applicationKvStore) {
<span class="nc" id="L90">        Timber.d(&quot;Remove place objects&quot;);</span>
<span class="nc" id="L91">        applicationKvStore.remove(PLACE_OBJECT);</span>
<span class="nc" id="L92">    }</span>

    public void initializeMapOperations() {
<span class="nc" id="L95">        lockUnlockNearby(false);</span>
<span class="nc" id="L96">        updateMapAndList(LOCATION_SIGNIFICANTLY_CHANGED);</span>
<span class="nc" id="L97">        this.nearbyParentFragmentView.addSearchThisAreaButtonAction();</span>
<span class="nc" id="L98">        nearbyParentFragmentView.setCheckBoxAction();</span>
<span class="nc" id="L99">    }</span>

    /**
     * Sets click listeners of FABs, and 2 bottom sheets
     */
    @Override
    public void setActionListeners(JsonKvStore applicationKvStore) {
<span class="nc" id="L106">        nearbyParentFragmentView.setFABPlusAction(v -&gt; {</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">            if (applicationKvStore.getBoolean(&quot;login_skipped&quot;, false)) {</span>
                // prompt the user to login
<span class="nc" id="L109">                nearbyParentFragmentView.displayLoginSkippedWarning();</span>
            } else {
<span class="nc" id="L111">                nearbyParentFragmentView.animateFABs();</span>
            }
<span class="nc" id="L113">        });</span>

<span class="nc" id="L115">        nearbyParentFragmentView.setFABRecenterAction(v -&gt; {</span>
<span class="nc" id="L116">            nearbyParentFragmentView.recenterMap(curLatLng);</span>
<span class="nc" id="L117">        });</span>

<span class="nc" id="L119">    }</span>

    @Override
    public boolean backButtonClicked() {
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (nearbyParentFragmentView.isAdvancedQueryFragmentVisible()) {</span>
<span class="nc" id="L124">            nearbyParentFragmentView.showHideAdvancedQueryFragment(false);</span>
<span class="nc" id="L125">            return true;</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">        } else if (nearbyParentFragmentView.isListBottomSheetExpanded()) {</span>
            // Back should first hide the bottom sheet if it is expanded
<span class="nc" id="L128">            nearbyParentFragmentView.listOptionMenuItemClicked();</span>
<span class="nc" id="L129">            return true;</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">        } else if (nearbyParentFragmentView.isDetailsBottomSheetVisible()) {</span>
<span class="nc" id="L131">            nearbyParentFragmentView.setBottomSheetDetailsSmaller();</span>
<span class="nc" id="L132">            return true;</span>
        }
<span class="nc" id="L134">        return false;</span>
    }

    public void markerUnselected() {
<span class="nc" id="L138">        nearbyParentFragmentView.hideBottomSheet();</span>
<span class="nc" id="L139">    }</span>


    public void markerSelected(Marker marker) {
<span class="nc" id="L143">        nearbyParentFragmentView.displayBottomSheetWithInfo(marker);</span>
<span class="nc" id="L144">    }</span>


    /**
     * Nearby updates takes time, since they are network operations. During update time, we don't
     * want to get any other calls from user. So locking nearby.
     *
     * @param isNearbyLocked true means lock, false means unlock
     */
    @Override
    public void lockUnlockNearby(boolean isNearbyLocked) {
<span class="nc" id="L155">        this.isNearbyLocked = isNearbyLocked;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (isNearbyLocked) {</span>
<span class="nc" id="L157">            nearbyParentFragmentView.disableFABRecenter();</span>
        } else {
<span class="nc" id="L159">            nearbyParentFragmentView.enableFABRecenter();</span>
        }
<span class="nc" id="L161">    }</span>

    /**
     * This method should be the single point to update Map and List. Triggered by location changes
     *
     * @param locationChangeType defines if location changed significantly or slightly
     */
    @Override
    public void updateMapAndList(LocationChangeType locationChangeType) {
<span class="nc" id="L170">        Timber.d(&quot;Presenter updates map and list&quot;);</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (isNearbyLocked) {</span>
<span class="nc" id="L172">            Timber.d(&quot;Nearby is locked, so updateMapAndList returns&quot;);</span>
<span class="nc" id="L173">            return;</span>
        }

<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (!nearbyParentFragmentView.isNetworkConnectionEstablished()) {</span>
<span class="nc" id="L177">            Timber.d(&quot;Network connection is not established&quot;);</span>
<span class="nc" id="L178">            return;</span>
        }

<span class="nc" id="L181">        LatLng lastLocation = nearbyParentFragmentView.getLastMapFocus();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (nearbyParentFragmentView.getMapCenter() != null) {</span>
<span class="nc" id="L183">            curLatLng = nearbyParentFragmentView.getMapCenter();</span>
        } else {
<span class="nc" id="L185">            curLatLng = lastLocation;</span>
        }
<span class="nc bnc" id="L187" title="All 2 branches missed.">        if (curLatLng == null) {</span>
<span class="nc" id="L188">            Timber.d(&quot;Skipping update of nearby places as location is unavailable&quot;);</span>
<span class="nc" id="L189">            return;</span>
        }

        /**
         * Significant changed - Markers and current location will be updated together
         * Slightly changed - Only current position marker will be updated
         */
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (locationChangeType.equals(CUSTOM_QUERY)) {</span>
<span class="nc" id="L197">            Timber.d(&quot;ADVANCED_QUERY_SEARCH&quot;);</span>
<span class="nc" id="L198">            lockUnlockNearby(true);</span>
<span class="nc" id="L199">            nearbyParentFragmentView.setProgressBarVisibility(true);</span>
<span class="nc" id="L200">            LatLng updatedLocationByUser = LocationUtils.deriveUpdatedLocationFromSearchQuery(</span>
                customQuery);
<span class="nc bnc" id="L202" title="All 2 branches missed.">            if (updatedLocationByUser == null) {</span>
<span class="nc" id="L203">                updatedLocationByUser = lastLocation;</span>
            }
<span class="nc" id="L205">            nearbyParentFragmentView.populatePlaces(updatedLocationByUser, customQuery);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        } else if (locationChangeType.equals(LOCATION_SIGNIFICANTLY_CHANGED)</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            || locationChangeType.equals(MAP_UPDATED)) {</span>
<span class="nc" id="L208">            lockUnlockNearby(true);</span>
<span class="nc" id="L209">            nearbyParentFragmentView.setProgressBarVisibility(true);</span>
<span class="nc" id="L210">            nearbyParentFragmentView.populatePlaces(nearbyParentFragmentView.getMapCenter());</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        } else if (locationChangeType.equals(SEARCH_CUSTOM_AREA)) {</span>
<span class="nc" id="L212">            Timber.d(&quot;SEARCH_CUSTOM_AREA&quot;);</span>
<span class="nc" id="L213">            lockUnlockNearby(true);</span>
<span class="nc" id="L214">            nearbyParentFragmentView.setProgressBarVisibility(true);</span>
<span class="nc" id="L215">            nearbyParentFragmentView.populatePlaces(nearbyParentFragmentView.getMapFocus());</span>
        } else { // Means location changed slightly, ie user is walking or driving.
<span class="nc" id="L217">            Timber.d(&quot;Means location changed slightly&quot;);</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">            if (nearbyParentFragmentView.isCurrentLocationMarkerVisible()) { // Means user wants to see their live location</span>
<span class="nc" id="L219">                nearbyParentFragmentView.recenterMap(curLatLng);</span>
            }
        }
<span class="nc" id="L222">    }</span>

    /**
     * Populates places for custom location, should be used for finding nearby places around a
     * location where you are not at.
     *
     * @param nearbyPlacesInfo This variable has placeToCenter list information and distances.
     */
    public void updateMapMarkers(NearbyController.NearbyPlacesInfo nearbyPlacesInfo,
        Marker selectedMarker, boolean shouldTrackPosition) {
<span class="nc bnc" id="L232" title="All 2 branches missed.">        if (null != nearbyParentFragmentView) {</span>
<span class="nc" id="L233">            nearbyParentFragmentView.clearAllMarkers();</span>
<span class="nc" id="L234">            List&lt;NearbyBaseMarker&gt; nearbyBaseMarkers = NearbyController</span>
<span class="nc" id="L235">                .loadAttractionsFromLocationToBaseMarkerOptions(nearbyPlacesInfo.curLatLng,</span>
                    // Curlatlang will be used to calculate distances
                    nearbyPlacesInfo.placeList,
<span class="nc" id="L238">                    nearbyParentFragmentView.getContext(),</span>
<span class="nc" id="L239">                    bookmarkLocationDao.getAllBookmarksLocations());</span>
<span class="nc" id="L240">            nearbyParentFragmentView.updateMapMarkers(nearbyBaseMarkers, selectedMarker);</span>
<span class="nc" id="L241">            lockUnlockNearby(false); // So that new location updates wont come</span>
<span class="nc" id="L242">            nearbyParentFragmentView.setProgressBarVisibility(false);</span>
<span class="nc" id="L243">            nearbyParentFragmentView.updateListFragment(nearbyPlacesInfo.placeList);</span>
        }
<span class="nc" id="L245">    }</span>

    /**
     * Some centering task may need to wait for map to be ready, if they are requested before map is
     * ready. So we will remember it when the map is ready
     */
    private void handleCenteringTaskIfAny() {
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (!placesLoadedOnce) {</span>
<span class="nc" id="L253">            placesLoadedOnce = true;</span>
<span class="nc" id="L254">            nearbyParentFragmentView.centerMapToPlace(null);</span>
        }
<span class="nc" id="L256">    }</span>

    @Override
    public void onWikidataEditSuccessful() {
<span class="nc" id="L260">        updateMapAndList(MAP_UPDATED);</span>
<span class="nc" id="L261">    }</span>

    @Override
    public void onLocationChangedSignificantly(LatLng latLng) {
<span class="nc" id="L265">        Timber.d(&quot;Location significantly changed&quot;);</span>
<span class="nc" id="L266">        updateMapAndList(LOCATION_SIGNIFICANTLY_CHANGED);</span>
<span class="nc" id="L267">    }</span>

    @Override
    public void onLocationChangedSlightly(LatLng latLng) {
<span class="nc" id="L271">        Timber.d(&quot;Location significantly changed&quot;);</span>
<span class="nc" id="L272">        updateMapAndList(LOCATION_SLIGHTLY_CHANGED);</span>
<span class="nc" id="L273">    }</span>

    @Override
    public void onLocationChangedMedium(LatLng latLng) {
<span class="nc" id="L277">        Timber.d(&quot;Location changed medium&quot;);</span>
<span class="nc" id="L278">    }</span>

    @Override
    public void onCameraMove(com.mapbox.mapboxsdk.geometry.LatLng latLng) {
        // If our nearby markers are calculated at least once
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (NearbyController.latestSearchLocation != null) {</span>
<span class="nc" id="L284">            double distance = latLng.distanceTo</span>
<span class="nc" id="L285">                (LocationUtils.commonsLatLngToMapBoxLatLng(NearbyController.latestSearchLocation));</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">            if (nearbyParentFragmentView.isNetworkConnectionEstablished()) {</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">                if (distance &gt; NearbyController.latestSearchRadius) {</span>
                    //nearbyParentFragmentView.setSearchThisAreaButtonVisibility(true);
                } else {
<span class="nc" id="L290">                    nearbyParentFragmentView.setSearchThisAreaButtonVisibility(false);</span>
                }
            }
<span class="nc" id="L293">        } else {</span>
<span class="nc" id="L294">            nearbyParentFragmentView.setSearchThisAreaButtonVisibility(false);</span>
        }
<span class="nc" id="L296">    }</span>

    @Override
    public void filterByMarkerType(List&lt;Label&gt; selectedLabels, int state,
        boolean filterForPlaceState, boolean filterForAllNoneType) {
<span class="nc bnc" id="L301" title="All 2 branches missed.">        if (filterForAllNoneType) {// Means we will set labels based on states</span>
<span class="nc bnc" id="L302" title="All 4 branches missed.">            switch (state) {</span>
                case UNKNOWN:
                    // Do nothing
<span class="nc" id="L305">                    break;</span>
                case UNCHECKED:
                    //TODO
<span class="nc" id="L308">                    nearbyParentFragmentView.filterOutAllMarkers();</span>
<span class="nc" id="L309">                    nearbyParentFragmentView.setRecyclerViewAdapterItemsGreyedOut();</span>
<span class="nc" id="L310">                    break;</span>
                case CHECKED:
                    // Despite showing all labels NearbyFilterState still should be applied
<span class="nc" id="L313">                    nearbyParentFragmentView.filterMarkersByLabels(selectedLabels,</span>
<span class="nc" id="L314">                        NearbyFilterState.getInstance().isExistsSelected(),</span>
<span class="nc" id="L315">                        NearbyFilterState.getInstance().isNeedPhotoSelected(),</span>
<span class="nc" id="L316">                        NearbyFilterState.getInstance().isWlmSelected(),</span>
                        filterForPlaceState, false);
<span class="nc" id="L318">                    nearbyParentFragmentView.setRecyclerViewAdapterAllSelected();</span>
<span class="nc" id="L319">                    break;</span>
            }
        } else {
<span class="nc" id="L322">            nearbyParentFragmentView.filterMarkersByLabels(selectedLabels,</span>
<span class="nc" id="L323">                NearbyFilterState.getInstance().isExistsSelected(),</span>
<span class="nc" id="L324">                NearbyFilterState.getInstance().isNeedPhotoSelected(),</span>
<span class="nc" id="L325">                NearbyFilterState.getInstance().isWlmSelected(),</span>
                filterForPlaceState, false);
        }
<span class="nc" id="L328">    }</span>

    @Override
    @MainThread
    public void updateMapMarkersToController(List&lt;NearbyBaseMarker&gt; nearbyBaseMarkers) {
<span class="nc" id="L333">        NearbyController.markerExistsMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L334">        NearbyController.markerNeedPicMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L335">        NearbyController.markerLabelList.clear();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">        for (int i = 0; i &lt; nearbyBaseMarkers.size(); i++) {</span>
<span class="nc" id="L337">            NearbyBaseMarker nearbyBaseMarker = nearbyBaseMarkers.get(i);</span>
<span class="nc" id="L338">            NearbyController.markerLabelList.add(</span>
<span class="nc" id="L339">                new MarkerPlaceGroup(nearbyBaseMarker.getMarker(),</span>
<span class="nc" id="L340">                    bookmarkLocationDao.findBookmarkLocation(nearbyBaseMarker.getPlace()),</span>
<span class="nc" id="L341">                    nearbyBaseMarker.getPlace()));</span>
            //TODO: fix bookmark location
<span class="nc" id="L343">            NearbyController.markerExistsMap.put(</span>
<span class="nc" id="L344">                (nearbyBaseMarkers.get(i).getPlace().hasWikidataLink()),</span>
<span class="nc" id="L345">                nearbyBaseMarkers.get(i).getMarker());</span>
<span class="nc" id="L346">            NearbyController.markerNeedPicMap.put(</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">                ((nearbyBaseMarkers.get(i).getPlace().pic == null) ? true : false),</span>
<span class="nc" id="L348">                nearbyBaseMarkers.get(i).getMarker());</span>
        }
<span class="nc" id="L350">    }</span>

    @Override
    public void setCheckboxUnknown() {
<span class="nc" id="L354">        nearbyParentFragmentView.setCheckBoxState(CheckBoxTriStates.UNKNOWN);</span>
<span class="nc" id="L355">    }</span>

    @Override
    public void setAdvancedQuery(String query) {
<span class="nc" id="L359">        this.customQuery = query;</span>
<span class="nc" id="L360">    }</span>

    @Override
    public void searchViewGainedFocus() {
<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (nearbyParentFragmentView.isListBottomSheetExpanded()) {</span>
            // Back should first hide the bottom sheet if it is expanded
<span class="nc" id="L366">            nearbyParentFragmentView.hideBottomSheet();</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">        } else if (nearbyParentFragmentView.isDetailsBottomSheetVisible()) {</span>
<span class="nc" id="L368">            nearbyParentFragmentView.hideBottomDetailsSheet();</span>
        }
<span class="nc" id="L370">    }</span>

    public View.OnClickListener onSearchThisAreaClicked() {
<span class="nc" id="L373">        return v -&gt; {</span>
            // Lock map operations during search this area operation
//            nearbyParentFragmentView.setMapCenter();
<span class="nc" id="L376">            nearbyParentFragmentView.setSearchThisAreaButtonVisibility(false);</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">            if (searchCloseToCurrentLocation()) {</span>
<span class="nc" id="L378">                updateMapAndList(LOCATION_SIGNIFICANTLY_CHANGED);</span>
            } else {
<span class="nc" id="L380">                updateMapAndList(SEARCH_CUSTOM_AREA);</span>
            }
<span class="nc" id="L382">        };</span>
    }

    /**
     * Returns true if search this area button is used around our current location, so that we can
     * continue following our current location again
     *
     * @return Returns true if search this area button is used around our current location
     */
    public boolean searchCloseToCurrentLocation() {
<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (null == nearbyParentFragmentView.getLastMapFocus()) {</span>
<span class="nc" id="L393">            return true;</span>
        }
        //TODO
<span class="nc" id="L396">        Location mylocation = new Location(&quot;&quot;);</span>
<span class="nc" id="L397">        Location dest_location = new Location(&quot;&quot;);</span>
<span class="nc" id="L398">        dest_location.setLatitude(nearbyParentFragmentView.getMapFocus().getLatitude());</span>
<span class="nc" id="L399">        dest_location.setLongitude(nearbyParentFragmentView.getMapFocus().getLongitude());</span>
<span class="nc" id="L400">        mylocation.setLatitude(nearbyParentFragmentView.getLastMapFocus().getLatitude());</span>
<span class="nc" id="L401">        mylocation.setLongitude(nearbyParentFragmentView.getLastMapFocus().getLongitude());</span>
<span class="nc" id="L402">        Float distance = mylocation.distanceTo(dest_location);</span>

<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (distance &gt; 2000.0 * 3 / 4) {</span>
<span class="nc" id="L405">            return false;</span>
        } else {
<span class="nc" id="L407">            return true;</span>
        }
    }

    public void onMapReady() {
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (null != nearbyParentFragmentView) {</span>
<span class="nc" id="L413">            nearbyParentFragmentView.addSearchThisAreaButtonAction();</span>
<span class="nc" id="L414">            initializeMapOperations();</span>
        }
<span class="nc" id="L416">    }</span>

    public boolean areLocationsClose(LatLng cameraTarget, LatLng lastKnownLocation) {
<span class="nc" id="L419">        double distance = LocationUtils.commonsLatLngToMapBoxLatLng(cameraTarget)</span>
<span class="nc" id="L420">            .distanceTo(LocationUtils.commonsLatLngToMapBoxLatLng(lastKnownLocation));</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">        if (distance &gt; NearbyController.currentLocationSearchRadius * 3 / 4) {</span>
<span class="nc" id="L422">            return false;</span>
        } else {
<span class="nc" id="L424">            return true;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>