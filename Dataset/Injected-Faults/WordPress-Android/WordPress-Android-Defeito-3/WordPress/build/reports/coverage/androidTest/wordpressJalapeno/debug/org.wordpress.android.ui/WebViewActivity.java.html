<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebViewActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui</a> &gt; <span class="el_source">WebViewActivity.java</span></div><h1>WebViewActivity.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui;

import android.os.Bundle;
import android.view.MenuItem;
import android.view.View;
import android.view.Window;
import android.webkit.WebView;

import androidx.appcompat.app.ActionBar;
import androidx.appcompat.widget.Toolbar;

import org.wordpress.android.R;
import org.wordpress.android.WordPress;

import java.util.Map;

/**
 * Basic activity for displaying a WebView.
 */
<span class="nc" id="L20">public abstract class WebViewActivity extends LocaleAwareActivity {</span>
    /**
     * Primary webview used to display content.
     */

    private static final String URL = &quot;url&quot;;

    protected WebView mWebView;

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L31">        supportRequestWindowFeature(Window.FEATURE_PROGRESS);</span>

<span class="nc" id="L33">        super.onCreate(savedInstanceState);</span>

        // clear title text so there's no title until actual web page title can be shown
        // this is done here rather than in the manifest to automatically handle descendants
        // such as AuthenticatedWebViewActivity
<span class="nc" id="L38">        setTitle(&quot;&quot;);</span>

<span class="nc" id="L40">        configureView();</span>

<span class="nc" id="L42">        mWebView = (WebView) findViewById(R.id.webView);</span>
<span class="nc" id="L43">        mWebView.setScrollBarStyle(View.SCROLLBARS_INSIDE_OVERLAY);</span>
        // Setting this user agent makes Calypso sites hide any WordPress UIs (e.g. Masterbar, banners, etc.).
<span class="nc" id="L45">        mWebView.getSettings().setUserAgentString(WordPress.getUserAgent());</span>
<span class="nc" id="L46">        configureWebView();</span>

<span class="nc bnc" id="L48" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L49">            loadContent();</span>
        }
<span class="nc" id="L51">    }</span>

    /*
     * load the desired content - only done on initial activity creation (ie: when savedInstanceState
     * is null) since onSaveInstanceState() and onRestoreInstanceState() will take care of saving
     * and restoring the correct URL when the activity is recreated - note that descendants should
     * override this w/o calling super() to load a different URL.
     */
    protected void loadContent() {
<span class="nc" id="L60">        String url = getIntent().getStringExtra(URL);</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (url != null) {</span>
<span class="nc" id="L62">            loadUrl(url);</span>
        }
<span class="nc" id="L64">    }</span>

    /*
     * save the webView state with the bundle so it can be restored
     */
    @Override
    protected void onSaveInstanceState(Bundle outState) {
<span class="nc" id="L71">        mWebView.saveState(outState);</span>
<span class="nc" id="L72">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L73">    }</span>

    /*
     * restore the webView state saved above
     */
    @Override
    protected void onRestoreInstanceState(Bundle savedInstanceState) {
<span class="nc" id="L80">        super.onRestoreInstanceState(savedInstanceState);</span>
<span class="nc" id="L81">        mWebView.restoreState(savedInstanceState);</span>
<span class="nc" id="L82">    }</span>

    @Override
    protected void onPause() {
<span class="nc" id="L86">        super.onPause();</span>
        // Flash video may keep playing if the webView isn't paused here
<span class="nc" id="L88">        pauseWebView();</span>
<span class="nc" id="L89">    }</span>

    @Override
    protected void onResume() {
<span class="nc" id="L93">        super.onResume();</span>
<span class="nc" id="L94">        resumeWebView();</span>
<span class="nc" id="L95">    }</span>

    public void configureView() {
<span class="nc" id="L98">        setContentView(R.layout.webview);</span>

<span class="nc" id="L100">        Toolbar toolbar = findViewById(R.id.toolbar_main);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (toolbar != null) {</span>
<span class="nc" id="L102">            setSupportActionBar(toolbar);</span>
        }

<span class="nc" id="L105">        ActionBar actionBar = getSupportActionBar();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (actionBar != null) {</span>
<span class="nc" id="L107">            actionBar.setDisplayShowTitleEnabled(true);</span>
<span class="nc" id="L108">            actionBar.setDisplayHomeAsUpEnabled(true);</span>
        }
<span class="nc" id="L110">    }</span>

    /*
     * descendants should override this to set a WebViewClient, WebChromeClient, and anything
     * else necessary to configure the webView prior to navigation
     */
    protected void configureWebView() {
        // noop
<span class="nc" id="L118">    }</span>

    private void pauseWebView() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (mWebView != null) {</span>
<span class="nc" id="L122">            mWebView.onPause();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">            if (isFinishing()) {</span>
<span class="nc" id="L124">                loadUrl(&quot;about:blank&quot;);</span>
            }
        }
<span class="nc" id="L127">    }</span>

    private void resumeWebView() {
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (mWebView != null) {</span>
<span class="nc" id="L131">            mWebView.onResume();</span>
        }
<span class="nc" id="L133">    }</span>

    /**
     * Load the specified URL in the webview.
     *
     * @param url URL to load in the webview.
     */
    protected void loadUrl(String url) {
<span class="nc" id="L141">        mWebView.loadUrl(url);</span>
<span class="nc" id="L142">    }</span>

    public void loadUrl(String url, Map&lt;String, String&gt; additionalHttpHeaders) {
<span class="nc" id="L145">        mWebView.loadUrl(url, additionalHttpHeaders);</span>
<span class="nc" id="L146">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L150" title="All 4 branches missed.">        if (mWebView != null &amp;&amp; mWebView.canGoBack()) {</span>
<span class="nc" id="L151">            mWebView.goBack();</span>
        } else {
<span class="nc" id="L153">            cancel();</span>
<span class="nc" id="L154">            super.onBackPressed();</span>
        }
<span class="nc" id="L156">    }</span>

    @Override
    public boolean onOptionsItemSelected(final MenuItem item) {
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (item.getItemId() == android.R.id.home) {</span>
<span class="nc" id="L161">            cancel();</span>
<span class="nc" id="L162">            finish();</span>
<span class="nc" id="L163">            return true;</span>
        }
<span class="nc" id="L165">        return super.onOptionsItemSelected(item);</span>
    }

    protected void cancel() {
        // nop
<span class="nc" id="L170">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>