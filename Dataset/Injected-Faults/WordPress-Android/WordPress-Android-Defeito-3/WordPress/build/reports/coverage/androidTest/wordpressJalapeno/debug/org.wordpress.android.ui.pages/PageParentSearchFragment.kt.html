<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PageParentSearchFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.pages</a> &gt; <span class="el_source">PageParentSearchFragment.kt</span></div><h1>PageParentSearchFragment.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.pages

import android.os.Bundle
import android.os.Parcelable
import android.view.View
import androidx.fragment.app.Fragment
import androidx.fragment.app.FragmentActivity
import androidx.lifecycle.Observer
import androidx.lifecycle.ViewModelProvider
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.Job
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.databinding.PagesListFragmentBinding
import org.wordpress.android.util.DisplayUtils
import org.wordpress.android.viewmodel.pages.PageParentSearchViewModel
import org.wordpress.android.viewmodel.pages.PageParentViewModel
import org.wordpress.android.widgets.RecyclerItemDecoration
import javax.inject.Inject
import kotlin.coroutines.CoroutineContext

<span class="nc" id="L25">class PageParentSearchFragment : Fragment(R.layout.pages_list_fragment), CoroutineScope {</span>
<span class="nc" id="L26">    protected var job: Job = Job()</span>

    override val coroutineContext: CoroutineContext
<span class="nc" id="L29">        get() = Dispatchers.Main + job</span>

<span class="nc bnc" id="L31" title="All 2 branches missed.">    @Inject lateinit var viewModelFactory: ViewModelProvider.Factory</span>
    private lateinit var viewModel: PageParentSearchViewModel
    private var linearLayoutManager: LinearLayoutManager? = null

<span class="nc" id="L35">    private val listStateKey = &quot;list_state&quot;</span>

    companion object {
        fun newInstance(): PageParentSearchFragment {
<span class="nc" id="L39">            return PageParentSearchFragment()</span>
        }
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L44">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc" id="L45">        val nonNullActivity = requireActivity()</span>
<span class="nc bnc" id="L46" title="All 6 branches missed.">        (nonNullActivity.application as? WordPress)?.component()?.inject(this)</span>
<span class="nc" id="L47">        with(PagesListFragmentBinding.bind(view)) {</span>
<span class="nc" id="L48">            initializeViews(savedInstanceState)</span>
<span class="nc" id="L49">            initializeViewModels(nonNullActivity)</span>
<span class="nc" id="L50">        }</span>
<span class="nc" id="L51">    }</span>

    override fun onSaveInstanceState(outState: Bundle) {
<span class="nc bnc" id="L54" title="All 2 branches missed.">        linearLayoutManager?.let {</span>
<span class="nc" id="L55">            outState.putParcelable(listStateKey, it.onSaveInstanceState())</span>
<span class="nc" id="L56">        }</span>
<span class="nc" id="L57">        super.onSaveInstanceState(outState)</span>
<span class="nc" id="L58">    }</span>

    private fun PagesListFragmentBinding.initializeViewModels(activity: FragmentActivity) {
<span class="nc" id="L61">        val pageParentViewModel = ViewModelProvider(activity, viewModelFactory)</span>
<span class="nc" id="L62">                .get(PageParentViewModel::class.java)</span>

<span class="nc" id="L64">        viewModel = ViewModelProvider(this@PageParentSearchFragment, viewModelFactory)</span>
<span class="nc" id="L65">                .get(PageParentSearchViewModel::class.java)</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        viewModel.start(pageParentViewModel)</span>

<span class="nc" id="L68">        setupObservers()</span>
<span class="nc" id="L69">    }</span>

    private fun PagesListFragmentBinding.initializeViews(savedInstanceState: Bundle?) {
<span class="nc" id="L72">        val layoutManager = LinearLayoutManager(activity, RecyclerView.VERTICAL, false)</span>
<span class="nc bnc" id="L73" title="All 4 branches missed.">        savedInstanceState?.getParcelable&lt;Parcelable&gt;(listStateKey)?.let {</span>
<span class="nc" id="L74">            layoutManager.onRestoreInstanceState(it)</span>
<span class="nc" id="L75">        }</span>

<span class="nc" id="L77">        linearLayoutManager = layoutManager</span>
<span class="nc" id="L78">        recyclerView.layoutManager = linearLayoutManager</span>
<span class="nc" id="L79">        recyclerView.addItemDecoration(RecyclerItemDecoration(0, DisplayUtils.dpToPx(activity, 1)))</span>
<span class="nc" id="L80">    }</span>

    private fun PagesListFragmentBinding.setupObservers() {
<span class="nc bnc" id="L83" title="All 2 branches missed.">        viewModel.searchResult.observe(viewLifecycleOwner, Observer { data -&gt;</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">            data?.let { setSearchResult(data) }</span>
<span class="nc" id="L85">        })</span>
<span class="nc" id="L86">    }</span>

    private fun PagesListFragmentBinding.setSearchResult(pages: List&lt;PageItem&gt;) {
        val adapter: PageParentSearchAdapter
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (recyclerView.adapter == null) {</span>
<span class="nc" id="L91">            adapter = PageParentSearchAdapter(</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                    { page -&gt; viewModel.onParentSelected(page) }, this@PageParentSearchFragment</span>
            )
<span class="nc" id="L94">            recyclerView.adapter = adapter</span>
        } else {
<span class="nc bnc" id="L96" title="All 2 branches missed.">            adapter = recyclerView.adapter as PageParentSearchAdapter</span>
        }
<span class="nc" id="L98">        adapter.update(pages)</span>
<span class="nc" id="L99">    }</span>

    override fun onDestroy() {
<span class="nc" id="L102">        super.onDestroy()</span>
<span class="nc" id="L103">        job.cancel()</span>
<span class="nc" id="L104">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>