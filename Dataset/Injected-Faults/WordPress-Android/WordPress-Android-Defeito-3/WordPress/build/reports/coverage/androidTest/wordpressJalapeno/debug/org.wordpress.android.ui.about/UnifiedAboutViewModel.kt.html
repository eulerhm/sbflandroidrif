<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UnifiedAboutViewModel.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.about</a> &gt; <span class="el_source">UnifiedAboutViewModel.kt</span></div><h1>UnifiedAboutViewModel.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.about

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import com.automattic.about.model.AboutConfig
import com.automattic.about.model.AnalyticsConfig
import com.automattic.about.model.HeaderConfig
import com.automattic.about.model.ItemConfig
import com.automattic.about.model.LegalConfig
import com.automattic.about.model.RateUsConfig
import com.automattic.about.model.ShareConfig
import com.automattic.about.model.SocialsConfig
import org.wordpress.android.Constants
import org.wordpress.android.R
import org.wordpress.android.models.recommend.RecommendApiCallsProvider
import org.wordpress.android.models.recommend.RecommendApiCallsProvider.RecommendAppName.Jetpack
import org.wordpress.android.models.recommend.RecommendApiCallsProvider.RecommendAppName.WordPress
import org.wordpress.android.models.recommend.RecommendApiCallsProvider.RecommendCallResult.Failure
import org.wordpress.android.models.recommend.RecommendApiCallsProvider.RecommendCallResult.Success
import org.wordpress.android.ui.about.UnifiedAboutNavigationAction.Dismiss
import org.wordpress.android.ui.about.UnifiedAboutNavigationAction.OpenBlog
import org.wordpress.android.util.AppLog
import org.wordpress.android.util.AppLog.T
import org.wordpress.android.util.BuildConfigWrapper
import org.wordpress.android.util.WpUrlUtilsWrapper
import org.wordpress.android.util.analytics.AnalyticsUtils.RecommendAppSource.ABOUT
import org.wordpress.android.viewmodel.ContextProvider
import org.wordpress.android.viewmodel.Event
import javax.inject.Inject

<span class="nc" id="L32">class UnifiedAboutViewModel @Inject constructor(</span>
<span class="nc" id="L33">    private val contextProvider: ContextProvider,</span>
<span class="nc" id="L34">    private val wpUrlUtils: WpUrlUtilsWrapper,</span>
<span class="nc" id="L35">    private val recommendApiCallsProvider: RecommendApiCallsProvider,</span>
<span class="nc" id="L36">    private val buildConfig: BuildConfigWrapper,</span>
<span class="nc" id="L37">    private val unifiedAboutTracker: UnifiedAboutTracker</span>
<span class="nc" id="L38">) : ViewModel() {</span>
<span class="nc" id="L39">    private val _onNavigation = MutableLiveData&lt;Event&lt;UnifiedAboutNavigationAction&gt;&gt;()</span>
<span class="nc" id="L40">    val onNavigation: LiveData&lt;Event&lt;UnifiedAboutNavigationAction&gt;&gt; = _onNavigation</span>

<span class="nc" id="L42">    fun getAboutConfig() = AboutConfig(</span>
<span class="nc" id="L43">            headerConfig = HeaderConfig.fromContext(contextProvider.getContext()),</span>
<span class="nc" id="L44">            shareConfigFactory = ::createShareConfig,</span>
<span class="nc" id="L45">            rateUsConfig = RateUsConfig.fromContext(contextProvider.getContext()),</span>
<span class="nc" id="L46">            socialsConfig = SocialsConfig(</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">                    twitterUsername = if (buildConfig.isJetpackApp) JP_SOCIAL_HANDLE else WP_SOCIAL_HANDLE</span>
            ),
<span class="nc" id="L49">            customItems = listOf(</span>
<span class="nc" id="L50">                    ItemConfig(</span>
<span class="nc" id="L51">                            name = BLOG_ITEM_NAME,</span>
<span class="nc" id="L52">                            title = contextProvider.getContext().getString(R.string.about_blog),</span>
<span class="nc" id="L53">                            onClick = ::onBlogClick</span>
                    )
            ),
<span class="nc" id="L56">            legalConfig = LegalConfig(</span>
<span class="nc" id="L57">                    tosUrl = wpUrlUtils.buildTermsOfServiceUrl(contextProvider.getContext()),</span>
<span class="nc" id="L58">                    privacyPolicyUrl = Constants.URL_PRIVACY_POLICY,</span>
<span class="nc" id="L59">                    acknowledgementsUrl = LICENSES_FILE_URL</span>
            ),
<span class="nc" id="L61">            analyticsConfig = AnalyticsConfig(</span>
<span class="nc" id="L62">                    trackScreenShown = unifiedAboutTracker::trackScreenShown,</span>
<span class="nc" id="L63">                    trackScreenDismissed = unifiedAboutTracker::trackScreenDismissed,</span>
<span class="nc" id="L64">                    trackButtonTapped = unifiedAboutTracker::trackButtonTapped</span>
            ),
<span class="nc" id="L66">            onDismiss = ::onDismiss</span>
<span class="nc" id="L67">    )</span>

<span class="nc" id="L69">    private suspend fun createShareConfig(): ShareConfig {</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">        val app = if (buildConfig.isJetpackApp) Jetpack else WordPress</span>
<span class="nc" id="L71">        val result = recommendApiCallsProvider.getRecommendTemplate(app.appName, ABOUT)</span>
<span class="nc" id="L72">        return ShareConfig(</span>
<span class="nc" id="L73">                subject = contextProvider.getContext().getString(R.string.recommend_app_subject),</span>
<span class="nc" id="L74">                message = when (result) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">                    is Failure -&gt; {</span>
<span class="nc" id="L76">                        AppLog.e(T.MAIN, &quot;Couldn't fetch recommend app template: ${result.error}&quot;)</span>
                        // Returning generic message containing only the apps page URL
<span class="nc bnc" id="L78" title="All 2 branches missed.">                        if (buildConfig.isJetpackApp) JP_APPS_URL else WP_APPS_URL</span>
                    }
<span class="nc" id="L80">                    is Success -&gt; &quot;${result.templateData.message}\n${result.templateData.link}&quot;</span>
                }
        )
    }

    private fun onDismiss() {
<span class="nc" id="L86">        _onNavigation.postValue(Event(Dismiss))</span>
<span class="nc" id="L87">    }</span>

    private fun onBlogClick() {
<span class="nc bnc" id="L90" title="All 2 branches missed.">        _onNavigation.postValue(Event(OpenBlog(if (buildConfig.isJetpackApp) JP_BLOG_URL else WP_BLOG_URL)))</span>
<span class="nc" id="L91">    }</span>

    companion object {
        private const val BLOG_ITEM_NAME = &quot;blog&quot;
        private const val LICENSES_FILE_URL = &quot;file:///android_asset/licenses.html&quot;

        private const val WP_SOCIAL_HANDLE = &quot;wordpress&quot;
        private const val WP_APPS_URL = &quot;https://apps.wordpress.com&quot;
        private const val WP_BLOG_URL = &quot;https://blog.wordpress.com&quot;

        private const val JP_SOCIAL_HANDLE = &quot;jetpack&quot;
        private const val JP_APPS_URL = &quot;https://jetpack.com/app&quot;
        private const val JP_BLOG_URL = &quot;https://jetpack.com/blog&quot;
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>