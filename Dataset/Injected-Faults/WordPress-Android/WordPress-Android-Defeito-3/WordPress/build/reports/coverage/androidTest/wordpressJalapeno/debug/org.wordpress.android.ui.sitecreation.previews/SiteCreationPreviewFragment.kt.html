<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SiteCreationPreviewFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.sitecreation.previews</a> &gt; <span class="el_source">SiteCreationPreviewFragment.kt</span></div><h1>SiteCreationPreviewFragment.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.sitecreation.previews

import android.animation.Animator
import android.animation.AnimatorListenerAdapter
import android.animation.AnimatorSet
import android.animation.ObjectAnimator
import android.content.Context
import android.content.res.Configuration
import android.os.Bundle
import android.text.Spannable
import android.text.SpannableString
import android.text.style.ForegroundColorSpan
import android.view.View
import android.view.View.OnLayoutChangeListener
import android.view.animation.DecelerateInterpolator
import androidx.appcompat.app.AppCompatActivity
import androidx.core.content.ContextCompat
import androidx.fragment.app.viewModels
import dagger.hilt.android.AndroidEntryPoint
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.databinding.FullscreenErrorWithRetryBinding
import org.wordpress.android.databinding.SiteCreationFormScreenBinding
import org.wordpress.android.databinding.SiteCreationPreviewScreenBinding
import org.wordpress.android.databinding.SiteCreationPreviewScreenDefaultBinding
import org.wordpress.android.databinding.SiteCreationProgressCreatingSiteBinding
import org.wordpress.android.ui.accounts.HelpActivity
import org.wordpress.android.ui.sitecreation.SiteCreationBaseFormFragment
import org.wordpress.android.ui.sitecreation.SiteCreationState
import org.wordpress.android.ui.sitecreation.misc.OnHelpClickedListener
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewData
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewUiState.SitePreviewContentUiState
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewUiState.SitePreviewFullscreenErrorUiState
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewUiState.SitePreviewFullscreenProgressUiState
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewUiState.SitePreviewLoadingShimmerState
import org.wordpress.android.ui.sitecreation.previews.SitePreviewViewModel.SitePreviewUiState.SitePreviewWebErrorUiState
import org.wordpress.android.ui.sitecreation.services.SiteCreationService
import org.wordpress.android.ui.utils.UiHelpers
import org.wordpress.android.util.AniUtils
import org.wordpress.android.util.AppLog
import org.wordpress.android.util.AutoForeground.ServiceEventConnection
import org.wordpress.android.util.ErrorManagedWebViewClient.ErrorManagedWebViewClientListener
import org.wordpress.android.util.URLFilteredWebViewClient
import javax.inject.Inject

private const val ARG_DATA = &quot;arg_site_creation_data&quot;
private const val SLIDE_IN_ANIMATION_DURATION = 450L

@Suppress(&quot;TooManyFunctions&quot;)
@AndroidEntryPoint
<span class="nc" id="L51">class SiteCreationPreviewFragment : SiteCreationBaseFormFragment(),</span>
        ErrorManagedWebViewClientListener {
    /**
     * We need to connect to the service, so the service knows when the app is in the background. The service
     * automatically shows system notifications when site creation is in progress and the app is in the background.
     */
    private var serviceEventConnection: ServiceEventConnection? = null
<span class="nc" id="L58">    private val viewModel: SitePreviewViewModel by viewModels()</span>
    private var animatorSet: AnimatorSet? = null
    private val isLandscape: Boolean
<span class="nc bnc" id="L61" title="All 2 branches missed.">        get() = resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE</span>

<span class="nc bnc" id="L63" title="All 2 branches missed.">    @Inject internal lateinit var uiHelpers: UiHelpers</span>

    private var binding: SiteCreationPreviewScreenBinding? = null

    override fun onAttach(context: Context) {
<span class="nc" id="L68">        super.onAttach(context)</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (context !is SitePreviewScreenListener) {</span>
<span class="nc" id="L70">            throw IllegalStateException(&quot;Parent activity must implement SitePreviewScreenListener.&quot;)</span>
        }
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (context !is OnHelpClickedListener) {</span>
<span class="nc" id="L73">            throw IllegalStateException(&quot;Parent activity must implement OnHelpClickedListener.&quot;)</span>
        }
<span class="nc" id="L75">    }</span>

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L78">        super.onCreate(savedInstanceState)</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
            // we need to manually clear the SiteCreationService state so we don't for example receive sticky events
            // from the previous run of the SiteCreation flow.
<span class="nc" id="L82">            SiteCreationService.clearSiteCreationServiceState()</span>
        }
<span class="nc" id="L84">    }</span>

    override fun onActivityCreated(savedInstanceState: Bundle?) {
<span class="nc" id="L87">        super.onActivityCreated(savedInstanceState)</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">        (requireActivity() as AppCompatActivity).supportActionBar?.hide()</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">        viewModel.start(requireArguments()[ARG_DATA] as SiteCreationState, savedInstanceState)</span>
<span class="nc" id="L92">    }</span>

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L95">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        (requireActivity() as AppCompatActivity).supportActionBar?.hide()</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">        viewModel.start(requireArguments()[ARG_DATA] as SiteCreationState, savedInstanceState)</span>
<span class="nc" id="L99">    }</span>

    override fun getContentLayout(): Int {
<span class="nc" id="L102">        return R.layout.site_creation_preview_screen</span>
    }

    override val screenTitle: String
<span class="nc bnc" id="L106" title="All 4 branches missed.">        get() = arguments?.getString(EXTRA_SCREEN_TITLE)</span>
<span class="nc" id="L107">                ?: throw IllegalStateException(&quot;Required argument screen title is missing.&quot;)</span>

    override fun setBindingViewStubListener(parentBinding: SiteCreationFormScreenBinding) {
<span class="nc" id="L110">        parentBinding.siteCreationFormContentStub.setOnInflateListener { _, inflated -&gt;</span>
<span class="nc" id="L111">            binding = SiteCreationPreviewScreenBinding.bind(inflated)</span>
<span class="nc" id="L112">        }</span>
<span class="nc" id="L113">    }</span>

    override fun setupContent() {
<span class="nc bnc" id="L116" title="All 4 branches missed.">        binding?.siteCreationPreviewScreenDefault?.initViewModel()</span>
<span class="nc bnc" id="L117" title="All 6 branches missed.">        binding?.siteCreationPreviewScreenDefault?.fullscreenErrorWithRetry?.initRetryButton()</span>
<span class="nc bnc" id="L118" title="All 4 branches missed.">        binding?.siteCreationPreviewScreenDefault?.initOkButton()</span>
<span class="nc bnc" id="L119" title="All 6 branches missed.">        binding?.siteCreationPreviewScreenDefault?.fullscreenErrorWithRetry?.initCancelWizardButton()</span>
<span class="nc bnc" id="L120" title="All 6 branches missed.">        binding?.siteCreationPreviewScreenDefault?.fullscreenErrorWithRetry?.initContactSupportButton()</span>
<span class="nc" id="L121">    }</span>

    private fun SiteCreationPreviewScreenDefaultBinding.initViewModel() {
<span class="nc" id="L124">        viewModel.uiState.observe(this@SiteCreationPreviewFragment, { uiState -&gt;</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">            uiState?.let {</span>
<span class="nc" id="L126">                when (uiState) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                    is SitePreviewContentUiState -&gt; updateContentLayout(uiState.data)</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    is SitePreviewWebErrorUiState -&gt; updateContentLayout(uiState.data)</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                    is SitePreviewLoadingShimmerState -&gt; updateContentLayout(uiState.data)</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">                    is SitePreviewFullscreenProgressUiState -&gt;</span>
<span class="nc" id="L131">                        siteCreationProgressCreatingSite.updateLoadingLayout(uiState)</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">                    is SitePreviewFullscreenErrorUiState -&gt;</span>
<span class="nc" id="L133">                        fullscreenErrorWithRetry.updateErrorLayout(uiState)</span>
                }
<span class="nc" id="L135">                uiHelpers.updateVisibility(</span>
<span class="nc" id="L136">                        siteCreationProgressCreatingSite.progressLayout,</span>
<span class="nc" id="L137">                        uiState.fullscreenProgressLayoutVisibility</span>
                )

<span class="nc" id="L140">                uiHelpers.updateVisibility(contentLayout, uiState.contentLayoutVisibility)</span>
<span class="nc" id="L141">                uiHelpers.updateVisibility(</span>
<span class="nc" id="L142">                        siteCreationPreviewWebViewContainer.sitePreviewWebView,</span>
<span class="nc" id="L143">                        uiState.webViewVisibility</span>
                )
<span class="nc" id="L145">                uiHelpers.updateVisibility(</span>
<span class="nc" id="L146">                        siteCreationPreviewWebViewContainer.sitePreviewWebError,</span>
<span class="nc" id="L147">                        uiState.webViewErrorVisibility</span>
                )
<span class="nc" id="L149">                uiHelpers.updateVisibility(</span>
<span class="nc" id="L150">                        siteCreationPreviewWebViewContainer.sitePreviewWebViewShimmerLayout,</span>
<span class="nc" id="L151">                        uiState.shimmerVisibility</span>
                )
<span class="nc" id="L153">                uiHelpers.updateVisibility(</span>
<span class="nc" id="L154">                        fullscreenErrorWithRetry.errorLayout,</span>
<span class="nc" id="L155">                        uiState.fullscreenErrorLayoutVisibility</span>
                )
<span class="nc" id="L157">            }</span>
<span class="nc" id="L158">        })</span>

<span class="nc" id="L160">        viewModel.preloadPreview.observe(this@SiteCreationPreviewFragment, { url -&gt;</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">            url?.let { urlString -&gt;</span>
<span class="nc" id="L162">                siteCreationPreviewWebViewContainer.sitePreviewWebView.webViewClient =</span>
<span class="nc" id="L163">                        URLFilteredWebViewClient(urlString, this@SiteCreationPreviewFragment)</span>
<span class="nc" id="L164">                siteCreationPreviewWebViewContainer.sitePreviewWebView.settings.userAgentString =</span>
<span class="nc" id="L165">                        WordPress.getUserAgent()</span>
<span class="nc" id="L166">                siteCreationPreviewWebViewContainer.sitePreviewWebView.loadUrl(urlString)</span>
<span class="nc" id="L167">            }</span>
<span class="nc" id="L168">        })</span>

<span class="nc" id="L170">        viewModel.startCreateSiteService.observe(this@SiteCreationPreviewFragment, { startServiceData -&gt;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">            startServiceData?.let {</span>
<span class="nc" id="L172">                SiteCreationService.createSite(</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">                        requireNotNull(activity),</span>
<span class="nc" id="L174">                        startServiceData.previousState,</span>
<span class="nc" id="L175">                        startServiceData.serviceData</span>
                )
<span class="nc" id="L177">            }</span>
<span class="nc" id="L178">        })</span>

<span class="nc" id="L180">        initClickObservers()</span>
<span class="nc" id="L181">    }</span>

    private fun initClickObservers() {
<span class="nc" id="L184">        viewModel.onHelpClicked.observe(this, {</span>
<span class="nc" id="L185">            (requireActivity() as OnHelpClickedListener).onHelpClicked(HelpActivity.Origin.SITE_CREATION_CREATING)</span>
<span class="nc" id="L186">        })</span>
<span class="nc" id="L187">        viewModel.onSiteCreationCompleted.observe(this, {</span>
<span class="nc" id="L188">            (requireActivity() as SitePreviewScreenListener).onSiteCreationCompleted()</span>
<span class="nc" id="L189">        })</span>
<span class="nc" id="L190">        viewModel.onOkButtonClicked.observe(this, { createSiteState -&gt;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            createSiteState?.let {</span>
<span class="nc" id="L192">                (requireActivity() as SitePreviewScreenListener).onSitePreviewScreenDismissed(createSiteState)</span>
<span class="nc" id="L193">            }</span>
<span class="nc" id="L194">        })</span>
<span class="nc" id="L195">        viewModel.onCancelWizardClicked.observe(this, { createSiteState -&gt;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            createSiteState?.let {</span>
<span class="nc" id="L197">                (requireActivity() as SitePreviewScreenListener).onSitePreviewScreenDismissed(createSiteState)</span>
<span class="nc" id="L198">            }</span>
<span class="nc" id="L199">        })</span>
<span class="nc" id="L200">    }</span>

    private fun FullscreenErrorWithRetryBinding.initRetryButton() {
<span class="nc" id="L203">        errorRetry.setOnClickListener { viewModel.retry() }</span>
<span class="nc" id="L204">    }</span>

    private fun SiteCreationPreviewScreenDefaultBinding.initOkButton() {
<span class="nc" id="L207">        okButton.setOnClickListener { viewModel.onOkButtonClicked() }</span>
<span class="nc" id="L208">    }</span>

    private fun FullscreenErrorWithRetryBinding.initCancelWizardButton() {
<span class="nc" id="L211">        cancelWizardButton.setOnClickListener { viewModel.onCancelWizardClicked() }</span>
<span class="nc" id="L212">    }</span>

    private fun FullscreenErrorWithRetryBinding.initContactSupportButton() {
<span class="nc" id="L215">        contactSupport.setOnClickListener { viewModel.onHelpClicked() }</span>
<span class="nc" id="L216">    }</span>

    private fun SiteCreationPreviewScreenDefaultBinding.updateContentLayout(sitePreviewData: SitePreviewData) {
<span class="nc" id="L219">        sitePreviewData.apply {</span>
<span class="nc" id="L220">            siteCreationPreviewWebViewContainer.sitePreviewWebUrlTitle.text = createSpannableUrl(</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                    requireNotNull(activity),</span>
<span class="nc" id="L222">                    shortUrl,</span>
<span class="nc" id="L223">                    subDomainIndices,</span>
<span class="nc" id="L224">                    domainIndices</span>
            )
<span class="nc" id="L226">        }</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (contentLayout.visibility == View.GONE) {</span>
<span class="nc" id="L228">            animateContentTransition()</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            view?.announceForAccessibility(</span>
<span class="nc" id="L230">                    getString(R.string.new_site_creation_preview_title) +</span>
<span class="nc" id="L231">                            getString(R.string.new_site_creation_site_preview_content_description)</span>
            )
        }
<span class="nc" id="L234">    }</span>

    private fun SiteCreationProgressCreatingSiteBinding.updateLoadingLayout(
        progressUiState: SitePreviewFullscreenProgressUiState
    ) {
<span class="nc" id="L239">        progressUiState.apply {</span>
<span class="nc" id="L240">            val newText = uiHelpers.getTextOfUiString(progressText.context, loadingTextResId)</span>
<span class="nc" id="L241">            AppLog.d(AppLog.T.MAIN, &quot;Changing text - animation: $animate&quot;)</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">            if (animate) {</span>
<span class="nc" id="L243">                updateLoadingTextWithFadeAnimation(newText)</span>
            } else {
<span class="nc" id="L245">                progressText.text = newText</span>
            }
<span class="nc" id="L247">        }</span>
<span class="nc" id="L248">    }</span>

    private fun SiteCreationProgressCreatingSiteBinding.updateLoadingTextWithFadeAnimation(newText: CharSequence) {
<span class="nc" id="L251">        val animationDuration = AniUtils.Duration.SHORT</span>
<span class="nc" id="L252">        val fadeOut = AniUtils.getFadeOutAnim(</span>
<span class="nc" id="L253">                progressTextLayout,</span>
<span class="nc" id="L254">                animationDuration,</span>
<span class="nc" id="L255">                View.VISIBLE</span>
        )
<span class="nc" id="L257">        val fadeIn = AniUtils.getFadeInAnim(</span>
<span class="nc" id="L258">                progressTextLayout,</span>
<span class="nc" id="L259">                animationDuration</span>
        )

        // update the text when the view isn't visible
<span class="nc" id="L263">        fadeIn.addListener(object : AnimatorListenerAdapter() {</span>
            override fun onAnimationStart(animation: Animator) {
<span class="nc" id="L265">                progressText.text = newText</span>
<span class="nc" id="L266">            }</span>

            override fun onAnimationEnd(animation: Animator?) {
<span class="nc" id="L269">                super.onAnimationEnd(animation)</span>
<span class="nc" id="L270">                animatorSet = null</span>
<span class="nc" id="L271">            }</span>
        })
        // Start the fade-in animation right after the view fades out
<span class="nc" id="L274">        fadeIn.startDelay = animationDuration.toMillis(progressTextLayout.context)</span>

<span class="nc" id="L276">        animatorSet = AnimatorSet().apply {</span>
<span class="nc" id="L277">            playSequentially(fadeOut, fadeIn)</span>
<span class="nc" id="L278">            start()</span>
<span class="nc" id="L279">        }</span>
<span class="nc" id="L280">    }</span>

    private fun FullscreenErrorWithRetryBinding.updateErrorLayout(
        errorUiStateState: SitePreviewFullscreenErrorUiState
    ) {
<span class="nc" id="L285">        errorUiStateState.apply {</span>
<span class="nc" id="L286">            uiHelpers.setTextOrHide(errorTitle, titleResId)</span>
<span class="nc" id="L287">            uiHelpers.setTextOrHide(errorSubtitle, subtitleResId)</span>
<span class="nc" id="L288">            uiHelpers.updateVisibility(contactSupport, errorUiStateState.showContactSupport)</span>
<span class="nc" id="L289">            uiHelpers.updateVisibility(cancelWizardButton, errorUiStateState.showCancelWizardButton)</span>
<span class="nc" id="L290">        }</span>
<span class="nc" id="L291">    }</span>

    /**
     * Creates a spannable url with 2 different text colors for the subdomain and domain.
     *
     * @param context Context to get the color resources
     * @param url The url to be used to created the spannable from
     * @param subdomainSpan The subdomain index pair for the start and end positions
     * @param domainSpan The domain index pair for the start and end positions
     *
     * @return [Spannable] styled with two different colors for the subdomain and domain parts
     */
    private fun createSpannableUrl(
        context: Context,
        url: String,
        subdomainSpan: Pair&lt;Int, Int&gt;,
        domainSpan: Pair&lt;Int, Int&gt;
    ): Spannable {
<span class="nc" id="L309">        val spannableTitle = SpannableString(url)</span>
<span class="nc" id="L310">        spannableTitle.setSpan(</span>
<span class="nc" id="L311">                ForegroundColorSpan(ContextCompat.getColor(context, R.color.neutral_80)),</span>
<span class="nc" id="L312">                subdomainSpan.first,</span>
<span class="nc" id="L313">                subdomainSpan.second,</span>
<span class="nc" id="L314">                Spannable.SPAN_EXCLUSIVE_EXCLUSIVE</span>
        )
<span class="nc" id="L316">        spannableTitle.setSpan(</span>
<span class="nc" id="L317">                ForegroundColorSpan(ContextCompat.getColor(context, R.color.neutral_40)),</span>
<span class="nc" id="L318">                domainSpan.first,</span>
<span class="nc" id="L319">                domainSpan.second,</span>
<span class="nc" id="L320">                Spannable.SPAN_EXCLUSIVE_EXCLUSIVE</span>
        )
<span class="nc" id="L322">        return spannableTitle</span>
    }

    override fun onWebViewPageLoaded() {
<span class="nc" id="L326">        viewModel.onUrlLoaded()</span>
<span class="nc" id="L327">    }</span>

    override fun onWebViewReceivedError() {
<span class="nc" id="L330">        viewModel.onWebViewError()</span>
<span class="nc" id="L331">    }</span>

    override fun onHelp() {
<span class="nc" id="L334">        viewModel.onHelpClicked()</span>
<span class="nc" id="L335">    }</span>

    private fun SiteCreationPreviewScreenDefaultBinding.animateContentTransition() {
<span class="nc" id="L338">        contentLayout.addOnLayoutChangeListener(</span>
<span class="nc" id="L339">                object : OnLayoutChangeListener {</span>
                    override fun onLayoutChange(
                        v: View?,
                        left: Int,
                        top: Int,
                        right: Int,
                        bottom: Int,
                        oldLeft: Int,
                        oldTop: Int,
                        oldRight: Int,
                        oldBottom: Int
                    ) {
<span class="nc bnc" id="L351" title="All 2 branches missed.">                        if (meetsHeightWidthForAnimation()) {</span>
<span class="nc" id="L352">                            contentLayout.removeOnLayoutChangeListener(this)</span>
<span class="nc" id="L353">                            val contentHeight = contentLayout.measuredHeight.toFloat()</span>
<span class="nc" id="L354">                            val titleAnim = createFadeInAnimator(siteCreationPreviewHeaderItem.sitePreviewTitle)</span>
<span class="nc" id="L355">                            val webViewAnim = createSlideInFromBottomAnimator(</span>
<span class="nc" id="L356">                                    siteCreationPreviewWebViewContainer.webViewContainer,</span>
<span class="nc" id="L357">                                    contentHeight</span>
                            )

                            // OK button should slide in if the container exists and fade in otherwise
                            // difference between land &amp; portrait
<span class="nc bnc" id="L362" title="All 2 branches missed.">                            val okAnim = if (isLandscape) {</span>
<span class="nc" id="L363">                                createFadeInAnimator(okButton)</span>
                            } else {
<span class="nc bnc" id="L365" title="All 2 branches missed.">                                createSlideInFromBottomAnimator(sitePreviewOkButtonContainer as View, contentHeight)</span>
                            }

                            // There is a chance that either of the following fields can be null,
                            // so to avoid a NPE, we only execute playTogether if they are both not null
<span class="nc bnc" id="L370" title="All 4 branches missed.">                            if (titleAnim != null &amp;&amp; okAnim != null) {</span>
<span class="nc" id="L371">                                AnimatorSet().apply {</span>
<span class="nc" id="L372">                                    interpolator = DecelerateInterpolator()</span>
<span class="nc" id="L373">                                    duration = SLIDE_IN_ANIMATION_DURATION</span>
<span class="nc" id="L374">                                    playTogether(titleAnim, webViewAnim, okAnim)</span>
<span class="nc" id="L375">                                    start()</span>
<span class="nc" id="L376">                                }</span>
                            }
                        }
<span class="nc" id="L379">                    }</span>
                })
<span class="nc" id="L381">    }</span>

    private fun SiteCreationPreviewScreenDefaultBinding.meetsHeightWidthForAnimation() =
<span class="nc bnc" id="L384" title="All 4 branches missed.">            contentLayout.measuredWidth &gt; 0 &amp;&amp; contentLayout.measuredHeight &gt; 0</span>

    private fun createSlideInFromBottomAnimator(view: View, contentHeight: Float): ObjectAnimator {
<span class="nc" id="L387">        return ObjectAnimator.ofFloat(</span>
<span class="nc" id="L388">                view,</span>
<span class="nc" id="L389">                &quot;translationY&quot;,</span>
                // start below the bottom edge of the display
<span class="nc" id="L391">                (contentHeight - view.top),</span>
<span class="nc" id="L392">                0f</span>
        )
    }

<span class="nc" id="L396">    private fun createFadeInAnimator(view: View) = ObjectAnimator.ofFloat(view, &quot;alpha&quot;, 0f, 1f)</span>

    override fun onResume() {
<span class="nc" id="L399">        super.onResume()</span>
<span class="nc" id="L400">        serviceEventConnection = ServiceEventConnection(context, SiteCreationService::class.java, viewModel)</span>
<span class="nc" id="L401">    }</span>

    override fun onSaveInstanceState(outState: Bundle) {
<span class="nc" id="L404">        super.onSaveInstanceState(outState)</span>
<span class="nc" id="L405">        viewModel.writeToBundle(outState)</span>
<span class="nc" id="L406">    }</span>

    override fun onPause() {
<span class="nc" id="L409">        super.onPause()</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">        serviceEventConnection?.disconnect(context, viewModel)</span>
<span class="nc" id="L411">    }</span>

    override fun onStop() {
<span class="nc" id="L414">        super.onStop()</span>
<span class="nc bnc" id="L415" title="All 6 branches missed.">        if (animatorSet?.isRunning == true) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">            animatorSet?.cancel()</span>
        }
<span class="nc" id="L418">    }</span>

    companion object {
        const val TAG = &quot;site_creation_preview_fragment_tag&quot;

        fun newInstance(
            screenTitle: String,
            siteCreationData: SiteCreationState
        ): SiteCreationPreviewFragment {
<span class="nc" id="L427">            val fragment = SiteCreationPreviewFragment()</span>
<span class="nc" id="L428">            val bundle = Bundle()</span>
<span class="nc" id="L429">            bundle.putString(EXTRA_SCREEN_TITLE, screenTitle)</span>
<span class="nc" id="L430">            bundle.putParcelable(ARG_DATA, siteCreationData)</span>
<span class="nc" id="L431">            fragment.arguments = bundle</span>
<span class="nc" id="L432">            return fragment</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>