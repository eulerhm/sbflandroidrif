<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PluginBrowserActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.plugins</a> &gt; <span class="el_source">PluginBrowserActivity.java</span></div><h1>PluginBrowserActivity.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.plugins;

import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.RatingBar;
import android.widget.TextView;

import androidx.annotation.ColorRes;
import androidx.annotation.DrawableRes;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.appcompat.app.ActionBar;
import androidx.appcompat.content.res.AppCompatResources;
import androidx.appcompat.widget.SearchView;
import androidx.appcompat.widget.Toolbar;
import androidx.fragment.app.FragmentTransaction;
import androidx.lifecycle.ViewModelProvider;
import androidx.recyclerview.widget.DiffUtil;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import androidx.recyclerview.widget.RecyclerView.ViewHolder;

import com.google.android.material.appbar.AppBarLayout;

import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.analytics.AnalyticsTracker;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.fluxc.model.plugin.ImmutablePluginModel;
import org.wordpress.android.models.networkresource.ListState;
import org.wordpress.android.ui.ActivityLauncher;
import org.wordpress.android.ui.LocaleAwareActivity;
import org.wordpress.android.util.ActivityUtils;
import org.wordpress.android.util.AniUtils;
import org.wordpress.android.util.extensions.AppBarLayoutExtensionsKt;
import org.wordpress.android.util.ColorUtils;
import org.wordpress.android.util.extensions.ContextExtensionsKt;
import org.wordpress.android.util.NetworkUtils;
import org.wordpress.android.util.StringUtils;
import org.wordpress.android.util.ToastUtils;
import org.wordpress.android.util.analytics.AnalyticsUtils;
import org.wordpress.android.util.image.ImageManager;
import org.wordpress.android.util.image.ImageType;
import org.wordpress.android.viewmodel.plugins.PluginBrowserViewModel;
import org.wordpress.android.viewmodel.plugins.PluginBrowserViewModel.PluginListType;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.inject.Inject;

<span class="nc" id="L61">public class PluginBrowserActivity extends LocaleAwareActivity</span>
        implements SearchView.OnQueryTextListener,
        MenuItem.OnActionExpandListener {
    @Inject ViewModelProvider.Factory mViewModelFactory;
    @Inject ImageManager mImageManager;
    private PluginBrowserViewModel mViewModel;

    private RecyclerView mSitePluginsRecycler;
    private RecyclerView mFeaturedPluginsRecycler;
    private RecyclerView mPopularPluginsRecycler;
    private RecyclerView mNewPluginsRecycler;
    private AppBarLayout mAppBar;

    private MenuItem mSearchMenuItem;
    private SearchView mSearchView;

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L79">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L80">        ((WordPress) getApplication()).component().inject(this);</span>
<span class="nc" id="L81">        setContentView(R.layout.plugin_browser_activity);</span>

<span class="nc" id="L83">        mViewModel = new ViewModelProvider(this, mViewModelFactory).get(PluginBrowserViewModel.class);</span>

<span class="nc" id="L85">        mSitePluginsRecycler = findViewById(R.id.installed_plugins_recycler);</span>
<span class="nc" id="L86">        mFeaturedPluginsRecycler = findViewById(R.id.featured_plugins_recycler);</span>
<span class="nc" id="L87">        mPopularPluginsRecycler = findViewById(R.id.popular_plugins_recycler);</span>
<span class="nc" id="L88">        mNewPluginsRecycler = findViewById(R.id.new_plugins_recycler);</span>
<span class="nc" id="L89">        mAppBar = findViewById(R.id.appbar_main);</span>

<span class="nc" id="L91">        Toolbar toolbar = findViewById(R.id.toolbar_main);</span>
<span class="nc" id="L92">        setSupportActionBar(toolbar);</span>
<span class="nc" id="L93">        ActionBar actionBar = getSupportActionBar();</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (actionBar != null) {</span>
<span class="nc" id="L95">            actionBar.setHomeButtonEnabled(true);</span>
<span class="nc" id="L96">            actionBar.setDisplayHomeAsUpEnabled(true);</span>
        }

<span class="nc" id="L99">        SiteModel siteModel = (SiteModel) getIntent().getSerializableExtra(WordPress.SITE);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (siteModel == null) {</span>
<span class="nc" id="L101">            ToastUtils.showToast(this, R.string.blog_not_found);</span>
<span class="nc" id="L102">            finish();</span>
<span class="nc" id="L103">            return;</span>
        }

<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L107">            mViewModel.setSite(siteModel);</span>
        } else {
<span class="nc" id="L109">            mViewModel.readFromBundle(savedInstanceState);</span>
        }
<span class="nc" id="L111">        mViewModel.start();</span>

        // site plugin list
<span class="nc" id="L114">        findViewById(R.id.text_manage).setOnClickListener(v -&gt; showListFragment(PluginListType.SITE));</span>

        // featured plugin list
<span class="nc" id="L117">        findViewById(R.id.text_all_featured).setOnClickListener(v -&gt; showListFragment(PluginListType.FEATURED));</span>

        // popular plugin list
<span class="nc" id="L120">        findViewById(R.id.text_all_popular).setOnClickListener(v -&gt; showListFragment(PluginListType.POPULAR));</span>

        // new plugin list
<span class="nc" id="L123">        findViewById(R.id.text_all_new).setOnClickListener(v -&gt; showListFragment(PluginListType.NEW));</span>

<span class="nc" id="L125">        getSupportFragmentManager().addOnBackStackChangedListener(() -&gt; {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (getSupportFragmentManager().getBackStackEntryCount() == 0) {</span>
<span class="nc" id="L127">                mViewModel.setTitle(getString(R.string.plugins));</span>
            }
<span class="nc" id="L129">        });</span>

<span class="nc" id="L131">        configureRecycler(mSitePluginsRecycler);</span>
<span class="nc" id="L132">        configureRecycler(mFeaturedPluginsRecycler);</span>
<span class="nc" id="L133">        configureRecycler(mPopularPluginsRecycler);</span>
<span class="nc" id="L134">        configureRecycler(mNewPluginsRecycler);</span>

<span class="nc" id="L136">        setupObservers();</span>
<span class="nc" id="L137">    }</span>

    @Override
    protected void onSaveInstanceState(@NotNull Bundle outState) {
<span class="nc" id="L141">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L142">        mViewModel.writeToBundle(outState);</span>
<span class="nc" id="L143">    }</span>

    private void setupObservers() {
<span class="nc" id="L146">        mViewModel.getTitle().observe(this, title -&gt; setTitle(title));</span>

<span class="nc" id="L148">        mViewModel.getSitePluginsLiveData()</span>
<span class="nc" id="L149">                  .observe(this, listState -&gt; {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">                      if (listState != null) {</span>
<span class="nc" id="L151">                          reloadPluginAdapterAndVisibility(PluginListType.SITE, listState);</span>

<span class="nc bnc" id="L153" title="All 4 branches missed.">                          showProgress(listState.isFetchingFirstPage() &amp;&amp; listState.getData().isEmpty());</span>

                          // We should ignore the errors due to network condition, unless this is the first
                          // fetch, the user
                          // can use the cached data and showing the error while the data is loaded might cause
                          // confusion
<span class="nc bnc" id="L159" title="All 2 branches missed.">                          if (listState instanceof ListState.Error</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                              &amp;&amp; NetworkUtils.isNetworkAvailable(PluginBrowserActivity.this)) {</span>
<span class="nc" id="L161">                              ToastUtils.showToast(PluginBrowserActivity.this, R.string.plugin_fetch_error);</span>
                          }
                      }
<span class="nc" id="L164">                  });</span>

<span class="nc" id="L166">        mViewModel.getFeaturedPluginsLiveData()</span>
<span class="nc" id="L167">                  .observe(this, listState -&gt; {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">                      if (listState != null) {</span>
<span class="nc" id="L169">                          reloadPluginAdapterAndVisibility(PluginListType.FEATURED, listState);</span>
                      }
<span class="nc" id="L171">                  });</span>

<span class="nc" id="L173">        mViewModel.getPopularPluginsLiveData()</span>
<span class="nc" id="L174">                  .observe(this, listState -&gt; {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">                      if (listState != null) {</span>
<span class="nc" id="L176">                          reloadPluginAdapterAndVisibility(PluginListType.POPULAR, listState);</span>
                      }
<span class="nc" id="L178">                  });</span>

<span class="nc" id="L180">        mViewModel.getNewPluginsLiveData()</span>
<span class="nc" id="L181">                  .observe(this, listState -&gt; {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">                      if (listState != null) {</span>
<span class="nc" id="L183">                          reloadPluginAdapterAndVisibility(PluginListType.NEW, listState);</span>
                      }
<span class="nc" id="L185">                  });</span>
<span class="nc" id="L186">    }</span>

    private void configureRecycler(@NonNull RecyclerView recycler) {
<span class="nc" id="L189">        recycler.setLayoutManager(new LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false));</span>
<span class="nc" id="L190">        recycler.setHasFixedSize(true);</span>
<span class="nc" id="L191">        recycler.setAdapter(new PluginBrowserAdapter(this));</span>
<span class="nc" id="L192">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (mSearchMenuItem != null) {</span>
<span class="nc" id="L197">            mSearchMenuItem.setOnActionExpandListener(null);</span>
        }
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (mSearchView != null) {</span>
<span class="nc" id="L200">            mSearchView.setOnQueryTextListener(null);</span>
        }
<span class="nc" id="L202">        super.onDestroy();</span>
<span class="nc" id="L203">    }</span>

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc" id="L207">        getMenuInflater().inflate(R.menu.search, menu);</span>

<span class="nc" id="L209">        mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span class="nc" id="L210">        mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span class="nc" id="L211">        mSearchView.setMaxWidth(Integer.MAX_VALUE);</span>

<span class="nc" id="L213">        PluginListFragment currentFragment = getCurrentFragment();</span>
<span class="nc bnc" id="L214" title="All 4 branches missed.">        if (currentFragment != null &amp;&amp; currentFragment.getListType() == PluginListType.SEARCH) {</span>
<span class="nc" id="L215">            mSearchMenuItem.expandActionView();</span>
<span class="nc" id="L216">            mSearchView.setQuery(mViewModel.getSearchQuery(), false);</span>
<span class="nc" id="L217">            mSearchView.setOnQueryTextListener(this);</span>
        }

<span class="nc" id="L220">        mSearchMenuItem.setOnActionExpandListener(this);</span>

<span class="nc" id="L222">        return super.onCreateOptionsMenu(menu);</span>
    }

    @Override
    public boolean onOptionsItemSelected(final MenuItem item) {
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (item.getItemId() == android.R.id.home) {</span>
<span class="nc" id="L228">            onBackPressed();</span>
<span class="nc" id="L229">            return true;</span>
        }
<span class="nc" id="L231">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L236" title="All 2 branches missed.">        if (getSupportFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
            // update the lift on scroll target id when we return to the root fragment
<span class="nc" id="L238">            AppBarLayoutExtensionsKt.setLiftOnScrollTargetViewIdAndRequestLayout(mAppBar, R.id.scroll_view);</span>
        }
<span class="nc" id="L240">        super.onBackPressed();</span>
<span class="nc" id="L241">    }</span>

    private void reloadPluginAdapterAndVisibility(@NonNull PluginListType pluginType,
                                                  @Nullable ListState&lt;ImmutablePluginModel&gt; listState) {
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (listState == null) {</span>
<span class="nc" id="L246">            return;</span>
        }
<span class="nc" id="L248">        PluginBrowserAdapter adapter = null;</span>
<span class="nc" id="L249">        View cardView = null;</span>
<span class="nc bnc" id="L250" title="All 6 branches missed.">        switch (pluginType) {</span>
            case SITE:
<span class="nc" id="L252">                adapter = (PluginBrowserAdapter) mSitePluginsRecycler.getAdapter();</span>
<span class="nc" id="L253">                cardView = findViewById(R.id.installed_plugins_container);</span>
<span class="nc" id="L254">                break;</span>
            case FEATURED:
<span class="nc" id="L256">                adapter = (PluginBrowserAdapter) mFeaturedPluginsRecycler.getAdapter();</span>
<span class="nc" id="L257">                cardView = findViewById(R.id.featured_plugins_container);</span>
<span class="nc" id="L258">                break;</span>
            case POPULAR:
<span class="nc" id="L260">                adapter = (PluginBrowserAdapter) mPopularPluginsRecycler.getAdapter();</span>
<span class="nc" id="L261">                cardView = findViewById(R.id.popular_plugins_container);</span>
<span class="nc" id="L262">                break;</span>
            case NEW:
<span class="nc" id="L264">                adapter = (PluginBrowserAdapter) mNewPluginsRecycler.getAdapter();</span>
<span class="nc" id="L265">                cardView = findViewById(R.id.new_plugins_container);</span>
<span class="nc" id="L266">                break;</span>
            case SEARCH:
<span class="nc" id="L268">                return;</span>
        }
<span class="nc bnc" id="L270" title="All 4 branches missed.">        if (adapter == null || cardView == null) {</span>
<span class="nc" id="L271">            return;</span>
        }
<span class="nc" id="L273">        List&lt;ImmutablePluginModel&gt; plugins = listState.getData();</span>
<span class="nc" id="L274">        adapter.setPlugins(plugins);</span>

<span class="nc bnc" id="L276" title="All 2 branches missed.">        int newVisibility = plugins.size() &gt; 0 ? View.VISIBLE : View.GONE;</span>
<span class="nc" id="L277">        int oldVisibility = cardView.getVisibility();</span>
<span class="nc bnc" id="L278" title="All 4 branches missed.">        if (newVisibility == View.VISIBLE &amp;&amp; oldVisibility != View.VISIBLE) {</span>
<span class="nc" id="L279">            AniUtils.fadeIn(cardView, AniUtils.Duration.MEDIUM);</span>
<span class="nc bnc" id="L280" title="All 4 branches missed.">        } else if (newVisibility != View.VISIBLE &amp;&amp; oldVisibility == View.VISIBLE) {</span>
<span class="nc" id="L281">            AniUtils.fadeOut(cardView, AniUtils.Duration.MEDIUM);</span>
        }
<span class="nc" id="L283">    }</span>

    @Override
    public boolean onQueryTextSubmit(String query) {
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (mSearchView != null) {</span>
<span class="nc" id="L288">            mSearchView.clearFocus();</span>
        }
<span class="nc" id="L290">        ActivityUtils.hideKeyboard(this);</span>
<span class="nc" id="L291">        return true;</span>
    }

    @Override
    public boolean onQueryTextChange(String query) {
<span class="nc bnc" id="L296" title="All 2 branches missed.">        mViewModel.setSearchQuery(query != null ? query : &quot;&quot;);</span>
<span class="nc" id="L297">        return true;</span>
    }

    private void showListFragment(@NonNull PluginListType listType) {
<span class="nc" id="L301">        AppBarLayoutExtensionsKt.setLiftOnScrollTargetViewIdAndRequestLayout(mAppBar, R.id.recycler);</span>
<span class="nc" id="L302">        PluginListFragment listFragment = PluginListFragment.newInstance(mViewModel.getSite(), listType);</span>
<span class="nc" id="L303">        getSupportFragmentManager().beginTransaction()</span>
<span class="nc" id="L304">                                   .replace(R.id.fragment_container, listFragment, PluginListFragment.TAG)</span>
<span class="nc" id="L305">                                   .addToBackStack(null)</span>
<span class="nc" id="L306">                                   .setTransition(FragmentTransaction.TRANSIT_FRAGMENT_FADE)</span>
<span class="nc" id="L307">                                   .commit();</span>
<span class="nc" id="L308">        mViewModel.setTitle(getTitleForListType(listType));</span>
<span class="nc" id="L309">        trackPluginListOpened(listType);</span>
<span class="nc" id="L310">    }</span>

    private @Nullable PluginListFragment getCurrentFragment() {
<span class="nc" id="L313">        return (PluginListFragment) getSupportFragmentManager().findFragmentByTag(PluginListFragment.TAG);</span>
    }

    private void hideListFragment() {
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (getSupportFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span class="nc" id="L318">            onBackPressed();</span>
        }
<span class="nc" id="L320">    }</span>

    private void showProgress(boolean show) {
<span class="nc bnc" id="L323" title="All 2 branches missed.">        findViewById(R.id.progress).setVisibility(show ? View.VISIBLE : View.GONE);</span>
<span class="nc" id="L324">    }</span>

    @Override
    public boolean onMenuItemActionExpand(MenuItem menuItem) {
<span class="nc" id="L328">        showListFragment(PluginListType.SEARCH);</span>
<span class="nc" id="L329">        mSearchView.setOnQueryTextListener(this);</span>
<span class="nc" id="L330">        return true;</span>
    }

    @Override
    public boolean onMenuItemActionCollapse(MenuItem menuItem) {
<span class="nc" id="L335">        mSearchView.setOnQueryTextListener(null);</span>
<span class="nc" id="L336">        hideListFragment();</span>
<span class="nc" id="L337">        mViewModel.setSearchQuery(&quot;&quot;);</span>
<span class="nc" id="L338">        return true;</span>
    }

    private class PluginBrowserAdapter extends RecyclerView.Adapter&lt;ViewHolder&gt; {
<span class="nc" id="L342">        private final PluginList mItems = new PluginList();</span>
        private final LayoutInflater mLayoutInflater;

<span class="nc" id="L345">        PluginBrowserAdapter(Context context) {</span>
<span class="nc" id="L346">            mLayoutInflater = LayoutInflater.from(context);</span>
<span class="nc" id="L347">            setHasStableIds(true);</span>
<span class="nc" id="L348">        }</span>

        void setPlugins(@NonNull List&lt;ImmutablePluginModel&gt; items) {
<span class="nc" id="L351">            DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(mViewModel.getDiffCallback(mItems, items));</span>
<span class="nc" id="L352">            mItems.clear();</span>
<span class="nc" id="L353">            mItems.addAll(items);</span>
<span class="nc" id="L354">            diffResult.dispatchUpdatesTo(this);</span>
<span class="nc" id="L355">        }</span>

        private @Nullable Object getItem(int position) {
<span class="nc" id="L358">            return mItems.getItem(position);</span>
        }

        @Override
        public int getItemCount() {
<span class="nc" id="L363">            return mItems.size();</span>
        }

        @Override
        public long getItemId(int position) {
<span class="nc" id="L368">            return mItems.getItemId(position);</span>
        }

        @NotNull
        @Override
        public ViewHolder onCreateViewHolder(@NotNull ViewGroup parent, int viewType) {
<span class="nc" id="L374">            View view = mLayoutInflater.inflate(R.layout.plugin_browser_row, parent, false);</span>
<span class="nc" id="L375">            return new PluginBrowserViewHolder(view);</span>
        }

        @Override
        public void onBindViewHolder(@NotNull ViewHolder viewHolder, int position) {
<span class="nc" id="L380">            PluginBrowserViewHolder holder = (PluginBrowserViewHolder) viewHolder;</span>
<span class="nc" id="L381">            ImmutablePluginModel plugin = (ImmutablePluginModel) getItem(position);</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">            if (plugin == null) {</span>
<span class="nc" id="L383">                return;</span>
            }

<span class="nc" id="L386">            holder.mNameText.setText(plugin.getDisplayName());</span>
<span class="nc" id="L387">            holder.mAuthorText.setText(plugin.getAuthorName());</span>
<span class="nc" id="L388">            mImageManager.load(holder.mIcon, ImageType.PLUGIN, StringUtils.notNullStr(plugin.getIcon()));</span>

<span class="nc bnc" id="L390" title="All 2 branches missed.">            if (plugin.isInstalled()) {</span>
                @StringRes int textResId;
                @ColorRes int colorResId;
                @DrawableRes int drawableResId;
<span class="nc" id="L394">                boolean isAutoManaged = PluginUtils.isAutoManaged(mViewModel.getSite(), plugin);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (isAutoManaged) {</span>
<span class="nc" id="L396">                    textResId = R.string.plugin_auto_managed;</span>
<span class="nc" id="L397">                    colorResId = ContextExtensionsKt</span>
<span class="nc" id="L398">                            .getColorResIdFromAttribute(holder.mStatusIcon.getContext(), R.attr.wpColorSuccess);</span>
<span class="nc" id="L399">                    drawableResId = android.R.color.transparent;</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">                } else if (PluginUtils.isUpdateAvailable(plugin)) {</span>
<span class="nc" id="L401">                    textResId = R.string.plugin_needs_update;</span>
<span class="nc" id="L402">                    colorResId = ContextExtensionsKt</span>
<span class="nc" id="L403">                            .getColorResIdFromAttribute(holder.mStatusIcon.getContext(), R.attr.wpColorWarningDark);</span>
<span class="nc" id="L404">                    drawableResId = R.drawable.ic_sync_white_24dp;</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                } else if (plugin.isActive()) {</span>
<span class="nc" id="L406">                    textResId = R.string.plugin_active;</span>
<span class="nc" id="L407">                    colorResId = ContextExtensionsKt</span>
<span class="nc" id="L408">                            .getColorResIdFromAttribute(holder.mStatusIcon.getContext(), R.attr.wpColorSuccess);</span>
<span class="nc" id="L409">                    drawableResId = R.drawable.ic_checkmark_white_24dp;</span>
                } else {
<span class="nc" id="L411">                    textResId = R.string.plugin_inactive;</span>
<span class="nc" id="L412">                    colorResId = ContextExtensionsKt</span>
<span class="nc" id="L413">                            .getColorResIdFromAttribute(holder.mStatusIcon.getContext(), R.attr.wpColorOnSurfaceMedium);</span>
<span class="nc" id="L414">                    drawableResId = R.drawable.ic_cross_white_24dp;</span>
                }
<span class="nc" id="L416">                holder.mStatusText.setText(textResId);</span>
<span class="nc" id="L417">                holder.mStatusText.setTextColor(</span>
<span class="nc" id="L418">                        AppCompatResources.getColorStateList(holder.mStatusText.getContext(), colorResId));</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                holder.mStatusIcon.setVisibility(isAutoManaged ? View.GONE : View.VISIBLE);</span>
<span class="nc" id="L420">                ColorUtils.INSTANCE.setImageResourceWithTint(holder.mStatusIcon, drawableResId, colorResId);</span>
<span class="nc" id="L421">                holder.mStatusContainer.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L422">                holder.mRatingBar.setVisibility(View.GONE);</span>
<span class="nc" id="L423">            } else {</span>
<span class="nc" id="L424">                holder.mStatusContainer.setVisibility(View.GONE);</span>
<span class="nc" id="L425">                holder.mRatingBar.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L426">                holder.mRatingBar.setRating(plugin.getAverageStarRating());</span>
            }
<span class="nc" id="L428">        }</span>

        private class PluginBrowserViewHolder extends ViewHolder {
            private final TextView mNameText;
            private final TextView mAuthorText;
            private final ViewGroup mStatusContainer;
            private final TextView mStatusText;
            private final ImageView mStatusIcon;
            private final ImageView mIcon;
            private final RatingBar mRatingBar;

<span class="nc" id="L439">            PluginBrowserViewHolder(View view) {</span>
<span class="nc" id="L440">                super(view);</span>
<span class="nc" id="L441">                mNameText = view.findViewById(R.id.plugin_name);</span>
<span class="nc" id="L442">                mAuthorText = view.findViewById(R.id.plugin_author);</span>
<span class="nc" id="L443">                mIcon = view.findViewById(R.id.plugin_icon);</span>
<span class="nc" id="L444">                mRatingBar = view.findViewById(R.id.rating_bar);</span>

<span class="nc" id="L446">                mStatusContainer = view.findViewById(R.id.plugin_status_container);</span>
<span class="nc" id="L447">                mStatusText = mStatusContainer.findViewById(R.id.plugin_status_text);</span>
<span class="nc" id="L448">                mStatusIcon = mStatusContainer.findViewById(R.id.plugin_status_icon);</span>

<span class="nc" id="L450">                view.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L451">                    int position = getAdapterPosition();</span>
<span class="nc" id="L452">                    ImmutablePluginModel plugin = (ImmutablePluginModel) getItem(position);</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                    if (plugin == null) {</span>
<span class="nc" id="L454">                        return;</span>
                    }

<span class="nc" id="L457">                    ActivityLauncher.viewPluginDetail(PluginBrowserActivity.this, mViewModel.getSite(),</span>
<span class="nc" id="L458">                            plugin.getSlug());</span>
<span class="nc" id="L459">                });</span>
<span class="nc" id="L460">            }</span>
        }
    }

    private String getTitleForListType(@NonNull PluginListType pluginListType) {
<span class="nc bnc" id="L465" title="All 6 branches missed.">        switch (pluginListType) {</span>
            case FEATURED:
<span class="nc" id="L467">                return getString(R.string.plugin_caption_featured);</span>
            case POPULAR:
<span class="nc" id="L469">                return getString(R.string.plugin_caption_popular);</span>
            case NEW:
<span class="nc" id="L471">                return getString(R.string.plugin_caption_new);</span>
            case SEARCH:
<span class="nc" id="L473">                return getString(R.string.plugin_caption_search);</span>
            case SITE:
<span class="nc" id="L475">                return getString(R.string.plugin_caption_installed);</span>
        }
<span class="nc" id="L477">        return getString(R.string.plugins);</span>
    }

    private void trackPluginListOpened(PluginListType listType) {
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (listType == PluginListType.SEARCH) {</span>
            // Although it's named as &quot;search performed&quot; we are actually only tracking the first search
<span class="nc" id="L483">            AnalyticsUtils.trackWithSiteDetails(AnalyticsTracker.Stat.PLUGIN_SEARCH_PERFORMED, mViewModel.getSite());</span>
<span class="nc" id="L484">            return;</span>
        }
<span class="nc" id="L486">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L487">        String type = null;</span>
<span class="nc bnc" id="L488" title="All 5 branches missed.">        switch (listType) {</span>
            case SITE:
<span class="nc" id="L490">                type = &quot;installed&quot;;</span>
<span class="nc" id="L491">                break;</span>
            case FEATURED:
<span class="nc" id="L493">                type = &quot;featured&quot;;</span>
<span class="nc" id="L494">                break;</span>
            case POPULAR:
<span class="nc" id="L496">                type = &quot;popular&quot;;</span>
<span class="nc" id="L497">                break;</span>
            case NEW:
<span class="nc" id="L499">                type = &quot;newest&quot;;</span>
                break;
        }
<span class="nc" id="L502">        properties.put(&quot;type&quot;, type);</span>
<span class="nc" id="L503">        AnalyticsUtils.trackWithSiteDetails(AnalyticsTracker.Stat.OPENED_PLUGIN_LIST, mViewModel.getSite(), properties);</span>
<span class="nc" id="L504">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>