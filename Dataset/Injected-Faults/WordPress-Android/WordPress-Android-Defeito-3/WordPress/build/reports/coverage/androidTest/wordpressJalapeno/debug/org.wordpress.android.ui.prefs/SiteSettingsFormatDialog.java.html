<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SiteSettingsFormatDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.prefs</a> &gt; <span class="el_source">SiteSettingsFormatDialog.java</span></div><h1>SiteSettingsFormatDialog.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.prefs;

import android.app.Activity;
import android.app.Dialog;
import android.app.DialogFragment;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.RadioGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.annotation.StringRes;
import androidx.appcompat.app.AlertDialog;

import com.google.android.material.dialog.MaterialAlertDialogBuilder;
import com.google.android.material.radiobutton.MaterialRadioButton;

import org.wordpress.android.Constants;
import org.wordpress.android.R;
import org.wordpress.android.ui.ActivityLauncher;
import org.wordpress.android.ui.utils.UiHelpers;
import org.wordpress.android.util.EditTextUtils;

/**
 * Custom date/time format dialog
 */

<span class="nc" id="L34">public class SiteSettingsFormatDialog extends DialogFragment implements DialogInterface.OnClickListener {</span>
<span class="nc" id="L35">    public enum FormatType {</span>
<span class="nc" id="L36">        DATE_FORMAT,</span>
<span class="nc" id="L37">        TIME_FORMAT;</span>

        public String[] getEntries(@NonNull Context context) {
<span class="nc bnc" id="L40" title="All 2 branches missed.">            if (this == FormatType.DATE_FORMAT) {</span>
<span class="nc" id="L41">                return context.getResources().getStringArray(R.array.date_format_entries);</span>
            } else {
<span class="nc" id="L43">                return context.getResources().getStringArray(R.array.time_format_entries);</span>
            }
        }

        public String[] getValues(@NonNull Context context) {
<span class="nc bnc" id="L48" title="All 2 branches missed.">            if (this == FormatType.DATE_FORMAT) {</span>
<span class="nc" id="L49">                return context.getResources().getStringArray(R.array.date_format_values);</span>
            } else {
<span class="nc" id="L51">                return context.getResources().getStringArray(R.array.time_format_values);</span>
            }
        }
    }

    private static final String KEY_FORMAT_TYPE = &quot;format_type&quot;;
    public static final String KEY_FORMAT_VALUE = &quot;format_value&quot;;

    private String mFormatValue;
    private boolean mConfirmed;

    private EditText mEditCustomFormat;
    private RadioGroup mRadioGroup;

    private String[] mEntries;
    private String[] mValues;

    public static SiteSettingsFormatDialog newInstance(@NonNull FormatType formatType, @NonNull String formatValue) {
<span class="nc" id="L69">        Bundle args = new Bundle();</span>
<span class="nc" id="L70">        args.putSerializable(KEY_FORMAT_TYPE, formatType);</span>
<span class="nc" id="L71">        args.putString(KEY_FORMAT_VALUE, formatValue);</span>

<span class="nc" id="L73">        SiteSettingsFormatDialog dialog = new SiteSettingsFormatDialog();</span>
<span class="nc" id="L74">        dialog.setArguments(args);</span>
<span class="nc" id="L75">        return dialog;</span>
    }

    @Override
    public Dialog onCreateDialog(Bundle savedInstanceState) {
<span class="nc" id="L80">        View view = View.inflate(getActivity(), R.layout.site_settings_format_dialog, null);</span>
<span class="nc" id="L81">        TextView txtTitle = view.findViewById(R.id.text_title);</span>
<span class="nc" id="L82">        TextView txtHelp = view.findViewById(R.id.text_help);</span>
<span class="nc" id="L83">        mEditCustomFormat = view.findViewById(R.id.edit_custom);</span>
<span class="nc" id="L84">        mRadioGroup = view.findViewById(R.id.radio_group);</span>

<span class="nc" id="L86">        Bundle args = getArguments();</span>
<span class="nc" id="L87">        FormatType formatType = (FormatType) args.getSerializable(KEY_FORMAT_TYPE);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if (formatType == null) {</span>
<span class="nc" id="L89">            formatType = FormatType.DATE_FORMAT;</span>
        }
<span class="nc" id="L91">        mFormatValue = args.getString(KEY_FORMAT_VALUE);</span>

<span class="nc" id="L93">        mEntries = formatType.getEntries(getActivity());</span>
<span class="nc" id="L94">        mValues = formatType.getValues(getActivity());</span>
<span class="nc" id="L95">        createRadioButtons();</span>

<span class="nc" id="L97">        boolean isCustomFormat = isCustomFormatValue(mFormatValue);</span>
<span class="nc" id="L98">        mEditCustomFormat.setEnabled(isCustomFormat);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (isCustomFormat) {</span>
<span class="nc" id="L100">            mEditCustomFormat.setText(mFormatValue);</span>
        }

<span class="nc bnc" id="L103" title="All 2 branches missed.">        @StringRes int titleRes = formatType == FormatType.DATE_FORMAT</span>
<span class="nc" id="L104">                ? R.string.site_settings_date_format_title : R.string.site_settings_time_format_title;</span>
<span class="nc" id="L105">        txtTitle.setText(titleRes);</span>

<span class="nc" id="L107">        txtHelp.setOnClickListener(</span>
<span class="nc" id="L108">                v -&gt; ActivityLauncher.openUrlExternal(v.getContext(), Constants.URL_DATETIME_FORMAT_HELP));</span>

<span class="nc" id="L110">        int topOffset = getResources().getDimensionPixelOffset(R.dimen.settings_fragment_dialog_vertical_inset);</span>

<span class="nc" id="L112">        AlertDialog.Builder builder = new MaterialAlertDialogBuilder(getActivity())</span>
<span class="nc" id="L113">                .setBackgroundInsetTop(topOffset)</span>
<span class="nc" id="L114">                .setBackgroundInsetBottom(topOffset);</span>
<span class="nc" id="L115">        builder.setPositiveButton(android.R.string.ok, this);</span>
<span class="nc" id="L116">        builder.setNegativeButton(R.string.cancel, this);</span>
<span class="nc" id="L117">        builder.setView(view);</span>

<span class="nc" id="L119">        return builder.create();</span>
    }

    private void createRadioButtons() {
<span class="nc" id="L123">        boolean isCustomFormat = isCustomFormatValue(mFormatValue);</span>
<span class="nc" id="L124">        int margin = getResources().getDimensionPixelSize(R.dimen.margin_small);</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">        for (int i = 0; i &lt; mEntries.length; i++) {</span>
<span class="nc" id="L127">            MaterialRadioButton radio = new MaterialRadioButton(getActivity());</span>
<span class="nc" id="L128">            radio.setText(mEntries[i]);</span>
<span class="nc" id="L129">            radio.setId(i);</span>
<span class="nc" id="L130">            mRadioGroup.addView(radio);</span>

<span class="nc" id="L132">            LinearLayout.LayoutParams params = (LinearLayout.LayoutParams) radio.getLayoutParams();</span>
<span class="nc" id="L133">            params.topMargin = margin;</span>
<span class="nc" id="L134">            params.bottomMargin = margin;</span>

<span class="nc bnc" id="L136" title="All 4 branches missed.">            if (isCustomFormat &amp;&amp; isCustomFormatEntry(mEntries[i])) {</span>
<span class="nc" id="L137">                radio.setChecked(true);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            } else if (mValues[i].equals(mFormatValue)) {</span>
<span class="nc" id="L139">                radio.setChecked(true);</span>
            }
        }

<span class="nc" id="L143">        mRadioGroup.setOnCheckedChangeListener(</span>
<span class="nc" id="L144">                (group, checkedId) -&gt; mEditCustomFormat.setEnabled(isCustomFormatEntry(mEntries[checkedId])));</span>
<span class="nc" id="L145">    }</span>

    @Override
    public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L149" title="All 2 branches missed.">        mConfirmed = which == DialogInterface.BUTTON_POSITIVE;</span>
<span class="nc" id="L150">        dismiss();</span>
<span class="nc" id="L151">    }</span>

    private boolean isCustomFormatEntry(@NonNull String entry) {
<span class="nc" id="L154">        String customEntry = getString(R.string.site_settings_format_entry_custom);</span>
<span class="nc" id="L155">        return entry.equals(customEntry);</span>
    }

    private boolean isCustomFormatValue(@NonNull String value) {
<span class="nc bnc" id="L159" title="All 2 branches missed.">        for (String thisValue : mValues) {</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">            if (thisValue.equals(value)) {</span>
<span class="nc" id="L161">                return false;</span>
            }
        }
<span class="nc" id="L164">        return true;</span>
    }

    private String getSelectedFormatValue() {
<span class="nc" id="L168">        int id = mRadioGroup.getCheckedRadioButtonId();</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (id == -1) {</span>
<span class="nc" id="L170">            return null;</span>
        }
<span class="nc bnc" id="L172" title="All 2 branches missed.">        if (isCustomFormatEntry(mEntries[id])) {</span>
<span class="nc" id="L173">            return EditTextUtils.getText(mEditCustomFormat);</span>
        }
<span class="nc" id="L175">        return mValues[id];</span>
    }

    @Override
    public void onResume() {
<span class="nc" id="L180">        super.onResume();</span>
<span class="nc" id="L181">        UiHelpers.Companion.adjustDialogSize(getDialog());</span>
<span class="nc" id="L182">    }</span>

    @Override
    public void onDismiss(DialogInterface dialog) {
<span class="nc" id="L186">        String formatValue = getSelectedFormatValue();</span>
        // TODO: android.app.Fragment  is deprecated since Android P.
        // Needs to be replaced with android.support.v4.app.Fragment
        // See https://developer.android.com/reference/android/app/Fragment
<span class="nc" id="L190">        android.app.Fragment target = getTargetFragment();</span>
<span class="nc bnc" id="L191" title="All 6 branches missed.">        if (mConfirmed &amp;&amp; target != null &amp;&amp; !TextUtils.isEmpty(formatValue)) {</span>
<span class="nc" id="L192">            Intent intent = new Intent().putExtra(KEY_FORMAT_VALUE, formatValue);</span>
<span class="nc" id="L193">            target.onActivityResult(getTargetRequestCode(), Activity.RESULT_OK, intent);</span>
        }

<span class="nc" id="L196">        super.onDismiss(dialog);</span>
<span class="nc" id="L197">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>