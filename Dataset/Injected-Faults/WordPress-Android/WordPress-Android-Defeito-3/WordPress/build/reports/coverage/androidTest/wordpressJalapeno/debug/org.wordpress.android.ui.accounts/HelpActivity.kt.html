<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HelpActivity.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.accounts</a> &gt; <span class="el_source">HelpActivity.kt</span></div><h1>HelpActivity.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.accounts

import android.content.Context
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.view.MenuItem
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.analytics.AnalyticsTracker
import org.wordpress.android.analytics.AnalyticsTracker.Stat
import org.wordpress.android.databinding.HelpActivityBinding
import org.wordpress.android.fluxc.model.SiteModel
import org.wordpress.android.fluxc.store.AccountStore
import org.wordpress.android.fluxc.store.SiteStore
import org.wordpress.android.support.SupportHelper
import org.wordpress.android.support.ZendeskExtraTags
import org.wordpress.android.support.ZendeskHelper
import org.wordpress.android.ui.ActivityId
import org.wordpress.android.ui.AppLogViewerActivity
import org.wordpress.android.ui.LocaleAwareActivity
import org.wordpress.android.ui.prefs.AppPrefs
import org.wordpress.android.util.SiteUtils
import java.util.ArrayList
import javax.inject.Inject

<span class="nc" id="L27">class HelpActivity : LocaleAwareActivity() {</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">    @Inject lateinit var accountStore: AccountStore</span>
<span class="nc bnc" id="L29" title="All 2 branches missed.">    @Inject lateinit var siteStore: SiteStore</span>
<span class="nc bnc" id="L30" title="All 2 branches missed.">    @Inject lateinit var supportHelper: SupportHelper</span>
<span class="nc bnc" id="L31" title="All 2 branches missed.">    @Inject lateinit var zendeskHelper: ZendeskHelper</span>
    private lateinit var binding: HelpActivityBinding

<span class="nc" id="L34">    private val originFromExtras by lazy {</span>
<span class="nc bnc" id="L35" title="All 4 branches missed.">        (intent.extras?.get(ORIGIN_KEY) as Origin?) ?: Origin.UNKNOWN</span>
    }
<span class="nc" id="L37">    private val extraTagsFromExtras by lazy {</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">        intent.extras?.getStringArrayList(EXTRA_TAGS_KEY)</span>
    }
<span class="nc" id="L40">    private val selectedSiteFromExtras by lazy {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">        intent.extras?.get(WordPress.SITE) as SiteModel?</span>
    }

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L45">        super.onCreate(savedInstanceState)</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">        (application as WordPress).component().inject(this)</span>
<span class="nc" id="L47">        with(HelpActivityBinding.inflate(layoutInflater)) {</span>
<span class="nc" id="L48">            binding = this</span>
<span class="nc" id="L49">            setContentView(root)</span>
<span class="nc" id="L50">            setSupportActionBar(toolbarMain)</span>

<span class="nc" id="L52">            val actionBar = supportActionBar</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">            if (actionBar != null) {</span>
<span class="nc" id="L54">                actionBar.setHomeButtonEnabled(true)</span>
<span class="nc" id="L55">                actionBar.setDisplayHomeAsUpEnabled(true)</span>
<span class="nc" id="L56">                actionBar.elevation = 0f // remove shadow</span>
            }

<span class="nc" id="L59">            contactUsButton.setOnClickListener { createNewZendeskTicket() }</span>
<span class="nc" id="L60">            faqButton.setOnClickListener { showFaq() }</span>
<span class="nc" id="L61">            myTicketsButton.setOnClickListener { showZendeskTickets() }</span>
<span class="nc" id="L62">            applicationVersion.text = getString(R.string.version_with_name_param, WordPress.versionName)</span>
<span class="nc" id="L63">            applicationLogButton.setOnClickListener { v -&gt;</span>
<span class="nc" id="L64">                startActivity(Intent(v.context, AppLogViewerActivity::class.java))</span>
<span class="nc" id="L65">            }</span>

<span class="nc" id="L67">            contactEmailContainer.setOnClickListener {</span>
<span class="nc" id="L68">                var emailSuggestion = AppPrefs.getSupportEmail()</span>
<span class="nc bnc" id="L69" title="All 6 branches missed.">                if (emailSuggestion.isNullOrEmpty()) {</span>
<span class="nc" id="L70">                    emailSuggestion = supportHelper</span>
<span class="nc" id="L71">                            .getSupportEmailAndNameSuggestion(</span>
<span class="nc" id="L72">                                    accountStore.account,</span>
<span class="nc" id="L73">                                    selectedSiteFromExtras</span>
<span class="nc" id="L74">                            ).first</span>
                }

<span class="nc" id="L77">                supportHelper.showSupportIdentityInputDialog(</span>
<span class="nc" id="L78">                        this@HelpActivity,</span>
<span class="nc" id="L79">                        emailSuggestion,</span>
<span class="nc" id="L80">                        isNameInputHidden = true</span>
                ) { email, _ -&gt;
<span class="nc" id="L82">                    zendeskHelper.setSupportEmail(email)</span>
<span class="nc" id="L83">                    refreshContactEmailText()</span>
<span class="nc" id="L84">                    AnalyticsTracker.track(Stat.SUPPORT_IDENTITY_SET)</span>
<span class="nc" id="L85">                }</span>
<span class="nc" id="L86">                AnalyticsTracker.track(Stat.SUPPORT_IDENTITY_FORM_VIEWED)</span>
<span class="nc" id="L87">            }</span>
<span class="nc" id="L88">        }</span>
        /**
         * If the user taps on a Zendesk notification, we want to show them the `My Tickets` page. However, this
         * should only be triggered when the activity is first created, otherwise if the user comes back from
         * `My Tickets` and rotates the screen (or triggers the activity re-creation in any other way) it'll navigate
         * them to `My Tickets` again since the `originFromExtras` will still be [Origin.ZENDESK_NOTIFICATION].
         */
<span class="nc bnc" id="L95" title="All 4 branches missed.">        if (savedInstanceState == null &amp;&amp; originFromExtras == Origin.ZENDESK_NOTIFICATION) {</span>
<span class="nc" id="L96">            showZendeskTickets()</span>
        }
<span class="nc" id="L98">    }</span>

    override fun onResume() {
<span class="nc" id="L101">        super.onResume()</span>
<span class="nc" id="L102">        ActivityId.trackLastActivity(ActivityId.HELP_SCREEN)</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">        binding.refreshContactEmailText()</span>
<span class="nc" id="L104">    }</span>

    override fun onOptionsItemSelected(item: MenuItem): Boolean {
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if (item.itemId == android.R.id.home) {</span>
<span class="nc" id="L108">            onBackPressed()</span>
<span class="nc" id="L109">            return true</span>
        }
<span class="nc" id="L111">        return super.onOptionsItemSelected(item)</span>
    }

    private fun createNewZendeskTicket() {
<span class="nc" id="L115">        zendeskHelper.createNewTicket(</span>
<span class="nc" id="L116">                this,</span>
<span class="nc" id="L117">                originFromExtras,</span>
<span class="nc" id="L118">                selectedSiteFromExtras,</span>
<span class="nc" id="L119">                extraTagsFromExtras</span>
        )
<span class="nc" id="L121">    }</span>

    private fun showZendeskTickets() {
<span class="nc" id="L124">        zendeskHelper.showAllTickets(</span>
<span class="nc" id="L125">                this,</span>
<span class="nc" id="L126">                originFromExtras,</span>
<span class="nc" id="L127">                selectedSiteFromExtras,</span>
<span class="nc" id="L128">                extraTagsFromExtras</span>
        )
<span class="nc" id="L130">    }</span>

    private fun showFaq() {
<span class="nc" id="L133">        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(&quot;http://apps.wordpress.com/mobile-app-support/&quot;))</span>
<span class="nc" id="L134">        startActivity(intent)</span>
<span class="nc" id="L135">        AnalyticsTracker.track(Stat.SUPPORT_HELP_CENTER_VIEWED)</span>
<span class="nc" id="L136">    }</span>

    private fun HelpActivityBinding.refreshContactEmailText() {
<span class="nc" id="L139">        val supportEmail = AppPrefs.getSupportEmail()</span>
<span class="nc bnc" id="L140" title="All 6 branches missed.">        contactEmailAddress.text = if (!supportEmail.isNullOrEmpty()) {</span>
<span class="nc" id="L141">            supportEmail</span>
        } else {
<span class="nc" id="L143">            getString(R.string.support_contact_email_not_set)</span>
        }
<span class="nc" id="L145">    }</span>

<span class="nc" id="L147">    enum class Origin(private val stringValue: String) {</span>
<span class="nc" id="L148">        UNKNOWN(&quot;origin:unknown&quot;),</span>
<span class="nc" id="L149">        ZENDESK_NOTIFICATION(&quot;origin:zendesk-notification&quot;),</span>
<span class="nc" id="L150">        LOGIN_SCREEN_WPCOM(&quot;origin:wpcom-login-screen&quot;),</span>
<span class="nc" id="L151">        LOGIN_SCREEN_SELF_HOSTED(&quot;origin:wporg-login-screen&quot;),</span>
<span class="nc" id="L152">        LOGIN_SCREEN_JETPACK(&quot;origin:jetpack-login-screen&quot;),</span>
<span class="nc" id="L153">        SIGNUP_SCREEN(&quot;origin:signup-screen&quot;),</span>
<span class="nc" id="L154">        ME_SCREEN_HELP(&quot;origin:me-screen-help&quot;),</span>
<span class="nc" id="L155">        DELETE_SITE(&quot;origin:delete-site&quot;),</span>
<span class="nc" id="L156">        DISCARD_CHANGES(&quot;origin:discard-changes&quot;),</span>
<span class="nc" id="L157">        FEEDBACK_AZTEC(&quot;origin:aztec-feedback&quot;),</span>
<span class="nc" id="L158">        LOGIN_EMAIL(&quot;origin:login-email&quot;),</span>
<span class="nc" id="L159">        LOGIN_MAGIC_LINK(&quot;origin:login-magic-link&quot;),</span>
<span class="nc" id="L160">        LOGIN_EMAIL_PASSWORD(&quot;origin:login-wpcom-password&quot;),</span>
<span class="nc" id="L161">        LOGIN_2FA(&quot;origin:login-2fa&quot;),</span>
<span class="nc" id="L162">        LOGIN_SITE_ADDRESS(&quot;origin:login-site-address&quot;),</span>
<span class="nc" id="L163">        LOGIN_SOCIAL(&quot;origin:login-social&quot;),</span>
<span class="nc" id="L164">        LOGIN_USERNAME_PASSWORD(&quot;origin:login-username-password&quot;),</span>
<span class="nc" id="L165">        RELEASE_NOTES(&quot;origin:release-notes&quot;),</span>
<span class="nc" id="L166">        SIGNUP_EMAIL(&quot;origin:signup-email&quot;),</span>
<span class="nc" id="L167">        SIGNUP_MAGIC_LINK(&quot;origin:signup-magic-link&quot;),</span>
<span class="nc" id="L168">        SIGNUP_CONFIRMATION(&quot;origin:signup-confirmation&quot;),</span>
<span class="nc" id="L169">        SITE_CREATION_CREATING(&quot;origin:site-create-creating&quot;),</span>
<span class="nc" id="L170">        SITE_CREATION_SEGMENTS(&quot;origin:site-create-site-segments&quot;),</span>
<span class="nc" id="L171">        SITE_CREATION_VERTICALS(&quot;origin:site-create-site-verticals&quot;),</span>
<span class="nc" id="L172">        SITE_CREATION_DOMAINS(&quot;origin:site-create-domains&quot;),</span>
<span class="nc" id="L173">        SITE_CREATION_SITE_INFO(&quot;origin:site-create-site-info&quot;),</span>
<span class="nc" id="L174">        EDITOR_HELP(&quot;origin:editor-help&quot;),</span>
<span class="nc" id="L175">        SCAN_SCREEN_HELP(&quot;origin:scan-screen-help&quot;);</span>

        override fun toString(): String {
<span class="nc" id="L178">            return stringValue</span>
        }
    }

    companion object {
        private const val ORIGIN_KEY = &quot;ORIGIN_KEY&quot;
        private const val EXTRA_TAGS_KEY = &quot;EXTRA_TAGS_KEY&quot;

        @JvmStatic
        fun createIntent(
            context: Context,
            origin: Origin,
            selectedSite: SiteModel?,
            extraSupportTags: List&lt;String&gt;?
        ): Intent {
<span class="nc" id="L193">            val intent = Intent(context, HelpActivity::class.java)</span>
<span class="nc" id="L194">            intent.putExtra(ORIGIN_KEY, origin)</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">            if (selectedSite != null) {</span>
<span class="nc" id="L196">                intent.putExtra(WordPress.SITE, selectedSite)</span>
            }

            // construct a mutable list to add the related and extra tags
<span class="nc" id="L200">            val tagsList = ArrayList&lt;String&gt;()</span>

            // add the provided list of tags if any
<span class="nc bnc" id="L203" title="All 2 branches missed.">            extraSupportTags?.let {</span>
<span class="nc" id="L204">                tagsList.addAll(extraSupportTags)</span>
            }

            // Append the &quot;mobile_gutenberg_is_default&quot; tag if gutenberg is set to default for new posts
<span class="nc bnc" id="L208" title="All 2 branches missed.">            if (SiteUtils.isBlockEditorDefaultForNewPost(selectedSite)) {</span>
<span class="nc" id="L209">                tagsList.add(ZendeskExtraTags.gutenbergIsDefault)</span>
            }

<span class="nc bnc" id="L212" title="All 4 branches missed.">            if (tagsList.isNotEmpty()) {</span>
<span class="nc" id="L213">                intent.putStringArrayListExtra(EXTRA_TAGS_KEY, tagsList)</span>
            }

<span class="nc" id="L216">            return intent</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>