<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AnalyticsUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.util.analytics</a> &gt; <span class="el_source">AnalyticsUtils.java</span></div><h1>AnalyticsUtils.java</h1><pre class="source lang-java linenums">package org.wordpress.android.util.analytics;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.net.Uri;
import android.preference.PreferenceManager;
import android.text.Html;
import android.text.TextUtils;
import android.webkit.MimeTypeMap;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.VisibleForTesting;

import org.json.JSONException;
import org.json.JSONObject;
import org.wordpress.android.BuildConfig;
import org.wordpress.android.R;
import org.wordpress.android.analytics.AnalyticsMetadata;
import org.wordpress.android.analytics.AnalyticsTracker;
import org.wordpress.android.analytics.AnalyticsTracker.Stat;
import org.wordpress.android.analytics.AnalyticsTrackerNosara;
import org.wordpress.android.fluxc.Dispatcher;
import org.wordpress.android.fluxc.generated.AccountActionBuilder;
import org.wordpress.android.fluxc.model.CommentModel;
import org.wordpress.android.fluxc.model.PostImmutableModel;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.fluxc.store.AccountStore;
import org.wordpress.android.fluxc.store.AccountStore.PushAccountSettingsPayload;
import org.wordpress.android.fluxc.store.SiteStore;
import org.wordpress.android.models.ReaderPost;
import org.wordpress.android.ui.PagePostCreationSourcesDetail;
import org.wordpress.android.ui.posts.EditPostActivity;
import org.wordpress.android.ui.posts.PostListViewLayoutType;
import org.wordpress.android.ui.posts.PostUtils;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.FluxCUtils;
import org.wordpress.android.util.ImageUtils;
import org.wordpress.android.util.MediaUtils;
import org.wordpress.android.util.SiteUtils;
import org.wordpress.android.util.VideoUtils;

import java.io.File;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;

import static org.wordpress.android.ui.PagePostCreationSourcesDetail.CREATED_POST_SOURCE_DETAIL_KEY;
import static org.wordpress.android.ui.posts.EditPostActivity.EXTRA_IS_QUICKPRESS;

<span class="nc" id="L54">public class AnalyticsUtils {</span>
    private static final String BLOG_ID_KEY = &quot;blog_id&quot;;
    private static final String POST_ID_KEY = &quot;post_id&quot;;
    private static final String FOLLOW_KEY = &quot;follow&quot;;
    private static final String COMMENT_ID_KEY = &quot;comment_id&quot;;
    private static final String FEED_ID_KEY = &quot;feed_id&quot;;
    private static final String FEED_ITEM_ID_KEY = &quot;feed_item_id&quot;;
    private static final String SOURCE_BLOG_ID_KEY = &quot;source_blog_id&quot;;
    private static final String SOURCE_POST_ID_KEY = &quot;source_post_id&quot;;
    private static final String TARGET_BLOG_ID_KEY = &quot;target_blog_id&quot;;
    private static final String IS_JETPACK_KEY = &quot;is_jetpack&quot;;
    private static final String INTENT_ACTION = &quot;intent_action&quot;;
    private static final String INTENT_HOST = &quot;intent_host&quot;;
    private static final String INTENT_DATA = &quot;intent_data&quot;;
    private static final String INTERCEPTOR_CLASSNAME = &quot;interceptor_classname&quot;;
    private static final String NEWS_CARD_ORIGIN = &quot;origin&quot;;
    private static final String NEWS_CARD_VERSION = &quot;version&quot;;
    private static final String SITE_TYPE_KEY = &quot;site_type&quot;;
    private static final String COMMENT_ACTION_SOURCE = &quot;source&quot;;
    private static final String SOURCE_KEY = &quot;source&quot;;
    private static final String URL_KEY = &quot;url&quot;;
    private static final String SOURCE_INFO_KEY = &quot;source_info&quot;;
    private static final String LIST_TYPE_KEY = &quot;list_type&quot;;
    private static final String IS_STORAGE_SETTINGS_RESOLVED_KEY = &quot;is_storage_settings_resolved&quot;;
    private static final String PAGE_KEY = &quot;page&quot;;
    private static final String PER_PAGE_KEY = &quot;per_page&quot;;
    private static final String CAUSE_OF_ISSUE_KEY = &quot;cause_of_issue&quot;;

    public static final String HAS_GUTENBERG_BLOCKS_KEY = &quot;has_gutenberg_blocks&quot;;
    public static final String HAS_WP_STORIES_BLOCKS_KEY = &quot;has_wp_stories_blocks&quot;;
    public static final String EDITOR_HAS_HW_ACCELERATION_DISABLED_KEY = &quot;editor_has_hw_disabled&quot;;
    public static final String EXTRA_CREATION_SOURCE_DETAIL = &quot;creationSourceDetail&quot;;
    public static final String PROMPT_ID = &quot;prompt_id&quot;;

<span class="nc" id="L88">    public enum BlockEditorEnabledSource {</span>
<span class="nc" id="L89">        VIA_SITE_SETTINGS,</span>
<span class="nc" id="L90">        ON_SITE_CREATION,</span>
<span class="nc" id="L91">        ON_BLOCK_POST_OPENING,</span>
<span class="nc" id="L92">        ON_PROGRESSIVE_ROLLOUT_PHASE_1,</span>
<span class="nc" id="L93">        ON_PROGRESSIVE_ROLLOUT_PHASE_2;</span>

        public Map&lt;String, Object&gt; asPropertyMap() {
<span class="nc" id="L96">            Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L97">            properties.put(&quot;source&quot;, name().toLowerCase(Locale.ROOT));</span>
<span class="nc" id="L98">            return properties;</span>
        }
    }

    public static void trackEditorCreatedPost(String action, Intent intent, SiteModel site, PostImmutableModel post) {
<span class="nc" id="L103">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
        // Post created from the post list (new post button).
<span class="nc" id="L105">        String normalizedSourceName = &quot;post-list&quot;;</span>

<span class="nc bnc" id="L107" title="All 4 branches missed.">        if (Intent.ACTION_SEND.equals(action) || Intent.ACTION_SEND_MULTIPLE.equals(action)) {</span>
            // Post created with share with WordPress
<span class="nc" id="L109">            normalizedSourceName = &quot;shared-from-external-app&quot;;</span>
        }
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (EditPostActivity.NEW_MEDIA_POST.equals(</span>
                action)) {
            // Post created from the media library
<span class="nc" id="L114">            normalizedSourceName = &quot;media-library&quot;;</span>
        }
<span class="nc bnc" id="L116" title="All 4 branches missed.">        if (intent != null &amp;&amp; intent.hasExtra(EXTRA_IS_QUICKPRESS)) {</span>
            // Quick press
<span class="nc" id="L118">            normalizedSourceName = &quot;quick-press&quot;;</span>
        }
<span class="nc" id="L120">        PostUtils.addPostTypeAndPostFormatToAnalyticsProperties(post, properties);</span>
<span class="nc" id="L121">        properties.put(&quot;created_post_source&quot;, normalizedSourceName);</span>

<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (intent != null</span>
<span class="nc bnc" id="L124" title="All 4 branches missed.">            &amp;&amp; intent.hasExtra(EXTRA_CREATION_SOURCE_DETAIL)</span>
            &amp;&amp; normalizedSourceName == &quot;post-list&quot;) {
<span class="nc" id="L126">            PagePostCreationSourcesDetail source =</span>
<span class="nc" id="L127">                    (PagePostCreationSourcesDetail) intent.getSerializableExtra(EXTRA_CREATION_SOURCE_DETAIL);</span>
<span class="nc" id="L128">            properties.put(</span>
                    CREATED_POST_SOURCE_DETAIL_KEY,
<span class="nc bnc" id="L130" title="All 2 branches missed.">                    source != null ? source.getLabel() : PagePostCreationSourcesDetail.NO_DETAIL.getLabel()</span>
            );
<span class="nc" id="L132">        } else {</span>
<span class="nc" id="L133">            properties.put(</span>
                    CREATED_POST_SOURCE_DETAIL_KEY,
<span class="nc" id="L135">                    PagePostCreationSourcesDetail.NO_DETAIL.getLabel()</span>
            );
        }

<span class="nc" id="L139">        AnalyticsUtils.trackWithSiteDetails(</span>
                AnalyticsTracker.Stat.EDITOR_CREATED_POST,
                site,
                properties
        );
<span class="nc" id="L144">    }</span>

    public static void updateAnalyticsPreference(Context ctx,
                                                 Dispatcher mDispatcher,
                                                 AccountStore mAccountStore,
                                                 boolean optOut) {
<span class="nc" id="L150">        AnalyticsTracker.setHasUserOptedOut(optOut);</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (optOut) {</span>
<span class="nc" id="L152">            AnalyticsTracker.clearAllData();</span>
        }
        // Sync with wpcom if a token is available
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (mAccountStore.hasAccessToken()) {</span>
<span class="nc" id="L156">            mAccountStore.getAccount().setTracksOptOut(optOut);</span>
<span class="nc" id="L157">            PushAccountSettingsPayload payload = new PushAccountSettingsPayload();</span>
<span class="nc" id="L158">            payload.params = new HashMap&lt;&gt;();</span>
<span class="nc" id="L159">            payload.params.put(&quot;tracks_opt_out&quot;, optOut);</span>
<span class="nc" id="L160">            mDispatcher.dispatch(AccountActionBuilder.newPushSettingsAction(payload));</span>
        }
        // Store the preference locally
<span class="nc" id="L163">        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(ctx);</span>
<span class="nc" id="L164">        final SharedPreferences.Editor editor = prefs.edit();</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">        editor.putBoolean(ctx.getString(R.string.pref_key_send_usage), !optOut);</span>
<span class="nc" id="L166">        editor.apply();</span>
<span class="nc" id="L167">    }</span>

    /**
     * Utility methods to refresh metadata.
     */
    public static void refreshMetadata(AccountStore accountStore, SiteStore siteStore) {
<span class="fc" id="L173">        AnalyticsMetadata metadata = new AnalyticsMetadata();</span>

<span class="fc" id="L175">        metadata.setUserConnected(FluxCUtils.isSignedInWPComOrHasWPOrgSite(accountStore, siteStore));</span>
<span class="fc" id="L176">        metadata.setWordPressComUser(accountStore.hasAccessToken());</span>
<span class="fc" id="L177">        metadata.setJetpackUser(isJetpackUser(siteStore));</span>
<span class="fc" id="L178">        metadata.setNumBlogs(siteStore.getSitesCount());</span>
<span class="fc" id="L179">        metadata.setUsername(accountStore.getAccount().getUserName());</span>
<span class="fc" id="L180">        metadata.setEmail(accountStore.getAccount().getEmail());</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">        String scheme = BuildConfig.DEBUG ? &quot;debug&quot; : BuildConfig.FLAVOR;</span>
<span class="fc" id="L182">        metadata.setAppScheme(scheme);</span>
<span class="pc bpc" id="L183" title="1 of 2 branches missed.">        if (siteStore.hasSite()) {</span>
<span class="fc" id="L184">            metadata.setGutenbergEnabled(isGutenbergEnabledOnAnySite(siteStore.getSites()));</span>
        }

<span class="fc" id="L187">        AnalyticsTracker.refreshMetadata(metadata);</span>
<span class="fc" id="L188">    }</span>

    @VisibleForTesting
    protected static boolean isGutenbergEnabledOnAnySite(List&lt;SiteModel&gt; sites) {
<span class="fc bfc" id="L192" title="All 2 branches covered.">        for (SiteModel currentSite : sites) {</span>
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">            if (SiteUtils.GB_EDITOR_NAME.equals(currentSite.getMobileEditor())) {</span>
<span class="nc" id="L194">                return true;</span>
            }
<span class="fc" id="L196">        }</span>
<span class="fc" id="L197">        return false;</span>
    }

    /**
     * @return true if the siteStore has sites accessed via the WPCom Rest API that are not WPCom sites. This only
     * counts Jetpack sites connected via WPCom Rest API. If there are Jetpack sites in the site store and they're
     * all accessed via XMLRPC, this method returns false.
     */
    static boolean isJetpackUser(SiteStore siteStore) {
<span class="pc bpc" id="L206" title="1 of 2 branches missed.">        return siteStore.getSitesAccessedViaWPComRestCount() - siteStore.getWPComSitesCount() &gt; 0;</span>
    }

    public static void refreshMetadataNewUser(String username, String email) {
<span class="nc" id="L210">        AnalyticsMetadata metadata = new AnalyticsMetadata();</span>
<span class="nc" id="L211">        metadata.setUserConnected(true);</span>
<span class="nc" id="L212">        metadata.setWordPressComUser(true);</span>
<span class="nc" id="L213">        metadata.setJetpackUser(false);</span>
<span class="nc" id="L214">        metadata.setNumBlogs(1);</span>
<span class="nc" id="L215">        metadata.setUsername(username);</span>
<span class="nc" id="L216">        metadata.setEmail(email);</span>
        // GB is enabled for new users
<span class="nc" id="L218">        metadata.setGutenbergEnabled(true);</span>
<span class="nc" id="L219">        AnalyticsTracker.refreshMetadata(metadata);</span>
<span class="nc" id="L220">    }</span>

    public static int getWordCount(String content) {
<span class="nc" id="L223">        String text = Html.fromHtml(content.replaceAll(&quot;&lt;img[^&gt;]*&gt;&quot;, &quot;&quot;)).toString();</span>
<span class="nc" id="L224">        return text.split(&quot;\\s+&quot;).length;</span>
    }

    /**
     * Bump Analytics for the passed Stat and add blog details into properties.
     *
     * @param stat The Stat to bump
     * @param site The site object
     */
    public static void trackWithSiteDetails(AnalyticsTracker.Stat stat, SiteModel site) {
<span class="nc" id="L234">        trackWithSiteDetails(stat, site, null);</span>
<span class="nc" id="L235">    }</span>

    /**
     * Bump Analytics for the passed Stat and add blog details into properties.
     *
     * @param stat       The Stat to bump
     * @param site       The site object
     * @param properties Properties to attach to the event
     */
    public static void trackWithSiteDetails(AnalyticsTrackerWrapper analyticsTrackerWrapper,
                                            AnalyticsTracker.Stat stat,
                                            @Nullable SiteModel site,
                                            @Nullable Map&lt;String, Object&gt; properties) {
<span class="nc bnc" id="L248" title="All 4 branches missed.">        if (site == null || !SiteUtils.isAccessedViaWPComRest(site)) {</span>
<span class="nc" id="L249">            AppLog.w(AppLog.T.STATS, &quot;The passed blog obj is null or it's not a wpcom or Jetpack.&quot;</span>
                                     + &quot; Tracking analytics without blog info&quot;);
<span class="nc bnc" id="L251" title="All 2 branches missed.">            if (properties == null) {</span>
<span class="nc" id="L252">                analyticsTrackerWrapper.track(stat);</span>
            } else {
<span class="nc" id="L254">                analyticsTrackerWrapper.track(stat, properties);</span>
            }
<span class="nc" id="L256">            return;</span>
        }

<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (SiteUtils.isAccessedViaWPComRest(site)) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (properties == null) {</span>
<span class="nc" id="L261">                properties = new HashMap&lt;&gt;();</span>
            }
<span class="nc" id="L263">            properties.put(BLOG_ID_KEY, site.getSiteId());</span>
<span class="nc" id="L264">            properties.put(IS_JETPACK_KEY, site.isJetpackConnected());</span>
<span class="nc" id="L265">            properties.put(SITE_TYPE_KEY, AnalyticsSiteType.toStringFromSiteModel(site));</span>
        }

<span class="nc bnc" id="L268" title="All 2 branches missed.">        if (properties == null) {</span>
<span class="nc" id="L269">            analyticsTrackerWrapper.track(stat);</span>
        } else {
<span class="nc" id="L271">            analyticsTrackerWrapper.track(stat, properties);</span>
        }
<span class="nc" id="L273">    }</span>

    /**
     * Bump Analytics for the passed Stat and add blog details into properties.
     *
     * @param stat       The Stat to bump
     * @param site       The site object
     * @param properties Properties to attach to the event
     */
    public static void trackWithSiteDetails(AnalyticsTracker.Stat stat,
                                            @Nullable SiteModel site,
                                            @Nullable Map&lt;String, Object&gt; properties) {
<span class="nc" id="L285">        trackWithSiteDetails(new AnalyticsTrackerWrapper(), stat, site, properties);</span>
<span class="nc" id="L286">    }</span>

<span class="nc" id="L288">    public enum QuickActionTrackPropertyValue {</span>
<span class="nc" id="L289">        LIKE {</span>
            public String toString() {
<span class="nc" id="L291">                return &quot;like&quot;;</span>
            }
        },
<span class="nc" id="L294">        APPROVE {</span>
            public String toString() {
<span class="nc" id="L296">                return &quot;approve&quot;;</span>
            }
        },
<span class="nc" id="L299">        REPLY_TO {</span>
            public String toString() {
<span class="nc" id="L301">                return &quot;reply-to&quot;;</span>
            }
        }
    }

    public static void trackQuickActionTouched(QuickActionTrackPropertyValue type,
                                               SiteModel site,
                                               CommentModel comment) {
<span class="nc" id="L309">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;(1);</span>
<span class="nc" id="L310">        properties.put(&quot;quick_action&quot;, type.toString());</span>

        // add available information
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (site != null) {</span>
<span class="nc" id="L314">            properties.put(BLOG_ID_KEY, site.getSiteId());</span>
<span class="nc" id="L315">            properties.put(IS_JETPACK_KEY, site.isJetpackConnected());</span>
<span class="nc" id="L316">            properties.put(SITE_TYPE_KEY, AnalyticsSiteType.toStringFromSiteModel(site));</span>
        }

<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (comment != null) {</span>
<span class="nc" id="L320">            properties.put(POST_ID_KEY, comment.getRemotePostId());</span>
<span class="nc" id="L321">            properties.put(COMMENT_ID_KEY, comment.getRemoteCommentId());</span>
        }

<span class="nc" id="L324">        AnalyticsTracker.track(AnalyticsTracker.Stat.NOTIFICATION_QUICK_ACTIONS_QUICKACTION_TOUCHED, properties);</span>
<span class="nc" id="L325">        AnalyticsTracker.flush();</span>
<span class="nc" id="L326">    }</span>

    /**
     * Bump Analytics for comment reply, and add blog and comment details into properties.
     *
     * @param isQuickReply Whether is a quick reply or not
     * @param site         The site object
     * @param comment      The comment object
     * @param source       The source of the comment action
     */
    public static void trackCommentReplyWithDetails(boolean isQuickReply, SiteModel site,
                                                    CommentModel comment, AnalyticsCommentActionSource source) {
<span class="nc" id="L338">        AnalyticsTracker.Stat legacyTracker = null;</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (source == AnalyticsCommentActionSource.NOTIFICATIONS) {</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">            legacyTracker = isQuickReply ? AnalyticsTracker.Stat.NOTIFICATION_QUICK_ACTIONS_REPLIED_TO</span>
<span class="nc" id="L341">                    : AnalyticsTracker.Stat.NOTIFICATION_REPLIED_TO;</span>
        }

<span class="nc bnc" id="L344" title="All 2 branches missed.">        AnalyticsTracker.Stat stat = isQuickReply</span>
<span class="nc" id="L345">                ? AnalyticsTracker.Stat.COMMENT_QUICK_ACTION_REPLIED_TO</span>
<span class="nc" id="L346">                : AnalyticsTracker.Stat.COMMENT_REPLIED_TO;</span>
<span class="nc bnc" id="L347" title="All 4 branches missed.">        if (site == null || !SiteUtils.isAccessedViaWPComRest(site)) {</span>
<span class="nc" id="L348">            AppLog.w(AppLog.T.STATS, &quot;The passed blog obj is null or it's not a wpcom or Jetpack.&quot;</span>
                                     + &quot; Tracking analytics without blog info&quot;);
<span class="nc" id="L350">            AnalyticsTracker.track(stat);</span>

<span class="nc bnc" id="L352" title="All 2 branches missed.">            if (legacyTracker != null) {</span>
<span class="nc" id="L353">                AnalyticsTracker.track(legacyTracker);</span>
            }
<span class="nc" id="L355">            return;</span>
        }

<span class="nc" id="L358">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L359">        properties.put(BLOG_ID_KEY, site.getSiteId());</span>
<span class="nc" id="L360">        properties.put(IS_JETPACK_KEY, site.isJetpackConnected());</span>
<span class="nc" id="L361">        properties.put(POST_ID_KEY, comment.getRemotePostId());</span>
<span class="nc" id="L362">        properties.put(COMMENT_ID_KEY, comment.getRemoteCommentId());</span>
<span class="nc" id="L363">        properties.put(SITE_TYPE_KEY, AnalyticsSiteType.toStringFromSiteModel(site));</span>
<span class="nc" id="L364">        properties.put(COMMENT_ACTION_SOURCE, source.toString());</span>

<span class="nc" id="L366">        AnalyticsTracker.track(stat, properties);</span>

<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (legacyTracker != null) {</span>
<span class="nc" id="L369">            AnalyticsTracker.track(legacyTracker, properties);</span>
        }
<span class="nc" id="L371">    }</span>


    /**
     * Bump Analytics and add blog_id into properties
     *
     * @param stat   The Stat to bump
     * @param blogID The REMOTE blog ID.
     */
    public static void trackWithSiteId(AnalyticsTracker.Stat stat, long blogID) {
<span class="nc" id="L381">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (blogID != 0) {</span>
<span class="nc" id="L383">            properties.put(BLOG_ID_KEY, blogID);</span>
        }
<span class="nc" id="L385">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L386">    }</span>

    public static void trackWithReaderPostDetails(AnalyticsTracker.Stat stat,
                                                  @Nullable ReaderPost post,
                                                  @NonNull Map&lt;String, Object&gt; properties) {
<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (post == null) {</span>
<span class="nc" id="L392">            return;</span>
        }

        // wpcom/jetpack posts should pass: feed_id, feed_item_id, blog_id, post_id, is_jetpack
        // RSS pass should pass: feed_id, feed_item_id, is_jetpack
<span class="nc bnc" id="L397" title="All 4 branches missed.">        if (post.isWP() || post.isJetpack) {</span>
<span class="nc" id="L398">            properties.put(BLOG_ID_KEY, post.blogId);</span>
<span class="nc" id="L399">            properties.put(POST_ID_KEY, post.postId);</span>
        }
<span class="nc" id="L401">        properties.put(FOLLOW_KEY, post.isFollowedByCurrentUser);</span>
<span class="nc" id="L402">        properties.put(FEED_ID_KEY, post.feedId);</span>
<span class="nc" id="L403">        properties.put(FEED_ITEM_ID_KEY, post.feedItemId);</span>
<span class="nc" id="L404">        properties.put(IS_JETPACK_KEY, post.isJetpack);</span>
<span class="nc" id="L405">        properties.put(SITE_TYPE_KEY, AnalyticsSiteType.toStringFromReaderPost(post));</span>

<span class="nc" id="L407">        AnalyticsTracker.track(stat, properties);</span>

        // record a railcar interact event if the post has a railcar and this can be tracked
        // as an interaction
<span class="nc bnc" id="L411" title="All 4 branches missed.">        if (canTrackRailcarInteraction(stat) &amp;&amp; post.hasRailcar()) {</span>
<span class="nc" id="L412">            trackRailcarInteraction(stat, post.getRailcarJson());</span>
        }
<span class="nc" id="L414">    }</span>

    public static void trackWithBlogPostDetails(AnalyticsTracker.Stat stat, long blogId, long postId) {
<span class="nc" id="L417">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L418">        properties.put(BLOG_ID_KEY, blogId);</span>
<span class="nc" id="L419">        properties.put(POST_ID_KEY, postId);</span>

<span class="nc" id="L421">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L422">    }</span>

    public static void trackWithReblogDetails(
            AnalyticsTracker.Stat stat,
            long sourceBlogId,
            long sourcePostId,
            long targetSiteId
    ) {
<span class="nc" id="L430">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>

<span class="nc" id="L432">        properties.put(SOURCE_BLOG_ID_KEY, sourceBlogId);</span>
<span class="nc" id="L433">        properties.put(SOURCE_POST_ID_KEY, sourcePostId);</span>
<span class="nc" id="L434">        properties.put(TARGET_BLOG_ID_KEY, targetSiteId);</span>

<span class="nc" id="L436">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L437">    }</span>

    /**
     * Track when app launched via deep-linking
     *
     * @param stat   The Stat to bump
     * @param action The Intent action the app was started with
     * @param host   The host if applicable
     * @param data   The data URI the app was started with
     */
    public static void trackWithDeepLinkData(AnalyticsTracker.Stat stat, String action, String host, Uri data) {
<span class="nc" id="L448">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L449">        properties.put(INTENT_ACTION, action);</span>
<span class="nc" id="L450">        properties.put(INTENT_HOST, host);</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">        properties.put(INTENT_DATA, data != null ? data.toString() : null);</span>

<span class="nc" id="L453">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L454">    }</span>

    /**
     * Track when app launched via deep-linking
     *
     * @param stat   The Stat to bump
     * @param action The Intent action the app was started with
     * @param host   The host if applicable
     * @param source The source of deeplink (EMAIL, LINK or BANNER)
     * @param url    The deeplink URL stripped of sensitive data
     * @param sourceInfo    Any additional source info
     */
    public static void trackWithDeepLinkData(AnalyticsTracker.Stat stat, String action, String host, String source,
                                             String url, @Nullable String sourceInfo) {
<span class="nc" id="L468">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L469">        properties.put(INTENT_ACTION, action);</span>
<span class="nc" id="L470">        properties.put(INTENT_HOST, host);</span>
<span class="nc" id="L471">        properties.put(SOURCE_KEY, source);</span>
<span class="nc" id="L472">        properties.put(URL_KEY, url);</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">        if (sourceInfo != null) {</span>
<span class="nc" id="L474">            properties.put(SOURCE_INFO_KEY, sourceInfo);</span>
        }

<span class="nc" id="L477">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L478">    }</span>

    /**
     * Track when app launched via deep-linking but then fell back to external browser
     *
     * @param stat                 The Stat to bump
     * @param interceptorClassname The name of the class that handles the intercept by default
     */
    public static void trackWithDefaultInterceptor(AnalyticsTracker.Stat stat, String interceptorClassname) {
<span class="nc" id="L487">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L488">        properties.put(INTERCEPTOR_CLASSNAME, interceptorClassname);</span>

<span class="nc" id="L490">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L491">    }</span>

    /**
     * Track when a railcar item has been rendered
     *
     * @param railcarJson The JSON string of the railcar
     */
    public static void trackRailcarRender(String railcarJson) {
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (TextUtils.isEmpty(railcarJson)) {</span>
<span class="nc" id="L500">            return;</span>
        }

<span class="nc" id="L503">        AnalyticsTracker.track(AnalyticsTracker.Stat.TRAIN_TRACKS_RENDER, railcarJsonToProperties(railcarJson));</span>
<span class="nc" id="L504">    }</span>

    /**
     * Track when a railcar item has been interacted with
     *
     * @param stat        The event that caused the interaction
     * @param railcarJson The JSON string of the railcar
     */
    private static void trackRailcarInteraction(AnalyticsTracker.Stat stat, String railcarJson) {
<span class="nc bnc" id="L513" title="All 2 branches missed.">        if (TextUtils.isEmpty(railcarJson)) {</span>
<span class="nc" id="L514">            return;</span>
        }

<span class="nc" id="L517">        Map&lt;String, Object&gt; properties = railcarJsonToProperties(railcarJson);</span>
<span class="nc" id="L518">        properties.put(&quot;action&quot;, AnalyticsTrackerNosara.getEventNameForStat(stat));</span>
<span class="nc" id="L519">        AnalyticsTracker.track(AnalyticsTracker.Stat.TRAIN_TRACKS_INTERACT, properties);</span>
<span class="nc" id="L520">    }</span>

    /**
     * @param stat The event that would cause the interaction
     * @return True if the passed stat event can be recorded as a railcar interaction
     */
    private static boolean canTrackRailcarInteraction(AnalyticsTracker.Stat stat) {
<span class="nc bnc" id="L527" title="All 12 branches missed.">        return stat == AnalyticsTracker.Stat.READER_ARTICLE_LIKED</span>
               || stat == AnalyticsTracker.Stat.READER_ARTICLE_OPENED
               || stat == AnalyticsTracker.Stat.READER_SEARCH_RESULT_TAPPED
               || stat == AnalyticsTracker.Stat.READER_ARTICLE_COMMENTED_ON
               || stat == AnalyticsTracker.Stat.READER_GLOBAL_RELATED_POST_CLICKED
               || stat == AnalyticsTracker.Stat.READER_LOCAL_RELATED_POST_CLICKED;
    }

    /*
     * Converts the JSON string of a railcar to a properties list using the existing json key names
     */
    private static Map&lt;String, Object&gt; railcarJsonToProperties(@NonNull String railcarJson) {
<span class="nc" id="L539">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
        try {
<span class="nc" id="L541">            JSONObject jsonRailcar = new JSONObject(railcarJson);</span>
<span class="nc" id="L542">            Iterator&lt;String&gt; iter = jsonRailcar.keys();</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">            while (iter.hasNext()) {</span>
<span class="nc" id="L544">                String key = iter.next();</span>
<span class="nc" id="L545">                Object value = jsonRailcar.get(key);</span>
<span class="nc" id="L546">                properties.put(key, value);</span>
<span class="nc" id="L547">            }</span>
<span class="nc" id="L548">        } catch (JSONException e) {</span>
<span class="nc" id="L549">            AppLog.e(AppLog.T.READER, e);</span>
<span class="nc" id="L550">        }</span>

<span class="nc" id="L552">        return properties;</span>
    }

    public static Map&lt;String, Object&gt; getMediaProperties(Context context, boolean isVideo, Uri mediaURI, String path) {
<span class="nc" id="L556">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (context == null) {</span>
<span class="nc" id="L558">            AppLog.e(AppLog.T.MEDIA, &quot;In order to track media properties Context cannot be null.&quot;);</span>
<span class="nc" id="L559">            return properties;</span>
        }
<span class="nc bnc" id="L561" title="All 4 branches missed.">        if (mediaURI == null &amp;&amp; TextUtils.isEmpty(path)) {</span>
<span class="nc" id="L562">            AppLog.e(AppLog.T.MEDIA, &quot;In order to track media properties mediaURI and path cannot be both null!!&quot;);</span>
<span class="nc" id="L563">            return properties;</span>
        }

<span class="nc bnc" id="L566" title="All 2 branches missed.">        if (mediaURI != null) {</span>
<span class="nc" id="L567">            path = MediaUtils.getRealPathFromURI(context, mediaURI);</span>
        }

<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (TextUtils.isEmpty(path)) {</span>
<span class="nc" id="L571">            return properties;</span>
        }

        // File not found
<span class="nc" id="L575">        File file = new File(path);</span>
        try {
<span class="nc bnc" id="L577" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L578">                AppLog.e(AppLog.T.MEDIA,</span>
                        &quot;Can't access the media file. It doesn't exists anymore!! Properties are not being tracked.&quot;);
<span class="nc" id="L580">                return properties;</span>
            }

<span class="nc bnc" id="L583" title="All 2 branches missed.">            if (file.lastModified() &gt; 0L) {</span>
<span class="nc" id="L584">                long ageMS = System.currentTimeMillis() - file.lastModified();</span>
<span class="nc" id="L585">                properties.put(&quot;age_ms&quot;, ageMS);</span>
            }
<span class="nc" id="L587">        } catch (SecurityException e) {</span>
<span class="nc" id="L588">            AppLog.e(AppLog.T.MEDIA, &quot;Can't access the media file. Properties are not being tracked.&quot;, e);</span>
<span class="nc" id="L589">            return properties;</span>
<span class="nc" id="L590">        }</span>

<span class="nc" id="L592">        String mimeType = MediaUtils.getMediaFileMimeType(file);</span>
<span class="nc" id="L593">        properties.put(&quot;mime&quot;, mimeType);</span>

<span class="nc" id="L595">        String fileName = MediaUtils.getMediaFileName(file, mimeType);</span>
<span class="nc" id="L596">        String fileExtension = MimeTypeMap.getFileExtensionFromUrl(fileName).toLowerCase(Locale.ROOT);</span>
<span class="nc" id="L597">        properties.put(&quot;ext&quot;, fileExtension);</span>

<span class="nc bnc" id="L599" title="All 2 branches missed.">        if (!isVideo) {</span>
<span class="nc" id="L600">            int[] dimensions = ImageUtils.getImageSize(Uri.fromFile(file), context);</span>
<span class="nc" id="L601">            double megapixels = dimensions[0] * dimensions[1];</span>
<span class="nc" id="L602">            megapixels = megapixels / 1000000;</span>
<span class="nc" id="L603">            megapixels = Math.floor(megapixels);</span>
<span class="nc" id="L604">            properties.put(&quot;megapixels&quot;, (int) megapixels);</span>
<span class="nc" id="L605">        } else {</span>
<span class="nc" id="L606">            long videoDurationMS = VideoUtils.getVideoDurationMS(context, file);</span>
<span class="nc" id="L607">            properties.put(&quot;duration_secs&quot;, (int) videoDurationMS / 1000);</span>
        }

<span class="nc" id="L610">        properties.put(&quot;bytes&quot;, file.length());</span>

<span class="nc" id="L612">        return properties;</span>
    }

    public static void trackAnalyticsSignIn(AccountStore accountStore, SiteStore siteStore, boolean isWpcomLogin) {
<span class="nc" id="L616">        AnalyticsUtils.refreshMetadata(accountStore, siteStore);</span>
<span class="nc" id="L617">        Map&lt;String, Boolean&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L618">        properties.put(&quot;dotcom_user&quot;, isWpcomLogin); // CHECKSTYLE IGNORE</span>
<span class="nc" id="L619">        AnalyticsTracker.track(AnalyticsTracker.Stat.SIGNED_IN, properties);</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">        if (!isWpcomLogin) {</span>
<span class="nc" id="L621">            AnalyticsTracker.track(AnalyticsTracker.Stat.ADDED_SELF_HOSTED_SITE);</span>
        }
<span class="nc" id="L623">    }</span>

    /**
     * Refreshes analytics metadata and bumps the account created stat.
     *
     * @param username
     * @param email
     */
    public static void trackAnalyticsAccountCreated(String username, String email, Map&lt;String, Object&gt; properties) {
<span class="nc" id="L632">        AnalyticsUtils.refreshMetadataNewUser(username, email);</span>
        // This stat is part of a funnel that provides critical information.  Before
        // making ANY modification to this stat please refer to: p4qSXL-35X-p2
<span class="nc" id="L635">        AnalyticsTracker.track(AnalyticsTracker.Stat.CREATED_ACCOUNT, properties);</span>
<span class="nc" id="L636">    }</span>

    public static void trackAnalyticsPostListToggleLayout(PostListViewLayoutType viewLayoutType) {
<span class="nc" id="L639">        Map&lt;String, String&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L640">        properties.put(&quot;post_list_view_layout_type&quot;, viewLayoutType.toString());</span>
<span class="nc" id="L641">        AnalyticsTracker.track(AnalyticsTracker.Stat.POST_LIST_VIEW_LAYOUT_TOGGLED, properties);</span>
<span class="nc" id="L642">    }</span>

    private static Map&lt;String, String&gt; createNewsCardProperties(String origin, int version) {
<span class="nc" id="L645">        Map&lt;String, String&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L646">        properties.put(NEWS_CARD_ORIGIN, origin);</span>
<span class="nc" id="L647">        properties.put(NEWS_CARD_VERSION, String.valueOf(version));</span>
<span class="nc" id="L648">        return properties;</span>
    }

    public static void trackLoginProloguePages(int page) {
<span class="nc" id="L652">        Map&lt;String, Integer&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L653">        properties.put(&quot;page_number&quot;, page);</span>
<span class="nc" id="L654">        AnalyticsTracker.track(AnalyticsTracker.Stat.LOGIN_PROLOGUE_PAGED, properties);</span>
<span class="nc" id="L655">    }</span>

<span class="nc" id="L657">    @VisibleForTesting</span>
    protected enum AnalyticsSiteType {
<span class="nc" id="L659">        BLOG {</span>
            public String toString() {
<span class="nc" id="L661">                return &quot;blog&quot;;</span>
            }
        },
<span class="nc" id="L664">        P2 {</span>
            public String toString() {
<span class="nc" id="L666">                return &quot;p2&quot;;</span>
            }
        };

        static AnalyticsSiteType fromSiteModel(SiteModel siteModel) {
<span class="nc bnc" id="L671" title="All 2 branches missed.">            if (siteModel.isWpForTeamsSite()) {</span>
<span class="nc" id="L672">                return P2;</span>
            }

<span class="nc" id="L675">            return BLOG;</span>
        }

        static AnalyticsSiteType fromReaderPost(ReaderPost readerPost) {
<span class="nc bnc" id="L679" title="All 2 branches missed.">            if (readerPost.isP2orA8C()) {</span>
<span class="nc" id="L680">                return P2;</span>
            }

<span class="nc" id="L683">            return BLOG;</span>
        }

        static String toStringFromSiteModel(SiteModel siteModel) {
<span class="nc" id="L687">            return fromSiteModel(siteModel).toString();</span>
        }

        static String toStringFromReaderPost(ReaderPost readerPost) {
<span class="nc" id="L691">            return fromReaderPost(readerPost).toString();</span>
        }
    }

<span class="nc" id="L695">    public enum AnalyticsCommentActionSource {</span>
<span class="nc" id="L696">        NOTIFICATIONS {</span>
            public String toString() {
<span class="nc" id="L698">                return &quot;notifications&quot;;</span>
            }
        },
<span class="nc" id="L701">        SITE_COMMENTS {</span>
            public String toString() {
<span class="nc" id="L703">                return &quot;site_comments&quot;;</span>
            }
        },
<span class="nc" id="L706">        READER {</span>
            public String toString() {
<span class="nc" id="L708">                return &quot;reader&quot;;</span>
            }
        }
    }

    public static void trackCommentActionWithSiteDetails(AnalyticsTracker.Stat stat,
                                                         AnalyticsCommentActionSource actionSource, SiteModel site) {
<span class="nc" id="L715">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L716">        properties.put(COMMENT_ACTION_SOURCE, actionSource.toString());</span>

<span class="nc" id="L718">        AnalyticsUtils.trackWithSiteDetails(stat, site, properties);</span>
<span class="nc" id="L719">    }</span>

    public static void trackCommentActionWithReaderPostDetails(AnalyticsTracker.Stat stat,
                                                               AnalyticsCommentActionSource actionSource,
                                                               @Nullable ReaderPost post) {
<span class="nc" id="L724">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L725">        properties.put(COMMENT_ACTION_SOURCE, actionSource.toString());</span>

<span class="nc" id="L727">        AnalyticsUtils.trackWithReaderPostDetails(stat, post, properties);</span>
<span class="nc" id="L728">    }</span>

    public static void trackFollowCommentsWithReaderPostDetails(
            AnalyticsTracker.Stat stat,
            long blogId,
            long postId,
            @Nullable ReaderPost post,
            @NonNull Map&lt;String, Object&gt; properties
    ) {
<span class="nc bnc" id="L737" title="All 2 branches missed.">        if (post != null) {</span>
<span class="nc" id="L738">            AnalyticsUtils.trackWithReaderPostDetails(stat, post, properties);</span>
        } else {
<span class="nc" id="L740">            AppLog.w(AppLog.T.READER, &quot;The passed post obj is null. Tracking analytics without post details info&quot;);</span>

<span class="nc" id="L742">            properties.put(BLOG_ID_KEY, blogId);</span>
<span class="nc" id="L743">            properties.put(POST_ID_KEY, postId);</span>

<span class="nc" id="L745">            AnalyticsTracker.track(stat, properties);</span>
        }
<span class="nc" id="L747">    }</span>

    public static void trackInviteLinksAction(
            AnalyticsTracker.Stat stat,
            @Nullable SiteModel site,
            @Nullable Map&lt;String, Object&gt; properties
    ) {
<span class="nc" id="L754">        AnalyticsUtils.trackWithSiteDetails(stat, site, properties);</span>
<span class="nc" id="L755">    }</span>

    public static void trackUserProfileShown(String source) {
<span class="nc" id="L758">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L759">        properties.put(SOURCE_KEY, source);</span>

<span class="nc" id="L761">        AnalyticsTracker.track(Stat.USER_PROFILE_SHEET_SHOWN, properties);</span>
<span class="nc" id="L762">    }</span>

    public static void trackUserProfileSiteShown() {
<span class="nc" id="L765">        AnalyticsTracker.track(Stat.USER_PROFILE_SHEET_SITE_SHOWN);</span>
<span class="nc" id="L766">    }</span>

    public static void trackBlogPreviewedByUrl(String source) {
<span class="nc" id="L769">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L770">        properties.put(SOURCE_KEY, source);</span>

<span class="nc" id="L772">        AnalyticsTracker.track(Stat.BLOG_URL_PREVIEWED, properties);</span>
<span class="nc" id="L773">    }</span>

    public static void trackLikeListOpened(String source, String listType) {
<span class="nc" id="L776">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L777">        properties.put(SOURCE_KEY, source);</span>
<span class="nc" id="L778">        properties.put(LIST_TYPE_KEY, listType);</span>

<span class="nc" id="L780">        AnalyticsTracker.track(Stat.LIKE_LIST_OPENED, properties);</span>
<span class="nc" id="L781">    }</span>

    public static void trackLikeListFetchedMore(String source,
                                                String listType,
                                                int nextPage,
                                                int perPage) {
<span class="nc" id="L787">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L788">        properties.put(SOURCE_KEY, source);</span>
<span class="nc" id="L789">        properties.put(LIST_TYPE_KEY, listType);</span>
<span class="nc" id="L790">        properties.put(PAGE_KEY, nextPage);</span>
<span class="nc" id="L791">        properties.put(PER_PAGE_KEY, perPage);</span>

<span class="nc" id="L793">        AnalyticsTracker.track(Stat.LIKE_LIST_FETCHED_MORE, properties);</span>
<span class="nc" id="L794">    }</span>

    public static void trackStorageWarningDialogEvent(Stat stat, String source, Boolean isStorageSettingsResolved) {
<span class="nc" id="L797">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L798">        properties.put(SOURCE_KEY, source);</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">        properties.put(IS_STORAGE_SETTINGS_RESOLVED_KEY, isStorageSettingsResolved ? &quot;true&quot; : &quot;false&quot;);</span>

<span class="nc" id="L801">        AnalyticsTracker.track(stat, properties);</span>
<span class="nc" id="L802">    }</span>

<span class="nc" id="L804">    public enum RecommendAppSource {</span>
<span class="nc" id="L805">        ME(&quot;me&quot;),</span>
<span class="nc" id="L806">        ABOUT(&quot;about&quot;);</span>

        private final String mSourceName;

<span class="nc" id="L810">        RecommendAppSource(String sourceName) {</span>
<span class="nc" id="L811">            this.mSourceName = sourceName;</span>
<span class="nc" id="L812">        }</span>
    }

    public static void trackRecommendAppEngaged(RecommendAppSource source) {
<span class="nc" id="L816">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L817">        properties.put(SOURCE_KEY, source.mSourceName);</span>

<span class="nc" id="L819">        AnalyticsTracker.track(Stat.RECOMMEND_APP_ENGAGED, properties);</span>
<span class="nc" id="L820">    }</span>

    public static void trackRecommendAppFetchFailed(RecommendAppSource source, String error) {
<span class="nc" id="L823">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span>
<span class="nc" id="L824">        properties.put(SOURCE_KEY, source.mSourceName);</span>
<span class="nc" id="L825">        properties.put(CAUSE_OF_ISSUE_KEY, error);</span>

<span class="nc" id="L827">        AnalyticsTracker.track(Stat.RECOMMEND_APP_CONTENT_FETCH_FAILED, properties);</span>
<span class="nc" id="L828">    }</span>

    public static void trackBlockEditorEvent(String event, SiteModel site, Map&lt;String, Object&gt; properties) {
<span class="nc bnc" id="L831" title="All 2 branches missed.">        if (event.equals(&quot;editor_block_inserted&quot;)) {</span>
<span class="nc" id="L832">            AnalyticsUtils.trackWithSiteDetails(Stat.EDITOR_BLOCK_INSERTED, site, properties);</span>
        }

<span class="nc bnc" id="L835" title="All 2 branches missed.">        if (event.equals(&quot;editor_block_moved&quot;)) {</span>
<span class="nc" id="L836">            AnalyticsUtils.trackWithSiteDetails(Stat.EDITOR_BLOCK_MOVED, site, properties);</span>
        }
<span class="nc" id="L838">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>