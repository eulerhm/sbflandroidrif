<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NumberPickerDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.prefs</a> &gt; <span class="el_source">NumberPickerDialog.java</span></div><h1>NumberPickerDialog.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.prefs;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.app.Dialog;
import android.app.DialogFragment;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.text.InputFilter;
import android.text.TextUtils;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.NumberPicker;
import android.widget.RelativeLayout;
import android.widget.TextView;

import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.widget.SwitchCompat;

import com.google.android.material.dialog.MaterialAlertDialogBuilder;

import org.wordpress.android.R;

public class NumberPickerDialog extends DialogFragment
        implements DialogInterface.OnClickListener,
        CompoundButton.OnCheckedChangeListener {
    public static final String SHOW_SWITCH_KEY = &quot;show-switch&quot;;
    public static final String SWITCH_ENABLED_KEY = &quot;switch-enabled&quot;;
    public static final String SWITCH_TITLE_KEY = &quot;switch-title&quot;;
    public static final String SWITCH_DESC_KEY = &quot;switch-description&quot;;
    public static final String TITLE_KEY = &quot;dialog-title&quot;;
    public static final String HEADER_TEXT_KEY = &quot;header-text&quot;;
    public static final String MIN_VALUE_KEY = &quot;min-value&quot;;
    public static final String MAX_VALUE_KEY = &quot;max-value&quot;;
    public static final String CUR_VALUE_KEY = &quot;cur-value&quot;;

    private static final int DEFAULT_MIN_VALUE = 0;
    private static final int DEFAULT_MAX_VALUE = 99;

    private SwitchCompat mSwitch;
    private TextView mHeaderText;
    private NumberPicker mNumberPicker;
    private NumberPicker.Formatter mFormat;
    private int mMinValue;
    private int mMaxValue;
    private boolean mConfirmed;

<span class="nc" id="L51">    public NumberPickerDialog() {</span>
<span class="nc" id="L52">        mMinValue = DEFAULT_MIN_VALUE;</span>
<span class="nc" id="L53">        mMaxValue = DEFAULT_MAX_VALUE;</span>
<span class="nc" id="L54">    }</span>

    @Override
    public Dialog onCreateDialog(Bundle savedInstanceState) {
<span class="nc" id="L58">        int topOffset = getResources().getDimensionPixelOffset(R.dimen.settings_fragment_dialog_vertical_inset);</span>

<span class="nc" id="L60">        AlertDialog.Builder builder = new MaterialAlertDialogBuilder(getActivity())</span>
<span class="nc" id="L61">                .setBackgroundInsetTop(topOffset)</span>
<span class="nc" id="L62">                .setBackgroundInsetBottom(topOffset);</span>
<span class="nc" id="L63">        View view = View.inflate(getActivity(), R.layout.number_picker_dialog, null);</span>
<span class="nc" id="L64">        TextView switchText = view.findViewById(R.id.number_picker_text);</span>
<span class="nc" id="L65">        mSwitch = view.findViewById(R.id.number_picker_switch);</span>
<span class="nc" id="L66">        mHeaderText = view.findViewById(R.id.number_picker_header);</span>
<span class="nc" id="L67">        mNumberPicker = view.findViewById(R.id.number_picker);</span>
<span class="nc" id="L68">        int value = mMinValue;</span>

<span class="nc" id="L70">        Bundle args = getArguments();</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (args != null) {</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            if (args.getBoolean(SHOW_SWITCH_KEY, false)) {</span>
<span class="nc" id="L73">                mSwitch.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L74">                mSwitch.setText(args.getString(SWITCH_TITLE_KEY, &quot;&quot;));</span>
<span class="nc" id="L75">                mSwitch.setChecked(args.getBoolean(SWITCH_ENABLED_KEY, false));</span>
<span class="nc" id="L76">                final View toggleContainer = view.findViewById(R.id.number_picker_toggleable);</span>
<span class="nc" id="L77">                toggleContainer.setEnabled(mSwitch.isChecked());</span>
<span class="nc" id="L78">                mNumberPicker.setEnabled(mSwitch.isChecked());</span>
<span class="nc" id="L79">            } else {</span>
<span class="nc" id="L80">                mSwitch.setVisibility(View.GONE);</span>
            }
<span class="nc" id="L82">            switchText.setText(args.getString(SWITCH_DESC_KEY, &quot;&quot;));</span>
<span class="nc" id="L83">            mHeaderText.setText(args.getString(HEADER_TEXT_KEY, &quot;&quot;));</span>
<span class="nc" id="L84">            mMinValue = args.getInt(MIN_VALUE_KEY, DEFAULT_MIN_VALUE);</span>
<span class="nc" id="L85">            mMaxValue = args.getInt(MAX_VALUE_KEY, DEFAULT_MAX_VALUE);</span>
<span class="nc" id="L86">            value = args.getInt(CUR_VALUE_KEY, mMinValue);</span>

<span class="nc" id="L88">            builder.setCustomTitle(getDialogTitleView(args.getString(TITLE_KEY, &quot;&quot;)));</span>
        }

        // Fix for https://issuetracker.google.com/issues/36952035
<span class="nc" id="L92">        View editText = mNumberPicker.getChildAt(0);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (editText instanceof EditText) {</span>
<span class="nc" id="L94">            ((EditText) editText).setFilters(new InputFilter[0]);</span>
        }

<span class="nc" id="L97">        mNumberPicker.setFormatter(mFormat);</span>
<span class="nc" id="L98">        mNumberPicker.setMinValue(mMinValue);</span>
<span class="nc" id="L99">        mNumberPicker.setMaxValue(mMaxValue);</span>
<span class="nc" id="L100">        mNumberPicker.setValue(value);</span>

<span class="nc" id="L102">        mSwitch.setOnCheckedChangeListener(this);</span>

        // hide empty text views
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (TextUtils.isEmpty(switchText.getText())) {</span>
<span class="nc" id="L106">            switchText.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (TextUtils.isEmpty(mHeaderText.getText())) {</span>
<span class="nc" id="L109">            mHeaderText.setVisibility(View.GONE);</span>
        }

<span class="nc" id="L112">        builder.setPositiveButton(android.R.string.ok, this);</span>
<span class="nc" id="L113">        builder.setNegativeButton(R.string.cancel, this);</span>
<span class="nc" id="L114">        builder.setView(view);</span>

<span class="nc" id="L116">        return builder.create();</span>
    }

    @Override
    public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        mConfirmed = which == DialogInterface.BUTTON_POSITIVE;</span>
<span class="nc" id="L122">        dismiss();</span>
<span class="nc" id="L123">    }</span>

    @Override
    public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
<span class="nc" id="L127">        mNumberPicker.setEnabled(isChecked);</span>
<span class="nc" id="L128">        mHeaderText.setEnabled(isChecked);</span>
<span class="nc" id="L129">    }</span>

    @Override
    public void onDismiss(DialogInterface dialog) {
        // TODO: android.app.Fragment  is deprecated since Android P.
        // Needs to be replaced with android.support.v4.app.Fragment
        // See https://developer.android.com/reference/android/app/Fragment
<span class="nc" id="L136">        android.app.Fragment target = getTargetFragment();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (target != null) {</span>
<span class="nc" id="L138">            target.onActivityResult(getTargetRequestCode(), Activity.RESULT_OK, getResultIntent());</span>
        }

<span class="nc" id="L141">        super.onDismiss(dialog);</span>
<span class="nc" id="L142">    }</span>

    public void setNumberFormat(NumberPicker.Formatter format) {
<span class="nc" id="L145">        mFormat = format;</span>
<span class="nc" id="L146">    }</span>

    private View getDialogTitleView(String title) {
<span class="nc" id="L149">        LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
        @SuppressLint(&quot;InflateParams&quot;)
<span class="nc" id="L151">        View titleView = inflater.inflate(R.layout.detail_list_preference_title, null);</span>
<span class="nc" id="L152">        TextView titleText = titleView.findViewById(R.id.title);</span>
<span class="nc" id="L153">        titleText.setText(title);</span>
<span class="nc" id="L154">        titleText.setLayoutParams(new RelativeLayout.LayoutParams(</span>
                RelativeLayout.LayoutParams.MATCH_PARENT,
                RelativeLayout.LayoutParams.WRAP_CONTENT));
<span class="nc" id="L157">        return titleView;</span>
    }

    private Intent getResultIntent() {
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (mConfirmed) {</span>
<span class="nc" id="L162">            return new Intent()</span>
<span class="nc" id="L163">                    .putExtra(SWITCH_ENABLED_KEY, mSwitch.isChecked())</span>
<span class="nc" id="L164">                    .putExtra(CUR_VALUE_KEY, mNumberPicker.getValue());</span>
        }

<span class="nc" id="L167">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>