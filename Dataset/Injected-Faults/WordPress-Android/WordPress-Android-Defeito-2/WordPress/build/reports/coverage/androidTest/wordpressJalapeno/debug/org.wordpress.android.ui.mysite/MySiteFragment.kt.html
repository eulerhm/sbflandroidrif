<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MySiteFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.mysite</a> &gt; <span class="el_source">MySiteFragment.kt</span></div><h1>MySiteFragment.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.mysite

import android.content.Intent
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup.MarginLayoutParams
import android.view.WindowManager
import android.widget.ImageView
import android.widget.TextView
import androidx.annotation.NonNull
import androidx.appcompat.widget.TooltipCompat
import androidx.core.view.isVisible
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.viewpager2.widget.ViewPager2
import com.google.android.material.appbar.AppBarLayout
import com.google.android.material.tabs.TabLayout
import com.google.android.material.tabs.TabLayoutMediator
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.databinding.MySiteFragmentBinding
import org.wordpress.android.databinding.MySiteInfoHeaderCardBinding
import org.wordpress.android.ui.ActivityLauncher
import org.wordpress.android.ui.main.SitePickerActivity
import org.wordpress.android.ui.main.utils.MeGravatarLoader
import org.wordpress.android.ui.mysite.MySiteCardAndItem.SiteInfoHeaderCard
import org.wordpress.android.ui.mysite.MySiteCardAndItem.SiteInfoHeaderCard.IconState
import org.wordpress.android.ui.mysite.MySiteViewModel.SiteInfoToolbarViewParams
import org.wordpress.android.ui.mysite.MySiteViewModel.State
import org.wordpress.android.ui.mysite.MySiteViewModel.TabsUiState
import org.wordpress.android.ui.mysite.MySiteViewModel.TabsUiState.TabUiState
import org.wordpress.android.ui.mysite.tabs.MySiteTabFragment
import org.wordpress.android.ui.mysite.tabs.MySiteTabsAdapter
import org.wordpress.android.ui.posts.QuickStartPromptDialogFragment.QuickStartPromptClickInterface
import org.wordpress.android.ui.utils.UiHelpers
import org.wordpress.android.util.extensions.setVisible
import org.wordpress.android.util.image.ImageManager
import org.wordpress.android.util.image.ImageType.BLAVATAR
import org.wordpress.android.util.image.ImageType.USER
import org.wordpress.android.viewmodel.observeEvent
import org.wordpress.android.widgets.QuickStartFocusPoint
import javax.inject.Inject

@Suppress(&quot;TooManyFunctions&quot;)
<span class="nc" id="L46">class MySiteFragment : Fragment(R.layout.my_site_fragment),</span>
        QuickStartPromptClickInterface {
<span class="nc bnc" id="L48" title="All 2 branches missed.">    @Inject lateinit var viewModelFactory: ViewModelProvider.Factory</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">    @Inject lateinit var uiHelpers: UiHelpers</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">    @Inject lateinit var meGravatarLoader: MeGravatarLoader</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">    @Inject lateinit var imageManager: ImageManager</span>
    private lateinit var viewModel: MySiteViewModel

    private var binding: MySiteFragmentBinding? = null
    private var siteTitle: String? = null

<span class="nc" id="L57">    private val viewPagerCallback = object : ViewPager2.OnPageChangeCallback() {</span>
        override fun onPageSelected(position: Int) {
<span class="nc" id="L59">            super.onPageSelected(position)</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">            viewModel.onTabChanged(position)</span>
<span class="nc" id="L61">        }</span>
    }

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L65">        super.onCreate(savedInstanceState)</span>
<span class="nc" id="L66">        initSoftKeyboard()</span>
<span class="nc" id="L67">        initDagger()</span>
<span class="nc" id="L68">    }</span>

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L71">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc" id="L72">        initViewModel()</span>
<span class="nc" id="L73">        binding = MySiteFragmentBinding.bind(view).apply {</span>
<span class="nc" id="L74">            setupToolbar()</span>
<span class="nc" id="L75">            setupContentViews()</span>
<span class="nc" id="L76">            setupObservers()</span>
<span class="nc" id="L77">        }</span>
<span class="nc" id="L78">    }</span>

    private fun initSoftKeyboard() {
        // The following prevents the soft keyboard from leaving a white space when dismissed.
<span class="nc" id="L82">        requireActivity().window.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_PAN)</span>
<span class="nc" id="L83">    }</span>

    private fun initDagger() {
<span class="nc bnc" id="L86" title="All 2 branches missed.">        (requireActivity().application as WordPress).component().inject(this)</span>
<span class="nc" id="L87">    }</span>

    private fun initViewModel() {
<span class="nc" id="L90">        viewModel = ViewModelProvider(this, viewModelFactory).get(MySiteViewModel::class.java)</span>
<span class="nc" id="L91">    }</span>

    private fun MySiteFragmentBinding.setupToolbar() {
<span class="nc" id="L94">        toolbarMain.let { toolbar -&gt;</span>
<span class="nc" id="L95">            toolbar.inflateMenu(R.menu.my_site_menu)</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">            toolbar.menu.findItem(R.id.me_item)?.let { meMenu -&gt;</span>
<span class="nc" id="L97">                meMenu.actionView.let { actionView -&gt;</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                    actionView.setOnClickListener { viewModel.onAvatarPressed() }</span>
<span class="nc" id="L99">                    TooltipCompat.setTooltipText(actionView, meMenu.title)</span>
<span class="nc" id="L100">                }</span>
<span class="nc" id="L101">            }</span>
        }
<span class="nc" id="L103">        val avatar = root.findViewById&lt;ImageView&gt;(R.id.avatar)</span>

<span class="nc" id="L105">        appbarMain.addOnOffsetChangedListener(AppBarLayout.OnOffsetChangedListener { appBarLayout, verticalOffset -&gt;</span>
<span class="nc" id="L106">            val maxOffset = appBarLayout.totalScrollRange</span>
<span class="nc" id="L107">            val currentOffset = maxOffset + verticalOffset</span>

<span class="nc" id="L109">            updateCollapsibleToolbar(currentOffset)</span>

<span class="nc" id="L111">            val percentage = ((currentOffset.toFloat() / maxOffset.toFloat()) * 100).toInt()</span>
<span class="nc" id="L112">            fadeSiteInfoHeader(percentage)</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">            avatar?.let { avatar -&gt;</span>
<span class="nc" id="L114">                val minSize = avatar.minimumHeight</span>
<span class="nc" id="L115">                val maxSize = avatar.maxHeight</span>
<span class="nc" id="L116">                val modifierPx = (minSize.toFloat() - maxSize.toFloat()) * (percentage.toFloat() / 100) * -1</span>
<span class="nc" id="L117">                val modifierPercentage = modifierPx / minSize</span>
<span class="nc" id="L118">                val newScale = 1 + modifierPercentage</span>

<span class="nc" id="L120">                avatar.scaleX = newScale</span>
<span class="nc" id="L121">                avatar.scaleY = newScale</span>
<span class="nc" id="L122">            }</span>
<span class="nc" id="L123">        })</span>
<span class="nc" id="L124">    }</span>

    private fun MySiteFragmentBinding.updateCollapsibleToolbar(currentOffset: Int) {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (currentOffset == 0) {</span>
<span class="nc" id="L128">            collapsingToolbar.title = siteTitle</span>
<span class="nc" id="L129">            siteInfo.siteInfoCard.visibility = View.INVISIBLE</span>
        } else {
<span class="nc" id="L131">            collapsingToolbar.title = null</span>
<span class="nc" id="L132">            siteInfo.siteInfoCard.visibility = View.VISIBLE</span>
        }
<span class="nc" id="L134">    }</span>

    private fun MySiteFragmentBinding.fadeSiteInfoHeader(percentage: Int) {
<span class="nc" id="L137">        siteInfo.siteInfoCard.alpha = percentage.toFloat() / 100</span>
<span class="nc" id="L138">    }</span>

    private fun MySiteFragmentBinding.setupContentViews() {
<span class="nc" id="L141">        setupViewPager()</span>
<span class="nc" id="L142">        setupActionableEmptyView()</span>
<span class="nc" id="L143">    }</span>

    private fun MySiteFragmentBinding.setupViewPager() {
<span class="nc" id="L146">        viewPager.registerOnPageChangeCallback(viewPagerCallback)</span>
<span class="nc" id="L147">    }</span>

    private fun MySiteFragmentBinding.setupActionableEmptyView() {
<span class="nc bnc" id="L150" title="All 2 branches missed.">        actionableEmptyView.button.setOnClickListener { viewModel.onAddSitePressed() }</span>
<span class="nc" id="L151">    }</span>

    private fun MySiteFragmentBinding.setupObservers() {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        viewModel.uiModel.observe(viewLifecycleOwner) { uiModel -&gt;</span>
<span class="nc" id="L155">            loadGravatar(uiModel.accountAvatarUrl)</span>
<span class="nc" id="L156">            when (val state = uiModel.state) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                is State.SiteSelected -&gt; loadData(state)</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">                is State.NoSites -&gt; loadEmptyView(state)</span>
            }
<span class="nc" id="L160">        }</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        viewModel.onNavigation.observeEvent(viewLifecycleOwner, { handleNavigationAction(it) })</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">        viewModel.onScrollTo.observeEvent(viewLifecycleOwner) {</span>
<span class="nc" id="L164">            var quickStartScrollPosition = it</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">            if (quickStartScrollPosition == -1) {</span>
<span class="nc" id="L166">                appbarMain.setExpanded(true, true)</span>
<span class="nc" id="L167">                quickStartScrollPosition = 0</span>
            }
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (quickStartScrollPosition &gt; 0) appbarMain.setExpanded(false, true)</span>
<span class="nc bnc" id="L170" title="All 6 branches missed.">            binding?.viewPager?.getCurrentFragment()?.handleScrollTo(quickStartScrollPosition)</span>
<span class="nc" id="L171">        }</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">        viewModel.onTrackWithTabSource.observeEvent(viewLifecycleOwner) {</span>
<span class="nc bnc" id="L173" title="All 6 branches missed.">            binding?.viewPager?.getCurrentFragment()?.onTrackWithTabSource(it)</span>
<span class="nc" id="L174">        }</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        viewModel.selectTab.observeEvent(viewLifecycleOwner) { navTarget -&gt;</span>
<span class="nc" id="L176">            viewPager.setCurrentItem(navTarget.position, navTarget.smoothAnimation)</span>
<span class="nc" id="L177">        }</span>
<span class="nc" id="L178">    }</span>

    private fun MySiteFragmentBinding.loadGravatar(avatarUrl: String) =
<span class="nc bnc" id="L181" title="All 2 branches missed.">            root.findViewById&lt;ImageView&gt;(R.id.avatar)?.let {</span>
<span class="nc" id="L182">                meGravatarLoader.load(</span>
<span class="nc" id="L183">                        false,</span>
<span class="nc" id="L184">                        meGravatarLoader.constructGravatarUrl(avatarUrl),</span>
<span class="nc" id="L185">                        null,</span>
<span class="nc" id="L186">                        it,</span>
<span class="nc" id="L187">                        USER,</span>
<span class="nc" id="L188">                        null</span>
                )
<span class="nc" id="L190">            }</span>

    private fun MySiteFragmentBinding.loadData(state: State.SiteSelected) {
<span class="nc" id="L193">        tabLayout.setVisible(state.tabsUiState.showTabs)</span>
<span class="nc" id="L194">        updateTabs(state.tabsUiState)</span>
<span class="nc" id="L195">        actionableEmptyView.setVisible(false)</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">        viewModel.setActionableEmptyViewGone(actionableEmptyView.isVisible) {</span>
<span class="nc" id="L197">            actionableEmptyView.setVisible(false)</span>
<span class="nc" id="L198">        }</span>
<span class="nc bnc" id="L199" title="All 4 branches missed.">        if (state.siteInfoHeaderState.hasUpdates || !header.isVisible) {</span>
<span class="nc" id="L200">            siteInfo.loadMySiteDetails(state.siteInfoHeaderState.siteInfoHeader)</span>
        }
<span class="nc" id="L202">        updateSiteInfoToolbarView(state.siteInfoToolbarViewParams)</span>
<span class="nc" id="L203">    }</span>

    private fun MySiteInfoHeaderCardBinding.loadMySiteDetails(siteInfoHeader: SiteInfoHeaderCard) {
<span class="nc" id="L206">        siteTitle = siteInfoHeader.title</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if (siteInfoHeader.iconState is IconState.Visible) {</span>
<span class="nc" id="L208">            mySiteBlavatar.visibility = View.VISIBLE</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">            imageManager.load(mySiteBlavatar, BLAVATAR, siteInfoHeader.iconState.url ?: &quot;&quot;)</span>
<span class="nc" id="L210">            mySiteIconProgress.visibility = View.GONE</span>
<span class="nc" id="L211">            mySiteBlavatar.setOnClickListener { siteInfoHeader.onIconClick.click() }</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">        } else if (siteInfoHeader.iconState is IconState.Progress) {</span>
<span class="nc" id="L213">            mySiteBlavatar.setOnClickListener(null)</span>
<span class="nc" id="L214">            mySiteIconProgress.visibility = View.VISIBLE</span>
<span class="nc" id="L215">            mySiteBlavatar.visibility = View.GONE</span>
        }
<span class="nc" id="L217">        quickStartIconFocusPoint.setVisibleOrGone(siteInfoHeader.showIconFocusPoint)</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (siteInfoHeader.onTitleClick != null) {</span>
<span class="nc" id="L219">            siteInfoContainer.title.setOnClickListener { siteInfoHeader.onTitleClick.click() }</span>
        } else {
<span class="nc" id="L221">            siteInfoContainer.title.setOnClickListener(null)</span>
        }
<span class="nc" id="L223">        siteInfoContainer.title.text = siteInfoHeader.title</span>
<span class="nc" id="L224">        quickStartTitleFocusPoint.setVisibleOrGone(siteInfoHeader.showTitleFocusPoint)</span>
<span class="nc" id="L225">        quickStartSubTitleFocusPoint.setVisibleOrGone(siteInfoHeader.showSubtitleFocusPoint)</span>
<span class="nc" id="L226">        siteInfoContainer.subtitle.text = siteInfoHeader.url</span>
<span class="nc" id="L227">        siteInfoContainer.subtitle.setOnClickListener { siteInfoHeader.onUrlClick.click() }</span>
<span class="nc" id="L228">        switchSite.setOnClickListener { siteInfoHeader.onSwitchSiteClick.click() }</span>
<span class="nc" id="L229">    }</span>

    private fun MySiteFragmentBinding.updateSiteInfoToolbarView(siteInfoToolbarViewParams: SiteInfoToolbarViewParams) {
<span class="nc" id="L232">        showHeader(siteInfoToolbarViewParams.headerVisible)</span>
<span class="nc" id="L233">        val appBarHeight = resources.getDimension(siteInfoToolbarViewParams.appBarHeight).toInt()</span>
<span class="nc" id="L234">        appbarMain.layoutParams.height = appBarHeight</span>
<span class="nc" id="L235">        val toolbarBottomMargin = resources.getDimension(siteInfoToolbarViewParams.toolbarBottomMargin).toInt()</span>
<span class="nc" id="L236">        updateToolbarBottomMargin(toolbarBottomMargin)</span>
<span class="nc" id="L237">        appbarMain.isLiftOnScroll = siteInfoToolbarViewParams.appBarLiftOnScroll</span>
<span class="nc" id="L238">        appbarMain.requestLayout()</span>
<span class="nc" id="L239">    }</span>

    private fun MySiteFragmentBinding.updateToolbarBottomMargin(appBarHeight: Int) {
<span class="nc" id="L242">        val bottomMargin = (appBarHeight / resources.displayMetrics.density).toInt()</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">        val layoutParams = (toolbarMain.layoutParams as? MarginLayoutParams)</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        layoutParams?.setMargins(0, 0, 0, bottomMargin)</span>
<span class="nc" id="L245">        toolbarMain.layoutParams = layoutParams</span>
<span class="nc" id="L246">    }</span>

    private fun MySiteFragmentBinding.loadEmptyView(state: State.NoSites) {
<span class="nc" id="L249">        tabLayout.setVisible(state.tabsUiState.showTabs)</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">        viewModel.setActionableEmptyViewVisible(actionableEmptyView.isVisible) {</span>
<span class="nc" id="L251">            actionableEmptyView.setVisible(true)</span>
<span class="nc" id="L252">            actionableEmptyView.image.setVisible(state.shouldShowImage)</span>
<span class="nc" id="L253">        }</span>
<span class="nc" id="L254">        actionableEmptyView.image.setVisible(state.shouldShowImage)</span>
<span class="nc" id="L255">        siteTitle = getString(R.string.my_site_section_screen_title)</span>
<span class="nc" id="L256">        updateSiteInfoToolbarView(state.siteInfoToolbarViewParams)</span>
<span class="nc" id="L257">        appbarMain.setExpanded(false, true)</span>
<span class="nc" id="L258">    }</span>

    private fun MySiteFragmentBinding.showHeader(visibility: Boolean) {
<span class="nc bnc" id="L261" title="All 2 branches missed.">        header.visibility = if (visibility) View.VISIBLE else View.INVISIBLE</span>
<span class="nc" id="L262">    }</span>

    private fun MySiteFragmentBinding.updateViewPagerAdapterAndMediatorIfNeeded(state: TabsUiState) {
<span class="nc bnc" id="L265" title="All 4 branches missed.">        if (viewPager.adapter == null || state.shouldUpdateViewPager) {</span>
<span class="nc" id="L266">            viewPager.adapter = MySiteTabsAdapter(this@MySiteFragment, state.tabUiStates)</span>
<span class="nc" id="L267">            TabLayoutMediator(tabLayout, viewPager, MySiteTabConfigurationStrategy(state.tabUiStates)).attach()</span>
        }
<span class="nc" id="L269">    }</span>

    private fun MySiteFragmentBinding.updateTabs(state: TabsUiState) {
<span class="nc" id="L272">        updateViewPagerAdapterAndMediatorIfNeeded(state)</span>
<span class="nc" id="L273">        state.tabUiStates.forEachIndexed { index, tabUiState -&gt;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            val tab = tabLayout.getTabAt(index) as TabLayout.Tab</span>
<span class="nc" id="L275">            updateTab(tab, tabUiState)</span>
<span class="nc" id="L276">        }</span>
<span class="nc" id="L277">    }</span>

    private fun MySiteFragmentBinding.updateTab(tab: TabLayout.Tab, tabUiState: TabUiState) {
<span class="nc bnc" id="L280" title="All 2 branches missed.">        val customView = tab.customView ?: createTabCustomView(tab)</span>
<span class="nc" id="L281">        with(customView) {</span>
<span class="nc" id="L282">            val title = findViewById&lt;TextView&gt;(R.id.tab_label)</span>
<span class="nc" id="L283">            val quickStartFocusPoint = findViewById&lt;QuickStartFocusPoint&gt;(R.id.tab_quick_start_focus_point)</span>
<span class="nc" id="L284">            title.text = uiHelpers.getTextOfUiString(requireContext(), tabUiState.label)</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">            quickStartFocusPoint?.setVisible(tabUiState.showQuickStartFocusPoint)</span>
        }
<span class="nc" id="L287">    }</span>

<span class="nc" id="L289">    private fun handleNavigationAction(action: SiteNavigationAction) = when (action) {</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">        is SiteNavigationAction.OpenMeScreen -&gt; ActivityLauncher.viewMeActivityForResult(activity)</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        is SiteNavigationAction.AddNewSite -&gt; SitePickerActivity.addSite(activity, action.hasAccessToken, action.source)</span>
        else -&gt; {
            /* Pass all other navigationAction on to the child fragment, so they can be handled properly.
               Added brief delay before passing action to nested (view pager) tab fragments to give them time to get
               created. */
<span class="nc bnc" id="L296" title="All 2 branches missed.">            view?.postDelayed({</span>
<span class="nc bnc" id="L297" title="All 6 branches missed.">                binding?.viewPager?.getCurrentFragment()?.handleNavigationAction(action)</span>
<span class="nc" id="L298">            }, PASS_TO_TAB_FRAGMENT_DELAY)</span>
<span class="nc" id="L299">            Unit</span>
        }
<span class="nc" id="L301">    }</span>

    override fun onPositiveClicked(instanceTag: String) {
<span class="nc bnc" id="L304" title="All 6 branches missed.">        binding?.viewPager?.getCurrentFragment()?.onPositiveClicked(instanceTag)</span>
<span class="nc" id="L305">    }</span>

    override fun onNegativeClicked(instanceTag: String) {
<span class="nc bnc" id="L308" title="All 6 branches missed.">        binding?.viewPager?.getCurrentFragment()?.onNegativeClicked(instanceTag)</span>
<span class="nc" id="L309">    }</span>

    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
<span class="nc" id="L312">        super.onActivityResult(requestCode, resultCode, data)</span>
        /* Add brief delay before passing result to nested (view pager) tab fragments to give them time to get created.
           This is a workaround to fix API Level 25 (GitHub #16225) issue where we noticed that nested fragments
           were created after parent fragment was shown the first time and received activity result. It might not be a
           real issue as we could only test it on an emulator, we added it to be safe in such cases. */
<span class="nc bnc" id="L317" title="All 2 branches missed.">        view?.postDelayed({</span>
<span class="nc bnc" id="L318" title="All 6 branches missed.">            binding?.viewPager?.getCurrentFragment()?.onActivityResult(requestCode, resultCode, data)</span>
<span class="nc" id="L319">        }, PASS_TO_TAB_FRAGMENT_DELAY)</span>
<span class="nc" id="L320">    }</span>

    private fun ViewPager2.getCurrentFragment() =
<span class="nc bnc" id="L323" title="All 2 branches missed.">            this@MySiteFragment.childFragmentManager.findFragmentByTag(&quot;f$currentItem&quot;) as? MySiteTabFragment</span>

    private fun MySiteFragmentBinding.createTabCustomView(tab: TabLayout.Tab): View {
<span class="nc" id="L326">        val customView = LayoutInflater.from(context)</span>
<span class="nc" id="L327">                .inflate(R.layout.tab_custom_view, tabLayout, false)</span>
<span class="nc" id="L328">        tab.customView = customView</span>
<span class="nc" id="L329">        return customView</span>
    }

<span class="nc" id="L332">    private inner class MySiteTabConfigurationStrategy(</span>
<span class="nc" id="L333">        private val tabUiStates: List&lt;TabUiState&gt;</span>
    ) : TabLayoutMediator.TabConfigurationStrategy {
        override fun onConfigureTab(@NonNull tab: TabLayout.Tab, position: Int) {
<span class="nc bnc" id="L336" title="All 2 branches missed.">            binding?.updateTab(tab, tabUiStates[position])</span>
<span class="nc" id="L337">        }</span>
    }

    override fun onPause() {
<span class="nc" id="L341">        super.onPause()</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">        activity?.let {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (!it.isChangingConfigurations) {</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">                viewModel.clearActiveQuickStartTask()</span>
            }
<span class="nc" id="L346">        }</span>
<span class="nc" id="L347">    }</span>

    override fun onDestroyView() {
<span class="nc" id="L350">        super.onDestroyView()</span>
<span class="nc" id="L351">        binding = null</span>
<span class="nc" id="L352">    }</span>

    companion object {
        private const val PASS_TO_TAB_FRAGMENT_DELAY = 300L
        fun newInstance(): MySiteFragment {
<span class="nc" id="L357">            return MySiteFragment()</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>