<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SubfilterListItemMapper.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.subfilter</a> &gt; <span class="el_source">SubfilterListItemMapper.kt</span></div><h1>SubfilterListItemMapper.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.subfilter

import com.google.gson.Gson
import org.wordpress.android.datasets.ReaderBlogTableWrapper
import org.wordpress.android.models.ReaderBlog
import org.wordpress.android.models.ReaderTagType
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.ItemType.SITE
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.ItemType.SITE_ALL
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.ItemType.TAG
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.Site
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.SiteAll
import org.wordpress.android.ui.reader.subfilter.SubfilterListItem.Tag
import org.wordpress.android.ui.reader.utils.ReaderUtilsWrapper
import javax.inject.Inject

<span class="nc" id="L16">private data class MappedSubfilterListItem(</span>
<span class="nc" id="L17">    val type: Int,</span>
<span class="nc" id="L18">    var feedId: Long = 0,</span>
<span class="nc" id="L19">    var blogId: Long = 0,</span>
<span class="nc" id="L20">    var tagSlug: String = &quot;&quot;,</span>
<span class="nc" id="L21">    var tagType: Int = 0</span>
<span class="nc" id="L22">)</span>

<span class="nc" id="L24">class SubfilterListItemMapper @Inject constructor(</span>
<span class="nc" id="L25">    private val readerUtilsWrapper: ReaderUtilsWrapper,</span>
<span class="nc" id="L26">    private val readerBlogTableWrapper: ReaderBlogTableWrapper</span>
) {
    fun fromJson(
        json: String,
        onClickAction: (filter: SubfilterListItem) -&gt; Unit,
        isSelected: Boolean
    ): SubfilterListItem {
<span class="nc bnc" id="L33" title="All 4 branches missed.">        val mappedItem = if (json.isEmpty()) {</span>
<span class="nc" id="L34">            MappedSubfilterListItem(type = SITE_ALL.value)</span>
        } else {
<span class="nc" id="L36">            val gson = Gson()</span>
<span class="nc" id="L37">            gson.fromJson(json, MappedSubfilterListItem::class.java)</span>
        }

<span class="nc" id="L40">        return when (mappedItem.type) {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">            SITE.value -&gt; {</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">                val blogInfo: ReaderBlog? = if (mappedItem.blogId != 0L) {</span>
<span class="nc" id="L43">                    readerBlogTableWrapper.getBlogInfo(mappedItem.blogId)</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">                } else if (mappedItem.feedId != 0L) {</span>
<span class="nc" id="L45">                    readerBlogTableWrapper.getFeedInfo(mappedItem.feedId)</span>
<span class="nc" id="L46">                } else null</span>

<span class="nc bnc" id="L48" title="All 4 branches missed.">                blogInfo?.let {</span>
<span class="nc" id="L49">                    Site(</span>
<span class="nc" id="L50">                        blog = blogInfo,</span>
<span class="nc" id="L51">                        onClickAction = onClickAction,</span>
<span class="nc" id="L52">                        isSelected = isSelected</span>
                    )
<span class="nc" id="L54">                } ?: SiteAll(onClickAction = onClickAction, isSelected = isSelected)</span>
            }
<span class="nc bnc" id="L56" title="All 2 branches missed.">            TAG.value -&gt; {</span>
<span class="nc bnc" id="L57" title="All 4 branches missed.">                if (mappedItem.tagSlug.isNotEmpty()) {</span>
<span class="nc" id="L58">                    val tag = readerUtilsWrapper.getTagFromTagName(</span>
<span class="nc" id="L59">                            mappedItem.tagSlug,</span>
<span class="nc" id="L60">                            ReaderTagType.fromInt(mappedItem.tagType)</span>
                    )
<span class="nc" id="L62">                    Tag(</span>
<span class="nc" id="L63">                        tag = tag,</span>
<span class="nc" id="L64">                        onClickAction = onClickAction,</span>
<span class="nc" id="L65">                        isSelected = isSelected</span>
                    )
                } else {
<span class="nc" id="L68">                    SiteAll(onClickAction = onClickAction, isSelected = isSelected)</span>
                }
            }
<span class="nc bnc" id="L71" title="All 2 branches missed.">            SITE_ALL.value -&gt; SiteAll(onClickAction = onClickAction, isSelected = isSelected)</span>
<span class="nc" id="L72">            else -&gt; throw IllegalArgumentException(&quot;fromJson &gt; Unexpected Subfilter type $mappedItem.type&quot;)</span>
        }
    }

    fun toJson(item: SubfilterListItem): String {
<span class="nc" id="L77">        val gson = Gson()</span>

<span class="nc" id="L79">        val mappedItem = MappedSubfilterListItem(type = item.type.value)</span>

<span class="nc" id="L81">        when (item) {</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">            is Site -&gt; {</span>
<span class="nc" id="L83">                mappedItem.feedId = item.blog.feedId</span>
<span class="nc" id="L84">                mappedItem.blogId = item.blog.blogId</span>
            }
<span class="nc bnc" id="L86" title="All 2 branches missed.">            is Tag -&gt; {</span>
<span class="nc" id="L87">                mappedItem.tagSlug = item.tag.tagSlug</span>
<span class="nc" id="L88">                mappedItem.tagType = item.tag.tagType.toInt()</span>
            }
        }

<span class="nc" id="L92">        return gson.toJson(mappedItem)</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>