<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderBlogTable.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.datasets</a> &gt; <span class="el_source">ReaderBlogTable.java</span></div><h1>ReaderBlogTable.java</h1><pre class="source lang-java linenums">package org.wordpress.android.datasets;

import android.database.Cursor;
import android.database.SQLException;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteStatement;
import android.text.TextUtils;

import org.wordpress.android.models.ReaderBlog;
import org.wordpress.android.models.ReaderBlogList;
import org.wordpress.android.models.ReaderUrlList;
import org.wordpress.android.ui.reader.ReaderConstants;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.DateTimeUtils;
import org.wordpress.android.util.SqlUtils;
import org.wordpress.android.util.UrlUtils;

import java.util.Date;
import java.util.List;

/**
 * tbl_blog_info contains information about blogs viewed in the reader, and blogs the
 * user is following. Note that this table is populated from three endpoints:
 * &lt;p&gt;
 * 1. sites/{$siteId}
 * 2. read/following/mine?meta=site,feed
 * 3. read/feed/{$feedId}
 * &lt;p&gt;
 * The first endpoint is called when the user views blog preview, the second is called
 * to get the full list of blogs the user is following, the third is called when user views
 * by feed
 */
<span class="nc" id="L33">public class ReaderBlogTable {</span>
    protected static void createTables(SQLiteDatabase db) {
<span class="nc" id="L35">        db.execSQL(&quot;CREATE TABLE tbl_blog_info (&quot;</span>
                   + &quot; blog_id INTEGER DEFAULT 0,&quot; // will be same as feedId for feeds
                   + &quot; feed_id INTEGER DEFAULT 0,&quot; // will be 0 for blogs
                   + &quot; blog_url TEXT NOT NULL COLLATE NOCASE,&quot;
                   + &quot; image_url TEXT,&quot;
                   + &quot; feed_url TEXT,&quot;
                   + &quot; name TEXT,&quot;
                   + &quot; description TEXT,&quot;
                   + &quot; is_private INTEGER DEFAULT 0,&quot;
                   + &quot; is_jetpack INTEGER DEFAULT 0,&quot;
                   + &quot; is_following INTEGER DEFAULT 0,&quot;
                   + &quot; num_followers INTEGER DEFAULT 0,&quot;
                   + &quot; is_notifications_enabled INTEGER DEFAULT 0,&quot;
                   + &quot; date_updated TEXT,&quot;
                   + &quot; organization_id INTEGER DEFAULT 0,&quot;
                   + &quot; unseen_count INTEGER DEFAULT 0,&quot;
                   + &quot; PRIMARY KEY (blog_id)&quot;
                   + &quot;)&quot;);
<span class="nc" id="L53">    }</span>

    protected static void dropTables(SQLiteDatabase db) {
<span class="nc" id="L56">        db.execSQL(&quot;DROP TABLE IF EXISTS tbl_blog_info&quot;);</span>
<span class="nc" id="L57">    }</span>

    public static ReaderBlog getBlogInfo(long blogId) {
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (blogId == 0) {</span>
<span class="nc" id="L61">            return null;</span>
        }
<span class="nc" id="L63">        String[] args = {Long.toString(blogId)};</span>
<span class="nc" id="L64">        Cursor cursor = ReaderDatabase.getReadableDb().rawQuery(&quot;SELECT * FROM tbl_blog_info WHERE blog_id=?&quot;, args);</span>
        try {
<span class="nc bnc" id="L66" title="All 2 branches missed.">            if (!cursor.moveToFirst()) {</span>
<span class="nc" id="L67">                return null;</span>
            }
<span class="nc" id="L69">            return getBlogInfoFromCursor(cursor);</span>
        } finally {
<span class="nc" id="L71">            SqlUtils.closeCursor(cursor);</span>
        }
    }

    public static ReaderBlog getFeedInfo(long feedId) {
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (feedId == 0) {</span>
<span class="nc" id="L77">            return null;</span>
        }
<span class="nc" id="L79">        String[] args = {Long.toString(feedId)};</span>
<span class="nc" id="L80">        Cursor cursor = ReaderDatabase.getReadableDb().rawQuery(&quot;SELECT * FROM tbl_blog_info WHERE feed_id=?&quot;, args);</span>
        try {
<span class="nc bnc" id="L82" title="All 2 branches missed.">            if (!cursor.moveToFirst()) {</span>
<span class="nc" id="L83">                return null;</span>
            }
<span class="nc" id="L85">            return getBlogInfoFromCursor(cursor);</span>
        } finally {
<span class="nc" id="L87">            SqlUtils.closeCursor(cursor);</span>
        }
    }

    public static long getFeedIdFromUrl(String url) {
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (TextUtils.isEmpty(url)) {</span>
<span class="nc" id="L93">            return 0;</span>
        }
<span class="nc" id="L95">        String[] args = {UrlUtils.normalizeUrl(url)};</span>
<span class="nc" id="L96">        return SqlUtils.longForQuery(ReaderDatabase.getReadableDb(),</span>
                                     &quot;SELECT feed_id FROM tbl_blog_info WHERE feed_url=?&quot;,
                                     args);
    }

    private static ReaderBlog getBlogInfoFromCursor(Cursor c) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (c == null) {</span>
<span class="nc" id="L103">            return null;</span>
        }

<span class="nc" id="L106">        ReaderBlog blogInfo = new ReaderBlog();</span>
<span class="nc" id="L107">        blogInfo.blogId = c.getLong(c.getColumnIndexOrThrow(&quot;blog_id&quot;));</span>
<span class="nc" id="L108">        blogInfo.feedId = c.getLong(c.getColumnIndexOrThrow(&quot;feed_id&quot;));</span>
<span class="nc" id="L109">        blogInfo.setUrl(c.getString(c.getColumnIndexOrThrow(&quot;blog_url&quot;)));</span>
<span class="nc" id="L110">        blogInfo.setImageUrl(c.getString(c.getColumnIndexOrThrow(&quot;image_url&quot;)));</span>
<span class="nc" id="L111">        blogInfo.setFeedUrl(c.getString(c.getColumnIndexOrThrow(&quot;feed_url&quot;)));</span>
<span class="nc" id="L112">        blogInfo.setName(c.getString(c.getColumnIndexOrThrow(&quot;name&quot;)));</span>
<span class="nc" id="L113">        blogInfo.setDescription(c.getString(c.getColumnIndexOrThrow(&quot;description&quot;)));</span>
<span class="nc" id="L114">        blogInfo.isPrivate = SqlUtils.sqlToBool(c.getInt(c.getColumnIndexOrThrow(&quot;is_private&quot;)));</span>
<span class="nc" id="L115">        blogInfo.isJetpack = SqlUtils.sqlToBool(c.getInt(c.getColumnIndexOrThrow(&quot;is_jetpack&quot;)));</span>
<span class="nc" id="L116">        blogInfo.isFollowing = SqlUtils.sqlToBool(c.getInt(c.getColumnIndexOrThrow(&quot;is_following&quot;)));</span>
<span class="nc" id="L117">        blogInfo.isNotificationsEnabled = SqlUtils.sqlToBool(c.getInt(c.getColumnIndexOrThrow(</span>
                &quot;is_notifications_enabled&quot;)));
<span class="nc" id="L119">        blogInfo.numSubscribers = c.getInt(c.getColumnIndexOrThrow(&quot;num_followers&quot;));</span>
<span class="nc" id="L120">        blogInfo.organizationId = c.getInt(c.getColumnIndexOrThrow(&quot;organization_id&quot;));</span>
<span class="nc" id="L121">        blogInfo.numUnseenPosts = c.getInt(c.getColumnIndexOrThrow(&quot;unseen_count&quot;));</span>

<span class="nc" id="L123">        return blogInfo;</span>
    }

    public static void addOrUpdateBlog(ReaderBlog blogInfo) {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (blogInfo == null) {</span>
<span class="nc" id="L128">            return;</span>
        }
<span class="nc" id="L130">        String sql = &quot;INSERT OR REPLACE INTO tbl_blog_info&quot;</span>
                     + &quot; (blog_id, feed_id, blog_url, image_url, feed_url, name, description, is_private, is_jetpack, &quot;
                     + &quot;  is_following, is_notifications_enabled, num_followers, date_updated, &quot;
                     + &quot;  organization_id, unseen_count)&quot;
                     + &quot; VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7, ?8, ?9, ?10, ?11, ?12, ?13, ?14, ?15)&quot;;
<span class="nc" id="L135">        SQLiteStatement stmt = ReaderDatabase.getWritableDb().compileStatement(sql);</span>
        try {
<span class="nc" id="L137">            stmt.bindLong(1, blogInfo.blogId);</span>
<span class="nc" id="L138">            stmt.bindLong(2, blogInfo.feedId);</span>
<span class="nc" id="L139">            stmt.bindString(3, blogInfo.getUrl());</span>
<span class="nc" id="L140">            stmt.bindString(4, blogInfo.getImageUrl());</span>
<span class="nc" id="L141">            stmt.bindString(5, blogInfo.getFeedUrl());</span>
<span class="nc" id="L142">            stmt.bindString(6, blogInfo.getName());</span>
<span class="nc" id="L143">            stmt.bindString(7, blogInfo.getDescription());</span>
<span class="nc" id="L144">            stmt.bindLong(8, SqlUtils.boolToSql(blogInfo.isPrivate));</span>
<span class="nc" id="L145">            stmt.bindLong(9, SqlUtils.boolToSql(blogInfo.isJetpack));</span>
<span class="nc" id="L146">            stmt.bindLong(10, SqlUtils.boolToSql(blogInfo.isFollowing));</span>
<span class="nc" id="L147">            stmt.bindLong(11, SqlUtils.boolToSql(blogInfo.isNotificationsEnabled));</span>
<span class="nc" id="L148">            stmt.bindLong(12, blogInfo.numSubscribers);</span>
<span class="nc" id="L149">            stmt.bindString(13, DateTimeUtils.iso8601FromDate(new Date()));</span>
<span class="nc" id="L150">            stmt.bindLong(14, blogInfo.organizationId);</span>
<span class="nc" id="L151">            stmt.bindLong(15, blogInfo.numUnseenPosts);</span>
<span class="nc" id="L152">            stmt.execute();</span>
        } finally {
<span class="nc" id="L154">            SqlUtils.closeStatement(stmt);</span>
        }
<span class="nc" id="L156">    }</span>

    /*
     * returns blogInfo for all followed blogs
     */
    public static ReaderBlogList getFollowedBlogs() {
<span class="nc" id="L162">        Cursor c = ReaderDatabase.getReadableDb().rawQuery(</span>
                &quot;SELECT * FROM tbl_blog_info WHERE is_following!=0 ORDER BY name COLLATE NOCASE, blog_url&quot;,
                null);
        try {
<span class="nc" id="L166">            ReaderBlogList blogs = new ReaderBlogList();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">            if (c.moveToFirst()) {</span>
                do {
<span class="nc" id="L169">                    ReaderBlog blogInfo = getBlogInfoFromCursor(c);</span>
<span class="nc" id="L170">                    blogs.add(blogInfo);</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                } while (c.moveToNext());</span>
            }
<span class="nc" id="L173">            return blogs;</span>
        } finally {
<span class="nc" id="L175">            SqlUtils.closeCursor(c);</span>
        }
    }

    /*
     * set followed blogs from the read/following/mine endpoint
     */
    public static void setFollowedBlogs(ReaderBlogList followedBlogs) {
<span class="nc" id="L183">        SQLiteDatabase db = ReaderDatabase.getWritableDb();</span>
<span class="nc" id="L184">        db.beginTransaction();</span>
        try {
            // first set all existing blogs to not followed
<span class="nc" id="L187">            db.execSQL(&quot;UPDATE tbl_blog_info SET is_following=0&quot;);</span>

            // then insert passed ones
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (followedBlogs != null) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                for (ReaderBlog blog : followedBlogs) {</span>
<span class="nc" id="L192">                    addOrUpdateBlog(blog);</span>
<span class="nc" id="L193">                }</span>
            }

<span class="nc" id="L196">            db.setTransactionSuccessful();</span>
        } finally {
<span class="nc" id="L198">            db.endTransaction();</span>
        }
<span class="nc" id="L200">    }</span>

    /*
     * return list of URLs of followed blogs
     */
    public static ReaderUrlList getFollowedBlogUrls() {
<span class="nc" id="L206">        Cursor c = ReaderDatabase.getReadableDb()</span>
<span class="nc" id="L207">                                 .rawQuery(&quot;SELECT DISTINCT blog_url FROM tbl_blog_info WHERE is_following!=0&quot;, null);</span>
        try {
<span class="nc" id="L209">            ReaderUrlList urls = new ReaderUrlList();</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if (c.moveToFirst()) {</span>
                do {
<span class="nc" id="L212">                    urls.add(c.getString(0));</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">                } while (c.moveToNext());</span>
            }
<span class="nc" id="L215">            return urls;</span>
        } finally {
<span class="nc" id="L217">            SqlUtils.closeCursor(c);</span>
        }
    }

    /*
     * sets the follow state for passed blog without creating a record for it if it doesn't exist
     */
    public static void setIsFollowedBlogId(long blogId, boolean isFollowed) {
<span class="nc" id="L225">        ReaderDatabase.getWritableDb().execSQL(</span>
                &quot;UPDATE tbl_blog_info SET is_following=&quot;
<span class="nc" id="L227">                + SqlUtils.boolToSql(isFollowed)</span>
                + &quot; WHERE blog_id=?&quot;,
<span class="nc" id="L229">                new String[]{Long.toString(blogId)});</span>
<span class="nc" id="L230">    }</span>

    public static void setIsFollowedFeedId(long feedId, boolean isFollowed) {
<span class="nc" id="L233">        ReaderDatabase.getWritableDb().execSQL(</span>
                &quot;UPDATE tbl_blog_info SET is_following=&quot;
<span class="nc" id="L235">                + SqlUtils.boolToSql(isFollowed)</span>
                + &quot; WHERE feed_id=?&quot;,
<span class="nc" id="L237">                new String[]{Long.toString(feedId)});</span>
<span class="nc" id="L238">    }</span>

    public static boolean hasFollowedBlogs() {
<span class="nc" id="L241">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_following!=0 LIMIT 1&quot;;</span>
<span class="nc" id="L242">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, null);</span>
    }

    public static boolean isFollowedBlogUrl(String blogUrl) {
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (TextUtils.isEmpty(blogUrl)) {</span>
<span class="nc" id="L247">            return false;</span>
        }
<span class="nc" id="L249">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_following!=0 AND blog_url=?&quot;;</span>
<span class="nc" id="L250">        String[] args = {UrlUtils.normalizeUrl(blogUrl)};</span>
<span class="nc" id="L251">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, args);</span>
    }

    public static boolean isFollowedBlog(long blogId) {
<span class="nc" id="L255">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_following!=0 AND blog_id=?&quot;;</span>
<span class="nc" id="L256">        String[] args = {Long.toString(blogId)};</span>
<span class="nc" id="L257">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, args);</span>
    }

    public static boolean isFollowedFeedUrl(String feedUrl) {
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (TextUtils.isEmpty(feedUrl)) {</span>
<span class="nc" id="L262">            return false;</span>
        }
<span class="nc" id="L264">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_following!=0 AND feed_url=?&quot;;</span>
<span class="nc" id="L265">        String[] args = {UrlUtils.normalizeUrl(feedUrl)};</span>
<span class="nc" id="L266">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, args);</span>
    }

    public static boolean isFollowedFeed(long feedId) {
<span class="nc" id="L270">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_following!=0 AND feed_id=?&quot;;</span>
<span class="nc" id="L271">        String[] args = {Long.toString(feedId)};</span>
<span class="nc" id="L272">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, args);</span>
    }

    public static boolean isNotificationsEnabled(long blogId) {
<span class="nc" id="L276">        String sql = &quot;SELECT 1 FROM tbl_blog_info WHERE is_notifications_enabled!=0 AND blog_id=?&quot;;</span>
<span class="nc" id="L277">        String[] args = {Long.toString(blogId)};</span>
<span class="nc" id="L278">        return SqlUtils.boolForQuery(ReaderDatabase.getReadableDb(), sql, args);</span>
    }

    public static void setNotificationsEnabledByBlogId(long blogId, boolean isEnabled) {
<span class="nc" id="L282">        ReaderDatabase.getWritableDb().execSQL(</span>
                &quot;UPDATE tbl_blog_info SET is_notifications_enabled=&quot;
<span class="nc" id="L284">                + SqlUtils.boolToSql(isEnabled)</span>
                + &quot; WHERE blog_id=?&quot;,
<span class="nc" id="L286">                new String[]{Long.toString(blogId)});</span>
<span class="nc" id="L287">    }</span>

    public static String getBlogName(long blogId) {
<span class="nc" id="L290">        String[] args = {Long.toString(blogId)};</span>
<span class="nc" id="L291">        return SqlUtils.stringForQuery(ReaderDatabase.getReadableDb(),</span>
                                       &quot;SELECT name FROM tbl_blog_info WHERE blog_id=?&quot;,
                                       args);
    }

    public static String getBlogUrl(long blogId) {
<span class="nc" id="L297">        String[] args = {Long.toString(blogId)};</span>
<span class="nc" id="L298">        return SqlUtils.stringForQuery(ReaderDatabase.getReadableDb(),</span>
                                       &quot;SELECT blog_url FROM tbl_blog_info WHERE blog_id=?&quot;,
                                       args);
    }

    public static String getFeedName(long feedId) {
<span class="nc" id="L304">        String[] args = {Long.toString(feedId)};</span>
<span class="nc" id="L305">        return SqlUtils.stringForQuery(ReaderDatabase.getReadableDb(),</span>
                                       &quot;SELECT name FROM tbl_blog_info WHERE feed_id=?&quot;,
                                       args);
    }

    public static void deleteBlogsWithIds(final List&lt;Long&gt; blogIds) {
<span class="nc" id="L311">        SQLiteDatabase db = ReaderDatabase.getWritableDb();</span>
<span class="nc" id="L312">        SQLiteStatement stmt = db.compileStatement(</span>
                &quot;DELETE FROM tbl_blog_info&quot;
                + &quot; WHERE blog_id IN (&quot;
<span class="nc" id="L315">                + TextUtils.join(&quot;,&quot;, blogIds)</span>
                + &quot;)&quot;
        );
<span class="nc" id="L318">        db.beginTransaction();</span>
        try {
            try {
<span class="nc" id="L321">                stmt.execute();</span>
<span class="nc" id="L322">                db.setTransactionSuccessful();</span>
<span class="nc" id="L323">            } catch (SQLException e) {</span>
<span class="nc" id="L324">                AppLog.e(AppLog.T.READER, e);</span>
<span class="nc" id="L325">            }</span>
        } finally {
<span class="nc" id="L327">            SqlUtils.closeStatement(stmt);</span>
<span class="nc" id="L328">            db.endTransaction();</span>
        }
<span class="nc" id="L330">    }</span>

    public static void incrementUnseenCount(long blogId) {
<span class="nc" id="L333">        ReaderDatabase.getWritableDb().execSQL(</span>
                &quot;UPDATE tbl_blog_info SET unseen_count = unseen_count+1&quot;
                + &quot; WHERE blog_id=?&quot;,
<span class="nc" id="L336">                new String[]{Long.toString(blogId)});</span>
<span class="nc" id="L337">    }</span>

    public static void decrementUnseenCount(long blogId) {
<span class="nc" id="L340">        ReaderDatabase.getWritableDb().execSQL(</span>
                &quot;UPDATE tbl_blog_info SET unseen_count = unseen_count-1&quot;
                + &quot; WHERE blog_id=?&quot;,
<span class="nc" id="L343">                new String[]{Long.toString(blogId)});</span>
<span class="nc" id="L344">    }</span>

    /*
     * determine whether the passed blog info should be updated based on when it was last updated
     */
    public static boolean isTimeToUpdateBlogInfo(ReaderBlog blogInfo) {
<span class="nc" id="L350">        int minutes = minutesSinceLastUpdate(blogInfo);</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">        if (minutes == NEVER_UPDATED) {</span>
<span class="nc" id="L352">            return true;</span>
        }
<span class="nc bnc" id="L354" title="All 2 branches missed.">        return (minutes &gt;= ReaderConstants.READER_AUTO_UPDATE_DELAY_MINUTES);</span>
    }

    private static String getBlogInfoLastUpdated(ReaderBlog blogInfo) {
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if (blogInfo == null) {</span>
<span class="nc" id="L359">            return &quot;&quot;;</span>
        }
<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (blogInfo.blogId != 0) {</span>
<span class="nc" id="L362">            String[] args = {Long.toString(blogInfo.blogId)};</span>
<span class="nc" id="L363">            return SqlUtils.stringForQuery(ReaderDatabase.getReadableDb(),</span>
                                           &quot;SELECT date_updated FROM tbl_blog_info WHERE blog_id=?&quot;,
                                           args);
        } else {
<span class="nc" id="L367">            String[] args = {Long.toString(blogInfo.feedId)};</span>
<span class="nc" id="L368">            return SqlUtils.stringForQuery(ReaderDatabase.getReadableDb(),</span>
                                           &quot;SELECT date_updated FROM tbl_blog_info WHERE feed_id=?&quot;,
                                           args);
        }
    }

    private static final int NEVER_UPDATED = -1;

    private static int minutesSinceLastUpdate(ReaderBlog blogInfo) {
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (blogInfo == null) {</span>
<span class="nc" id="L378">            return 0;</span>
        }

<span class="nc" id="L381">        String updated = getBlogInfoLastUpdated(blogInfo);</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (TextUtils.isEmpty(updated)) {</span>
<span class="nc" id="L383">            return NEVER_UPDATED;</span>
        }

<span class="nc" id="L386">        Date dtUpdated = DateTimeUtils.dateFromIso8601(updated);</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">        if (dtUpdated == null) {</span>
<span class="nc" id="L388">            return 0;</span>
        }

<span class="nc" id="L391">        Date dtNow = new Date();</span>
<span class="nc" id="L392">        return DateTimeUtils.minutesBetween(dtUpdated, dtNow);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>