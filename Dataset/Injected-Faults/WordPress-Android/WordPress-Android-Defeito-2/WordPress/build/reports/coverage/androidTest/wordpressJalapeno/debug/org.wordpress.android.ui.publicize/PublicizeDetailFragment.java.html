<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PublicizeDetailFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.publicize</a> &gt; <span class="el_source">PublicizeDetailFragment.java</span></div><h1>PublicizeDetailFragment.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.publicize;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.datasets.PublicizeTable;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.fluxc.store.AccountStore;
import org.wordpress.android.models.PublicizeService;
import org.wordpress.android.ui.ScrollableViewInitializedListener;
import org.wordpress.android.ui.publicize.PublicizeConstants.ConnectAction;
import org.wordpress.android.ui.publicize.adapters.PublicizeConnectionAdapter;
import org.wordpress.android.util.ToastUtils;

import javax.inject.Inject;

<span class="nc" id="L26">public class PublicizeDetailFragment extends PublicizeBaseFragment</span>
        implements PublicizeConnectionAdapter.OnAdapterLoadedListener {
    private SiteModel mSite;
    private String mServiceId;

    private PublicizeService mService;

    private ConnectButton mConnectBtn;
    private RecyclerView mRecycler;
    private View mConnectionsContainer;
    private ViewGroup mServiceContainer;
    private View mNestedScrollView;

    @Inject AccountStore mAccountStore;

    public static PublicizeDetailFragment newInstance(@NonNull SiteModel site, @NonNull PublicizeService service) {
<span class="nc" id="L42">        Bundle args = new Bundle();</span>
<span class="nc" id="L43">        args.putSerializable(WordPress.SITE, site);</span>
<span class="nc" id="L44">        args.putString(PublicizeConstants.ARG_SERVICE_ID, service.getId());</span>

<span class="nc" id="L46">        PublicizeDetailFragment fragment = new PublicizeDetailFragment();</span>
<span class="nc" id="L47">        fragment.setArguments(args);</span>

<span class="nc" id="L49">        return fragment;</span>
    }

    @Override
    public void setArguments(Bundle args) {
<span class="nc" id="L54">        super.setArguments(args);</span>

<span class="nc bnc" id="L56" title="All 2 branches missed.">        if (args != null) {</span>
<span class="nc" id="L57">            mSite = (SiteModel) args.getSerializable(WordPress.SITE);</span>
<span class="nc" id="L58">            mServiceId = args.getString(PublicizeConstants.ARG_SERVICE_ID);</span>
        }
<span class="nc" id="L60">    }</span>

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L64">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L65">        ((WordPress) getActivity().getApplication()).component().inject(this);</span>

<span class="nc bnc" id="L67" title="All 2 branches missed.">        if (savedInstanceState != null) {</span>
<span class="nc" id="L68">            mSite = (SiteModel) savedInstanceState.getSerializable(WordPress.SITE);</span>
<span class="nc" id="L69">            mServiceId = savedInstanceState.getString(PublicizeConstants.ARG_SERVICE_ID);</span>
        }
<span class="nc" id="L71">    }</span>

    @Override
    public void onSaveInstanceState(@NotNull Bundle outState) {
<span class="nc" id="L75">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L76">        outState.putSerializable(WordPress.SITE, mSite);</span>
<span class="nc" id="L77">        outState.putString(PublicizeConstants.ARG_SERVICE_ID, mServiceId);</span>
<span class="nc" id="L78">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
<span class="nc" id="L82">        ViewGroup rootView = (ViewGroup) inflater.inflate(R.layout.publicize_detail_fragment, container, false);</span>

<span class="nc" id="L84">        mConnectionsContainer = rootView.findViewById(R.id.connections_container);</span>
<span class="nc" id="L85">        mServiceContainer = rootView.findViewById(R.id.service_container);</span>
<span class="nc" id="L86">        mConnectBtn = mServiceContainer.findViewById(R.id.button_connect);</span>
<span class="nc" id="L87">        mRecycler = rootView.findViewById(R.id.recycler_view);</span>
<span class="nc" id="L88">        mNestedScrollView = rootView.findViewById(R.id.publicize_details_nested_scroll_View);</span>

<span class="nc" id="L90">        return rootView;</span>
    }

    @Override
    public void onResume() {
<span class="nc" id="L95">        super.onResume();</span>
<span class="nc" id="L96">        loadData();</span>
<span class="nc" id="L97">        setNavigationIcon(R.drawable.ic_arrow_left_white_24dp);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (getActivity() instanceof ScrollableViewInitializedListener) {</span>
<span class="nc" id="L99">            ((ScrollableViewInitializedListener) getActivity()).onScrollableViewInitialized(mNestedScrollView.getId());</span>
        }
<span class="nc" id="L101">    }</span>

    public void loadData() {
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (!isAdded()) {</span>
<span class="nc" id="L105">            return;</span>
        }

<span class="nc" id="L108">        mService = PublicizeTable.getService(mServiceId);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">        if (mService == null) {</span>
<span class="nc" id="L110">            ToastUtils.showToast(getActivity(), R.string.error_generic);</span>
<span class="nc" id="L111">            return;</span>
        }

<span class="nc" id="L114">        setTitle(mService.getLabel());</span>

        // disable the ability to add another G+ connection
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (isGooglePlus()) {</span>
<span class="nc" id="L118">            mServiceContainer.setVisibility(View.GONE);</span>
        } else {
<span class="nc" id="L120">            String serviceLabel = String.format(getString(R.string.connection_service_label), mService.getLabel());</span>
<span class="nc" id="L121">            TextView txtService = mServiceContainer.findViewById(R.id.text_service);</span>
<span class="nc" id="L122">            txtService.setText(serviceLabel);</span>

<span class="nc" id="L124">            String description = String.format(getString(R.string.connection_service_description), mService.getLabel());</span>
<span class="nc" id="L125">            TextView txtDescription = mServiceContainer.findViewById(R.id.text_description);</span>
<span class="nc" id="L126">            txtDescription.setText(description);</span>
        }

<span class="nc" id="L129">        long currentUserId = mAccountStore.getAccount().getUserId();</span>
<span class="nc" id="L130">        PublicizeConnectionAdapter adapter = new PublicizeConnectionAdapter(</span>
<span class="nc" id="L131">                getActivity(), mSite.getSiteId(), mService, currentUserId);</span>
<span class="nc" id="L132">        adapter.setOnPublicizeActionListener(getOnPublicizeActionListener());</span>
<span class="nc" id="L133">        adapter.setOnAdapterLoadedListener(this);</span>

<span class="nc" id="L135">        mRecycler.setAdapter(adapter);</span>
<span class="nc" id="L136">        adapter.refresh();</span>
<span class="nc" id="L137">    }</span>

    private boolean isGooglePlus() {
<span class="nc" id="L140">        return mService.getId().equals(PublicizeConstants.GOOGLE_PLUS_ID);</span>
    }

    private boolean hasOnPublicizeActionListener() {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        return getOnPublicizeActionListener() != null;</span>
    }

    private PublicizeActions.OnPublicizeActionListener getOnPublicizeActionListener() {
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (getActivity() instanceof PublicizeActions.OnPublicizeActionListener) {</span>
<span class="nc" id="L149">            return (PublicizeActions.OnPublicizeActionListener) getActivity();</span>
        }
<span class="nc" id="L151">        return null;</span>
    }

    @Override
    public void onAdapterLoaded(boolean isEmpty) {
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (!isAdded()) {</span>
<span class="nc" id="L157">            return;</span>
        }

<span class="nc bnc" id="L160" title="All 2 branches missed.">        mConnectionsContainer.setVisibility(isEmpty ? View.GONE : View.VISIBLE);</span>

<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (hasOnPublicizeActionListener()) {</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            if (isEmpty) {</span>
<span class="nc" id="L164">                mConnectBtn.setAction(ConnectAction.CONNECT);</span>
            } else {
<span class="nc" id="L166">                mConnectBtn.setAction(ConnectAction.CONNECT_ANOTHER_ACCOUNT);</span>
            }
<span class="nc" id="L168">            mConnectBtn.setOnClickListener(v -&gt; getOnPublicizeActionListener().onRequestConnect(mService));</span>
        }
<span class="nc" id="L170">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>