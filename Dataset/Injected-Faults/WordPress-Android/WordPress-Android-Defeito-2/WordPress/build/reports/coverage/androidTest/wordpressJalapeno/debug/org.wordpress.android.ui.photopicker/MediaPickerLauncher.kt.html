<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediaPickerLauncher.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.photopicker</a> &gt; <span class="el_source">MediaPickerLauncher.kt</span></div><h1>MediaPickerLauncher.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.photopicker

import android.app.Activity
import android.content.Intent
import androidx.annotation.StringRes
import androidx.fragment.app.Fragment
import org.wordpress.android.R
import org.wordpress.android.analytics.AnalyticsTracker.Stat
import org.wordpress.android.fluxc.model.SiteModel
import org.wordpress.android.ui.ActivityLauncher
import org.wordpress.android.ui.RequestCodes
import org.wordpress.android.ui.media.MediaBrowserType
import org.wordpress.android.ui.media.MediaBrowserType.FEATURED_IMAGE_PICKER
import org.wordpress.android.ui.media.MediaBrowserType.WP_STORIES_MEDIA_PICKER
import org.wordpress.android.ui.mediapicker.MediaPickerActivity
import org.wordpress.android.ui.mediapicker.MediaPickerSetup
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.CameraSetup.ENABLED
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.CameraSetup.HIDDEN
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.CameraSetup.STORIES
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.DataSource.DEVICE
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.DataSource.GIF_LIBRARY
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.DataSource.STOCK_LIBRARY
import org.wordpress.android.ui.mediapicker.MediaPickerSetup.DataSource.WP_LIBRARY
import org.wordpress.android.ui.mediapicker.MediaType
import org.wordpress.android.ui.mediapicker.MediaType.AUDIO
import org.wordpress.android.ui.mediapicker.MediaType.DOCUMENT
import org.wordpress.android.ui.mediapicker.MediaType.IMAGE
import org.wordpress.android.ui.mediapicker.MediaType.VIDEO
import org.wordpress.android.util.analytics.AnalyticsTrackerWrapper
import javax.inject.Inject

<span class="nc" id="L32">class MediaPickerLauncher @Inject constructor(</span>
<span class="nc" id="L33">    private val analyticsTrackerWrapper: AnalyticsTrackerWrapper</span>
) {
    fun showFeaturedImagePicker(
        activity: Activity,
        site: SiteModel?,
        localPostId: Int
    ) {
<span class="nc bnc" id="L40" title="All 4 branches missed.">        val availableDataSources = if (site != null &amp;&amp; site.isUsingWpComRestApi) {</span>
<span class="nc" id="L41">            setOf(WP_LIBRARY, STOCK_LIBRARY, GIF_LIBRARY)</span>
        } else {
<span class="nc" id="L43">            setOf(WP_LIBRARY, GIF_LIBRARY)</span>
        }

<span class="nc" id="L46">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L47">                primaryDataSource = DEVICE,</span>
<span class="nc" id="L48">                availableDataSources = availableDataSources,</span>
<span class="nc" id="L49">                canMultiselect = false,</span>
<span class="nc" id="L50">                requiresStoragePermissions = true,</span>
<span class="nc" id="L51">                allowedTypes = setOf(IMAGE),</span>
<span class="nc" id="L52">                cameraSetup = ENABLED,</span>
<span class="nc" id="L53">                systemPickerEnabled = true,</span>
<span class="nc" id="L54">                editingEnabled = true,</span>
<span class="nc" id="L55">                queueResults = true,</span>
<span class="nc" id="L56">                defaultSearchView = false,</span>
<span class="nc" id="L57">                title = R.string.photo_picker_title</span>
        )
<span class="nc" id="L59">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L60">                activity,</span>
<span class="nc" id="L61">                mediaPickerSetup,</span>
<span class="nc" id="L62">                site,</span>
<span class="nc" id="L63">                localPostId</span>
        )
<span class="nc" id="L65">        activity.startActivityForResult(intent, RequestCodes.PHOTO_PICKER)</span>
<span class="nc" id="L66">    }</span>

    fun showSiteIconPicker(
        activity: Activity,
        site: SiteModel?
    ) {
<span class="nc" id="L72">        val intent = buildSitePickerIntent(activity, site)</span>
<span class="nc" id="L73">        activity.startActivityForResult(intent, RequestCodes.PHOTO_PICKER)</span>
<span class="nc" id="L74">    }</span>

    fun showSiteIconPicker(
        fragment: Fragment,
        site: SiteModel?
    ) {
<span class="nc" id="L80">        val intent = buildSitePickerIntent(fragment.requireActivity(), site)</span>
<span class="nc" id="L81">        fragment.startActivityForResult(intent, RequestCodes.SITE_ICON_PICKER)</span>
<span class="nc" id="L82">    }</span>

    private fun buildSitePickerIntent(
        activity: Activity,
        site: SiteModel?
    ): Intent {
<span class="nc" id="L88">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L89">                primaryDataSource = DEVICE,</span>
<span class="nc" id="L90">                availableDataSources = setOf(WP_LIBRARY),</span>
<span class="nc" id="L91">                canMultiselect = false,</span>
<span class="nc" id="L92">                requiresStoragePermissions = true,</span>
<span class="nc" id="L93">                allowedTypes = setOf(IMAGE),</span>
<span class="nc" id="L94">                cameraSetup = ENABLED,</span>
<span class="nc" id="L95">                systemPickerEnabled = true,</span>
<span class="nc" id="L96">                editingEnabled = true,</span>
<span class="nc" id="L97">                queueResults = false,</span>
<span class="nc" id="L98">                defaultSearchView = false,</span>
<span class="nc" id="L99">                title = R.string.photo_picker_title</span>
        )
<span class="nc" id="L101">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L102">                activity,</span>
<span class="nc" id="L103">                mediaPickerSetup,</span>
<span class="nc" id="L104">                site,</span>
<span class="nc" id="L105">                null</span>
        )
<span class="nc" id="L107">        return intent</span>
    }

    fun showPhotoPickerForResult(
        activity: Activity,
        browserType: MediaBrowserType,
        site: SiteModel?,
        localPostId: Int?
    ) {
<span class="nc" id="L116">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L117">                activity,</span>
<span class="nc" id="L118">                buildLocalMediaPickerSetup(browserType),</span>
<span class="nc" id="L119">                site,</span>
<span class="nc" id="L120">                localPostId</span>
        )
<span class="nc" id="L122">        activity.startActivityForResult(intent, RequestCodes.PHOTO_PICKER)</span>
<span class="nc" id="L123">    }</span>

    fun showStoriesPhotoPickerForResultAndTrack(activity: Activity, site: SiteModel?) {
<span class="nc" id="L126">        analyticsTrackerWrapper.track(Stat.MEDIA_PICKER_OPEN_FOR_STORIES)</span>
<span class="nc" id="L127">        showStoriesPhotoPickerForResult(activity, site)</span>
<span class="nc" id="L128">    }</span>

    fun showStoriesPhotoPickerForResult(
        activity: Activity,
        site: SiteModel?
    ) {
<span class="nc" id="L134">        ActivityLauncher.showPhotoPickerForResult(activity, WP_STORIES_MEDIA_PICKER, site, null)</span>
<span class="nc" id="L135">    }</span>

    fun showGravatarPicker(fragment: Fragment) {
<span class="nc" id="L138">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L139">                primaryDataSource = DEVICE,</span>
<span class="nc" id="L140">                availableDataSources = setOf(),</span>
<span class="nc" id="L141">                canMultiselect = false,</span>
<span class="nc" id="L142">                requiresStoragePermissions = true,</span>
<span class="nc" id="L143">                allowedTypes = setOf(IMAGE),</span>
<span class="nc" id="L144">                cameraSetup = ENABLED,</span>
<span class="nc" id="L145">                systemPickerEnabled = true,</span>
<span class="nc" id="L146">                editingEnabled = true,</span>
<span class="nc" id="L147">                queueResults = false,</span>
<span class="nc" id="L148">                defaultSearchView = false,</span>
<span class="nc" id="L149">                title = R.string.photo_picker_title</span>
        )
<span class="nc" id="L151">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L152">                fragment.requireContext(),</span>
<span class="nc" id="L153">                mediaPickerSetup</span>
        )
<span class="nc" id="L155">        fragment.startActivityForResult(intent, RequestCodes.PHOTO_PICKER)</span>
<span class="nc" id="L156">    }</span>

<span class="nc" id="L158">    fun showFilePicker(activity: Activity, canMultiselect: Boolean = true, site: SiteModel) {</span>
<span class="nc" id="L159">        showFilePicker(</span>
<span class="nc" id="L160">                activity,</span>
<span class="nc" id="L161">                site,</span>
<span class="nc" id="L162">                canMultiselect,</span>
<span class="nc" id="L163">                mutableSetOf(IMAGE, VIDEO, AUDIO, DOCUMENT),</span>
<span class="nc" id="L164">                RequestCodes.FILE_LIBRARY,</span>
<span class="nc" id="L165">                R.string.photo_picker_choose_file</span>
        )
<span class="nc" id="L167">    }</span>

<span class="nc" id="L169">    fun showAudioFilePicker(activity: Activity, canMultiselect: Boolean = false, site: SiteModel) {</span>
<span class="nc" id="L170">        showFilePicker(</span>
<span class="nc" id="L171">                activity,</span>
<span class="nc" id="L172">                site,</span>
<span class="nc" id="L173">                canMultiselect,</span>
<span class="nc" id="L174">                mutableSetOf(AUDIO),</span>
<span class="nc" id="L175">                RequestCodes.AUDIO_LIBRARY,</span>
<span class="nc" id="L176">                R.string.photo_picker_choose_audio</span>
        )
<span class="nc" id="L178">    }</span>

    @Suppress(&quot;LongParameterList&quot;)
<span class="nc" id="L181">    private fun showFilePicker(</span>
        activity: Activity,
        site: SiteModel,
<span class="nc" id="L184">        canMultiselect: Boolean = false,</span>
        allowedTypes: Set&lt;MediaType&gt;,
        requestCode: Int,
        @StringRes title: Int
    ) {
<span class="nc" id="L189">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L190">                primaryDataSource = DEVICE,</span>
<span class="nc" id="L191">                availableDataSources = setOf(),</span>
<span class="nc" id="L192">                canMultiselect = canMultiselect,</span>
<span class="nc" id="L193">                requiresStoragePermissions = true,</span>
<span class="nc" id="L194">                allowedTypes = allowedTypes,</span>
<span class="nc" id="L195">                cameraSetup = HIDDEN,</span>
<span class="nc" id="L196">                systemPickerEnabled = true,</span>
<span class="nc" id="L197">                editingEnabled = true,</span>
<span class="nc" id="L198">                queueResults = false,</span>
<span class="nc" id="L199">                defaultSearchView = false,</span>
<span class="nc" id="L200">                title = title</span>
        )
<span class="nc" id="L202">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L203">                activity,</span>
<span class="nc" id="L204">                mediaPickerSetup,</span>
<span class="nc" id="L205">                site</span>
        )
<span class="nc" id="L207">        activity.startActivityForResult(</span>
<span class="nc" id="L208">                intent,</span>
<span class="nc" id="L209">                requestCode</span>
        )
<span class="nc" id="L211">    }</span>

    fun viewWPMediaLibraryPickerForResult(activity: Activity, site: SiteModel, browserType: MediaBrowserType) {
<span class="nc" id="L214">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L215">                activity,</span>
<span class="nc" id="L216">                buildWPMediaLibraryPickerSetup(browserType),</span>
<span class="nc" id="L217">                site</span>
        )
<span class="nc bnc" id="L219" title="All 2 branches missed.">        val requestCode: Int = if (browserType.canMultiselect()) {</span>
<span class="nc" id="L220">            RequestCodes.MULTI_SELECT_MEDIA_PICKER</span>
        } else {
<span class="nc" id="L222">            RequestCodes.SINGLE_SELECT_MEDIA_PICKER</span>
        }
<span class="nc" id="L224">        activity.startActivityForResult(intent, requestCode)</span>
<span class="nc" id="L225">    }</span>

    fun showStockMediaPickerForResult(
        activity: Activity,
        site: SiteModel,
        requestCode: Int,
        allowMultipleSelection: Boolean
    ) {
<span class="nc" id="L233">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L234">                primaryDataSource = STOCK_LIBRARY,</span>
<span class="nc" id="L235">                availableDataSources = setOf(),</span>
<span class="nc" id="L236">                canMultiselect = allowMultipleSelection,</span>
<span class="nc" id="L237">                requiresStoragePermissions = false,</span>
<span class="nc" id="L238">                allowedTypes = setOf(IMAGE),</span>
<span class="nc" id="L239">                cameraSetup = HIDDEN,</span>
<span class="nc" id="L240">                systemPickerEnabled = false,</span>
<span class="nc" id="L241">                editingEnabled = false,</span>
<span class="nc" id="L242">                queueResults = false,</span>
<span class="nc" id="L243">                defaultSearchView = true,</span>
<span class="nc" id="L244">                title = R.string.photo_picker_stock_media</span>
        )
<span class="nc" id="L246">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L247">                activity,</span>
<span class="nc" id="L248">                mediaPickerSetup,</span>
<span class="nc" id="L249">                site</span>
        )
<span class="nc" id="L251">        activity.startActivityForResult(intent, requestCode)</span>
<span class="nc" id="L252">    }</span>

    fun showGifPickerForResult(
        activity: Activity,
        site: SiteModel,
        allowMultipleSelection: Boolean
    ) {
<span class="nc bnc" id="L259" title="All 2 branches missed.">        val requestCode = if (allowMultipleSelection) {</span>
<span class="nc" id="L260">            RequestCodes.GIF_PICKER_MULTI_SELECT</span>
        } else {
<span class="nc" id="L262">            RequestCodes.GIF_PICKER_SINGLE_SELECT</span>
        }
<span class="nc" id="L264">        val mediaPickerSetup = MediaPickerSetup(</span>
<span class="nc" id="L265">                primaryDataSource = GIF_LIBRARY,</span>
<span class="nc" id="L266">                availableDataSources = setOf(),</span>
<span class="nc" id="L267">                canMultiselect = allowMultipleSelection,</span>
<span class="nc" id="L268">                requiresStoragePermissions = false,</span>
<span class="nc" id="L269">                allowedTypes = setOf(IMAGE),</span>
<span class="nc" id="L270">                cameraSetup = HIDDEN,</span>
<span class="nc" id="L271">                systemPickerEnabled = false,</span>
<span class="nc" id="L272">                editingEnabled = false,</span>
<span class="nc" id="L273">                queueResults = false,</span>
<span class="nc" id="L274">                defaultSearchView = true,</span>
<span class="nc" id="L275">                title = R.string.photo_picker_gif</span>
        )
<span class="nc" id="L277">        val intent = MediaPickerActivity.buildIntent(</span>
<span class="nc" id="L278">                activity,</span>
<span class="nc" id="L279">                mediaPickerSetup,</span>
<span class="nc" id="L280">                site</span>
        )
<span class="nc" id="L282">        activity.startActivityForResult(intent, requestCode)</span>
<span class="nc" id="L283">    }</span>

    private fun buildLocalMediaPickerSetup(browserType: MediaBrowserType): MediaPickerSetup {
<span class="nc" id="L286">        val allowedTypes = mutableSetOf&lt;MediaType&gt;()</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (browserType.isImagePicker) {</span>
<span class="nc" id="L288">            allowedTypes.add(IMAGE)</span>
        }
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (browserType.isVideoPicker) {</span>
<span class="nc" id="L291">            allowedTypes.add(VIDEO)</span>
        }
<span class="nc bnc" id="L293" title="All 4 branches missed.">        val title = if (browserType.isImagePicker &amp;&amp; browserType.isVideoPicker) {</span>
<span class="nc" id="L294">            R.string.photo_picker_photo_or_video_title</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">        } else if (browserType.isVideoPicker) {</span>
<span class="nc" id="L296">            R.string.photo_picker_video_title</span>
        } else {
<span class="nc" id="L298">            R.string.photo_picker_title</span>
        }
<span class="nc" id="L300">        return MediaPickerSetup(</span>
<span class="nc" id="L301">                primaryDataSource = DEVICE,</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">                availableDataSources = if (browserType.isWPStoriesPicker) setOf(WP_LIBRARY) else setOf(),</span>
<span class="nc" id="L303">                canMultiselect = browserType.canMultiselect(),</span>
<span class="nc" id="L304">                requiresStoragePermissions = true,</span>
<span class="nc" id="L305">                allowedTypes = allowedTypes,</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                cameraSetup = if (browserType.isWPStoriesPicker) STORIES else HIDDEN,</span>
<span class="nc" id="L307">                systemPickerEnabled = true,</span>
<span class="nc" id="L308">                editingEnabled = browserType.isImagePicker,</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                queueResults = browserType == FEATURED_IMAGE_PICKER,</span>
<span class="nc" id="L310">                defaultSearchView = false,</span>
<span class="nc" id="L311">                title = title</span>
        )
    }

    private fun buildWPMediaLibraryPickerSetup(browserType: MediaBrowserType): MediaPickerSetup {
<span class="nc" id="L316">        val allowedTypes = mutableSetOf&lt;MediaType&gt;()</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (browserType.isImagePicker) {</span>
<span class="nc" id="L318">            allowedTypes.add(IMAGE)</span>
        }
<span class="nc bnc" id="L320" title="All 2 branches missed.">        if (browserType.isVideoPicker) {</span>
<span class="nc" id="L321">            allowedTypes.add(VIDEO)</span>
        }

<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (browserType.isAudioPicker) {</span>
<span class="nc" id="L325">            allowedTypes.add(AUDIO)</span>
        }

<span class="nc bnc" id="L328" title="All 2 branches missed.">        if (browserType.isDocumentPicker) {</span>
<span class="nc" id="L329">            allowedTypes.add(DOCUMENT)</span>
        }

<span class="nc" id="L332">        return MediaPickerSetup(</span>
<span class="nc" id="L333">                primaryDataSource = WP_LIBRARY,</span>
<span class="nc" id="L334">                availableDataSources = setOf(),</span>
<span class="nc" id="L335">                canMultiselect = browserType.canMultiselect(),</span>
<span class="nc" id="L336">                requiresStoragePermissions = false,</span>
<span class="nc" id="L337">                allowedTypes = allowedTypes,</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">                cameraSetup = if (browserType.isWPStoriesPicker) STORIES else HIDDEN,</span>
<span class="nc" id="L339">                systemPickerEnabled = false,</span>
<span class="nc" id="L340">                editingEnabled = false,</span>
<span class="nc" id="L341">                queueResults = false,</span>
<span class="nc" id="L342">                defaultSearchView = false,</span>
<span class="nc" id="L343">                title = R.string.wp_media_title</span>
        )
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>