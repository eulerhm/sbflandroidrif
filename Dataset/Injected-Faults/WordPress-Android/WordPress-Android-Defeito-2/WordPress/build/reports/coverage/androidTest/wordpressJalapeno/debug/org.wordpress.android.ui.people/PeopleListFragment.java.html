<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PeopleListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.people</a> &gt; <span class="el_source">PeopleListFragment.java</span></div><h1>PeopleListFragment.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.people;

import android.content.Context;
import android.content.res.TypedArray;
import android.graphics.Canvas;
import android.graphics.drawable.Drawable;
import android.graphics.drawable.InsetDrawable;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.ActionBar;
import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.Toolbar;
import androidx.core.view.ViewCompat;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.RecyclerView;
import androidx.recyclerview.widget.RecyclerView.ViewHolder;

import com.google.android.material.appbar.AppBarLayout;

import org.apache.commons.text.StringEscapeUtils;
import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.analytics.AnalyticsTracker;
import org.wordpress.android.analytics.AnalyticsTracker.Stat;
import org.wordpress.android.datasets.PeopleTable;
import org.wordpress.android.fluxc.model.RoleModel;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.fluxc.store.SiteStore;
import org.wordpress.android.models.FilterCriteria;
import org.wordpress.android.models.PeopleListFilter;
import org.wordpress.android.models.Person;
import org.wordpress.android.models.RoleUtils;
import org.wordpress.android.ui.ActionableEmptyView;
import org.wordpress.android.ui.EmptyViewMessageType;
import org.wordpress.android.ui.FilteredRecyclerView;
import org.wordpress.android.ui.prefs.AppPrefs;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.GravatarUtils;
import org.wordpress.android.util.NetworkUtils;
import org.wordpress.android.util.RtlUtils;
import org.wordpress.android.util.image.ImageManager;
import org.wordpress.android.util.image.ImageType;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import javax.inject.Inject;

<span class="nc" id="L61">public class PeopleListFragment extends Fragment {</span>
    private SiteModel mSite;
    private OnPersonSelectedListener mOnPersonSelectedListener;
    private OnFetchPeopleListener mOnFetchPeopleListener;
    private ActionableEmptyView mActionableEmptyView;
    private FilteredRecyclerView mFilteredRecyclerView;
    private PeopleListFilter mPeopleListFilter;

    @Inject SiteStore mSiteStore;
    @Inject ImageManager mImageManager;

    public static PeopleListFragment newInstance(SiteModel site) {
<span class="nc" id="L73">        PeopleListFragment peopleListFragment = new PeopleListFragment();</span>
<span class="nc" id="L74">        Bundle bundle = new Bundle();</span>
<span class="nc" id="L75">        bundle.putSerializable(WordPress.SITE, site);</span>
<span class="nc" id="L76">        peopleListFragment.setArguments(bundle);</span>
<span class="nc" id="L77">        return peopleListFragment;</span>
    }

    public void setOnPersonSelectedListener(OnPersonSelectedListener listener) {
<span class="nc" id="L81">        mOnPersonSelectedListener = listener;</span>
<span class="nc" id="L82">    }</span>

    public void setOnFetchPeopleListener(OnFetchPeopleListener listener) {
<span class="nc" id="L85">        mOnFetchPeopleListener = listener;</span>
<span class="nc" id="L86">    }</span>

    @Override
    public void onDetach() {
<span class="nc" id="L90">        super.onDetach();</span>
<span class="nc" id="L91">        mOnPersonSelectedListener = null;</span>
<span class="nc" id="L92">        mOnFetchPeopleListener = null;</span>
<span class="nc" id="L93">    }</span>

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L97">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L98">        ((WordPress) getActivity().getApplicationContext()).component().inject(this);</span>
<span class="nc" id="L99">    }</span>

    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="nc" id="L103">        inflater.inflate(R.menu.people_list, menu);</span>
<span class="nc" id="L104">        super.onCreateOptionsMenu(menu, inflater);</span>
<span class="nc" id="L105">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
<span class="nc" id="L109">        setHasOptionsMenu(true);</span>

<span class="nc" id="L111">        final ViewGroup rootView = (ViewGroup) inflater.inflate(R.layout.people_list_fragment, container, false);</span>

<span class="nc" id="L113">        Toolbar toolbar = rootView.findViewById(R.id.toolbar_main);</span>
<span class="nc" id="L114">        ((AppCompatActivity) getActivity()).setSupportActionBar(toolbar);</span>
<span class="nc" id="L115">        ActionBar actionBar = ((AppCompatActivity) getActivity()).getSupportActionBar();</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">        if (actionBar != null) {</span>
<span class="nc" id="L117">            actionBar.setHomeButtonEnabled(true);</span>
<span class="nc" id="L118">            actionBar.setDisplayHomeAsUpEnabled(true);</span>
<span class="nc" id="L119">            actionBar.setTitle(R.string.people);</span>
        }

<span class="nc" id="L122">        mSite = (SiteModel) getArguments().getSerializable(WordPress.SITE);</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">        final boolean isPrivate = mSite != null &amp;&amp; mSite.isPrivate();</span>

<span class="nc" id="L125">        mActionableEmptyView = rootView.findViewById(R.id.actionable_empty_view);</span>
<span class="nc" id="L126">        mFilteredRecyclerView = rootView.findViewById(R.id.filtered_recycler_view);</span>
<span class="nc" id="L127">        mFilteredRecyclerView</span>
<span class="nc" id="L128">                .addItemDecoration(new PeopleItemDecoration(getActivity()));</span>
<span class="nc" id="L129">        mFilteredRecyclerView.setLogT(AppLog.T.PEOPLE);</span>
<span class="nc" id="L130">        mFilteredRecyclerView.setSwipeToRefreshEnabled(false);</span>

        // the following will change the look and feel of the toolbar to match the current design
<span class="nc" id="L133">        mFilteredRecyclerView.setToolbarLeftAndRightPadding(</span>
<span class="nc" id="L134">                getResources().getDimensionPixelSize(R.dimen.margin_filter_spinner),</span>
<span class="nc" id="L135">                getResources().getDimensionPixelSize(R.dimen.margin_none));</span>

<span class="nc" id="L137">        mFilteredRecyclerView.setFilterListener(new FilteredRecyclerView.FilterListener() {</span>
            @Override
            public List&lt;FilterCriteria&gt; onLoadFilterCriteriaOptions(boolean refresh) {
<span class="nc" id="L140">                ArrayList&lt;FilterCriteria&gt; list = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L141">                Collections.addAll(list, PeopleListFilter.values());</span>
                // Only a private blog can have viewers
<span class="nc bnc" id="L143" title="All 2 branches missed.">                if (!isPrivate) {</span>
<span class="nc" id="L144">                    list.remove(PeopleListFilter.VIEWERS);</span>
                }
<span class="nc" id="L146">                return list;</span>
            }

            @Override
            public void onLoadFilterCriteriaOptionsAsync(
                    FilteredRecyclerView.FilterCriteriaAsyncLoaderListener listener, boolean refresh) {
                // no-op
<span class="nc" id="L153">            }</span>

            @Override
            public FilterCriteria onRecallSelection() {
<span class="nc" id="L157">                mPeopleListFilter = AppPrefs.getPeopleListFilter();</span>

                // if viewers is not available for this blog, set the filter to TEAM
<span class="nc bnc" id="L160" title="All 4 branches missed.">                if (mPeopleListFilter == PeopleListFilter.VIEWERS &amp;&amp; !isPrivate) {</span>
<span class="nc" id="L161">                    mPeopleListFilter = PeopleListFilter.TEAM;</span>
<span class="nc" id="L162">                    AppPrefs.setPeopleListFilter(mPeopleListFilter);</span>
                }
<span class="nc" id="L164">                return mPeopleListFilter;</span>
            }

            @Override
            public void onLoadData(boolean forced) {
<span class="nc" id="L169">                updatePeople(false);</span>
<span class="nc" id="L170">            }</span>

            @Override
            public void onFilterSelected(int position, FilterCriteria criteria) {
<span class="nc" id="L174">                AnalyticsTracker.track(Stat.PEOPLE_MANAGEMENT_FILTER_CHANGED);</span>
<span class="nc" id="L175">                mPeopleListFilter = (PeopleListFilter) criteria;</span>
<span class="nc" id="L176">                AppPrefs.setPeopleListFilter(mPeopleListFilter);</span>
<span class="nc" id="L177">            }</span>

            @Override
            public String onShowEmptyViewMessage(EmptyViewMessageType emptyViewMsgType) {
<span class="nc" id="L181">                mActionableEmptyView.setVisibility(View.GONE);</span>
<span class="nc" id="L182">                mFilteredRecyclerView.setToolbarScrollFlags(AppBarLayout.LayoutParams.SCROLL_FLAG_SCROLL);</span>

<span class="nc bnc" id="L184" title="All 5 branches missed.">                switch (emptyViewMsgType) {</span>
                    case LOADING:
<span class="nc" id="L186">                        return getString(R.string.people_fetching);</span>
                    case NETWORK_ERROR:
<span class="nc" id="L188">                        return getString(R.string.no_network_message);</span>
                    case NO_CONTENT:
<span class="nc" id="L190">                        String title = &quot;&quot;;</span>

<span class="nc bnc" id="L192" title="All 5 branches missed.">                        switch (mPeopleListFilter) {</span>
                            case TEAM:
<span class="nc" id="L194">                                title = getString(R.string.people_empty_list_filtered_users);</span>
<span class="nc" id="L195">                                break;</span>
                            case FOLLOWERS:
<span class="nc" id="L197">                                title = getString(R.string.people_empty_list_filtered_followers);</span>
<span class="nc" id="L198">                                break;</span>
                            case EMAIL_FOLLOWERS:
<span class="nc" id="L200">                                title = getString(R.string.people_empty_list_filtered_email_followers);</span>
<span class="nc" id="L201">                                break;</span>
                            case VIEWERS:
<span class="nc" id="L203">                                title = getString(R.string.people_empty_list_filtered_viewers);</span>
                                break;
                        }

<span class="nc" id="L207">                        mActionableEmptyView.title.setText(title);</span>
<span class="nc" id="L208">                        mActionableEmptyView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L209">                        mFilteredRecyclerView.setToolbarScrollFlags(0);</span>
<span class="nc" id="L210">                        return &quot;&quot;;</span>
                    case GENERIC_ERROR:
<span class="nc bnc" id="L212" title="All 5 branches missed.">                        switch (mPeopleListFilter) {</span>
                            case TEAM:
<span class="nc" id="L214">                                return getString(R.string.error_fetch_users_list);</span>
                            case FOLLOWERS:
<span class="nc" id="L216">                                return getString(R.string.error_fetch_followers_list);</span>
                            case EMAIL_FOLLOWERS:
<span class="nc" id="L218">                                return getString(R.string.error_fetch_email_followers_list);</span>
                            case VIEWERS:
<span class="nc" id="L220">                                return getString(R.string.error_fetch_viewers_list);</span>
                        }
                    default:
<span class="nc" id="L223">                        return &quot;&quot;;</span>
                }
            }

            @Override
            public void onShowCustomEmptyView(EmptyViewMessageType emptyViewMsgType) {
<span class="nc" id="L229">            }</span>
        });

<span class="nc" id="L232">        return rootView;</span>
    }

    @Override public void onViewCreated(View view, @Nullable Bundle savedInstanceState) {
<span class="nc" id="L236">        super.onViewCreated(view, savedInstanceState);</span>
        // important for accessibility - talkback
<span class="nc" id="L238">        getActivity().setTitle(R.string.people);</span>
<span class="nc" id="L239">    }</span>

    @Override
    public void onResume() {
<span class="nc" id="L243">        super.onResume();</span>

<span class="nc" id="L245">        updatePeople(false);</span>
<span class="nc" id="L246">    }</span>

    private void updatePeople(boolean loadMore) {
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (!NetworkUtils.isNetworkAvailable(getActivity())) {</span>
<span class="nc" id="L250">            mFilteredRecyclerView.updateEmptyView(EmptyViewMessageType.NETWORK_ERROR);</span>
<span class="nc" id="L251">            mFilteredRecyclerView.setRefreshing(false);</span>
<span class="nc" id="L252">            return;</span>
        }

<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (mOnFetchPeopleListener != null) {</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">            if (loadMore) {</span>
<span class="nc" id="L257">                boolean isFetching = mOnFetchPeopleListener.onFetchMorePeople(mPeopleListFilter);</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (isFetching) {</span>
<span class="nc" id="L259">                    mFilteredRecyclerView.showLoadingProgress();</span>
                }
<span class="nc" id="L261">            } else {</span>
<span class="nc" id="L262">                boolean isFetching = mOnFetchPeopleListener.onFetchFirstPage(mPeopleListFilter);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                if (isFetching) {</span>
<span class="nc" id="L264">                    mFilteredRecyclerView.updateEmptyView(EmptyViewMessageType.LOADING);</span>
                } else {
<span class="nc" id="L266">                    mFilteredRecyclerView.hideEmptyView();</span>
<span class="nc" id="L267">                    mFilteredRecyclerView.setRefreshing(false);</span>
                }
<span class="nc" id="L269">                refreshPeopleList(isFetching);</span>
            }
        }
<span class="nc" id="L272">    }</span>

    public void refreshPeopleList(boolean isFetching) {
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (!isAdded()) {</span>
<span class="nc" id="L276">            return;</span>
        }

        List&lt;Person&gt; peopleList;
<span class="nc bnc" id="L280" title="All 5 branches missed.">        switch (mPeopleListFilter) {</span>
            case TEAM:
<span class="nc" id="L282">                peopleList = PeopleTable.getUsers(mSite.getId());</span>
<span class="nc" id="L283">                break;</span>
            case FOLLOWERS:
<span class="nc" id="L285">                peopleList = PeopleTable.getFollowers(mSite.getId());</span>
<span class="nc" id="L286">                break;</span>
            case EMAIL_FOLLOWERS:
<span class="nc" id="L288">                peopleList = PeopleTable.getEmailFollowers(mSite.getId());</span>
<span class="nc" id="L289">                break;</span>
            case VIEWERS:
<span class="nc" id="L291">                peopleList = PeopleTable.getViewers(mSite.getId());</span>
<span class="nc" id="L292">                break;</span>
            default:
<span class="nc" id="L294">                peopleList = new ArrayList&lt;&gt;();</span>
                break;
        }
<span class="nc" id="L297">        PeopleAdapter peopleAdapter = (PeopleAdapter) mFilteredRecyclerView.getAdapter();</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (peopleAdapter == null) {</span>
<span class="nc" id="L299">            peopleAdapter = new PeopleAdapter(getActivity(), peopleList);</span>
<span class="nc" id="L300">            mFilteredRecyclerView.setAdapter(peopleAdapter);</span>
        } else {
<span class="nc" id="L302">            peopleAdapter.setPeopleList(peopleList);</span>
        }

<span class="nc bnc" id="L305" title="All 2 branches missed.">        if (!peopleList.isEmpty()) {</span>
            // if the list is not empty, don't show any message
<span class="nc" id="L307">            mFilteredRecyclerView.hideEmptyView();</span>
<span class="nc" id="L308">            mFilteredRecyclerView.setToolbarScrollFlags(AppBarLayout.LayoutParams.SCROLL_FLAG_SCROLL);</span>
<span class="nc" id="L309">            mActionableEmptyView.setVisibility(View.GONE);</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">        } else if (!isFetching) {</span>
            // if we are not fetching and list is empty, show no content message
<span class="nc" id="L312">            mFilteredRecyclerView.updateEmptyView(EmptyViewMessageType.NO_CONTENT);</span>
        }
<span class="nc" id="L314">    }</span>

    // Refresh the role display names after user roles is fetched
    public void refreshUserRoles() {
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (mFilteredRecyclerView == null) {</span>
            // bail when list is not available
<span class="nc" id="L320">            return;</span>
        }

<span class="nc" id="L323">        PeopleAdapter peopleAdapter = (PeopleAdapter) mFilteredRecyclerView.getAdapter();</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (peopleAdapter != null) {</span>
<span class="nc" id="L325">            peopleAdapter.refreshUserRoles();</span>
<span class="nc" id="L326">            peopleAdapter.notifyDataSetChanged();</span>
        }
<span class="nc" id="L328">    }</span>

    public void fetchingRequestFinished(PeopleListFilter filter, boolean isFirstPage, boolean isSuccessful) {
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (mPeopleListFilter == filter) {</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">            if (isFirstPage) {</span>
<span class="nc" id="L333">                mFilteredRecyclerView.setRefreshing(false);</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">                if (!isSuccessful) {</span>
<span class="nc" id="L335">                    mFilteredRecyclerView.updateEmptyView(EmptyViewMessageType.GENERIC_ERROR);</span>
                }
            } else {
<span class="nc" id="L338">                mFilteredRecyclerView.hideLoadingProgress();</span>
            }
        }
<span class="nc" id="L341">    }</span>

    // Container Activity must implement this interface
    public interface OnPersonSelectedListener {
        void onPersonSelected(Person person);
    }

    public interface OnFetchPeopleListener {
        boolean onFetchFirstPage(PeopleListFilter filter);

        boolean onFetchMorePeople(PeopleListFilter filter);
    }

    public class PeopleAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; {
        private final LayoutInflater mInflater;
        private List&lt;Person&gt; mPeopleList;
        private int mAvatarSz;
        private List&lt;RoleModel&gt; mUserRoles;

<span class="nc" id="L360">        public PeopleAdapter(Context context, List&lt;Person&gt; peopleList) {</span>
<span class="nc" id="L361">            mAvatarSz = context.getResources().getDimensionPixelSize(R.dimen.people_avatar_sz);</span>
<span class="nc" id="L362">            mInflater = LayoutInflater.from(context);</span>
<span class="nc" id="L363">            mPeopleList = peopleList;</span>
<span class="nc" id="L364">            setHasStableIds(true);</span>
<span class="nc" id="L365">            refreshUserRoles();</span>
<span class="nc" id="L366">        }</span>

        public void setPeopleList(List&lt;Person&gt; peopleList) {
<span class="nc" id="L369">            mPeopleList = peopleList;</span>
<span class="nc" id="L370">            notifyDataSetChanged();</span>
<span class="nc" id="L371">        }</span>

        public Person getPerson(int position) {
<span class="nc bnc" id="L374" title="All 2 branches missed.">            if (mPeopleList == null) {</span>
<span class="nc" id="L375">                return null;</span>
            }
<span class="nc" id="L377">            return mPeopleList.get(position);</span>
        }

        public void refreshUserRoles() {
<span class="nc bnc" id="L381" title="All 2 branches missed.">            if (mSite != null) {</span>
<span class="nc" id="L382">                mUserRoles = mSiteStore.getUserRoles(mSite);</span>
            }
<span class="nc" id="L384">        }</span>

        @Override
        public int getItemCount() {
<span class="nc bnc" id="L388" title="All 2 branches missed.">            if (mPeopleList == null) {</span>
<span class="nc" id="L389">                return 0;</span>
            }
<span class="nc" id="L391">            return mPeopleList.size();</span>
        }

        @Override
        public long getItemId(int position) {
<span class="nc" id="L396">            Person person = getPerson(position);</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">            if (person == null) {</span>
<span class="nc" id="L398">                return -1;</span>
            }
<span class="nc" id="L400">            return person.getPersonID();</span>
        }

        @NonNull
        @Override
        public PeopleViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
<span class="nc" id="L406">            View view = mInflater.inflate(R.layout.people_list_row, parent, false);</span>

<span class="nc" id="L408">            return new PeopleViewHolder(view);</span>
        }

        @Override
        public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {
<span class="nc" id="L413">            PeopleViewHolder peopleViewHolder = (PeopleViewHolder) holder;</span>
<span class="nc" id="L414">            final Person person = getPerson(position);</span>

<span class="nc bnc" id="L416" title="All 2 branches missed.">            if (person != null) {</span>
<span class="nc" id="L417">                String avatarUrl = GravatarUtils.fixGravatarUrl(person.getAvatarUrl(), mAvatarSz);</span>
<span class="nc" id="L418">                mImageManager.loadIntoCircle(peopleViewHolder.mImgAvatar, ImageType.AVATAR_WITH_BACKGROUND, avatarUrl);</span>
<span class="nc" id="L419">                peopleViewHolder.mTxtDisplayName.setText(StringEscapeUtils.unescapeHtml4(person.getDisplayName()));</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">                if (person.getRole() != null) {</span>
<span class="nc" id="L421">                    peopleViewHolder.mTxtRole.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L422">                    peopleViewHolder.mTxtRole.setText(RoleUtils.getDisplayName(person.getRole(), mUserRoles));</span>
                } else {
<span class="nc" id="L424">                    peopleViewHolder.mTxtRole.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L426" title="All 2 branches missed.">                if (!person.getUsername().isEmpty()) {</span>
<span class="nc" id="L427">                    peopleViewHolder.mTxtUsername.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L428">                    peopleViewHolder.mTxtUsername.setText(String.format(&quot;@%s&quot;, person.getUsername()));</span>
                } else {
<span class="nc" id="L430">                    peopleViewHolder.mTxtUsername.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L432" title="All 2 branches missed.">                if (person.getPersonType() == Person.PersonType.USER</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">                    || person.getPersonType() == Person.PersonType.VIEWER) {</span>
<span class="nc" id="L434">                    peopleViewHolder.mTxtSubscribed.setVisibility(View.GONE);</span>
                } else {
<span class="nc" id="L436">                    peopleViewHolder.mTxtSubscribed.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L437">                    String dateSubscribed = SimpleDateFormat.getDateInstance().format(person.getDateSubscribed());</span>
<span class="nc" id="L438">                    String dateText = getString(R.string.follower_subscribed_since, dateSubscribed);</span>
<span class="nc" id="L439">                    peopleViewHolder.mTxtSubscribed.setText(dateText);</span>
                }
            }

            // end of list is reached
<span class="nc bnc" id="L444" title="All 2 branches missed.">            if (position == getItemCount() - 1) {</span>
<span class="nc" id="L445">                updatePeople(true);</span>
            }
<span class="nc" id="L447">        }</span>

        @Override public void onViewRecycled(@NonNull ViewHolder holder) {
<span class="nc" id="L450">            super.onViewRecycled(holder);</span>
<span class="nc" id="L451">            PeopleViewHolder peopleViewHolder = (PeopleViewHolder) holder;</span>
<span class="nc" id="L452">        }</span>

        public class PeopleViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
            private final ImageView mImgAvatar;
            private final TextView mTxtDisplayName;
            private final TextView mTxtUsername;
            private final TextView mTxtRole;
            private final TextView mTxtSubscribed;

<span class="nc" id="L461">            public PeopleViewHolder(View view) {</span>
<span class="nc" id="L462">                super(view);</span>
<span class="nc" id="L463">                mImgAvatar = view.findViewById(R.id.person_avatar);</span>
<span class="nc" id="L464">                mTxtDisplayName = view.findViewById(R.id.person_display_name);</span>
<span class="nc" id="L465">                mTxtUsername = view.findViewById(R.id.person_username);</span>
<span class="nc" id="L466">                mTxtRole = view.findViewById(R.id.person_role);</span>
<span class="nc" id="L467">                mTxtSubscribed = view.findViewById(R.id.follower_subscribed_date);</span>

<span class="nc" id="L469">                itemView.setOnClickListener(this);</span>
<span class="nc" id="L470">            }</span>

            @Override
            public void onClick(View v) {
<span class="nc bnc" id="L474" title="All 2 branches missed.">                if (mOnPersonSelectedListener != null) {</span>
<span class="nc" id="L475">                    Person person = getPerson(getAdapterPosition());</span>
<span class="nc" id="L476">                    mOnPersonSelectedListener.onPersonSelected(person);</span>
                }
<span class="nc" id="L478">            }</span>
        }
    }

    // Taken from http://stackoverflow.com/a/27037230
    private class PeopleItemDecoration extends RecyclerView.ItemDecoration {
        private InsetDrawable mDivider;

        // use a custom drawable
<span class="nc" id="L487">        PeopleItemDecoration(Context context) {</span>
<span class="nc" id="L488">            int[] attrs = {android.R.attr.listDivider};</span>
<span class="nc" id="L489">            TypedArray ta = context.obtainStyledAttributes(attrs);</span>
<span class="nc" id="L490">            Drawable drawable = ta.getDrawable(0);</span>
<span class="nc" id="L491">            ta.recycle();</span>

<span class="nc" id="L493">            int inset = context.getResources().getDimensionPixelOffset(R.dimen.people_list_divider_left_margin);</span>

<span class="nc bnc" id="L495" title="All 2 branches missed.">            if (RtlUtils.isRtl(context)) {</span>
<span class="nc" id="L496">                mDivider = new InsetDrawable(drawable, 0, 0, inset, 0);</span>
            } else {
<span class="nc" id="L498">                mDivider = new InsetDrawable(drawable, inset, 0, 0, 0);</span>
            }
<span class="nc" id="L500">        }</span>

        @Override
        public void onDraw(@NotNull Canvas c, @NotNull RecyclerView parent, @NotNull RecyclerView.State state) {
<span class="nc" id="L504">            int left = ViewCompat.getPaddingStart(parent);</span>
<span class="nc" id="L505">            int right = parent.getWidth() - ViewCompat.getPaddingEnd(parent);</span>

<span class="nc" id="L507">            int childCount = parent.getChildCount();</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">            for (int i = 0; i &lt; childCount; i++) {</span>
<span class="nc" id="L509">                View child = parent.getChildAt(i);</span>

<span class="nc" id="L511">                RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child.getLayoutParams();</span>

<span class="nc" id="L513">                int top = child.getBottom() + params.bottomMargin;</span>
<span class="nc" id="L514">                int bottom = top + mDivider.getIntrinsicHeight();</span>

<span class="nc" id="L516">                mDivider.setBounds(left, top, right, bottom);</span>
<span class="nc" id="L517">                mDivider.draw(c);</span>
            }
<span class="nc" id="L519">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>