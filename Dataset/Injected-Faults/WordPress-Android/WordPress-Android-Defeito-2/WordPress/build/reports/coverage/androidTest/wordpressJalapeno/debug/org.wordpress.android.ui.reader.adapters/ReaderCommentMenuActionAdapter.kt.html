<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderCommentMenuActionAdapter.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.adapters</a> &gt; <span class="el_source">ReaderCommentMenuActionAdapter.kt</span></div><h1>ReaderCommentMenuActionAdapter.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.adapters

import android.content.Context
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.BaseAdapter
import android.widget.ImageView
import android.widget.TextView
import androidx.annotation.DrawableRes
import androidx.core.content.ContextCompat
import org.wordpress.android.R
import org.wordpress.android.R.id
import org.wordpress.android.R.layout
import org.wordpress.android.ui.reader.adapters.ReaderCommentMenuActionAdapter.ReaderCommentMenuActionType.DIVIDER_NO_ACTION
import org.wordpress.android.ui.reader.adapters.ReaderCommentMenuActionAdapter.ReaderCommentMenuItem.PrimaryItemMenu
import org.wordpress.android.ui.utils.UiHelpers
import org.wordpress.android.ui.utils.UiString
import org.wordpress.android.util.extensions.getColorStateListFromAttribute

// Based on Reader card menu
<span class="nc" id="L22">class ReaderCommentMenuActionAdapter(</span>
    context: Context?,
<span class="nc" id="L24">    val uiHelpers: UiHelpers,</span>
<span class="nc" id="L25">    val menuItems: List&lt;ReaderCommentMenuItem&gt;</span>
<span class="nc" id="L26">) : BaseAdapter() {</span>
<span class="nc" id="L27">    private val inflater: LayoutInflater = LayoutInflater.from(context)</span>

    override fun getCount(): Int {
<span class="nc" id="L30">        return menuItems.size</span>
    }

    override fun getItem(position: Int): Any {
<span class="nc" id="L34">        return menuItems[position]</span>
    }

    override fun getItemId(position: Int): Long {
<span class="nc" id="L38">        return menuItems[position].type.ordinal.toLong()</span>
    }

    override fun getViewTypeCount(): Int {
<span class="nc" id="L42">        return 2</span>
    }

    override fun getItemViewType(position: Int): Int {
<span class="nc bnc" id="L46" title="All 2 branches missed.">        return if (menuItems[position].type === DIVIDER_NO_ACTION) {</span>
<span class="nc" id="L47">            TYPE_SPACER</span>
        } else {
<span class="nc" id="L49">            TYPE_CONTENT</span>
        }
    }

    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
<span class="nc" id="L54">        val cardAction = menuItems[position]</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">        return if (getItemViewType(position) == TYPE_SPACER) {</span>
<span class="nc" id="L56">            handleSpacer(convertView, parent)</span>
        } else {
<span class="nc" id="L58">            handleAction(</span>
<span class="nc" id="L59">                    cardAction as PrimaryItemMenu,</span>
<span class="nc" id="L60">                    convertView,</span>
<span class="nc" id="L61">                    parent</span>
            )
        }
    }

    private fun handleSpacer(convertView: View?, parent: ViewGroup): View {
<span class="nc" id="L67">        var innerConvertView = convertView</span>
        val holder: ReaderCommentMenuSpacerHolder
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (innerConvertView == null) {</span>
<span class="nc" id="L70">            innerConvertView = inflater.inflate(layout.popup_menu_divider, parent, false)</span>
<span class="nc" id="L71">            holder = ReaderCommentMenuSpacerHolder(innerConvertView)</span>
<span class="nc" id="L72">            innerConvertView.tag = holder</span>
        } else {
<span class="nc bnc" id="L74" title="All 2 branches missed.">            holder = innerConvertView.tag as ReaderCommentMenuSpacerHolder</span>
        }
<span class="nc" id="L76">        holder.spacer.visibility = View.VISIBLE</span>
<span class="nc" id="L77">        holder.spacer.isEnabled = false</span>
<span class="nc" id="L78">        holder.spacer.isClickable = false</span>
<span class="nc" id="L79">        return innerConvertView!!</span>
    }

    private fun handleAction(
        item: PrimaryItemMenu,
        convertView: View?,
        parent: ViewGroup
    ): View {
<span class="nc" id="L87">        var innerConvertView = convertView</span>
        val holder: ReaderCommentMenuHolder
<span class="nc bnc" id="L89" title="All 2 branches missed.">        if (innerConvertView == null) {</span>
<span class="nc" id="L90">            innerConvertView = inflater.inflate(layout.reader_popup_menu_item, parent, false)</span>
<span class="nc" id="L91">            holder = ReaderCommentMenuHolder(innerConvertView)</span>
<span class="nc" id="L92">            innerConvertView.tag = holder</span>
        } else {
<span class="nc bnc" id="L94" title="All 2 branches missed.">            holder = innerConvertView.tag as ReaderCommentMenuHolder</span>
        }
<span class="nc" id="L96">        val textRes = uiHelpers.getTextOfUiString(innerConvertView!!.context, item.labelResId)</span>
<span class="nc" id="L97">        val iconRes = item.iconRes</span>
<span class="nc" id="L98">        holder.text.text = textRes</span>
<span class="nc" id="L99">        holder.icon.setImageDrawable(ContextCompat.getDrawable(holder.icon.context, iconRes))</span>
<span class="nc" id="L100">        holder.icon.imageTintList = holder.icon.context.getColorStateListFromAttribute(R.attr.wpColorOnSurfaceMedium)</span>
<span class="nc" id="L101">        return innerConvertView</span>
    }

<span class="nc" id="L104">    internal inner class ReaderCommentMenuHolder(view: View) {</span>
<span class="nc" id="L105">        val text: TextView = view.findViewById(id.text)</span>
<span class="nc" id="L106">        val icon: ImageView = view.findViewById(id.image)</span>
    }

<span class="nc" id="L109">    internal inner class ReaderCommentMenuSpacerHolder(view: View) {</span>
<span class="nc" id="L110">        val spacer: View = view.findViewById(id.divider)</span>
    }

    sealed class ReaderCommentMenuItem {
        abstract val type: ReaderCommentMenuActionType

<span class="nc" id="L116">        data class PrimaryItemMenu(</span>
<span class="nc" id="L117">            override val type: ReaderCommentMenuActionType,</span>
<span class="nc" id="L118">            val labelResId: UiString,</span>
<span class="nc" id="L119">            val contentDescription: UiString? = null,</span>
<span class="nc" id="L120">            @DrawableRes val iconRes: Int</span>
<span class="nc" id="L121">        ) : ReaderCommentMenuItem()</span>

<span class="nc" id="L123">        data class Divider(</span>
<span class="nc" id="L124">            override val type: ReaderCommentMenuActionType = DIVIDER_NO_ACTION</span>
<span class="nc" id="L125">        ) : ReaderCommentMenuItem()</span>
    }

    enum class ReaderCommentMenuActionType {
<span class="nc" id="L129">        APPROVE, UNAPPROVE, SPAM, TRASH, EDIT, SHARE, DIVIDER_NO_ACTION</span>
    }

    companion object {
        private const val TYPE_SPACER = 0
        private const val TYPE_CONTENT = 1
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>