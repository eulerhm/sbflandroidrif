<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReblogUseCase.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.reblog</a> &gt; <span class="el_source">ReblogUseCase.kt</span></div><h1>ReblogUseCase.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.reblog

import dagger.Reusable
import kotlinx.coroutines.CoroutineDispatcher
import kotlinx.coroutines.withContext
import org.wordpress.android.fluxc.model.SiteModel
import org.wordpress.android.fluxc.store.SiteStore
import org.wordpress.android.models.ReaderPost
import org.wordpress.android.modules.BG_THREAD
import org.wordpress.android.ui.PagePostCreationSourcesDetail.POST_FROM_REBLOG
import org.wordpress.android.ui.main.SitePickerAdapter.SitePickerMode.REBLOG_SELECT_MODE
import org.wordpress.android.ui.reader.discover.ReaderNavigationEvents
import org.wordpress.android.ui.reader.discover.ReaderNavigationEvents.OpenEditorForReblog
import org.wordpress.android.ui.reader.discover.ReaderNavigationEvents.ShowNoSitesToReblog
import org.wordpress.android.ui.reader.discover.ReaderNavigationEvents.ShowSitePickerForResult
import org.wordpress.android.ui.reader.reblog.ReblogState.MultipleSites
import org.wordpress.android.ui.reader.reblog.ReblogState.NoSite
import org.wordpress.android.ui.reader.reblog.ReblogState.SingleSite
import org.wordpress.android.ui.reader.reblog.ReblogState.Unknown
import org.wordpress.android.util.AppLog
import org.wordpress.android.util.AppLog.T
import org.wordpress.android.util.BuildConfig
import javax.inject.Inject
import javax.inject.Named

<span class="nc" id="L26">@Reusable</span>
<span class="nc" id="L27">class ReblogUseCase @Inject constructor(</span>
<span class="nc" id="L28">    private val siteStore: SiteStore,</span>
<span class="nc" id="L29">    @Named(BG_THREAD) private val bgDispatcher: CoroutineDispatcher</span>
) {
    suspend fun onReblogButtonClicked(post: ReaderPost): ReblogState {
<span class="nc bnc" id="L32" title="All 2 branches missed.">        return withContext(bgDispatcher) {</span>
<span class="nc" id="L33">            val sites = siteStore.visibleSitesAccessedViaWPCom</span>

<span class="nc bnc" id="L35" title="All 3 branches missed.">            when (sites.count()) {</span>
<span class="nc" id="L36">                0 -&gt; NoSite</span>
                1 -&gt; {
<span class="nc bnc" id="L38" title="All 4 branches missed.">                    sites.firstOrNull()?.let {</span>
<span class="nc" id="L39">                        SingleSite(it, post)</span>
<span class="nc" id="L40">                    } ?: Unknown</span>
                }
                else -&gt; {
<span class="nc bnc" id="L43" title="All 4 branches missed.">                    sites.firstOrNull()?.let {</span>
<span class="nc" id="L44">                        MultipleSites(it, post)</span>
<span class="nc" id="L45">                    } ?: Unknown</span>
                }
            }
        }
    }

    suspend fun onReblogSiteSelected(siteLocalId: Int, post: ReaderPost?): ReblogState {
<span class="nc bnc" id="L52" title="All 2 branches missed.">        return withContext(bgDispatcher) {</span>
<span class="nc" id="L53">            when {</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">                post != null -&gt; {</span>
<span class="nc" id="L55">                    val site: SiteModel? = siteStore.getSiteByLocalId(siteLocalId)</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">                    if (site != null) SingleSite(site, post) else Unknown</span>
                }
<span class="nc" id="L58">                BuildConfig.DEBUG -&gt; {</span>
                    throw IllegalStateException(&quot;Site Selected without passing the SitePicker state&quot;)
                }
                else -&gt; {
<span class="nc" id="L62">                    AppLog.e(T.READER, &quot;Site Selected without passing the SitePicker state&quot;)</span>
<span class="nc" id="L63">                    Unknown</span>
                }
            }
        }
    }

    fun convertReblogStateToNavigationEvent(state: ReblogState): ReaderNavigationEvents? {
<span class="nc" id="L70">        return when (state) {</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">            is NoSite -&gt; ShowNoSitesToReblog</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            is MultipleSites -&gt; ShowSitePickerForResult(state.defaultSite, state.post, REBLOG_SELECT_MODE)</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">            is SingleSite -&gt; OpenEditorForReblog(state.site, state.post, POST_FROM_REBLOG)</span>
<span class="nc" id="L74">            Unknown -&gt; null</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>