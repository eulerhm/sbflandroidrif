<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.utils</a> &gt; <span class="el_source">ReaderUtils.java</span></div><h1>ReaderUtils.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.utils;

import android.content.Context;
import android.net.Uri;
import android.text.TextUtils;
import android.view.View;

import androidx.annotation.NonNull;

import org.apache.commons.text.StringEscapeUtils;
import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.datasets.ReaderCommentTable;
import org.wordpress.android.datasets.ReaderPostTable;
import org.wordpress.android.datasets.ReaderTagTable;
import org.wordpress.android.models.ReaderTag;
import org.wordpress.android.models.ReaderTagList;
import org.wordpress.android.models.ReaderTagType;
import org.wordpress.android.ui.FilteredRecyclerView;
import org.wordpress.android.ui.reader.ReaderConstants;
import org.wordpress.android.ui.reader.services.update.TagUpdateClientUtilsProvider;
import org.wordpress.android.util.FormatUtils;
import org.wordpress.android.util.LocaleManager;
import org.wordpress.android.util.PhotonUtils;
import org.wordpress.android.util.StringUtils;
import org.wordpress.android.util.UrlUtils;

import java.net.URI;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

<span class="nc" id="L37">public class ReaderUtils {</span>
    public static String getResizedImageUrl(final String imageUrl, int width, int height, boolean isPrivate,
                                            boolean isPrivateAtomic) {
<span class="nc" id="L40">        return getResizedImageUrl(imageUrl, width, height, isPrivate, isPrivateAtomic, PhotonUtils.Quality.MEDIUM);</span>
    }

    public static String getResizedImageUrl(final String imageUrl,
                                            int width,
                                            int height,
                                            boolean isPrivate,
                                            boolean isPrivateAtomic,
                                            PhotonUtils.Quality quality) {
<span class="nc" id="L49">        final String unescapedUrl = StringEscapeUtils.unescapeHtml4(imageUrl);</span>


<span class="nc bnc" id="L52" title="All 4 branches missed.">        if (isPrivate &amp;&amp; !isPrivateAtomic) {</span>
<span class="nc" id="L53">            return getImageForDisplayWithoutPhoton(unescapedUrl, width, height, true);</span>
        } else {
<span class="nc" id="L55">            return PhotonUtils.getPhotonImageUrl(unescapedUrl, width, height, quality, isPrivateAtomic);</span>
        }
    }

    public static String getResizedImageUrl(final String imageUrl,
                                            int width,
                                            int height,
                                            SiteAccessibilityInfo siteAccessibilityInfo) {
<span class="nc" id="L63">        return getResizedImageUrl(imageUrl, width, height, siteAccessibilityInfo, PhotonUtils.Quality.MEDIUM);</span>
    }

    public static String getResizedImageUrl(final String imageUrl,
                                            int width,
                                            int height,
                                            SiteAccessibilityInfo siteAccessibilityInfo,
                                            PhotonUtils.Quality quality) {
<span class="nc" id="L71">        final String unescapedUrl = StringEscapeUtils.unescapeHtml4(imageUrl);</span>

<span class="nc bnc" id="L73" title="All 2 branches missed.">        if (siteAccessibilityInfo.isPhotonCapable()) {</span>
<span class="nc" id="L74">            return PhotonUtils.getPhotonImageUrl(</span>
                    unescapedUrl,
                    width,
                    height,
                    quality,
<span class="nc bnc" id="L79" title="All 2 branches missed.">                    siteAccessibilityInfo.getSiteVisibility() == SiteVisibility.PRIVATE_ATOMIC</span>
            );
        } else {
<span class="nc" id="L82">            return getImageForDisplayWithoutPhoton(</span>
                    unescapedUrl,
                    width,
                    height,
<span class="nc bnc" id="L86" title="All 2 branches missed.">                    siteAccessibilityInfo.getSiteVisibility() == SiteVisibility.PRIVATE</span>
            );
        }
    }

    /*
     * use this to request a reduced size image from not photon capable sites
     * (i.e. a private post - images in private posts can't use photon
     * but these are usually wp images so they support the h= and w= query params)
     */
    private static String getImageForDisplayWithoutPhoton(
            final String imageUrl,
            int width,
            int height,
            boolean forceHttps
    ) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (TextUtils.isEmpty(imageUrl)) {</span>
<span class="nc" id="L103">            return &quot;&quot;;</span>
        }

        final String query;
<span class="nc bnc" id="L107" title="All 4 branches missed.">        if (width &gt; 0 &amp;&amp; height &gt; 0) {</span>
<span class="nc" id="L108">            query = &quot;?w=&quot; + width + &quot;&amp;h=&quot; + height;</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">        } else if (width &gt; 0) {</span>
<span class="nc" id="L110">            query = &quot;?w=&quot; + width;</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">        } else if (height &gt; 0) {</span>
<span class="nc" id="L112">            query = &quot;?h=&quot; + height;</span>
        } else {
<span class="nc" id="L114">            query = &quot;&quot;;</span>
        }

<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (forceHttps) {</span>
            // remove the existing query string, add the new one, and make sure the url is https:
<span class="nc" id="L119">            return UrlUtils.removeQuery(UrlUtils.makeHttps(imageUrl)) + query;</span>
        } else {
            // remove the existing query string, add the new one
<span class="nc" id="L122">            return UrlUtils.removeQuery(imageUrl) + query;</span>
        }
    }

    /*
     * returns the passed string formatted for use with our API - see sanitize_title_with_dashes
     * https://git.io/JqUEP
     * http://stackoverflow.com/a/1612015/1673548
     */
    public static String sanitizeWithDashes(final String title) {
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (title == null) {</span>
<span class="nc" id="L133">            return &quot;&quot;;</span>
        }

<span class="nc" id="L136">        String trimmedTitle = title.trim();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (isValidUrlEncodedString(trimmedTitle)) {</span>
<span class="nc" id="L138">            return trimmedTitle;</span>
        } else {
<span class="nc" id="L140">            return trimmedTitle</span>
<span class="nc" id="L141">                        .replaceAll(&quot;&amp;[^\\s]*;&quot;, &quot;&quot;) // remove html entities</span>
<span class="nc" id="L142">                        .replaceAll(&quot;[\\.\\s]+&quot;, &quot;-&quot;) // replace periods and whitespace with a dash</span>
<span class="nc" id="L143">                        .replaceAll(&quot;[^\\p{L}\\p{Nd}\\-]+&quot;,</span>
                                &quot;&quot;) // remove remaining non-alphanum/non-dash chars (Unicode aware)
<span class="nc" id="L145">                        .replaceAll(&quot;--&quot;, &quot;-&quot;); // reduce double dashes potentially added above</span>
        }
    }

    @NonNull
    private static boolean isValidUrlEncodedString(String title) {
        try {
<span class="nc" id="L152">            URI.create(title);</span>
<span class="nc" id="L153">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L154">            return false;</span>
<span class="nc" id="L155">        }</span>
<span class="nc" id="L156">        return true;</span>
    }

    /*
     * returns the long text to use for a like label (&quot;Liked by 3 people&quot;, etc.)
     */
    public static String getLongLikeLabelText(Context context, int numLikes, boolean isLikedByCurrentUser) {
<span class="nc bnc" id="L163" title="All 2 branches missed.">        if (isLikedByCurrentUser) {</span>
<span class="nc bnc" id="L164" title="All 3 branches missed.">            switch (numLikes) {</span>
                case 1:
<span class="nc" id="L166">                    return context.getString(R.string.reader_likes_only_you);</span>
                case 2:
<span class="nc" id="L168">                    return context.getString(R.string.reader_likes_you_and_one);</span>
                default:
<span class="nc" id="L170">                    String youAndMultiLikes = context.getString(R.string.reader_likes_you_and_multi);</span>
<span class="nc" id="L171">                    return String.format(</span>
<span class="nc" id="L172">                            LocaleManager.getSafeLocale(context), youAndMultiLikes, numLikes - 1);</span>
            }
        } else {
<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (numLikes == 1) {</span>
<span class="nc" id="L176">                return context.getString(R.string.reader_likes_one);</span>
            } else {
<span class="nc" id="L178">                String likes = context.getString(R.string.reader_likes_multi);</span>
<span class="nc" id="L179">                return String.format(LocaleManager.getSafeLocale(context), likes, numLikes);</span>
            }
        }
    }

    /*
     * short like text (&quot;1 like,&quot; &quot;5 likes,&quot; etc.)
     */
    public static String getShortLikeLabelText(Context context, int numLikes) {
<span class="nc bnc" id="L188" title="All 3 branches missed.">        switch (numLikes) {</span>
            case 0:
<span class="nc" id="L190">                return context.getString(R.string.reader_short_like_count_none);</span>
            case 1:
<span class="nc" id="L192">                return context.getString(R.string.reader_short_like_count_one);</span>
            default:
<span class="nc" id="L194">                String count = FormatUtils.formatInt(numLikes);</span>
<span class="nc" id="L195">                return String.format(context.getString(R.string.reader_short_like_count_multi), count);</span>
        }
    }

    public static String getShortCommentLabelText(Context context, int numComments) {
<span class="nc bnc" id="L200" title="All 2 branches missed.">        switch (numComments) {</span>
            case 1:
<span class="nc" id="L202">                return context.getString(R.string.reader_short_comment_count_one);</span>
            default:
<span class="nc" id="L204">                String count = FormatUtils.formatInt(numComments);</span>
<span class="nc" id="L205">                return String.format(context.getString(R.string.reader_short_comment_count_multi), count);</span>
        }
    }

    public static String getTextForCommentSnippet(Context context, int numComments) {
<span class="nc bnc" id="L210" title="All 3 branches missed.">        switch (numComments) {</span>
            case 0:
<span class="nc" id="L212">                return context.getString(R.string.comments);</span>
            case 1:
<span class="nc" id="L214">                return context.getString(R.string.reader_short_comment_count_one);</span>
            default:
<span class="nc" id="L216">                String count = FormatUtils.formatInt(numComments);</span>
<span class="nc" id="L217">                return String.format(context.getString(R.string.reader_short_comment_count_multi), count);</span>
        }
    }

    /*
     * returns true if a ReaderPost and ReaderComment exist for the passed Ids
     */
    public static boolean postAndCommentExists(long blogId, long postId, long commentId) {
<span class="nc bnc" id="L225" title="All 2 branches missed.">        return ReaderPostTable.postExists(blogId, postId)</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">               &amp;&amp; ReaderCommentTable.commentExists(blogId, postId, commentId);</span>
    }

    /*
     * used by Discover site picks to add a &quot;Visit [BlogName]&quot; link which shows the
     * native blog preview for that blog
     */
    public static String makeBlogPreviewUrl(long blogId) {
<span class="nc" id="L234">        return &quot;wordpress://blogpreview?blogId=&quot; + Long.toString(blogId);</span>
    }

    public static boolean isBlogPreviewUrl(String url) {
<span class="nc bnc" id="L238" title="All 4 branches missed.">        return (url != null &amp;&amp; url.startsWith(&quot;wordpress://blogpreview&quot;));</span>
    }

    public static long getBlogIdFromBlogPreviewUrl(String url) {
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (isBlogPreviewUrl(url)) {</span>
<span class="nc" id="L243">            String strBlogId = Uri.parse(url).getQueryParameter(&quot;blogId&quot;);</span>
<span class="nc" id="L244">            return StringUtils.stringToLong(strBlogId);</span>
        } else {
<span class="nc" id="L246">            return 0;</span>
        }
    }

    /*
     * returns the passed string prefixed with a &quot;#&quot; if it's non-empty and isn't already
     * prefixed with a &quot;#&quot;
     */
    public static String makeHashTag(String tagName) {
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (TextUtils.isEmpty(tagName)) {</span>
<span class="nc" id="L256">            return &quot;&quot;;</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">        } else if (tagName.startsWith(&quot;#&quot;)) {</span>
<span class="nc" id="L258">            return tagName;</span>
        } else {
<span class="nc" id="L260">            return &quot;#&quot; + tagName;</span>
        }
    }

    /*
     * set the background of the passed view to the round ripple drawable - only works on
     * Lollipop or later, does nothing on earlier Android versions
     */
    public static void setBackgroundToRoundRipple(View view) {
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (view != null) {</span>
<span class="nc" id="L270">            view.setBackgroundResource(R.drawable.ripple_oval);</span>
        }
<span class="nc" id="L272">    }</span>

    /*
     * returns a tag object from the passed endpoint if tag is in database, otherwise null
     */
    public static ReaderTag getTagFromEndpoint(String endpoint) {
<span class="nc" id="L278">        return ReaderTagTable.getTagFromEndpoint(endpoint);</span>
    }

    /*
     * returns a tag object from the passed tag name - first checks for it in the tag db
     * (so we can also get its title &amp; endpoint), returns a new tag if that fails
     */
    public static ReaderTag getTagFromTagName(String tagName, ReaderTagType tagType) {
<span class="nc" id="L286">        return getTagFromTagName(tagName, tagType, false);</span>
    }

    public static ReaderTag getTagFromTagName(String tagName, ReaderTagType tagType, boolean markDefaultIfInMemory) {
<span class="nc" id="L290">        ReaderTag tag = ReaderTagTable.getTag(tagName, tagType);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (tag != null) {</span>
<span class="nc" id="L292">            return tag;</span>
        } else {
<span class="nc" id="L294">            return createTagFromTagName(tagName, tagType, markDefaultIfInMemory);</span>
        }
    }

    public static ReaderTag createTagFromTagName(String tagName, ReaderTagType tagType) {
<span class="nc" id="L299">        return createTagFromTagName(tagName, tagType, false);</span>
    }

    public static ReaderTag createTagFromTagName(String tagName, ReaderTagType tagType, boolean isDefaultInMemoryTag) {
<span class="nc" id="L303">        String tagSlug = sanitizeWithDashes(tagName).toLowerCase(Locale.ROOT);</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">        String tagDisplayName = tagType == ReaderTagType.DEFAULT ? tagName : tagSlug;</span>
<span class="nc" id="L305">        return new ReaderTag(</span>
                tagSlug,
                tagDisplayName,
                tagName,
                null,
                tagType,
                isDefaultInMemoryTag
        );
    }

    /*
     * returns the default tag, which is the one selected by default in the reader when
     * the user hasn't already chosen one
     */
    public static ReaderTag getDefaultTag() {
<span class="nc" id="L320">        ReaderTag defaultTag = getTagFromEndpoint(ReaderTag.TAG_ENDPOINT_DEFAULT);</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (defaultTag == null) {</span>
<span class="nc" id="L322">            defaultTag = getTagFromTagName(ReaderTag.TAG_TITLE_DEFAULT, ReaderTagType.DEFAULT, true);</span>
        }
<span class="nc" id="L324">        return defaultTag;</span>
    }

    public static @NonNull ReaderTag getDefaultTagFromDbOrCreateInMemory(
            @NonNull Context context,
            TagUpdateClientUtilsProvider clientUtilsProvider
    ) {
        // getDefaultTag() tries to get the default tag from reader db by tag endpoint or tag name.
        // In case it cannot get the default tag from db, it creates it in memory with createTagFromTagName
<span class="nc" id="L333">        ReaderTag tag = getDefaultTag();</span>

<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (tag.isDefaultInMemoryTag()) {</span>
            // if the tag was created in memory from createTagFromTagName
            // we need to set some fields as below before to use it
<span class="nc" id="L338">            tag.setTagTitle(context.getString(R.string.reader_following_display_name));</span>
<span class="nc" id="L339">            tag.setTagDisplayName(context.getString(R.string.reader_following_display_name));</span>

<span class="nc" id="L341">            String baseUrl = clientUtilsProvider.getTagUpdateEndpointURL();</span>

<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (baseUrl.endsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L344">                baseUrl = baseUrl.substring(0, baseUrl.length() - 1);</span>
            }

<span class="nc" id="L347">            tag.setEndpoint(baseUrl + ReaderTag.FOLLOWING_PATH);</span>
        }

<span class="nc" id="L350">        return tag;</span>
    }

    /*
     * used when storing search results in the reader post table
     */
    public static ReaderTag getTagForSearchQuery(@NonNull String query) {
<span class="nc bnc" id="L357" title="All 2 branches missed.">        String trimQuery = query != null ? query.trim() : &quot;&quot;;</span>
<span class="nc" id="L358">        String slug = ReaderUtils.sanitizeWithDashes(trimQuery);</span>
<span class="nc" id="L359">        return new ReaderTag(slug, trimQuery, trimQuery, null, ReaderTagType.SEARCH);</span>
    }

    public static Map&lt;String, TagInfo&gt; getDefaultTagInfo() {
        // Note that the following is the desired order in the tabs
        // (see usage in prependDefaults)
<span class="nc" id="L365">        Map&lt;String, TagInfo&gt; defaultTagInfo = new LinkedHashMap&lt;&gt;();</span>

<span class="nc" id="L367">        defaultTagInfo.put(ReaderConstants.KEY_FOLLOWING, new TagInfo(ReaderTagType.DEFAULT, ReaderTag.FOLLOWING_PATH));</span>
<span class="nc" id="L368">        defaultTagInfo.put(ReaderConstants.KEY_DISCOVER, new TagInfo(ReaderTagType.DEFAULT, ReaderTag.DISCOVER_PATH));</span>
<span class="nc" id="L369">        defaultTagInfo.put(ReaderConstants.KEY_LIKES, new TagInfo(ReaderTagType.DEFAULT, ReaderTag.LIKED_PATH));</span>
<span class="nc" id="L370">        defaultTagInfo.put(ReaderConstants.KEY_SAVED, new TagInfo(ReaderTagType.BOOKMARKED, &quot;&quot;));</span>

<span class="nc" id="L372">        return defaultTagInfo;</span>
    }

    private static boolean putIfAbsentDone(Map&lt;String, ReaderTag&gt; defaultTags, String key, ReaderTag tag) {
<span class="nc" id="L376">        boolean insertionDone = false;</span>

<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (defaultTags.get(key) == null) {</span>
<span class="nc" id="L379">            defaultTags.put(key, tag);</span>
<span class="nc" id="L380">            insertionDone = true;</span>
        }

<span class="nc" id="L383">        return insertionDone;</span>
    }

    private static void prependDefaults(
            Map&lt;String, ReaderTag&gt; defaultTags,
            ReaderTagList orderedTagList,
            Map&lt;String, TagInfo&gt; defaultTagInfo
    ) {
<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (defaultTags.isEmpty()) return;</span>

<span class="nc" id="L393">        List&lt;String&gt; reverseOrderedKeys = new ArrayList&lt;&gt;(defaultTagInfo.keySet());</span>
<span class="nc" id="L394">        Collections.reverse(reverseOrderedKeys);</span>

<span class="nc bnc" id="L396" title="All 2 branches missed.">        for (String key : reverseOrderedKeys) {</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">            if (defaultTags.containsKey(key)) {</span>
<span class="nc" id="L398">                ReaderTag tag = defaultTags.get(key);</span>

<span class="nc" id="L400">                orderedTagList.add(0, tag);</span>
            }
<span class="nc" id="L402">        }</span>
<span class="nc" id="L403">    }</span>

    private static boolean defaultTagFoundAndAdded(
            Map&lt;String, TagInfo&gt; defaultTagInfos,
            ReaderTag tag,
            Map&lt;String, ReaderTag&gt; defaultTags
    ) {
<span class="nc" id="L410">        boolean foundAndAdded = false;</span>

<span class="nc bnc" id="L412" title="All 2 branches missed.">        for (String key : defaultTagInfos.keySet()) {</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (defaultTagInfos.get(key).isDesiredTag(tag)) {</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">                if (putIfAbsentDone(defaultTags, key, tag)) {</span>
<span class="nc" id="L415">                    foundAndAdded = true;</span>
                }
                break;
            }
<span class="nc" id="L419">        }</span>

<span class="nc" id="L421">        return foundAndAdded;</span>
    }

    public static ReaderTagList getOrderedTagsList(ReaderTagList tagList, Map&lt;String, TagInfo&gt; defaultTagInfos) {
<span class="nc" id="L425">        ReaderTagList orderedTagList = new ReaderTagList();</span>
<span class="nc" id="L426">        Map&lt;String, ReaderTag&gt; defaultTags = new HashMap&lt;&gt;();</span>

<span class="nc bnc" id="L428" title="All 2 branches missed.">        for (ReaderTag tag : tagList) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (defaultTagFoundAndAdded(defaultTagInfos, tag, defaultTags)) continue;</span>

<span class="nc" id="L431">            orderedTagList.add(tag);</span>
<span class="nc" id="L432">        }</span>
<span class="nc" id="L433">        prependDefaults(defaultTags, orderedTagList, defaultTagInfos);</span>

<span class="nc" id="L435">        return orderedTagList;</span>
    }

    public static boolean isTagManagedInFollowingTab(
            ReaderTag tag,
            boolean isTopLevelReader,
            FilteredRecyclerView recyclerView
    ) {
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (isTopLevelReader) {</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">            if (ReaderUtils.isDefaultInMemoryTag(tag)) {</span>
<span class="nc" id="L445">                return true;</span>
            }

<span class="nc bnc" id="L448" title="All 2 branches missed.">            boolean isSpecialTag = tag != null</span>
                                   &amp;&amp;
<span class="nc bnc" id="L450" title="All 6 branches missed.">                                   (tag.isDiscover() || tag.isPostsILike() || tag.isBookmarked());</span>

<span class="nc bnc" id="L452" title="All 4 branches missed.">            boolean tabsInitializingNow = recyclerView != null &amp;&amp; recyclerView.getCurrentFilter() == null;</span>

<span class="nc bnc" id="L454" title="All 2 branches missed.">            boolean tagIsFollowedSitesOrAFollowedTag = tag != null</span>
                                                       &amp;&amp; (
<span class="nc bnc" id="L456" title="All 4 branches missed.">                                                               tag.isFollowedSites()</span>
                                                               || tag.tagType == ReaderTagType.FOLLOWED
                                                       );

<span class="nc bnc" id="L460" title="All 2 branches missed.">            if (isSpecialTag) {</span>
<span class="nc" id="L461">                return false;</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">            } else if (tabsInitializingNow) {</span>
<span class="nc" id="L463">                return tagIsFollowedSitesOrAFollowedTag;</span>
<span class="nc bnc" id="L464" title="All 4 branches missed.">            } else if (recyclerView != null &amp;&amp; recyclerView.getCurrentFilter() instanceof ReaderTag) {</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">                if (recyclerView.isValidFilter(tag)) {</span>
<span class="nc" id="L466">                    return tag.isFollowedSites();</span>
                } else {
                    // If we reach here it means we are setting a followed tag or site in the Following tab
<span class="nc" id="L469">                    return true;</span>
                }
            } else {
<span class="nc" id="L472">                return false;</span>
            }
        } else {
<span class="nc bnc" id="L475" title="All 4 branches missed.">            return tag != null &amp;&amp; tag.isFollowedSites();</span>
        }
    }

    public static @NonNull ReaderTag getValidTagForSharedPrefs(
            @NonNull ReaderTag tag,
            boolean isTopLevelReader,
            FilteredRecyclerView recyclerView,
            @NonNull ReaderTag defaultTag
    ) {
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (!isTopLevelReader) {</span>
<span class="nc" id="L486">            return tag;</span>
        }

<span class="nc bnc" id="L489" title="All 4 branches missed.">        boolean isValidFilter = (recyclerView != null &amp;&amp; recyclerView.isValidFilter(tag));</span>
<span class="nc bnc" id="L490" title="All 6 branches missed.">        boolean isSpecialTag = tag.isDiscover() || tag.isPostsILike() || tag.isBookmarked();</span>
<span class="nc bnc" id="L491" title="All 6 branches missed.">        if (!isSpecialTag &amp;&amp; !isValidFilter &amp;&amp; isTagManagedInFollowingTab(tag, isTopLevelReader, recyclerView)) {</span>
<span class="nc" id="L492">            return defaultTag;</span>
        }

<span class="nc" id="L495">        return tag;</span>
    }

    public static boolean isDefaultInMemoryTag(ReaderTag tag) {
<span class="nc bnc" id="L499" title="All 4 branches missed.">        return tag != null &amp;&amp; tag.isDefaultInMemoryTag();</span>
    }

    public static String getCommaSeparatedTagSlugs(ReaderTagList tags) {
<span class="nc" id="L503">        StringBuilder slugs = new StringBuilder();</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">        for (ReaderTag tag : tags) {</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">            if (slugs.length() &gt; 0) {</span>
<span class="nc" id="L506">                slugs.append(&quot;,&quot;);</span>
            }
<span class="nc" id="L508">            final String tagNameForApi = ReaderUtils.sanitizeWithDashes(tag.getTagSlug());</span>
<span class="nc" id="L509">            slugs.append(tagNameForApi);</span>
<span class="nc" id="L510">        }</span>
<span class="nc" id="L511">        return slugs.toString();</span>
    }

    public static ReaderTagList getTagsFromCommaSeparatedSlugs(@NotNull String commaSeparatedTagSlugs) {
<span class="nc" id="L515">        ReaderTagList tags = new ReaderTagList();</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">        if (!commaSeparatedTagSlugs.trim().equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">            for (String slug : commaSeparatedTagSlugs.split(&quot;,&quot;, -1)) {</span>
<span class="nc" id="L518">                ReaderTag tag = ReaderUtils.getTagFromTagName(slug, ReaderTagType.DEFAULT);</span>
<span class="nc" id="L519">                tags.add(tag);</span>
            }
        }
<span class="nc" id="L522">        return tags;</span>
    }

    /**
    * isExternalFeed identifies an external RSS feed
     * blogId will be empty for feeds and in some instances, it is explicitly
     * setting blogId equal to the feedId
     */
    public static boolean isExternalFeed(long blogId, long feedId) {
<span class="nc bnc" id="L531" title="All 6 branches missed.">         return (blogId == 0 &amp;&amp; feedId != 0) || blogId == feedId;</span>
    }

    public static String getReportPostUrl(String blogUrl) {
<span class="nc" id="L535">        return &quot;https://wordpress.com/abuse/?report_url=&quot; + blogUrl;</span>
    }

    public static boolean postExists(long blogId, long postId) {
<span class="nc" id="L539">        return ReaderPostTable.postExists(blogId, postId);</span>
    }

    public static boolean commentExists(long blogId, long postId, long commentId) {
<span class="nc" id="L543">        return ReaderCommentTable.commentExists(blogId, postId, commentId);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>