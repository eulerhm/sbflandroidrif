<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SiteSettingsTagListActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.prefs</a> &gt; <span class="el_source">SiteSettingsTagListActivity.java</span></div><h1>SiteSettingsTagListActivity.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.prefs;

import android.app.FragmentTransaction;
import android.app.ProgressDialog;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.text.TextUtils;
import android.view.HapticFeedbackConstants;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.appcompat.app.ActionBar;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.widget.SearchView;
import androidx.appcompat.widget.Toolbar;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.google.android.material.dialog.MaterialAlertDialogBuilder;

import org.apache.commons.text.StringEscapeUtils;
import org.greenrobot.eventbus.Subscribe;
import org.greenrobot.eventbus.ThreadMode;
import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.fluxc.Dispatcher;
import org.wordpress.android.fluxc.annotations.action.Action;
import org.wordpress.android.fluxc.generated.TaxonomyActionBuilder;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.fluxc.model.TermModel;
import org.wordpress.android.fluxc.store.SiteStore;
import org.wordpress.android.fluxc.store.TaxonomyStore;
import org.wordpress.android.fluxc.store.TaxonomyStore.OnTaxonomyChanged;
import org.wordpress.android.ui.ActionableEmptyView;
import org.wordpress.android.ui.LocaleAwareActivity;
import org.wordpress.android.util.ActivityUtils;
import org.wordpress.android.util.AniUtils;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.NetworkUtils;
import org.wordpress.android.util.StringUtils;
import org.wordpress.android.util.ToastUtils;
import org.wordpress.android.util.extensions.ViewExtensionsKt;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Locale;

import javax.inject.Inject;

<span class="nc" id="L62">public class SiteSettingsTagListActivity extends LocaleAwareActivity</span>
        implements SearchView.OnQueryTextListener, MenuItem.OnActionExpandListener,
        SiteSettingsTagDetailFragment.OnTagDetailListener {
    @Inject Dispatcher mDispatcher;
    @Inject SiteStore mSiteStore;
    @Inject TaxonomyStore mTaxonomyStore;

    private static final String KEY_SAVED_QUERY = &quot;SAVED_QUERY&quot;;
    private static final String KEY_PROGRESS_RES_ID = &quot;PROGRESS_RESOURCE_ID&quot;;
    private static final String KEY_IS_SEARCHING = &quot;IS_SEARCHING&quot;;

    private SiteModel mSite;
    private EmptyViewRecyclerView mRecycler;
    private View mFabView;
    private ActionableEmptyView mActionableEmptyView;

    private TagListAdapter mAdapter;
    private String mSavedQuery;
    private int mLastProgressResId;

    private MenuItem mSearchMenuItem;
    private SearchView mSearchView;
    private ProgressDialog mProgressDialog;

    private boolean mIsSearching;

    public static void showTagList(@NonNull Context context, @NonNull SiteModel site) {
<span class="nc" id="L89">        Intent intent = new Intent(context, SiteSettingsTagListActivity.class);</span>
<span class="nc" id="L90">        intent.putExtra(WordPress.SITE, site);</span>
<span class="nc" id="L91">        context.startActivity(intent);</span>
<span class="nc" id="L92">    }</span>

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L96">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L97">        ((WordPress) getApplication()).component().inject(this);</span>

<span class="nc" id="L99">        setContentView(R.layout.site_settings_tag_list_activity);</span>

<span class="nc" id="L101">        Toolbar toolbar = findViewById(R.id.toolbar_main);</span>
<span class="nc" id="L102">        setSupportActionBar(toolbar);</span>

<span class="nc" id="L104">        ActionBar actionBar = getSupportActionBar();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (actionBar != null) {</span>
<span class="nc" id="L106">            actionBar.setHomeButtonEnabled(true);</span>
<span class="nc" id="L107">            actionBar.setDisplayHomeAsUpEnabled(true);</span>
        }

<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L111">            mSite = (SiteModel) getIntent().getSerializableExtra(WordPress.SITE);</span>
        } else {
<span class="nc" id="L113">            mSite = (SiteModel) savedInstanceState.getSerializable(WordPress.SITE);</span>
<span class="nc" id="L114">            mSavedQuery = savedInstanceState.getString(KEY_SAVED_QUERY);</span>
<span class="nc" id="L115">            mIsSearching = savedInstanceState.getBoolean(KEY_IS_SEARCHING);</span>
        }
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (mSite == null) {</span>
<span class="nc" id="L118">            ToastUtils.showToast(this, R.string.blog_not_found, ToastUtils.Duration.SHORT);</span>
<span class="nc" id="L119">            finish();</span>
<span class="nc" id="L120">            return;</span>
        }

<span class="nc" id="L123">        mFabView = findViewById(R.id.fab_button);</span>
<span class="nc" id="L124">        mFabView.setOnClickListener(view -&gt; showDetailFragment(null));</span>
<span class="nc" id="L125">        mFabView.setOnLongClickListener(view -&gt; {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (view.isHapticFeedbackEnabled()) {</span>
<span class="nc" id="L127">                view.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);</span>
            }

<span class="nc" id="L130">            Toast.makeText(view.getContext(), R.string.site_settings_tags_empty_button, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L131">            return true;</span>
        });
<span class="nc" id="L133">        ViewExtensionsKt.redirectContextClickToLongPressListener(mFabView);</span>

        // hide the FAB the first time the fragment is created in order to animate it in onResume()
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L137">            mFabView.setVisibility(View.INVISIBLE);</span>
        }

<span class="nc" id="L140">        mActionableEmptyView = findViewById(R.id.actionable_empty_view);</span>
<span class="nc" id="L141">        mActionableEmptyView.button.setOnClickListener(view -&gt; showDetailFragment(null));</span>

<span class="nc" id="L143">        mRecycler = findViewById(R.id.tags_recycler_view);</span>
<span class="nc" id="L144">        mRecycler.setHasFixedSize(true);</span>
<span class="nc" id="L145">        mRecycler.setLayoutManager(new LinearLayoutManager(this));</span>
<span class="nc" id="L146">        mRecycler.setEmptyView(mActionableEmptyView);</span>

<span class="nc" id="L148">        loadTags();</span>

<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L151">            mDispatcher.dispatch(TaxonomyActionBuilder.newFetchTagsAction(mSite));</span>
        } else {
<span class="nc" id="L153">            SiteSettingsTagDetailFragment fragment = getDetailFragment();</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if (fragment != null) {</span>
<span class="nc" id="L155">                fragment.setOnTagDetailListener(this);</span>
            }
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (savedInstanceState.containsKey(KEY_PROGRESS_RES_ID)) {</span>
<span class="nc" id="L158">                @StringRes int messageId = savedInstanceState.getInt(KEY_PROGRESS_RES_ID);</span>
<span class="nc" id="L159">                showProgressDialog(messageId);</span>
            }
        }
<span class="nc" id="L162">    }</span>

    @Override
    public void onResume() {
<span class="nc" id="L166">        super.onResume();</span>
<span class="nc" id="L167">        showFabWithConditions();</span>
<span class="nc" id="L168">    }</span>

    @Override
    public void onStart() {
<span class="nc" id="L172">        super.onStart();</span>
<span class="nc" id="L173">        mDispatcher.register(this);</span>
<span class="nc" id="L174">    }</span>

    @Override
    public void onStop() {
<span class="nc" id="L178">        mDispatcher.unregister(this);</span>
<span class="nc" id="L179">        super.onStop();</span>
<span class="nc" id="L180">    }</span>

    @Override
    protected void onSaveInstanceState(@NotNull Bundle outState) {
<span class="nc" id="L184">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L185">        outState.putSerializable(WordPress.SITE, mSite);</span>
<span class="nc" id="L186">        outState.putBoolean(KEY_IS_SEARCHING, mIsSearching);</span>

<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (mSearchMenuItem.isActionViewExpanded()) {</span>
<span class="nc" id="L189">            outState.putString(KEY_SAVED_QUERY, mSearchView.getQuery().toString());</span>
        }

<span class="nc bnc" id="L192" title="All 4 branches missed.">        if (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()) {</span>
<span class="nc" id="L193">            outState.putInt(KEY_PROGRESS_RES_ID, mLastProgressResId);</span>
        }
<span class="nc" id="L195">    }</span>

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc" id="L199">        getMenuInflater().inflate(R.menu.tag_list, menu);</span>

<span class="nc" id="L201">        mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span class="nc" id="L202">        mSearchMenuItem.setOnActionExpandListener(this);</span>
<span class="nc" id="L203">        mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span class="nc" id="L204">        mSearchView.setOnQueryTextListener(this);</span>
<span class="nc" id="L205">        mSearchView.setMaxWidth(Integer.MAX_VALUE);</span>

        // open search bar if we were searching for something before
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (mIsSearching) {</span>
<span class="nc" id="L209">            mSearchMenuItem.expandActionView();</span>
<span class="nc" id="L210">            mSearchView.clearFocus();</span>
<span class="nc" id="L211">            mSearchView.setQuery(mSavedQuery, true);</span>
        }

<span class="nc" id="L214">        return super.onCreateOptionsMenu(menu);</span>
    }

    @Override
    public boolean onOptionsItemSelected(final MenuItem item) {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (item.getItemId() == android.R.id.home) {</span>
<span class="nc" id="L220">            onBackPressed();</span>
<span class="nc" id="L221">            return true;</span>
        } else {
<span class="nc" id="L223">            return super.onOptionsItemSelected(item);</span>
        }
    }

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span class="nc" id="L230">            SiteSettingsTagDetailFragment fragment = getDetailFragment();</span>
<span class="nc bnc" id="L231" title="All 4 branches missed.">            if (fragment != null &amp;&amp; fragment.hasChanges()) {</span>
<span class="nc" id="L232">                saveTag(fragment.getTerm(), fragment.isNewTerm());</span>
            } else {
<span class="nc" id="L234">                hideDetailFragment();</span>
<span class="nc" id="L235">                loadTags();</span>
            }
<span class="nc" id="L237">        } else {</span>
<span class="nc" id="L238">            super.onBackPressed();</span>
        }
<span class="nc" id="L240">    }</span>

    private void showFabIfHidden() {
        // redisplay hidden fab after a short delay
<span class="nc" id="L244">        long delayMs = getResources().getInteger(R.integer.fab_animation_delay);</span>
<span class="nc" id="L245">        new Handler().postDelayed(() -&gt; {</span>
<span class="nc bnc" id="L246" title="All 4 branches missed.">            if (!isFinishing() &amp;&amp; mFabView.getVisibility() != View.VISIBLE) {</span>
<span class="nc" id="L247">                AniUtils.scaleIn(mFabView, AniUtils.Duration.MEDIUM);</span>
            }
<span class="nc" id="L249">        }, delayMs);</span>
<span class="nc" id="L250">    }</span>

    private void showFabWithConditions() {
        // scale in the fab after a brief delay if it's not already showing
<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (mFabView.getVisibility() != View.VISIBLE) {</span>
<span class="nc" id="L255">            long delayMs = getResources().getInteger(R.integer.fab_animation_delay);</span>
<span class="nc" id="L256">            new Handler().postDelayed(() -&gt; {</span>
<span class="nc bnc" id="L257" title="All 4 branches missed.">                if (!mIsSearching &amp;&amp; !isDetailFragmentShowing()</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                    &amp;&amp; mActionableEmptyView.getVisibility() != View.VISIBLE) {</span>
<span class="nc" id="L259">                    showFabIfHidden();</span>
                }
<span class="nc" id="L261">            }, delayMs);</span>
        }
<span class="nc" id="L263">    }</span>

    private void hideFabIfShowing() {
<span class="nc bnc" id="L266" title="All 4 branches missed.">        if (!isFinishing() &amp;&amp; mFabView.getVisibility() == View.VISIBLE) {</span>
<span class="nc" id="L267">            AniUtils.scaleOut(mFabView, AniUtils.Duration.SHORT);</span>
        }
<span class="nc" id="L269">    }</span>

    @SuppressWarnings(&quot;unused&quot;)
    @Subscribe(threadMode = ThreadMode.MAIN)
    public void onTaxonomyChanged(OnTaxonomyChanged event) {
<span class="nc bnc" id="L274" title="All 2 branches missed.">        if (event.isError()) {</span>
<span class="nc" id="L275">            AppLog.e(AppLog.T.SETTINGS, event.error.message);</span>
        }
<span class="nc bnc" id="L277" title="All 3 branches missed.">        switch (event.causeOfChange) {</span>
            case FETCH_TAGS:
<span class="nc bnc" id="L279" title="All 2 branches missed.">                if (!event.isError()) {</span>
<span class="nc" id="L280">                    loadTags();</span>
                }
                break;
            case REMOVE_TERM:
            case UPDATE_TERM:
<span class="nc" id="L285">                hideProgressDialog();</span>
<span class="nc" id="L286">                hideDetailFragment();</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">                if (!event.isError()) {</span>
<span class="nc" id="L288">                    loadTags();</span>
                }
                break;
        }
<span class="nc" id="L292">    }</span>

    private void loadTags() {
<span class="nc" id="L295">        List&lt;TermModel&gt; tags = mTaxonomyStore.getTagsForSite(mSite);</span>
<span class="nc" id="L296">        Collections.sort(tags, (t1, t2) -&gt; StringUtils.compareIgnoreCase(t1.getName(), t2.getName()));</span>
<span class="nc" id="L297">        mAdapter = new TagListAdapter(tags);</span>
<span class="nc" id="L298">        mRecycler.setAdapter(mAdapter);</span>
<span class="nc" id="L299">    }</span>

    private SiteSettingsTagDetailFragment getDetailFragment() {
<span class="nc" id="L302">        return (SiteSettingsTagDetailFragment) getFragmentManager()</span>
<span class="nc" id="L303">                .findFragmentByTag(SiteSettingsTagDetailFragment.TAG);</span>
    }

    /*
     * shows the detail (edit) view for the passed term, or adds a new term is passed term is null
     */
    private void showDetailFragment(@Nullable TermModel term) {
<span class="nc" id="L310">        SiteSettingsTagDetailFragment fragment = SiteSettingsTagDetailFragment.newInstance(term);</span>
<span class="nc" id="L311">        fragment.setOnTagDetailListener(this);</span>

<span class="nc" id="L313">        getFragmentManager().beginTransaction()</span>
<span class="nc" id="L314">                            .add(R.id.container, fragment, SiteSettingsTagDetailFragment.TAG)</span>
<span class="nc" id="L315">                            .addToBackStack(null)</span>
<span class="nc" id="L316">                            .setTransition(FragmentTransaction.TRANSIT_FRAGMENT_FADE)</span>
<span class="nc" id="L317">                            .commitAllowingStateLoss();</span>

<span class="nc" id="L319">        mSearchMenuItem.collapseActionView();</span>
<span class="nc" id="L320">        mFabView.setVisibility(View.GONE);</span>
<span class="nc" id="L321">    }</span>

    private boolean isDetailFragmentShowing() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">        return getDetailFragment() != null;</span>
    }

    private void hideDetailFragment() {
<span class="nc" id="L328">        SiteSettingsTagDetailFragment fragment = getDetailFragment();</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (fragment != null) {</span>
<span class="nc" id="L330">            getFragmentManager().popBackStack();</span>
<span class="nc" id="L331">            ActivityUtils.hideKeyboard(this);</span>
<span class="nc" id="L332">            showFabWithConditions();</span>
<span class="nc" id="L333">            setTitle(R.string.site_settings_tags_title);</span>
<span class="nc" id="L334">            invalidateOptionsMenu();</span>
        }
<span class="nc" id="L336">    }</span>

    private void showActionableEmptyViewForSearch(boolean isSearch) {
<span class="nc" id="L339">        mActionableEmptyView.updateLayoutForSearch(isSearch, 0);</span>

<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (isSearch) {</span>
<span class="nc" id="L342">            mActionableEmptyView.button.setVisibility(View.GONE);</span>
<span class="nc" id="L343">            mActionableEmptyView.image.setVisibility(View.GONE);</span>
<span class="nc" id="L344">            mActionableEmptyView.subtitle.setVisibility(View.GONE);</span>
<span class="nc" id="L345">            mActionableEmptyView.title.setText(R.string.site_settings_tags_empty_title_search);</span>
        } else {
<span class="nc" id="L347">            mActionableEmptyView.button.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L348">            mActionableEmptyView.image.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L349">            mActionableEmptyView.subtitle.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L350">            mActionableEmptyView.title.setText(R.string.site_settings_tags_empty_title);</span>
        }
<span class="nc" id="L352">    }</span>

    @Override
    public boolean onQueryTextSubmit(String query) {
<span class="nc" id="L356">        mAdapter.filter(query);</span>
<span class="nc" id="L357">        return false;</span>
    }

    @Override
    public boolean onQueryTextChange(String query) {
<span class="nc" id="L362">        mAdapter.filter(query);</span>
<span class="nc" id="L363">        return false;</span>
    }

    @Override
    public boolean onMenuItemActionExpand(MenuItem item) {
<span class="nc" id="L368">        mIsSearching = true;</span>
<span class="nc" id="L369">        showActionableEmptyViewForSearch(true);</span>
<span class="nc" id="L370">        hideFabIfShowing();</span>
<span class="nc" id="L371">        return true;</span>
    }

    @Override
    public boolean onMenuItemActionCollapse(MenuItem item) {
<span class="nc" id="L376">        mIsSearching = false;</span>
<span class="nc" id="L377">        showActionableEmptyViewForSearch(false);</span>
<span class="nc" id="L378">        showFabWithConditions();</span>
<span class="nc" id="L379">        return true;</span>
    }

    private void showProgressDialog(@StringRes int messageId) {
<span class="nc" id="L383">        mProgressDialog = new ProgressDialog(this);</span>
<span class="nc" id="L384">        mProgressDialog.setCancelable(false);</span>
<span class="nc" id="L385">        mProgressDialog.setIndeterminate(true);</span>
<span class="nc" id="L386">        mProgressDialog.setMessage(getString(messageId));</span>
<span class="nc" id="L387">        mProgressDialog.show();</span>
<span class="nc" id="L388">        mLastProgressResId = messageId;</span>
<span class="nc" id="L389">    }</span>

    private void hideProgressDialog() {
<span class="nc bnc" id="L392" title="All 4 branches missed.">        if (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()) {</span>
<span class="nc" id="L393">            mProgressDialog.dismiss();</span>
        }
<span class="nc" id="L395">    }</span>

    @Override
    public void onRequestDeleteTag(@NonNull TermModel term) {
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (NetworkUtils.checkConnection(this)) {</span>
<span class="nc" id="L400">            confirmDeleteTag(term);</span>
        }
<span class="nc" id="L402">    }</span>

    private void confirmDeleteTag(@NonNull final TermModel term) {
<span class="nc" id="L405">        String message = String.format(getString(R.string.dlg_confirm_delete_tag), term.getName());</span>
<span class="nc" id="L406">        AlertDialog.Builder dialogBuilder = new MaterialAlertDialogBuilder(this);</span>
<span class="nc" id="L407">        dialogBuilder.setMessage(message);</span>
<span class="nc" id="L408">        dialogBuilder.setPositiveButton(</span>
<span class="nc" id="L409">                getResources().getText(R.string.delete_yes),</span>
                (dialog, whichButton) -&gt; {
<span class="nc" id="L411">                    showProgressDialog(R.string.dlg_deleting_tag);</span>
<span class="nc" id="L412">                    Action action = TaxonomyActionBuilder.newDeleteTermAction(</span>
                            new TaxonomyStore.RemoteTermPayload(term, mSite));
<span class="nc" id="L414">                    mDispatcher.dispatch(action);</span>
<span class="nc" id="L415">                });</span>
<span class="nc" id="L416">        dialogBuilder.setNegativeButton(R.string.cancel, null);</span>
<span class="nc" id="L417">        dialogBuilder.setCancelable(true);</span>
<span class="nc" id="L418">        dialogBuilder.create().show();</span>
<span class="nc" id="L419">    }</span>

    private void saveTag(@NonNull TermModel term, boolean isNewTerm) {
<span class="nc bnc" id="L422" title="All 4 branches missed.">        if (isNewTerm &amp;&amp; tagExists(term.getName())) {</span>
<span class="nc" id="L423">            ToastUtils.showToast(this, R.string.error_tag_exists);</span>
<span class="nc" id="L424">            return;</span>
        }

<span class="nc" id="L427">        showProgressDialog(R.string.dlg_saving_tag);</span>
<span class="nc" id="L428">        Action action = TaxonomyActionBuilder.newPushTermAction(new TaxonomyStore.RemoteTermPayload(term, mSite));</span>
<span class="nc" id="L429">        mDispatcher.dispatch(action);</span>
<span class="nc" id="L430">    }</span>

    private boolean tagExists(@NonNull String termName) {
<span class="nc" id="L433">        List&lt;TermModel&gt; terms = mTaxonomyStore.getTagsForSite(mSite);</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">        for (TermModel term : terms) {</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">            if (termName.equalsIgnoreCase(term.getName())) {</span>
<span class="nc" id="L436">                return true;</span>
            }
<span class="nc" id="L438">        }</span>
<span class="nc" id="L439">        return false;</span>
    }

    private class TagListAdapter extends RecyclerView.Adapter&lt;TagListAdapter.TagViewHolder&gt; {
<span class="nc" id="L443">        private final List&lt;TermModel&gt; mAllTags = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L444">        private final List&lt;TermModel&gt; mFilteredTags = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L446">        TagListAdapter(@NonNull List&lt;TermModel&gt; allTags) {</span>
<span class="nc" id="L447">            mAllTags.addAll(allTags);</span>
<span class="nc" id="L448">            mFilteredTags.addAll(allTags);</span>
<span class="nc" id="L449">        }</span>

        @NonNull
        @Override
        public TagViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
<span class="nc" id="L454">            View view = LayoutInflater.from(parent.getContext())</span>
<span class="nc" id="L455">                                      .inflate(R.layout.site_settings_tag_list_row, parent, false);</span>
<span class="nc" id="L456">            return new TagListAdapter.TagViewHolder(view);</span>
        }

        @Override
        public void onBindViewHolder(@NonNull final TagListAdapter.TagViewHolder holder, int position) {
<span class="nc" id="L461">            TermModel term = mFilteredTags.get(position);</span>
<span class="nc" id="L462">            holder.mTxtTag.setText(StringEscapeUtils.unescapeHtml4(term.getName()));</span>
<span class="nc bnc" id="L463" title="All 2 branches missed.">            if (term.getPostCount() &gt; 0) {</span>
<span class="nc" id="L464">                holder.mTxtCount.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L465">                holder.mTxtCount.setText(String.valueOf(term.getPostCount()));</span>
            } else {
<span class="nc" id="L467">                holder.mTxtCount.setVisibility(View.GONE);</span>
            }
<span class="nc" id="L469">        }</span>

        @Override
        public int getItemCount() {
<span class="nc" id="L473">            return mFilteredTags.size();</span>
        }

        public void filter(final String text) {
<span class="nc" id="L477">            mFilteredTags.clear();</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (TextUtils.isEmpty(text)) {</span>
<span class="nc" id="L479">                mFilteredTags.addAll(mAllTags);</span>
            } else {
<span class="nc bnc" id="L481" title="All 2 branches missed.">                for (TermModel tag : mAllTags) {</span>
<span class="nc" id="L482">                    if (tag.getName().toLowerCase(Locale.getDefault())</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">                           .contains(text.toLowerCase(Locale.getDefault()))) {</span>
<span class="nc" id="L484">                        mFilteredTags.add(tag);</span>
                    }
<span class="nc" id="L486">                }</span>
            }
<span class="nc" id="L488">            notifyDataSetChanged();</span>

<span class="nc bnc" id="L490" title="All 4 branches missed.">            showActionableEmptyViewForSearch(mIsSearching &amp;&amp; mFilteredTags.isEmpty());</span>
<span class="nc" id="L491">        }</span>

        class TagViewHolder extends RecyclerView.ViewHolder {
            private final TextView mTxtTag;
            private final TextView mTxtCount;

<span class="nc" id="L497">            TagViewHolder(View view) {</span>
<span class="nc" id="L498">                super(view);</span>
<span class="nc" id="L499">                mTxtTag = view.findViewById(R.id.text_tag);</span>
<span class="nc" id="L500">                mTxtCount = view.findViewById(R.id.text_count);</span>
<span class="nc" id="L501">                view.setOnClickListener(view1 -&gt; {</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">                    if (!isDetailFragmentShowing()) {</span>
<span class="nc" id="L503">                        int position = getAdapterPosition();</span>
<span class="nc" id="L504">                        showDetailFragment(mFilteredTags.get(position));</span>
                    }
<span class="nc" id="L506">                });</span>
<span class="nc" id="L507">            }</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>