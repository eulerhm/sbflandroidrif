<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QuickStartItemBuilder.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.mysite.dynamiccards.quickstart</a> &gt; <span class="el_source">QuickStartItemBuilder.kt</span></div><h1>QuickStartItemBuilder.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.mysite.dynamiccards.quickstart

import androidx.annotation.ColorRes
import androidx.annotation.DrawableRes
import org.wordpress.android.R
import org.wordpress.android.fluxc.model.DynamicCardType
import org.wordpress.android.fluxc.store.QuickStartStore
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTask
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTaskType
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTaskType.CUSTOMIZE
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTaskType.GET_TO_KNOW_APP
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTaskType.GROW
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTaskType.UNKNOWN
import org.wordpress.android.ui.mysite.MySiteCardAndItem.DynamicCard.QuickStartDynamicCard
import org.wordpress.android.ui.mysite.MySiteCardAndItem.DynamicCard.QuickStartDynamicCard.QuickStartTaskCard
import org.wordpress.android.ui.mysite.cards.quickstart.QuickStartRepository
import org.wordpress.android.ui.mysite.cards.quickstart.QuickStartRepository.QuickStartCategory
import org.wordpress.android.ui.mysite.dynamiccards.DynamicCardMenuFragment.DynamicCardMenuModel
import org.wordpress.android.ui.quickstart.QuickStartTaskDetails
import org.wordpress.android.ui.utils.ListItemInteraction
import org.wordpress.android.ui.utils.UiString.UiStringRes
import javax.inject.Inject
import kotlin.math.roundToInt

<span class="nc" id="L25">class QuickStartItemBuilder</span>
<span class="nc" id="L26">@Inject constructor(</span>
<span class="nc" id="L27">    val quickStartRepository: QuickStartRepository</span>
) {
    fun build(
        quickStartCategory: QuickStartCategory,
        pinnedDynamicCardType: DynamicCardType?,
        onQuickStartCardMoreClick: (DynamicCardMenuModel) -&gt; Unit,
        onQuickStartTaskClick: (QuickStartTask) -&gt; Unit
    ): QuickStartDynamicCard {
<span class="nc" id="L35">        val accentColor = getAccentColor(quickStartCategory.taskType)</span>
<span class="nc" id="L36">        val tasks = mutableListOf&lt;QuickStartTaskCard&gt;()</span>
<span class="nc" id="L37">        tasks.addAll(quickStartCategory.uncompletedTasks.map { it.toUiItem(false, accentColor, onQuickStartTaskClick) })</span>
<span class="nc" id="L38">        val completedTasks = quickStartCategory.completedTasks.map {</span>
<span class="nc" id="L39">            it.toUiItem(</span>
<span class="nc" id="L40">                    true,</span>
<span class="nc" id="L41">                    accentColor,</span>
<span class="nc" id="L42">                    onQuickStartTaskClick</span>
            )
        }
<span class="nc" id="L45">        tasks.addAll(completedTasks)</span>
<span class="nc" id="L46">        val dynamicCardType = quickStartCategory.taskType.toDynamicCardType()</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">        val isPinned = pinnedDynamicCardType == dynamicCardType</span>
<span class="nc" id="L48">        return QuickStartDynamicCard(</span>
<span class="nc" id="L49">                dynamicCardType,</span>
<span class="nc" id="L50">                UiStringRes(getTitle(quickStartCategory.taskType)),</span>
<span class="nc" id="L51">                tasks,</span>
<span class="nc" id="L52">                accentColor,</span>
<span class="nc" id="L53">                getProgress(tasks, completedTasks),</span>
<span class="nc" id="L54">                ListItemInteraction.create(DynamicCardMenuModel(dynamicCardType, isPinned), onQuickStartCardMoreClick)</span>
        )
    }

    private fun QuickStartTaskType.toDynamicCardType(): DynamicCardType {
<span class="nc bnc" id="L59" title="All 4 branches missed.">        return when (this) {</span>
<span class="nc" id="L60">            CUSTOMIZE -&gt; DynamicCardType.CUSTOMIZE_QUICK_START</span>
<span class="nc" id="L61">            GROW -&gt; DynamicCardType.GROW_QUICK_START</span>
<span class="nc" id="L62">            GET_TO_KNOW_APP -&gt; DynamicCardType.GET_TO_KNOW_APP_QUICK_START</span>
<span class="nc" id="L63">            UNKNOWN -&gt; throw IllegalArgumentException(&quot;Unexpected quick start type&quot;)</span>
        }
    }

    private fun getProgress(tasks: List&lt;QuickStartTaskCard&gt;, completedTasks: List&lt;QuickStartTaskCard&gt;): Int {
<span class="nc bnc" id="L68" title="All 4 branches missed.">        return if (tasks.isNotEmpty()) ((completedTasks.size / tasks.size.toFloat()) * 100).roundToInt() else 0</span>
    }

    @ColorRes
    private fun getAccentColor(taskType: QuickStartTaskType): Int {
<span class="nc bnc" id="L73" title="All 4 branches missed.">        return when (taskType) {</span>
<span class="nc" id="L74">            CUSTOMIZE -&gt; R.color.green_20</span>
<span class="nc" id="L75">            GROW -&gt; R.color.orange_40</span>
<span class="nc" id="L76">            GET_TO_KNOW_APP -&gt; R.color.green_20</span>
<span class="nc" id="L77">            UNKNOWN -&gt; throw IllegalArgumentException(&quot;Unexpected quick start type&quot;)</span>
        }
    }

    private fun getTitle(taskType: QuickStartTaskType): Int {
<span class="nc bnc" id="L82" title="All 4 branches missed.">        return when (taskType) {</span>
<span class="nc" id="L83">            CUSTOMIZE -&gt; R.string.quick_start_sites_type_customize</span>
<span class="nc" id="L84">            GROW -&gt; R.string.quick_start_sites_type_grow</span>
<span class="nc" id="L85">            GET_TO_KNOW_APP -&gt; R.string.quick_start_sites_type_get_to_know_app</span>
<span class="nc" id="L86">            UNKNOWN -&gt; throw IllegalArgumentException(&quot;Unexpected quick start type&quot;)</span>
        }
    }

    private fun QuickStartTaskDetails.toUiItem(
        done: Boolean,
        accentColor: Int,
        onQuickStartTaskClick: (QuickStartTask) -&gt; Unit
    ): QuickStartTaskCard {
<span class="nc" id="L95">        val task = quickStartRepository.quickStartType.getTaskFromString(this.taskString)</span>
<span class="nc" id="L96">        return QuickStartTaskCard(</span>
<span class="nc" id="L97">                task,</span>
<span class="nc" id="L98">                UiStringRes(this.titleResId),</span>
<span class="nc" id="L99">                UiStringRes(this.subtitleResId),</span>
<span class="nc" id="L100">                getIllustration(task),</span>
<span class="nc" id="L101">                accentColor,</span>
<span class="nc" id="L102">                done,</span>
<span class="nc" id="L103">                ListItemInteraction.create(task, onQuickStartTaskClick)</span>
        )
    }

    @DrawableRes
    private fun getIllustration(task: QuickStartTask): Int {
<span class="nc bnc" id="L109" title="All 11 branches missed.">        return when (task.string) {</span>
            QuickStartStore.QUICK_START_UPDATE_SITE_TITLE_LABEL -&gt;
<span class="nc" id="L111">                R.drawable.img_illustration_quick_start_task_set_site_title</span>
            QuickStartStore.QUICK_START_UPLOAD_SITE_ICON_LABEL -&gt;
<span class="nc" id="L113">                R.drawable.img_illustration_quick_start_task_edit_site_icon</span>
<span class="nc" id="L114">            QuickStartStore.QUICK_START_VIEW_SITE_LABEL -&gt; R.drawable.img_illustration_quick_start_task_visit_your_site</span>
            QuickStartStore.QUICK_START_ENABLE_POST_SHARING_LABEL -&gt;
<span class="nc" id="L116">                R.drawable.img_illustration_quick_start_task_enable_post_sharing</span>
<span class="nc" id="L117">            QuickStartStore.QUICK_START_PUBLISH_POST_LABEL -&gt; R.drawable.img_illustration_quick_start_task_publish_post</span>
            QuickStartStore.QUICK_START_FOLLOW_SITE_LABEL -&gt;
<span class="nc" id="L119">                R.drawable.img_illustration_quick_start_task_follow_other_sites</span>
            QuickStartStore.QUICK_START_CHECK_STATS_LABEL -&gt;
<span class="nc" id="L121">                R.drawable.img_illustration_quick_start_task_check_site_stats</span>
            QuickStartStore.QUICK_START_REVIEW_PAGES_LABEL -&gt;
<span class="nc" id="L123">                R.drawable.img_illustration_quick_start_task_review_site_pages</span>
<span class="nc" id="L124">            QuickStartStore.QUICK_START_CREATE_SITE_LABEL -&gt; R.drawable.img_illustration_quick_start_task_create_site</span>
            QuickStartStore.QUICK_START_CHECK_NOTIFIATIONS_LABEL -&gt;
<span class="nc" id="L126">                R.drawable.img_illustration_quick_start_task_placeholder</span>
<span class="nc" id="L127">            else -&gt; R.drawable.img_illustration_quick_start_task_placeholder</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>