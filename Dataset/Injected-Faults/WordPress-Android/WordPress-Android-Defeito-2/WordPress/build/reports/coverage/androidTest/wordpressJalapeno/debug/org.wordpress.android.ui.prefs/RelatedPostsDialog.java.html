<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RelatedPostsDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.prefs</a> &gt; <span class="el_source">RelatedPostsDialog.java</span></div><h1>RelatedPostsDialog.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.prefs;

import android.app.Activity;
import android.app.Dialog;
import android.app.DialogFragment;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;

import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.widget.SwitchCompat;

import com.google.android.material.dialog.MaterialAlertDialogBuilder;

import org.wordpress.android.R;

import java.util.ArrayList;
import java.util.List;

<span class="nc" id="L28">public class RelatedPostsDialog extends DialogFragment</span>
        implements DialogInterface.OnClickListener,
        CompoundButton.OnCheckedChangeListener {
    /**
     * boolean
     * &lt;p&gt;
     * Sets the default state of the Show Related Posts switch. The switch is off by default.
     */
    public static final String SHOW_RELATED_POSTS_KEY = &quot;related-posts&quot;;

    /**
     * boolean
     * &lt;p&gt;
     * Sets the default state of the Show Headers checkbox. The checkbox is off by default.
     */
    public static final String SHOW_HEADER_KEY = &quot;show-header&quot;;

    /**
     * boolean
     * &lt;p&gt;
     * Sets the default state of the Show Images checkbox. The checkbox is off by default.
     */
    public static final String SHOW_IMAGES_KEY = &quot;show-images&quot;;

    private SwitchCompat mShowRelatedPosts;
    private CheckBox mShowHeader;
    private CheckBox mShowImages;
    private TextView mPreviewHeader;
    private TextView mRelatedPostsListHeader;
    private LinearLayout mRelatedPostsList;
    private List&lt;ImageView&gt; mPreviewImages;
    private boolean mConfirmed;

    @Override
    public Dialog onCreateDialog(Bundle savedInstanceState) {
<span class="nc" id="L63">        LayoutInflater inflater = getActivity().getLayoutInflater();</span>
        //noinspection InflateParams
<span class="nc" id="L65">        View v = inflater.inflate(R.layout.related_posts_dialog, null);</span>

<span class="nc" id="L67">        mShowRelatedPosts = v.findViewById(R.id.toggle_related_posts_switch);</span>
<span class="nc" id="L68">        mShowHeader = v.findViewById(R.id.show_header_checkbox);</span>
<span class="nc" id="L69">        mShowImages = v.findViewById(R.id.show_images_checkbox);</span>
<span class="nc" id="L70">        mPreviewHeader = v.findViewById(R.id.preview_header);</span>
<span class="nc" id="L71">        mRelatedPostsListHeader = v.findViewById(R.id.related_posts_list_header);</span>
<span class="nc" id="L72">        mRelatedPostsList = v.findViewById(R.id.related_posts_list);</span>

<span class="nc" id="L74">        mPreviewImages = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L75">        mPreviewImages.add(v.findViewById(R.id.related_post_image1));</span>
<span class="nc" id="L76">        mPreviewImages.add(v.findViewById(R.id.related_post_image2));</span>
<span class="nc" id="L77">        mPreviewImages.add(v.findViewById(R.id.related_post_image3));</span>

<span class="nc" id="L79">        Bundle args = getArguments();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (args != null) {</span>
<span class="nc" id="L81">            mShowRelatedPosts.setChecked(args.getBoolean(SHOW_RELATED_POSTS_KEY));</span>
<span class="nc" id="L82">            mShowHeader.setChecked(args.getBoolean(SHOW_HEADER_KEY));</span>
<span class="nc" id="L83">            mShowImages.setChecked(args.getBoolean(SHOW_IMAGES_KEY));</span>
        }

<span class="nc" id="L86">        toggleShowHeader(mShowHeader.isChecked());</span>
<span class="nc" id="L87">        toggleShowImages(mShowImages.isChecked());</span>

<span class="nc" id="L89">        mShowRelatedPosts.setOnCheckedChangeListener(this);</span>
<span class="nc" id="L90">        mShowHeader.setOnCheckedChangeListener(this);</span>
<span class="nc" id="L91">        mShowImages.setOnCheckedChangeListener(this);</span>

<span class="nc" id="L93">        toggleViews(mShowRelatedPosts.isChecked());</span>

<span class="nc" id="L95">        int topOffset = getResources().getDimensionPixelOffset(R.dimen.settings_fragment_dialog_vertical_inset);</span>

<span class="nc" id="L97">        AlertDialog.Builder builder = new MaterialAlertDialogBuilder(getActivity())</span>
<span class="nc" id="L98">                .setBackgroundInsetTop(topOffset)</span>
<span class="nc" id="L99">                .setBackgroundInsetBottom(topOffset);</span>
        //noinspection InflateParams
<span class="nc" id="L101">        View titleView = inflater.inflate(R.layout.detail_list_preference_title, null);</span>
<span class="nc" id="L102">        TextView titleText = titleView.findViewById(R.id.title);</span>
<span class="nc" id="L103">        titleText.setText(R.string.site_settings_related_posts_title);</span>
<span class="nc" id="L104">        titleText.setLayoutParams(new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT,</span>
                RelativeLayout.LayoutParams.WRAP_CONTENT));
<span class="nc" id="L106">        builder.setCustomTitle(titleView);</span>
<span class="nc" id="L107">        builder.setPositiveButton(android.R.string.ok, this);</span>
<span class="nc" id="L108">        builder.setNegativeButton(R.string.cancel, this);</span>
<span class="nc" id="L109">        builder.setView(v);</span>

<span class="nc" id="L111">        return builder.create();</span>
    }

    @Override
    public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L116" title="All 2 branches missed.">        mConfirmed = which == DialogInterface.BUTTON_POSITIVE;</span>
<span class="nc" id="L117">        dismiss();</span>
<span class="nc" id="L118">    }</span>

    @Override
    public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (buttonView == mShowRelatedPosts) {</span>
<span class="nc" id="L123">            toggleViews(isChecked);</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">        } else if (buttonView == mShowHeader) {</span>
<span class="nc" id="L125">            toggleShowHeader(isChecked);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">        } else if (buttonView == mShowImages) {</span>
<span class="nc" id="L127">            toggleShowImages(isChecked);</span>
        }
<span class="nc" id="L129">    }</span>

    @Override
    public void onDismiss(DialogInterface dialog) {
        // TODO: android.app.Fragment  is deprecated since Android P.
        // Needs to be replaced with android.support.v4.app.Fragment
        // See https://developer.android.com/reference/android/app/Fragment
<span class="nc" id="L136">        android.app.Fragment target = getTargetFragment();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (target != null) {</span>
<span class="nc" id="L138">            target.onActivityResult(getTargetRequestCode(), Activity.RESULT_OK, getResultIntent());</span>
        }

<span class="nc" id="L141">        super.onDismiss(dialog);</span>
<span class="nc" id="L142">    }</span>

    private void toggleShowHeader(boolean show) {
<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (show) {</span>
<span class="nc" id="L146">            mRelatedPostsListHeader.setVisibility(View.VISIBLE);</span>
        } else {
<span class="nc" id="L148">            mRelatedPostsListHeader.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L150">    }</span>

    private void toggleShowImages(boolean show) {
<span class="nc bnc" id="L153" title="All 2 branches missed.">        int visibility = show ? View.VISIBLE : View.GONE;</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">        for (ImageView view : mPreviewImages) {</span>
<span class="nc" id="L155">            view.setVisibility(visibility);</span>
<span class="nc" id="L156">        }</span>
<span class="nc" id="L157">    }</span>

    private Intent getResultIntent() {
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (mConfirmed) {</span>
<span class="nc" id="L161">            return new Intent()</span>
<span class="nc" id="L162">                    .putExtra(SHOW_RELATED_POSTS_KEY, mShowRelatedPosts.isChecked())</span>
<span class="nc" id="L163">                    .putExtra(SHOW_HEADER_KEY, mShowHeader.isChecked())</span>
<span class="nc" id="L164">                    .putExtra(SHOW_IMAGES_KEY, mShowImages.isChecked());</span>
        }

<span class="nc" id="L167">        return null;</span>
    }

    private void toggleViews(boolean enabled) {
<span class="nc" id="L171">        mShowHeader.setEnabled(enabled);</span>
<span class="nc" id="L172">        mShowImages.setEnabled(enabled);</span>
<span class="nc" id="L173">        mPreviewHeader.setEnabled(enabled);</span>
<span class="nc" id="L174">        mRelatedPostsListHeader.setEnabled(enabled);</span>

<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (enabled) {</span>
<span class="nc" id="L177">            mRelatedPostsList.setAlpha(1.0f);</span>
        } else {
<span class="nc" id="L179">            mRelatedPostsList.setAlpha(0.5f);</span>
        }
<span class="nc" id="L181">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>