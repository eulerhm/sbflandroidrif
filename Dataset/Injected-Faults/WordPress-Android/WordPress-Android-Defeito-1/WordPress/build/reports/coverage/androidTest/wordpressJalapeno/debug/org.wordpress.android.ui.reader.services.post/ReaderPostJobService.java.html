<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderPostJobService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.services.post</a> &gt; <span class="el_source">ReaderPostJobService.java</span></div><h1>ReaderPostJobService.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.services.post;

import android.app.job.JobParameters;
import android.app.job.JobService;
import android.os.PersistableBundle;

import org.greenrobot.eventbus.EventBus;
import org.wordpress.android.models.ReaderTag;
import org.wordpress.android.models.ReaderTagType;
import org.wordpress.android.ui.reader.ReaderEvents;
import org.wordpress.android.ui.reader.services.ServiceCompletionListener;
import org.wordpress.android.util.AppLog;

import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_ACTION;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_BLOG_ID;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_FEED_ID;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_TAG_PARAM_DISPLAY_NAME;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_TAG_PARAM_ENDPOINT;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_TAG_PARAM_SLUG;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_TAG_PARAM_TAGTYPE;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.ARG_TAG_PARAM_TITLE;
import static org.wordpress.android.ui.reader.services.post.ReaderPostServiceStarter.UpdateAction;

/**
 * service which updates posts with specific tags or in specific blogs/feeds - relies on
 * EventBus to alert of update status
 */

<span class="nc" id="L29">public class ReaderPostJobService extends JobService implements ServiceCompletionListener {</span>
    private ReaderPostLogic mReaderPostLogic;

    @Override public boolean onStartJob(JobParameters params) {
<span class="nc" id="L33">        AppLog.i(AppLog.T.READER, &quot;reader post job service &gt; started&quot;);</span>
        UpdateAction action;
<span class="nc bnc" id="L35" title="All 2 branches missed.">        if (params.getExtras() != null) {</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">            if (params.getExtras().containsKey(ARG_ACTION)) {</span>
<span class="nc" id="L37">                action = UpdateAction.values()[(Integer) params.getExtras().get(ARG_ACTION)];</span>
            } else {
<span class="nc" id="L39">                action = UpdateAction.REQUEST_NEWER;</span>
            }


<span class="nc bnc" id="L43" title="All 2 branches missed.">            if (params.getExtras().containsKey(ARG_TAG_PARAM_SLUG)) {</span>
<span class="nc" id="L44">                ReaderTag tag = getReaderTagFromBundleParams(params.getExtras());</span>
<span class="nc" id="L45">                EventBus.getDefault().post(new ReaderEvents.UpdatePostsStarted(action, tag));</span>
<span class="nc" id="L46">                mReaderPostLogic.performTask(params, action, tag, -1, -1);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">            } else if (params.getExtras().containsKey(ARG_BLOG_ID)) {</span>
<span class="nc" id="L48">                long blogId = params.getExtras().getLong(ARG_BLOG_ID, 0);</span>
<span class="nc" id="L49">                EventBus.getDefault().post(new ReaderEvents.UpdatePostsStarted(action));</span>
<span class="nc" id="L50">                mReaderPostLogic.performTask(params, action, null, blogId, -1);</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">            } else if (params.getExtras().containsKey(ARG_FEED_ID)) {</span>
<span class="nc" id="L52">                long feedId = params.getExtras().getLong(ARG_FEED_ID, 0);</span>
<span class="nc" id="L53">                EventBus.getDefault().post(new ReaderEvents.UpdatePostsStarted(action));</span>
<span class="nc" id="L54">                mReaderPostLogic.performTask(params, action, null, -1, feedId);</span>
            }
        }
<span class="nc" id="L57">        return true;</span>
    }

    @Override public boolean onStopJob(JobParameters params) {
<span class="nc" id="L61">        AppLog.i(AppLog.T.READER, &quot;reader post job service &gt; stopped&quot;);</span>
<span class="nc" id="L62">        jobFinished(params, false);</span>
<span class="nc" id="L63">        return false;</span>
    }

    @Override
    public void onCreate() {
<span class="nc" id="L68">        super.onCreate();</span>
<span class="nc" id="L69">        mReaderPostLogic = new ReaderPostLogic(this);</span>
<span class="nc" id="L70">        AppLog.i(AppLog.T.READER, &quot;reader post job service &gt; created&quot;);</span>
<span class="nc" id="L71">    }</span>

    @Override
    public void onDestroy() {
<span class="nc" id="L75">        AppLog.i(AppLog.T.READER, &quot;reader post job service &gt; destroyed&quot;);</span>
<span class="nc" id="L76">        super.onDestroy();</span>
<span class="nc" id="L77">    }</span>

    @Override
    public void onCompleted(Object companion) {
<span class="nc" id="L81">        AppLog.i(AppLog.T.READER, &quot;reader post job service &gt; all tasks completed&quot;);</span>
<span class="nc" id="L82">        jobFinished((JobParameters) companion, false);</span>
<span class="nc" id="L83">    }</span>

    private ReaderTag getReaderTagFromBundleParams(PersistableBundle bundle) {
<span class="nc" id="L86">        String slug = bundle.getString(ARG_TAG_PARAM_SLUG);</span>
<span class="nc" id="L87">        String displayName = bundle.getString(ARG_TAG_PARAM_DISPLAY_NAME);</span>
<span class="nc" id="L88">        String title = bundle.getString(ARG_TAG_PARAM_TITLE);</span>
<span class="nc" id="L89">        String endpoint = bundle.getString(ARG_TAG_PARAM_ENDPOINT);</span>
<span class="nc" id="L90">        int tagType = bundle.getInt(ARG_TAG_PARAM_TAGTYPE);</span>
<span class="nc" id="L91">        ReaderTag tag = new ReaderTag(slug, displayName, title, endpoint, ReaderTagType.fromInt(tagType));</span>
<span class="nc" id="L92">        return tag;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>