<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QuickStartPromptDialogFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.posts</a> &gt; <span class="el_source">QuickStartPromptDialogFragment.kt</span></div><h1>QuickStartPromptDialogFragment.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.posts

import android.app.Dialog
import android.content.Context
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Button
import android.widget.ImageView
import android.widget.LinearLayout
import android.widget.TextView
import androidx.annotation.DrawableRes
import androidx.appcompat.app.AppCompatDialogFragment
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.ui.main.SitePickerAdapter.SiteRecord
import org.wordpress.android.ui.mysite.SelectedSiteRepository
import org.wordpress.android.util.DisplayUtils
import org.wordpress.android.util.image.ImageManager
import org.wordpress.android.widgets.WPTextView
import javax.inject.Inject

@Suppress(&quot;TooManyFunctions&quot;)
<span class="nc" id="L25">class QuickStartPromptDialogFragment : AppCompatDialogFragment() {</span>
    companion object {
        private const val STATE_KEY_DRAWABLE_RES_ID = &quot;state_key_drawable&quot;
        private const val STATE_KEY_TAG = &quot;state_key_tag&quot;
        private const val STATE_KEY_TITLE = &quot;state_key_title&quot;
        private const val STATE_KEY_MESSAGE = &quot;state_key_message&quot;
        private const val STATE_KEY_POSITIVE_BUTTON_LABEL = &quot;state_key_positive_button_label&quot;
        private const val STATE_KEY_NEGATIVE_BUTTON_LABEL = &quot;state_key_negative_button_label&quot;
        private const val UNDEFINED_RES_ID = -1
        private const val SITE_IMAGE_CORNER_RADIUS_IN_DP = 4
    }

<span class="nc" id="L37">    @DrawableRes private var drawableResId: Int = UNDEFINED_RES_ID</span>
    private lateinit var fragmentTag: String
    private lateinit var message: String
    private lateinit var negativeButtonLabel: String
    private lateinit var positiveButtonLabel: String
    private lateinit var title: String
    private lateinit var siteRecord: SiteRecord

<span class="nc bnc" id="L45" title="All 2 branches missed.">    @Inject lateinit var imageManager: ImageManager</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">    @Inject lateinit var selectedSiteRepository: SelectedSiteRepository</span>

<span class="nc" id="L48">    override fun getTheme() = R.style.WordPress_FullscreenDialog_NoTitle</span>

    interface QuickStartPromptClickInterface {
        fun onNegativeClicked(instanceTag: String)
        fun onPositiveClicked(instanceTag: String)
    }

    @Suppress(&quot;LongParameterList&quot;)
    @JvmOverloads
<span class="nc" id="L57">    fun initialize(</span>
        tag: String,
        title: String,
        message: String,
        positiveButtonLabel: String,
<span class="nc" id="L62">        @DrawableRes drawableResId: Int = UNDEFINED_RES_ID,</span>
<span class="nc" id="L63">        negativeButtonLabel: String = &quot;&quot;</span>
    ) {
<span class="nc" id="L65">        this.fragmentTag = tag</span>
<span class="nc" id="L66">        this.title = title</span>
<span class="nc" id="L67">        this.message = message</span>
<span class="nc" id="L68">        this.positiveButtonLabel = positiveButtonLabel</span>
<span class="nc" id="L69">        this.negativeButtonLabel = negativeButtonLabel</span>
<span class="nc" id="L70">        this.drawableResId = drawableResId</span>
<span class="nc" id="L71">    }</span>

    override fun onAttach(context: Context) {
<span class="nc" id="L74">        super.onAttach(context)</span>
<span class="nc" id="L75">        initDagger()</span>
<span class="nc" id="L76">    }</span>

    private fun initDagger() {
<span class="nc bnc" id="L79" title="All 2 branches missed.">        (requireActivity().application as WordPress).component().inject(this)</span>
<span class="nc" id="L80">    }</span>

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L83">        super.onCreate(savedInstanceState)</span>
<span class="nc" id="L84">        this.siteRecord = SiteRecord(selectedSiteRepository.getSelectedSite())</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">            fragmentTag = requireNotNull(savedInstanceState.getString(STATE_KEY_TAG))</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">            title = requireNotNull(savedInstanceState.getString(STATE_KEY_TITLE))</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">            message = requireNotNull(savedInstanceState.getString(STATE_KEY_MESSAGE))</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">            positiveButtonLabel = requireNotNull(savedInstanceState.getString(STATE_KEY_POSITIVE_BUTTON_LABEL))</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">            negativeButtonLabel = requireNotNull(savedInstanceState.getString(STATE_KEY_NEGATIVE_BUTTON_LABEL))</span>
<span class="nc" id="L91">            drawableResId = savedInstanceState.getInt(STATE_KEY_DRAWABLE_RES_ID)</span>
        }
<span class="nc" id="L93">    }</span>

    override fun onSaveInstanceState(outState: Bundle) {
<span class="nc bnc" id="L96" title="All 2 branches missed.">        outState.putString(STATE_KEY_TAG, fragmentTag)</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        outState.putString(STATE_KEY_TITLE, title)</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        outState.putString(STATE_KEY_MESSAGE, message)</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">        outState.putString(STATE_KEY_POSITIVE_BUTTON_LABEL, positiveButtonLabel)</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        outState.putString(STATE_KEY_NEGATIVE_BUTTON_LABEL, negativeButtonLabel)</span>
<span class="nc" id="L101">        outState.putInt(STATE_KEY_DRAWABLE_RES_ID, drawableResId)</span>

<span class="nc" id="L103">        super.onSaveInstanceState(outState)</span>
<span class="nc" id="L104">    }</span>

    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {
<span class="nc" id="L107">        val view = inflater.inflate(R.layout.quick_start_prompt_dialog_fragment, container, false)</span>
<span class="nc" id="L108">        initializeView(view)</span>
<span class="nc" id="L109">        return view</span>
    }

    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
<span class="nc" id="L113">        val dialog = super.onCreateDialog(savedInstanceState)</span>
<span class="nc" id="L114">        dialog.setCanceledOnTouchOutside(false)</span>
<span class="nc" id="L115">        dialog.setCancelable(false)</span>
<span class="nc" id="L116">        return dialog</span>
    }

    private fun initializeView(view: View) {
<span class="nc" id="L120">        updateSiteLayout(view)</span>
<span class="nc" id="L121">        updateDialogTitle(view)</span>
<span class="nc" id="L122">        updateDialogDescription(view)</span>
<span class="nc" id="L123">        updatePositiveButton(view)</span>
<span class="nc" id="L124">        updateNegativeButton(view)</span>
<span class="nc" id="L125">    }</span>

    private fun updateSiteLayout(view: View) {
<span class="nc" id="L128">        val siteLayout = view.findViewById&lt;LinearLayout&gt;(R.id.site_layout)</span>
<span class="nc" id="L129">        val txtTitle = siteLayout.findViewById&lt;TextView&gt;(R.id.text_title)</span>
<span class="nc" id="L130">        val txtDomain = view.findViewById&lt;TextView&gt;(R.id.text_domain)</span>
<span class="nc" id="L131">        val imgBlavatar = view.findViewById&lt;ImageView&gt;(R.id.image_blavatar)</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">        txtTitle.text = siteRecord.blogNameOrHomeURL</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        txtDomain.text = siteRecord.homeURL</span>
<span class="nc" id="L135">        imageManager.loadImageWithCorners(</span>
<span class="nc" id="L136">                imgBlavatar,</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">                siteRecord.blavatarType,</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">                siteRecord.blavatarUrl,</span>
<span class="nc" id="L139">                DisplayUtils.dpToPx(requireContext(), SITE_IMAGE_CORNER_RADIUS_IN_DP)</span>
        )
<span class="nc" id="L141">    }</span>

    private fun updateDialogTitle(view: View) {
<span class="nc" id="L144">        val dialogTitle = view.findViewById&lt;WPTextView&gt;(R.id.quick_start_prompt_dialog_title)</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        dialogTitle.text = title</span>
<span class="nc" id="L146">    }</span>

    private fun updateDialogDescription(view: View) {
<span class="nc" id="L149">        val description = view.findViewById&lt;WPTextView&gt;(R.id.quick_start_prompt_dialog_description)</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        description.text = message</span>
<span class="nc" id="L151">    }</span>

    private fun updatePositiveButton(view: View) {
<span class="nc" id="L154">        val buttonPositive = view.findViewById&lt;Button&gt;(R.id.quick_start_prompt_dialog_button_positive)</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        buttonPositive.text = positiveButtonLabel</span>
<span class="nc" id="L156">        buttonPositive.setOnClickListener {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (activity is QuickStartPromptClickInterface) {</span>
<span class="nc bnc" id="L158" title="All 4 branches missed.">                (activity as QuickStartPromptClickInterface).onPositiveClicked(fragmentTag)</span>
            }
<span class="nc" id="L160">            this.dismiss()</span>
<span class="nc" id="L161">        }</span>
<span class="nc" id="L162">    }</span>

    private fun updateNegativeButton(view: View) {
<span class="nc" id="L165">        val buttonNegative = view.findViewById&lt;Button&gt;(R.id.quick_start_prompt_dialog_button_negative)</span>
<span class="nc bnc" id="L166" title="All 6 branches missed.">        if (negativeButtonLabel.isNotEmpty()) {</span>
<span class="nc" id="L167">            buttonNegative.visibility = View.VISIBLE</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">            buttonNegative.text = negativeButtonLabel</span>
<span class="nc" id="L169">            buttonNegative.setOnClickListener {</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">                if (activity is QuickStartPromptClickInterface) {</span>
<span class="nc bnc" id="L171" title="All 4 branches missed.">                    (activity as QuickStartPromptClickInterface).onNegativeClicked(fragmentTag)</span>
                }
<span class="nc" id="L173">                this.dismiss()</span>
<span class="nc" id="L174">            }</span>
        }
<span class="nc" id="L176">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>