<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PublicizeConnection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.models</a> &gt; <span class="el_source">PublicizeConnection.java</span></div><h1>PublicizeConnection.java</h1><pre class="source lang-java linenums">package org.wordpress.android.models;

import android.text.TextUtils;

import androidx.annotation.NonNull;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.wordpress.android.util.JSONUtils;
import org.wordpress.android.util.StringUtils;

<span class="nc" id="L13">public class PublicizeConnection {</span>
<span class="nc" id="L14">    public enum ConnectStatus {</span>
<span class="nc" id="L15">        OK {</span>
            public String toString() {
<span class="nc" id="L17">                return &quot;ok&quot;;</span>
            }
        },
<span class="nc" id="L20">        BROKEN {</span>
            public String toString() {
<span class="nc" id="L22">                return &quot;broken&quot;;</span>
            }
        },
<span class="nc" id="L25">        MUST_DISCONNECT {</span>
            public String toString() {
<span class="nc" id="L27">                return &quot;must-disconnect&quot;;</span>
            }
        }
    }

    public int connectionId;
    public long siteId;
    public int keyringConnectionId;
    public int keyringConnectionUserId;

    // `user_id` is the ID of the user that the connection belongs to, it will be `0` when `shared`
    // is `true`. only connections belonging to the current user and shared connections should be
    // available to a user
    public int userId;
    public boolean isShared;

    private String mService;
    private String mLabel;
    private String mExternalId;
    private String mExternalName;
    private String mExternalDisplayName;
    private String mExternalProfilePictureUrl;
    private long[] mSites;

    // `status` can be `ok` or `broken` -- `broken` means the connection needs
    // to be re-established via the `refresh_URL`
    private String mStatus;
    private String mRefreshUrl;

    public String getService() {
<span class="nc" id="L57">        return StringUtils.notNullStr(mService);</span>
    }

    public void setService(String service) {
<span class="nc" id="L61">        this.mService = StringUtils.notNullStr(service);</span>
<span class="nc" id="L62">    }</span>

    public String getLabel() {
<span class="nc" id="L65">        return StringUtils.notNullStr(mLabel);</span>
    }

    public void setLabel(String label) {
<span class="nc" id="L69">        this.mLabel = StringUtils.notNullStr(label);</span>
<span class="nc" id="L70">    }</span>

    public String getExternalName() {
<span class="nc" id="L73">        return StringUtils.notNullStr(mExternalName);</span>
    }

    public void setExternalName(String name) {
<span class="nc" id="L77">        this.mExternalName = StringUtils.notNullStr(name);</span>
<span class="nc" id="L78">    }</span>

    public String getExternalDisplayName() {
<span class="nc" id="L81">        return StringUtils.notNullStr(mExternalDisplayName);</span>
    }

    public void setExternalDisplayName(String name) {
<span class="nc" id="L85">        this.mExternalDisplayName = StringUtils.notNullStr(name);</span>
<span class="nc" id="L86">    }</span>

    public boolean hasExternalDisplayName() {
<span class="nc bnc" id="L89" title="All 2 branches missed.">        return !TextUtils.isEmpty(mExternalDisplayName);</span>
    }

    public String getExternalId() {
<span class="nc" id="L93">        return StringUtils.notNullStr(mExternalId);</span>
    }

    public void setExternalId(String id) {
<span class="nc" id="L97">        this.mExternalId = StringUtils.notNullStr(id);</span>
<span class="nc" id="L98">    }</span>

    public String getRefreshUrl() {
<span class="nc" id="L101">        return StringUtils.notNullStr(mRefreshUrl);</span>
    }

    public void setRefreshUrl(String url) {
<span class="nc" id="L105">        this.mRefreshUrl = StringUtils.notNullStr(url);</span>
<span class="nc" id="L106">    }</span>

    public boolean hasRefreshUrl() {
<span class="nc bnc" id="L109" title="All 2 branches missed.">        return !TextUtils.isEmpty(mRefreshUrl);</span>
    }

    public String getExternalProfilePictureUrl() {
<span class="nc" id="L113">        return StringUtils.notNullStr(mExternalProfilePictureUrl);</span>
    }

    public void setExternalProfilePictureUrl(String url) {
<span class="nc" id="L117">        this.mExternalProfilePictureUrl = StringUtils.notNullStr(url);</span>
<span class="nc" id="L118">    }</span>

    public boolean hasExternalProfilePictureUrl() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        return !TextUtils.isEmpty(mExternalProfilePictureUrl);</span>
    }

    public String getStatus() {
<span class="nc" id="L125">        return StringUtils.notNullStr(mStatus);</span>
    }

    public void setStatus(String status) {
<span class="nc" id="L129">        this.mStatus = StringUtils.notNullStr(status);</span>
<span class="nc" id="L130">    }</span>

    public ConnectStatus getStatusEnum() {
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (getStatus().equalsIgnoreCase(ConnectStatus.OK.toString())) {</span>
<span class="nc" id="L134">            return ConnectStatus.OK;</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        } else if (getStatus().equalsIgnoreCase(ConnectStatus.MUST_DISCONNECT.toString())) {</span>
<span class="nc" id="L136">            return ConnectStatus.MUST_DISCONNECT;</span>
        } else {
<span class="nc" id="L138">            return ConnectStatus.BROKEN;</span>
        }
    }

    public void setStatusEnum(@NonNull ConnectStatus status) {
<span class="nc" id="L143">        this.mStatus = status.toString();</span>
<span class="nc" id="L144">    }</span>

    public boolean isSameAs(PublicizeConnection other) {
<span class="nc bnc" id="L147" title="All 12 branches missed.">        return other != null</span>
               &amp;&amp; other.connectionId == this.connectionId
               &amp;&amp; other.userId == this.userId
               &amp;&amp; other.keyringConnectionId == this.keyringConnectionId
               &amp;&amp; other.keyringConnectionUserId == this.keyringConnectionUserId
               &amp;&amp; other.isShared == this.isShared
<span class="nc bnc" id="L153" title="All 2 branches missed.">               &amp;&amp; other.getStatus().equals(this.getStatus())</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">               &amp;&amp; other.getExternalDisplayName().equals(this.getExternalDisplayName())</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">               &amp;&amp; other.getExternalName().equals(this.getExternalName())</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">               &amp;&amp; other.getLabel().equals(this.getLabel())</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">               &amp;&amp; other.getExternalProfilePictureUrl().equals(this.getExternalProfilePictureUrl())</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">               &amp;&amp; other.getRefreshUrl().equals(this.getRefreshUrl())</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">               &amp;&amp; other.getService().equals(this.getService());</span>
    }

    public void setSites(long[] sites) {
<span class="nc" id="L163">        mSites = sites;</span>
<span class="nc" id="L164">    }</span>

    public long[] getSites() {
<span class="nc" id="L167">        return mSites;</span>
    }

    public boolean isInSite(long remoteSiteId) {
<span class="nc bnc" id="L171" title="All 2 branches missed.">        for (int i = 0; i &lt; mSites.length; i++) {</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (remoteSiteId == mSites[i]) {</span>
<span class="nc" id="L173">                return true;</span>
            }
        }

<span class="nc" id="L177">        return false;</span>
    }

    /*
     * passed JSON is a single connection from the response to sites/%d/publicize-connections
       {&quot;ID&quot;:12783250,
        &quot;site_ID&quot;:52451176,
        &quot;user_ID&quot;:5399133,
        &quot;keyring_connection_ID&quot;:12781808,
        &quot;keyring_connection_user_ID&quot;:5399133,
        &quot;shared&quot;:false,
        &quot;service&quot;:&quot;twitter&quot;,
        &quot;label&quot;:&quot;Twitter&quot;,
        &quot;issued&quot;:&quot;2015-11-02 17:46:42&quot;,
        &quot;expires&quot;:&quot;0000-00-00 00:00:00&quot;,
        &quot;external_ID&quot;:&quot;4098796763&quot;,
        &quot;external_name&quot;:&quot;AutomatticNickB&quot;,
        &quot;external_display&quot;:&quot;@AutomatticNickB&quot;,
        &quot;external_profile_picture&quot;:&quot;https://pbs.twimg.com/profile_images/661237406360727552/RycwaFzg.png&quot;,
        &quot;external_profile_URL&quot;:&quot;http://twitter.com/AutomatticNickB&quot;,
        &quot;external_follower_count&quot;:null,
        &quot;status&quot;:&quot;ok&quot;,
        &quot;refresh_URL&quot;:&quot;https://public-api.wordpress.com/connect/?action=request&amp;kr_nonce=
        10c147b6fb&amp;nonce=44fce811bb&amp;refresh=1&amp;for=connect&amp;service=twitter&amp;kr_blog_nonce=
        e3686ea86a&amp;magic=keyring&amp;blog=52451176&quot;,
        &quot;meta&quot;:{
            &quot;links&quot;:{
                &quot;self&quot;:&quot;https://public-api.wordpress.com/rest/v1.1/sites/52451176/publicize-connections/12783250&quot;,
                &quot;help&quot;:&quot;https://public-api.wordpress.com/rest/v1.1/sites/52451176/publicize-connections/12783250/help&quot;,
                &quot;site&quot;:&quot;https://public-api.wordpress.com/rest/v1.1/sites/52451176&quot;,
                &quot;service&quot;:&quot;https://public-api.wordpress.com/rest/v1.1/meta/external-services/twitter&quot;,
                &quot;keyring-connection&quot;:&quot;https://public-api.wordpress.com/rest/v1.1/me/keyring-connections/12781808&quot;}
             }}]}
     */
    public static PublicizeConnection fromJson(JSONObject json) {
<span class="nc" id="L212">        PublicizeConnection connection = new PublicizeConnection();</span>

<span class="nc" id="L214">        connection.connectionId = json.optInt(&quot;ID&quot;);</span>
<span class="nc" id="L215">        connection.siteId = json.optLong(&quot;site_ID&quot;);</span>
<span class="nc" id="L216">        connection.userId = json.optInt(&quot;user_ID&quot;);</span>
<span class="nc" id="L217">        connection.keyringConnectionId = json.optInt(&quot;keyring_connection_ID&quot;);</span>
<span class="nc" id="L218">        connection.keyringConnectionUserId = json.optInt(&quot;keyring_connection_user_ID&quot;);</span>

<span class="nc" id="L220">        connection.isShared = JSONUtils.getBool(json, &quot;shared&quot;);</span>

<span class="nc" id="L222">        connection.mService = json.optString(&quot;service&quot;);</span>
<span class="nc" id="L223">        connection.mLabel = json.optString(&quot;label&quot;);</span>
<span class="nc" id="L224">        connection.mExternalId = json.optString(&quot;external_ID&quot;);</span>
<span class="nc" id="L225">        connection.mExternalName = json.optString(&quot;external_name&quot;);</span>
<span class="nc" id="L226">        connection.mExternalDisplayName = json.optString(&quot;external_display&quot;);</span>
<span class="nc" id="L227">        connection.mExternalProfilePictureUrl = json.optString(&quot;external_profile_picture&quot;);</span>
<span class="nc" id="L228">        connection.mStatus = json.optString(&quot;status&quot;);</span>
<span class="nc" id="L229">        connection.mRefreshUrl = json.optString(&quot;refresh_URL&quot;);</span>

        try {
<span class="nc" id="L232">            JSONArray jsonSitesArray = json.getJSONArray(&quot;sites&quot;);</span>
<span class="nc" id="L233">            connection.mSites = getSitesArrayFromJson(jsonSitesArray);</span>
<span class="nc" id="L234">        } catch (JSONException e) {</span>
<span class="nc" id="L235">            connection.mSites = new long[0];</span>
<span class="nc" id="L236">            e.printStackTrace();</span>
<span class="nc" id="L237">        }</span>

<span class="nc" id="L239">        return connection;</span>
    }

    public static void updateConnectionfromExternalJson(PublicizeConnection connection, JSONObject json) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (connection == null) {</span>
<span class="nc" id="L244">            return;</span>
        }

<span class="nc" id="L247">        connection.mExternalId = json.optString(&quot;external_ID&quot;);</span>
<span class="nc" id="L248">        connection.mExternalName = json.optString(&quot;external_name&quot;);</span>
<span class="nc" id="L249">        connection.mExternalProfilePictureUrl = json.optString(&quot;external_profile_picture&quot;);</span>
<span class="nc" id="L250">    }</span>

    private static long[] getSitesArrayFromJson(JSONArray jsonArray) throws JSONException {
<span class="nc" id="L253">        long[] sitesArray = new long[jsonArray.length()];</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">        for (int i = 0; i &lt; jsonArray.length(); i++) {</span>
<span class="nc" id="L255">            sitesArray[i] = jsonArray.getLong(i);</span>
        }

<span class="nc" id="L258">        return sitesArray;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>