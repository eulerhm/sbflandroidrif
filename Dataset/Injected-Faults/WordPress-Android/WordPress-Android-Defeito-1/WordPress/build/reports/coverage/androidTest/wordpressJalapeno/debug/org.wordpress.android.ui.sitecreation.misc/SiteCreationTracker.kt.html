<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SiteCreationTracker.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.sitecreation.misc</a> &gt; <span class="el_source">SiteCreationTracker.kt</span></div><h1>SiteCreationTracker.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.sitecreation.misc

import org.wordpress.android.analytics.AnalyticsTracker
import org.wordpress.android.ui.layoutpicker.LayoutPickerTracker
import org.wordpress.android.ui.sitecreation.misc.SiteCreationErrorType.INTERNET_UNAVAILABLE_ERROR
import org.wordpress.android.ui.sitecreation.misc.SiteCreationErrorType.UNKNOWN
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.CHOSEN_DOMAIN
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.FILTER
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.LOCATION
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.PREVIEW_MODE
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.RECOMMENDED
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.SEARCH_TERM
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.SEGMENT_ID
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.SEGMENT_NAME
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.SELECTED_FILTERS
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.SITE_NAME
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.TEMPLATE
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.THUMBNAIL_MODE
import org.wordpress.android.ui.sitecreation.misc.SiteCreationTracker.PROPERTY.VERTICAL_SLUG
import org.wordpress.android.util.analytics.AnalyticsTrackerWrapper
import javax.inject.Inject
import javax.inject.Singleton

enum class SiteCreationErrorType {
<span class="nc" id="L25">    INTERNET_UNAVAILABLE_ERROR,</span>
<span class="nc" id="L26">    UNKNOWN;</span>
}

private const val DESIGN_ERROR_CONTEXT = &quot;design&quot;
private const val SITE_CREATION_LOCATION = &quot;site_creation&quot;
private const val SITE_CREATION_SOURCE = &quot;source&quot;

<span class="nc" id="L33">@Singleton</span>
@Suppress(&quot;TooManyFunctions&quot;)
<span class="nc" id="L35">class SiteCreationTracker @Inject constructor(val tracker: AnalyticsTrackerWrapper) : LayoutPickerTracker {</span>
<span class="nc" id="L36">    private enum class PROPERTY(val key: String) {</span>
<span class="nc" id="L37">        TEMPLATE(&quot;template&quot;),</span>
<span class="nc" id="L38">        SEGMENT_NAME(&quot;segment_name&quot;),</span>
<span class="nc" id="L39">        SEGMENT_ID(&quot;segment_id&quot;),</span>
<span class="nc" id="L40">        CHOSEN_DOMAIN(&quot;chosen_domain&quot;),</span>
<span class="nc" id="L41">        SEARCH_TERM(&quot;search_term&quot;),</span>
<span class="nc" id="L42">        THUMBNAIL_MODE(&quot;thumbnail_mode&quot;),</span>
<span class="nc" id="L43">        PREVIEW_MODE(&quot;preview_mode&quot;),</span>
<span class="nc" id="L44">        LOCATION(&quot;location&quot;),</span>
<span class="nc" id="L45">        FILTER(&quot;filter&quot;),</span>
<span class="nc" id="L46">        SELECTED_FILTERS(&quot;selected_filters&quot;),</span>
<span class="nc" id="L47">        VERTICAL_SLUG(&quot;vertical_slug&quot;),</span>
<span class="nc" id="L48">        SITE_NAME(&quot;site_name&quot;),</span>
<span class="nc" id="L49">        RECOMMENDED(&quot;recommended&quot;)</span>
    }

    private var designSelectionSkipped: Boolean = false

    fun trackSiteCreationAccessed(siteCreationSource: SiteCreationSource) {
<span class="nc" id="L55">        tracker.track(</span>
<span class="nc" id="L56">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_ACCESSED,</span>
<span class="nc" id="L57">                mapOf(SITE_CREATION_SOURCE to siteCreationSource.label)</span>
        )
<span class="nc" id="L59">    }</span>

    fun trackSegmentsViewed() {
<span class="nc" id="L62">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SEGMENTS_VIEWED)</span>
<span class="nc" id="L63">    }</span>

    fun trackSegmentSelected(segmentName: String, segmentId: Long) {
<span class="nc" id="L66">        tracker.track(</span>
<span class="nc" id="L67">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SEGMENTS_SELECTED,</span>
<span class="nc" id="L68">                mapOf(</span>
<span class="nc" id="L69">                        SEGMENT_NAME.key to segmentName,</span>
<span class="nc" id="L70">                        SEGMENT_ID.key to segmentId</span>
                )
        )
<span class="nc" id="L73">    }</span>

    fun trackDomainsAccessed() {
<span class="nc" id="L76">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_DOMAINS_ACCESSED)</span>
<span class="nc" id="L77">    }</span>

    fun trackDomainSelected(chosenDomain: String, searchTerm: String) {
<span class="nc" id="L80">        tracker.track(</span>
<span class="nc" id="L81">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_DOMAINS_SELECTED,</span>
<span class="nc" id="L82">                mapOf(</span>
<span class="nc" id="L83">                        CHOSEN_DOMAIN.key to chosenDomain,</span>
<span class="nc" id="L84">                        SEARCH_TERM.key to searchTerm</span>
                )
        )
<span class="nc" id="L87">    }</span>

    fun trackPreviewLoading(template: String?) {
<span class="nc bnc" id="L90" title="All 4 branches missed.">        if (template == null || designSelectionSkipped) {</span>
<span class="nc" id="L91">            tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_LOADING)</span>
        } else {
<span class="nc" id="L93">            tracker.track(</span>
<span class="nc" id="L94">                    AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_LOADING,</span>
<span class="nc" id="L95">                    mapOf(TEMPLATE.key to template)</span>
            )
        }
<span class="nc" id="L98">    }</span>

    fun trackPreviewWebviewShown(template: String?) {
<span class="nc bnc" id="L101" title="All 4 branches missed.">        if (template == null || designSelectionSkipped) {</span>
<span class="nc" id="L102">            tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_PREVIEW_VIEWED)</span>
        } else {
<span class="nc" id="L104">            tracker.track(</span>
<span class="nc" id="L105">                    AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_PREVIEW_VIEWED,</span>
<span class="nc" id="L106">                    mapOf(TEMPLATE.key to template)</span>
            )
        }
<span class="nc" id="L109">    }</span>

    fun trackPreviewWebviewFullyLoaded(template: String?) {
<span class="nc bnc" id="L112" title="All 4 branches missed.">        if (template == null || designSelectionSkipped) {</span>
<span class="nc" id="L113">            tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_PREVIEW_LOADED)</span>
        } else {
<span class="nc" id="L115">            tracker.track(</span>
<span class="nc" id="L116">                    AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SUCCESS_PREVIEW_LOADED,</span>
<span class="nc" id="L117">                    mapOf(TEMPLATE.key to template)</span>
            )
        }
<span class="nc" id="L120">    }</span>

    fun trackPreviewOkButtonTapped() {
<span class="nc" id="L123">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_PREVIEW_OK_BUTTON_TAPPED)</span>
<span class="nc" id="L124">    }</span>

    /**
     * This stat is part of a funnel that provides critical information.  Before
     * making ANY modification to this stat please refer to: p4qSXL-35X-p2
     */
    fun trackSiteCreated(template: String?) {
<span class="nc bnc" id="L131" title="All 4 branches missed.">        if (template == null || designSelectionSkipped) {</span>
<span class="nc" id="L132">            tracker.track(AnalyticsTracker.Stat.SITE_CREATED)</span>
        } else {
<span class="nc" id="L134">            tracker.track(</span>
<span class="nc" id="L135">                    AnalyticsTracker.Stat.SITE_CREATED,</span>
<span class="nc" id="L136">                    mapOf(TEMPLATE.key to template)</span>
            )
        }
<span class="nc" id="L139">    }</span>

    fun trackFlowExited() {
<span class="nc" id="L142">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_EXITED)</span>
<span class="nc" id="L143">    }</span>

<span class="nc" id="L145">    fun trackErrorShown(errorContext: String, errorType: SiteCreationErrorType, errorDescription: String? = null) {</span>
<span class="nc" id="L146">        trackErrorShown(errorContext, errorType.toString().lowercase(), errorDescription)</span>
<span class="nc" id="L147">    }</span>

<span class="nc" id="L149">    fun trackErrorShown(errorContext: String, errorType: String, errorDescription: String? = null) {</span>
<span class="nc" id="L150">        tracker.track(</span>
<span class="nc" id="L151">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_ERROR_SHOWN,</span>
<span class="nc" id="L152">                errorContext,</span>
<span class="nc" id="L153">                errorType.lowercase(),</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">                errorDescription ?: &quot;&quot;</span>
        )
<span class="nc" id="L156">    }</span>

    fun trackSiteCreationServiceStateUpdated(props: Map&lt;String, *&gt;) {
<span class="nc" id="L159">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_BACKGROUND_SERVICE_UPDATED, props)</span>
<span class="nc" id="L160">    }</span>

    fun trackSiteDesignViewed(previewMode: String) {
<span class="nc" id="L163">        tracker.track(</span>
<span class="nc" id="L164">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_VIEWED,</span>
<span class="nc" id="L165">                mapOf(THUMBNAIL_MODE.key to previewMode)</span>
        )
<span class="nc" id="L167">    }</span>

    fun trackSiteDesignSkipped() {
<span class="nc" id="L170">        designSelectionSkipped = true</span>
<span class="nc" id="L171">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_SKIPPED)</span>
<span class="nc" id="L172">    }</span>

    fun trackSiteDesignSelected(template: String, recommended: Boolean) {
<span class="nc" id="L175">        designSelectionSkipped = false</span>
<span class="nc" id="L176">        tracker.track(</span>
<span class="nc" id="L177">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_SELECTED,</span>
<span class="nc" id="L178">                mapOf(TEMPLATE.key to template, RECOMMENDED.key to recommended)</span>
        )
<span class="nc" id="L180">    }</span>

    override fun trackPreviewViewed(template: String, mode: String) {
<span class="nc" id="L183">        tracker.track(</span>
<span class="nc" id="L184">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_PREVIEW_VIEWED,</span>
<span class="nc" id="L185">                mapOf(TEMPLATE.key to template, PREVIEW_MODE.key to mode)</span>
        )
<span class="nc" id="L187">    }</span>

    override fun trackPreviewLoading(template: String, mode: String) {
<span class="nc" id="L190">        tracker.track(</span>
<span class="nc" id="L191">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_PREVIEW_LOADING,</span>
<span class="nc" id="L192">                mapOf(TEMPLATE.key to template, PREVIEW_MODE.key to mode)</span>
        )
<span class="nc" id="L194">    }</span>

    override fun trackPreviewLoaded(template: String, mode: String) {
<span class="nc" id="L197">        tracker.track(</span>
<span class="nc" id="L198">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_PREVIEW_LOADED,</span>
<span class="nc" id="L199">                mapOf(TEMPLATE.key to template, PREVIEW_MODE.key to mode)</span>
        )
<span class="nc" id="L201">    }</span>

    override fun trackPreviewModeTapped(mode: String) {
<span class="nc" id="L204">        tracker.track(</span>
<span class="nc" id="L205">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_PREVIEW_MODE_BUTTON_TAPPED,</span>
<span class="nc" id="L206">                mapOf(PREVIEW_MODE.key to mode)</span>
        )
<span class="nc" id="L208">    }</span>

    override fun trackPreviewModeChanged(mode: String) {
<span class="nc" id="L211">        tracker.track(</span>
<span class="nc" id="L212">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_DESIGN_PREVIEW_MODE_CHANGED,</span>
<span class="nc" id="L213">                mapOf(PREVIEW_MODE.key to mode)</span>
        )
<span class="nc" id="L215">    }</span>

    override fun trackNoNetworkErrorShown(message: String) =
<span class="nc" id="L218">            trackErrorShown(DESIGN_ERROR_CONTEXT, INTERNET_UNAVAILABLE_ERROR, message)</span>

<span class="nc" id="L220">    override fun trackErrorShown(message: String) = trackErrorShown(DESIGN_ERROR_CONTEXT, UNKNOWN, message)</span>

    override fun filterSelected(filter: String, selectedFilters: List&lt;String&gt;) {
<span class="nc" id="L223">        tracker.track(</span>
<span class="nc" id="L224">                AnalyticsTracker.Stat.CATEGORY_FILTER_SELECTED,</span>
<span class="nc" id="L225">                mapOf(</span>
<span class="nc" id="L226">                        LOCATION.key to SITE_CREATION_LOCATION,</span>
<span class="nc" id="L227">                        FILTER.key to filter,</span>
<span class="nc" id="L228">                        SELECTED_FILTERS.key to selectedFilters.joinToString()</span>
                )
        )
<span class="nc" id="L231">    }</span>

    override fun filterDeselected(filter: String, selectedFilters: List&lt;String&gt;) {
<span class="nc" id="L234">        tracker.track(</span>
<span class="nc" id="L235">                AnalyticsTracker.Stat.CATEGORY_FILTER_DESELECTED,</span>
<span class="nc" id="L236">                mapOf(</span>
<span class="nc" id="L237">                        LOCATION.key to SITE_CREATION_LOCATION,</span>
<span class="nc" id="L238">                        FILTER.key to filter,</span>
<span class="nc" id="L239">                        SELECTED_FILTERS.key to selectedFilters.joinToString()</span>
                )
        )
<span class="nc" id="L242">    }</span>

    fun trackSiteIntentQuestionViewed() {
<span class="nc" id="L245">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_VIEWED)</span>
<span class="nc" id="L246">    }</span>

    fun trackSiteIntentQuestionCanceled() {
<span class="nc" id="L249">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_CANCELED)</span>
<span class="nc" id="L250">    }</span>

    fun trackSiteIntentQuestionSkipped() {
<span class="nc" id="L253">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_SKIPPED)</span>
<span class="nc" id="L254">    }</span>

    fun trackSiteIntentQuestionSearchFocused() {
<span class="nc" id="L257">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_SEARCH_FOCUSED)</span>
<span class="nc" id="L258">    }</span>

    fun trackSiteIntentQuestionCustomVerticalSelected(searchInput: String) {
<span class="nc" id="L261">        tracker.track(</span>
<span class="nc" id="L262">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_CUSTOM_VERTICAL_SELECTED,</span>
<span class="nc" id="L263">                mapOf(SEARCH_TERM.key to searchInput)</span>
        )
<span class="nc" id="L265">    }</span>

    fun trackSiteIntentQuestionVerticalSelected(verticalSlug: String) {
<span class="nc" id="L268">        tracker.track(</span>
<span class="nc" id="L269">                AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_INTENT_QUESTION_VERTICAL_SELECTED,</span>
<span class="nc" id="L270">                mapOf(VERTICAL_SLUG.key to verticalSlug)</span>
        )
<span class="nc" id="L272">    }</span>

    // region Site Name

    fun trackSiteNameViewed() {
<span class="nc" id="L277">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_NAME_VIEWED)</span>
<span class="nc" id="L278">    }</span>

    fun trackSiteNameCanceled() {
<span class="nc" id="L281">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_NAME_CANCELED)</span>
<span class="nc" id="L282">    }</span>

    fun trackSiteNameSkipped() {
<span class="nc" id="L285">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_NAME_SKIPPED)</span>
<span class="nc" id="L286">    }</span>

    fun trackSiteNameEntered(siteName: String?) {
<span class="nc" id="L289">        tracker.track(AnalyticsTracker.Stat.ENHANCED_SITE_CREATION_SITE_NAME_ENTERED, mapOf(SITE_NAME.key to siteName))</span>
<span class="nc" id="L290">    }</span>

    // endregion
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>