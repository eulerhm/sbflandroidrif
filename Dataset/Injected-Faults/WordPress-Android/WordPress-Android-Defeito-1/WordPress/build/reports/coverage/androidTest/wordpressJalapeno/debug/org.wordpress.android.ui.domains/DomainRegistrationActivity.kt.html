<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DomainRegistrationActivity.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.domains</a> &gt; <span class="el_source">DomainRegistrationActivity.kt</span></div><h1>DomainRegistrationActivity.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.domains

import android.content.Intent
import android.os.Bundle
import android.view.MenuItem
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.databinding.DomainRegistrationActivityBinding
import org.wordpress.android.fluxc.model.SiteModel
import org.wordpress.android.ui.LocaleAwareActivity
import org.wordpress.android.ui.ScrollableViewInitializedListener
import org.wordpress.android.ui.domains.DomainRegistrationCheckoutWebViewActivity.OpenCheckout.CheckoutDetails
import org.wordpress.android.ui.domains.DomainRegistrationNavigationAction.FinishDomainRegistration
import org.wordpress.android.ui.domains.DomainRegistrationNavigationAction.OpenDomainRegistrationCheckout
import org.wordpress.android.ui.domains.DomainRegistrationNavigationAction.OpenDomainRegistrationDetails
import org.wordpress.android.ui.domains.DomainRegistrationNavigationAction.OpenDomainRegistrationResult
import org.wordpress.android.ui.domains.DomainRegistrationNavigationAction.OpenDomainSuggestions
import org.wordpress.android.viewmodel.observeEvent
import javax.inject.Inject

@Suppress(&quot;TooManyFunctions&quot;)
<span class="nc" id="L24">class DomainRegistrationActivity : LocaleAwareActivity(), ScrollableViewInitializedListener {</span>
    enum class DomainRegistrationPurpose {
<span class="nc" id="L26">        AUTOMATED_TRANSFER,</span>
<span class="nc" id="L27">        CTA_DOMAIN_CREDIT_REDEMPTION,</span>
<span class="nc" id="L28">        DOMAIN_PURCHASE</span>
    }

    companion object {
        const val RESULT_REGISTERED_DOMAIN_EMAIL = &quot;RESULT_REGISTERED_DOMAIN_EMAIL&quot;
        const val DOMAIN_REGISTRATION_PURPOSE_KEY = &quot;DOMAIN_REGISTRATION_PURPOSE_KEY&quot;
    }

<span class="nc bnc" id="L36" title="All 2 branches missed.">    @Inject internal lateinit var viewModelFactory: ViewModelProvider.Factory</span>
    private lateinit var viewModel: DomainRegistrationMainViewModel
    private lateinit var binding: DomainRegistrationActivityBinding

<span class="nc" id="L40">    private val openCheckout = registerForActivityResult(DomainRegistrationCheckoutWebViewActivity.OpenCheckout()) {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">        it?.let {</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">            viewModel.completeDomainRegistration(it)</span>
<span class="nc" id="L43">        }</span>
<span class="nc" id="L44">    }</span>

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L47">        super.onCreate(savedInstanceState)</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">        (application as WordPress).component().inject(this)</span>
<span class="nc" id="L49">        with(DomainRegistrationActivityBinding.inflate(layoutInflater)) {</span>
<span class="nc" id="L50">            setContentView(root)</span>
<span class="nc" id="L51">            binding = this</span>

<span class="nc bnc" id="L53" title="All 2 branches missed.">            val site = intent.getSerializableExtra(WordPress.SITE) as SiteModel</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">            val domainRegistrationPurpose = intent.getSerializableExtra(DOMAIN_REGISTRATION_PURPOSE_KEY)</span>
                    as DomainRegistrationPurpose

<span class="nc" id="L57">            setupToolbar()</span>
<span class="nc" id="L58">            setupViewModel(site, domainRegistrationPurpose)</span>
<span class="nc" id="L59">            setupObservers()</span>
<span class="nc" id="L60">        }</span>
<span class="nc" id="L61">    }</span>

    private fun DomainRegistrationActivityBinding.setupToolbar() {
<span class="nc" id="L64">        setSupportActionBar(toolbarDomain)</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        supportActionBar?.let {</span>
<span class="nc" id="L66">            it.setHomeButtonEnabled(true)</span>
<span class="nc" id="L67">            it.setDisplayHomeAsUpEnabled(true)</span>
<span class="nc" id="L68">        }</span>
<span class="nc" id="L69">    }</span>

    private fun setupViewModel(site: SiteModel, domainRegistrationPurpose: DomainRegistrationPurpose) {
<span class="nc" id="L72">        viewModel = ViewModelProvider(this, viewModelFactory).get(DomainRegistrationMainViewModel::class.java)</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        viewModel.start(site, domainRegistrationPurpose)</span>
<span class="nc" id="L74">    }</span>

    private fun setupObservers() {
<span class="nc bnc" id="L77" title="All 2 branches missed.">        viewModel.onNavigation.observeEvent(this) {</span>
<span class="nc" id="L78">            when (it) {</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">                is OpenDomainSuggestions -&gt; showDomainSuggestions()</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">                is OpenDomainRegistrationCheckout -&gt; openDomainRegistrationCheckoutWebView(it.site, it.details)</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">                is OpenDomainRegistrationDetails -&gt; showDomainRegistrationDetails(it.details)</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">                is OpenDomainRegistrationResult -&gt; showDomainRegistrationResult(it.event)</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">                is FinishDomainRegistration -&gt; finishDomainRegistration(it.event)</span>
            }
<span class="nc" id="L85">        }</span>
<span class="nc" id="L86">    }</span>

    private fun showDomainSuggestions() {
<span class="nc" id="L89">        showFragment(DomainSuggestionsFragment.TAG, true) {</span>
<span class="nc" id="L90">            DomainSuggestionsFragment.newInstance()</span>
        }
<span class="nc" id="L92">    }</span>

    private fun openDomainRegistrationCheckoutWebView(site: SiteModel, details: DomainProductDetails) {
<span class="nc" id="L95">        openCheckout.launch(CheckoutDetails(site, details.domainName))</span>
<span class="nc" id="L96">    }</span>

    private fun showDomainRegistrationDetails(details: DomainProductDetails) {
<span class="nc" id="L99">        showFragment(DomainRegistrationDetailsFragment.TAG) {</span>
<span class="nc" id="L100">            DomainRegistrationDetailsFragment.newInstance(details)</span>
        }
<span class="nc" id="L102">    }</span>

    private fun showDomainRegistrationResult(event: DomainRegistrationCompletedEvent) {
<span class="nc" id="L105">        showFragment(DomainRegistrationResultFragment.TAG) {</span>
<span class="nc" id="L106">            DomainRegistrationResultFragment.newInstance(event.domainName, event.email)</span>
        }
<span class="nc" id="L108">    }</span>

    private fun finishDomainRegistration(event: DomainRegistrationCompletedEvent) {
<span class="nc" id="L111">        setResult(RESULT_OK, Intent().putExtra(RESULT_REGISTERED_DOMAIN_EMAIL, event.email))</span>
<span class="nc" id="L112">        finish()</span>
<span class="nc" id="L113">    }</span>

<span class="nc" id="L115">    private fun showFragment(</span>
        tag: String,
<span class="nc" id="L117">        isRootFragment: Boolean = false,</span>
        factory: () -&gt; Fragment
<span class="nc" id="L119">    ) = with(supportFragmentManager) {</span>
<span class="nc" id="L120">        beginTransaction().apply {</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">            if (!isRootFragment) {</span>
<span class="nc" id="L122">                setCustomAnimations(</span>
<span class="nc" id="L123">                        R.anim.activity_slide_in_from_right,</span>
<span class="nc" id="L124">                        R.anim.activity_slide_out_to_left,</span>
<span class="nc" id="L125">                        R.anim.activity_slide_in_from_left,</span>
<span class="nc" id="L126">                        R.anim.activity_slide_out_to_right</span>
                )
<span class="nc" id="L128">                addToBackStack(null)</span>
            }
<span class="nc bnc" id="L130" title="All 2 branches missed.">            replace(R.id.fragment_container, findFragmentByTag(tag) ?: factory(), tag)</span>
<span class="nc" id="L131">            commit()</span>
<span class="nc" id="L132">        }</span>
<span class="nc" id="L133">    }</span>

    override fun onOptionsItemSelected(item: MenuItem): Boolean {
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (item.itemId == android.R.id.home) {</span>
<span class="nc" id="L137">            onBackPressed()</span>
<span class="nc" id="L138">            return true</span>
        }
<span class="nc" id="L140">        return super.onOptionsItemSelected(item)</span>
    }

    override fun onScrollableViewInitialized(containerId: Int) {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        binding.appbarMain.apply {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if (containerId == R.id.domain_suggestions_list) {</span>
<span class="nc" id="L146">                post {</span>
<span class="nc" id="L147">                    isLiftOnScroll = false</span>
<span class="nc" id="L148">                    setLifted(false)</span>
<span class="nc" id="L149">                    elevation = 0F</span>
<span class="nc" id="L150">                    requestLayout()</span>
<span class="nc" id="L151">                }</span>
            } else {
<span class="nc" id="L153">                post {</span>
<span class="nc" id="L154">                    isLiftOnScroll = true</span>
<span class="nc" id="L155">                    liftOnScrollTargetViewId = containerId</span>
<span class="nc" id="L156">                    requestLayout()</span>
<span class="nc" id="L157">                }</span>
            }
<span class="nc" id="L159">        }</span>
<span class="nc" id="L160">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>