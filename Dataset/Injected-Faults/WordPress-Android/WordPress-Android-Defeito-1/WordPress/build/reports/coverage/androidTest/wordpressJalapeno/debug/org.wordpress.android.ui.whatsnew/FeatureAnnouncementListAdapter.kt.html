<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FeatureAnnouncementListAdapter.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.whatsnew</a> &gt; <span class="el_source">FeatureAnnouncementListAdapter.kt</span></div><h1>FeatureAnnouncementListAdapter.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.whatsnew

import android.text.TextUtils
import android.view.LayoutInflater
import android.view.ViewGroup
import android.widget.ImageView
import android.widget.TextView
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.recyclerview.widget.RecyclerView
import androidx.recyclerview.widget.RecyclerView.Adapter
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.util.StringUtils
import org.wordpress.android.util.image.ImageManager
import org.wordpress.android.util.image.ImageType
import javax.inject.Inject

<span class="nc" id="L19">class FeatureAnnouncementListAdapter(</span>
<span class="nc" id="L20">    val fragment: Fragment</span>
<span class="nc" id="L21">) : Adapter&lt;RecyclerView.ViewHolder&gt;() {</span>
<span class="nc bnc" id="L22" title="All 2 branches missed.">    @Inject lateinit var imageManager: ImageManager</span>
<span class="nc bnc" id="L23" title="All 2 branches missed.">    @Inject lateinit var viewModelFactory: ViewModelProvider.Factory</span>
    private var viewModel: FeatureAnnouncementViewModel
<span class="nc" id="L25">    private val list = mutableListOf&lt;FeatureAnnouncementItem&gt;()</span>
<span class="nc" id="L26">    private var isFindOutMoreVisible = true</span>

<span class="nc" id="L28">    init {</span>
<span class="nc bnc" id="L29" title="All 2 branches missed.">        (fragment.requireActivity().applicationContext as WordPress).component().inject(this)</span>
<span class="nc" id="L30">        viewModel = ViewModelProvider(fragment, viewModelFactory)</span>
<span class="nc" id="L31">                .get(FeatureAnnouncementViewModel::class.java)</span>
<span class="nc" id="L32">    }</span>

    companion object {
        private const val VIEW_TYPE_FEATURE = 0
        private const val VIEW_TYPE_FOOTER = 1
    }

    override fun getItemViewType(position: Int): Int {
<span class="nc bnc" id="L40" title="All 4 branches missed.">        if (isFindOutMoreVisible &amp;&amp; position == itemCount - 1) {</span>
<span class="nc" id="L41">            return VIEW_TYPE_FOOTER</span>
        }
<span class="nc" id="L43">        return VIEW_TYPE_FEATURE</span>
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder {
<span class="nc bnc" id="L47" title="All 2 branches missed.">        return if (viewType == VIEW_TYPE_FEATURE) {</span>
<span class="nc" id="L48">            FeatureAnnouncementItemViewHolder(parent, imageManager)</span>
        } else {
<span class="nc" id="L50">            FeatureAnnouncementFooterViewHolder(parent, viewModel)</span>
        }
    }

    fun toggleFooterVisibility(isVisible: Boolean) {
<span class="nc" id="L55">        isFindOutMoreVisible = isVisible</span>
<span class="nc" id="L56">        notifyDataSetChanged()</span>
<span class="nc" id="L57">    }</span>

    override fun getItemCount(): Int {
<span class="nc bnc" id="L60" title="All 6 branches missed.">        if (list.isNotEmpty() &amp;&amp; isFindOutMoreVisible) {</span>
<span class="nc" id="L61">            return list.size + 1</span>
<span class="nc bnc" id="L62" title="All 6 branches missed.">        } else if (list.isNotEmpty() &amp;&amp; !isFindOutMoreVisible) {</span>
<span class="nc" id="L63">            return list.size</span>
        }

<span class="nc" id="L66">        return 0</span>
    }

    override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
<span class="nc bnc" id="L70" title="All 2 branches missed.">        if (holder is FeatureAnnouncementItemViewHolder) {</span>
<span class="nc" id="L71">            holder.bind(list[position])</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">        } else if (holder is FeatureAnnouncementFooterViewHolder) {</span>
<span class="nc" id="L73">            holder.bind()</span>
        }
<span class="nc" id="L75">    }</span>

    internal fun updateList(items: List&lt;FeatureAnnouncementItem&gt;) {
<span class="nc" id="L78">        list.clear()</span>
<span class="nc" id="L79">        list.addAll(items)</span>
<span class="nc" id="L80">        notifyDataSetChanged()</span>
<span class="nc" id="L81">    }</span>

<span class="nc" id="L83">    class FeatureAnnouncementItemViewHolder(</span>
        parent: ViewGroup,
<span class="nc" id="L85">        val imageManager: ImageManager</span>
<span class="nc" id="L86">    ) : RecyclerView.ViewHolder(</span>
<span class="nc" id="L87">            LayoutInflater.from(parent.context)</span>
<span class="nc" id="L88">                    .inflate(R.layout.feature_announcement_list_item, parent, false)</span>
    ) {
<span class="nc" id="L90">        private val featureIcon: ImageView = itemView.findViewById(R.id.feature_item_icon)</span>
<span class="nc" id="L91">        private val title: TextView = itemView.findViewById(R.id.feature_title)</span>
<span class="nc" id="L92">        private val subtitle: TextView = itemView.findViewById(R.id.feature_subtitle)</span>

        fun bind(featureAnnouncementItem: FeatureAnnouncementItem) {
<span class="nc" id="L95">            title.text = featureAnnouncementItem.title</span>
<span class="nc" id="L96">            subtitle.text = featureAnnouncementItem.subtitle</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (!TextUtils.isEmpty(featureAnnouncementItem.iconUrl)) {</span>
<span class="nc" id="L99">                imageManager.loadIntoCircle(</span>
<span class="nc" id="L100">                        featureIcon, ImageType.PLAN,</span>
<span class="nc" id="L101">                        StringUtils.notNullStr(featureAnnouncementItem.iconUrl)</span>
                )
            } else {
<span class="nc" id="L104">                val originalBase64String = StringUtils.notNullStr(featureAnnouncementItem.iconBase64)</span>
<span class="nc" id="L105">                val sanitizedBase64String = originalBase64String.replace(&quot;data:image/png;base64,&quot;, &quot;&quot;)</span>

<span class="nc" id="L107">                imageManager.loadBase64IntoCircle(featureIcon, ImageType.PLAN, sanitizedBase64String)</span>
            }
<span class="nc" id="L109">        }</span>
    }

<span class="nc" id="L112">    class FeatureAnnouncementFooterViewHolder(</span>
        parent: ViewGroup,
<span class="nc" id="L114">        val viewModel: FeatureAnnouncementViewModel</span>
    ) :
<span class="nc" id="L116">            RecyclerView.ViewHolder(</span>
<span class="nc" id="L117">                    LayoutInflater.from(parent.context)</span>
<span class="nc" id="L118">                            .inflate(R.layout.feature_announcement_list_footer, parent, false)</span>
            ) {
<span class="nc" id="L120">        private val findMoreButton: TextView = itemView.findViewById(R.id.feature_announcement_find_mode_button)</span>

        fun bind() {
<span class="nc" id="L123">            findMoreButton.setOnClickListener {</span>
<span class="nc" id="L124">                viewModel.onFindMoreButtonPressed()</span>
<span class="nc" id="L125">            }</span>
<span class="nc" id="L126">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>