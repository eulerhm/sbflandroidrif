<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PublicizeConnectionAdapter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.publicize.adapters</a> &gt; <span class="el_source">PublicizeConnectionAdapter.java</span></div><h1>PublicizeConnectionAdapter.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.publicize.adapters;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.recyclerview.widget.RecyclerView;

import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.datasets.PublicizeTable;
import org.wordpress.android.models.PublicizeConnection;
import org.wordpress.android.models.PublicizeConnection.ConnectStatus;
import org.wordpress.android.models.PublicizeConnectionList;
import org.wordpress.android.models.PublicizeService;
import org.wordpress.android.ui.publicize.ConnectButton;
import org.wordpress.android.ui.publicize.PublicizeActions;
import org.wordpress.android.ui.publicize.PublicizeConstants;
import org.wordpress.android.ui.publicize.PublicizeConstants.ConnectAction;
import org.wordpress.android.util.image.ImageManager;
import org.wordpress.android.util.image.ImageType;

import javax.inject.Inject;

public class PublicizeConnectionAdapter extends RecyclerView.Adapter&lt;PublicizeConnectionAdapter.ConnectionViewHolder&gt; {
    public interface OnAdapterLoadedListener {
        void onAdapterLoaded(boolean isEmpty);
    }

<span class="nc" id="L34">    private final PublicizeConnectionList mConnections = new PublicizeConnectionList();</span>

    private final long mSiteId;
    private final long mCurrentUserId;
    private final PublicizeService mService;

    private PublicizeActions.OnPublicizeActionListener mActionListener;
    private OnAdapterLoadedListener mLoadedListener;

    @Inject ImageManager mImageManager;

    public PublicizeConnectionAdapter(Context context, long siteId, PublicizeService service, long currentUserId) {
<span class="nc" id="L46">        super();</span>
<span class="nc" id="L47">        ((WordPress) context.getApplicationContext()).component().inject(this);</span>
<span class="nc" id="L48">        mSiteId = siteId;</span>
<span class="nc" id="L49">        mService = service;</span>
<span class="nc" id="L50">        mCurrentUserId = currentUserId;</span>
<span class="nc" id="L51">        setHasStableIds(true);</span>
<span class="nc" id="L52">    }</span>

    public void setOnAdapterLoadedListener(OnAdapterLoadedListener listener) {
<span class="nc" id="L55">        mLoadedListener = listener;</span>
<span class="nc" id="L56">    }</span>

    public void setOnPublicizeActionListener(PublicizeActions.OnPublicizeActionListener listener) {
<span class="nc" id="L59">        mActionListener = listener;</span>
<span class="nc" id="L60">    }</span>

    public void refresh() {
<span class="nc" id="L63">        PublicizeConnectionList siteConnections = PublicizeTable.getConnectionsForSite(mSiteId);</span>
<span class="nc" id="L64">        PublicizeConnectionList serviceConnections =</span>
<span class="nc" id="L65">                siteConnections.getServiceConnectionsForUser(mCurrentUserId, mService.getId());</span>

<span class="nc bnc" id="L67" title="All 2 branches missed.">        if (!mConnections.isSameAs(serviceConnections)) {</span>
<span class="nc" id="L68">            mConnections.clear();</span>
<span class="nc" id="L69">            mConnections.addAll(serviceConnections);</span>
<span class="nc" id="L70">            notifyDataSetChanged();</span>
        }

<span class="nc bnc" id="L73" title="All 2 branches missed.">        if (mLoadedListener != null) {</span>
<span class="nc" id="L74">            mLoadedListener.onAdapterLoaded(isEmpty());</span>
        }
<span class="nc" id="L76">    }</span>

    @Override
    public int getItemCount() {
<span class="nc" id="L80">        return mConnections.size();</span>
    }

    private boolean isEmpty() {
<span class="nc bnc" id="L84" title="All 2 branches missed.">        return (getItemCount() == 0);</span>
    }

    @Override
    public long getItemId(int position) {
<span class="nc" id="L89">        return mConnections.get(position).connectionId;</span>
    }

    @NotNull
    @Override
    public ConnectionViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
<span class="nc" id="L95">        View view =</span>
<span class="nc" id="L96">                LayoutInflater.from(parent.getContext()).inflate(R.layout.publicize_listitem_connection, parent, false);</span>
<span class="nc" id="L97">        return new ConnectionViewHolder(view);</span>
    }

    @Override
    public void onBindViewHolder(ConnectionViewHolder holder, int position) {
<span class="nc" id="L102">        final PublicizeConnection connection = mConnections.get(position);</span>

<span class="nc" id="L104">        holder.mTxtUser.setText(connection.getExternalDisplayName());</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        holder.mDivider.setVisibility(position == 0 ? View.GONE : View.VISIBLE);</span>

<span class="nc" id="L107">        mImageManager.loadIntoCircle(holder.mImgAvatar, ImageType.AVATAR_WITH_BACKGROUND,</span>
<span class="nc" id="L108">                connection.getExternalProfilePictureUrl());</span>

<span class="nc" id="L110">        bindButton(holder.mBtnConnect, connection);</span>
<span class="nc" id="L111">    }</span>

    private void bindButton(ConnectButton btnConnect, final PublicizeConnection connection) {
<span class="nc" id="L114">        ConnectStatus status = connection.getStatusEnum();</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">        switch (status) {</span>
            case OK:
            case MUST_DISCONNECT:
<span class="nc" id="L118">                btnConnect.setAction(PublicizeConstants.ConnectAction.DISCONNECT);</span>
<span class="nc" id="L119">                btnConnect.setOnClickListener(v -&gt; {</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">                    if (mActionListener != null) {</span>
<span class="nc" id="L121">                        mActionListener.onRequestDisconnect(connection);</span>
                    }
<span class="nc" id="L123">                });</span>
<span class="nc" id="L124">                break;</span>
            case BROKEN:
            default:
<span class="nc" id="L127">                btnConnect.setAction(ConnectAction.RECONNECT);</span>
<span class="nc" id="L128">                btnConnect.setOnClickListener(view -&gt; {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                    if (mActionListener != null) {</span>
<span class="nc" id="L130">                        mActionListener.onRequestReconnect(mService, connection);</span>
                    }
<span class="nc" id="L132">                });</span>
        }
<span class="nc" id="L134">    }</span>

    class ConnectionViewHolder extends RecyclerView.ViewHolder {
        private final TextView mTxtUser;
        private final ConnectButton mBtnConnect;
        private final ImageView mImgAvatar;
        private final View mDivider;

<span class="nc" id="L142">        ConnectionViewHolder(View view) {</span>
<span class="nc" id="L143">            super(view);</span>
<span class="nc" id="L144">            mTxtUser = view.findViewById(R.id.text_user);</span>
<span class="nc" id="L145">            mImgAvatar = view.findViewById(R.id.image_avatar);</span>
<span class="nc" id="L146">            mBtnConnect = view.findViewById(R.id.button_connect);</span>
<span class="nc" id="L147">            mDivider = view.findViewById(R.id.divider);</span>
<span class="nc" id="L148">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>