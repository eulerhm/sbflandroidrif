<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderActivityLauncher.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader</a> &gt; <span class="el_source">ReaderActivityLauncher.java</span></div><h1>ReaderActivityLauncher.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader;

import android.app.Activity;
import android.content.ActivityNotFoundException;
import android.content.Context;
import android.content.Intent;
import android.text.TextUtils;
import android.view.View;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.core.app.ActivityCompat;
import androidx.core.app.ActivityOptionsCompat;
import androidx.fragment.app.Fragment;

import org.jetbrains.annotations.NotNull;
import org.wordpress.android.R;
import org.wordpress.android.analytics.AnalyticsTracker;
import org.wordpress.android.models.ReaderPost;
import org.wordpress.android.models.ReaderTag;
import org.wordpress.android.ui.ActivityLauncher;
import org.wordpress.android.ui.RequestCodes;
import org.wordpress.android.ui.WPWebViewActivity;
import org.wordpress.android.ui.reader.ReaderPostPagerActivity.DirectOperation;
import org.wordpress.android.ui.reader.ReaderTypes.ReaderPostListType;
import org.wordpress.android.ui.reader.discover.interests.ReaderInterestsActivity;
import org.wordpress.android.ui.reader.discover.interests.ReaderInterestsFragment.EntryPoint;
import org.wordpress.android.ui.reader.tracker.ReaderTracker;
import org.wordpress.android.ui.reader.utils.ReaderUtils;
import org.wordpress.android.util.WPUrlUtils;

import java.util.EnumSet;

import static org.wordpress.android.ui.reader.discover.interests.ReaderInterestsFragment.READER_INTEREST_ENTRY_POINT;

<span class="nc" id="L36">public class ReaderActivityLauncher {</span>
    /*
     * show a single reader post in the detail view - simply calls showReaderPostPager
     * with a single post
     */
    public static void showReaderPostDetail(Context context, long blogId, long postId) {
<span class="nc" id="L42">        showReaderPostDetail(context, false, blogId, postId, null, 0, false, null);</span>
<span class="nc" id="L43">    }</span>

    public static void showReaderPostDetail(Context context,
                                            boolean isFeed,
                                            long blogId,
                                            long postId,
                                            DirectOperation directOperation,
                                            int commentId,
                                            boolean isRelatedPost,
                                            String interceptedUri) {
<span class="nc" id="L53">        Intent intent =</span>
<span class="nc" id="L54">                buildReaderPostDetailIntent(context, isFeed, blogId, postId, directOperation, commentId, isRelatedPost,</span>
                        interceptedUri);
<span class="nc" id="L56">        context.startActivity(intent);</span>
<span class="nc" id="L57">    }</span>

    @NotNull
    public static Intent buildReaderPostDetailIntent(Context context, boolean isFeed, long blogId, long postId,
                                                      DirectOperation directOperation, int commentId,
                                                      boolean isRelatedPost, String interceptedUri) {
<span class="nc" id="L63">        Intent intent = new Intent(context, ReaderPostPagerActivity.class);</span>
<span class="nc" id="L64">        intent.putExtra(ReaderConstants.ARG_IS_FEED, isFeed);</span>
<span class="nc" id="L65">        intent.putExtra(ReaderConstants.ARG_BLOG_ID, blogId);</span>
<span class="nc" id="L66">        intent.putExtra(ReaderConstants.ARG_POST_ID, postId);</span>
<span class="nc" id="L67">        intent.putExtra(ReaderConstants.ARG_DIRECT_OPERATION, directOperation);</span>
<span class="nc" id="L68">        intent.putExtra(ReaderConstants.ARG_COMMENT_ID, commentId);</span>
<span class="nc" id="L69">        intent.putExtra(ReaderConstants.ARG_IS_SINGLE_POST, true);</span>
<span class="nc" id="L70">        intent.putExtra(ReaderConstants.ARG_IS_RELATED_POST, isRelatedPost);</span>
<span class="nc" id="L71">        intent.putExtra(ReaderConstants.ARG_INTERCEPTED_URI, interceptedUri);</span>
<span class="nc" id="L72">        return intent;</span>
    }

    /*
     * show pager view of posts with a specific tag - passed blogId/postId is the post
     * to select after the pager is populated
     */
    public static void showReaderPostPagerForTag(Context context,
                                                 ReaderTag tag,
                                                 ReaderPostListType postListType,
                                                 long blogId,
                                                 long postId) {
<span class="nc bnc" id="L84" title="All 2 branches missed.">        if (tag == null) {</span>
<span class="nc" id="L85">            return;</span>
        }

<span class="nc" id="L88">        Intent intent = new Intent(context, ReaderPostPagerActivity.class);</span>
<span class="nc" id="L89">        intent.putExtra(ReaderConstants.ARG_POST_LIST_TYPE, postListType);</span>
<span class="nc" id="L90">        intent.putExtra(ReaderConstants.ARG_TAG, tag);</span>
<span class="nc" id="L91">        intent.putExtra(ReaderConstants.ARG_BLOG_ID, blogId);</span>
<span class="nc" id="L92">        intent.putExtra(ReaderConstants.ARG_POST_ID, postId);</span>
<span class="nc" id="L93">        context.startActivity(intent);</span>
<span class="nc" id="L94">    }</span>

    /*
     * show pager view of posts in a specific blog
     */
    public static void showReaderPostPagerForBlog(Context context,
                                                  long blogId,
                                                  long postId) {
<span class="nc" id="L102">        Intent intent = new Intent(context, ReaderPostPagerActivity.class);</span>
<span class="nc" id="L103">        intent.putExtra(ReaderConstants.ARG_POST_LIST_TYPE, ReaderPostListType.BLOG_PREVIEW);</span>
<span class="nc" id="L104">        intent.putExtra(ReaderConstants.ARG_BLOG_ID, blogId);</span>
<span class="nc" id="L105">        intent.putExtra(ReaderConstants.ARG_POST_ID, postId);</span>
<span class="nc" id="L106">        context.startActivity(intent);</span>
<span class="nc" id="L107">    }</span>

    /*
     * show a list of posts in a specific blog or feed
     */
    public static void showReaderBlogOrFeedPreview(Context context, long siteId, long feedId,
                                                   @Nullable Boolean isFollowed, String source,
                                                   ReaderTracker readerTracker) {
<span class="nc bnc" id="L115" title="All 4 branches missed.">        if (siteId == 0 &amp;&amp; feedId == 0) {</span>
<span class="nc" id="L116">            return;</span>
        }

<span class="nc" id="L119">        readerTracker.trackBlog(</span>
                AnalyticsTracker.Stat.READER_BLOG_PREVIEWED,
                siteId,
                feedId,
                isFollowed,
                source
        );
<span class="nc" id="L126">        Intent intent = new Intent(context, ReaderPostListActivity.class);</span>
<span class="nc" id="L127">        intent.putExtra(ReaderConstants.ARG_SOURCE, source);</span>

<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (ReaderUtils.isExternalFeed(siteId, feedId)) {</span>
<span class="nc" id="L130">            intent.putExtra(ReaderConstants.ARG_FEED_ID, feedId);</span>
<span class="nc" id="L131">            intent.putExtra(ReaderConstants.ARG_IS_FEED, true);</span>
        } else {
<span class="nc" id="L133">            intent.putExtra(ReaderConstants.ARG_BLOG_ID, siteId);</span>
        }

<span class="nc" id="L136">        intent.putExtra(ReaderConstants.ARG_POST_LIST_TYPE, ReaderPostListType.BLOG_PREVIEW);</span>
<span class="nc" id="L137">        context.startActivity(intent);</span>
<span class="nc" id="L138">    }</span>

    public static void showReaderBlogPreview(Context context, ReaderPost post,
                                             String source,
                                             ReaderTracker readerTracker) {
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (post == null) {</span>
<span class="nc" id="L144">            return;</span>
        }
<span class="nc" id="L146">        showReaderBlogOrFeedPreview(</span>
                context,
                post.blogId,
                post.feedId,
<span class="nc" id="L150">                post.isFollowedByCurrentUser,</span>
                source,
                readerTracker
        );
<span class="nc" id="L154">    }</span>

    public static void showReaderBlogPreview(Context context, long siteId,
                                             @Nullable Boolean isFollowed, String source,
                                             ReaderTracker readerTracker) {
<span class="nc" id="L159">        showReaderBlogOrFeedPreview(</span>
                context,
                siteId,
                0,
                isFollowed,
                source,
                readerTracker
        );
<span class="nc" id="L167">    }</span>

    /*
     * show a list of posts with a specific tag
     */
    public static void showReaderTagPreview(Context context, @NonNull ReaderTag tag,
                                            String source,
                                            ReaderTracker readerTracker) {
<span class="nc" id="L175">        readerTracker.trackTag(</span>
                AnalyticsTracker.Stat.READER_TAG_PREVIEWED,
<span class="nc" id="L177">                tag.getTagSlug(),</span>
                source
        );
<span class="nc" id="L180">        Intent intent = new Intent(context, ReaderPostListActivity.class);</span>
<span class="nc" id="L181">        intent.putExtra(ReaderConstants.ARG_SOURCE, source);</span>
<span class="nc" id="L182">        intent.putExtra(ReaderConstants.ARG_TAG, tag);</span>
<span class="nc" id="L183">        intent.putExtra(ReaderConstants.ARG_POST_LIST_TYPE, ReaderPostListType.TAG_PREVIEW);</span>
<span class="nc" id="L184">        context.startActivity(intent);</span>
<span class="nc" id="L185">    }</span>

    public static void showReaderSearch(Context context) {
<span class="nc" id="L188">        Intent intent = new Intent(context, ReaderSearchActivity.class);</span>
<span class="nc" id="L189">        context.startActivity(intent);</span>
<span class="nc" id="L190">    }</span>

    /*
     * show comments for the passed Ids
     */
    public static void showReaderComments(Context context,
                                          long blogId,
                                          long postId,
                                          String source) {
<span class="nc" id="L199">        showReaderComments(context, blogId, postId, null, 0, null, source);</span>
<span class="nc" id="L200">    }</span>


    /*
     * show specific comment for the passed Ids
     */
    public static void showReaderComments(
        Context context,
        long blogId,
        long postId,
        long commentId,
        String source
    ) {
<span class="nc" id="L213">        showReaderComments(</span>
                context,
                blogId,
                postId,
                DirectOperation.COMMENT_JUMP,
                commentId,
                null,
                source
        );
<span class="nc" id="L222">    }</span>

    /**
     * Show comments for passed Ids and directly perform an action on a specifc comment
     *
     * @param context         context to use to start the activity
     * @param blogId          blog id
     * @param postId          post id
     * @param directOperation operation to perform on the specific comment. Can be null for no operation.
     * @param commentId       specific comment id to perform an action on
     * @param interceptedUri  URI to fall back into (i.e. to be able to open in external browser)
     */
    public static void showReaderComments(Context context, long blogId, long postId, DirectOperation
            directOperation, long commentId, String interceptedUri, String source) {
<span class="nc" id="L236">        Intent intent = buildShowReaderCommentsIntent(</span>
                context,
                blogId,
                postId,
                directOperation,
                commentId,
                interceptedUri,
                source
        );
<span class="nc" id="L245">        context.startActivity(intent);</span>
<span class="nc" id="L246">    }</span>

    public static void showReaderCommentsForResult(
            Fragment fragment,
            long blogId,
            long postId,
            String source
    ) {
<span class="nc" id="L254">        showReaderCommentsForResult(fragment, blogId, postId, null, 0, null, source);</span>
<span class="nc" id="L255">    }</span>

    public static void showReaderCommentsForResult(Fragment fragment, long blogId, long postId, DirectOperation
            directOperation, long commentId, String interceptedUri, String source) {
<span class="nc" id="L259">        Intent intent = buildShowReaderCommentsIntent(</span>
<span class="nc" id="L260">                fragment.getContext(),</span>
                blogId,
                postId,
                directOperation,
                commentId,
                interceptedUri,
                source
        );
<span class="nc" id="L268">        fragment.startActivityForResult(intent, RequestCodes.READER_FOLLOW_CONVERSATION);</span>
<span class="nc" id="L269">    }</span>

    private static Intent buildShowReaderCommentsIntent(Context context, long blogId, long postId, DirectOperation
            directOperation, long commentId, String interceptedUri, String source) {
<span class="nc" id="L273">        Intent intent = new Intent(</span>
                context,
                ReaderCommentListActivity.class
        );
<span class="nc" id="L277">        intent.putExtra(ReaderConstants.ARG_BLOG_ID, blogId);</span>
<span class="nc" id="L278">        intent.putExtra(ReaderConstants.ARG_POST_ID, postId);</span>
<span class="nc" id="L279">        intent.putExtra(ReaderConstants.ARG_DIRECT_OPERATION, directOperation);</span>
<span class="nc" id="L280">        intent.putExtra(ReaderConstants.ARG_COMMENT_ID, commentId);</span>
<span class="nc" id="L281">        intent.putExtra(ReaderConstants.ARG_INTERCEPTED_URI, interceptedUri);</span>
<span class="nc" id="L282">        intent.putExtra(ReaderConstants.ARG_SOURCE, source);</span>

<span class="nc" id="L284">        return intent;</span>
    }

    /*
     * show users who liked a post
     */
    public static void showReaderLikingUsers(Context context, long blogId, long postId) {
<span class="nc" id="L291">        Intent intent = new Intent(context, ReaderUserListActivity.class);</span>
<span class="nc" id="L292">        intent.putExtra(ReaderConstants.ARG_BLOG_ID, blogId);</span>
<span class="nc" id="L293">        intent.putExtra(ReaderConstants.ARG_POST_ID, postId);</span>
<span class="nc" id="L294">        context.startActivity(intent);</span>
<span class="nc" id="L295">    }</span>

    /**
     * Presents the [ReaderPostNoSiteToReblog] activity
     *
     * @param activity the calling activity
     */
    public static void showNoSiteToReblog(Activity activity) {
<span class="nc" id="L303">        Intent intent = new Intent(activity, NoSiteToReblogActivity.class);</span>
<span class="nc" id="L304">        activity.startActivityForResult(intent, RequestCodes.NO_REBLOG_SITE);</span>
<span class="nc" id="L305">    }</span>

    /*
     * show followed tags &amp; blogs
     */
    public static void showReaderSubs(Context context) {
<span class="nc" id="L311">        Intent intent = new Intent(context, ReaderSubsActivity.class);</span>
<span class="nc" id="L312">        context.startActivity(intent);</span>
<span class="nc" id="L313">    }</span>

    public static void showReaderSubs(Context context, int selectPosition) {
<span class="nc" id="L316">        Intent intent = new Intent(context, ReaderSubsActivity.class);</span>
<span class="nc" id="L317">        intent.putExtra(ReaderConstants.ARG_SUBS_TAB_POSITION, selectPosition);</span>
<span class="nc" id="L318">        context.startActivity(intent);</span>
<span class="nc" id="L319">    }</span>

    public static void showReaderInterests(Activity activity) {
<span class="nc" id="L322">        Intent intent = new Intent(activity, ReaderInterestsActivity.class);</span>
<span class="nc" id="L323">        intent.putExtra(READER_INTEREST_ENTRY_POINT, EntryPoint.SETTINGS);</span>
<span class="nc" id="L324">        activity.startActivityForResult(intent, RequestCodes.READER_INTERESTS);</span>
<span class="nc" id="L325">    }</span>

    /*
     * play an external video
     */
    public static void showReaderVideoViewer(Context context, String videoUrl) {
<span class="nc bnc" id="L331" title="All 4 branches missed.">        if (context == null || TextUtils.isEmpty(videoUrl)) {</span>
<span class="nc" id="L332">            return;</span>
        }
<span class="nc" id="L334">        Intent intent = new Intent(context, ReaderVideoViewerActivity.class);</span>
<span class="nc" id="L335">        intent.putExtra(ReaderConstants.ARG_VIDEO_URL, videoUrl);</span>
<span class="nc" id="L336">        context.startActivity(intent);</span>
<span class="nc" id="L337">    }</span>

    /*
     * show the passed imageUrl in the fullscreen photo activity - optional content is the
     * content of the post the image is in, used by the activity to show all images in
     * the post
     */
<span class="nc" id="L344">    public enum PhotoViewerOption {</span>
<span class="nc" id="L345">        IS_PRIVATE_IMAGE,</span>
<span class="nc" id="L346">        IS_GALLERY_IMAGE</span>
    }

    public static void showReaderPhotoViewer(Context context,
                                             String imageUrl,
                                             String content,
                                             View sourceView,
                                             EnumSet&lt;PhotoViewerOption&gt; imageOptions,
                                             int startX,
                                             int startY) {
<span class="nc bnc" id="L356" title="All 4 branches missed.">        if (context == null || TextUtils.isEmpty(imageUrl)) {</span>
<span class="nc" id="L357">            return;</span>
        }

<span class="nc bnc" id="L360" title="All 4 branches missed.">        boolean isPrivate = imageOptions != null &amp;&amp; imageOptions.contains(PhotoViewerOption.IS_PRIVATE_IMAGE);</span>
<span class="nc bnc" id="L361" title="All 4 branches missed.">        boolean isGallery = imageOptions != null &amp;&amp; imageOptions.contains(PhotoViewerOption.IS_GALLERY_IMAGE);</span>

<span class="nc" id="L363">        Intent intent = new Intent(context, ReaderPhotoViewerActivity.class);</span>
<span class="nc" id="L364">        intent.putExtra(ReaderConstants.ARG_IMAGE_URL, imageUrl);</span>
<span class="nc" id="L365">        intent.putExtra(ReaderConstants.ARG_IS_PRIVATE, isPrivate);</span>
<span class="nc" id="L366">        intent.putExtra(ReaderConstants.ARG_IS_GALLERY, isGallery);</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">        if (!TextUtils.isEmpty(content)) {</span>
<span class="nc" id="L368">            intent.putExtra(ReaderConstants.ARG_CONTENT, content);</span>
        }

<span class="nc bnc" id="L371" title="All 4 branches missed.">        if (context instanceof Activity &amp;&amp; sourceView != null) {</span>
<span class="nc" id="L372">            Activity activity = (Activity) context;</span>
<span class="nc" id="L373">            ActivityOptionsCompat options =</span>
<span class="nc" id="L374">                    ActivityOptionsCompat.makeScaleUpAnimation(sourceView, startX, startY, 0, 0);</span>
<span class="nc" id="L375">            ActivityCompat.startActivity(activity, intent, options.toBundle());</span>
<span class="nc" id="L376">        } else {</span>
<span class="nc" id="L377">            context.startActivity(intent);</span>
        }
<span class="nc" id="L379">    }</span>

    public static void showReaderPhotoViewer(Context context,
                                             String imageUrl,
                                             EnumSet&lt;PhotoViewerOption&gt; imageOptions) {
<span class="nc" id="L384">        showReaderPhotoViewer(context, imageUrl, null, null, imageOptions, 0, 0);</span>
<span class="nc" id="L385">    }</span>

<span class="nc" id="L387">    public enum OpenUrlType {</span>
<span class="nc" id="L388">        INTERNAL, EXTERNAL</span>
    }

    public static void openUrl(Context context, String url) {
<span class="nc" id="L392">        openUrl(context, url, OpenUrlType.INTERNAL);</span>
<span class="nc" id="L393">    }</span>

    public static void openPost(Context context, ReaderPost post) {
<span class="nc" id="L396">        String url = post.getUrl();</span>
<span class="nc bnc" id="L397" title="All 6 branches missed.">        if (WPUrlUtils.isWordPressCom(url) || (post.isWP() &amp;&amp; !post.isJetpack)) {</span>
<span class="nc" id="L398">            WPWebViewActivity.openUrlByUsingGlobalWPCOMCredentials(context, url);</span>
        } else {
<span class="nc" id="L400">            WPWebViewActivity.openURL(context, url, ReaderConstants.HTTP_REFERER_URL);</span>
        }
<span class="nc" id="L402">    }</span>

    public static void sharePost(Context context, ReaderPost post) throws ActivityNotFoundException {
<span class="nc bnc" id="L405" title="All 2 branches missed.">        String url = (post.hasShortUrl() ? post.getShortUrl() : post.getUrl());</span>

<span class="nc" id="L407">        Intent intent = new Intent(Intent.ACTION_SEND);</span>
<span class="nc" id="L408">        intent.setType(&quot;text/plain&quot;);</span>
<span class="nc" id="L409">        intent.putExtra(Intent.EXTRA_TEXT, url);</span>
<span class="nc" id="L410">        intent.putExtra(Intent.EXTRA_SUBJECT, post.getTitle());</span>

<span class="nc" id="L412">        context.startActivity(Intent.createChooser(intent, context.getString(R.string.share_link)));</span>
<span class="nc" id="L413">    }</span>

    public static void openUrl(Context context, String url, OpenUrlType openUrlType) {
<span class="nc bnc" id="L416" title="All 4 branches missed.">        if (context == null || TextUtils.isEmpty(url)) {</span>
<span class="nc" id="L417">            return;</span>
        }

<span class="nc bnc" id="L420" title="All 2 branches missed.">        if (openUrlType == OpenUrlType.INTERNAL) {</span>
<span class="nc" id="L421">            openUrlInternal(context, url);</span>
        } else {
<span class="nc" id="L423">            ActivityLauncher.openUrlExternal(context, url);</span>
        }
<span class="nc" id="L425">    }</span>

    /*
     * open the passed url in the app's internal WebView activity
     */
    private static void openUrlInternal(Context context, @NonNull String url) {
        // That won't work on wpcom sites with custom urls
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (WPUrlUtils.isWordPressCom(url)) {</span>
<span class="nc" id="L433">            WPWebViewActivity.openUrlByUsingGlobalWPCOMCredentials(context, url);</span>
        } else {
<span class="nc" id="L435">            WPWebViewActivity.openURL(context, url, ReaderConstants.HTTP_REFERER_URL);</span>
        }
<span class="nc" id="L437">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>