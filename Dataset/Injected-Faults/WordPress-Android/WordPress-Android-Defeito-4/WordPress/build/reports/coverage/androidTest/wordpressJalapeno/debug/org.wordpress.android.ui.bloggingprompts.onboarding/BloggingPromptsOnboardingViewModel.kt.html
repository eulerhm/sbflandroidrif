<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BloggingPromptsOnboardingViewModel.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.bloggingprompts.onboarding</a> &gt; <span class="el_source">BloggingPromptsOnboardingViewModel.kt</span></div><h1>BloggingPromptsOnboardingViewModel.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.bloggingprompts.onboarding

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import kotlinx.coroutines.CoroutineDispatcher
import kotlinx.coroutines.flow.firstOrNull
import org.wordpress.android.R
import org.wordpress.android.fluxc.store.SiteStore
import org.wordpress.android.fluxc.store.bloggingprompts.BloggingPromptsStore
import org.wordpress.android.modules.BG_THREAD
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingAction.DismissDialog
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingAction.DoNothing
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingAction.OpenEditor
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingAction.OpenRemindersIntro
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingAction.OpenSitePicker
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingDialogFragment.DialogType
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingDialogFragment.DialogType.INFORMATION
import org.wordpress.android.ui.bloggingprompts.onboarding.BloggingPromptsOnboardingDialogFragment.DialogType.ONBOARDING
import org.wordpress.android.ui.mysite.SelectedSiteRepository
import org.wordpress.android.ui.pages.SnackbarMessageHolder
import org.wordpress.android.ui.utils.UiString.UiStringRes
import org.wordpress.android.viewmodel.Event
import org.wordpress.android.viewmodel.ScopedViewModel
import java.util.Date
import javax.inject.Inject
import javax.inject.Named

<span class="nc" id="L28">class BloggingPromptsOnboardingViewModel @Inject constructor(</span>
<span class="nc" id="L29">    private val siteStore: SiteStore,</span>
<span class="nc" id="L30">    private val uiStateMapper: BloggingPromptsOnboardingUiStateMapper,</span>
<span class="nc" id="L31">    private val selectedSiteRepository: SelectedSiteRepository,</span>
<span class="nc" id="L32">    private val bloggingPromptsStore: BloggingPromptsStore,</span>
<span class="nc" id="L33">    private val analyticsTracker: BloggingPromptsOnboardingAnalyticsTracker,</span>
<span class="nc" id="L34">    @Named(BG_THREAD) val bgDispatcher: CoroutineDispatcher</span>
<span class="nc" id="L35">) : ScopedViewModel(bgDispatcher) {</span>
<span class="nc" id="L36">    private val _uiState = MutableLiveData&lt;BloggingPromptsOnboardingUiState&gt;()</span>
<span class="nc" id="L37">    val uiState: LiveData&lt;BloggingPromptsOnboardingUiState&gt; = _uiState</span>

<span class="nc" id="L39">    private val _action = MutableLiveData&lt;BloggingPromptsOnboardingAction&gt;()</span>
<span class="nc" id="L40">    val action: LiveData&lt;BloggingPromptsOnboardingAction&gt; = _action</span>

<span class="nc" id="L42">    private val _snackBarMessage = MutableLiveData&lt;Event&lt;SnackbarMessageHolder&gt;&gt;()</span>
<span class="nc" id="L43">    val snackBarMessage = _snackBarMessage as LiveData&lt;Event&lt;SnackbarMessageHolder&gt;&gt;</span>

    private lateinit var dialogType: DialogType
    private var hasTrackedScreenShown = false

    fun start(type: DialogType) {
<span class="nc bnc" id="L49" title="All 2 branches missed.">        if (!hasTrackedScreenShown) {</span>
<span class="nc" id="L50">            hasTrackedScreenShown = true</span>
<span class="nc" id="L51">            analyticsTracker.trackScreenShown()</span>
        }
<span class="nc" id="L53">        dialogType = type</span>

<span class="nc bnc" id="L55" title="All 2 branches missed.">        _uiState.value = uiStateMapper.mapReady(dialogType, ::onPrimaryButtonClick, ::onSecondaryButtonClick)</span>
<span class="nc" id="L56">    }</span>

<span class="nc" id="L58">    private fun onPrimaryButtonClick() = launch {</span>
<span class="nc bnc" id="L59" title="All 4 branches missed.">        val action = when (dialogType) {</span>
            ONBOARDING -&gt; {
<span class="nc" id="L61">                analyticsTracker.trackTryItNowClicked()</span>
<span class="nc" id="L62">                val site = selectedSiteRepository.getSelectedSite()</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">                val bloggingPrompt = bloggingPromptsStore.getPromptForDate(site!!, Date()).firstOrNull()?.model</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">                if (bloggingPrompt == null) {</span>
<span class="nc" id="L65">                    _snackBarMessage.postValue(</span>
<span class="nc" id="L66">                            Event(</span>
<span class="nc" id="L67">                                    SnackbarMessageHolder(</span>
<span class="nc" id="L68">                                            UiStringRes(R.string.blogging_prompts_onboarding_prompts_loading)</span>
                                    )
                            )
                    )
<span class="nc" id="L72">                    DoNothing</span>
                } else {
<span class="nc" id="L74">                    OpenEditor(bloggingPrompt.id)</span>
                }
            }
            INFORMATION -&gt; {
<span class="nc" id="L78">                analyticsTracker.trackGotItClicked()</span>
<span class="nc" id="L79">                DismissDialog</span>
            }
        }
<span class="nc" id="L82">        _action.postValue(action)</span>
<span class="nc" id="L83">    }</span>

    private fun onSecondaryButtonClick() {
<span class="nc" id="L86">        analyticsTracker.trackRemindMeClicked()</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (siteStore.sitesCount &gt; 1) {</span>
<span class="nc" id="L88">            _action.value = OpenSitePicker(selectedSiteRepository.getSelectedSite())</span>
        } else {
<span class="nc bnc" id="L90" title="All 2 branches missed.">            siteStore.sites.firstOrNull()?.let {</span>
<span class="nc" id="L91">                _action.value = OpenRemindersIntro(it.id)</span>
<span class="nc" id="L92">            }</span>
        }
<span class="nc" id="L94">    }</span>

    fun onSiteSelected(selectedSiteLocalId: Int) {
<span class="nc" id="L97">        _action.value = OpenRemindersIntro(selectedSiteLocalId)</span>
<span class="nc" id="L98">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>