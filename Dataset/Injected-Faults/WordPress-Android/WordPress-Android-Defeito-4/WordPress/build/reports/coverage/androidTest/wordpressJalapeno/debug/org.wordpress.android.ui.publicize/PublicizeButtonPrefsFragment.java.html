<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PublicizeButtonPrefsFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.publicize</a> &gt; <span class="el_source">PublicizeButtonPrefsFragment.java</span></div><h1>PublicizeButtonPrefsFragment.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.publicize;

import android.os.Bundle;
import android.os.Handler;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;

import org.jetbrains.annotations.NotNull;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.wordpress.android.R;
import org.wordpress.android.WordPress;
import org.wordpress.android.analytics.AnalyticsTracker;
import org.wordpress.android.analytics.AnalyticsTracker.Stat;
import org.wordpress.android.fluxc.Dispatcher;
import org.wordpress.android.fluxc.model.SiteModel;
import org.wordpress.android.models.PublicizeButton;
import org.wordpress.android.ui.ScrollableViewInitializedListener;
import org.wordpress.android.ui.prefs.SiteSettingsInterface;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.NetworkUtils;
import org.wordpress.android.util.StringUtils;
import org.wordpress.android.util.ToastUtils;
import org.wordpress.android.widgets.WPPrefView;
import org.wordpress.android.widgets.WPPrefView.PrefListItem;
import org.wordpress.android.widgets.WPPrefView.PrefListItems;

import java.util.ArrayList;

import javax.inject.Inject;

<span class="nc" id="L37">public class PublicizeButtonPrefsFragment extends PublicizeBaseFragment implements</span>
        SiteSettingsInterface.SiteSettingsListener,
        WPPrefView.OnPrefChangedListener {
    private static final String TWITTER_PREFIX = &quot;@&quot;;
    private static final String SHARING_BUTTONS_KEY = &quot;sharing_buttons&quot;;
    private static final String SHARING_BUTTONS_UPDATED_KEY = &quot;updated&quot;;
    private static final String TWITTER_ID = &quot;twitter&quot;;

    private static final long FETCH_DELAY = 1000L;

<span class="nc" id="L47">    private final ArrayList&lt;PublicizeButton&gt; mPublicizeButtons = new ArrayList&lt;&gt;();</span>

    private WPPrefView mPrefSharingButtons;
    private WPPrefView mPrefMoreButtons;
    private WPPrefView mPrefLabel;
    private WPPrefView mPrefButtonStyle;
    private WPPrefView mPrefShowReblog;
    private WPPrefView mPrefShowLike;
    private WPPrefView mPrefAllowCommentLikes;
    private WPPrefView mPrefTwitterName;

    private View mSharingDisabledNotification;
    private View mSharingSettingsWrapper;

    private SiteModel mSite;
    private SiteSettingsInterface mSiteSettings;

    @Inject Dispatcher mDispatcher;

    public static PublicizeButtonPrefsFragment newInstance(@NonNull SiteModel site) {
<span class="nc" id="L67">        PublicizeButtonPrefsFragment fragment = new PublicizeButtonPrefsFragment();</span>
<span class="nc" id="L68">        Bundle args = new Bundle();</span>
<span class="nc" id="L69">        args.putSerializable(WordPress.SITE, site);</span>
<span class="nc" id="L70">        fragment.setArguments(args);</span>
<span class="nc" id="L71">        return fragment;</span>
    }

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
<span class="nc" id="L76">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L77">        ((WordPress) getActivity().getApplication()).component().inject(this);</span>

<span class="nc" id="L79">        setRetainInstance(true);</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (savedInstanceState == null) {</span>
<span class="nc" id="L82">            mSite = (SiteModel) getArguments().getSerializable(WordPress.SITE);</span>
        } else {
<span class="nc" id="L84">            mSite = (SiteModel) savedInstanceState.getSerializable(WordPress.SITE);</span>
        }

<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (mSite == null) {</span>
<span class="nc" id="L88">            ToastUtils.showToast(getActivity(), R.string.blog_not_found, ToastUtils.Duration.SHORT);</span>
<span class="nc" id="L89">            getActivity().finish();</span>
<span class="nc" id="L90">            return;</span>
        }

<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (!NetworkUtils.checkConnection(getActivity())) {</span>
<span class="nc" id="L94">            getActivity().finish();</span>
<span class="nc" id="L95">            return;</span>
        }

        // this creates a default site settings interface - the actual settings will
        // be retrieved when getSiteSettings() is called
<span class="nc" id="L100">        mSiteSettings = SiteSettingsInterface.getInterface(getActivity(), mSite, this);</span>
<span class="nc" id="L101">    }</span>

    @Override
    public void onDestroy() {
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (mSiteSettings != null) {</span>
<span class="nc" id="L106">            mSiteSettings.clear();</span>
        }
<span class="nc" id="L108">        super.onDestroy();</span>
<span class="nc" id="L109">    }</span>

    @Override
    public void onSaveInstanceState(@NotNull Bundle outState) {
<span class="nc" id="L113">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L114">        outState.putSerializable(WordPress.SITE, mSite);</span>
<span class="nc" id="L115">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,
                             @Nullable Bundle savedInstanceState) {
<span class="nc" id="L120">        ViewGroup view = (ViewGroup) inflater.inflate(R.layout.publicize_button_prefs_fragment, container, false);</span>

<span class="nc" id="L122">        mPrefButtonStyle = view.findViewById(R.id.pref_button_style);</span>
<span class="nc" id="L123">        mPrefSharingButtons = view.findViewById(R.id.pref_sharing_buttons);</span>
<span class="nc" id="L124">        mPrefMoreButtons = view.findViewById(R.id.pref_more_button);</span>
<span class="nc" id="L125">        mPrefLabel = view.findViewById(R.id.pref_label);</span>
<span class="nc" id="L126">        mPrefShowReblog = view.findViewById(R.id.pref_show_reblog);</span>
<span class="nc" id="L127">        mPrefShowLike = view.findViewById(R.id.pref_show_like);</span>
<span class="nc" id="L128">        mPrefAllowCommentLikes = view.findViewById(R.id.pref_allow_comment_likes);</span>
<span class="nc" id="L129">        mPrefTwitterName = view.findViewById(R.id.pref_twitter_name);</span>

<span class="nc bnc" id="L131" title="All 4 branches missed.">        if (!mSite.isWPCom() &amp;&amp; mSite.isJetpackConnected()) {</span>
<span class="nc" id="L132">            mPrefShowLike.setHeading(getString(R.string.site_settings_like_header));</span>
<span class="nc" id="L133">            mPrefShowReblog.setVisibility(View.GONE);</span>
        }

<span class="nc" id="L136">        mSharingDisabledNotification = view.findViewById(R.id.sharing_disabled_notification);</span>
<span class="nc" id="L137">        mSharingSettingsWrapper = view.findViewById(R.id.sharing_settings_wrapper);</span>

<span class="nc" id="L139">        return view;</span>
    }

    private void assignPrefListeners(boolean assign) {
<span class="nc bnc" id="L143" title="All 2 branches missed.">        WPPrefView.OnPrefChangedListener listener = assign ? this : null;</span>

<span class="nc" id="L145">        mPrefButtonStyle.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L146">        mPrefSharingButtons.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L147">        mPrefMoreButtons.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L148">        mPrefLabel.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L149">        mPrefShowReblog.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L150">        mPrefShowLike.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L151">        mPrefAllowCommentLikes.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L152">        mPrefTwitterName.setOnPrefChangedListener(listener);</span>
<span class="nc" id="L153">    }</span>

    @Override
    public void onViewStateRestored(Bundle savedInstanceState) {
<span class="nc" id="L157">        super.onViewStateRestored(savedInstanceState);</span>

<span class="nc bnc" id="L159" title="All 2 branches missed.">        boolean shouldFetchSettings = (savedInstanceState == null);</span>
<span class="nc" id="L160">        getSiteSettings(shouldFetchSettings);</span>

<span class="nc" id="L162">        configureSharingButtons();</span>
<span class="nc" id="L163">    }</span>

    @Override public void onResume() {
<span class="nc" id="L166">        super.onResume();</span>
<span class="nc" id="L167">        setTitle(R.string.publicize_buttons_screen_title);</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (getActivity() instanceof ScrollableViewInitializedListener) {</span>
<span class="nc" id="L169">            ((ScrollableViewInitializedListener) getActivity()).onScrollableViewInitialized(</span>
<span class="nc" id="L170">                    mSharingSettingsWrapper.getId());</span>
        }
<span class="nc" id="L172">    }</span>

    /**
     * save both the sharing &amp; more buttons
     *
     * @param isSharingButtons true if called by mPrefSharingButtons, false if by mPrefMoreButtons
     */
    private void saveSharingButtons(boolean isSharingButtons) {
<span class="nc" id="L180">        PrefListItems sharingButtons = mPrefSharingButtons.getSelectedItems();</span>
<span class="nc" id="L181">        PrefListItems moreButtons = mPrefMoreButtons.getSelectedItems();</span>
        // sharing and more buttons are mutually exclusive
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (isSharingButtons) {</span>
<span class="nc" id="L184">            moreButtons.removeItems(sharingButtons);</span>
<span class="nc" id="L185">            AnalyticsTracker.track(Stat.SHARING_BUTTONS_EDIT_SHARING_BUTTONS_CHANGED);</span>
        } else {
<span class="nc" id="L187">            sharingButtons.removeItems(moreButtons);</span>
<span class="nc" id="L188">            AnalyticsTracker.track(Stat.SHARING_BUTTONS_EDIT_MORE_SHARING_BUTTONS_CHANGED);</span>
        }

        // sharing buttons are visible and enabled, more buttons are invisible and enabled,
        // all others are invisible and disabled
<span class="nc" id="L193">        JSONArray jsonArray = new JSONArray();</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        for (PublicizeButton button : mPublicizeButtons) {</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">            if (sharingButtons.containsValue(button.getId())) {</span>
<span class="nc" id="L196">                button.setVisibility(true);</span>
<span class="nc" id="L197">                button.setEnabled(true);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">            } else if (moreButtons.containsValue(button.getId())) {</span>
<span class="nc" id="L199">                button.setVisibility(false);</span>
<span class="nc" id="L200">                button.setEnabled(true);</span>
            } else {
<span class="nc" id="L202">                button.setEnabled(false);</span>
<span class="nc" id="L203">                button.setVisibility(false);</span>
            }

<span class="nc" id="L206">            jsonArray.put(button.toJson());</span>
<span class="nc" id="L207">        }</span>

<span class="nc" id="L209">        toggleTwitterPreference();</span>

<span class="nc" id="L211">        JSONObject jsonObject = new JSONObject();</span>
        try {
<span class="nc" id="L213">            jsonObject.put(SHARING_BUTTONS_KEY, jsonArray);</span>
<span class="nc" id="L214">        } catch (JSONException e) {</span>
<span class="nc" id="L215">            AppLog.e(AppLog.T.SETTINGS, e);</span>
<span class="nc" id="L216">        }</span>

<span class="nc" id="L218">        WordPress.getRestClientUtilsV1_1()</span>
<span class="nc" id="L219">                 .setSharingButtons(Long.toString(mSite.getSiteId()), jsonObject,</span>
                         this::configureSharingButtonsFromResponse,
<span class="nc" id="L221">                         error -&gt; AppLog.e(AppLog.T.SETTINGS, error.getMessage()));</span>
<span class="nc" id="L222">    }</span>

    /*
     * show the twitter username pref only if there's a twitter sharing button enabled
     */
    private void toggleTwitterPreference() {
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if (!isAdded()) {</span>
<span class="nc" id="L229">            return;</span>
        }

<span class="nc" id="L232">        View view = getView();</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (view != null) {</span>
<span class="nc" id="L234">            View twitterContainer = view.findViewById(R.id.twitter_container);</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">            for (int i = 0; i &lt; mPublicizeButtons.size(); i++) {</span>
<span class="nc" id="L236">                PublicizeButton publicizeButton = mPublicizeButtons.get(i);</span>
<span class="nc bnc" id="L237" title="All 4 branches missed.">                if (publicizeButton.getId().equals(TWITTER_ID) &amp;&amp; publicizeButton.isEnabled()) {</span>
<span class="nc" id="L238">                    twitterContainer.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L239">                    return;</span>
                }
            }
<span class="nc" id="L242">            twitterContainer.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L244">    }</span>

    /*
     * calls the backend to determine which sharing and more buttons are enabled
     */
    private void configureSharingButtons() {
<span class="nc" id="L250">        WordPress.getRestClientUtilsV1_1()</span>
<span class="nc" id="L251">                 .getSharingButtons(Long.toString(mSite.getSiteId()),</span>
                         this::configureSharingButtonsFromResponse,
<span class="nc" id="L253">                         error -&gt; AppLog.e(AppLog.T.SETTINGS, error));</span>
<span class="nc" id="L254">    }</span>

    private void configureSharingButtonsFromResponse(JSONObject response) {
        // the array of buttons is in SHARING_BUTTONS_KEY for the GET response,
        // or SHARING_BUTTONS_UPDATED_KEY for the POST response
        JSONArray jsonArray;
<span class="nc bnc" id="L260" title="All 2 branches missed.">        if (response.has(SHARING_BUTTONS_KEY)) {</span>
<span class="nc" id="L261">            jsonArray = response.optJSONArray(SHARING_BUTTONS_KEY);</span>
        } else {
<span class="nc" id="L263">            jsonArray = response.optJSONArray(SHARING_BUTTONS_UPDATED_KEY);</span>
        }
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (jsonArray == null) {</span>
<span class="nc" id="L266">            AppLog.w(AppLog.T.SETTINGS, &quot;Publicize sharing buttons missing from response&quot;);</span>
<span class="nc" id="L267">            return;</span>
        }

<span class="nc" id="L270">        mPublicizeButtons.clear();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">        for (int i = 0; i &lt; jsonArray.length(); i++) {</span>
<span class="nc" id="L272">            JSONObject object = jsonArray.optJSONObject(i);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (object != null) {</span>
<span class="nc" id="L274">                PublicizeButton publicizeButton = new PublicizeButton(object);</span>
<span class="nc" id="L275">                mPublicizeButtons.add(publicizeButton);</span>
            }
        }

<span class="nc" id="L279">        PrefListItems sharingListItems = new PrefListItems();</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">        for (PublicizeButton button : mPublicizeButtons) {</span>
<span class="nc" id="L281">            String itemName = button.getName();</span>
<span class="nc" id="L282">            String itemValue = button.getId();</span>
<span class="nc bnc" id="L283" title="All 4 branches missed.">            boolean isChecked = button.isEnabled() &amp;&amp; button.isVisible();</span>
<span class="nc" id="L284">            PrefListItem item = new PrefListItem(itemName, itemValue, isChecked);</span>
<span class="nc" id="L285">            sharingListItems.add(item);</span>
<span class="nc" id="L286">        }</span>
<span class="nc" id="L287">        mPrefSharingButtons.setListItems(sharingListItems);</span>

<span class="nc" id="L289">        PrefListItems moreListItems = new PrefListItems();</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">        for (PublicizeButton button : mPublicizeButtons) {</span>
<span class="nc" id="L291">            String itemName = button.getName();</span>
<span class="nc" id="L292">            String itemValue = button.getId();</span>
<span class="nc bnc" id="L293" title="All 4 branches missed.">            boolean isChecked = button.isEnabled() &amp;&amp; !button.isVisible();</span>
<span class="nc" id="L294">            PrefListItem item = new PrefListItem(itemName, itemValue, isChecked);</span>
<span class="nc" id="L295">            moreListItems.add(item);</span>
<span class="nc" id="L296">        }</span>
<span class="nc" id="L297">        mPrefMoreButtons.setListItems(moreListItems);</span>

<span class="nc" id="L299">        toggleTwitterPreference();</span>
<span class="nc" id="L300">    }</span>

    /*
     * retrieves the site settings, first from the local cache and then optionally
     * from the backend - either way this will cause onSettingsUpdated() to be
     * called so the settings will be reflected here
     */
    private void getSiteSettings(boolean shouldFetchSettings) {
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if (mSiteSettings == null) {</span>
            // mSiteSettings should not be null here, but we've had some cases where it's null and the app crashed.
            // See #6890
<span class="nc bnc" id="L311" title="All 2 branches missed.">            if (mSite == null) {</span>
<span class="nc" id="L312">                ToastUtils.showToast(getActivity(), R.string.blog_not_found, ToastUtils.Duration.SHORT);</span>
<span class="nc" id="L313">                getActivity().finish();</span>
<span class="nc" id="L314">                return;</span>
            }

            // this creates a default site settings interface - the actual settings will
            // be retrieved when getSiteSettings() is called
<span class="nc" id="L319">            mSiteSettings = SiteSettingsInterface.getInterface(getActivity(), mSite, this);</span>
        }

<span class="nc" id="L322">        mSiteSettings.init(false);</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (shouldFetchSettings) {</span>
<span class="nc" id="L325">            new Handler().postDelayed(() -&gt; mSiteSettings.init(true), FETCH_DELAY);</span>
        }
<span class="nc" id="L327">    }</span>

    /*
     * update the preference views from the site settings
     */
    private void setPreferencesFromSiteSettings() {
<span class="nc" id="L333">        assignPrefListeners(false);</span>
        try {
<span class="nc" id="L335">            boolean sharingModuleEnabled = mSiteSettings.isSharingModuleEnabled();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">            mSharingDisabledNotification.setVisibility(sharingModuleEnabled ? View.GONE : View.VISIBLE);</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">            mSharingSettingsWrapper.setVisibility(sharingModuleEnabled ? View.VISIBLE : View.GONE);</span>

<span class="nc" id="L339">            mPrefLabel.setTextEntry(mSiteSettings.getSharingLabel());</span>
<span class="nc" id="L340">            mPrefButtonStyle.setSummary(mSiteSettings.getSharingButtonStyleDisplayText(getActivity()));</span>

<span class="nc" id="L342">            mPrefShowReblog.setChecked(mSiteSettings.getAllowReblogButton());</span>
<span class="nc" id="L343">            mPrefShowLike.setChecked(mSiteSettings.getAllowLikeButton());</span>
<span class="nc" id="L344">            mPrefAllowCommentLikes.setChecked(mSiteSettings.getAllowCommentLikes());</span>

<span class="nc" id="L346">            mPrefTwitterName.setTextEntry(mSiteSettings.getTwitterUsername());</span>

            // configure the button style pref
<span class="nc" id="L349">            String selectedName = mSiteSettings.getSharingButtonStyleDisplayText(getActivity());</span>
<span class="nc" id="L350">            String[] names = getResources().getStringArray(R.array.sharing_button_style_display_array);</span>
<span class="nc" id="L351">            String[] values = getResources().getStringArray(R.array.sharing_button_style_array);</span>
<span class="nc" id="L352">            PrefListItems listItems = new PrefListItems();</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">            for (int i = 0; i &lt; names.length; i++) {</span>
<span class="nc" id="L354">                PrefListItem item = new PrefListItem(names[i], values[i], false);</span>
<span class="nc" id="L355">                listItems.add(item);</span>
            }
<span class="nc" id="L357">            listItems.setSelectedName(selectedName);</span>
<span class="nc" id="L358">            mPrefButtonStyle.setListItems(listItems);</span>
<span class="nc" id="L359">            mPrefButtonStyle.setSummary(selectedName);</span>
        } finally {
<span class="nc" id="L361">            assignPrefListeners(true);</span>
        }
<span class="nc" id="L363">    }</span>

    @Override
    public void onFetchError(Exception error) {
<span class="nc bnc" id="L367" title="All 2 branches missed.">        if (isAdded()) {</span>
<span class="nc" id="L368">            ToastUtils.showToast(getActivity(), R.string.error_fetch_remote_site_settings);</span>
<span class="nc" id="L369">            getActivity().finish();</span>
        }
<span class="nc" id="L371">    }</span>

    @Override
    public void onSaveError(Exception error) {
<span class="nc bnc" id="L375" title="All 2 branches missed.">        if (isAdded()) {</span>
<span class="nc" id="L376">            ToastUtils.showToast(WordPress.getContext(), R.string.error_post_remote_site_settings);</span>
        }
<span class="nc" id="L378">    }</span>

    @Override
    public void onSettingsUpdated() {
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (isAdded()) {</span>
<span class="nc" id="L383">            setPreferencesFromSiteSettings();</span>
        }
<span class="nc" id="L385">    }</span>

    @Override
    public void onSettingsSaved() {
        // no-op
<span class="nc" id="L390">    }</span>

    @Override
    public void onCredentialsValidated(Exception error) {
        // no-op
<span class="nc" id="L395">    }</span>

    @Override
    public void onPrefChanged(@NonNull WPPrefView pref) {
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (pref == mPrefSharingButtons) {</span>
<span class="nc" id="L400">            saveSharingButtons(true);</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">        } else if (pref == mPrefMoreButtons) {</span>
<span class="nc" id="L402">            saveSharingButtons(false);</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">        } else if (pref == mPrefButtonStyle) {</span>
<span class="nc" id="L404">            PrefListItem item = pref.getSelectedItem();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">            if (item != null) {</span>
<span class="nc" id="L406">                mSiteSettings.setSharingButtonStyle(item.getItemValue());</span>
            }
<span class="nc bnc" id="L408" title="All 2 branches missed.">        } else if (pref == mPrefLabel) {</span>
<span class="nc" id="L409">            mSiteSettings.setSharingLabel(pref.getTextEntry());</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">        } else if (pref == mPrefShowReblog) {</span>
<span class="nc" id="L411">            mSiteSettings.setAllowReblogButton(pref.isChecked());</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">        } else if (pref == mPrefShowLike) {</span>
<span class="nc" id="L413">            mSiteSettings.setAllowLikeButton(pref.isChecked());</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">        } else if (pref == mPrefAllowCommentLikes) {</span>
<span class="nc" id="L415">            mSiteSettings.setAllowCommentLikes(pref.isChecked());</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">        } else if (pref == mPrefTwitterName) {</span>
<span class="nc" id="L417">            String username = StringUtils.notNullStr(pref.getTextEntry());</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (username.startsWith(TWITTER_PREFIX)) {</span>
<span class="nc" id="L419">                username = username.substring(1, username.length());</span>
            }
<span class="nc" id="L421">            mSiteSettings.setTwitterUsername(username);</span>
        }

<span class="nc" id="L424">        mSiteSettings.saveSettings();</span>
<span class="nc" id="L425">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>