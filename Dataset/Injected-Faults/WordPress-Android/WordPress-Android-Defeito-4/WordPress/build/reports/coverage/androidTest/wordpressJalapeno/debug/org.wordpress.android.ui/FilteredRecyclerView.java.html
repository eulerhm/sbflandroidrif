<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FilteredRecyclerView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui</a> &gt; <span class="el_source">FilteredRecyclerView.java</span></div><h1>FilteredRecyclerView.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui;

import android.content.Context;
import android.content.res.TypedArray;
import android.util.AttributeSet;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.BaseAdapter;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.Spinner;
import android.widget.TextView;

import androidx.annotation.LayoutRes;
import androidx.annotation.MenuRes;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.appcompat.widget.Toolbar;
import androidx.core.view.ViewCompat;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.google.android.material.appbar.AppBarLayout;

import org.wordpress.android.R;
import org.wordpress.android.models.FilterCriteria;
import org.wordpress.android.util.AppLog;
import org.wordpress.android.util.DisplayUtils;
import org.wordpress.android.util.NetworkUtils;
import org.wordpress.android.util.helpers.SwipeToRefreshHelper;
import org.wordpress.android.util.widgets.CustomSwipeRefreshLayout;
import org.wordpress.android.widgets.RecyclerItemDecoration;

import java.util.ArrayList;
import java.util.List;

import static org.wordpress.android.util.WPSwipeToRefreshHelper.buildSwipeToRefreshHelper;


public class FilteredRecyclerView extends RelativeLayout {
    private ProgressBar mProgressLoadMore;
    private SwipeToRefreshHelper mSwipeToRefreshHelper;
    private Spinner mSpinner;
<span class="nc" id="L49">    private boolean mSelectingRememberedFilterOnCreate = false;</span>

<span class="nc" id="L51">    private boolean mHideAppBarLayout = false;</span>

    private RecyclerView mRecyclerView;
    private TextView mEmptyView;
    private Toolbar mToolbar;
    private AppBarLayout mAppBarLayout;
    private RecyclerView mSearchSuggestionsRecyclerView;

    private List&lt;FilterCriteria&gt; mFilterCriteriaOptions;
    private FilterCriteria mCurrentFilter;
    private FilterListener mFilterListener;
    private SpinnerAdapter mSpinnerAdapter;
    private RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; mAdapter;
    private int mSpinnerTextColor;
    private int mSpinnerDrawableRight;
    private AppLog.T mTAG;

    private boolean mShowEmptyView;
<span class="nc" id="L69">    private boolean mToolbarDisableScrollGestures = false;</span>
<span class="nc" id="L70">    @LayoutRes private int mSpinnerItemView = 0;</span>
<span class="nc" id="L71">    @LayoutRes private int mSpinnerDropDownItemView = 0;</span>

    public FilteredRecyclerView(Context context) {
<span class="nc" id="L74">        this(context, null);</span>
<span class="nc" id="L75">    }</span>

    public FilteredRecyclerView(Context context, AttributeSet attrs) {
<span class="nc" id="L78">        this(context, attrs, 0);</span>
<span class="nc" id="L79">    }</span>

    public FilteredRecyclerView(Context context, AttributeSet attrs, int defStyleAttr) {
<span class="nc" id="L82">        super(context, attrs, defStyleAttr);</span>
<span class="nc" id="L83">        init(context, attrs);</span>
<span class="nc" id="L84">    }</span>

    public RecyclerView getInternalRecyclerView() {
<span class="nc" id="L87">        return mRecyclerView;</span>
    }

    public void setRefreshing(boolean refreshing) {
<span class="nc" id="L91">        mSwipeToRefreshHelper.setRefreshing(refreshing);</span>
<span class="nc" id="L92">    }</span>

    public boolean isRefreshing() {
<span class="nc" id="L95">        return mSwipeToRefreshHelper.isRefreshing();</span>
    }

    public void setCurrentFilter(FilterCriteria filter) {
<span class="nc" id="L99">        mCurrentFilter = filter;</span>

<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (!mHideAppBarLayout) {</span>
<span class="nc" id="L102">            int position = mSpinnerAdapter.getIndexOfCriteria(filter);</span>
<span class="nc bnc" id="L103" title="All 4 branches missed.">            if (position &gt; -1 &amp;&amp; position != mSpinner.getSelectedItemPosition()) {</span>
<span class="nc" id="L104">                mSpinner.setSelection(position);</span>
            }
        }
<span class="nc" id="L107">    }</span>

    public FilterCriteria getCurrentFilter() {
<span class="nc" id="L110">        return mCurrentFilter;</span>
    }

    public boolean isValidFilter(FilterCriteria filter) {
<span class="nc bnc" id="L114" title="All 4 branches missed.">        return filter != null</span>
               &amp;&amp; mFilterCriteriaOptions != null
<span class="nc bnc" id="L116" title="All 2 branches missed.">               &amp;&amp; !mFilterCriteriaOptions.isEmpty()</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">               &amp;&amp; mFilterCriteriaOptions.contains(filter);</span>
    }

    public void setFilterListener(FilterListener filterListener) {
<span class="nc" id="L121">        mFilterListener = filterListener;</span>
<span class="nc" id="L122">        setup(false);</span>
<span class="nc" id="L123">    }</span>

    public void setAdapter(RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; adapter) {
<span class="nc" id="L126">        mAdapter = adapter;</span>
<span class="nc" id="L127">        mRecyclerView.setAdapter(mAdapter);</span>
<span class="nc" id="L128">    }</span>

    public RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; getAdapter() {
<span class="nc" id="L131">        return mAdapter;</span>
    }

    public void setSwipeToRefreshEnabled(boolean enable) {
<span class="nc" id="L135">        mSwipeToRefreshHelper.setEnabled(enable);</span>
<span class="nc" id="L136">    }</span>

    public void setLogT(AppLog.T tag) {
<span class="nc" id="L139">        mTAG = tag;</span>
<span class="nc" id="L140">    }</span>

    public void setCustomEmptyView() {
<span class="nc" id="L143">        mShowEmptyView = true;</span>
<span class="nc" id="L144">    }</span>

    private void init(@NonNull Context context, @Nullable AttributeSet attrs) {
<span class="nc" id="L147">        inflate(getContext(), R.layout.filtered_list_component, this);</span>

<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (attrs != null) {</span>
<span class="nc" id="L150">            TypedArray a = context.getTheme().obtainStyledAttributes(</span>
                    attrs,
                    R.styleable.FilteredRecyclerView,
                    0, 0);
            try {
<span class="nc" id="L155">                mToolbarDisableScrollGestures = a.getBoolean(</span>
                        R.styleable.FilteredRecyclerView_wpToolbarDisableScrollGestures, false);
<span class="nc" id="L157">                mSpinnerItemView = a.getResourceId(R.styleable.FilteredRecyclerView_wpSpinnerItemView, 0);</span>
<span class="nc" id="L158">                mSpinnerDropDownItemView = a.getResourceId(</span>
                        R.styleable.FilteredRecyclerView_wpSpinnerDropDownItemView, 0);

<span class="nc" id="L161">                mHideAppBarLayout = a.getBoolean(</span>
                        R.styleable.FilteredRecyclerView_wpHideAppBarLayout, false);
            } finally {
<span class="nc" id="L164">                a.recycle();</span>
            }
        }

<span class="nc" id="L168">        int spacingHorizontal = 0;</span>
<span class="nc" id="L169">        int spacingVertical = DisplayUtils.dpToPx(getContext(), 1);</span>
<span class="nc" id="L170">        mRecyclerView = findViewById(R.id.recycler_view);</span>
<span class="nc" id="L171">        mRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));</span>
<span class="nc" id="L172">        mRecyclerView.addItemDecoration(new RecyclerItemDecoration(spacingHorizontal, spacingVertical));</span>

<span class="nc" id="L174">        mToolbar = findViewById(R.id.toolbar_with_spinner);</span>
<span class="nc" id="L175">        mAppBarLayout = findViewById(R.id.app_bar_layout);</span>
<span class="nc" id="L176">        AppBarLayout.LayoutParams params = (AppBarLayout.LayoutParams) mToolbar.getLayoutParams();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (mToolbarDisableScrollGestures) {</span>
<span class="nc" id="L178">            params.setScrollFlags(0);</span>
        } else {
<span class="nc" id="L180">            params.setScrollFlags(AppBarLayout.LayoutParams.SCROLL_FLAG_SCROLL);</span>
        }

<span class="nc" id="L183">        mSearchSuggestionsRecyclerView = findViewById(R.id.suggestions_recycler_view);</span>

<span class="nc" id="L185">        mEmptyView = findViewById(R.id.empty_view);</span>

        // progress bar that appears when loading more items
<span class="nc" id="L188">        mProgressLoadMore = findViewById(R.id.progress_loading);</span>
<span class="nc" id="L189">        mProgressLoadMore.setVisibility(View.GONE);</span>

<span class="nc" id="L191">        mSwipeToRefreshHelper = buildSwipeToRefreshHelper(</span>
<span class="nc" id="L192">                (CustomSwipeRefreshLayout) findViewById(R.id.ptr_layout),</span>
<span class="nc" id="L193">                new SwipeToRefreshHelper.RefreshListener() {</span>
                    @Override
                    public void onRefreshStarted() {
<span class="nc" id="L196">                        post(new Runnable() {</span>
                            @Override
                            public void run() {
<span class="nc bnc" id="L199" title="All 2 branches missed.">                                if (!NetworkUtils.checkConnection(getContext())) {</span>
<span class="nc" id="L200">                                    mSwipeToRefreshHelper.setRefreshing(false);</span>
<span class="nc" id="L201">                                    updateEmptyView(EmptyViewMessageType.NETWORK_ERROR);</span>
<span class="nc" id="L202">                                    return;</span>
                                }
<span class="nc bnc" id="L204" title="All 2 branches missed.">                                if (mFilterListener != null) {</span>
<span class="nc" id="L205">                                    mFilterListener.onLoadData(true);</span>
                                }
<span class="nc" id="L207">                            }</span>
                        });
<span class="nc" id="L209">                    }</span>
                }
        );

<span class="nc bnc" id="L213" title="All 2 branches missed.">        if (mSpinner == null) {</span>
<span class="nc" id="L214">            mSpinner = findViewById(R.id.filter_spinner);</span>
        }

<span class="nc bnc" id="L217" title="All 2 branches missed.">        mAppBarLayout.setVisibility(mHideAppBarLayout ? View.GONE : View.VISIBLE);</span>
<span class="nc" id="L218">    }</span>

    private void setup(boolean refresh) {
<span class="nc" id="L221">        List&lt;FilterCriteria&gt; criterias = mFilterListener.onLoadFilterCriteriaOptions(refresh);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (criterias != null) {</span>
<span class="nc" id="L223">            mFilterCriteriaOptions = criterias;</span>
        }
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (criterias == null) {</span>
<span class="nc" id="L226">            mFilterListener.onLoadFilterCriteriaOptionsAsync(new FilterCriteriaAsyncLoaderListener() {</span>
                @Override
                public void onFilterCriteriasLoaded(List&lt;FilterCriteria&gt; criteriaList) {
<span class="nc bnc" id="L229" title="All 2 branches missed.">                    if (criteriaList != null) {</span>
<span class="nc" id="L230">                        mFilterCriteriaOptions = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L231">                        mFilterCriteriaOptions.addAll(criteriaList);</span>
<span class="nc" id="L232">                        initFilterAdapter();</span>
<span class="nc" id="L233">                        setCurrentFilter(mFilterListener.onRecallSelection());</span>
                    }
<span class="nc" id="L235">                }</span>
            }, refresh);
        } else {
<span class="nc" id="L238">            initFilterAdapter();</span>
<span class="nc" id="L239">            setCurrentFilter(mFilterListener.onRecallSelection());</span>
        }
<span class="nc" id="L241">    }</span>

    private void onSpinnerItemSelected(int position) {
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (mHideAppBarLayout) {</span>
<span class="nc" id="L245">            throw new IllegalStateException(&quot;Developer error: Spinner shouldn't be visible when the appbar is hidden.&quot;);</span>
        }
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (mSelectingRememberedFilterOnCreate) {</span>
<span class="nc" id="L248">            mSelectingRememberedFilterOnCreate = false;</span>
<span class="nc" id="L249">            return;</span>
        }

<span class="nc" id="L252">        FilterCriteria selectedCriteria = (FilterCriteria) mSpinnerAdapter.getItem(position);</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (mCurrentFilter == selectedCriteria) {</span>
<span class="nc" id="L255">            AppLog.d(mTAG, &quot;The selected STATUS is already active: &quot;</span>
<span class="nc" id="L256">                           + selectedCriteria.getLabel());</span>
<span class="nc" id="L257">            return;</span>
        }

<span class="nc" id="L260">        AppLog.d(mTAG, &quot;NEW STATUS : &quot; + selectedCriteria.getLabel());</span>
<span class="nc" id="L261">        setCurrentFilter(selectedCriteria);</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (mFilterListener != null) {</span>
<span class="nc" id="L263">            mFilterListener.onFilterSelected(position, selectedCriteria);</span>
<span class="nc" id="L264">            setRefreshing(true);</span>
<span class="nc" id="L265">            mFilterListener.onLoadData(false);</span>
        }
<span class="nc" id="L267">    }</span>

    private void initFilterAdapter() {
<span class="nc" id="L270">        mSelectingRememberedFilterOnCreate = true;</span>

<span class="nc" id="L272">        mSpinnerAdapter = new SpinnerAdapter(getContext(),</span>
                mFilterCriteriaOptions, mSpinnerItemView, mSpinnerDropDownItemView);

<span class="nc" id="L275">        mSpinner.setAdapter(mSpinnerAdapter);</span>
<span class="nc" id="L276">        mSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {</span>
            @Override
            public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {
<span class="nc" id="L279">                onSpinnerItemSelected(position);</span>
<span class="nc" id="L280">            }</span>

            @Override
            public void onNothingSelected(AdapterView&lt;?&gt; parent) {
                // nop
<span class="nc" id="L285">            }</span>
        });
<span class="nc" id="L287">    }</span>

    private boolean hasAdapter() {
<span class="nc bnc" id="L290" title="All 2 branches missed.">        return (mAdapter != null);</span>
    }

    public void hideEmptyView() {
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (mEmptyView != null) {</span>
<span class="nc" id="L295">            mEmptyView.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L297">    }</span>

    public void updateEmptyView(EmptyViewMessageType emptyViewMessageType) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (mEmptyView == null) return;</span>

<span class="nc bnc" id="L302" title="All 4 branches missed.">        if (!hasAdapter() || mAdapter.getItemCount() == 0) {</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">            if (mFilterListener != null) {</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">                if (mShowEmptyView) {</span>
<span class="nc" id="L305">                    String msg = mFilterListener.onShowEmptyViewMessage(emptyViewMessageType);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                    if (msg == null) {</span>
<span class="nc" id="L307">                        msg = getContext().getString(R.string.empty_list_default);</span>
                    }
<span class="nc" id="L309">                    mEmptyView.setText(msg);</span>
<span class="nc" id="L310">                    mEmptyView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L311">                } else {</span>
<span class="nc" id="L312">                    mEmptyView.setVisibility(View.GONE);</span>
<span class="nc" id="L313">                    mFilterListener.onShowCustomEmptyView(emptyViewMessageType);</span>
                }
            }
        } else {
<span class="nc" id="L317">            mEmptyView.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L319">    }</span>

    /**
     * show/hide progress bar which appears at the bottom when loading more items
     */
    public void showLoadingProgress() {
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (mProgressLoadMore != null) {</span>
<span class="nc" id="L326">            mProgressLoadMore.setVisibility(View.VISIBLE);</span>
        }
<span class="nc" id="L328">    }</span>

    public void hideLoadingProgress() {
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (mProgressLoadMore != null) {</span>
<span class="nc" id="L332">            mProgressLoadMore.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L334">    }</span>

    /*
     * add a menu to the right side of the toolbar, returns the toolbar menu so the caller
     * can act upon it
     */
    public Menu addToolbarMenu(@MenuRes int menuResId) {
<span class="nc" id="L341">        mToolbar.inflateMenu(menuResId);</span>
<span class="nc" id="L342">        return mToolbar.getMenu();</span>
    }

    public void setToolbarBackgroundColor(int color) {
<span class="nc" id="L346">        mToolbar.setBackgroundColor(color);</span>
<span class="nc" id="L347">    }</span>

    public void setToolbarSpinnerTextColor(int color) {
<span class="nc" id="L350">        mSpinnerTextColor = color;</span>
<span class="nc" id="L351">    }</span>

    public void setToolbarSpinnerDrawable(int drawableResId) {
<span class="nc" id="L354">        mSpinnerDrawableRight = drawableResId;</span>
<span class="nc" id="L355">    }</span>

    public void setToolbarLeftPadding(int paddingLeft) {
<span class="nc" id="L358">        ViewCompat.setPaddingRelative(mToolbar, paddingLeft, mToolbar.getPaddingTop(),</span>
<span class="nc" id="L359">                ViewCompat.getPaddingEnd(mToolbar), mToolbar.getPaddingBottom());</span>
<span class="nc" id="L360">    }</span>

    public void setToolbarRightPadding(int paddingRight) {
<span class="nc" id="L363">        ViewCompat.setPaddingRelative(mToolbar, ViewCompat.getPaddingStart(mToolbar), mToolbar.getPaddingTop(),</span>
<span class="nc" id="L364">                paddingRight, mToolbar.getPaddingBottom());</span>
<span class="nc" id="L365">    }</span>

    public void setToolbarLeftAndRightPadding(int paddingLeft, int paddingRight) {
<span class="nc" id="L368">        ViewCompat.setPaddingRelative(mToolbar, paddingLeft, mToolbar.getPaddingTop(), paddingRight,</span>
<span class="nc" id="L369">                mToolbar.getPaddingBottom());</span>
<span class="nc" id="L370">    }</span>

    public void setToolbarTitle(@StringRes int title, int startMargin) {
<span class="nc" id="L373">        mToolbar.setTitle(title);</span>
<span class="nc" id="L374">        mToolbar.setTitleMarginStart(startMargin);</span>
<span class="nc" id="L375">    }</span>

    public void setToolbarScrollFlags(int flags) {
<span class="nc" id="L378">        AppBarLayout.LayoutParams params = (AppBarLayout.LayoutParams) mToolbar.getLayoutParams();</span>
<span class="nc" id="L379">        params.setScrollFlags(flags);</span>
<span class="nc" id="L380">        mToolbar.setLayoutParams(params);</span>
<span class="nc" id="L381">    }</span>

    public void scrollRecycleViewToPosition(int position) {
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (mRecyclerView == null) {</span>
<span class="nc" id="L385">            return;</span>
        }

<span class="nc" id="L388">        mRecyclerView.scrollToPosition(position);</span>
<span class="nc" id="L389">    }</span>

    public int getCurrentPosition() {
<span class="nc bnc" id="L392" title="All 4 branches missed.">        if (mRecyclerView != null &amp;&amp; mRecyclerView.getLayoutManager() != null) {</span>
<span class="nc" id="L393">            return ((LinearLayoutManager) mRecyclerView.getLayoutManager()).findFirstVisibleItemPosition();</span>
        } else {
<span class="nc" id="L395">            return -1;</span>
        }
    }

    public void smoothScrollToPosition(int position) {
<span class="nc bnc" id="L400" title="All 4 branches missed.">        if (mRecyclerView != null &amp;&amp; mRecyclerView.getLayoutManager() != null) {</span>
<span class="nc" id="L401">            mRecyclerView.getLayoutManager().smoothScrollToPosition(mRecyclerView, null, position);</span>
        }
<span class="nc" id="L403">    }</span>

    public void addItemDecoration(RecyclerView.ItemDecoration decor) {
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if (mRecyclerView == null) return;</span>

<span class="nc" id="L408">        mRecyclerView.addItemDecoration(decor);</span>
<span class="nc" id="L409">    }</span>

    public void addOnScrollListener(RecyclerView.OnScrollListener listener) {
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (mRecyclerView != null) {</span>
<span class="nc" id="L413">            mRecyclerView.addOnScrollListener(listener);</span>
        }
<span class="nc" id="L415">    }</span>

    public void removeOnScrollListener(RecyclerView.OnScrollListener listener) {
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (mRecyclerView != null) {</span>
<span class="nc" id="L419">            mRecyclerView.removeOnScrollListener(listener);</span>
        }
<span class="nc" id="L421">    }</span>

    public AppBarLayout getAppBarLayout() {
<span class="nc" id="L424">        return mAppBarLayout;</span>
    }

    /*
     * use this if you need to reload the criterias for this FilteredRecyclerView. The actual data loading goes
     * through the FilteredRecyclerView lifecycle using its listeners:
     *
     * - FilterCriteriaAsyncLoaderListener
     * and
     * - FilterListener.onLoadFilterCriteriaOptions
     * */
    public void refreshFilterCriteriaOptions() {
<span class="nc" id="L436">        setup(true);</span>
<span class="nc" id="L437">    }</span>

    public void showSearchSuggestions() {
<span class="nc" id="L440">        mSearchSuggestionsRecyclerView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L441">    }</span>

    public void hideSearchSuggestions() {
<span class="nc" id="L444">        mSearchSuggestionsRecyclerView.setVisibility(View.GONE);</span>
<span class="nc" id="L445">    }</span>

    public void setSearchSuggestionAdapter(RecyclerView.Adapter searchSuggestionAdapter) {
<span class="nc" id="L448">        mSearchSuggestionsRecyclerView.setAdapter(searchSuggestionAdapter);</span>
<span class="nc" id="L449">    }</span>

    public void showAppBarLayout() {
<span class="nc" id="L452">        mAppBarLayout.setVisibility(VISIBLE);</span>
<span class="nc" id="L453">    }</span>

    /*
     * adapter used by the filter spinner
     */
    private class SpinnerAdapter extends BaseAdapter {
        private final List&lt;FilterCriteria&gt; mFilterValues;
        private final LayoutInflater mInflater;
        @LayoutRes private final int mItemView;
        @LayoutRes private final int mDropDownItemView;

        SpinnerAdapter(Context context,
                       List&lt;FilterCriteria&gt; filterValues,
                       @LayoutRes int itemView,
<span class="nc" id="L467">                       @LayoutRes int dropDownItemView) {</span>
<span class="nc" id="L468">            super();</span>
<span class="nc" id="L469">            mInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span>
<span class="nc" id="L470">            mFilterValues = filterValues;</span>

<span class="nc bnc" id="L472" title="All 2 branches missed.">            if (itemView == 0) {</span>
<span class="nc" id="L473">                mItemView = R.layout.filter_spinner_item;</span>
            } else {
<span class="nc" id="L475">                mItemView = itemView;</span>
            }

<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (dropDownItemView == 0) {</span>
<span class="nc" id="L479">                mDropDownItemView = R.layout.toolbar_spinner_dropdown_item;</span>
            } else {
<span class="nc" id="L481">                mDropDownItemView = dropDownItemView;</span>
            }
<span class="nc" id="L483">        }</span>

        @Override
        public int getCount() {
<span class="nc bnc" id="L487" title="All 2 branches missed.">            return (mFilterValues != null ? mFilterValues.size() : 0);</span>
        }

        @Override
        public Object getItem(int position) {
<span class="nc" id="L492">            return mFilterValues.get(position);</span>
        }

        @Override
        public long getItemId(int position) {
<span class="nc" id="L497">            return position;</span>
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            final View view;
<span class="nc bnc" id="L503" title="All 2 branches missed.">            if (convertView == null) {</span>
<span class="nc" id="L504">                view = mInflater.inflate(mItemView, parent, false);</span>

<span class="nc" id="L506">                final TextView text = view.findViewById(R.id.text);</span>
<span class="nc" id="L507">                FilterCriteria selectedCriteria = (FilterCriteria) getItem(position);</span>
<span class="nc" id="L508">                text.setText(selectedCriteria.getLabel());</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">                if (mSpinnerTextColor != 0) {</span>
<span class="nc" id="L510">                    text.setTextColor(mSpinnerTextColor);</span>
                }

<span class="nc bnc" id="L513" title="All 2 branches missed.">                if (mSpinnerDrawableRight != 0) {</span>
<span class="nc" id="L514">                    text.setCompoundDrawablePadding(getResources().getDimensionPixelSize(R.dimen.margin_medium));</span>
<span class="nc" id="L515">                    text.setGravity(Gravity.CENTER_VERTICAL | Gravity.START);</span>
                }
<span class="nc" id="L517">            } else {</span>
<span class="nc" id="L518">                view = convertView;</span>
            }

<span class="nc" id="L521">            return view;</span>
        }

        @Override
        public View getDropDownView(int position, View convertView, ViewGroup parent) {
<span class="nc" id="L526">            FilterCriteria selectedCriteria = (FilterCriteria) getItem(position);</span>
            final TagViewHolder holder;

<span class="nc bnc" id="L529" title="All 2 branches missed.">            if (convertView == null) {</span>
<span class="nc" id="L530">                convertView = mInflater.inflate(mDropDownItemView, parent, false);</span>
<span class="nc" id="L531">                holder = new TagViewHolder(convertView);</span>
<span class="nc" id="L532">                convertView.setTag(holder);</span>
            } else {
<span class="nc" id="L534">                holder = (TagViewHolder) convertView.getTag();</span>
            }

<span class="nc" id="L537">            holder.mTextView.setText(selectedCriteria.getLabel());</span>
<span class="nc" id="L538">            return convertView;</span>
        }

        private class TagViewHolder {
            private final TextView mTextView;

<span class="nc" id="L544">            TagViewHolder(View view) {</span>
<span class="nc" id="L545">                mTextView = view.findViewById(R.id.text);</span>
<span class="nc" id="L546">            }</span>
        }

        public int getIndexOfCriteria(FilterCriteria tm) {
<span class="nc bnc" id="L550" title="All 4 branches missed.">            if (tm != null &amp;&amp; mFilterValues != null) {</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">                for (int i = 0; i &lt; mFilterValues.size(); i++) {</span>
<span class="nc" id="L552">                    FilterCriteria criteria = mFilterValues.get(i);</span>
<span class="nc bnc" id="L553" title="All 4 branches missed.">                    if (criteria != null &amp;&amp; criteria.equals(tm)) {</span>
<span class="nc" id="L554">                        return i;</span>
                    }
                }
            }
<span class="nc" id="L558">            return -1;</span>
        }
    }

    /*
     * returns true if the first item is still visible in the RecyclerView - will return
     * false if the first item is scrolled out of view, or if the list is empty
     */
    public boolean isFirstItemVisible() {
<span class="nc bnc" id="L567" title="All 2 branches missed.">        if (mRecyclerView == null</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">            || mRecyclerView.getLayoutManager() == null) {</span>
<span class="nc" id="L569">            return false;</span>
        }

<span class="nc" id="L572">        View child = mRecyclerView.getLayoutManager().getChildAt(0);</span>
<span class="nc bnc" id="L573" title="All 4 branches missed.">        return (child != null &amp;&amp; mRecyclerView.getLayoutManager().getPosition(child) == 0);</span>
    }

    /**
     * implement this interface to use FilterRecyclerView
     */
    public interface FilterListener {
        /**
         * Called upon initialization - provide an array of FilterCriterias here. These are the possible criterias
         * the Spinner is loaded with, and through which the data can be filtered.
         *
         * @param refresh &quot;true&quot;if the criterias need be refreshed
         * @return an array of FilterCriteria to be used on Spinner initialization, or null if going to use the
         * Async method below
         */
        List&lt;FilterCriteria&gt; onLoadFilterCriteriaOptions(boolean refresh);

        /**
         * Called upon initialization - you can use this callback to start an asynctask to build an array of
         * FilterCriterias here. Once the AsyncTask is done, it should call the provided listener
         * The Spinner is then loaded with such array of FilterCriterias, through which the main data can be filtered.
         *
         * @param listener to be called to pass the FilterCriteria array when done
         * @param refresh  &quot;true&quot;if the criterias need be refreshed
         */
        void onLoadFilterCriteriaOptionsAsync(FilterCriteriaAsyncLoaderListener listener, boolean refresh);

        /**
         * Called upon initialization, right after onLoadFilterCriteriaOptions().
         * Once the criteria options are set up, use this callback to return the latest option selected on the
         * screen the last time the user visited it, or a default value for the filter Spinner to be initialized with.
         *
         * @return
         */
        FilterCriteria onRecallSelection();

        /**
         * When this method is called, you should load data into the FilteredRecyclerView adapter, using the
         * latest criteria passed to you in a previous onFilterSelected() call.
         * Within the FilteredRecyclerView lifecycle, this is triggered in three different moments:
         * 1 - upon initialisation
         * 2 - each time a screen refresh is requested
         * 3 - each time the user changes the filter spinner selection
         */
        void onLoadData(boolean forced);

        /**
         * Called each time the user changes the Spinner selection (i.e. changes the criteria on which to filter
         * the data). You should only take note of the change, and remember it, as a request to load data with
         * the newly selected filter shall always arrive through onLoadData().
         * The parameters passed in this callback can be used alternatively as per your convenience.
         *
         * @param position of the selected criteria within the array returned by onLoadFilterCriteriaOptions()
         * @param criteria the actual criteria selected
         */
        void onFilterSelected(int position, FilterCriteria criteria);

        /**
         * Called when there's no data to show.
         *
         * @param emptyViewMsgType this will hint you on the reason why no data is being shown, so you can return
         *                         a proper message to be displayed to the user
         * @return the message to be displayed to the user, or null if using a Custom Empty View (see below)
         */
        String onShowEmptyViewMessage(EmptyViewMessageType emptyViewMsgType);

        /**
         * Called when there's no data to show, and only if a custom EmptyView is set (onShowEmptyViewMessage will
         * be called otherwise).
         *
         * @param emptyViewMsgType this will hint you on the reason why no data is being shown, and
         *                         also here you should perform any actions on your custom empty view
         * @return nothing
         */
        void onShowCustomEmptyView(EmptyViewMessageType emptyViewMsgType);
    }

    /**
     * implement this interface to load filtering options (that is, an array of FilterCriteria) asynchronously
     */
    public interface FilterCriteriaAsyncLoaderListener {
        /**
         * Will be called during initialization of FilteredRecyclerView once you're ready building the
         * FilterCriteria array
         *
         * @param criteriaList the array of FilterCriteria objects you just built
         */
        void onFilterCriteriasLoaded(List&lt;FilterCriteria&gt; criteriaList);
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>