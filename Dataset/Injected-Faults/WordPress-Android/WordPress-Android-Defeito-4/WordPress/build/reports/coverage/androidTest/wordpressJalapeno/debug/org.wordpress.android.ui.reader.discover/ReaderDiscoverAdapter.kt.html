<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderDiscoverAdapter.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.discover</a> &gt; <span class="el_source">ReaderDiscoverAdapter.kt</span></div><h1>ReaderDiscoverAdapter.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.discover

import android.view.ViewGroup
import androidx.recyclerview.widget.DiffUtil
import androidx.recyclerview.widget.RecyclerView.Adapter
import org.wordpress.android.ui.reader.discover.ReaderCardUiState.ReaderInterestsCardUiState
import org.wordpress.android.ui.reader.discover.ReaderCardUiState.ReaderPostUiState
import org.wordpress.android.ui.reader.discover.ReaderCardUiState.ReaderRecommendedBlogsCardUiState
import org.wordpress.android.ui.reader.discover.ReaderCardUiState.ReaderWelcomeBannerCardUiState
import org.wordpress.android.ui.reader.discover.viewholders.ReaderInterestsCardViewHolder
import org.wordpress.android.ui.reader.discover.viewholders.ReaderPostViewHolder
import org.wordpress.android.ui.reader.discover.viewholders.ReaderRecommendedBlogsCardViewHolder
import org.wordpress.android.ui.reader.discover.viewholders.ReaderViewHolder
import org.wordpress.android.ui.reader.discover.viewholders.WelcomeBannerViewHolder
import org.wordpress.android.ui.reader.tracker.ReaderTracker
import org.wordpress.android.ui.utils.UiHelpers
import org.wordpress.android.util.image.ImageManager

private const val welcomeBannerViewType: Int = 1
private const val postViewType: Int = 2
private const val interestViewType: Int = 3
private const val recommendedBlogsViewType: Int = 4

<span class="nc" id="L24">class ReaderDiscoverAdapter(</span>
<span class="nc" id="L25">    private val uiHelpers: UiHelpers,</span>
<span class="nc" id="L26">    private val imageManager: ImageManager,</span>
<span class="nc" id="L27">    private val readerTracker: ReaderTracker</span>
<span class="nc" id="L28">) : Adapter&lt;ReaderViewHolder&lt;*&gt;&gt;() {</span>
<span class="nc" id="L29">    private val items = mutableListOf&lt;ReaderCardUiState&gt;()</span>
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ReaderViewHolder&lt;*&gt; {
<span class="nc bnc" id="L31" title="All 5 branches missed.">        return when (viewType) {</span>
<span class="nc" id="L32">            welcomeBannerViewType -&gt; WelcomeBannerViewHolder(parent)</span>
<span class="nc" id="L33">            postViewType -&gt; ReaderPostViewHolder(uiHelpers, imageManager, readerTracker, parent)</span>
<span class="nc" id="L34">            interestViewType -&gt; ReaderInterestsCardViewHolder(uiHelpers, parent)</span>
<span class="nc" id="L35">            recommendedBlogsViewType -&gt; ReaderRecommendedBlogsCardViewHolder(parent, imageManager, uiHelpers)</span>
<span class="nc" id="L36">            else -&gt; throw NotImplementedError(&quot;Unknown ViewType&quot;)</span>
        }
    }

<span class="nc" id="L40">    override fun getItemCount(): Int = items.size</span>

    override fun onBindViewHolder(holder: ReaderViewHolder&lt;*&gt;, position: Int) {
<span class="nc" id="L43">        holder.onBind(items[position])</span>
<span class="nc" id="L44">    }</span>

    fun update(newItems: List&lt;ReaderCardUiState&gt;) {
<span class="nc" id="L47">        val diffResult = DiffUtil.calculateDiff(DiscoverDiffUtil(items, newItems))</span>
<span class="nc" id="L48">        items.clear()</span>
<span class="nc" id="L49">        items.addAll(newItems)</span>
<span class="nc" id="L50">        diffResult.dispatchUpdatesTo(this)</span>
<span class="nc" id="L51">    }</span>

    override fun getItemViewType(position: Int): Int {
<span class="nc" id="L54">        return when (items[position]) {</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">            is ReaderWelcomeBannerCardUiState -&gt; welcomeBannerViewType</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">            is ReaderPostUiState -&gt; postViewType</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">            is ReaderInterestsCardUiState -&gt; interestViewType</span>
<span class="nc" id="L58">            is ReaderRecommendedBlogsCardUiState -&gt; recommendedBlogsViewType</span>
        }
    }

<span class="nc" id="L62">    private class DiscoverDiffUtil(</span>
<span class="nc" id="L63">        val oldItems: List&lt;ReaderCardUiState&gt;,</span>
<span class="nc" id="L64">        val newItems: List&lt;ReaderCardUiState&gt;</span>
<span class="nc" id="L65">    ) : DiffUtil.Callback() {</span>
        override fun areItemsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
<span class="nc" id="L67">            val oldItem = oldItems[oldItemPosition]</span>
<span class="nc" id="L68">            val newItem = newItems[newItemPosition]</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            if (oldItem::class != newItem::class) {</span>
<span class="nc" id="L70">                return false</span>
            }
<span class="nc" id="L72">            return when (oldItem) {</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">                is ReaderPostUiState -&gt; {</span>
<span class="nc bnc" id="L74" title="All 4 branches missed.">                    oldItem.postId == (newItem as ReaderPostUiState).postId &amp;&amp; oldItem.blogId == newItem.blogId</span>
                }
<span class="nc bnc" id="L76" title="All 2 branches missed.">                is ReaderRecommendedBlogsCardUiState -&gt; {</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">                    val newItemState = newItem as? ReaderRecommendedBlogsCardUiState</span>
<span class="nc bnc" id="L78" title="All 4 branches missed.">                    oldItem.blogs.map { it.blogId to it.feedId } == newItemState?.blogs?.map { it.blogId to it.feedId }</span>
                }
<span class="nc bnc" id="L80" title="All 2 branches missed.">                is ReaderWelcomeBannerCardUiState,</span>
<span class="nc" id="L81">                is ReaderInterestsCardUiState -&gt; {</span>
<span class="nc" id="L82">                    oldItem == newItem</span>
                }
            }
        }

<span class="nc" id="L87">        override fun getOldListSize(): Int = oldItems.size</span>

<span class="nc" id="L89">        override fun getNewListSize(): Int = newItems.size</span>

        override fun areContentsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
<span class="nc" id="L92">            return oldItems[oldItemPosition] == newItems[newItemPosition]</span>
        }

        override fun getChangePayload(oldItemPosition: Int, newItemPosition: Int): Any? {
            /* Returning true suppresses the default item animation. That's all we need - posts in Reader are static
            except of the like/follow/bookmark/... action states. We don't want to play the default animation when
            one of these states changes. */
<span class="nc" id="L99">            return true</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>