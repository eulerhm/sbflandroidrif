<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PageListDialogHelper.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.viewmodel.pages</a> &gt; <span class="el_source">PageListDialogHelper.kt</span></div><h1>PageListDialogHelper.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.viewmodel.pages

import org.wordpress.android.R
import org.wordpress.android.analytics.AnalyticsTracker.Stat.UNPUBLISHED_REVISION_DIALOG_LOAD_LOCAL_VERSION_CLICKED
import org.wordpress.android.analytics.AnalyticsTracker.Stat.UNPUBLISHED_REVISION_DIALOG_LOAD_UNPUBLISHED_VERSION_CLICKED
import org.wordpress.android.analytics.AnalyticsTracker.Stat.UNPUBLISHED_REVISION_DIALOG_SHOWN
import org.wordpress.android.fluxc.model.LocalOrRemoteId.RemoteId
import org.wordpress.android.fluxc.model.PostModel
import org.wordpress.android.ui.posts.PostUtils
import org.wordpress.android.ui.utils.UiString.UiStringRes
import org.wordpress.android.ui.utils.UiString.UiStringResWithParams
import org.wordpress.android.ui.utils.UiString.UiStringText
import org.wordpress.android.util.analytics.AnalyticsTrackerWrapper
import org.wordpress.android.viewmodel.helpers.DialogHolder
import java.lang.NullPointerException

private const val CONFIRM_ON_AUTOSAVE_REVISION_DIALOG_TAG = &quot;CONFIRM_ON_AUTOSAVE_REVISION_DIALOG_TAG&quot;
private const val CONFIRM_DELETE_PAGE_DIALOG_TAG = &quot;CONFIRM_DELETE_PAGE_DIALOG_TAG&quot;
private const val CONFIRM_COPY_CONFLICT_DIALOG_TAG = &quot;CONFIRM_COPY_CONFLICT_DIALOG_TAG&quot;
private const val POST_TYPE = &quot;post_type&quot;

<span class="nc" id="L22">class PageListDialogHelper(</span>
<span class="nc" id="L23">    private val showDialog: (DialogHolder) -&gt; Unit,</span>
<span class="nc" id="L24">    private val analyticsTracker: AnalyticsTrackerWrapper</span>
) {
    private var pageIdForAutosaveRevisionResolutionDialog: RemoteId? = null
    private var pageIdForDeleteDialog: RemoteId? = null
    private var pageIdForCopyDialog: RemoteId? = null

    fun showAutoSaveRevisionDialog(page: PostModel) {
<span class="nc" id="L31">        analyticsTracker.track(UNPUBLISHED_REVISION_DIALOG_SHOWN, mapOf(POST_TYPE to &quot;page&quot;))</span>
<span class="nc" id="L32">        val dialogHolder = DialogHolder(</span>
<span class="nc" id="L33">                tag = CONFIRM_ON_AUTOSAVE_REVISION_DIALOG_TAG,</span>
<span class="nc" id="L34">                title = UiStringRes(R.string.dialog_confirm_autosave_title),</span>
<span class="nc" id="L35">                message = PostUtils.getCustomStringForAutosaveRevisionDialog(page),</span>
<span class="nc" id="L36">                positiveButton = UiStringRes(R.string.dialog_confirm_autosave_restore_button),</span>
<span class="nc" id="L37">                negativeButton = UiStringRes(R.string.dialog_confirm_autosave_dont_restore_button)</span>
        )
<span class="nc" id="L39">        pageIdForAutosaveRevisionResolutionDialog = RemoteId(page.remotePostId)</span>
<span class="nc" id="L40">        showDialog.invoke(dialogHolder)</span>
<span class="nc" id="L41">    }</span>

    fun showDeletePageConfirmationDialog(pageId: RemoteId, pageTitle: String) {
<span class="nc" id="L44">        val dialogHolder = DialogHolder(</span>
<span class="nc" id="L45">                tag = CONFIRM_DELETE_PAGE_DIALOG_TAG,</span>
<span class="nc" id="L46">                title = UiStringRes(R.string.delete_page),</span>
<span class="nc" id="L47">                message = UiStringResWithParams(</span>
<span class="nc" id="L48">                        R.string.page_delete_dialog_message,</span>
<span class="nc" id="L49">                        listOf(UiStringText(pageTitle))</span>
                ),
<span class="nc" id="L51">                positiveButton = UiStringRes(R.string.delete),</span>
<span class="nc" id="L52">                negativeButton = UiStringRes(R.string.cancel)</span>
        )
<span class="nc" id="L54">        pageIdForDeleteDialog = pageId</span>
<span class="nc" id="L55">        showDialog.invoke(dialogHolder)</span>
<span class="nc" id="L56">    }</span>

    fun showCopyConflictDialog(page: PostModel) {
<span class="nc" id="L59">        val dialogHolder = DialogHolder(</span>
<span class="nc" id="L60">                tag = CONFIRM_COPY_CONFLICT_DIALOG_TAG,</span>
<span class="nc" id="L61">                title = UiStringRes(R.string.dialog_confirm_copy_local_title),</span>
<span class="nc" id="L62">                message = UiStringRes(R.string.dialog_confirm_copy_local_message),</span>
<span class="nc" id="L63">                positiveButton = UiStringRes(R.string.dialog_confirm_copy_local_edit_button),</span>
<span class="nc" id="L64">                negativeButton = UiStringRes(R.string.dialog_confirm_copy_local_copy_button)</span>
        )
<span class="nc" id="L66">        pageIdForCopyDialog = RemoteId(page.remotePostId)</span>
<span class="nc" id="L67">        showDialog.invoke(dialogHolder)</span>
<span class="nc" id="L68">    }</span>

    fun onPositiveClickedForBasicDialog(
        instanceTag: String,
        deletePage: (RemoteId) -&gt; Unit,
        editPage: (RemoteId, LoadAutoSaveRevision) -&gt; Unit,
        editPageFirst: (RemoteId) -&gt; Unit
    ) {
<span class="nc bnc" id="L76" title="All 4 branches missed.">        when (instanceTag) {</span>
<span class="nc bnc" id="L77" title="All 4 branches missed.">            CONFIRM_DELETE_PAGE_DIALOG_TAG -&gt; pageIdForDeleteDialog?.let {</span>
<span class="nc" id="L78">                pageIdForDeleteDialog = null</span>
<span class="nc" id="L79">                deletePage(it)</span>
<span class="nc" id="L80">            } ?: throw NullPointerException(&quot;pageIdForDeleteDialog shouldn't be null.&quot;)</span>
<span class="nc bnc" id="L81" title="All 4 branches missed.">            CONFIRM_ON_AUTOSAVE_REVISION_DIALOG_TAG -&gt; pageIdForAutosaveRevisionResolutionDialog?.let {</span>
                // open the editor with the restored auto save
<span class="nc" id="L83">                pageIdForAutosaveRevisionResolutionDialog = null</span>
<span class="nc" id="L84">                editPage(it, true)</span>
<span class="nc" id="L85">                analyticsTracker.track(</span>
<span class="nc" id="L86">                        UNPUBLISHED_REVISION_DIALOG_LOAD_UNPUBLISHED_VERSION_CLICKED,</span>
<span class="nc" id="L87">                        mapOf(POST_TYPE to &quot;page&quot;)</span>
                )
<span class="nc" id="L89">            }</span>
<span class="nc" id="L90">                    ?: throw NullPointerException(&quot;pageIdForAutosaveRevisionResolutionDialog shouldn't be null.&quot;)</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">            CONFIRM_COPY_CONFLICT_DIALOG_TAG -&gt; pageIdForCopyDialog?.let {</span>
<span class="nc" id="L92">                pageIdForCopyDialog = null</span>
<span class="nc" id="L93">                editPageFirst(it)</span>
<span class="nc" id="L94">            } ?: throw NullPointerException(&quot;pageIdForCopyDialog shouldn't be null.&quot;)</span>
<span class="nc" id="L95">            else -&gt; throw IllegalArgumentException(&quot;Dialog's positive button click is not handled: $instanceTag&quot;)</span>
        }
<span class="nc" id="L97">    }</span>

    fun onNegativeClickedForBasicDialog(
        instanceTag: String,
        editPage: (RemoteId, LoadAutoSaveRevision) -&gt; Unit,
        copyPage: (RemoteId) -&gt; Unit
    ) {
<span class="nc bnc" id="L104" title="All 4 branches missed.">        when (instanceTag) {</span>
<span class="nc" id="L105">            CONFIRM_DELETE_PAGE_DIALOG_TAG -&gt; pageIdForDeleteDialog = null</span>
<span class="nc bnc" id="L106" title="All 4 branches missed.">            CONFIRM_ON_AUTOSAVE_REVISION_DIALOG_TAG -&gt; pageIdForAutosaveRevisionResolutionDialog?.let {</span>
                // open the editor with the local page (don't use the auto save version)
<span class="nc" id="L108">                editPage(it, false)</span>
<span class="nc" id="L109">                analyticsTracker.track(</span>
<span class="nc" id="L110">                        UNPUBLISHED_REVISION_DIALOG_LOAD_LOCAL_VERSION_CLICKED,</span>
<span class="nc" id="L111">                        mapOf(POST_TYPE to &quot;page&quot;)</span>
                )
<span class="nc" id="L113">            }</span>
<span class="nc" id="L114">                    ?: throw NullPointerException(&quot;pageIdForAutosaveRevisionResolutionDialog shouldn't be null.&quot;)</span>
<span class="nc bnc" id="L115" title="All 4 branches missed.">            CONFIRM_COPY_CONFLICT_DIALOG_TAG -&gt; pageIdForCopyDialog?.let {</span>
<span class="nc" id="L116">                pageIdForCopyDialog = null</span>
<span class="nc" id="L117">                copyPage(it)</span>
<span class="nc" id="L118">            } ?: throw NullPointerException(&quot;pageIdForCopyDialog shouldn't be null.&quot;)</span>
<span class="nc" id="L119">            else -&gt; throw IllegalArgumentException(&quot;Dialog's negative button click is not handled: $instanceTag&quot;)</span>
        }
<span class="nc" id="L121">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>