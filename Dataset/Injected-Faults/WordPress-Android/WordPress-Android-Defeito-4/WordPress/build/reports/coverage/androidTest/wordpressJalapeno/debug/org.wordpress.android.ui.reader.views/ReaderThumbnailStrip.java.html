<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderThumbnailStrip.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.reader.views</a> &gt; <span class="el_source">ReaderThumbnailStrip.java</span></div><h1>ReaderThumbnailStrip.java</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.reader.views;

import android.content.Context;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.ImageView.ScaleType;
import android.widget.LinearLayout;

import org.wordpress.android.R;
import org.wordpress.android.datasets.ReaderPostTable;
import org.wordpress.android.ui.reader.ReaderActivityLauncher;
import org.wordpress.android.ui.reader.ReaderActivityLauncher.PhotoViewerOption;
import org.wordpress.android.ui.reader.models.ReaderImageList;
import org.wordpress.android.ui.reader.utils.ReaderImageScanner;
import org.wordpress.android.util.AniUtils;
import org.wordpress.android.util.DisplayUtils;
import org.wordpress.android.util.PhotonUtils;
import org.wordpress.android.util.image.ImageManager;
import org.wordpress.android.util.image.ImageType;

import java.util.EnumSet;

import static org.wordpress.android.ui.reader.ReaderConstants.MIN_GALLERY_IMAGE_WIDTH;
import static org.wordpress.android.ui.reader.ReaderConstants.THUMBNAIL_STRIP_IMG_COUNT;

/**
 * displays a row of image thumbnails from a reader post - only shows when two or more images
 * of a minimum size are found
 */
public class ReaderThumbnailStrip extends LinearLayout {
    private ViewGroup mView;
    private int mThumbnailHeight;
    private int mThumbnailWidth;

    public ReaderThumbnailStrip(Context context) {
<span class="nc" id="L39">        super(context);</span>
<span class="nc" id="L40">        initView(context);</span>
<span class="nc" id="L41">    }</span>

    public ReaderThumbnailStrip(Context context, AttributeSet attrs) {
<span class="nc" id="L44">        super(context, attrs);</span>
<span class="nc" id="L45">        initView(context);</span>
<span class="nc" id="L46">    }</span>

    public ReaderThumbnailStrip(Context context, AttributeSet attrs, int defStyleAttr) {
<span class="nc" id="L49">        super(context, attrs, defStyleAttr);</span>
<span class="nc" id="L50">        initView(context);</span>
<span class="nc" id="L51">    }</span>

    public ReaderThumbnailStrip(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
<span class="nc" id="L54">        super(context, attrs, defStyleAttr, defStyleRes);</span>
<span class="nc" id="L55">        initView(context);</span>
<span class="nc" id="L56">    }</span>

    private void initView(Context context) {
<span class="nc" id="L59">        mView = (ViewGroup) inflate(context, R.layout.reader_thumbnail_strip, this);</span>
<span class="nc" id="L60">        mThumbnailHeight = context.getResources().getDimensionPixelSize(R.dimen.reader_thumbnail_strip_image_height);</span>

<span class="nc" id="L62">        int displayWidth = DisplayUtils.getWindowPixelWidth(context);</span>
<span class="nc" id="L63">        int margins = context.getResources().getDimensionPixelSize(R.dimen.reader_card_content_padding) * 2;</span>
<span class="nc" id="L64">        mThumbnailWidth = (displayWidth - margins) / THUMBNAIL_STRIP_IMG_COUNT;</span>
<span class="nc" id="L65">    }</span>

    public void loadThumbnails(long blogId, long postId, boolean isPrivate) {
        // get this post's content and scan it for images suitable in a gallery
<span class="nc" id="L69">        final String content = ReaderPostTable.getPostText(blogId, postId);</span>
<span class="nc" id="L70">        final ReaderImageList imageList =</span>
                new ReaderImageScanner(content, isPrivate)
<span class="nc" id="L72">                        .getImageList(THUMBNAIL_STRIP_IMG_COUNT, MIN_GALLERY_IMAGE_WIDTH);</span>
<span class="nc" id="L73">        loadThumbnails(imageList, isPrivate, content);</span>
<span class="nc" id="L74">    }</span>

    public void loadThumbnails(ReaderImageList imageList, boolean isPrivate, String content) {
        // get rid of any views already added
<span class="nc" id="L78">        mView.removeAllViews();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (imageList.size() &lt; THUMBNAIL_STRIP_IMG_COUNT) {</span>
<span class="nc" id="L80">            mView.setVisibility(View.GONE);</span>
<span class="nc" id="L81">            return;</span>
        }

<span class="nc" id="L84">        final EnumSet&lt;PhotoViewerOption&gt; photoViewerOptions = EnumSet.of(PhotoViewerOption.IS_GALLERY_IMAGE);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (isPrivate) {</span>
<span class="nc" id="L86">            photoViewerOptions.add(PhotoViewerOption.IS_PRIVATE_IMAGE);</span>
        }

        // add a separate imageView for each image up to the max
<span class="nc" id="L90">        int numAdded = 0;</span>
<span class="nc" id="L91">        LayoutInflater inflater = LayoutInflater.from(getContext());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        for (final String imageUrl : imageList) {</span>
<span class="nc" id="L93">            View view = inflater.inflate(R.layout.reader_thumbnail_strip_image, mView, false);</span>
<span class="nc" id="L94">            ImageView imageView = view.findViewById(R.id.thumbnail_strip_image);</span>
<span class="nc" id="L95">            mView.addView(view);</span>

<span class="nc" id="L97">            String photonUrl = PhotonUtils.getPhotonImageUrl(imageUrl, mThumbnailWidth, mThumbnailHeight);</span>
<span class="nc" id="L98">            ImageManager.getInstance().load(imageView, ImageType.PHOTO, photonUrl, ScaleType.CENTER_CROP);</span>

<span class="nc" id="L100">            imageView.setOnClickListener(new OnClickListener() {</span>
                @Override
                public void onClick(View view) {
<span class="nc" id="L103">                    ReaderActivityLauncher.showReaderPhotoViewer(</span>
<span class="nc" id="L104">                            view.getContext(),</span>
                            imageUrl,
                            content,
                            view,
                            photoViewerOptions,
                            0,
                            0);
<span class="nc" id="L111">                }</span>
            });

<span class="nc" id="L114">            numAdded++;</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">            if (numAdded &gt;= THUMBNAIL_STRIP_IMG_COUNT) {</span>
<span class="nc" id="L116">                break;</span>
            }
<span class="nc" id="L118">        }</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (mView.getVisibility() != View.VISIBLE) {</span>
<span class="nc" id="L121">            AniUtils.fadeIn(mView, AniUtils.Duration.SHORT);</span>
        }
<span class="nc" id="L123">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>