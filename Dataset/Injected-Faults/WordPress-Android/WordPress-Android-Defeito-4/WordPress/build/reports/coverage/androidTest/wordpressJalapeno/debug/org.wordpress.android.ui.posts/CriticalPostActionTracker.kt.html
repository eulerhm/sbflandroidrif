<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CriticalPostActionTracker.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.posts</a> &gt; <span class="el_source">CriticalPostActionTracker.kt</span></div><h1>CriticalPostActionTracker.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.posts

import org.wordpress.android.BuildConfig
import org.wordpress.android.fluxc.model.LocalOrRemoteId.LocalId
import org.wordpress.android.util.AppLog
import org.wordpress.android.util.AppLog.T

<span class="nc" id="L8">class CriticalPostActionTracker(</span>
<span class="nc" id="L9">    private val onStateChanged: () -&gt; Unit,</span>
<span class="nc" id="L10">    private val shouldCrashOnUnexpectedAction: Boolean = BuildConfig.DEBUG</span>
) {
    enum class CriticalPostAction {
<span class="nc" id="L13">        DELETING_POST, RESTORING_POST, TRASHING_POST, TRASHING_POST_WITH_LOCAL_CHANGES, MOVING_POST_TO_DRAFT</span>
    }
<span class="nc" id="L15">    private val map = HashMap&lt;LocalId, CriticalPostAction&gt;()</span>

    fun add(localPostId: LocalId, criticalPostAction: CriticalPostAction) {
<span class="nc bnc" id="L18" title="All 2 branches missed.">        if (map.containsKey(localPostId)) {</span>
<span class="nc bnc" id="L19" title="All 2 branches missed.">            val currentActionName = map[localPostId]?.name</span>
<span class="nc" id="L20">            val newActionName = criticalPostAction.name</span>
<span class="nc" id="L21">            val errorMessage = &quot;We should not perform more than one critical post action. Current action is &quot; +</span>
<span class="nc" id="L22">                    &quot;($currentActionName), new action is ($newActionName)&quot;</span>
<span class="nc" id="L23">            AppLog.e(T.POSTS, errorMessage)</span>
<span class="nc bnc" id="L24" title="All 2 branches missed.">            if (shouldCrashOnUnexpectedAction) {</span>
<span class="nc" id="L25">                throw IllegalStateException(errorMessage)</span>
            }
        }
<span class="nc" id="L28">        map[localPostId] = criticalPostAction</span>
<span class="nc" id="L29">        onStateChanged.invoke()</span>
<span class="nc" id="L30">    }</span>

<span class="nc" id="L32">    fun contains(localPostId: LocalId): Boolean = map.containsKey(localPostId)</span>

<span class="nc" id="L34">    fun get(localPostId: LocalId): CriticalPostAction? = map[localPostId]</span>

    fun remove(localPostId: LocalId, criticalPostAction: CriticalPostAction) {
<span class="nc bnc" id="L37" title="All 2 branches missed.">        if (map[localPostId] == criticalPostAction) {</span>
<span class="nc" id="L38">            map.remove(localPostId)</span>
<span class="nc" id="L39">            onStateChanged.invoke()</span>
        }
<span class="nc" id="L41">    }</span>
<span class="nc" id="L42">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>