<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SupportHelper.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.support</a> &gt; <span class="el_source">SupportHelper.kt</span></div><h1>SupportHelper.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.support

import android.content.Context
import android.view.LayoutInflater
import android.view.View
import android.view.View.GONE
import android.widget.EditText
import android.widget.TextView
import androidx.appcompat.app.AlertDialog
import com.google.android.material.dialog.MaterialAlertDialogBuilder
import org.wordpress.android.R
import org.wordpress.android.fluxc.model.AccountModel
import org.wordpress.android.fluxc.model.SiteModel
import org.wordpress.android.util.validateEmail

<span class="fc" id="L16">class SupportHelper {</span>
    /**
     * This is a helper function that shows the support identity input dialog and runs the provided function with
     * the input from it.
     *
     * @param context Context the dialog will be showed from
     * @param email Initial value for the email field
     * @param name Initial value for the name field
     * @param isNameInputHidden Whether the name input field should be shown or not
     * @param emailAndNameSelected Function to run with the email and name inputs from the dialog. Even if the
     * [isNameInputHidden] parameter is true, the input in the name field will be provided and it's up to the caller to
     * ignore the name parameter.
     */
<span class="nc" id="L29">    fun showSupportIdentityInputDialog(</span>
        context: Context,
        email: String?,
<span class="nc" id="L32">        name: String? = null,</span>
<span class="nc" id="L33">        isNameInputHidden: Boolean = false,</span>
        emailAndNameSelected: (String, String) -&gt; Unit
    ) {
<span class="nc" id="L36">        val (layout, emailEditText, nameEditText) =</span>
<span class="nc" id="L37">                supportIdentityInputDialogLayout(context, isNameInputHidden, email, name)</span>

<span class="nc" id="L39">        val dialog = MaterialAlertDialogBuilder(context)</span>
<span class="nc" id="L40">                .setView(layout)</span>
<span class="nc" id="L41">                .setPositiveButton(android.R.string.ok, null)</span>
<span class="nc" id="L42">                .setNegativeButton(android.R.string.cancel, null)</span>
<span class="nc" id="L43">                .create()</span>
<span class="nc" id="L44">        dialog.setOnShowListener {</span>
<span class="nc" id="L45">            val button = dialog.getButton(AlertDialog.BUTTON_POSITIVE)</span>
<span class="nc" id="L46">            button.setOnClickListener {</span>
<span class="nc" id="L47">                val newEmail = emailEditText.text.toString()</span>
<span class="nc" id="L48">                val newName = nameEditText.text.toString()</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">                if (validateEmail(newEmail)) {</span>
<span class="nc" id="L50">                    emailAndNameSelected(newEmail, newName)</span>
<span class="nc" id="L51">                    dialog.dismiss()</span>
                } else {
<span class="nc" id="L53">                    emailEditText.error = context.getString(R.string.invalid_email_message)</span>
                }
<span class="nc" id="L55">            }</span>
<span class="nc" id="L56">        }</span>
<span class="nc" id="L57">        dialog.show()</span>
<span class="nc" id="L58">    }</span>

    /**
     * This is a helper function to returns suggested email and name values to be used in the support identity dialog.
     *
     * @param account WordPress.com account
     * @param selectedSite Selected site of the user which will be used if the [account] is null
     *
     * @return a Pair with email and name suggestion
     */
    fun getSupportEmailAndNameSuggestion(
        account: AccountModel?,
        selectedSite: SiteModel?
    ): Pair&lt;String?, String?&gt; {
<span class="nc bnc" id="L72" title="All 2 branches missed.">        val accountEmail = account?.email</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        val accountDisplayName = account?.displayName</span>
<span class="nc bnc" id="L74" title="All 8 branches missed.">        val emailSuggestion = if (!accountEmail.isNullOrEmpty()) accountEmail else selectedSite?.email</span>
<span class="nc bnc" id="L75" title="All 8 branches missed.">        val nameSuggestion = if (!accountDisplayName.isNullOrEmpty()) accountDisplayName else selectedSite?.username</span>
<span class="nc" id="L76">        return Pair(emailSuggestion, nameSuggestion)</span>
    }
}

/**
 * This is a helper function that inflates the support identity dialog layout.
 *
 * @param context Context to use to inflate the layout
 * @param isNameInputHidden Whether the name EditText should be visible or not
 * @param emailSuggestion Initial value for the email EditText
 * @param nameSuggestion Initial value for the name EditText
 *
 * @return a Triple with layout View, email EditText and name EditText
 */
private fun supportIdentityInputDialogLayout(
    context: Context,
    isNameInputHidden: Boolean,
    emailSuggestion: String?,
    nameSuggestion: String?
): Triple&lt;View, EditText, EditText&gt; {
<span class="nc" id="L96">    val layout = LayoutInflater.from(context).inflate(R.layout.support_email_and_name_dialog, null)</span>

<span class="nc" id="L98">    val messageText = layout.findViewById&lt;TextView&gt;(R.id.support_identity_input_dialog_message)</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">    val message = if (isNameInputHidden) {</span>
<span class="nc" id="L100">        R.string.support_identity_input_dialog_enter_email</span>
    } else {
<span class="nc" id="L102">        R.string.support_identity_input_dialog_enter_email_and_name</span>
    }
<span class="nc" id="L104">    messageText.setText(message)</span>

<span class="nc" id="L106">    val emailEditText = layout.findViewById&lt;EditText&gt;(R.id.support_identity_input_dialog_email_edit_text)</span>
<span class="nc" id="L107">    emailEditText.setText(emailSuggestion)</span>
<span class="nc" id="L108">    emailEditText.selectAll()</span>

<span class="nc" id="L110">    val nameEditText = layout.findViewById&lt;EditText&gt;(R.id.support_identity_input_dialog_name_edit_text)</span>
<span class="nc" id="L111">    nameEditText.setText(nameSuggestion)</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">    nameEditText.visibility = if (isNameInputHidden) GONE else View.VISIBLE</span>

<span class="nc" id="L114">    return Triple(layout, emailEditText, nameEditText)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>