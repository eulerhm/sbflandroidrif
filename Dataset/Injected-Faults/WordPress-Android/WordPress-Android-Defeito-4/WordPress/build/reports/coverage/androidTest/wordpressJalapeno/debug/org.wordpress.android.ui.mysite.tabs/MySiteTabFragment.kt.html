<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MySiteTabFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.ui.mysite.tabs</a> &gt; <span class="el_source">MySiteTabFragment.kt</span></div><h1>MySiteTabFragment.kt</h1><pre class="source lang-java linenums">package org.wordpress.android.ui.mysite.tabs

import android.app.Activity
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.os.Parcelable
import android.view.View
import android.view.WindowManager
import androidx.annotation.StringRes
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView.AdapterDataObserver
import com.yalantis.ucrop.UCrop
import com.yalantis.ucrop.UCrop.Options
import com.yalantis.ucrop.UCropActivity
import org.wordpress.android.R
import org.wordpress.android.WordPress
import org.wordpress.android.analytics.AnalyticsTracker
import org.wordpress.android.databinding.MySiteTabFragmentBinding
import org.wordpress.android.fluxc.store.QuickStartStore.QuickStartTask
import org.wordpress.android.ui.ActivityLauncher
import org.wordpress.android.ui.FullScreenDialogFragment
import org.wordpress.android.ui.FullScreenDialogFragment.Builder
import org.wordpress.android.ui.FullScreenDialogFragment.OnConfirmListener
import org.wordpress.android.ui.FullScreenDialogFragment.OnDismissListener
import org.wordpress.android.ui.PagePostCreationSourcesDetail
import org.wordpress.android.ui.RequestCodes
import org.wordpress.android.ui.TextInputDialogFragment
import org.wordpress.android.ui.accounts.LoginEpilogueActivity
import org.wordpress.android.ui.domains.DomainRegistrationActivity.Companion.RESULT_REGISTERED_DOMAIN_EMAIL
import org.wordpress.android.ui.domains.DomainRegistrationActivity.DomainRegistrationPurpose.CTA_DOMAIN_CREDIT_REDEMPTION
import org.wordpress.android.ui.main.SitePickerActivity
import org.wordpress.android.ui.main.WPMainActivity
import org.wordpress.android.ui.mysite.MySiteAdapter
import org.wordpress.android.ui.mysite.MySiteCardAndItemDecoration
import org.wordpress.android.ui.mysite.MySiteViewModel
import org.wordpress.android.ui.mysite.MySiteViewModel.MySiteTrackWithTabSource
import org.wordpress.android.ui.mysite.MySiteViewModel.State
import org.wordpress.android.ui.mysite.SelectedSiteRepository
import org.wordpress.android.ui.mysite.SiteIconUploadHandler.ItemUploadedModel
import org.wordpress.android.ui.mysite.SiteNavigationAction
import org.wordpress.android.ui.mysite.cards.dashboard.bloggingprompts.BloggingPromptsCardAnalyticsTracker
import org.wordpress.android.ui.mysite.dynamiccards.DynamicCardMenuFragment
import org.wordpress.android.ui.mysite.dynamiccards.DynamicCardMenuViewModel
import org.wordpress.android.ui.pages.SnackbarMessageHolder
import org.wordpress.android.ui.photopicker.MediaPickerConstants
import org.wordpress.android.ui.photopicker.MediaPickerLauncher
import org.wordpress.android.ui.photopicker.PhotoPickerActivity.PhotoPickerMediaSource
import org.wordpress.android.ui.posts.BasicDialogViewModel
import org.wordpress.android.ui.posts.BasicDialogViewModel.BasicDialogModel
import org.wordpress.android.ui.posts.EditPostActivity.EXTRA_IS_LANDING_EDITOR_OPENED_FOR_NEW_SITE
import org.wordpress.android.ui.posts.PostListType
import org.wordpress.android.ui.posts.PostUtils.EntryPoint
import org.wordpress.android.ui.posts.QuickStartPromptDialogFragment
import org.wordpress.android.ui.posts.QuickStartPromptDialogFragment.QuickStartPromptClickInterface
import org.wordpress.android.ui.quickstart.QuickStartFullScreenDialogFragment
import org.wordpress.android.ui.quickstart.QuickStartTracker
import org.wordpress.android.ui.stats.StatsTimeframe
import org.wordpress.android.ui.uploads.UploadService
import org.wordpress.android.ui.uploads.UploadUtilsWrapper
import org.wordpress.android.ui.utils.UiHelpers
import org.wordpress.android.ui.utils.UiString.UiStringText
import org.wordpress.android.util.AppLog
import org.wordpress.android.util.AppLog.T.MAIN
import org.wordpress.android.util.AppLog.T.UTILS
import org.wordpress.android.util.HtmlCompatWrapper
import org.wordpress.android.util.NetworkUtils
import org.wordpress.android.util.QuickStartUtilsWrapper
import org.wordpress.android.util.SnackbarItem
import org.wordpress.android.util.SnackbarItem.Action
import org.wordpress.android.util.SnackbarItem.Info
import org.wordpress.android.util.SnackbarSequencer
import org.wordpress.android.util.UriWrapper
import org.wordpress.android.util.WPSwipeToRefreshHelper.buildSwipeToRefreshHelper
import org.wordpress.android.util.extensions.getColorFromAttribute
import org.wordpress.android.util.extensions.setVisible
import org.wordpress.android.util.helpers.SwipeToRefreshHelper
import org.wordpress.android.util.image.ImageManager
import org.wordpress.android.viewmodel.observeEvent
import java.io.File
import javax.inject.Inject

@Suppress(&quot;TooManyFunctions&quot;)
<span class="nc" id="L86">class MySiteTabFragment : Fragment(R.layout.my_site_tab_fragment),</span>
        TextInputDialogFragment.Callback,
        QuickStartPromptClickInterface,
        OnConfirmListener,
        OnDismissListener {
<span class="nc bnc" id="L91" title="All 2 branches missed.">    @Inject lateinit var viewModelFactory: ViewModelProvider.Factory</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">    @Inject lateinit var imageManager: ImageManager</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">    @Inject lateinit var uiHelpers: UiHelpers</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">    @Inject lateinit var bloggingPromptsCardAnalyticsTracker: BloggingPromptsCardAnalyticsTracker</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">    @Inject lateinit var snackbarSequencer: SnackbarSequencer</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">    @Inject lateinit var mediaPickerLauncher: MediaPickerLauncher</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">    @Inject lateinit var uploadUtilsWrapper: UploadUtilsWrapper</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">    @Inject lateinit var quickStartUtils: QuickStartUtilsWrapper</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">    @Inject lateinit var quickStartTracker: QuickStartTracker</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">    @Inject lateinit var htmlCompatWrapper: HtmlCompatWrapper</span>
    private lateinit var viewModel: MySiteViewModel
    private lateinit var dialogViewModel: BasicDialogViewModel
    private lateinit var dynamicCardMenuViewModel: DynamicCardMenuViewModel
    private lateinit var swipeToRefreshHelper: SwipeToRefreshHelper
    private lateinit var mySiteTabType: MySiteTabType

    private var binding: MySiteTabFragmentBinding? = null

    override fun onCreate(savedInstanceState: Bundle?) {
<span class="nc" id="L110">        super.onCreate(savedInstanceState)</span>
<span class="nc" id="L111">        initSoftKeyboard()</span>
<span class="nc" id="L112">        initDagger()</span>
<span class="nc" id="L113">        initViewModels()</span>
<span class="nc" id="L114">    }</span>

    private fun initSoftKeyboard() {
        // The following prevents the soft keyboard from leaving a white space when dismissed.
<span class="nc" id="L118">        requireActivity().window.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_PAN)</span>
<span class="nc" id="L119">    }</span>

    private fun initDagger() {
<span class="nc bnc" id="L122" title="All 2 branches missed.">        (requireActivity().application as WordPress).component().inject(this)</span>
<span class="nc" id="L123">    }</span>

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L126">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc" id="L127">        initTabType()</span>
<span class="nc" id="L128">        binding = MySiteTabFragmentBinding.bind(view).apply {</span>
<span class="nc" id="L129">            setupContentViews(savedInstanceState)</span>
<span class="nc" id="L130">            setupObservers()</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">            swipeToRefreshHelper.isRefreshing = true</span>
<span class="nc" id="L132">        }</span>
<span class="nc" id="L133">    }</span>

    private fun initViewModels() {
<span class="nc" id="L136">        viewModel = ViewModelProvider(requireParentFragment(), viewModelFactory).get(MySiteViewModel::class.java)</span>
<span class="nc" id="L137">        dialogViewModel = ViewModelProvider(requireActivity(), viewModelFactory)</span>
<span class="nc" id="L138">                .get(BasicDialogViewModel::class.java)</span>
<span class="nc" id="L139">        dynamicCardMenuViewModel = ViewModelProvider(requireActivity(), viewModelFactory)</span>
<span class="nc" id="L140">                .get(DynamicCardMenuViewModel::class.java)</span>
<span class="nc" id="L141">    }</span>

    private fun initTabType() {
<span class="nc bnc" id="L144" title="All 4 branches missed.">        mySiteTabType = if (viewModel.isMySiteTabsEnabled) {</span>
<span class="nc" id="L145">            MySiteTabType.fromString(</span>
<span class="nc bnc" id="L146" title="All 4 branches missed.">                    this.arguments?.getString(KEY_MY_SITE_TAB_TYPE, MySiteTabType.SITE_MENU.label)</span>
<span class="nc" id="L147">                            ?: MySiteTabType.SITE_MENU.label</span>
            )
        } else {
<span class="nc" id="L150">            MySiteTabType.ALL</span>
        }
<span class="nc" id="L152">    }</span>

    private fun MySiteTabFragmentBinding.setupContentViews(savedInstanceState: Bundle?) {
<span class="nc" id="L155">        val layoutManager = LinearLayoutManager(activity)</span>

<span class="nc bnc" id="L157" title="All 4 branches missed.">        savedInstanceState?.getParcelable&lt;Parcelable&gt;(KEY_LIST_STATE)?.let {</span>
<span class="nc" id="L158">            layoutManager.onRestoreInstanceState(it)</span>
<span class="nc" id="L159">        }</span>

<span class="nc" id="L161">        recyclerView.layoutManager = layoutManager</span>
<span class="nc" id="L162">        recyclerView.addItemDecoration(</span>
<span class="nc" id="L163">                MySiteCardAndItemDecoration(</span>
<span class="nc" id="L164">                        horizontalMargin = resources.getDimensionPixelSize(R.dimen.margin_extra_large),</span>
<span class="nc" id="L165">                        verticalMargin = resources.getDimensionPixelSize(R.dimen.margin_medium)</span>
                )
        )

<span class="nc" id="L169">        val adapter = MySiteAdapter(</span>
<span class="nc" id="L170">                imageManager,</span>
<span class="nc" id="L171">                uiHelpers,</span>
<span class="nc" id="L172">                bloggingPromptsCardAnalyticsTracker,</span>
<span class="nc" id="L173">                htmlCompatWrapper</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        ) { viewModel.onBloggingPromptsLearnMoreClicked() }</span>

<span class="nc" id="L176">        adapter.registerAdapterDataObserver(object : AdapterDataObserver() {</span>
            override fun onItemRangeInserted(positionStart: Int, itemCount: Int) {
<span class="nc" id="L178">                super.onItemRangeInserted(positionStart, itemCount)</span>
<span class="nc" id="L179">                recyclerView.smoothScrollToPosition(0)</span>
<span class="nc" id="L180">            }</span>
        })

<span class="nc bnc" id="L183" title="All 4 branches missed.">        savedInstanceState?.getBundle(KEY_NESTED_LISTS_STATES)?.let {</span>
<span class="nc" id="L184">            adapter.onRestoreInstanceState(it)</span>
<span class="nc" id="L185">        }</span>

<span class="nc" id="L187">        recyclerView.adapter = adapter</span>

<span class="nc" id="L189">        swipeToRefreshHelper = buildSwipeToRefreshHelper(swipeRefreshLayout) {</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (NetworkUtils.checkConnection(requireActivity())) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                viewModel.refresh(isPullToRefresh = true)</span>
            } else {
<span class="nc bnc" id="L193" title="All 2 branches missed.">                swipeToRefreshHelper.isRefreshing = false</span>
            }
<span class="nc" id="L195">        }</span>
<span class="nc" id="L196">    }</span>

    @Suppress(&quot;LongMethod&quot;)
    private fun MySiteTabFragmentBinding.setupObservers() {
<span class="nc bnc" id="L200" title="All 2 branches missed.">        viewModel.uiModel.observe(viewLifecycleOwner, { uiModel -&gt;</span>
<span class="nc" id="L201">            hideRefreshIndicatorIfNeeded()</span>
<span class="nc" id="L202">            when (val state = uiModel.state) {</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                is State.SiteSelected -&gt; loadData(state)</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">                is State.NoSites -&gt; loadEmptyView()</span>
            }
<span class="nc" id="L206">        })</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        viewModel.onBasicDialogShown.observeEvent(viewLifecycleOwner, { model -&gt;</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">            dialogViewModel.showDialog(requireActivity().supportFragmentManager,</span>
<span class="nc" id="L209">                    BasicDialogModel(</span>
<span class="nc" id="L210">                            model.tag,</span>
<span class="nc" id="L211">                            getString(model.title),</span>
<span class="nc" id="L212">                            getString(model.message),</span>
<span class="nc" id="L213">                            getString(model.positiveButtonLabel),</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                            model.negativeButtonLabel?.let { label -&gt; getString(label) },</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                            model.cancelButtonLabel?.let { label -&gt; getString(label) }</span>
                    ))
<span class="nc" id="L217">        })</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        viewModel.onTextInputDialogShown.observeEvent(viewLifecycleOwner, { model -&gt;</span>
<span class="nc" id="L219">            val inputDialog = TextInputDialogFragment.newInstance(</span>
<span class="nc" id="L220">                    getString(model.title),</span>
<span class="nc" id="L221">                    model.initialText,</span>
<span class="nc" id="L222">                    getString(model.hint),</span>
<span class="nc" id="L223">                    model.isMultiline,</span>
<span class="nc" id="L224">                    model.isInputEnabled,</span>
<span class="nc" id="L225">                    model.callbackId</span>
            )
<span class="nc" id="L227">            inputDialog.setTargetFragment(this@MySiteTabFragment, 0)</span>
<span class="nc" id="L228">            inputDialog.show(parentFragmentManager, TextInputDialogFragment.TAG)</span>
<span class="nc" id="L229">        })</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">        viewModel.onDynamicCardMenuShown.observeEvent(viewLifecycleOwner, { dynamicCardMenuModel -&gt;</span>
<span class="nc bnc" id="L231" title="All 4 branches missed.">            ((parentFragmentManager.findFragmentByTag(dynamicCardMenuModel.id) as? DynamicCardMenuFragment)</span>
<span class="nc" id="L232">                    ?: DynamicCardMenuFragment.newInstance(</span>
<span class="nc" id="L233">                            dynamicCardMenuModel.cardType,</span>
<span class="nc" id="L234">                            dynamicCardMenuModel.isPinned</span>
                    ))
<span class="nc" id="L236">                    .show(parentFragmentManager, dynamicCardMenuModel.id)</span>
<span class="nc" id="L237">        })</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        viewModel.onNavigation.observeEvent(viewLifecycleOwner, { handleNavigationAction(it) })</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">        viewModel.onSnackbarMessage.observeEvent(viewLifecycleOwner, { showSnackbar(it) })</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        viewModel.onQuickStartMySitePrompts.observeEvent(viewLifecycleOwner, { activeTutorialPrompt -&gt;</span>
<span class="nc" id="L241">            val message = quickStartUtils.stylizeQuickStartPrompt(</span>
<span class="nc" id="L242">                    requireContext(),</span>
<span class="nc" id="L243">                    activeTutorialPrompt.shortMessagePrompt,</span>
<span class="nc" id="L244">                    activeTutorialPrompt.iconId</span>
            )
<span class="nc" id="L246">            showSnackbar(SnackbarMessageHolder(UiStringText(message)))</span>
<span class="nc" id="L247">        })</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">        viewModel.onMediaUpload.observeEvent(viewLifecycleOwner, { UploadService.uploadMedia(requireActivity(), it) })</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">        dialogViewModel.onInteraction.observeEvent(viewLifecycleOwner, { viewModel.onDialogInteraction(it) })</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">        dynamicCardMenuViewModel.onInteraction.observeEvent(viewLifecycleOwner, { interaction -&gt;</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">            viewModel.onQuickStartMenuInteraction(interaction)</span>
<span class="nc" id="L252">        })</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">        viewModel.onUploadedItem.observeEvent(viewLifecycleOwner, { handleUploadedItem(it) })</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">        viewModel.onShare.observeEvent(viewLifecycleOwner) { shareMessage(it) }</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">        viewModel.onAnswerBloggingPrompt.observeEvent(viewLifecycleOwner) {</span>
<span class="nc" id="L256">            val site = it.first</span>
<span class="nc" id="L257">            val bloggingPromptId = it.second</span>
<span class="nc" id="L258">            ActivityLauncher.addNewPostForResult(</span>
<span class="nc" id="L259">                    activity,</span>
<span class="nc" id="L260">                    site,</span>
<span class="nc" id="L261">                    false,</span>
<span class="nc" id="L262">                    PagePostCreationSourcesDetail.POST_FROM_MY_SITE,</span>
<span class="nc" id="L263">                    bloggingPromptId,</span>
<span class="nc" id="L264">                    EntryPoint.MY_SITE_CARD_ANSWER_PROMPT</span>
            )
<span class="nc" id="L266">        }</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        viewModel.onBloggingPromptsLearnMore.observeEvent(viewLifecycleOwner) {</span>
<span class="nc bnc" id="L268" title="All 4 branches missed.">            (activity as? BloggingPromptsOnboardingListener)?.onShowBloggingPromptsOnboarding()</span>
<span class="nc" id="L269">        }</span>
<span class="nc" id="L270">    }</span>

    @Suppress(&quot;ComplexMethod&quot;, &quot;LongMethod&quot;)
<span class="nc" id="L273">    fun handleNavigationAction(action: SiteNavigationAction) = when (action) {</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">        is SiteNavigationAction.OpenMeScreen -&gt; ActivityLauncher.viewMeActivityForResult(activity)</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">        is SiteNavigationAction.OpenSitePicker -&gt; ActivityLauncher.showSitePickerForResult(activity, action.site)</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">        is SiteNavigationAction.OpenSite -&gt; ActivityLauncher.viewCurrentSite(activity, action.site, true)</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        is SiteNavigationAction.OpenMediaPicker -&gt;</span>
<span class="nc" id="L278">            mediaPickerLauncher.showSiteIconPicker(this@MySiteTabFragment, action.site)</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        is SiteNavigationAction.OpenCropActivity -&gt; startCropActivity(action.imageUri)</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">        is SiteNavigationAction.OpenActivityLog -&gt; ActivityLauncher.viewActivityLogList(activity, action.site)</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">        is SiteNavigationAction.OpenBackup -&gt; ActivityLauncher.viewBackupList(activity, action.site)</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">        is SiteNavigationAction.OpenScan -&gt; ActivityLauncher.viewScan(activity, action.site)</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        is SiteNavigationAction.OpenPlan -&gt; ActivityLauncher.viewBlogPlans(activity, action.site)</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">        is SiteNavigationAction.OpenPosts -&gt; ActivityLauncher.viewCurrentBlogPosts(requireActivity(), action.site)</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">        is SiteNavigationAction.OpenPages -&gt; ActivityLauncher.viewCurrentBlogPages(requireActivity(), action.site)</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        is SiteNavigationAction.OpenHomepage -&gt; ActivityLauncher.editLandingPageForResult(</span>
<span class="nc" id="L287">                this,</span>
<span class="nc" id="L288">                action.site,</span>
<span class="nc" id="L289">                action.homepageLocalId,</span>
<span class="nc" id="L290">                action.isNewSite</span>
        )
<span class="nc bnc" id="L292" title="All 2 branches missed.">        is SiteNavigationAction.OpenAdmin -&gt; ActivityLauncher.viewBlogAdmin(activity, action.site)</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">        is SiteNavigationAction.OpenPeople -&gt; ActivityLauncher.viewCurrentBlogPeople(activity, action.site)</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        is SiteNavigationAction.OpenSharing -&gt; ActivityLauncher.viewBlogSharing(activity, action.site)</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">        is SiteNavigationAction.OpenSiteSettings -&gt; ActivityLauncher.viewBlogSettingsForResult(activity, action.site)</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">        is SiteNavigationAction.OpenThemes -&gt; ActivityLauncher.viewCurrentBlogThemes(activity, action.site)</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">        is SiteNavigationAction.OpenPlugins -&gt; ActivityLauncher.viewPluginBrowser(activity, action.site)</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        is SiteNavigationAction.OpenMedia -&gt; ActivityLauncher.viewCurrentBlogMedia(activity, action.site)</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">        is SiteNavigationAction.OpenUnifiedComments -&gt; ActivityLauncher.viewUnifiedComments(activity, action.site)</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">        is SiteNavigationAction.OpenStats -&gt; ActivityLauncher.viewBlogStats(activity, action.site)</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">        is SiteNavigationAction.ConnectJetpackForStats -&gt;</span>
<span class="nc" id="L302">            ActivityLauncher.viewConnectJetpackForStats(activity, action.site)</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">        is SiteNavigationAction.StartWPComLoginForJetpackStats -&gt;</span>
<span class="nc" id="L304">            ActivityLauncher.loginForJetpackStats(this@MySiteTabFragment)</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">        is SiteNavigationAction.OpenJetpackSettings -&gt;</span>
<span class="nc" id="L306">            ActivityLauncher.viewJetpackSecuritySettings(activity, action.site)</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">        is SiteNavigationAction.OpenStories -&gt; ActivityLauncher.viewStories(activity, action.site, action.event)</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">        is SiteNavigationAction.AddNewStory -&gt;</span>
<span class="nc" id="L309">            ActivityLauncher.addNewStoryForResult(activity, action.site, action.source)</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">        is SiteNavigationAction.AddNewStoryWithMediaIds -&gt; ActivityLauncher.addNewStoryWithMediaIdsForResult(</span>
<span class="nc" id="L311">                activity,</span>
<span class="nc" id="L312">                action.site,</span>
<span class="nc" id="L313">                action.source,</span>
<span class="nc" id="L314">                action.mediaIds.toLongArray()</span>
        )
<span class="nc bnc" id="L316" title="All 2 branches missed.">        is SiteNavigationAction.AddNewStoryWithMediaUris -&gt; ActivityLauncher.addNewStoryWithMediaUrisForResult(</span>
<span class="nc" id="L317">                activity,</span>
<span class="nc" id="L318">                action.site,</span>
<span class="nc" id="L319">                action.source,</span>
<span class="nc" id="L320">                action.mediaUris.toTypedArray()</span>
        )
<span class="nc bnc" id="L322" title="All 2 branches missed.">        is SiteNavigationAction.OpenDomains -&gt; ActivityLauncher.viewDomainsDashboardActivity(</span>
<span class="nc" id="L323">                activity,</span>
<span class="nc" id="L324">                action.site</span>
        )
<span class="nc bnc" id="L326" title="All 2 branches missed.">        is SiteNavigationAction.OpenDomainRegistration -&gt; ActivityLauncher.viewDomainRegistrationActivityForResult(</span>
<span class="nc" id="L327">                activity,</span>
<span class="nc" id="L328">                action.site,</span>
<span class="nc" id="L329">                CTA_DOMAIN_CREDIT_REDEMPTION</span>
        )
<span class="nc bnc" id="L331" title="All 2 branches missed.">        is SiteNavigationAction.AddNewSite -&gt; SitePickerActivity.addSite(activity, action.hasAccessToken, action.source)</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">        is SiteNavigationAction.ShowQuickStartDialog -&gt; showQuickStartDialog(</span>
<span class="nc" id="L333">                action.title,</span>
<span class="nc" id="L334">                action.message,</span>
<span class="nc" id="L335">                action.positiveButtonLabel,</span>
<span class="nc" id="L336">                action.negativeButtonLabel</span>
        )
<span class="nc bnc" id="L338" title="All 2 branches missed.">        is SiteNavigationAction.OpenQuickStartFullScreenDialog -&gt; openQuickStartFullScreenDialog(action)</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">        is SiteNavigationAction.OpenDraftsPosts -&gt;</span>
<span class="nc" id="L340">            ActivityLauncher.viewCurrentBlogPostsOfType(requireActivity(), action.site, PostListType.DRAFTS)</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">        is SiteNavigationAction.OpenScheduledPosts -&gt;</span>
<span class="nc" id="L342">            ActivityLauncher.viewCurrentBlogPostsOfType(requireActivity(), action.site, PostListType.SCHEDULED)</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">        is SiteNavigationAction.OpenEditorToCreateNewPost -&gt;</span>
<span class="nc" id="L344">            ActivityLauncher.addNewPostForResult(</span>
<span class="nc" id="L345">                requireActivity(),</span>
<span class="nc" id="L346">                action.site,</span>
<span class="nc" id="L347">                false,</span>
<span class="nc" id="L348">                PagePostCreationSourcesDetail.POST_FROM_MY_SITE,</span>
<span class="nc" id="L349">                -1,</span>
<span class="nc" id="L350">                null</span>
            )
        // The below navigation is temporary and as such not utilizing the 'action.postId' in order to navigate to the
        // 'Edit Post' screen. Instead, it fallbacks to navigating to the 'Posts' screen and targeting a specific tab.
<span class="nc bnc" id="L354" title="All 2 branches missed.">        is SiteNavigationAction.EditDraftPost -&gt;</span>
<span class="nc" id="L355">            ActivityLauncher.viewCurrentBlogPostsOfType(requireActivity(), action.site, PostListType.DRAFTS)</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">        is SiteNavigationAction.EditScheduledPost -&gt;</span>
<span class="nc" id="L357">            ActivityLauncher.viewCurrentBlogPostsOfType(requireActivity(), action.site, PostListType.SCHEDULED)</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">        is SiteNavigationAction.OpenStatsInsights -&gt;</span>
<span class="nc" id="L359">            ActivityLauncher.viewBlogStatsForTimeframe(requireActivity(), action.site, StatsTimeframe.INSIGHTS)</span>
<span class="nc" id="L360">        is SiteNavigationAction.OpenTodaysStatsGetMoreViewsExternalUrl -&gt;</span>
<span class="nc" id="L361">            ActivityLauncher.openUrlExternal(requireActivity(), action.url)</span>
<span class="nc" id="L362">    }</span>

    private fun openQuickStartFullScreenDialog(action: SiteNavigationAction.OpenQuickStartFullScreenDialog) {
<span class="nc" id="L365">        val bundle = QuickStartFullScreenDialogFragment.newBundle(action.type)</span>
<span class="nc" id="L366">        Builder(requireContext())</span>
<span class="nc" id="L367">                .setOnConfirmListener(this)</span>
<span class="nc" id="L368">                .setOnDismissListener(this)</span>
<span class="nc" id="L369">                .setContent(QuickStartFullScreenDialogFragment::class.java, bundle)</span>
<span class="nc" id="L370">                .build()</span>
<span class="nc" id="L371">                .show(requireActivity().supportFragmentManager, FullScreenDialogFragment.TAG)</span>
<span class="nc" id="L372">    }</span>

<span class="nc" id="L374">    private fun handleUploadedItem(itemUploadedModel: ItemUploadedModel) = when (itemUploadedModel) {</span>
<span class="nc bnc" id="L375" title="All 2 branches missed.">        is ItemUploadedModel.PostUploaded -&gt; {</span>
<span class="nc" id="L376">            uploadUtilsWrapper.onPostUploadedSnackbarHandler(</span>
<span class="nc" id="L377">                    activity,</span>
<span class="nc" id="L378">                    requireActivity().findViewById(R.id.coordinator),</span>
<span class="nc" id="L379">                    isError = true,</span>
<span class="nc" id="L380">                    isFirstTimePublish = false,</span>
<span class="nc" id="L381">                    post = itemUploadedModel.post,</span>
<span class="nc" id="L382">                    errorMessage = itemUploadedModel.errorMessage,</span>
<span class="nc" id="L383">                    site = itemUploadedModel.site</span>
            )
        }
<span class="nc" id="L386">        is ItemUploadedModel.MediaUploaded -&gt; {</span>
<span class="nc" id="L387">            uploadUtilsWrapper.onMediaUploadedSnackbarHandler(</span>
<span class="nc" id="L388">                    activity,</span>
<span class="nc" id="L389">                    requireActivity().findViewById(R.id.coordinator),</span>
<span class="nc" id="L390">                    isError = true,</span>
<span class="nc" id="L391">                    mediaList = itemUploadedModel.media,</span>
<span class="nc" id="L392">                    site = itemUploadedModel.site,</span>
<span class="nc" id="L393">                    messageForUser = itemUploadedModel.errorMessage</span>
            )
        }
<span class="nc" id="L396">    }</span>

    private fun startCropActivity(imageUri: UriWrapper) {
<span class="nc bnc" id="L399" title="All 2 branches missed.">        val context = activity ?: return</span>
<span class="nc" id="L400">        val options = Options()</span>
<span class="nc" id="L401">        options.setShowCropGrid(false)</span>
<span class="nc" id="L402">        options.setStatusBarColor(context.getColorFromAttribute(android.R.attr.statusBarColor))</span>
<span class="nc" id="L403">        options.setToolbarColor(context.getColorFromAttribute(R.attr.wpColorAppBar))</span>
<span class="nc" id="L404">        options.setToolbarWidgetColor(context.getColorFromAttribute(R.attr.colorOnSurface))</span>
<span class="nc" id="L405">        options.setAllowedGestures(UCropActivity.SCALE, UCropActivity.NONE, UCropActivity.NONE)</span>
<span class="nc" id="L406">        options.setHideBottomControls(true)</span>
<span class="nc" id="L407">        UCrop.of(imageUri.uri, Uri.fromFile(File(context.cacheDir, &quot;cropped_for_site_icon.jpg&quot;)))</span>
<span class="nc" id="L408">                .withAspectRatio(1f, 1f)</span>
<span class="nc" id="L409">                .withOptions(options)</span>
<span class="nc" id="L410">                .start(requireActivity(), this)</span>
<span class="nc" id="L411">    }</span>

    override fun onResume() {
<span class="nc" id="L414">        super.onResume()</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">        viewModel.onResume()</span>
<span class="nc" id="L416">    }</span>

    override fun onPause() {
<span class="nc" id="L419">        super.onPause()</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">        activity?.let {</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">            if (!it.isChangingConfigurations) {</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">                viewModel.dismissQuickStartNotice()</span>
            }
<span class="nc" id="L424">        }</span>
<span class="nc" id="L425">    }</span>

    override fun onSaveInstanceState(outState: Bundle) {
<span class="nc" id="L428">        super.onSaveInstanceState(outState)</span>
<span class="nc bnc" id="L429" title="All 6 branches missed.">        binding?.recyclerView?.layoutManager?.let {</span>
<span class="nc" id="L430">            outState.putParcelable(KEY_LIST_STATE, it.onSaveInstanceState())</span>
<span class="nc" id="L431">        }</span>
<span class="nc bnc" id="L432" title="All 8 branches missed.">        (binding?.recyclerView?.adapter as? MySiteAdapter)?.let {</span>
<span class="nc" id="L433">            outState.putBundle(KEY_NESTED_LISTS_STATES, it.onSaveInstanceState())</span>
<span class="nc" id="L434">        }</span>
<span class="nc" id="L435">    }</span>

    override fun onDestroyView() {
<span class="nc" id="L438">        super.onDestroyView()</span>
<span class="nc" id="L439">        binding = null</span>
<span class="nc" id="L440">    }</span>

    @Suppress(&quot;ReturnCount&quot;, &quot;LongMethod&quot;, &quot;ComplexMethod&quot;)
    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
<span class="nc" id="L444">        super.onActivityResult(requestCode, resultCode, data)</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L446">            return</span>
        }
<span class="nc bnc" id="L448" title="All 9 branches missed.">        when (requestCode) {</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">            RequestCodes.DO_LOGIN -&gt; if (resultCode == Activity.RESULT_OK) {</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                viewModel.handleSuccessfulLoginResult()</span>
            }
            RequestCodes.SITE_ICON_PICKER -&gt; {
<span class="nc bnc" id="L453" title="All 2 branches missed.">                if (resultCode != Activity.RESULT_OK) {</span>
<span class="nc" id="L454">                    return</span>
                }
<span class="nc" id="L456">                when {</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                    data.hasExtra(MediaPickerConstants.EXTRA_MEDIA_ID) -&gt; {</span>
<span class="nc" id="L458">                        val mediaId = data.getLongExtra(MediaPickerConstants.EXTRA_MEDIA_ID, 0)</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">                        viewModel.handleSelectedSiteIcon(mediaId)</span>
                    }
<span class="nc bnc" id="L461" title="All 2 branches missed.">                    data.hasExtra(MediaPickerConstants.EXTRA_MEDIA_URIS) -&gt; {</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">                        val mediaUriStringsArray = data.getStringArrayExtra(</span>
<span class="nc" id="L463">                                MediaPickerConstants.EXTRA_MEDIA_URIS</span>
<span class="nc" id="L464">                        ) ?: return</span>

<span class="nc" id="L466">                        val source = PhotoPickerMediaSource.fromString(</span>
<span class="nc" id="L467">                                data.getStringExtra(MediaPickerConstants.EXTRA_MEDIA_SOURCE)</span>
                        )
<span class="nc bnc" id="L469" title="All 2 branches missed.">                        val iconUrl = mediaUriStringsArray.getOrNull(0) ?: return</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">                        viewModel.handleTakenSiteIcon(iconUrl, source)</span>
                    }
                    else -&gt; {
<span class="nc" id="L473">                        AppLog.e(</span>
<span class="nc" id="L474">                                UTILS,</span>
<span class="nc" id="L475">                                &quot;Can't resolve picked or captured image&quot;</span>
                        )
                    }
                }
            }
            RequestCodes.STORIES_PHOTO_PICKER,
<span class="nc bnc" id="L481" title="All 2 branches missed.">            RequestCodes.PHOTO_PICKER -&gt; if (resultCode == Activity.RESULT_OK) {</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">                viewModel.handleStoriesPhotoPickerResult(data)</span>
            }
            UCrop.REQUEST_CROP -&gt; {
<span class="nc bnc" id="L485" title="All 2 branches missed.">                if (resultCode == UCrop.RESULT_ERROR) {</span>
<span class="nc" id="L486">                    AppLog.e(</span>
<span class="nc" id="L487">                            MAIN,</span>
<span class="nc" id="L488">                            &quot;Image cropping failed!&quot;,</span>
<span class="nc" id="L489">                            UCrop.getError(data)</span>
                    )
                }
<span class="nc bnc" id="L492" title="All 4 branches missed.">                viewModel.handleCropResult(UCrop.getOutput(data), resultCode == Activity.RESULT_OK)</span>
            }
<span class="nc bnc" id="L494" title="All 2 branches missed.">            RequestCodes.DOMAIN_REGISTRATION -&gt; if (resultCode == Activity.RESULT_OK) {</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">                viewModel.handleSuccessfulDomainRegistrationResult(data.getStringExtra(RESULT_REGISTERED_DOMAIN_EMAIL))</span>
            }
            RequestCodes.LOGIN_EPILOGUE,
            RequestCodes.CREATE_SITE -&gt; {
<span class="nc bnc" id="L499" title="All 2 branches missed.">                val isNewSite = requestCode == RequestCodes.CREATE_SITE ||</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">                        data.getBooleanExtra(LoginEpilogueActivity.KEY_SITE_CREATED_FROM_LOGIN_EPILOGUE, false)</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">                viewModel.onCreateSiteResult()</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">                viewModel.performFirstStepAfterSiteCreation(</span>
<span class="nc" id="L503">                        data.getIntExtra(SitePickerActivity.KEY_SITE_LOCAL_ID, SelectedSiteRepository.UNAVAILABLE),</span>
<span class="nc" id="L504">                        data.getBooleanExtra(SitePickerActivity.KEY_SITE_TITLE_TASK_COMPLETED, false),</span>
<span class="nc" id="L505">                        isNewSite = isNewSite</span>
                )
            }
            RequestCodes.SITE_PICKER -&gt; {
<span class="nc bnc" id="L509" title="All 2 branches missed.">                if (data.getIntExtra(WPMainActivity.ARG_CREATE_SITE, 0) == RequestCodes.CREATE_SITE) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                    viewModel.onCreateSiteResult()</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">                    viewModel.performFirstStepAfterSiteCreation(</span>
<span class="nc" id="L512">                            data.getIntExtra(SitePickerActivity.KEY_SITE_LOCAL_ID, SelectedSiteRepository.UNAVAILABLE),</span>
<span class="nc" id="L513">                            data.getBooleanExtra(SitePickerActivity.KEY_SITE_TITLE_TASK_COMPLETED, false),</span>
<span class="nc" id="L514">                            isNewSite = true</span>
                    )
                } else {
<span class="nc bnc" id="L517" title="All 2 branches missed.">                    viewModel.onSitePicked()</span>
                }
            }
            RequestCodes.EDIT_LANDING_PAGE -&gt; {
<span class="nc bnc" id="L521" title="All 2 branches missed.">                viewModel.checkAndStartQuickStart(</span>
<span class="nc" id="L522">                        data.getIntExtra(SitePickerActivity.KEY_SITE_LOCAL_ID, SelectedSiteRepository.UNAVAILABLE),</span>
<span class="nc" id="L523">                        data.getBooleanExtra(SitePickerActivity.KEY_SITE_TITLE_TASK_COMPLETED, false),</span>
<span class="nc" id="L524">                        isNewSite = data.getBooleanExtra(EXTRA_IS_LANDING_EDITOR_OPENED_FOR_NEW_SITE, false)</span>
                )
            }
        }
<span class="nc" id="L528">    }</span>

    private fun showQuickStartDialog(
        @StringRes title: Int,
        @StringRes message: Int,
        @StringRes positiveButtonLabel: Int,
        @StringRes negativeButtonLabel: Int
    ) {
<span class="nc" id="L536">        val tag = TAG_QUICK_START_DIALOG</span>
<span class="nc" id="L537">        val quickStartPromptDialogFragment = QuickStartPromptDialogFragment()</span>
<span class="nc" id="L538">        quickStartPromptDialogFragment.initialize(</span>
<span class="nc" id="L539">                tag,</span>
<span class="nc" id="L540">                getString(title),</span>
<span class="nc" id="L541">                getString(message),</span>
<span class="nc" id="L542">                getString(positiveButtonLabel),</span>
<span class="nc" id="L543">                R.drawable.img_illustration_site_about_280dp,</span>
<span class="nc" id="L544">                getString(negativeButtonLabel)</span>
        )
<span class="nc" id="L546">        quickStartPromptDialogFragment.show(parentFragmentManager, tag)</span>
<span class="nc" id="L547">        quickStartTracker.track(AnalyticsTracker.Stat.QUICK_START_REQUEST_VIEWED)</span>
<span class="nc" id="L548">    }</span>

    private fun MySiteTabFragmentBinding.loadData(state: State.SiteSelected) {
<span class="nc" id="L551">        recyclerView.setVisible(true)</span>
<span class="nc bnc" id="L552" title="All 5 branches missed.">        val cardAndItems = when (mySiteTabType) {</span>
<span class="nc" id="L553">            MySiteTabType.SITE_MENU -&gt; state.siteMenuCardsAndItems</span>
<span class="nc" id="L554">            MySiteTabType.DASHBOARD -&gt; state.dashboardCardsAndItems</span>
<span class="nc" id="L555">            else -&gt; state.cardAndItems</span>
        }
<span class="nc bnc" id="L557" title="All 4 branches missed.">        (recyclerView.adapter as? MySiteAdapter)?.submitList(cardAndItems)</span>
<span class="nc" id="L558">    }</span>

    private fun MySiteTabFragmentBinding.loadEmptyView() {
<span class="nc" id="L561">        recyclerView.setVisible(false)</span>
<span class="nc" id="L562">    }</span>

    private fun showSnackbar(holder: SnackbarMessageHolder) {
<span class="nc bnc" id="L565" title="All 2 branches missed.">        activity?.let { parent -&gt;</span>
<span class="nc" id="L566">            snackbarSequencer.enqueue(</span>
<span class="nc" id="L567">                    SnackbarItem(</span>
<span class="nc" id="L568">                            info = Info(</span>
<span class="nc" id="L569">                                    view = parent.findViewById(R.id.coordinator),</span>
<span class="nc" id="L570">                                    textRes = holder.message,</span>
<span class="nc" id="L571">                                    duration = holder.duration,</span>
<span class="nc" id="L572">                                    isImportant = holder.isImportant</span>
                            ),
<span class="nc bnc" id="L574" title="All 2 branches missed.">                            action = holder.buttonTitle?.let {</span>
<span class="nc" id="L575">                                Action(</span>
<span class="nc" id="L576">                                        textRes = holder.buttonTitle,</span>
<span class="nc" id="L577">                                        clickListener = { holder.buttonAction() }</span>
                                )
                            },
<span class="nc" id="L580">                            dismissCallback = { _, event -&gt; holder.onDismissAction(event) }</span>
                    )
            )
<span class="nc" id="L583">        }</span>
<span class="nc" id="L584">    }</span>

    private fun MySiteTabFragmentBinding.hideRefreshIndicatorIfNeeded() {
<span class="nc" id="L587">        swipeRefreshLayout.postDelayed({</span>
<span class="nc bnc" id="L588" title="All 4 branches missed.">            swipeToRefreshHelper.isRefreshing = viewModel.isRefreshing()</span>
<span class="nc" id="L589">        }, CHECK_REFRESH_DELAY)</span>
<span class="nc" id="L590">    }</span>

    private fun shareMessage(message: String) {
<span class="nc" id="L593">        val shareIntent = Intent(Intent.ACTION_SEND)</span>
<span class="nc" id="L594">        shareIntent.type = &quot;text/plain&quot;</span>
<span class="nc" id="L595">        shareIntent.putExtra(Intent.EXTRA_TEXT, message)</span>

<span class="nc" id="L597">        startActivity(</span>
<span class="nc" id="L598">                Intent.createChooser(</span>
<span class="nc" id="L599">                        shareIntent,</span>
<span class="nc" id="L600">                        resources.getString(R.string.my_site_blogging_prompt_card_share_chooser_title)</span>
                )
        )
<span class="nc" id="L603">    }</span>

    companion object {
        private const val KEY_LIST_STATE = &quot;key_list_state&quot;
        private const val KEY_NESTED_LISTS_STATES = &quot;key_nested_lists_states&quot;
        private const val TAG_QUICK_START_DIALOG = &quot;TAG_QUICK_START_DIALOG&quot;
        private const val KEY_MY_SITE_TAB_TYPE = &quot;key_my_site_tab_type&quot;
        private const val CHECK_REFRESH_DELAY = 300L

        @JvmStatic
<span class="nc" id="L613">        fun newInstance(mySiteTabType: MySiteTabType) = MySiteTabFragment().apply {</span>
<span class="nc" id="L614">            arguments = Bundle().apply {</span>
<span class="nc" id="L615">                putString(KEY_MY_SITE_TAB_TYPE, mySiteTabType.label)</span>
<span class="nc" id="L616">            }</span>
<span class="nc" id="L617">        }</span>
    }

    override fun onSuccessfulInput(input: String, callbackId: Int) {
<span class="nc bnc" id="L621" title="All 2 branches missed.">        viewModel.onSiteNameChosen(input)</span>
<span class="nc" id="L622">    }</span>

    override fun onTextInputDialogDismissed(callbackId: Int) {
<span class="nc bnc" id="L625" title="All 2 branches missed.">        viewModel.onSiteNameChooserDismissed()</span>
<span class="nc" id="L626">    }</span>

    override fun onPositiveClicked(instanceTag: String) {
<span class="nc bnc" id="L629" title="All 2 branches missed.">        viewModel.startQuickStart()</span>
<span class="nc" id="L630">    }</span>

    override fun onNegativeClicked(instanceTag: String) {
<span class="nc bnc" id="L633" title="All 2 branches missed.">        viewModel.ignoreQuickStart()</span>
<span class="nc" id="L634">    }</span>

    override fun onConfirm(result: Bundle?) {
<span class="nc bnc" id="L637" title="All 4 branches missed.">        val task = result?.getSerializable(QuickStartFullScreenDialogFragment.RESULT_TASK) as? QuickStartTask</span>
<span class="nc bnc" id="L638" title="All 4 branches missed.">        task?.let { viewModel.onQuickStartTaskCardClick(it) }</span>
<span class="nc" id="L639">    }</span>

    override fun onDismiss() {
<span class="nc bnc" id="L642" title="All 2 branches missed.">        viewModel.onQuickStartFullScreenDialogDismiss()</span>
<span class="nc" id="L643">    }</span>

    fun handleScrollTo(scrollTo: Int) {
<span class="nc bnc" id="L646" title="All 6 branches missed.">        (binding?.recyclerView?.layoutManager as LinearLayoutManager).scrollToPositionWithOffset(scrollTo, 0)</span>
<span class="nc" id="L647">    }</span>

    fun onTrackWithTabSource(event: MySiteTrackWithTabSource) {
<span class="nc bnc" id="L650" title="All 4 branches missed.">        viewModel.trackWithTabSource(event = event.copy(currentTab = mySiteTabType))</span>
<span class="nc" id="L651">    }</span>
}

interface BloggingPromptsOnboardingListener {
    fun onShowBloggingPromptsOnboarding()
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>