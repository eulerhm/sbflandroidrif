<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderPost.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordpressJalapenoDebug</a> &gt; <a href="index.source.html" class="el_package">org.wordpress.android.models</a> &gt; <span class="el_source">ReaderPost.java</span></div><h1>ReaderPost.java</h1><pre class="source lang-java linenums">package org.wordpress.android.models;

import android.text.TextUtils;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.wordpress.android.ui.Organization;
import org.wordpress.android.ui.reader.ReaderConstants;
import org.wordpress.android.ui.reader.models.ReaderBlogIdPostId;
import org.wordpress.android.ui.reader.utils.ReaderIframeScanner;
import org.wordpress.android.ui.reader.utils.ReaderImageScanner;
import org.wordpress.android.ui.reader.utils.ReaderUtils;
import org.wordpress.android.util.DateTimeUtils;
import org.wordpress.android.util.DateTimeUtilsWrapper;
import org.wordpress.android.util.GravatarUtils;
import org.wordpress.android.util.HtmlUtils;
import org.wordpress.android.util.JSONUtils;
import org.wordpress.android.util.StringUtils;
import org.wordpress.android.util.UrlUtils;

import java.text.BreakIterator;
import java.util.Iterator;

<span class="nc" id="L25">public class ReaderPost {</span>
    private String mPseudoId;
    public long postId;
    public long blogId;
    public long feedId;
    public long feedItemId;
    public long authorId;
    public long authorBlogId;

    private String mTitle;
    private String mText;
    private String mExcerpt;
    private String mAuthorName;
    private String mAuthorFirstName;
    private String mBlogName;
    private String mBlogUrl;
    private String mBlogImageUrl;
    private String mPostAvatar;

<span class="nc" id="L44">    private ReaderTagList mTags = new ReaderTagList();</span>
    private String mPrimaryTag; // most popular tag on this post based on usage in blog
    private String mSecondaryTag; // second most popular tag on this post based on usage in blog

    private String mDateLiked;
    private String mDateTagged;
    private String mDatePublished;
    public double score;

    private String mUrl;
    private String mShortUrl;
    private String mFeaturedImage;
    private String mFeaturedVideo;
    private String mAuthorBlogUrl;

    public int numReplies; // includes comments, trackbacks &amp; pingbacks
    public int numLikes;

    public boolean isLikedByCurrentUser;
    public boolean isFollowedByCurrentUser;
    public boolean isBookmarked;
    public boolean isCommentsOpen;
    public boolean isExternal;
    public boolean isPrivate;
    public boolean isPrivateAtomic;
    public boolean isVideoPress;
    public boolean isJetpack;
    public boolean useExcerpt;
    public boolean isSeen;
    public boolean isSeenSupported; // might not be supported for posts created before 2020-07-13

    public int organizationId;

    private String mAttachmentsJson;
    private String mDiscoverJson;
    private String mFormat;

    public long xpostPostId;
    public long xpostBlogId;

    private String mRailcarJson;
<span class="nc" id="L85">    private ReaderCardType mCardType = ReaderCardType.DEFAULT;</span>

    public static ReaderPost fromJson(JSONObject json) {
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if (json == null) {</span>
<span class="nc" id="L89">            throw new IllegalArgumentException(&quot;null json post&quot;);</span>
        }

<span class="nc" id="L92">        ReaderPost post = new ReaderPost();</span>

<span class="nc" id="L94">        post.postId = json.optLong(ReaderConstants.POST_ID);</span>
<span class="nc" id="L95">        post.blogId = json.optLong(ReaderConstants.POST_SITE_ID);</span>
<span class="nc" id="L96">        post.feedId = json.optLong(&quot;feed_ID&quot;);</span>
<span class="nc" id="L97">        post.feedItemId = json.optLong(&quot;feed_item_ID&quot;);</span>

<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (json.has(ReaderConstants.POST_PSEUDO_ID)) {</span>
<span class="nc" id="L100">            post.mPseudoId = JSONUtils.getString(json, ReaderConstants.POST_PSEUDO_ID); // read/ endpoint</span>
        } else {
<span class="nc" id="L102">            post.mPseudoId = JSONUtils.getString(json, &quot;global_ID&quot;); // sites/ endpoint</span>
        }

        // remove HTML from the excerpt
<span class="nc" id="L106">        post.mExcerpt = HtmlUtils.fastStripHtml(JSONUtils.getString(json, &quot;excerpt&quot;)).trim();</span>

<span class="nc" id="L108">        post.mText = JSONUtils.getString(json, &quot;content&quot;);</span>
<span class="nc" id="L109">        post.mTitle = JSONUtils.getStringDecoded(json, &quot;title&quot;);</span>
<span class="nc" id="L110">        post.mFormat = JSONUtils.getString(json, &quot;format&quot;);</span>
<span class="nc" id="L111">        post.mUrl = JSONUtils.getString(json, &quot;URL&quot;);</span>
<span class="nc" id="L112">        post.mShortUrl = JSONUtils.getString(json, &quot;short_URL&quot;);</span>
<span class="nc" id="L113">        post.setBlogUrl(JSONUtils.getString(json, &quot;site_URL&quot;));</span>

<span class="nc" id="L115">        post.numLikes = json.optInt(&quot;like_count&quot;);</span>
<span class="nc" id="L116">        post.isLikedByCurrentUser = JSONUtils.getBool(json, &quot;i_like&quot;);</span>
<span class="nc" id="L117">        post.isFollowedByCurrentUser = JSONUtils.getBool(json, &quot;is_following&quot;);</span>
<span class="nc" id="L118">        post.isExternal = JSONUtils.getBool(json, &quot;is_external&quot;);</span>
<span class="nc" id="L119">        post.isPrivate = JSONUtils.getBool(json, &quot;site_is_private&quot;);</span>
<span class="nc" id="L120">        post.isPrivateAtomic = JSONUtils.getBool(json, &quot;site_is_atomic&quot;);</span>
<span class="nc" id="L121">        post.isJetpack = JSONUtils.getBool(json, &quot;is_jetpack&quot;);</span>
<span class="nc" id="L122">        post.useExcerpt = JSONUtils.getBool(json, &quot;use_excerpt&quot;);</span>
<span class="nc" id="L123">        post.isSeen = JSONUtils.getBool(json, &quot;is_seen&quot;);</span>
<span class="nc" id="L124">        post.isSeenSupported = json.has(&quot;is_seen&quot;);</span>

<span class="nc" id="L126">        JSONObject jsonDiscussion = json.optJSONObject(&quot;discussion&quot;);</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (jsonDiscussion != null) {</span>
<span class="nc" id="L128">            post.isCommentsOpen = JSONUtils.getBool(jsonDiscussion, &quot;comments_open&quot;);</span>
<span class="nc" id="L129">            post.numReplies = jsonDiscussion.optInt(&quot;comment_count&quot;);</span>
        } else {
<span class="nc" id="L131">            post.isCommentsOpen = JSONUtils.getBool(json, &quot;comments_open&quot;);</span>
<span class="nc" id="L132">            post.numReplies = json.optInt(&quot;comment_count&quot;);</span>
        }

        // parse the author section
<span class="nc" id="L136">        assignAuthorFromJson(post, json.optJSONObject(&quot;author&quot;));</span>

<span class="nc" id="L138">        post.mFeaturedImage = JSONUtils.getString(json, &quot;featured_image&quot;);</span>
<span class="nc" id="L139">        post.mBlogName = JSONUtils.getStringDecoded(json, &quot;site_name&quot;);</span>

<span class="nc" id="L141">        post.mDatePublished = JSONUtils.getString(json, &quot;date&quot;);</span>
<span class="nc" id="L142">        post.mDateLiked = JSONUtils.getString(json, &quot;date_liked&quot;);</span>
<span class="nc" id="L143">        post.mDateTagged = JSONUtils.getString(json, &quot;tagged_on&quot;);</span>

        // &quot;score&quot; only exists for search results
<span class="nc" id="L146">        post.score = json.optDouble(&quot;score&quot;);</span>

        // if the post is untitled, make up a title from the excerpt
<span class="nc bnc" id="L149" title="All 4 branches missed.">        if (!post.hasTitle() &amp;&amp; post.hasExcerpt()) {</span>
<span class="nc" id="L150">            post.mTitle = extractTitle(post.mExcerpt, 50);</span>
        }

        // remove html from title (rare, but does happen)
<span class="nc bnc" id="L154" title="All 6 branches missed.">        if (post.hasTitle() &amp;&amp; post.mTitle.contains(&quot;&lt;&quot;) &amp;&amp; post.mTitle.contains(&quot;&gt;&quot;)) {</span>
<span class="nc" id="L155">            post.mTitle = HtmlUtils.stripHtml(post.mTitle);</span>
        }

        // parse the tags section
<span class="nc" id="L159">        assignTagsFromJson(post, json.optJSONObject(&quot;tags&quot;));</span>

        // parse the attachments
<span class="nc" id="L162">        JSONObject jsonAttachments = json.optJSONObject(&quot;attachments&quot;);</span>
<span class="nc bnc" id="L163" title="All 4 branches missed.">        if (jsonAttachments != null &amp;&amp; jsonAttachments.length() &gt; 0) {</span>
<span class="nc" id="L164">            post.mAttachmentsJson = jsonAttachments.toString();</span>
        }

        // site metadata - returned when ?meta=site was added to the request
<span class="nc" id="L168">        JSONObject jsonSite = JSONUtils.getJSONChild(json, &quot;meta/data/site&quot;);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (jsonSite != null) {</span>
<span class="nc" id="L170">            post.blogId = jsonSite.optInt(&quot;ID&quot;);</span>
<span class="nc" id="L171">            post.mBlogName = JSONUtils.getString(jsonSite, &quot;name&quot;);</span>
<span class="nc" id="L172">            post.setBlogUrl(JSONUtils.getString(jsonSite, &quot;URL&quot;));</span>
<span class="nc" id="L173">            post.isPrivate = JSONUtils.getBool(jsonSite, &quot;is_private&quot;);</span>
<span class="nc" id="L174">            JSONObject jsonSiteIcon = jsonSite.optJSONObject(&quot;icon&quot;);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (jsonSiteIcon != null) {</span>
<span class="nc" id="L176">                post.mBlogImageUrl = JSONUtils.getString(jsonSiteIcon, &quot;img&quot;);</span>
            }
            // TODO: as of 29-Sept-2014, this is broken - endpoint returns false when it should be true
<span class="nc" id="L179">            post.isJetpack = JSONUtils.getBool(jsonSite, &quot;jetpack&quot;);</span>

<span class="nc" id="L181">            post.organizationId = jsonSite.optInt(&quot;organization_id&quot;);</span>
        }

        // &quot;discover&quot; posts
<span class="nc" id="L185">        JSONObject jsonDiscover = json.optJSONObject(&quot;discover_metadata&quot;);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (jsonDiscover != null) {</span>
<span class="nc" id="L187">            post.setDiscoverJson(jsonDiscover.toString());</span>
        }

        // xpost info
<span class="nc" id="L191">        assignXpostIdsFromJson(post, json.optJSONArray(&quot;metadata&quot;));</span>

        // if there's no featured image, check if featured media has been set to an image
<span class="nc bnc" id="L194" title="All 4 branches missed.">        if (!post.hasFeaturedImage() &amp;&amp; json.has(&quot;featured_media&quot;)) {</span>
<span class="nc" id="L195">            JSONObject jsonMedia = json.optJSONObject(&quot;featured_media&quot;);</span>
<span class="nc" id="L196">            String type = JSONUtils.getString(jsonMedia, &quot;type&quot;);</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if (type.equals(&quot;image&quot;)) {</span>
<span class="nc" id="L198">                post.mFeaturedImage = JSONUtils.getString(jsonMedia, &quot;uri&quot;);</span>
            }
        }

        // if the post doesn't have a featured image but it contains an IMG tag, check whether
        // we can find a suitable image from the content
<span class="nc bnc" id="L204" title="All 4 branches missed.">        if (!post.hasFeaturedImage() &amp;&amp; post.hasImages()) {</span>
<span class="nc" id="L205">            post.mFeaturedImage = new ReaderImageScanner(post.mText, post.isPrivate)</span>
<span class="nc" id="L206">                    .getLargestImage(ReaderConstants.MIN_FEATURED_IMAGE_WIDTH);</span>
        }

        // if there's no featured image or featured video and the post contains an iframe, scan
        // the content for a suitable featured video
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (!post.hasFeaturedImage()</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">            &amp;&amp; !post.hasFeaturedVideo()</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">            &amp;&amp; post.getText().contains(&quot;&lt;iframe&quot;)) {</span>
<span class="nc" id="L214">            post.setFeaturedVideo(new ReaderIframeScanner(post.getText()).getFirstUsableVideo());</span>
        }

        // &quot;railcar&quot; data - currently used in search streams, used by TrainTracks
<span class="nc" id="L218">        JSONObject jsonRailcar = json.optJSONObject(&quot;railcar&quot;);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (jsonRailcar != null) {</span>
<span class="nc" id="L220">            post.setRailcarJson(jsonRailcar.toString());</span>
        }

        // set the card type last since it depends on information contained in the post - note
        // that this is stored in the post table rather than calculated on-the-fly
<span class="nc" id="L225">        post.setCardType(ReaderCardType.fromReaderPost(post));</span>

<span class="nc" id="L227">        return post;</span>
    }

    public boolean hasImages() {
<span class="nc bnc" id="L231" title="All 4 branches missed.">        return hasText() &amp;&amp; mText.contains(&quot;&lt;img &quot;);</span>
    }

    /*
     * assigns cross post blog &amp; post IDs from post's metadata section
     * &quot;metadata&quot;: [
     * {
     * &quot;id&quot;: &quot;21192&quot;,
     * &quot;key&quot;: &quot;xpost_origin&quot;,
     * &quot;value&quot;: &quot;11326809:18427&quot;
     * }
     * ],
     */
    private static void assignXpostIdsFromJson(ReaderPost post, JSONArray jsonMetadata) {
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (jsonMetadata == null) {</span>
<span class="nc" id="L246">            return;</span>
        }

<span class="nc bnc" id="L249" title="All 2 branches missed.">        for (int i = 0; i &lt; jsonMetadata.length(); i++) {</span>
<span class="nc" id="L250">            JSONObject jsonMetaItem = jsonMetadata.optJSONObject(i);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">            if (jsonMetaItem != null) {</span>
<span class="nc" id="L252">                String metaKey = jsonMetaItem.optString(&quot;key&quot;);</span>
<span class="nc bnc" id="L253" title="All 4 branches missed.">                if (!TextUtils.isEmpty(metaKey) &amp;&amp; metaKey.equals(&quot;xpost_origin&quot;)) {</span>
<span class="nc" id="L254">                    String value = jsonMetaItem.optString(&quot;value&quot;);</span>
<span class="nc bnc" id="L255" title="All 4 branches missed.">                    if (!TextUtils.isEmpty(value) &amp;&amp; value.contains(&quot;:&quot;)) {</span>
<span class="nc" id="L256">                        String[] valuePair = value.split(&quot;:&quot;);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">                        if (valuePair.length == 2) {</span>
<span class="nc" id="L258">                            post.xpostBlogId = StringUtils.stringToLong(valuePair[0]);</span>
<span class="nc" id="L259">                            post.xpostPostId = StringUtils.stringToLong(valuePair[1]);</span>
<span class="nc" id="L260">                            return;</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L266">    }</span>

    /*
     * assigns author-related info to the passed post from the passed JSON &quot;author&quot; object
     */
    private static void assignAuthorFromJson(ReaderPost post, JSONObject jsonAuthor) {
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (jsonAuthor == null) {</span>
<span class="nc" id="L273">            return;</span>
        }

<span class="nc" id="L276">        post.mAuthorName = JSONUtils.getStringDecoded(jsonAuthor, &quot;name&quot;);</span>
<span class="nc" id="L277">        post.mAuthorFirstName = JSONUtils.getStringDecoded(jsonAuthor, &quot;first_name&quot;);</span>
<span class="nc" id="L278">        post.authorId = jsonAuthor.optLong(&quot;ID&quot;);</span>
<span class="nc" id="L279">        post.authorBlogId = jsonAuthor.optLong(&quot;site_ID&quot;);</span>

        // v1.2 endpoint contains a &quot;has_avatar&quot; boolean which tells us whether the author
        // has a valid avatar - if this field exists and is set to false, skip setting
        // the avatar URL
        boolean hasAvatar;
<span class="nc bnc" id="L285" title="All 2 branches missed.">        if (jsonAuthor.has(&quot;has_avatar&quot;)) {</span>
<span class="nc" id="L286">            hasAvatar = jsonAuthor.optBoolean(&quot;has_avatar&quot;);</span>
        } else {
<span class="nc" id="L288">            hasAvatar = true;</span>
        }
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (hasAvatar) {</span>
<span class="nc" id="L291">            post.mPostAvatar = JSONUtils.getString(jsonAuthor, &quot;avatar_URL&quot;);</span>
        }

        // site_URL doesn't exist for /sites/ endpoints, so get it from the author
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (TextUtils.isEmpty(post.mBlogUrl)) {</span>
<span class="nc" id="L296">            post.setBlogUrl(JSONUtils.getString(jsonAuthor, &quot;URL&quot;));</span>
        }

<span class="nc" id="L299">        post.setAuthorBlogUrl(JSONUtils.getString(jsonAuthor, &quot;URL&quot;));</span>
<span class="nc" id="L300">    }</span>

    /*
     * assigns primary/secondary tags to the passed post from the passed JSON &quot;tags&quot; object
     */
    private static void assignTagsFromJson(ReaderPost post, JSONObject jsonTags) {
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (jsonTags == null) {</span>
<span class="nc" id="L307">            return;</span>
        }

<span class="nc" id="L310">        Iterator&lt;String&gt; it = jsonTags.keys();</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if (!it.hasNext()) {</span>
<span class="nc" id="L312">            return;</span>
        }

        // most popular tag &amp; second most popular tag, based on usage count on this blog
<span class="nc" id="L316">        String mostPopularTag = null;</span>
<span class="nc" id="L317">        String nextMostPopularTag = null;</span>
<span class="nc" id="L318">        int popularCount = 0;</span>

<span class="nc" id="L320">        ReaderTagList tags = new ReaderTagList();</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">        while (it.hasNext()) {</span>
<span class="nc" id="L322">            JSONObject jsonThisTag = jsonTags.optJSONObject(it.next());</span>
<span class="nc" id="L323">            String thisTagName = UrlUtils.urlDecode(JSONUtils.getString(jsonThisTag, &quot;slug&quot;));</span>

<span class="nc" id="L325">            ReaderTag tag = ReaderUtils.getTagFromTagName(thisTagName, ReaderTagType.DEFAULT);</span>
<span class="nc" id="L326">            tags.add(tag);</span>

            // if the number of posts on this blog that use this tag is higher than previous,
            // set this as the most popular tag, and set the second most popular tag to
            // the current most popular tag
<span class="nc" id="L331">            int postCount = jsonThisTag.optInt(&quot;post_count&quot;);</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">            if (postCount &gt; popularCount) {</span>
<span class="nc" id="L333">                nextMostPopularTag = mostPopularTag;</span>
<span class="nc" id="L334">                mostPopularTag = thisTagName;</span>
<span class="nc" id="L335">                popularCount = postCount;</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">            } else if (nextMostPopularTag == null) {</span>
<span class="nc" id="L337">                nextMostPopularTag = thisTagName;</span>
            }
<span class="nc" id="L339">        }</span>

        // don't set primary tag if one is already set
<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (!post.hasPrimaryTag()) {</span>
<span class="nc" id="L343">            post.setPrimaryTag(mostPopularTag);</span>
        }
<span class="nc" id="L345">        post.setSecondaryTag(nextMostPopularTag);</span>
<span class="nc" id="L346">        post.setTags(tags);</span>
<span class="nc" id="L347">    }</span>

    /*
     * extracts a title from a post's excerpt - used when the post has no title
     */
    private static String extractTitle(final String excerpt, int maxLen) {
<span class="nc bnc" id="L353" title="All 2 branches missed.">        if (TextUtils.isEmpty(excerpt)) {</span>
<span class="nc" id="L354">            return null;</span>
        }

<span class="nc bnc" id="L357" title="All 2 branches missed.">        if (excerpt.length() &lt; maxLen) {</span>
<span class="nc" id="L358">            return excerpt.trim();</span>
        }

<span class="nc" id="L361">        StringBuilder result = new StringBuilder();</span>
<span class="nc" id="L362">        BreakIterator wordIterator = BreakIterator.getWordInstance();</span>
<span class="nc" id="L363">        wordIterator.setText(excerpt);</span>
<span class="nc" id="L364">        int start = wordIterator.first();</span>
<span class="nc" id="L365">        int end = wordIterator.next();</span>
<span class="nc" id="L366">        int totalLen = 0;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">        while (end != BreakIterator.DONE) {</span>
<span class="nc" id="L368">            String word = excerpt.substring(start, end);</span>
<span class="nc" id="L369">            result.append(word);</span>
<span class="nc" id="L370">            totalLen += word.length();</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (totalLen &gt;= maxLen) {</span>
<span class="nc" id="L372">                break;</span>
            }
<span class="nc" id="L374">            start = end;</span>
<span class="nc" id="L375">            end = wordIterator.next();</span>
<span class="nc" id="L376">        }</span>

<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (totalLen == 0) {</span>
<span class="nc" id="L379">            return null;</span>
        }
<span class="nc" id="L381">        return result.toString().trim() + &quot;...&quot;;</span>
    }

    // --------------------------------------------------------------------------------------------

    public String getAuthorName() {
<span class="nc" id="L387">        return StringUtils.notNullStr(mAuthorName);</span>
    }

    public void setAuthorName(String name) {
<span class="nc" id="L391">        this.mAuthorName = StringUtils.notNullStr(name);</span>
<span class="nc" id="L392">    }</span>

    public String getAuthorFirstName() {
<span class="nc" id="L395">        return StringUtils.notNullStr(mAuthorFirstName);</span>
    }

    public void setAuthorFirstName(String name) {
<span class="nc" id="L399">        this.mAuthorFirstName = StringUtils.notNullStr(name);</span>
<span class="nc" id="L400">    }</span>

    public String getTitle() {
<span class="nc" id="L403">        return StringUtils.notNullStr(mTitle);</span>
    }

    public void setTitle(String title) {
<span class="nc" id="L407">        this.mTitle = StringUtils.notNullStr(title);</span>
<span class="nc" id="L408">    }</span>

    public String getText() {
<span class="nc" id="L411">        return StringUtils.notNullStr(mText);</span>
    }

    public void setText(String text) {
<span class="nc" id="L415">        this.mText = StringUtils.notNullStr(text);</span>
<span class="nc" id="L416">    }</span>

    public String getExcerpt() {
<span class="nc" id="L419">        return StringUtils.notNullStr(mExcerpt);</span>
    }

    public void setExcerpt(String excerpt) {
<span class="nc" id="L423">        this.mExcerpt = StringUtils.notNullStr(excerpt);</span>
<span class="nc" id="L424">    }</span>

    // https://codex.wordpress.org/Post_Formats
    public String getFormat() {
<span class="nc" id="L428">        return StringUtils.notNullStr(mFormat);</span>
    }

    public void setFormat(String format) {
<span class="nc" id="L432">        this.mFormat = StringUtils.notNullStr(format);</span>
<span class="nc" id="L433">    }</span>

    public boolean isGallery() {
<span class="nc bnc" id="L436" title="All 4 branches missed.">        return mFormat != null &amp;&amp; mFormat.equals(&quot;gallery&quot;);</span>
    }


    public String getUrl() {
<span class="nc" id="L441">        return StringUtils.notNullStr(mUrl);</span>
    }

    public void setUrl(String url) {
<span class="nc" id="L445">        this.mUrl = StringUtils.notNullStr(url);</span>
<span class="nc" id="L446">    }</span>

    public String getShortUrl() {
<span class="nc" id="L449">        return StringUtils.notNullStr(mShortUrl);</span>
    }

    public void setShortUrl(String shortUrl) {
<span class="nc" id="L453">        this.mShortUrl = StringUtils.notNullStr(shortUrl);</span>
<span class="nc" id="L454">    }</span>

    public boolean hasShortUrl() {
<span class="nc bnc" id="L457" title="All 2 branches missed.">        return !TextUtils.isEmpty(mShortUrl);</span>
    }

    public String getFeaturedImage() {
<span class="nc" id="L461">        return StringUtils.notNullStr(mFeaturedImage);</span>
    }

    public void setFeaturedImage(String featuredImage) {
<span class="nc" id="L465">        this.mFeaturedImage = StringUtils.notNullStr(featuredImage);</span>
<span class="nc" id="L466">    }</span>

    public String getFeaturedVideo() {
<span class="nc" id="L469">        return StringUtils.notNullStr(mFeaturedVideo);</span>
    }

    public void setFeaturedVideo(String featuredVideo) {
<span class="nc" id="L473">        this.mFeaturedVideo = StringUtils.notNullStr(featuredVideo);</span>
<span class="nc" id="L474">    }</span>

    public String getBlogName() {
<span class="nc" id="L477">        return StringUtils.notNullStr(mBlogName);</span>
    }

    public void setBlogName(String blogName) {
<span class="nc" id="L481">        this.mBlogName = StringUtils.notNullStr(blogName);</span>
<span class="nc" id="L482">    }</span>

    public String getBlogUrl() {
<span class="nc" id="L485">        return StringUtils.notNullStr(mBlogUrl);</span>
    }

    public void setBlogUrl(String blogUrl) {
<span class="nc" id="L489">        this.mBlogUrl = StringUtils.notNullStr(blogUrl);</span>
<span class="nc" id="L490">    }</span>

    public String getAuthorBlogUrl() {
<span class="nc" id="L493">        return StringUtils.notNullStr(mAuthorBlogUrl);</span>
    }

    public void setAuthorBlogUrl(String authorBlogUrl) {
<span class="nc" id="L497">        this.mAuthorBlogUrl = StringUtils.notNullStr(authorBlogUrl);</span>
<span class="nc" id="L498">    }</span>

    public String getBlogImageUrl() {
<span class="nc" id="L501">        return StringUtils.notNullStr(mBlogImageUrl);</span>
    }

    public void setBlogImageUrl(String imageUrl) {
<span class="nc" id="L505">        this.mBlogImageUrl = StringUtils.notNullStr(imageUrl);</span>
<span class="nc" id="L506">    }</span>

    public String getPostAvatar() {
<span class="nc" id="L509">        return StringUtils.notNullStr(mPostAvatar);</span>
    }

    public void setPostAvatar(String postAvatar) {
<span class="nc" id="L513">        this.mPostAvatar = StringUtils.notNullStr(postAvatar);</span>
<span class="nc" id="L514">    }</span>

    public String getPseudoId() {
<span class="nc" id="L517">        return StringUtils.notNullStr(mPseudoId);</span>
    }

    public void setPseudoId(String pseudoId) {
<span class="nc" id="L521">        this.mPseudoId = StringUtils.notNullStr(pseudoId);</span>
<span class="nc" id="L522">    }</span>

    public String getDatePublished() {
<span class="nc" id="L525">        return StringUtils.notNullStr(mDatePublished);</span>
    }

    public void setDatePublished(String dateStr) {
<span class="nc" id="L529">        this.mDatePublished = StringUtils.notNullStr(dateStr);</span>
<span class="nc" id="L530">    }</span>

    public String getDateLiked() {
<span class="nc" id="L533">        return StringUtils.notNullStr(mDateLiked);</span>
    }

    public void setDateLiked(String dateStr) {
<span class="nc" id="L537">        this.mDateLiked = StringUtils.notNullStr(dateStr);</span>
<span class="nc" id="L538">    }</span>

    public String getDateTagged() {
<span class="nc" id="L541">        return StringUtils.notNullStr(mDateTagged);</span>
    }

    public void setDateTagged(String dateStr) {
<span class="nc" id="L545">        this.mDateTagged = StringUtils.notNullStr(dateStr);</span>
<span class="nc" id="L546">    }</span>

    public ReaderTagList getTags() {
<span class="nc" id="L549">        return mTags;</span>
    }

    public void setTags(ReaderTagList tagList) {
<span class="nc" id="L553">        mTags = tagList;</span>
<span class="nc" id="L554">    }</span>

    public String getPrimaryTag() {
<span class="nc" id="L557">        return StringUtils.notNullStr(mPrimaryTag);</span>
    }

    public void setPrimaryTag(String tagName) {
<span class="nc" id="L561">        this.mPrimaryTag = StringUtils.notNullStr(tagName);</span>
<span class="nc" id="L562">    }</span>

    public boolean hasPrimaryTag() {
<span class="nc bnc" id="L565" title="All 2 branches missed.">        return !TextUtils.isEmpty(mPrimaryTag);</span>
    }

    public String getSecondaryTag() {
<span class="nc" id="L569">        return StringUtils.notNullStr(mSecondaryTag);</span>
    }

    public void setSecondaryTag(String tagName) {
<span class="nc" id="L573">        this.mSecondaryTag = StringUtils.notNullStr(tagName);</span>
<span class="nc" id="L574">    }</span>

    public boolean hasSecondaryTag() {
<span class="nc bnc" id="L577" title="All 2 branches missed.">        return !TextUtils.isEmpty(mSecondaryTag);</span>
    }

    public Organization getOrganization() {
<span class="nc" id="L581">        return Organization.fromOrgId(organizationId);</span>
    }

    public void setOrganization(Organization organization) {
<span class="nc" id="L585">        organizationId = organization.getOrgId();</span>
<span class="nc" id="L586">    }</span>

    /*
     * attachments are stored as the actual JSON to avoid having a separate table for
     * them, may need to revisit this if/when attachments become more important
     */
    public String getAttachmentsJson() {
<span class="nc" id="L593">        return StringUtils.notNullStr(mAttachmentsJson);</span>
    }

    public void setAttachmentsJson(String json) {
<span class="nc" id="L597">        mAttachmentsJson = StringUtils.notNullStr(json);</span>
<span class="nc" id="L598">    }</span>

    public boolean hasAttachments() {
<span class="nc bnc" id="L601" title="All 2 branches missed.">        return !TextUtils.isEmpty(mAttachmentsJson);</span>
    }

    /*
     * &quot;discover&quot; posts also store the actual JSON
     */
    public String getDiscoverJson() {
<span class="nc" id="L608">        return StringUtils.notNullStr(mDiscoverJson);</span>
    }

    public void setDiscoverJson(String json) {
<span class="nc" id="L612">        mDiscoverJson = StringUtils.notNullStr(json);</span>
<span class="nc" id="L613">    }</span>

    public boolean isDiscoverPost() {
<span class="nc bnc" id="L616" title="All 2 branches missed.">        return !TextUtils.isEmpty(mDiscoverJson);</span>
    }

    private transient ReaderPostDiscoverData mDiscoverData;

    public ReaderPostDiscoverData getDiscoverData() {
<span class="nc bnc" id="L622" title="All 4 branches missed.">        if (mDiscoverData == null &amp;&amp; !TextUtils.isEmpty(mDiscoverJson)) {</span>
            try {
<span class="nc" id="L624">                mDiscoverData = new ReaderPostDiscoverData(new JSONObject(mDiscoverJson));</span>
<span class="nc" id="L625">            } catch (JSONException e) {</span>
<span class="nc" id="L626">                return null;</span>
<span class="nc" id="L627">            }</span>
        }
<span class="nc" id="L629">        return mDiscoverData;</span>
    }

    public boolean hasText() {
<span class="nc bnc" id="L633" title="All 2 branches missed.">        return !TextUtils.isEmpty(mText);</span>
    }

    public boolean hasUrl() {
<span class="nc bnc" id="L637" title="All 2 branches missed.">        return !TextUtils.isEmpty(mUrl);</span>
    }

    public boolean hasExcerpt() {
<span class="nc bnc" id="L641" title="All 2 branches missed.">        return !TextUtils.isEmpty(mExcerpt);</span>
    }

    public boolean hasFeaturedImage() {
<span class="nc bnc" id="L645" title="All 2 branches missed.">        return !TextUtils.isEmpty(mFeaturedImage);</span>
    }

    public boolean hasFeaturedVideo() {
<span class="nc bnc" id="L649" title="All 2 branches missed.">        return !TextUtils.isEmpty(mFeaturedVideo);</span>
    }

    public boolean hasPostAvatar() {
<span class="nc bnc" id="L653" title="All 2 branches missed.">        return !TextUtils.isEmpty(mPostAvatar);</span>
    }

    public boolean hasBlogName() {
<span class="nc bnc" id="L657" title="All 2 branches missed.">        return !TextUtils.isEmpty(mBlogName);</span>
    }

    public boolean hasAuthorName() {
<span class="nc bnc" id="L661" title="All 2 branches missed.">        return !TextUtils.isEmpty(mAuthorName);</span>
    }

    public boolean hasAuthorFirstName() {
<span class="nc bnc" id="L665" title="All 2 branches missed.">        return !TextUtils.isEmpty(mAuthorFirstName);</span>
    }

    public boolean hasTitle() {
<span class="nc bnc" id="L669" title="All 2 branches missed.">        return !TextUtils.isEmpty(mTitle);</span>
    }

    public boolean hasBlogUrl() {
<span class="nc bnc" id="L673" title="All 2 branches missed.">        return !TextUtils.isEmpty(mBlogUrl);</span>
    }

    public boolean hasBlogImageUrl() {
<span class="nc bnc" id="L677" title="All 2 branches missed.">        return !TextUtils.isEmpty(mBlogImageUrl);</span>
    }

    /*
     * we should show the excerpt rather than full content for Jetpack posts that specify to show only the excerpt
     */
    public boolean shouldShowExcerpt() {
<span class="nc bnc" id="L684" title="All 6 branches missed.">        return isJetpack &amp;&amp; useExcerpt &amp;&amp; hasExcerpt();</span>
    }

    /*
     * returns true if this post is from a WordPress blog
     */
    public boolean isWP() {
<span class="nc bnc" id="L691" title="All 2 branches missed.">        return !isExternal;</span>
    }

    /*
     * returns true if this is a cross-post
     */
    public boolean isXpost() {
<span class="nc bnc" id="L698" title="All 4 branches missed.">        return xpostBlogId != 0 &amp;&amp; xpostPostId != 0;</span>
    }

    /*
     * returns true if this is a P2 or A8C post
     */
    public boolean isP2orA8C() {
<span class="nc bnc" id="L705" title="All 4 branches missed.">        return getOrganization() == Organization.P2 || getOrganization() == Organization.A8C;</span>
    }

    /*
     * returns true if the passed post appears to be the same as this one - used when posts are
     * retrieved to determine which ones are new/changed/unchanged
     */
    public boolean isSamePost(ReaderPost post) {
<span class="nc bnc" id="L713" title="All 22 branches missed.">        return post != null</span>
               &amp;&amp; post.blogId == this.blogId
               &amp;&amp; post.postId == this.postId
               &amp;&amp; post.feedId == this.feedId
               &amp;&amp; post.feedItemId == this.feedItemId
               &amp;&amp; post.numLikes == this.numLikes
               &amp;&amp; post.numReplies == this.numReplies
               &amp;&amp; post.isFollowedByCurrentUser == this.isFollowedByCurrentUser
               &amp;&amp; post.isLikedByCurrentUser == this.isLikedByCurrentUser
               &amp;&amp; post.isCommentsOpen == this.isCommentsOpen
               &amp;&amp; post.useExcerpt == this.useExcerpt
<span class="nc bnc" id="L724" title="All 2 branches missed.">               &amp;&amp; post.getTitle().equals(this.getTitle())</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">               &amp;&amp; post.getExcerpt().equals(this.getExcerpt())</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">               &amp;&amp; post.getText().equals(this.getText());</span>
    }

    public boolean hasIds(ReaderBlogIdPostId ids) {
<span class="nc bnc" id="L730" title="All 2 branches missed.">        return ids != null</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">               &amp;&amp; ids.getBlogId() == this.blogId</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">               &amp;&amp; ids.getPostId() == this.postId;</span>
    }

    /*
     * liking is enabled for all wp.com and jp posts with the exception of discover posts
     */
    public boolean canLikePost() {
<span class="nc bnc" id="L739" title="All 6 branches missed.">        return (isWP() || isJetpack) &amp;&amp; (!isDiscoverPost());</span>
    }


    public String getRailcarJson() {
<span class="nc" id="L744">        return StringUtils.notNullStr(mRailcarJson);</span>
    }

    public void setRailcarJson(String jsonRailcar) {
<span class="nc" id="L748">        this.mRailcarJson = StringUtils.notNullStr(jsonRailcar);</span>
<span class="nc" id="L749">    }</span>

    public boolean hasRailcar() {
<span class="nc bnc" id="L752" title="All 2 branches missed.">        return !TextUtils.isEmpty(mRailcarJson);</span>
    }

    public ReaderCardType getCardType() {
<span class="nc bnc" id="L756" title="All 2 branches missed.">        return mCardType != null ? mCardType : ReaderCardType.DEFAULT;</span>
    }

    public void setCardType(ReaderCardType cardType) {
<span class="nc" id="L760">        this.mCardType = cardType;</span>
<span class="nc" id="L761">    }</span>

    /****
     * the following are transient variables - not stored in the db or returned in the json - whose
     * sole purpose is to cache commonly-used values for the post that speeds up using them inside
     * adapters
     ****/

    /*
     * returns the featured image url as a photon url set to the passed width/height
     */
    private transient String mFeaturedImageForDisplay;

    public String getFeaturedImageForDisplay(int width, int height) {
<span class="nc bnc" id="L775" title="All 2 branches missed.">        if (mFeaturedImageForDisplay == null) {</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">            if (!hasFeaturedImage()) {</span>
<span class="nc" id="L777">                mFeaturedImageForDisplay = &quot;&quot;;</span>
            } else {
<span class="nc" id="L779">                mFeaturedImageForDisplay = ReaderUtils.getResizedImageUrl(</span>
                        mFeaturedImage, width, height, isPrivate, isPrivateAtomic);
            }
        }
<span class="nc" id="L783">        return mFeaturedImageForDisplay;</span>
    }

    /*
     * returns the avatar url as a photon url set to the passed size
     */
    private transient String mAvatarForDisplay;

    public String getPostAvatarForDisplay(int size) {
<span class="nc bnc" id="L792" title="All 2 branches missed.">        if (mAvatarForDisplay == null) {</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">            if (!hasPostAvatar()) {</span>
<span class="nc" id="L794">                return &quot;&quot;;</span>
            }
<span class="nc" id="L796">            mAvatarForDisplay = GravatarUtils.fixGravatarUrl(mPostAvatar, size);</span>
        }
<span class="nc" id="L798">        return mAvatarForDisplay;</span>
    }

    /*
     * returns the blog's blavatar url as a photon url set to the passed size
     */
    private transient String mBlavatarForDisplay;

    public String getPostBlavatarForDisplay(int size) {
<span class="nc bnc" id="L807" title="All 2 branches missed.">        if (mBlavatarForDisplay == null) {</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">            if (!hasBlogUrl()) {</span>
<span class="nc" id="L809">                return &quot;&quot;;</span>
            }
<span class="nc" id="L811">            mBlavatarForDisplay = GravatarUtils.blavatarFromUrl(getBlogUrl(), size);</span>
        }
<span class="nc" id="L813">        return mBlavatarForDisplay;</span>
    }

    /*
     * converts iso8601 pubDate to a java date for display - this is the date that appears on posts
     */
    private transient java.util.Date mDateDisplay;

    public java.util.Date getDisplayDate() {
<span class="nc bnc" id="L822" title="All 2 branches missed.">        if (mDateDisplay == null) {</span>
<span class="nc" id="L823">            mDateDisplay = DateTimeUtils.dateFromIso8601(this.mDatePublished);</span>
        }
<span class="nc" id="L825">        return mDateDisplay;</span>
    }

    public java.util.Date getDisplayDate(DateTimeUtilsWrapper dateTimeUtilsWrapper) {
<span class="nc bnc" id="L829" title="All 2 branches missed.">        if (mDateDisplay == null) {</span>
<span class="nc" id="L830">            mDateDisplay = dateTimeUtilsWrapper.dateFromIso8601(this.mDatePublished);</span>
        }
<span class="nc" id="L832">        return mDateDisplay;</span>
    }

    /*
     * used when a unique numeric id is required by an adapter (when hasStableIds() = true)
     */
    private transient long mStableId;

    public long getStableId() {
<span class="nc bnc" id="L841" title="All 2 branches missed.">        if (mStableId == 0) {</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">            mStableId = (mPseudoId != null ? mPseudoId.hashCode() : 0);</span>
        }
<span class="nc" id="L844">        return mStableId;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Generated by the Android Gradle plugin 7.1.1</div></body></html>