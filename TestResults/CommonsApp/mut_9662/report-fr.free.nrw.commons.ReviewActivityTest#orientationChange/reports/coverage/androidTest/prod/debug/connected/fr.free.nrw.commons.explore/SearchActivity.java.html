<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SearchActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.explore</a> &gt; <span class="el_source">SearchActivity.java</span></div><h1>SearchActivity.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.explore;

import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.FrameLayout;
import android.widget.SearchView;
import androidx.annotation.NonNull;
import androidx.appcompat.widget.Toolbar;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;
import androidx.viewpager.widget.ViewPager;
import butterknife.BindView;
import butterknife.ButterKnife;
import com.google.android.material.tabs.TabLayout;
import com.jakewharton.rxbinding2.view.RxView;
import com.jakewharton.rxbinding2.widget.RxSearchView;
import fr.free.nrw.commons.Media;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.ViewPagerAdapter;
import fr.free.nrw.commons.category.CategoryImagesCallback;
import fr.free.nrw.commons.explore.categories.search.SearchCategoryFragment;
import fr.free.nrw.commons.explore.depictions.search.SearchDepictionsFragment;
import fr.free.nrw.commons.explore.media.SearchMediaFragment;
import fr.free.nrw.commons.explore.models.RecentSearch;
import fr.free.nrw.commons.explore.recentsearches.RecentSearchesDao;
import fr.free.nrw.commons.explore.recentsearches.RecentSearchesFragment;
import fr.free.nrw.commons.media.MediaDetailPagerFragment;
import fr.free.nrw.commons.theme.BaseActivity;
import fr.free.nrw.commons.utils.FragmentUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import io.reactivex.android.schedulers.AndroidSchedulers;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.concurrent.TimeUnit;
import javax.inject.Inject;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L42">public class SearchActivity extends BaseActivity implements MediaDetailPagerFragment.MediaDetailProvider, CategoryImagesCallback {</span>

    @BindView(R.id.toolbar_search)
    Toolbar toolbar;

    @BindView(R.id.searchHistoryContainer)
    FrameLayout searchHistoryContainer;

    @BindView(R.id.mediaContainer)
    FrameLayout mediaContainer;

    @BindView(R.id.searchBox)
    SearchView searchView;

    @BindView(R.id.tab_layout)
    TabLayout tabLayout;

    @BindView(R.id.viewPager)
    ViewPager viewPager;

    @Inject
    RecentSearchesDao recentSearchesDao;

    private SearchMediaFragment searchMediaFragment;

    private SearchCategoryFragment searchCategoryFragment;

    private SearchDepictionsFragment searchDepictionsFragment;

    private RecentSearchesFragment recentSearchesFragment;

    private FragmentManager supportFragmentManager;

    private MediaDetailPagerFragment mediaDetails;

    ViewPagerAdapter viewPagerAdapter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4614)) {</span>
<span class="nc" id="L82">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L84" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4615)) {</span>
<span class="nc" id="L85">            setContentView(R.layout.activity_search);</span>
        }
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4616)) {</span>
<span class="nc" id="L88">            ButterKnife.bind(this);</span>
        }
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4617)) {</span>
<span class="nc" id="L91">            setTitle(getString(R.string.title_activity_search));</span>
        }
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4618)) {</span>
<span class="nc" id="L94">            setSupportActionBar(toolbar);</span>
        }
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4619)) {</span>
<span class="nc" id="L97">            getSupportActionBar().setDisplayHomeAsUpEnabled(true);</span>
        }
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4620)) {</span>
<span class="nc" id="L100">            toolbar.setNavigationOnClickListener(v -&gt; onBackPressed());</span>
        }
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4621)) {</span>
<span class="nc" id="L103">            supportFragmentManager = getSupportFragmentManager();</span>
        }
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4622)) {</span>
<span class="nc" id="L106">            setSearchHistoryFragment();</span>
        }
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4623)) {</span>
<span class="nc" id="L109">            viewPagerAdapter = new ViewPagerAdapter(getSupportFragmentManager());</span>
        }
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4624)) {</span>
<span class="nc" id="L112">            viewPager.setAdapter(viewPagerAdapter);</span>
        }
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4625)) {</span>
            // Because we want all the fragments to be alive
<span class="nc" id="L116">            viewPager.setOffscreenPageLimit(2);</span>
        }
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4626)) {</span>
<span class="nc" id="L119">            tabLayout.setupWithViewPager(viewPager);</span>
        }
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4627)) {</span>
<span class="nc" id="L122">            setTabs();</span>
        }
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4628)) {</span>
<span class="nc" id="L125">            searchView.setQueryHint(getString(R.string.search_commons));</span>
        }
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4629)) {</span>
<span class="nc" id="L128">            searchView.onActionViewExpanded();</span>
        }
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4630)) {</span>
<span class="nc" id="L131">            searchView.clearFocus();</span>
        }
<span class="nc" id="L133">    }</span>

    /**
     * This method sets the search history fragment.
     * Search history fragment is displayed when query is empty.
     */
    private void setSearchHistoryFragment() {
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4631)) {</span>
<span class="nc" id="L141">            recentSearchesFragment = new RecentSearchesFragment();</span>
        }
<span class="nc" id="L143">        FragmentTransaction transaction = supportFragmentManager.beginTransaction();</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4632)) {</span>
<span class="nc" id="L145">            transaction.add(R.id.searchHistoryContainer, recentSearchesFragment).commit();</span>
        }
<span class="nc" id="L147">    }</span>

    /**
     * Sets the titles in the tabLayout and fragments in the viewPager
     */
    public void setTabs() {
<span class="nc" id="L153">        List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L154">        List&lt;String&gt; titleList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4633)) {</span>
<span class="nc" id="L156">            searchMediaFragment = new SearchMediaFragment();</span>
        }
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4634)) {</span>
<span class="nc" id="L159">            searchDepictionsFragment = new SearchDepictionsFragment();</span>
        }
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4635)) {</span>
<span class="nc" id="L162">            searchCategoryFragment = new SearchCategoryFragment();</span>
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4636)) {</span>
<span class="nc" id="L165">            fragmentList.add(searchMediaFragment);</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4637)) {</span>
<span class="nc" id="L168">            titleList.add(getResources().getString(R.string.search_tab_title_media).toUpperCase());</span>
        }
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4638)) {</span>
<span class="nc" id="L171">            fragmentList.add(searchCategoryFragment);</span>
        }
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4639)) {</span>
<span class="nc" id="L174">            titleList.add(getResources().getString(R.string.search_tab_title_categories).toUpperCase());</span>
        }
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4640)) {</span>
<span class="nc" id="L177">            fragmentList.add(searchDepictionsFragment);</span>
        }
<span class="nc bnc" id="L179" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4641)) {</span>
<span class="nc" id="L180">            titleList.add(getResources().getString(R.string.search_tab_title_depictions).toUpperCase());</span>
        }
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4642)) {</span>
<span class="nc" id="L183">            viewPagerAdapter.setTabData(fragmentList, titleList);</span>
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4643)) {</span>
<span class="nc" id="L186">            viewPagerAdapter.notifyDataSetChanged();</span>
        }
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4644)) {</span>
<span class="nc" id="L189">            compositeDisposable.add(RxSearchView.queryTextChanges(searchView).takeUntil(RxView.detaches(searchView)).debounce(500, TimeUnit.MILLISECONDS).observeOn(AndroidSchedulers.mainThread()).subscribe(this::handleSearch, Timber::e));</span>
        }
<span class="nc" id="L191">    }</span>

    private void handleSearch(final CharSequence query) {
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4660)) {</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">            if (!TextUtils.isEmpty(query)) {</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4650)) {</span>
<span class="nc" id="L197">                    saveRecentSearch(query.toString());</span>
                }
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4651)) {</span>
<span class="nc" id="L200">                    viewPager.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L202" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4652)) {</span>
<span class="nc" id="L203">                    tabLayout.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L205" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4653)) {</span>
<span class="nc" id="L206">                    searchHistoryContainer.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4655)) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                    if (FragmentUtils.isFragmentUIActive(searchDepictionsFragment)) {</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4654)) {</span>
<span class="nc" id="L211">                            searchDepictionsFragment.onQueryUpdated(query.toString());</span>
                        }
                    }
                }
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4657)) {</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                    if (FragmentUtils.isFragmentUIActive(searchMediaFragment)) {</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4656)) {</span>
<span class="nc" id="L218">                            searchMediaFragment.onQueryUpdated(query.toString());</span>
                        }
                    }
                }
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4659)) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                    if (FragmentUtils.isFragmentUIActive(searchCategoryFragment)) {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4658)) {</span>
<span class="nc" id="L225">                            searchCategoryFragment.onQueryUpdated(query.toString());</span>
                        }
                    }
                }
            } else {
<span class="nc bnc" id="L230" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4645)) {</span>
                    // Open RecentSearchesFragment
<span class="nc" id="L232">                    recentSearchesFragment.updateRecentSearches();</span>
                }
<span class="nc bnc" id="L234" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4646)) {</span>
<span class="nc" id="L235">                    viewPager.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L237" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4647)) {</span>
<span class="nc" id="L238">                    tabLayout.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L240" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4648)) {</span>
<span class="nc" id="L241">                    setSearchHistoryFragment();</span>
                }
<span class="nc bnc" id="L243" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4649)) {</span>
<span class="nc" id="L244">                    searchHistoryContainer.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc" id="L248">    }</span>

    private void saveRecentSearch(@NonNull final String query) {
<span class="nc" id="L251">        final RecentSearch recentSearch = recentSearchesDao.find(query);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4664)) {</span>
            // Newly searched query...
<span class="nc bnc" id="L254" title="All 2 branches missed.">            if (recentSearch == null) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4663)) {</span>
<span class="nc" id="L256">                    recentSearchesDao.save(new RecentSearch(null, query, new Date()));</span>
                }
            } else {
<span class="nc bnc" id="L259" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4661)) {</span>
<span class="nc" id="L260">                    recentSearch.setLastSearched(new Date());</span>
                }
<span class="nc bnc" id="L262" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4662)) {</span>
<span class="nc" id="L263">                    recentSearchesDao.save(recentSearch);</span>
                }
            }
        }
<span class="nc" id="L267">    }</span>

    /**
     * returns Media Object at position
     * @param i position of Media in the imagesRecyclerView adapter.
     */
    @Override
    public Media getMediaAtPosition(int i) {
<span class="nc" id="L275">        return searchMediaFragment.getMediaAtPosition(i);</span>
    }

    /**
     * returns total number of images present in the imagesRecyclerView adapter.
     */
    @Override
    public int getTotalMediaCount() {
<span class="nc" id="L283">        return searchMediaFragment.getTotalMediaCount();</span>
    }

    @Override
    public Integer getContributionStateAt(int position) {
<span class="nc" id="L288">        return null;</span>
    }

    /**
     * Reload media detail fragment once media is nominated
     *
     * @param index item position that has been nominated
     */
    @Override
    public void refreshNominatedMedia(int index) {
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4667)) {</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (getSupportFragmentManager().getBackStackEntryCount() == 1) {</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4665)) {</span>
<span class="nc" id="L301">                    onBackPressed();</span>
                }
<span class="nc bnc" id="L303" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4666)) {</span>
<span class="nc" id="L304">                    onMediaClicked(index);</span>
                }
            }
        }
<span class="nc" id="L308">    }</span>

    /**
     * This method is called on success of API call for image Search.
     * The viewpager will notified that number of items have changed.
     */
    @Override
    public void viewPagerNotifyDataSetChanged() {
<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4669)) {</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (mediaDetails != null) {</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4668)) {</span>
<span class="nc" id="L319">                    mediaDetails.notifyDataSetChanged();</span>
                }
            }
        }
<span class="nc" id="L323">    }</span>

    /**
     * Open media detail pager fragment on click of image in search results
     * @param index item index that should be opened
     */
    @Override
    public void onMediaClicked(int index) {
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4670)) {</span>
<span class="nc" id="L332">            ViewUtil.hideKeyboard(this.findViewById(R.id.searchBox));</span>
        }
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4671)) {</span>
<span class="nc" id="L335">            tabLayout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L337" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4672)) {</span>
<span class="nc" id="L338">            viewPager.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L340" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4673)) {</span>
<span class="nc" id="L341">            mediaContainer.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L343" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4674)) {</span>
            // to remove searchview when mediaDetails fragment open
<span class="nc" id="L345">            searchView.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4679)) {</span>
<span class="nc bnc" id="L348" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4675) ? (mediaDetails == null &amp;&amp; !mediaDetails.isVisible()) : (mediaDetails == null || !mediaDetails.isVisible()))) {</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4676)) {</span>
                    // set isFeaturedImage true for featured images, to include author field on media detail
<span class="nc" id="L351">                    mediaDetails = MediaDetailPagerFragment.newInstance(false, true);</span>
                }
<span class="nc bnc" id="L353" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4677)) {</span>
<span class="nc" id="L354">                    supportFragmentManager.beginTransaction().hide(supportFragmentManager.getFragments().get(supportFragmentManager.getBackStackEntryCount())).add(R.id.mediaContainer, mediaDetails).addToBackStack(null).commit();</span>
                }
<span class="nc bnc" id="L356" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4678)) {</span>
                    // https://stackoverflow.com/questions/11353075/how-can-i-maintain-fragment-state-when-added-to-the-back-stack/19022550#19022550
<span class="nc" id="L358">                    supportFragmentManager.executePendingTransactions();</span>
                }
            }
        }
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4680)) {</span>
<span class="nc" id="L363">            mediaDetails.showImage(index);</span>
        }
<span class="nc" id="L365">    }</span>

    /**
     * This method is called on Screen Rotation
     */
    @Override
    protected void onResume() {
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4682)) {</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">            if (supportFragmentManager.getBackStackEntryCount() == 1) {</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4681)) {</span>
                    // 
<span class="nc" id="L376">                    onBackPressed();</span>
                }
            }
        }
<span class="nc bnc" id="L380" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4683)) {</span>
<span class="nc" id="L381">            super.onResume();</span>
        }
<span class="nc" id="L383">    }</span>

    /**
     * This method is called on backPressed of anyFragment in the activity.
     * If condition is called when mediaDetailFragment is opened.
     */
    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4687)) {</span>
            // fixing:https://github.com/commons-app/apps-android-commons/issues/2296
<span class="nc bnc" id="L393" title="All 2 branches missed.">            if (getSupportFragmentManager().getBackStackEntryCount() == 2) {</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4684)) {</span>
<span class="nc" id="L395">                    supportFragmentManager.beginTransaction().remove(mediaDetails).commit();</span>
                }
<span class="nc bnc" id="L397" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4685)) {</span>
<span class="nc" id="L398">                    supportFragmentManager.popBackStack();</span>
                }
<span class="nc bnc" id="L400" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4686)) {</span>
<span class="nc" id="L401">                    supportFragmentManager.executePendingTransactions();</span>
                }
            }
        }
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4693)) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            if (getSupportFragmentManager().getBackStackEntryCount() == 1) {</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4689)) {</span>
                    // set the searchview
<span class="nc" id="L409">                    searchView.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L411" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4690)) {</span>
<span class="nc" id="L412">                    tabLayout.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L414" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4691)) {</span>
<span class="nc" id="L415">                    viewPager.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L417" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4692)) {</span>
<span class="nc" id="L418">                    mediaContainer.setVisibility(View.GONE);</span>
                }
            } else {
<span class="nc bnc" id="L421" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4688)) {</span>
<span class="nc" id="L422">                    toolbar.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4694)) {</span>
<span class="nc" id="L427">            super.onBackPressed();</span>
        }
<span class="nc" id="L429">    }</span>

    /**
     * This method is called on click of a recent search to update query in SearchView.
     * @param query Recent Search Query
     */
    public void updateText(String query) {
<span class="nc bnc" id="L436" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4695)) {</span>
<span class="nc" id="L437">            searchView.setQuery(query, true);</span>
        }
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4696)) {</span>
            // https://stackoverflow.com/questions/6117967/how-to-remove-focus-without-setting-focus-to-another-control/15481511
<span class="nc" id="L441">            viewPager.requestFocus();</span>
        }
<span class="nc" id="L443">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L447" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4697)) {</span>
<span class="nc" id="L448">            super.onDestroy();</span>
        }
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4698)) {</span>
            // Dispose the disposables when the activity is destroyed
<span class="nc" id="L452">            compositeDisposable.dispose();</span>
        }
<span class="nc" id="L454">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>