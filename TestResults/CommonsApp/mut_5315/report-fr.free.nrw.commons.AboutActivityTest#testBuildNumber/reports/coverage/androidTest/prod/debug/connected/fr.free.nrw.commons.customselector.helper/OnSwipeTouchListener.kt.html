<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OnSwipeTouchListener.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.customselector.helper</a> &gt; <span class="el_source">OnSwipeTouchListener.kt</span></div><h1>OnSwipeTouchListener.kt</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.customselector.helper

import android.content.Context
import android.util.DisplayMetrics
import android.view.*
import kotlin.math.abs

/**
 * Class for detecting swipe gestures
 */
<span class="nc" id="L11">open class OnSwipeTouchListener(context: Context?) : View.OnTouchListener {</span>

    private val gestureDetector: GestureDetector

<span class="nc" id="L15">    private val SWIPE_THRESHOLD_HEIGHT = (getScreenResolution(context!!)).second / 3</span>
<span class="nc" id="L16">    private val SWIPE_THRESHOLD_WIDTH = (getScreenResolution(context!!)).first / 3</span>
<span class="nc" id="L17">    private val SWIPE_VELOCITY_THRESHOLD = 1000</span>

    override fun onTouch(view: View?, motionEvent: MotionEvent): Boolean {
<span class="nc" id="L20">        return gestureDetector.onTouchEvent(motionEvent)</span>
    }

    fun getScreenResolution(context: Context): Pair&lt;Int, Int&gt; {
<span class="nc" id="L24">        val wm: WindowManager = context.getSystemService(Context.WINDOW_SERVICE) as WindowManager</span>
<span class="nc" id="L25">        val display: Display = wm.getDefaultDisplay()</span>
<span class="nc" id="L26">        val metrics = DisplayMetrics()</span>
<span class="nc" id="L27">        display.getMetrics(metrics)</span>
<span class="nc" id="L28">        val width: Int = metrics.widthPixels</span>
<span class="nc" id="L29">        val height: Int = metrics.heightPixels</span>
<span class="nc" id="L30">        return width to height</span>
    }

<span class="nc" id="L33">    inner class GestureListener : GestureDetector.SimpleOnGestureListener() {</span>

        override fun onDown(e: MotionEvent): Boolean {
<span class="nc" id="L36">            return true</span>
        }

        /**
         * Detects the gestures
         */
        override fun onFling(
            event1: MotionEvent,
            event2: MotionEvent,
            velocityX: Float,
            velocityY: Float
        ): Boolean {
<span class="nc" id="L48">            try {</span>
<span class="nc" id="L49">                val diffY: Float = event2.y - event1.y</span>
<span class="nc" id="L50">                val diffX: Float = event2.x - event1.x</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">                if (abs(diffX) &gt; abs(diffY)) {</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">                    if (abs(diffX) &gt; SWIPE_THRESHOLD_WIDTH &amp;&amp; abs(velocityX) &gt;</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">                        SWIPE_VELOCITY_THRESHOLD) {</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">                        if (diffX &gt; 0) {</span>
<span class="nc" id="L55">                            onSwipeRight()</span>
                        } else {
<span class="nc" id="L57">                            onSwipeLeft()</span>
                        }
                    }
                } else {
<span class="nc bnc" id="L61" title="All 2 branches missed.">                    if (abs(diffY) &gt; SWIPE_THRESHOLD_HEIGHT &amp;&amp; abs(velocityY) &gt;</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">                        SWIPE_VELOCITY_THRESHOLD) {</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">                        if (diffY &gt; 0) {</span>
<span class="nc" id="L64">                            onSwipeDown()</span>
                        } else {
<span class="nc" id="L66">                            onSwipeUp()</span>
                        }
                    }
                }
<span class="nc" id="L70">            } catch (exception: Exception) {</span>
<span class="nc" id="L71">                exception.printStackTrace()</span>
            }
<span class="nc" id="L73">            return false</span>
        }
    }

    /**
     * Swipe right to view previous image
     */
<span class="nc" id="L80">    open fun onSwipeRight() {}</span>

    /**
     * Swipe left to view next image
     */
<span class="nc" id="L85">    open fun onSwipeLeft() {}</span>

    /**
     * Swipe up to select the picture (the equivalent of tapping it in non-fullscreen mode)
     * and show the next picture skipping pictures that have either already been uploaded or
     * marked as not for upload
     */
<span class="nc" id="L92">    open fun onSwipeUp() {}</span>

    /**
     * Swipe down to mark that picture as &quot;Not for upload&quot; (the equivalent of selecting it then
     * tapping &quot;Mark as not for upload&quot; in non-fullscreen mode), and show the next picture.
     */
<span class="nc" id="L98">    open fun onSwipeDown() {}</span>

<span class="nc" id="L100">    init {</span>
<span class="nc" id="L101">        gestureDetector = GestureDetector(context, GestureListener())</span>
<span class="nc" id="L102">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>