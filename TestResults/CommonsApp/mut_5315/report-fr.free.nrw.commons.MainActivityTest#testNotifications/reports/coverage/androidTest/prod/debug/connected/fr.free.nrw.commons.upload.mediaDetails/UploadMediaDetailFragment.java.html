<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadMediaDetailFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.upload.mediaDetails</a> &gt; <span class="el_source">UploadMediaDetailFragment.java</span></div><h1>UploadMediaDetailFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.upload.mediaDetails;

import static android.app.Activity.RESULT_OK;
import static fr.free.nrw.commons.utils.ActivityUtils.startActivityWithFlags;
import static fr.free.nrw.commons.utils.ImageUtils.FILE_NAME_EXISTS;
import static fr.free.nrw.commons.utils.ImageUtils.getErrorMessageForResult;
import android.annotation.SuppressLint;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.speech.RecognizerIntent;
import android.text.TextUtils;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.CheckBox;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;
import android.graphics.drawable.Drawable;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.widget.AppCompatButton;
import androidx.appcompat.widget.AppCompatImageButton;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;
import com.github.chrisbanes.photoview.PhotoView;
import com.mapbox.mapboxsdk.camera.CameraPosition;
import fr.free.nrw.commons.LocationPicker.LocationPicker;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.edit.EditActivity;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.filepicker.UploadableFile;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.nearby.Place;
import fr.free.nrw.commons.recentlanguages.RecentLanguagesDao;
import fr.free.nrw.commons.settings.Prefs;
import fr.free.nrw.commons.upload.ImageCoordinates;
import fr.free.nrw.commons.upload.SimilarImageDialogFragment;
import fr.free.nrw.commons.upload.UploadActivity;
import fr.free.nrw.commons.upload.UploadBaseFragment;
import fr.free.nrw.commons.upload.UploadItem;
import fr.free.nrw.commons.upload.UploadMediaDetail;
import fr.free.nrw.commons.upload.UploadMediaDetailAdapter;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.ImageUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import java.io.File;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import java.util.Objects;
import javax.inject.Inject;
import javax.inject.Named;
import org.apache.commons.lang3.StringUtils;
import timber.log.Timber;
import android.os.Parcelable;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L65">public class UploadMediaDetailFragment extends UploadBaseFragment implements UploadMediaDetailsContract.View, UploadMediaDetailAdapter.EventListener {</span>

    private static final int REQUEST_CODE = 1211;

    private static final int REQUEST_CODE_FOR_EDIT_ACTIVITY = 1212;

    private static final int REQUEST_CODE_FOR_VOICE_INPUT = 1213;

    /**
     * A key for applicationKvStore. By this key we can retrieve the location of last UploadItem ex.
     * 12.3433,54.78897 from applicationKvStore.
     */
    public static final String LAST_LOCATION = &quot;last_location_while_uploading&quot;;

    public static final String LAST_ZOOM = &quot;last_zoom_level_while_uploading&quot;;

    public static final String UPLOADABLE_FILE = &quot;uploadable_file&quot;;

    public static final String UPLOAD_MEDIA_DETAILS = &quot;upload_media_detail_adapter&quot;;

    @BindView(R.id.tv_title)
    TextView tvTitle;

    @BindView(R.id.location_image_view)
    ImageView locationImageView;

    @BindView(R.id.location_text_view)
    TextView locationTextView;

    @BindView(R.id.ll_location_status)
    LinearLayout llLocationStatus;

    @BindView(R.id.ib_expand_collapse)
    AppCompatImageButton ibExpandCollapse;

    @BindView(R.id.ll_container_media_detail)
    LinearLayout llContainerMediaDetail;

    @BindView(R.id.rv_descriptions)
    RecyclerView rvDescriptions;

    @BindView(R.id.backgroundImage)
    PhotoView photoViewBackgroundImage;

    @BindView(R.id.btn_next)
    AppCompatButton btnNext;

    @BindView(R.id.btn_previous)
    AppCompatButton btnPrevious;

    @BindView(R.id.ll_edit_image)
    LinearLayout llEditImage;

    @BindView(R.id.tooltip)
    ImageView tooltip;

    private UploadMediaDetailAdapter uploadMediaDetailAdapter;

    @BindView(R.id.btn_copy_subsequent_media)
    AppCompatButton btnCopyToSubsequentMedia;

    @Inject
    UploadMediaDetailsContract.UserActionListener presenter;

    @Inject
    @Named(&quot;default_preferences&quot;)
    JsonKvStore defaultKvStore;

    @Inject
    RecentLanguagesDao recentLanguagesDao;

    private UploadableFile uploadableFile;

    private Place place;

<span class="nc" id="L140">    private boolean isExpanded = true;</span>

    /**
     * True if location is added via the &quot;missing location&quot; popup dialog (which appears after
     * tapping &quot;Next&quot; if the picture has no geographical coordinates).
     */
    private boolean isMissingLocationDialog;

    /**
     * showNearbyFound will be true, if any nearby location found that needs pictures and the nearby
     * popup is yet to be shown Used to show and check if the nearby found popup is already shown
     */
    private boolean showNearbyFound;

    /**
     * nearbyPlace holds the detail of nearby place that need pictures, if any found
     */
    private Place nearbyPlace;

    private UploadItem uploadItem;

    /**
     * inAppPictureLocation: use location recorded while using the in-app camera if device camera
     * does not record it in the EXIF
     */
    private LatLng inAppPictureLocation;

    /**
     * editableUploadItem : Storing the upload item before going to update the coordinates
     */
    private UploadItem editableUploadItem;

    private UploadMediaDetailFragmentCallback callback;

    public void setCallback(UploadMediaDetailFragmentCallback callback) {
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6431)) {</span>
<span class="nc" id="L176">            this.callback = callback;</span>
        }
<span class="nc" id="L178">    }</span>

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6432)) {</span>
<span class="nc" id="L183">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6435)) {</span>
<span class="nc bnc" id="L186" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(6433) ? (savedInstanceState != null || uploadableFile == null) : (savedInstanceState != null &amp;&amp; uploadableFile == null))) {</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6434)) {</span>
<span class="nc" id="L188">                    uploadableFile = savedInstanceState.getParcelable(UPLOADABLE_FILE);</span>
                }
            }
        }
<span class="nc" id="L192">    }</span>

    public void setImageTobeUploaded(UploadableFile uploadableFile, Place place, LatLng inAppPictureLocation) {
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6436)) {</span>
<span class="nc" id="L196">            this.uploadableFile = uploadableFile;</span>
        }
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6437)) {</span>
<span class="nc" id="L199">            this.place = place;</span>
        }
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6438)) {</span>
<span class="nc" id="L202">            this.inAppPictureLocation = inAppPictureLocation;</span>
        }
<span class="nc" id="L204">    }</span>

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
<span class="nc" id="L209">        return inflater.inflate(R.layout.fragment_upload_media_detail_fragment, container, false);</span>
    }

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6439)) {</span>
<span class="nc" id="L215">            super.onViewCreated(view, savedInstanceState);</span>
        }
<span class="nc bnc" id="L217" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6440)) {</span>
<span class="nc" id="L218">            ButterKnife.bind(this, view);</span>
        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6442)) {</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            if (callback != null) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6441)) {</span>
<span class="nc" id="L223">                    init();</span>
                }
            }
        }
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6446)) {</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6445)) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                    if (uploadMediaDetailAdapter.getItems().size() == 0) {</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6443)) {</span>
<span class="nc" id="L232">                            uploadMediaDetailAdapter.setItems(savedInstanceState.getParcelableArrayList(UPLOAD_MEDIA_DETAILS));</span>
                        }
<span class="nc bnc" id="L234" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6444)) {</span>
<span class="nc" id="L235">                            presenter.setUploadMediaDetails(uploadMediaDetailAdapter.getItems(), callback.getIndexInViewFlipper(this));</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L241">    }</span>

    private void init() {
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6447)) {</span>
<span class="nc" id="L245">            tvTitle.setText(getString(R.string.step_count, callback.getIndexInViewFlipper(this) + 1, callback.getTotalNumberOfSteps(), getString(R.string.media_detail_step_title)));</span>
        }
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6448)) {</span>
<span class="nc" id="L248">            tooltip.setOnClickListener(v -&gt; showInfoAlert(R.string.media_detail_step_title, R.string.media_details_tooltip));</span>
        }
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6449)) {</span>
<span class="nc" id="L251">            initPresenter();</span>
        }
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6450)) {</span>
<span class="nc" id="L254">            presenter.receiveImage(uploadableFile, place, inAppPictureLocation);</span>
        }
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6451)) {</span>
<span class="nc" id="L257">            initRecyclerView();</span>
        }
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6456)) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (callback.getIndexInViewFlipper(this) == 0) {</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6454)) {</span>
<span class="nc" id="L262">                    btnPrevious.setEnabled(false);</span>
                }
<span class="nc bnc" id="L264" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6455)) {</span>
<span class="nc" id="L265">                    btnPrevious.setAlpha(0.5f);</span>
                }
            } else {
<span class="nc bnc" id="L268" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6452)) {</span>
<span class="nc" id="L269">                    btnPrevious.setEnabled(true);</span>
                }
<span class="nc bnc" id="L271" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6453)) {</span>
<span class="nc" id="L272">                    btnPrevious.setAlpha(1.0f);</span>
                }
            }
        }
<span class="nc bnc" id="L276" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6463)) {</span>
            // If the image EXIF data contains the location, show the map icon with a green tick
<span class="nc bnc" id="L278" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(6458) ? (inAppPictureLocation != null &amp;&amp; ((ListenerUtil.mutListener.listen(6457) ? (uploadableFile != null || uploadableFile.hasLocation()) : (uploadableFile != null &amp;&amp; uploadableFile.hasLocation())))) : (inAppPictureLocation != null || ((ListenerUtil.mutListener.listen(6457) ? (uploadableFile != null || uploadableFile.hasLocation()) : (uploadableFile != null &amp;&amp; uploadableFile.hasLocation())))))) {</span>
<span class="nc" id="L279">                Drawable mapTick = getResources().getDrawable(R.drawable.ic_map_available_20dp);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6461)) {</span>
<span class="nc" id="L281">                    locationImageView.setImageDrawable(mapTick);</span>
                }
<span class="nc bnc" id="L283" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6462)) {</span>
<span class="nc" id="L284">                    locationTextView.setText(R.string.edit_location);</span>
                }
<span class="nc" id="L286">            } else {</span>
                // Otherwise, show the map icon with a red question mark
<span class="nc" id="L288">                Drawable mapQuestionMark = getResources().getDrawable(R.drawable.ic_map_not_available_20dp);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6459)) {</span>
<span class="nc" id="L290">                    locationImageView.setImageDrawable(mapQuestionMark);</span>
                }
<span class="nc bnc" id="L292" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6460)) {</span>
<span class="nc" id="L293">                    locationTextView.setText(R.string.add_location);</span>
                }
            }
        }
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6470)) {</span>
            // If this is the last media, we have nothing to copy, lets not show the button
<span class="nc bnc" id="L299" title="All 10 branches missed.">            if (callback.getIndexInViewFlipper(this) == (ListenerUtil.mutListener.listen(6467) ? (callback.getTotalNumberOfSteps() % 4) : (ListenerUtil.mutListener.listen(6466) ? (callback.getTotalNumberOfSteps() / 4) : (ListenerUtil.mutListener.listen(6465) ? (callback.getTotalNumberOfSteps() * 4) : (ListenerUtil.mutListener.listen(6464) ? (callback.getTotalNumberOfSteps() + 4) : (callback.getTotalNumberOfSteps() - 4)))))) {</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6469)) {</span>
<span class="nc" id="L301">                    btnCopyToSubsequentMedia.setVisibility(View.GONE);</span>
                }
            } else {
<span class="nc bnc" id="L304" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6468)) {</span>
<span class="nc" id="L305">                    btnCopyToSubsequentMedia.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6471)) {</span>
<span class="nc" id="L310">            attachImageViewScaleChangeListener();</span>
        }
<span class="nc" id="L312">    }</span>

    /**
     * Attaches the scale change listener to the image view
     */
    private void attachImageViewScaleChangeListener() {
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6472)) {</span>
<span class="nc" id="L319">            photoViewBackgroundImage.setOnScaleChangeListener((scaleFactor, focusX, focusY) -&gt; {</span>
                // Whenever the uses plays with the image, lets collapse the media detail container
<span class="nc" id="L321">                expandCollapseLlMediaDetail(false);</span>
<span class="nc" id="L322">            });</span>
        }
<span class="nc" id="L324">    }</span>

    /**
     * attach the presenter with the view
     */
    private void initPresenter() {
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6473)) {</span>
<span class="nc" id="L331">            presenter.onAttachView(this);</span>
        }
<span class="nc" id="L333">    }</span>

    /**
     * init the description recycler veiw and caption recyclerview
     */
    private void initRecyclerView() {
<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6474)) {</span>
<span class="nc" id="L340">            uploadMediaDetailAdapter = new UploadMediaDetailAdapter(this, defaultKvStore.getString(Prefs.DESCRIPTION_LANGUAGE, &quot;&quot;), recentLanguagesDao);</span>
        }
<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6475)) {</span>
<span class="nc" id="L343">            uploadMediaDetailAdapter.setCallback(this::showInfoAlert);</span>
        }
<span class="nc bnc" id="L345" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6476)) {</span>
<span class="nc" id="L346">            uploadMediaDetailAdapter.setEventListener(this);</span>
        }
<span class="nc bnc" id="L348" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6477)) {</span>
<span class="nc" id="L349">            rvDescriptions.setLayoutManager(new LinearLayoutManager(getContext()));</span>
        }
<span class="nc bnc" id="L351" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6478)) {</span>
<span class="nc" id="L352">            rvDescriptions.setAdapter(uploadMediaDetailAdapter);</span>
        }
<span class="nc" id="L354">    }</span>

    /**
     * show dialog with info
     * @param titleStringID
     * @param messageStringId
     */
    private void showInfoAlert(int titleStringID, int messageStringId) {
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6479)) {</span>
<span class="nc" id="L363">            DialogUtil.showAlertDialog(getActivity(), getString(titleStringID), getString(messageStringId), getString(android.R.string.ok), null, true);</span>
        }
<span class="nc" id="L365">    }</span>

    @OnClick(R.id.btn_next)
    public void onNextButtonClicked() {
<span class="nc" id="L369">        boolean isValidUploads = presenter.verifyImageQuality(callback.getIndexInViewFlipper(this), inAppPictureLocation);</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6481)) {</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (!isValidUploads) {</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6480)) {</span>
<span class="nc" id="L373">                    startActivityWithFlags(getActivity(), MainActivity.class, Intent.FLAG_ACTIVITY_CLEAR_TOP, Intent.FLAG_ACTIVITY_SINGLE_TOP);</span>
                }
            }
        }
<span class="nc" id="L377">    }</span>

    @OnClick(R.id.btn_previous)
    public void onPreviousButtonClicked() {
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6482)) {</span>
<span class="nc" id="L382">            callback.onPreviousButtonClicked(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc" id="L384">    }</span>

    @OnClick(R.id.ll_edit_image)
    public void onEditButtonClicked() {
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6483)) {</span>
<span class="nc" id="L389">            presenter.onEditButtonClicked(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc" id="L391">    }</span>

    @Override
    public void showSimilarImageFragment(String originalFilePath, String possibleFilePath, ImageCoordinates similarImageCoordinates) {
<span class="nc" id="L395">        SimilarImageDialogFragment newFragment = new SimilarImageDialogFragment();</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6489)) {</span>
<span class="nc" id="L397">            newFragment.setCallback(new SimilarImageDialogFragment.Callback() {</span>

                @Override
                public void onPositiveResponse() {
<span class="nc bnc" id="L401" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6484)) {</span>
<span class="nc" id="L402">                        Timber.d(&quot;positive response from similar image fragment&quot;);</span>
                    }
<span class="nc bnc" id="L404" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6485)) {</span>
<span class="nc" id="L405">                        presenter.useSimilarPictureCoordinates(similarImageCoordinates, callback.getIndexInViewFlipper(UploadMediaDetailFragment.this));</span>
                    }
<span class="nc bnc" id="L407" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6486)) {</span>
                        // fixing: https://github.com/commons-app/apps-android-commons/issues/4700
<span class="nc" id="L409">                        uploadMediaDetailAdapter.getItems().get(0).setDescriptionText(getString(R.string.similar_coordinate_description_auto_set));</span>
                    }
<span class="nc bnc" id="L411" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6487)) {</span>
<span class="nc" id="L412">                        updateMediaDetails(uploadMediaDetailAdapter.getItems());</span>
                    }
<span class="nc" id="L414">                }</span>

                @Override
                public void onNegativeResponse() {
<span class="nc bnc" id="L418" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6488)) {</span>
<span class="nc" id="L419">                        Timber.d(&quot;negative response from similar image fragment&quot;);</span>
                    }
<span class="nc" id="L421">                }</span>
            });
        }
<span class="nc" id="L424">        Bundle args = new Bundle();</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6490)) {</span>
<span class="nc" id="L426">            args.putString(&quot;originalImagePath&quot;, originalFilePath);</span>
        }
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6491)) {</span>
<span class="nc" id="L429">            args.putString(&quot;possibleImagePath&quot;, possibleFilePath);</span>
        }
<span class="nc bnc" id="L431" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6492)) {</span>
<span class="nc" id="L432">            newFragment.setArguments(args);</span>
        }
<span class="nc bnc" id="L434" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6493)) {</span>
<span class="nc" id="L435">            newFragment.show(getChildFragmentManager(), &quot;dialog&quot;);</span>
        }
<span class="nc" id="L437">    }</span>

    @Override
    public void onImageProcessed(UploadItem uploadItem, Place place) {
<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6494)) {</span>
<span class="nc" id="L442">            photoViewBackgroundImage.setImageURI(uploadItem.getMediaUri());</span>
        }
<span class="nc" id="L444">    }</span>

    /**
     * Sets variables to Show popup if any nearby location needing pictures matches uploadable picture's GPS location
     * @param uploadItem
     * @param place
     */
    @Override
    public void onNearbyPlaceFound(UploadItem uploadItem, Place place) {
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6495)) {</span>
<span class="nc" id="L454">            nearbyPlace = place;</span>
        }
<span class="nc bnc" id="L456" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6496)) {</span>
<span class="nc" id="L457">            this.uploadItem = uploadItem;</span>
        }
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6497)) {</span>
<span class="nc" id="L460">            showNearbyFound = true;</span>
        }
<span class="nc bnc" id="L462" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6503)) {</span>
<span class="nc bnc" id="L463" title="All 2 branches missed.">            if (callback.getIndexInViewFlipper(this) == 0) {</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6501)) {</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">                    if (UploadActivity.nearbyPopupAnswers.containsKey(nearbyPlace)) {</span>
<span class="nc" id="L466">                        final boolean response = UploadActivity.nearbyPopupAnswers.get(nearbyPlace);</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6500)) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">                            if (response) {</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6499)) {</span>
<span class="nc" id="L470">                                    presenter.onUserConfirmedUploadIsOfPlace(nearbyPlace, callback.getIndexInViewFlipper(this));</span>
                                }
                            }
                        }
<span class="nc" id="L474">                    } else {</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6498)) {</span>
<span class="nc" id="L476">                            showNearbyPlaceFound(nearbyPlace);</span>
                        }
                    }
                }
<span class="nc bnc" id="L480" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6502)) {</span>
<span class="nc" id="L481">                    showNearbyFound = false;</span>
                }
            }
        }
<span class="nc" id="L485">    }</span>

    /**
     * Shows nearby place found popup
     * @param place
     */
    @SuppressLint(&quot;StringFormatInvalid&quot;)
    private // To avoid the unwanted lint warning that string 'upload_nearby_place_found_description' is not of a valid format
    void showNearbyPlaceFound(Place place) {
<span class="nc" id="L494">        final View customLayout = getLayoutInflater().inflate(R.layout.custom_nearby_found, null);</span>
<span class="nc" id="L495">        ImageView nearbyFoundImage = customLayout.findViewById(R.id.nearbyItemImage);</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6504)) {</span>
<span class="nc" id="L497">            nearbyFoundImage.setImageURI(uploadItem.getMediaUri());</span>
        }
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6505)) {</span>
<span class="nc" id="L500">            DialogUtil.showAlertDialog(getActivity(), getString(R.string.upload_nearby_place_found_title), String.format(Locale.getDefault(), getString(R.string.upload_nearby_place_found_description), place.getName()), () -&gt; {</span>
<span class="nc" id="L501">                UploadActivity.nearbyPopupAnswers.put(place, true);</span>
<span class="nc" id="L502">                presenter.onUserConfirmedUploadIsOfPlace(place, callback.getIndexInViewFlipper(this));</span>
<span class="nc" id="L503">            }, () -&gt; {</span>
<span class="nc" id="L504">                UploadActivity.nearbyPopupAnswers.put(place, false);</span>
<span class="nc" id="L505">            }, customLayout, true);</span>
        }
<span class="nc" id="L507">    }</span>

    @Override
    public void showProgress(boolean shouldShow) {
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6506)) {</span>
<span class="nc" id="L512">            callback.showProgress(shouldShow);</span>
        }
<span class="nc" id="L514">    }</span>

    @Override
    public void onImageValidationSuccess() {
<span class="nc bnc" id="L518" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6507)) {</span>
<span class="nc" id="L519">            callback.onNextButtonClicked(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc" id="L521">    }</span>

    /**
     * This method gets called whenever the next/previous button is pressed
     */
    @Override
    protected void onBecameVisible() {
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6508)) {</span>
<span class="nc" id="L529">            super.onBecameVisible();</span>
        }
<span class="nc bnc" id="L531" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6509)) {</span>
<span class="nc" id="L532">            presenter.fetchTitleAndDescription(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc bnc" id="L534" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6515)) {</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">            if (showNearbyFound) {</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6513)) {</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">                    if (UploadActivity.nearbyPopupAnswers.containsKey(nearbyPlace)) {</span>
<span class="nc" id="L538">                        final boolean response = UploadActivity.nearbyPopupAnswers.get(nearbyPlace);</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6512)) {</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">                            if (response) {</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6511)) {</span>
<span class="nc" id="L542">                                    presenter.onUserConfirmedUploadIsOfPlace(nearbyPlace, callback.getIndexInViewFlipper(this));</span>
                                }
                            }
                        }
<span class="nc" id="L546">                    } else {</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6510)) {</span>
<span class="nc" id="L548">                            showNearbyPlaceFound(nearbyPlace);</span>
                        }
                    }
                }
<span class="nc bnc" id="L552" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6514)) {</span>
<span class="nc" id="L553">                    showNearbyFound = false;</span>
                }
            }
        }
<span class="nc" id="L557">    }</span>

    @Override
    public void showMessage(int stringResourceId, int colorResourceId) {
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6516)) {</span>
<span class="nc" id="L562">            ViewUtil.showLongToast(getContext(), stringResourceId);</span>
        }
<span class="nc" id="L564">    }</span>

    @Override
    public void showMessage(String message, int colorResourceId) {
<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6517)) {</span>
<span class="nc" id="L569">            ViewUtil.showLongToast(getContext(), message);</span>
        }
<span class="nc" id="L571">    }</span>

    @Override
    public void showDuplicatePicturePopup(UploadItem uploadItem) {
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6522)) {</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">            if (defaultKvStore.getBoolean(&quot;showDuplicatePicturePopup&quot;, true)) {</span>
<span class="nc" id="L577">                String uploadTitleFormat = getString(R.string.upload_title_duplicate);</span>
<span class="nc" id="L578">                View checkBoxView = View.inflate(getActivity(), R.layout.nearby_permission_dialog, null);</span>
<span class="nc" id="L579">                CheckBox checkBox = (CheckBox) checkBoxView.findViewById(R.id.never_ask_again);</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6520)) {</span>
<span class="nc" id="L581">                    checkBox.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">                        if (isChecked) {</span>
<span class="nc" id="L583">                            defaultKvStore.putBoolean(&quot;showDuplicatePicturePopup&quot;, false);</span>
                        }
<span class="nc" id="L585">                    });</span>
                }
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6521)) {</span>
<span class="nc" id="L588">                    DialogUtil.showAlertDialog(getActivity(), getString(R.string.duplicate_file_name), String.format(Locale.getDefault(), uploadTitleFormat, uploadItem.getFileName()), getString(R.string.upload), getString(R.string.cancel), () -&gt; {</span>
<span class="nc" id="L589">                        uploadItem.setImageQuality(ImageUtils.IMAGE_KEEP);</span>
<span class="nc" id="L590">                        onImageValidationSuccess();</span>
<span class="nc" id="L591">                    }, null, checkBoxView, false);</span>
                }
<span class="nc" id="L593">            } else {</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6518)) {</span>
<span class="nc" id="L595">                    uploadItem.setImageQuality(ImageUtils.IMAGE_KEEP);</span>
                }
<span class="nc bnc" id="L597" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6519)) {</span>
<span class="nc" id="L598">                    onNextButtonClicked();</span>
                }
            }
        }
<span class="nc" id="L602">    }</span>

    @Override
    public void showBadImagePopup(Integer errorCode, UploadItem uploadItem) {
<span class="nc" id="L606">        String errorMessageForResult = getErrorMessageForResult(getContext(), errorCode);</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6524)) {</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">            if (!StringUtils.isBlank(errorMessageForResult)) {</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6523)) {</span>
<span class="nc" id="L610">                    DialogUtil.showAlertDialog(getActivity(), getString(R.string.upload_problem_image), errorMessageForResult, getString(R.string.upload), getString(R.string.cancel), () -&gt; {</span>
                        // show the same file name error if exists.
<span class="nc bnc" id="L612" title="All 2 branches missed.">                        if ((errorCode &amp; FILE_NAME_EXISTS) == 0) {</span>
<span class="nc" id="L613">                            uploadItem.setImageQuality(ImageUtils.IMAGE_KEEP);</span>
<span class="nc" id="L614">                            onImageValidationSuccess();</span>
                        }
<span class="nc" id="L616">                    }, () -&gt; deleteThisPicture());</span>
                }
            }
        }
<span class="nc" id="L620">    }</span>

    @Override
    public void showConnectionErrorPopup() {
<span class="nc bnc" id="L624" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6525)) {</span>
<span class="nc" id="L625">            DialogUtil.showAlertDialog(getActivity(), getString(R.string.upload_connection_error_alert_title), getString(R.string.upload_connection_error_alert_detail), getString(R.string.ok), () -&gt; {</span>
<span class="nc" id="L626">            }, true);</span>
        }
<span class="nc" id="L628">    }</span>

    @Override
    public void showExternalMap(final UploadItem uploadItem) {
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6526)) {</span>
<span class="nc" id="L633">            goToLocationPickerActivity(uploadItem);</span>
        }
<span class="nc" id="L635">    }</span>

    /**
     * Launches the image editing activity to edit the specified UploadItem.
     *
     * @param uploadItem The UploadItem to be edited.
     *
     * This method is called to start the image editing activity for a specific UploadItem.
     * It sets the UploadItem as the currently editable item, creates an intent to launch the
     * EditActivity, and passes the image file path as an extra in the intent. The activity
     * is started with a request code, allowing the result to be handled in onActivityResult.
     */
    @Override
    public void showEditActivity(UploadItem uploadItem) {
<span class="nc bnc" id="L649" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6527)) {</span>
<span class="nc" id="L650">            editableUploadItem = uploadItem;</span>
        }
<span class="nc" id="L652">        Intent intent = new Intent(getContext(), EditActivity.class);</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6528)) {</span>
<span class="nc" id="L654">            intent.putExtra(&quot;image&quot;, uploadableFile.getFilePath().toString());</span>
        }
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6529)) {</span>
<span class="nc" id="L657">            startActivityForResult(intent, REQUEST_CODE_FOR_EDIT_ACTIVITY);</span>
        }
<span class="nc" id="L659">    }</span>

    /**
     * Start Location picker activity. Show the location first then user can modify it by clicking
     * modify location button.
     * @param uploadItem current upload item
     */
    private void goToLocationPickerActivity(final UploadItem uploadItem) {
<span class="nc bnc" id="L667" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6530)) {</span>
<span class="nc" id="L668">            editableUploadItem = uploadItem;</span>
        }
<span class="nc" id="L670">        double defaultLatitude = 37.773972;</span>
<span class="nc" id="L671">        double defaultLongitude = -122.431297;</span>
<span class="nc" id="L672">        double defaultZoom = 16.0;</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6543)) {</span>
            /* Retrieve image location from EXIF if present or
           check if user has provided location while using the in-app camera.
           Use location of last UploadItem if none of them is available */
<span class="nc bnc" id="L677" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(6532) ? ((ListenerUtil.mutListener.listen(6531) ? (uploadItem.getGpsCoords() != null || uploadItem.getGpsCoords().getDecLatitude() != 0.0) : (uploadItem.getGpsCoords() != null &amp;&amp; uploadItem.getGpsCoords().getDecLatitude() != 0.0)) || uploadItem.getGpsCoords().getDecLongitude() != 0.0) : ((ListenerUtil.mutListener.listen(6531) ? (uploadItem.getGpsCoords() != null || uploadItem.getGpsCoords().getDecLatitude() != 0.0) : (uploadItem.getGpsCoords() != null &amp;&amp; uploadItem.getGpsCoords().getDecLatitude() != 0.0)) &amp;&amp; uploadItem.getGpsCoords().getDecLongitude() != 0.0))) {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6539)) {</span>
<span class="nc" id="L679">                    defaultLatitude = uploadItem.getGpsCoords().getDecLatitude();</span>
                }
<span class="nc bnc" id="L681" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6540)) {</span>
<span class="nc" id="L682">                    defaultLongitude = uploadItem.getGpsCoords().getDecLongitude();</span>
                }
<span class="nc bnc" id="L684" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6541)) {</span>
<span class="nc" id="L685">                    defaultZoom = uploadItem.getGpsCoords().getZoomLevel();</span>
                }
<span class="nc bnc" id="L687" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6542)) {</span>
<span class="nc" id="L688">                    startActivityForResult(new LocationPicker.IntentBuilder().defaultLocation(new CameraPosition.Builder().target(new com.mapbox.mapboxsdk.geometry.LatLng(defaultLatitude, defaultLongitude)).zoom(defaultZoom).build()).activityKey(&quot;UploadActivity&quot;).build(getActivity()), REQUEST_CODE);</span>
                }
            } else {
<span class="nc bnc" id="L691" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6535)) {</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">                    if (defaultKvStore.getString(LAST_LOCATION) != null) {</span>
<span class="nc" id="L693">                        final String[] locationLatLng = defaultKvStore.getString(LAST_LOCATION).split(&quot;,&quot;);</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6533)) {</span>
<span class="nc" id="L695">                            defaultLatitude = Double.parseDouble(locationLatLng[0]);</span>
                        }
<span class="nc bnc" id="L697" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6534)) {</span>
<span class="nc" id="L698">                            defaultLongitude = Double.parseDouble(locationLatLng[1]);</span>
                        }
                    }
                }
<span class="nc bnc" id="L702" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6537)) {</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                    if (defaultKvStore.getString(LAST_ZOOM) != null) {</span>
<span class="nc bnc" id="L704" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6536)) {</span>
<span class="nc" id="L705">                            defaultZoom = Double.parseDouble(defaultKvStore.getString(LAST_ZOOM));</span>
                        }
                    }
                }
<span class="nc bnc" id="L709" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6538)) {</span>
<span class="nc" id="L710">                    startActivityForResult(new LocationPicker.IntentBuilder().defaultLocation(new CameraPosition.Builder().target(new com.mapbox.mapboxsdk.geometry.LatLng(defaultLatitude, defaultLongitude)).zoom(defaultZoom).build()).activityKey(&quot;NoLocationUploadActivity&quot;).build(getActivity()), REQUEST_CODE);</span>
                }
            }
        }
<span class="nc" id="L714">    }</span>

    /**
     * Get the coordinates and update the existing coordinates.
     * @param requestCode code of request
     * @param resultCode code of result
     * @param data intent
     */
    @Override
    public void onActivityResult(final int requestCode, final int resultCode, @Nullable final Intent data) {
<span class="nc bnc" id="L724" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6544)) {</span>
<span class="nc" id="L725">            super.onActivityResult(requestCode, resultCode, data);</span>
        }
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6556)) {</span>
<span class="nc bnc" id="L728" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(6550) ? ((ListenerUtil.mutListener.listen(6549) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(6548) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(6547) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(6546) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(6545) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(6549) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(6548) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(6547) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(6546) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(6545) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">                assert data != null;</span>
<span class="nc" id="L730">                final CameraPosition cameraPosition = LocationPicker.getCameraPosition(data);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6555)) {</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">                    if (cameraPosition != null) {</span>
<span class="nc" id="L733">                        final String latitude = String.valueOf(cameraPosition.target.getLatitude());</span>
<span class="nc" id="L734">                        final String longitude = String.valueOf(cameraPosition.target.getLongitude());</span>
<span class="nc" id="L735">                        final double zoom = cameraPosition.zoom;</span>
<span class="nc bnc" id="L736" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6551)) {</span>
<span class="nc" id="L737">                            editLocation(latitude, longitude, zoom);</span>
                        }
<span class="nc bnc" id="L739" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6554)) {</span>
                            /*
                       If isMissingLocationDialog is true, it means that the user has already tapped the
                       &quot;Next&quot; button, so go directly to the next step.
                 */
<span class="nc bnc" id="L744" title="All 2 branches missed.">                            if (isMissingLocationDialog) {</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6552)) {</span>
<span class="nc" id="L746">                                    isMissingLocationDialog = false;</span>
                                }
<span class="nc bnc" id="L748" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6553)) {</span>
<span class="nc" id="L749">                                    onNextButtonClicked();</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L757" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6578)) {</span>
<span class="nc bnc" id="L758" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(6562) ? ((ListenerUtil.mutListener.listen(6561) ? (requestCode &gt;= REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6560) ? (requestCode &lt;= REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6559) ? (requestCode &gt; REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6558) ? (requestCode &lt; REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6557) ? (requestCode != REQUEST_CODE_FOR_EDIT_ACTIVITY) : (requestCode == REQUEST_CODE_FOR_EDIT_ACTIVITY)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(6561) ? (requestCode &gt;= REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6560) ? (requestCode &lt;= REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6559) ? (requestCode &gt; REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6558) ? (requestCode &lt; REQUEST_CODE_FOR_EDIT_ACTIVITY) : (ListenerUtil.mutListener.listen(6557) ? (requestCode != REQUEST_CODE_FOR_EDIT_ACTIVITY) : (requestCode == REQUEST_CODE_FOR_EDIT_ACTIVITY)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc" id="L759">                String result = data.getStringExtra(&quot;editedImageFilePath&quot;);</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6573)) {</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">                    if (Objects.equals(result, &quot;Error&quot;)) {</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6572)) {</span>
<span class="nc" id="L763">                            Timber.e(&quot;Error in rotating image&quot;);</span>
                        }
<span class="nc" id="L765">                        return;</span>
                    }
                }
                try {
<span class="nc bnc" id="L769" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6575)) {</span>
<span class="nc" id="L770">                        photoViewBackgroundImage.setImageURI(Uri.fromFile(new File(result)));</span>
                    }
<span class="nc bnc" id="L772" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6576)) {</span>
<span class="nc" id="L773">                        editableUploadItem.setContentUri(Uri.fromFile(new File(result)));</span>
                    }
<span class="nc bnc" id="L775" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6577)) {</span>
<span class="nc" id="L776">                        callback.changeThumbnail(callback.getIndexInViewFlipper(this), result);</span>
                    }
<span class="nc" id="L778">                } catch (Exception e) {</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6574)) {</span>
<span class="nc" id="L780">                        Timber.e(e);</span>
                    }
<span class="nc" id="L782">                }</span>
<span class="nc bnc" id="L783" title="All 22 branches missed.">            } else if ((ListenerUtil.mutListener.listen(6567) ? (requestCode &gt;= REQUEST_CODE_FOR_VOICE_INPUT) : (ListenerUtil.mutListener.listen(6566) ? (requestCode &lt;= REQUEST_CODE_FOR_VOICE_INPUT) : (ListenerUtil.mutListener.listen(6565) ? (requestCode &gt; REQUEST_CODE_FOR_VOICE_INPUT) : (ListenerUtil.mutListener.listen(6564) ? (requestCode &lt; REQUEST_CODE_FOR_VOICE_INPUT) : (ListenerUtil.mutListener.listen(6563) ? (requestCode != REQUEST_CODE_FOR_VOICE_INPUT) : (requestCode == REQUEST_CODE_FOR_VOICE_INPUT))))))) {</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6571)) {</span>
<span class="nc bnc" id="L785" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(6568) ? (resultCode == RESULT_OK || data != null) : (resultCode == RESULT_OK &amp;&amp; data != null))) {</span>
<span class="nc" id="L786">                        ArrayList&lt;String&gt; result = data.getStringArrayListExtra(RecognizerIntent.EXTRA_RESULTS);</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6570)) {</span>
<span class="nc" id="L788">                            uploadMediaDetailAdapter.handleSpeechResult(result.get(0));</span>
                        }
<span class="nc" id="L790">                    } else {</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6569)) {</span>
<span class="nc" id="L792">                            Timber.e(&quot;Error %s&quot;, resultCode);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L798">    }</span>

    /**
     * Update the old coordinates with new one
     * @param latitude new latitude
     * @param longitude new longitude
     */
    public void editLocation(final String latitude, final String longitude, final double zoom) {
<span class="nc bnc" id="L806" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6579)) {</span>
<span class="nc" id="L807">            editableUploadItem.getGpsCoords().setDecLatitude(Double.parseDouble(latitude));</span>
        }
<span class="nc bnc" id="L809" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6580)) {</span>
<span class="nc" id="L810">            editableUploadItem.getGpsCoords().setDecLongitude(Double.parseDouble(longitude));</span>
        }
<span class="nc bnc" id="L812" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6581)) {</span>
<span class="nc" id="L813">            editableUploadItem.getGpsCoords().setDecimalCoords(latitude + &quot;|&quot; + longitude);</span>
        }
<span class="nc bnc" id="L815" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6582)) {</span>
<span class="nc" id="L816">            editableUploadItem.getGpsCoords().setImageCoordsExists(true);</span>
        }
<span class="nc bnc" id="L818" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6583)) {</span>
<span class="nc" id="L819">            editableUploadItem.getGpsCoords().setZoomLevel(zoom);</span>
        }
        // Replace the map icon using the one with a green tick
<span class="nc" id="L822">        Drawable mapTick = getResources().getDrawable(R.drawable.ic_map_available_20dp);</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6584)) {</span>
<span class="nc" id="L824">            locationImageView.setImageDrawable(mapTick);</span>
        }
<span class="nc bnc" id="L826" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6585)) {</span>
<span class="nc" id="L827">            locationTextView.setText(R.string.edit_location);</span>
        }
<span class="nc bnc" id="L829" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6586)) {</span>
<span class="nc" id="L830">            Toast.makeText(getContext(), &quot;Location Updated&quot;, Toast.LENGTH_LONG).show();</span>
        }
<span class="nc" id="L832">    }</span>

    @Override
    public void updateMediaDetails(List&lt;UploadMediaDetail&gt; uploadMediaDetails) {
<span class="nc bnc" id="L836" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6587)) {</span>
<span class="nc" id="L837">            uploadMediaDetailAdapter.setItems(uploadMediaDetails);</span>
        }
<span class="nc bnc" id="L839" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6591)) {</span>
<span class="nc bnc" id="L840" title="All 58 branches missed.">            showNearbyFound = (ListenerUtil.mutListener.listen(6590) ? (showNearbyFound || ((ListenerUtil.mutListener.listen(6589) ? ((ListenerUtil.mutListener.listen(6588) ? (uploadMediaDetails == null &amp;&amp; uploadMediaDetails.isEmpty()) : (uploadMediaDetails == null || uploadMediaDetails.isEmpty())) &amp;&amp; listContainsEmptyDetails(uploadMediaDetails)) : ((ListenerUtil.mutListener.listen(6588) ? (uploadMediaDetails == null &amp;&amp; uploadMediaDetails.isEmpty()) : (uploadMediaDetails == null || uploadMediaDetails.isEmpty())) || listContainsEmptyDetails(uploadMediaDetails))))) : (showNearbyFound &amp;&amp; ((ListenerUtil.mutListener.listen(6589) ? ((ListenerUtil.mutListener.listen(6588) ? (uploadMediaDetails == null &amp;&amp; uploadMediaDetails.isEmpty()) : (uploadMediaDetails == null || uploadMediaDetails.isEmpty())) &amp;&amp; listContainsEmptyDetails(uploadMediaDetails)) : ((ListenerUtil.mutListener.listen(6588) ? (uploadMediaDetails == null &amp;&amp; uploadMediaDetails.isEmpty()) : (uploadMediaDetails == null || uploadMediaDetails.isEmpty())) || listContainsEmptyDetails(uploadMediaDetails))))));</span>
        }
<span class="nc" id="L842">    }</span>

    /**
     * if the media details that come in here are empty
     * (empty caption AND empty description, with caption being the decider here)
     * this method allows usage of nearby place caption and description if any
     * else it takes the media details saved in prior for this picture
     * @param uploadMediaDetails saved media details,
     *                           ex: in case when &quot;copy to subsequent media&quot; button is clicked
     *                           for a previous image
     * @return boolean whether the details are empty or not
     */
    private boolean listContainsEmptyDetails(List&lt;UploadMediaDetail&gt; uploadMediaDetails) {
<span class="nc bnc" id="L855" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6594)) {</span>
            {
<span class="nc" id="L857">                long _loopCounter101 = 0;</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">                for (UploadMediaDetail uploadDetail : uploadMediaDetails) {</span>
<span class="nc" id="L859">                    ListenerUtil.loopListener.listen(&quot;_loopCounter101&quot;, ++_loopCounter101);</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6593)) {</span>
<span class="nc bnc" id="L861" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(6592) ? (!TextUtils.isEmpty(uploadDetail.getCaptionText()) || !TextUtils.isEmpty(uploadDetail.getDescriptionText())) : (!TextUtils.isEmpty(uploadDetail.getCaptionText()) &amp;&amp; !TextUtils.isEmpty(uploadDetail.getDescriptionText())))) {</span>
<span class="nc" id="L862">                            return false;</span>
                        }
                    }
<span class="nc" id="L865">                }</span>
            }
        }
<span class="nc" id="L868">        return true;</span>
    }

    /**
     * Showing dialog for adding location
     *
     * @param onSkipClicked proceed for verifying image quality
     */
    @Override
    public void displayAddLocationDialog(final Runnable onSkipClicked) {
<span class="nc bnc" id="L878" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6595)) {</span>
<span class="nc" id="L879">            isMissingLocationDialog = true;</span>
        }
<span class="nc bnc" id="L881" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6596)) {</span>
<span class="nc" id="L882">            DialogUtil.showAlertDialog(Objects.requireNonNull(getActivity()), getString(R.string.no_location_found_title), getString(R.string.no_location_found_message), getString(R.string.add_location), getString(R.string.skip_login), this::onIbMapClicked, onSkipClicked);</span>
        }
<span class="nc" id="L884">    }</span>

    private void deleteThisPicture() {
<span class="nc bnc" id="L887" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6597)) {</span>
<span class="nc" id="L888">            callback.deletePictureAtIndex(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc" id="L890">    }</span>

    @Override
    public void onDestroyView() {
<span class="nc bnc" id="L894" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6598)) {</span>
<span class="nc" id="L895">            super.onDestroyView();</span>
        }
<span class="nc bnc" id="L897" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6599)) {</span>
<span class="nc" id="L898">            presenter.onDetachView();</span>
        }
<span class="nc" id="L900">    }</span>

    @OnClick(R.id.ll_container_title)
    public void onLlContainerTitleClicked() {
<span class="nc bnc" id="L904" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6600)) {</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">            expandCollapseLlMediaDetail(!isExpanded);</span>
        }
<span class="nc" id="L907">    }</span>

    /**
     * show hide media detail based on
     * @param shouldExpand
     */
    private void expandCollapseLlMediaDetail(boolean shouldExpand) {
<span class="nc bnc" id="L914" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6601)) {</span>
<span class="nc bnc" id="L915" title="All 2 branches missed.">            llContainerMediaDetail.setVisibility(shouldExpand ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L917" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6602)) {</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">            isExpanded = !isExpanded;</span>
        }
<span class="nc bnc" id="L920" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6603)) {</span>
<span class="nc" id="L921">            ibExpandCollapse.setRotation(ibExpandCollapse.getRotation() + 180);</span>
        }
<span class="nc" id="L923">    }</span>

    @OnClick(R.id.ll_location_status)
    public void onIbMapClicked() {
<span class="nc bnc" id="L927" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6604)) {</span>
<span class="nc" id="L928">            presenter.onMapIconClicked(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc" id="L930">    }</span>

    @Override
    public void onPrimaryCaptionTextChange(boolean isNotEmpty) {
<span class="nc bnc" id="L934" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6605)) {</span>
<span class="nc" id="L935">            btnCopyToSubsequentMedia.setEnabled(isNotEmpty);</span>
        }
<span class="nc bnc" id="L937" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6606)) {</span>
<span class="nc" id="L938">            btnCopyToSubsequentMedia.setClickable(isNotEmpty);</span>
        }
<span class="nc bnc" id="L940" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6607)) {</span>
<span class="nc bnc" id="L941" title="All 2 branches missed.">            btnCopyToSubsequentMedia.setAlpha(isNotEmpty ? 1.0f : 0.5f);</span>
        }
<span class="nc bnc" id="L943" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6608)) {</span>
<span class="nc" id="L944">            btnNext.setEnabled(isNotEmpty);</span>
        }
<span class="nc bnc" id="L946" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6609)) {</span>
<span class="nc" id="L947">            btnNext.setClickable(isNotEmpty);</span>
        }
<span class="nc bnc" id="L949" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6610)) {</span>
<span class="nc bnc" id="L950" title="All 2 branches missed.">            btnNext.setAlpha(isNotEmpty ? 1.0f : 0.5f);</span>
        }
<span class="nc" id="L952">    }</span>

    /**
     * Adds new language item to RecyclerView
     */
    @Override
    public void addLanguage() {
<span class="nc" id="L959">        UploadMediaDetail uploadMediaDetail = new UploadMediaDetail();</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6611)) {</span>
            // This was manually added by the user
<span class="nc" id="L962">            uploadMediaDetail.setManuallyAdded(true);</span>
        }
<span class="nc bnc" id="L964" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6612)) {</span>
<span class="nc" id="L965">            uploadMediaDetailAdapter.addDescription(uploadMediaDetail);</span>
        }
<span class="nc bnc" id="L967" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6617)) {</span>
<span class="nc bnc" id="L968" title="All 8 branches missed.">            rvDescriptions.smoothScrollToPosition((ListenerUtil.mutListener.listen(6616) ? (uploadMediaDetailAdapter.getItemCount() % 1) : (ListenerUtil.mutListener.listen(6615) ? (uploadMediaDetailAdapter.getItemCount() / 1) : (ListenerUtil.mutListener.listen(6614) ? (uploadMediaDetailAdapter.getItemCount() * 1) : (ListenerUtil.mutListener.listen(6613) ? (uploadMediaDetailAdapter.getItemCount() + 1) : (uploadMediaDetailAdapter.getItemCount() - 1))))));</span>
        }
<span class="nc" id="L970">    }</span>

    public interface UploadMediaDetailFragmentCallback extends Callback {

        void deletePictureAtIndex(int index);

        void changeThumbnail(int index, String uri);
    }

    @OnClick(R.id.btn_copy_subsequent_media)
    public void onButtonCopyTitleDescToSubsequentMedia() {
<span class="nc bnc" id="L981" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6618)) {</span>
<span class="nc" id="L982">            presenter.copyTitleAndDescriptionToSubsequentMedia(callback.getIndexInViewFlipper(this));</span>
        }
<span class="nc bnc" id="L984" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6619)) {</span>
<span class="nc" id="L985">            Toast.makeText(getContext(), getResources().getString(R.string.copied_successfully), Toast.LENGTH_SHORT).show();</span>
        }
<span class="nc" id="L987">    }</span>

    @Override
    public void onSaveInstanceState(final Bundle outState) {
<span class="nc bnc" id="L991" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6620)) {</span>
<span class="nc" id="L992">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc bnc" id="L994" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6622)) {</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">            if (uploadableFile != null) {</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6621)) {</span>
<span class="nc" id="L997">                    outState.putParcelable(UPLOADABLE_FILE, uploadableFile);</span>
                }
            }
        }
<span class="nc bnc" id="L1001" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6624)) {</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">            if (uploadMediaDetailAdapter != null) {</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6623)) {</span>
<span class="nc" id="L1004">                    outState.putParcelableArrayList(UPLOAD_MEDIA_DETAILS, (ArrayList&lt;? extends Parcelable&gt;) uploadMediaDetailAdapter.getItems());</span>
                }
            }
        }
<span class="nc" id="L1008">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>