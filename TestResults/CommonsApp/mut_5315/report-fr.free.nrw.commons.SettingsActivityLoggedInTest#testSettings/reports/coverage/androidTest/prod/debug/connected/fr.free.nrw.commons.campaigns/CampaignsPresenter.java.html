<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CampaignsPresenter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.campaigns</a> &gt; <span class="el_source">CampaignsPresenter.java</span></div><h1>CampaignsPresenter.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.campaigns;

import android.annotation.SuppressLint;
import fr.free.nrw.commons.campaigns.models.Campaign;
import java.text.ParseException;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;
import fr.free.nrw.commons.BasePresenter;
import fr.free.nrw.commons.mwapi.OkHttpJsonApiClient;
import fr.free.nrw.commons.utils.CommonsDateUtil;
import io.reactivex.Scheduler;
import io.reactivex.Single;
import io.reactivex.SingleObserver;
import io.reactivex.disposables.Disposable;
import timber.log.Timber;
import static fr.free.nrw.commons.di.CommonsApplicationModule.IO_THREAD;
import static fr.free.nrw.commons.di.CommonsApplicationModule.MAIN_THREAD;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * The presenter for the campaigns view, fetches the campaigns from the api and informs the view on
 * success and error
 */
@Singleton
public class CampaignsPresenter implements BasePresenter&lt;ICampaignsView&gt; {

    private final OkHttpJsonApiClient okHttpJsonApiClient;

    private final Scheduler mainThreadScheduler;

    private final Scheduler ioScheduler;

    private ICampaignsView view;

    private Disposable disposable;

    private Campaign campaign;

    @Inject
<span class="fc" id="L44">    public CampaignsPresenter(OkHttpJsonApiClient okHttpJsonApiClient, @Named(IO_THREAD) Scheduler ioScheduler, @Named(MAIN_THREAD) Scheduler mainThreadScheduler) {</span>
<span class="fc" id="L45">        this.okHttpJsonApiClient = okHttpJsonApiClient;</span>
<span class="fc" id="L46">        this.mainThreadScheduler = mainThreadScheduler;</span>
<span class="fc" id="L47">        this.ioScheduler = ioScheduler;</span>
<span class="fc" id="L48">    }</span>

    @Override
    public void onAttachView(ICampaignsView view) {
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6066)) {</span>
<span class="fc" id="L53">            this.view = view;</span>
        }
<span class="fc" id="L55">    }</span>

    @Override
    public void onDetachView() {
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6067)) {</span>
<span class="nc" id="L60">            this.view = null;</span>
        }
<span class="nc bnc" id="L62" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6069)) {</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">            if (disposable != null) {</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6068)) {</span>
<span class="nc" id="L65">                    disposable.dispose();</span>
                }
            }
        }
<span class="nc" id="L69">    }</span>

    /**
     * make the api call to fetch the campaigns
     */
    @SuppressLint(&quot;CheckResult&quot;)
    public void getCampaigns() {
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6096)) {</span>
<span class="pc bpc" id="L77" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(6070) ? (view != null || okHttpJsonApiClient != null) : (view != null &amp;&amp; okHttpJsonApiClient != null))) {</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6072)) {</span>
                    // If we already have a campaign, lets not make another call
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">                    if (this.campaign != null) {</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6071)) {</span>
<span class="nc" id="L82">                            view.showCampaigns(campaign);</span>
                        }
<span class="nc" id="L84">                        return;</span>
                    }
                }
<span class="fc" id="L87">                Single&lt;CampaignResponseDTO&gt; campaigns = okHttpJsonApiClient.getCampaigns();</span>
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6095)) {</span>
<span class="fc" id="L89">                    campaigns.observeOn(mainThreadScheduler).subscribeOn(ioScheduler).subscribeWith(new SingleObserver&lt;CampaignResponseDTO&gt;() {</span>

                        @Override
                        public void onSubscribe(Disposable d) {
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6073)) {</span>
<span class="fc" id="L94">                                disposable = d;</span>
                            }
<span class="fc" id="L96">                        }</span>

                        @Override
                        public void onSuccess(CampaignResponseDTO campaignResponseDTO) {
<span class="fc" id="L100">                            List&lt;Campaign&gt; campaigns = campaignResponseDTO.getCampaigns();</span>
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6077)) {</span>
<span class="pc bpc" id="L102" title="7 of 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(6074) ? (campaigns == null &amp;&amp; campaigns.isEmpty()) : (campaigns == null || campaigns.isEmpty()))) {</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(6075)) {</span>
<span class="nc" id="L104">                                        Timber.e(&quot;The campaigns list is empty&quot;);</span>
                                    }
<span class="nc bnc" id="L106" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(6076)) {</span>
<span class="nc" id="L107">                                        view.showCampaigns(null);</span>
                                    }
<span class="nc" id="L109">                                    return;</span>
                                }
                            }
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6078)) {</span>
<span class="fc" id="L113">                                Collections.sort(campaigns, (campaign, t1) -&gt; {</span>
                                    Date date1, date2;
                                    try {
<span class="fc" id="L116">                                        date1 = CommonsDateUtil.getIso8601DateFormatShort().parse(campaign.getStartDate());</span>
<span class="fc" id="L117">                                        date2 = CommonsDateUtil.getIso8601DateFormatShort().parse(t1.getStartDate());</span>
<span class="nc" id="L118">                                    } catch (ParseException e) {</span>
<span class="nc" id="L119">                                        e.printStackTrace();</span>
<span class="nc" id="L120">                                        return -1;</span>
<span class="fc" id="L121">                                    }</span>
<span class="fc" id="L122">                                    return date1.compareTo(date2);</span>
                                });
                            }
                            Date campaignEndDate, campaignStartDate;
<span class="fc" id="L126">                            Date currentDate = new Date();</span>
                            try {
                                {
<span class="fc" id="L129">                                    long _loopCounter91 = 0;</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">                                    for (Campaign aCampaign : campaigns) {</span>
<span class="fc" id="L131">                                        ListenerUtil.loopListener.listen(&quot;_loopCounter91&quot;, ++_loopCounter91);</span>
<span class="fc" id="L132">                                        campaignEndDate = CommonsDateUtil.getIso8601DateFormatShort().parse(aCampaign.getEndDate());</span>
<span class="fc" id="L133">                                        campaignStartDate = CommonsDateUtil.getIso8601DateFormatShort().parse(aCampaign.getStartDate());</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(6092)) {</span>
<span class="pc bpc" id="L135" title="76 of 90 branches missed.">                                            if ((ListenerUtil.mutListener.listen(6090) ? ((ListenerUtil.mutListener.listen(6084) ? (campaignEndDate.compareTo(currentDate) &lt;= 0) : (ListenerUtil.mutListener.listen(6083) ? (campaignEndDate.compareTo(currentDate) &gt; 0) : (ListenerUtil.mutListener.listen(6082) ? (campaignEndDate.compareTo(currentDate) &lt; 0) : (ListenerUtil.mutListener.listen(6081) ? (campaignEndDate.compareTo(currentDate) != 0) : (ListenerUtil.mutListener.listen(6080) ? (campaignEndDate.compareTo(currentDate) == 0) : (campaignEndDate.compareTo(currentDate) &gt;= 0)))))) || (ListenerUtil.mutListener.listen(6089) ? (campaignStartDate.compareTo(currentDate) &gt;= 0) : (ListenerUtil.mutListener.listen(6088) ? (campaignStartDate.compareTo(currentDate) &gt; 0) : (ListenerUtil.mutListener.listen(6087) ? (campaignStartDate.compareTo(currentDate) &lt; 0) : (ListenerUtil.mutListener.listen(6086) ? (campaignStartDate.compareTo(currentDate) != 0) : (ListenerUtil.mutListener.listen(6085) ? (campaignStartDate.compareTo(currentDate) == 0) : (campaignStartDate.compareTo(currentDate) &lt;= 0))))))) : ((ListenerUtil.mutListener.listen(6084) ? (campaignEndDate.compareTo(currentDate) &lt;= 0) : (ListenerUtil.mutListener.listen(6083) ? (campaignEndDate.compareTo(currentDate) &gt; 0) : (ListenerUtil.mutListener.listen(6082) ? (campaignEndDate.compareTo(currentDate) &lt; 0) : (ListenerUtil.mutListener.listen(6081) ? (campaignEndDate.compareTo(currentDate) != 0) : (ListenerUtil.mutListener.listen(6080) ? (campaignEndDate.compareTo(currentDate) == 0) : (campaignEndDate.compareTo(currentDate) &gt;= 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(6089) ? (campaignStartDate.compareTo(currentDate) &gt;= 0) : (ListenerUtil.mutListener.listen(6088) ? (campaignStartDate.compareTo(currentDate) &gt; 0) : (ListenerUtil.mutListener.listen(6087) ? (campaignStartDate.compareTo(currentDate) &lt; 0) : (ListenerUtil.mutListener.listen(6086) ? (campaignStartDate.compareTo(currentDate) != 0) : (ListenerUtil.mutListener.listen(6085) ? (campaignStartDate.compareTo(currentDate) == 0) : (campaignStartDate.compareTo(currentDate) &lt;= 0))))))))) {</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6091)) {</span>
<span class="fc" id="L137">                                                    campaign = aCampaign;</span>
                                                }
                                                break;
                                            }
                                        }
<span class="fc" id="L142">                                    }</span>
                                }
<span class="nc" id="L144">                            } catch (ParseException e) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6079)) {</span>
<span class="nc" id="L146">                                    e.printStackTrace();</span>
                                }
<span class="fc" id="L148">                            }</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6093)) {</span>
<span class="fc" id="L150">                                view.showCampaigns(campaign);</span>
                            }
<span class="fc" id="L152">                        }</span>

                        @Override
                        public void onError(Throwable e) {
<span class="nc bnc" id="L156" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6094)) {</span>
<span class="nc" id="L157">                                Timber.e(e, &quot;could not fetch campaigns&quot;);</span>
                            }
<span class="nc" id="L159">                        }</span>
                    });
                }
            }
        }
<span class="fc" id="L164">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>