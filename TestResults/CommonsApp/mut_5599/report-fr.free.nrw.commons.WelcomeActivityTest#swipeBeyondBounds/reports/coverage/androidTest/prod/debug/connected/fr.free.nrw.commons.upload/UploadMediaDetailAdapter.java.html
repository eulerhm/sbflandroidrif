<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadMediaDetailAdapter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.upload</a> &gt; <span class="el_source">UploadMediaDetailAdapter.java</span></div><h1>UploadMediaDetailAdapter.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.upload;

import android.app.Activity;
import android.app.Dialog;
import android.content.Intent;
import android.speech.RecognizerIntent;
import android.text.Editable;
import android.text.InputFilter;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.EditText;
import android.widget.FrameLayout;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.constraintlayout.widget.ConstraintLayout;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.RecyclerView;
import butterknife.BindView;
import butterknife.ButterKnife;
import com.google.android.material.textfield.TextInputLayout;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.recentlanguages.Language;
import fr.free.nrw.commons.recentlanguages.RecentLanguagesAdapter;
import fr.free.nrw.commons.recentlanguages.RecentLanguagesDao;
import fr.free.nrw.commons.ui.PasteSensitiveTextInputEditText;
import fr.free.nrw.commons.utils.AbstractTextWatcher;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Objects;
import java.util.regex.Pattern;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class UploadMediaDetailAdapter extends RecyclerView.Adapter&lt;UploadMediaDetailAdapter.ViewHolder&gt; {

    RecentLanguagesDao recentLanguagesDao;

    private List&lt;UploadMediaDetail&gt; uploadMediaDetails;

    private Callback callback;

    private EventListener eventListener;

    private HashMap&lt;Integer, String&gt; selectedLanguages;

    private final String savedLanguageValue;

    private TextView recentLanguagesTextView;

    private View separator;

    private ListView languageHistoryListView;

    private int currentPosition;

    private Fragment fragment;

    private Activity activity;

    private SelectedVoiceIcon selectedVoiceIcon;

    private static final int REQUEST_CODE_FOR_VOICE_INPUT = 1213;

<span class="nc" id="L75">    public UploadMediaDetailAdapter(Fragment fragment, String savedLanguageValue, RecentLanguagesDao recentLanguagesDao) {</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7319)) {</span>
<span class="nc" id="L77">            uploadMediaDetails = new ArrayList&lt;&gt;();</span>
        }
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7320)) {</span>
<span class="nc" id="L80">            selectedLanguages = new HashMap&lt;&gt;();</span>
        }
<span class="nc" id="L82">        this.savedLanguageValue = savedLanguageValue;</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7321)) {</span>
<span class="nc" id="L84">            this.recentLanguagesDao = recentLanguagesDao;</span>
        }
<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7322)) {</span>
<span class="nc" id="L87">            this.fragment = fragment;</span>
        }
<span class="nc" id="L89">    }</span>

<span class="nc" id="L91">    public UploadMediaDetailAdapter(Activity activity, final String savedLanguageValue, List&lt;UploadMediaDetail&gt; uploadMediaDetails, RecentLanguagesDao recentLanguagesDao) {</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7323)) {</span>
<span class="nc" id="L93">            this.uploadMediaDetails = uploadMediaDetails;</span>
        }
<span class="nc bnc" id="L95" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7324)) {</span>
<span class="nc" id="L96">            selectedLanguages = new HashMap&lt;&gt;();</span>
        }
<span class="nc" id="L98">        this.savedLanguageValue = savedLanguageValue;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7325)) {</span>
<span class="nc" id="L100">            this.recentLanguagesDao = recentLanguagesDao;</span>
        }
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7326)) {</span>
<span class="nc" id="L103">            this.activity = activity;</span>
        }
<span class="nc" id="L105">    }</span>

    public void setCallback(Callback callback) {
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7327)) {</span>
<span class="nc" id="L109">            this.callback = callback;</span>
        }
<span class="nc" id="L111">    }</span>

    public void setEventListener(EventListener eventListener) {
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7328)) {</span>
<span class="nc" id="L115">            this.eventListener = eventListener;</span>
        }
<span class="nc" id="L117">    }</span>

    public void setItems(List&lt;UploadMediaDetail&gt; uploadMediaDetails) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7329)) {</span>
<span class="nc" id="L121">            this.uploadMediaDetails = uploadMediaDetails;</span>
        }
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7330)) {</span>
<span class="nc" id="L124">            selectedLanguages = new HashMap&lt;&gt;();</span>
        }
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7331)) {</span>
<span class="nc" id="L127">            notifyDataSetChanged();</span>
        }
<span class="nc" id="L129">    }</span>

    public List&lt;UploadMediaDetail&gt; getItems() {
<span class="nc" id="L132">        return uploadMediaDetails;</span>
    }

    @NonNull
    @Override
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
<span class="nc" id="L138">        return new ViewHolder(LayoutInflater.from(parent.getContext()).inflate(R.layout.row_item_description, parent, false));</span>
    }

    /**
     * This is a workaround for a known bug by android here
     * https://issuetracker.google.com/issues/37095917 makes the edit text on second and subsequent
     * fragments inside an adapter receptive to long click for copy/paste options
     *
     * @param holder the view holder
     */
    @Override
    public void onViewAttachedToWindow(@NonNull final ViewHolder holder) {
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7332)) {</span>
<span class="nc" id="L151">            super.onViewAttachedToWindow(holder);</span>
        }
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7333)) {</span>
<span class="nc" id="L154">            holder.captionItemEditText.setEnabled(false);</span>
        }
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7334)) {</span>
<span class="nc" id="L157">            holder.captionItemEditText.setEnabled(true);</span>
        }
<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7335)) {</span>
<span class="nc" id="L160">            holder.descItemEditText.setEnabled(false);</span>
        }
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7336)) {</span>
<span class="nc" id="L163">            holder.descItemEditText.setEnabled(true);</span>
        }
<span class="nc" id="L165">    }</span>

    @Override
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7337)) {</span>
<span class="nc" id="L170">            holder.bind(position);</span>
        }
<span class="nc" id="L172">    }</span>

    @Override
    public int getItemCount() {
<span class="nc" id="L176">        return uploadMediaDetails.size();</span>
    }

    public void addDescription(UploadMediaDetail uploadMediaDetail) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7338)) {</span>
<span class="nc" id="L181">            selectedLanguages.put(uploadMediaDetails.size(), &quot;en&quot;);</span>
        }
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7339)) {</span>
<span class="nc" id="L184">            this.uploadMediaDetails.add(uploadMediaDetail);</span>
        }
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7340)) {</span>
<span class="nc" id="L187">            notifyItemInserted(uploadMediaDetails.size());</span>
        }
<span class="nc" id="L189">    }</span>

    private void startSpeechInput(String locale) {
<span class="nc" id="L192">        Intent intent = new Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7341)) {</span>
<span class="nc" id="L194">            intent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, RecognizerIntent.LANGUAGE_MODEL_FREE_FORM);</span>
        }
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7342)) {</span>
<span class="nc" id="L197">            intent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, locale);</span>
        }
        try {
<span class="nc bnc" id="L200" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7346)) {</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                if (activity == null) {</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7345)) {</span>
<span class="nc" id="L203">                        fragment.startActivityForResult(intent, REQUEST_CODE_FOR_VOICE_INPUT);</span>
                    }
                } else {
<span class="nc bnc" id="L206" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7344)) {</span>
<span class="nc" id="L207">                        activity.startActivityForResult(intent, REQUEST_CODE_FOR_VOICE_INPUT);</span>
                    }
                }
            }
<span class="nc" id="L211">        } catch (Exception e) {</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7343)) {</span>
<span class="nc" id="L213">                Timber.e(e.getMessage());</span>
            }
<span class="nc" id="L215">        }</span>
<span class="nc" id="L216">    }</span>

    public void handleSpeechResult(String spokenText) {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7357)) {</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">            if (!spokenText.isEmpty()) {</span>
<span class="nc" id="L221">                String spokenTextCapitalized = spokenText.substring(0, 1).toUpperCase() + spokenText.substring(1);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7356)) {</span>
<span class="nc bnc" id="L223" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7351) ? (currentPosition &gt;= uploadMediaDetails.size()) : (ListenerUtil.mutListener.listen(7350) ? (currentPosition &lt;= uploadMediaDetails.size()) : (ListenerUtil.mutListener.listen(7349) ? (currentPosition &gt; uploadMediaDetails.size()) : (ListenerUtil.mutListener.listen(7348) ? (currentPosition != uploadMediaDetails.size()) : (ListenerUtil.mutListener.listen(7347) ? (currentPosition == uploadMediaDetails.size()) : (currentPosition &lt; uploadMediaDetails.size()))))))) {</span>
<span class="nc" id="L224">                        UploadMediaDetail uploadMediaDetail = uploadMediaDetails.get(currentPosition);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7354)) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                            if (selectedVoiceIcon == SelectedVoiceIcon.CAPTION) {</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7353)) {</span>
<span class="nc" id="L228">                                    uploadMediaDetail.setCaptionText(spokenTextCapitalized);</span>
                                }
                            } else {
<span class="nc bnc" id="L231" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7352)) {</span>
<span class="nc" id="L232">                                    uploadMediaDetail.setDescriptionText(spokenTextCapitalized);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L236" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7355)) {</span>
<span class="nc" id="L237">                            notifyItemChanged(currentPosition);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L243">    }</span>

    /**
     * Remove description based on position from the list and notifies the RecyclerView Adapter that
     * data in adapter has been removed at that particular position.
     *
     * @param uploadMediaDetail
     * @param position
     */
    public void removeDescription(final UploadMediaDetail uploadMediaDetail, final int position) {
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7358)) {</span>
<span class="nc" id="L254">            selectedLanguages.remove(position);</span>
        }
<span class="nc bnc" id="L256" title="All 2 branches missed.">        final int ListPosition = (int) selectedLanguages.keySet().stream().filter(e -&gt; e &lt; position).count();</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7359)) {</span>
<span class="nc" id="L258">            this.uploadMediaDetails.remove(uploadMediaDetails.get(ListPosition));</span>
        }
<span class="nc bnc" id="L260" title="All 8 branches missed.">        int i = (ListenerUtil.mutListener.listen(7363) ? (position % 1) : (ListenerUtil.mutListener.listen(7362) ? (position / 1) : (ListenerUtil.mutListener.listen(7361) ? (position * 1) : (ListenerUtil.mutListener.listen(7360) ? (position - 1) : (position + 1)))));</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7366)) {</span>
            {
<span class="nc" id="L263">                long _loopCounter114 = 0;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                while (selectedLanguages.containsKey(i)) {</span>
<span class="nc" id="L265">                    ListenerUtil.loopListener.listen(&quot;_loopCounter114&quot;, ++_loopCounter114);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7364)) {</span>
<span class="nc" id="L267">                        selectedLanguages.remove(i);</span>
                    }
<span class="nc bnc" id="L269" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7365)) {</span>
<span class="nc" id="L270">                        i++;</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7367)) {</span>
<span class="nc" id="L276">            notifyItemRemoved(position);</span>
        }
<span class="nc bnc" id="L278" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7372)) {</span>
<span class="nc bnc" id="L279" title="All 8 branches missed.">            notifyItemRangeChanged(position, (ListenerUtil.mutListener.listen(7371) ? (uploadMediaDetails.size() % position) : (ListenerUtil.mutListener.listen(7370) ? (uploadMediaDetails.size() / position) : (ListenerUtil.mutListener.listen(7369) ? (uploadMediaDetails.size() * position) : (ListenerUtil.mutListener.listen(7368) ? (uploadMediaDetails.size() + position) : (uploadMediaDetails.size() - position))))));</span>
        }
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7373)) {</span>
<span class="nc" id="L282">            updateAddButtonVisibility();</span>
        }
<span class="nc" id="L284">    }</span>

    public class ViewHolder extends RecyclerView.ViewHolder {

        @Nullable
        @BindView(R.id.description_languages)
        TextView descriptionLanguages;

        @BindView(R.id.description_item_edit_text)
        PasteSensitiveTextInputEditText descItemEditText;

        @BindView(R.id.description_item_edit_text_input_layout)
        TextInputLayout descInputLayout;

        @BindView(R.id.caption_item_edit_text)
        PasteSensitiveTextInputEditText captionItemEditText;

        @BindView(R.id.caption_item_edit_text_input_layout)
        TextInputLayout captionInputLayout;

        @BindView(R.id.btn_remove)
        ImageView removeButton;

        @BindView(R.id.btn_add)
        ImageView addButton;

        @BindView(R.id.cl_parent)
        ConstraintLayout clParent;

        @BindView(R.id.ll_write_better_caption)
        LinearLayout betterCaptionLinearLayout;

        @BindView(R.id.ll_write_better_description)
        LinearLayout betterDescriptionLinearLayout;

        AbstractTextWatcher captionListener;

        AbstractTextWatcher descriptionListener;

<span class="nc" id="L323">        public ViewHolder(View itemView) {</span>
<span class="nc" id="L324">            super(itemView);</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7374)) {</span>
<span class="nc" id="L326">                ButterKnife.bind(this, itemView);</span>
            }
<span class="nc bnc" id="L328" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7375)) {</span>
<span class="nc" id="L329">                Timber.i(&quot;descItemEditText:&quot; + descItemEditText);</span>
            }
<span class="nc" id="L331">        }</span>

        public void bind(int position) {
<span class="nc" id="L334">            UploadMediaDetail uploadMediaDetail = uploadMediaDetails.get(position);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7376)) {</span>
<span class="nc" id="L336">                Timber.d(&quot;UploadMediaDetail is &quot; + uploadMediaDetail);</span>
            }
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7377)) {</span>
<span class="nc" id="L339">                descriptionLanguages.setFocusable(false);</span>
            }
<span class="nc bnc" id="L341" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7378)) {</span>
<span class="nc" id="L342">                captionItemEditText.addTextChangedListener(new AbstractTextWatcher(value -&gt; {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                    if (position == 0) {</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">                        eventListener.onPrimaryCaptionTextChange(value.length() != 0);</span>
                    }
<span class="nc" id="L346">                }));</span>
            }
<span class="nc bnc" id="L348" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7379)) {</span>
<span class="nc" id="L349">                captionItemEditText.removeTextChangedListener(captionListener);</span>
            }
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7380)) {</span>
<span class="nc" id="L352">                descItemEditText.removeTextChangedListener(descriptionListener);</span>
            }
<span class="nc bnc" id="L354" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7381)) {</span>
<span class="nc" id="L355">                captionItemEditText.setText(uploadMediaDetail.getCaptionText());</span>
            }
<span class="nc bnc" id="L357" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7382)) {</span>
<span class="nc" id="L358">                descItemEditText.setText(uploadMediaDetail.getDescriptionText());</span>
            }
<span class="nc bnc" id="L360" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7383)) {</span>
<span class="nc" id="L361">                captionInputLayout.setEndIconMode(TextInputLayout.END_ICON_CUSTOM);</span>
            }
<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7384)) {</span>
<span class="nc" id="L364">                captionInputLayout.setEndIconDrawable(R.drawable.baseline_keyboard_voice);</span>
            }
<span class="nc bnc" id="L366" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7385)) {</span>
<span class="nc" id="L367">                captionInputLayout.setEndIconOnClickListener(v -&gt; {</span>
<span class="nc" id="L368">                    currentPosition = position;</span>
<span class="nc" id="L369">                    selectedVoiceIcon = SelectedVoiceIcon.CAPTION;</span>
<span class="nc" id="L370">                    startSpeechInput(descriptionLanguages.getText().toString());</span>
<span class="nc" id="L371">                });</span>
            }
<span class="nc bnc" id="L373" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7386)) {</span>
<span class="nc" id="L374">                descInputLayout.setEndIconMode(TextInputLayout.END_ICON_CUSTOM);</span>
            }
<span class="nc bnc" id="L376" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7387)) {</span>
<span class="nc" id="L377">                descInputLayout.setEndIconDrawable(R.drawable.baseline_keyboard_voice);</span>
            }
<span class="nc bnc" id="L379" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7388)) {</span>
<span class="nc" id="L380">                descInputLayout.setEndIconOnClickListener(v -&gt; {</span>
<span class="nc" id="L381">                    currentPosition = position;</span>
<span class="nc" id="L382">                    selectedVoiceIcon = SelectedVoiceIcon.DESCRIPTION;</span>
<span class="nc" id="L383">                    startSpeechInput(descriptionLanguages.getText().toString());</span>
<span class="nc" id="L384">                });</span>
            }
<span class="nc bnc" id="L386" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7403)) {</span>
<span class="nc bnc" id="L387" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(7393) ? (position &gt;= 0) : (ListenerUtil.mutListener.listen(7392) ? (position &lt;= 0) : (ListenerUtil.mutListener.listen(7391) ? (position &gt; 0) : (ListenerUtil.mutListener.listen(7390) ? (position &lt; 0) : (ListenerUtil.mutListener.listen(7389) ? (position != 0) : (position == 0))))))) {</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7397)) {</span>
<span class="nc" id="L389">                        removeButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L391" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7398)) {</span>
<span class="nc" id="L392">                        betterCaptionLinearLayout.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L394" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7399)) {</span>
<span class="nc" id="L395">                        betterCaptionLinearLayout.setOnClickListener(v -&gt; callback.showAlert(R.string.media_detail_caption, R.string.caption_info));</span>
                    }
<span class="nc bnc" id="L397" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7400)) {</span>
<span class="nc" id="L398">                        betterDescriptionLinearLayout.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L400" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7401)) {</span>
<span class="nc" id="L401">                        betterDescriptionLinearLayout.setOnClickListener(v -&gt; callback.showAlert(R.string.media_detail_description, R.string.description_info));</span>
                    }
<span class="nc bnc" id="L403" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7402)) {</span>
<span class="nc" id="L404">                        Objects.requireNonNull(captionInputLayout.getEditText()).setFilters(new InputFilter[] { new UploadMediaDetailInputFilter() });</span>
                    }
                } else {
<span class="nc bnc" id="L407" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7394)) {</span>
<span class="nc" id="L408">                        removeButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L410" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7395)) {</span>
<span class="nc" id="L411">                        betterCaptionLinearLayout.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L413" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7396)) {</span>
<span class="nc" id="L414">                        betterDescriptionLinearLayout.setVisibility(View.GONE);</span>
                    }
                }
            }
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7404)) {</span>
<span class="nc" id="L419">                removeButton.setOnClickListener(v -&gt; removeDescription(uploadMediaDetail, position));</span>
            }
<span class="nc bnc" id="L421" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7405)) {</span>
<span class="nc" id="L422">                captionListener = new AbstractTextWatcher(captionText -&gt; uploadMediaDetails.get(position).setCaptionText(convertIdeographicSpaceToLatinSpace(removeLeadingAndTrailingWhitespace(captionText))));</span>
            }
<span class="nc bnc" id="L424" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7406)) {</span>
<span class="nc" id="L425">                descriptionListener = new AbstractTextWatcher(descriptionText -&gt; uploadMediaDetails.get(position).setDescriptionText(descriptionText));</span>
            }
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7407)) {</span>
<span class="nc" id="L428">                captionItemEditText.addTextChangedListener(captionListener);</span>
            }
<span class="nc bnc" id="L430" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7408)) {</span>
<span class="nc" id="L431">                initLanguage(position, uploadMediaDetail);</span>
            }
<span class="nc bnc" id="L433" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7409)) {</span>
<span class="nc" id="L434">                descItemEditText.addTextChangedListener(descriptionListener);</span>
            }
<span class="nc bnc" id="L436" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7410)) {</span>
<span class="nc" id="L437">                initLanguage(position, uploadMediaDetail);</span>
            }
<span class="nc bnc" id="L439" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7416)) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                if (fragment != null) {</span>
<span class="nc" id="L441">                    FrameLayout.LayoutParams newLayoutParams = (FrameLayout.LayoutParams) clParent.getLayoutParams();</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7411)) {</span>
<span class="nc" id="L443">                        newLayoutParams.topMargin = 0;</span>
                    }
<span class="nc bnc" id="L445" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7412)) {</span>
<span class="nc" id="L446">                        newLayoutParams.leftMargin = 0;</span>
                    }
<span class="nc bnc" id="L448" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7413)) {</span>
<span class="nc" id="L449">                        newLayoutParams.rightMargin = 0;</span>
                    }
<span class="nc bnc" id="L451" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7414)) {</span>
<span class="nc" id="L452">                        newLayoutParams.bottomMargin = 0;</span>
                    }
<span class="nc bnc" id="L454" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7415)) {</span>
<span class="nc" id="L455">                        clParent.setLayoutParams(newLayoutParams);</span>
                    }
                }
            }
<span class="nc bnc" id="L459" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7417)) {</span>
<span class="nc" id="L460">                updateAddButtonVisibility();</span>
            }
<span class="nc bnc" id="L462" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7418)) {</span>
<span class="nc" id="L463">                addButton.setOnClickListener(v -&gt; eventListener.addLanguage());</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7421)) {</span>
                // If the description was manually added by the user, it deserves focus, if not, let the user decide
<span class="nc bnc" id="L467" title="All 2 branches missed.">                if (uploadMediaDetail.isManuallyAdded()) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7420)) {</span>
<span class="nc" id="L469">                        captionItemEditText.requestFocus();</span>
                    }
                } else {
<span class="nc bnc" id="L472" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7419)) {</span>
<span class="nc" id="L473">                        captionItemEditText.clearFocus();</span>
                    }
                }
            }
<span class="nc" id="L477">        }</span>

        private void initLanguage(int position, UploadMediaDetail description) {
<span class="nc" id="L480">            final List&lt;Language&gt; recentLanguages = recentLanguagesDao.getRecentLanguages();</span>
<span class="nc" id="L481">            LanguagesAdapter languagesAdapter = new LanguagesAdapter(descriptionLanguages.getContext(), selectedLanguages);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7456)) {</span>
<span class="nc" id="L483">                descriptionLanguages.setOnClickListener(new OnClickListener() {</span>

                    @Override
                    public void onClick(View view) {
<span class="nc" id="L487">                        Dialog dialog = new Dialog(view.getContext());</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7422)) {</span>
<span class="nc" id="L489">                            dialog.setContentView(R.layout.dialog_select_language);</span>
                        }
<span class="nc bnc" id="L491" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7423)) {</span>
<span class="nc" id="L492">                            dialog.setCanceledOnTouchOutside(true);</span>
                        }
<span class="nc bnc" id="L494" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7432)) {</span>
<span class="nc bnc" id="L495" title="All 16 branches missed.">                            dialog.getWindow().setLayout((int) ((ListenerUtil.mutListener.listen(7427) ? (view.getContext().getResources().getDisplayMetrics().widthPixels % 0.90) : (ListenerUtil.mutListener.listen(7426) ? (view.getContext().getResources().getDisplayMetrics().widthPixels / 0.90) : (ListenerUtil.mutListener.listen(7425) ? (view.getContext().getResources().getDisplayMetrics().widthPixels - 0.90) : (ListenerUtil.mutListener.listen(7424) ? (view.getContext().getResources().getDisplayMetrics().widthPixels + 0.90) : (view.getContext().getResources().getDisplayMetrics().widthPixels * 0.90)))))), (int) ((ListenerUtil.mutListener.listen(7431) ? (view.getContext().getResources().getDisplayMetrics().heightPixels % 0.90) : (ListenerUtil.mutListener.listen(7430) ? (view.getContext().getResources().getDisplayMetrics().heightPixels / 0.90) : (ListenerUtil.mutListener.listen(7429) ? (view.getContext().getResources().getDisplayMetrics().heightPixels - 0.90) : (ListenerUtil.mutListener.listen(7428) ? (view.getContext().getResources().getDisplayMetrics().heightPixels + 0.90) : (view.getContext().getResources().getDisplayMetrics().heightPixels * 0.90)))))));</span>
                        }
<span class="nc bnc" id="L497" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7433)) {</span>
<span class="nc" id="L498">                            dialog.show();</span>
                        }
<span class="nc" id="L500">                        EditText editText = dialog.findViewById(R.id.search_language);</span>
<span class="nc" id="L501">                        ListView listView = dialog.findViewById(R.id.language_list);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7434)) {</span>
<span class="nc" id="L503">                            languageHistoryListView = dialog.findViewById(R.id.language_history_list);</span>
                        }
<span class="nc bnc" id="L505" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7435)) {</span>
<span class="nc" id="L506">                            recentLanguagesTextView = dialog.findViewById(R.id.recent_searches);</span>
                        }
<span class="nc bnc" id="L508" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7436)) {</span>
<span class="nc" id="L509">                            separator = dialog.findViewById(R.id.separator);</span>
                        }
<span class="nc bnc" id="L511" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7437)) {</span>
<span class="nc" id="L512">                            setUpRecentLanguagesSection(recentLanguages);</span>
                        }
<span class="nc bnc" id="L514" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7438)) {</span>
<span class="nc" id="L515">                            listView.setAdapter(languagesAdapter);</span>
                        }
<span class="nc bnc" id="L517" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7441)) {</span>
<span class="nc" id="L518">                            editText.addTextChangedListener(new TextWatcher() {</span>

                                @Override
                                public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2) {
<span class="nc bnc" id="L522" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7439)) {</span>
<span class="nc" id="L523">                                        hideRecentLanguagesSection();</span>
                                    }
<span class="nc" id="L525">                                }</span>

                                @Override
                                public void onTextChanged(CharSequence charSequence, int i, int i1, int i2) {
<span class="nc bnc" id="L529" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7440)) {</span>
<span class="nc" id="L530">                                        languagesAdapter.getFilter().filter(charSequence);</span>
                                    }
<span class="nc" id="L532">                                }</span>

                                @Override
                                public void afterTextChanged(Editable editable) {
<span class="nc" id="L536">                                }</span>
                            });
                        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7442)) {</span>
<span class="nc" id="L540">                            languageHistoryListView.setOnItemClickListener((adapterView, view1, position, id) -&gt; {</span>
<span class="nc" id="L541">                                onRecentLanguageClicked(dialog, adapterView, position, description);</span>
<span class="nc" id="L542">                            });</span>
                        }
<span class="nc bnc" id="L544" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7454)) {</span>
<span class="nc" id="L545">                            listView.setOnItemClickListener(new OnItemClickListener() {</span>

                                @Override
                                public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
<span class="nc bnc" id="L549" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7443)) {</span>
<span class="nc" id="L550">                                        description.setSelectedLanguageIndex(i);</span>
                                    }
<span class="nc" id="L552">                                    String languageCode = ((LanguagesAdapter) adapterView.getAdapter()).getLanguageCode(i);</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7444)) {</span>
<span class="nc" id="L554">                                        description.setLanguageCode(languageCode);</span>
                                    }
<span class="nc" id="L556">                                    final String languageName = ((LanguagesAdapter) adapterView.getAdapter()).getLanguageName(i);</span>
<span class="nc" id="L557">                                    final boolean isExists = recentLanguagesDao.findRecentLanguage(languageCode);</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7446)) {</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">                                        if (isExists) {</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7445)) {</span>
<span class="nc" id="L561">                                                recentLanguagesDao.deleteRecentLanguage(languageCode);</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L565" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7447)) {</span>
<span class="nc" id="L566">                                        recentLanguagesDao.addRecentLanguage(new Language(languageName, languageCode));</span>
                                    }
<span class="nc bnc" id="L568" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7448)) {</span>
<span class="nc" id="L569">                                        selectedLanguages.remove(position);</span>
                                    }
<span class="nc bnc" id="L571" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7449)) {</span>
<span class="nc" id="L572">                                        selectedLanguages.put(position, languageCode);</span>
                                    }
<span class="nc bnc" id="L574" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7450)) {</span>
<span class="nc" id="L575">                                        ((LanguagesAdapter) adapterView.getAdapter()).setSelectedLangCode(languageCode);</span>
                                    }
<span class="nc bnc" id="L577" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7451)) {</span>
<span class="nc" id="L578">                                        Timber.d(&quot;Description language code is: &quot; + languageCode);</span>
                                    }
<span class="nc bnc" id="L580" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7452)) {</span>
<span class="nc" id="L581">                                        descriptionLanguages.setText(languageCode);</span>
                                    }
<span class="nc bnc" id="L583" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7453)) {</span>
<span class="nc" id="L584">                                        dialog.dismiss();</span>
                                    }
<span class="nc" id="L586">                                }</span>
                            });
                        }
<span class="nc bnc" id="L589" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7455)) {</span>
<span class="nc" id="L590">                            dialog.setOnDismissListener(dialogInterface -&gt; languagesAdapter.getFilter().filter(&quot;&quot;));</span>
                        }
<span class="nc" id="L592">                    }</span>
                });
            }
<span class="nc bnc" id="L595" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7490)) {</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">                if (description.getSelectedLanguageIndex() == -1) {</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7489)) {</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">                        if (!TextUtils.isEmpty(savedLanguageValue)) {</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7488)) {</span>
                                // savedLanguageValue is not null
<span class="nc bnc" id="L601" title="All 2 branches missed.">                                if (!TextUtils.isEmpty(description.getLanguageCode())) {</span>
<span class="nc bnc" id="L602" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7485)) {</span>
<span class="nc" id="L603">                                        descriptionLanguages.setText(description.getLanguageCode());</span>
                                    }
<span class="nc bnc" id="L605" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7486)) {</span>
<span class="nc" id="L606">                                        selectedLanguages.remove(position);</span>
                                    }
<span class="nc bnc" id="L608" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7487)) {</span>
<span class="nc" id="L609">                                        selectedLanguages.put(position, description.getLanguageCode());</span>
                                    }
                                } else {
<span class="nc bnc" id="L612" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7481)) {</span>
<span class="nc" id="L613">                                        description.setLanguageCode(savedLanguageValue);</span>
                                    }
<span class="nc bnc" id="L615" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7482)) {</span>
<span class="nc" id="L616">                                        descriptionLanguages.setText(savedLanguageValue);</span>
                                    }
<span class="nc bnc" id="L618" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7483)) {</span>
<span class="nc" id="L619">                                        selectedLanguages.remove(position);</span>
                                    }
<span class="nc bnc" id="L621" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7484)) {</span>
<span class="nc" id="L622">                                        selectedLanguages.put(position, savedLanguageValue);</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L626" title="All 2 branches missed.">                        } else if (!TextUtils.isEmpty(description.getLanguageCode())) {</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7478)) {</span>
<span class="nc" id="L628">                                descriptionLanguages.setText(description.getLanguageCode());</span>
                            }
<span class="nc bnc" id="L630" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7479)) {</span>
<span class="nc" id="L631">                                selectedLanguages.remove(position);</span>
                            }
<span class="nc bnc" id="L633" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7480)) {</span>
<span class="nc" id="L634">                                selectedLanguages.put(position, description.getLanguageCode());</span>
                            }
                        } else {
<span class="nc bnc" id="L637" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7477)) {</span>
                                // Checking whether Language Code attribute is null or not.
<span class="nc bnc" id="L639" title="All 2 branches missed.">                                if (uploadMediaDetails.get(position).getLanguageCode() != null) {</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7474)) {</span>
                                        // hence providing same language code for the current upload.
<span class="nc" id="L642">                                        descriptionLanguages.setText(uploadMediaDetails.get(position).getLanguageCode());</span>
                                    }
<span class="nc bnc" id="L644" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7475)) {</span>
<span class="nc" id="L645">                                        selectedLanguages.remove(position);</span>
                                    }
<span class="nc bnc" id="L647" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7476)) {</span>
<span class="nc" id="L648">                                        selectedLanguages.put(position, uploadMediaDetails.get(position).getLanguageCode());</span>
                                    }
                                } else {
<span class="nc bnc" id="L651" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7473)) {</span>
<span class="nc bnc" id="L652" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(7464) ? (position &gt;= 0) : (ListenerUtil.mutListener.listen(7463) ? (position &lt;= 0) : (ListenerUtil.mutListener.listen(7462) ? (position &gt; 0) : (ListenerUtil.mutListener.listen(7461) ? (position &lt; 0) : (ListenerUtil.mutListener.listen(7460) ? (position != 0) : (position == 0))))))) {</span>
<span class="nc" id="L653">                                            final int defaultLocaleIndex = languagesAdapter.getIndexOfUserDefaultLocale(descriptionLanguages.getContext());</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7469)) {</span>
<span class="nc" id="L655">                                                descriptionLanguages.setText(languagesAdapter.getLanguageCode(defaultLocaleIndex));</span>
                                            }
<span class="nc bnc" id="L657" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7470)) {</span>
<span class="nc" id="L658">                                                description.setLanguageCode(languagesAdapter.getLanguageCode(defaultLocaleIndex));</span>
                                            }
<span class="nc bnc" id="L660" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7471)) {</span>
<span class="nc" id="L661">                                                selectedLanguages.remove(position);</span>
                                            }
<span class="nc bnc" id="L663" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7472)) {</span>
<span class="nc" id="L664">                                                selectedLanguages.put(position, languagesAdapter.getLanguageCode(defaultLocaleIndex));</span>
                                            }
<span class="nc" id="L666">                                        } else {</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7465)) {</span>
<span class="nc" id="L668">                                                description.setLanguageCode(languagesAdapter.getLanguageCode(0));</span>
                                            }
<span class="nc bnc" id="L670" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7466)) {</span>
<span class="nc" id="L671">                                                descriptionLanguages.setText(languagesAdapter.getLanguageCode(0));</span>
                                            }
<span class="nc bnc" id="L673" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7467)) {</span>
<span class="nc" id="L674">                                                selectedLanguages.remove(position);</span>
                                            }
<span class="nc bnc" id="L676" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7468)) {</span>
<span class="nc" id="L677">                                                selectedLanguages.put(position, languagesAdapter.getLanguageCode(0));</span>
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } else {
<span class="nc bnc" id="L686" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7457)) {</span>
<span class="nc" id="L687">                        descriptionLanguages.setText(description.getLanguageCode());</span>
                    }
<span class="nc bnc" id="L689" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7458)) {</span>
<span class="nc" id="L690">                        selectedLanguages.remove(position);</span>
                    }
<span class="nc bnc" id="L692" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7459)) {</span>
<span class="nc" id="L693">                        selectedLanguages.put(position, description.getLanguageCode());</span>
                    }
                }
            }
<span class="nc" id="L697">        }</span>

        /**
         * Handles click event for recent language section
         */
        private void onRecentLanguageClicked(final Dialog dialog, final AdapterView&lt;?&gt; adapterView, final int position, final UploadMediaDetail description) {
<span class="nc bnc" id="L703" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7491)) {</span>
<span class="nc" id="L704">                description.setSelectedLanguageIndex(position);</span>
            }
<span class="nc" id="L706">            final String languageCode = ((RecentLanguagesAdapter) adapterView.getAdapter()).getLanguageCode(position);</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7492)) {</span>
<span class="nc" id="L708">                description.setLanguageCode(languageCode);</span>
            }
<span class="nc" id="L710">            final String languageName = ((RecentLanguagesAdapter) adapterView.getAdapter()).getLanguageName(position);</span>
<span class="nc" id="L711">            final boolean isExists = recentLanguagesDao.findRecentLanguage(languageCode);</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7494)) {</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">                if (isExists) {</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7493)) {</span>
<span class="nc" id="L715">                        recentLanguagesDao.deleteRecentLanguage(languageCode);</span>
                    }
                }
            }
<span class="nc bnc" id="L719" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7495)) {</span>
<span class="nc" id="L720">                recentLanguagesDao.addRecentLanguage(new Language(languageName, languageCode));</span>
            }
<span class="nc bnc" id="L722" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7496)) {</span>
<span class="nc" id="L723">                selectedLanguages.remove(position);</span>
            }
<span class="nc bnc" id="L725" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7497)) {</span>
<span class="nc" id="L726">                selectedLanguages.put(position, languageCode);</span>
            }
<span class="nc bnc" id="L728" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7498)) {</span>
<span class="nc" id="L729">                ((RecentLanguagesAdapter) adapterView.getAdapter()).setSelectedLangCode(languageCode);</span>
            }
<span class="nc bnc" id="L731" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7499)) {</span>
<span class="nc" id="L732">                Timber.d(&quot;Description language code is: %s&quot;, languageCode);</span>
            }
<span class="nc bnc" id="L734" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7500)) {</span>
<span class="nc" id="L735">                descriptionLanguages.setText(languageCode);</span>
            }
<span class="nc bnc" id="L737" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7501)) {</span>
<span class="nc" id="L738">                dialog.dismiss();</span>
            }
<span class="nc" id="L740">        }</span>

        /**
         * Hides recent languages section
         */
        private void hideRecentLanguagesSection() {
<span class="nc bnc" id="L746" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7502)) {</span>
<span class="nc" id="L747">                languageHistoryListView.setVisibility(View.GONE);</span>
            }
<span class="nc bnc" id="L749" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7503)) {</span>
<span class="nc" id="L750">                recentLanguagesTextView.setVisibility(View.GONE);</span>
            }
<span class="nc bnc" id="L752" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7504)) {</span>
<span class="nc" id="L753">                separator.setVisibility(View.GONE);</span>
            }
<span class="nc" id="L755">        }</span>

        /**
         * Set up recent languages section
         *
         * @param recentLanguages recently used languages
         */
        private void setUpRecentLanguagesSection(final List&lt;Language&gt; recentLanguages) {
<span class="nc bnc" id="L763" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7529)) {</span>
<span class="nc bnc" id="L764" title="All 2 branches missed.">                if (recentLanguages.isEmpty()) {</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7526)) {</span>
<span class="nc" id="L766">                        languageHistoryListView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L768" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7527)) {</span>
<span class="nc" id="L769">                        recentLanguagesTextView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L771" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7528)) {</span>
<span class="nc" id="L772">                        separator.setVisibility(View.GONE);</span>
                    }
                } else {
<span class="nc bnc" id="L775" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7521)) {</span>
<span class="nc bnc" id="L776" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(7509) ? (recentLanguages.size() &gt;= 5) : (ListenerUtil.mutListener.listen(7508) ? (recentLanguages.size() &lt;= 5) : (ListenerUtil.mutListener.listen(7507) ? (recentLanguages.size() &lt; 5) : (ListenerUtil.mutListener.listen(7506) ? (recentLanguages.size() != 5) : (ListenerUtil.mutListener.listen(7505) ? (recentLanguages.size() == 5) : (recentLanguages.size() &gt; 5))))))) {</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7520)) {</span>
                                {
<span class="nc" id="L779">                                    long _loopCounter115 = 0;</span>
<span class="nc bnc" id="L780" title="All 30 branches missed.">                                    for (int i = (ListenerUtil.mutListener.listen(7519) ? (recentLanguages.size() % 1) : (ListenerUtil.mutListener.listen(7518) ? (recentLanguages.size() / 1) : (ListenerUtil.mutListener.listen(7517) ? (recentLanguages.size() * 1) : (ListenerUtil.mutListener.listen(7516) ? (recentLanguages.size() + 1) : (recentLanguages.size() - 1))))); (ListenerUtil.mutListener.listen(7515) ? (i &lt;= 5) : (ListenerUtil.mutListener.listen(7514) ? (i &gt; 5) : (ListenerUtil.mutListener.listen(7513) ? (i &lt; 5) : (ListenerUtil.mutListener.listen(7512) ? (i != 5) : (ListenerUtil.mutListener.listen(7511) ? (i == 5) : (i &gt;= 5)))))); i--) {</span>
<span class="nc" id="L781">                                        ListenerUtil.loopListener.listen(&quot;_loopCounter115&quot;, ++_loopCounter115);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7510)) {</span>
<span class="nc" id="L783">                                            recentLanguagesDao.deleteRecentLanguage(recentLanguages.get(i).getLanguageCode());</span>
                                        }
                                    }
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L790" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7522)) {</span>
<span class="nc" id="L791">                        languageHistoryListView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L793" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7523)) {</span>
<span class="nc" id="L794">                        recentLanguagesTextView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L796" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7524)) {</span>
<span class="nc" id="L797">                        separator.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc" id="L799">                    final RecentLanguagesAdapter recentLanguagesAdapter = new RecentLanguagesAdapter(descriptionLanguages.getContext(), recentLanguagesDao.getRecentLanguages(), selectedLanguages);</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7525)) {</span>
<span class="nc" id="L801">                        languageHistoryListView.setAdapter(recentLanguagesAdapter);</span>
                    }
                }
            }
<span class="nc" id="L805">        }</span>

        /**
         * Removes any leading and trailing whitespace from the source text.
         *
         * @param source input string
         * @return a string without leading and trailing whitespace
         */
        public String removeLeadingAndTrailingWhitespace(String source) {
            // Note that String::trim does not adequately remove all whitespace chars.
<span class="nc" id="L815">            int firstNonWhitespaceIndex = 0;</span>
<span class="nc bnc" id="L816" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7537)) {</span>
                {
<span class="nc" id="L818">                    long _loopCounter116 = 0;</span>
<span class="nc bnc" id="L819" title="All 22 branches missed.">                    while ((ListenerUtil.mutListener.listen(7536) ? (firstNonWhitespaceIndex &gt;= source.length()) : (ListenerUtil.mutListener.listen(7535) ? (firstNonWhitespaceIndex &lt;= source.length()) : (ListenerUtil.mutListener.listen(7534) ? (firstNonWhitespaceIndex &gt; source.length()) : (ListenerUtil.mutListener.listen(7533) ? (firstNonWhitespaceIndex != source.length()) : (ListenerUtil.mutListener.listen(7532) ? (firstNonWhitespaceIndex == source.length()) : (firstNonWhitespaceIndex &lt; source.length()))))))) {</span>
<span class="nc" id="L820">                        ListenerUtil.loopListener.listen(&quot;_loopCounter116&quot;, ++_loopCounter116);</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7531)) {</span>
<span class="nc bnc" id="L822" title="All 2 branches missed.">                            if (Character.isWhitespace(source.charAt(firstNonWhitespaceIndex))) {</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7530)) {</span>
<span class="nc" id="L824">                                    firstNonWhitespaceIndex++;</span>
                                }
                            } else {
                                break;
                            }
                        }
                    }
                }
            }
<span class="nc bnc" id="L833" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7543)) {</span>
<span class="nc bnc" id="L834" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(7542) ? (firstNonWhitespaceIndex &gt;= source.length()) : (ListenerUtil.mutListener.listen(7541) ? (firstNonWhitespaceIndex &lt;= source.length()) : (ListenerUtil.mutListener.listen(7540) ? (firstNonWhitespaceIndex &gt; source.length()) : (ListenerUtil.mutListener.listen(7539) ? (firstNonWhitespaceIndex &lt; source.length()) : (ListenerUtil.mutListener.listen(7538) ? (firstNonWhitespaceIndex != source.length()) : (firstNonWhitespaceIndex == source.length()))))))) {</span>
<span class="nc" id="L835">                    return &quot;&quot;;</span>
                }
            }
<span class="nc bnc" id="L838" title="All 8 branches missed.">            int lastNonWhitespaceIndex = (ListenerUtil.mutListener.listen(7547) ? (source.length() % 1) : (ListenerUtil.mutListener.listen(7546) ? (source.length() / 1) : (ListenerUtil.mutListener.listen(7545) ? (source.length() * 1) : (ListenerUtil.mutListener.listen(7544) ? (source.length() + 1) : (source.length() - 1)))));</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7555)) {</span>
                {
<span class="nc" id="L841">                    long _loopCounter117 = 0;</span>
<span class="nc bnc" id="L842" title="All 22 branches missed.">                    while ((ListenerUtil.mutListener.listen(7554) ? (lastNonWhitespaceIndex &gt;= firstNonWhitespaceIndex) : (ListenerUtil.mutListener.listen(7553) ? (lastNonWhitespaceIndex &lt;= firstNonWhitespaceIndex) : (ListenerUtil.mutListener.listen(7552) ? (lastNonWhitespaceIndex &lt; firstNonWhitespaceIndex) : (ListenerUtil.mutListener.listen(7551) ? (lastNonWhitespaceIndex != firstNonWhitespaceIndex) : (ListenerUtil.mutListener.listen(7550) ? (lastNonWhitespaceIndex == firstNonWhitespaceIndex) : (lastNonWhitespaceIndex &gt; firstNonWhitespaceIndex))))))) {</span>
<span class="nc" id="L843">                        ListenerUtil.loopListener.listen(&quot;_loopCounter117&quot;, ++_loopCounter117);</span>
<span class="nc bnc" id="L844" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7549)) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">                            if (Character.isWhitespace(source.charAt(lastNonWhitespaceIndex))) {</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7548)) {</span>
<span class="nc" id="L847">                                    lastNonWhitespaceIndex--;</span>
                                }
                            } else {
                                break;
                            }
                        }
                    }
                }
            }
<span class="nc bnc" id="L856" title="All 8 branches missed.">            return source.substring(firstNonWhitespaceIndex, (ListenerUtil.mutListener.listen(7559) ? (lastNonWhitespaceIndex % 1) : (ListenerUtil.mutListener.listen(7558) ? (lastNonWhitespaceIndex / 1) : (ListenerUtil.mutListener.listen(7557) ? (lastNonWhitespaceIndex * 1) : (ListenerUtil.mutListener.listen(7556) ? (lastNonWhitespaceIndex - 1) : (lastNonWhitespaceIndex + 1))))));</span>
        }

        /**
         * Convert Ideographic space to Latin space
         *
         * @param source the source text
         * @return a string with Latin spaces instead of Ideographic spaces
         */
        public String convertIdeographicSpaceToLatinSpace(String source) {
<span class="nc" id="L866">            Pattern ideographicSpacePattern = Pattern.compile(&quot;\\x{3000}&quot;);</span>
<span class="nc" id="L867">            return ideographicSpacePattern.matcher(source).replaceAll(&quot; &quot;);</span>
        }
    }

    /**
     * Hides the visibility of the &quot;Add&quot; button for all items in the RecyclerView except
     * the last item in RecyclerView
     */
    private void updateAddButtonVisibility() {
<span class="nc bnc" id="L876" title="All 8 branches missed.">        int lastItemPosition = (ListenerUtil.mutListener.listen(7563) ? (getItemCount() % 1) : (ListenerUtil.mutListener.listen(7562) ? (getItemCount() / 1) : (ListenerUtil.mutListener.listen(7561) ? (getItemCount() * 1) : (ListenerUtil.mutListener.listen(7560) ? (getItemCount() + 1) : (getItemCount() - 1)))));</span>
<span class="nc bnc" id="L877" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7576)) {</span>
            {
<span class="nc" id="L879">                long _loopCounter118 = 0;</span>
                // Hide Add Button for all items
<span class="nc bnc" id="L881" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(7575) ? (i &gt;= getItemCount()) : (ListenerUtil.mutListener.listen(7574) ? (i &lt;= getItemCount()) : (ListenerUtil.mutListener.listen(7573) ? (i &gt; getItemCount()) : (ListenerUtil.mutListener.listen(7572) ? (i != getItemCount()) : (ListenerUtil.mutListener.listen(7571) ? (i == getItemCount()) : (i &lt; getItemCount())))))); i++) {</span>
<span class="nc" id="L882">                    ListenerUtil.loopListener.listen(&quot;_loopCounter118&quot;, ++_loopCounter118);</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7570)) {</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">                        if (fragment != null) {</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7569)) {</span>
<span class="nc bnc" id="L886" title="All 2 branches missed.">                                if (fragment.getView() != null) {</span>
<span class="nc" id="L887">                                    ViewHolder holder = (ViewHolder) ((RecyclerView) fragment.getView().findViewById(R.id.rv_descriptions)).findViewHolderForAdapterPosition(i);</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7568)) {</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">                                        if (holder != null) {</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7567)) {</span>
<span class="nc" id="L891">                                                holder.addButton.setVisibility(View.GONE);</span>
                                            }
                                        }
                                    }
<span class="nc" id="L895">                                }</span>
                            }
                        } else {
<span class="nc bnc" id="L898" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7566)) {</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">                                if (this.activity != null) {</span>
<span class="nc" id="L900">                                    ViewHolder holder = (ViewHolder) ((RecyclerView) activity.findViewById(R.id.rv_descriptions_captions)).findViewHolderForAdapterPosition(i);</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7565)) {</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">                                        if (holder != null) {</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(7564)) {</span>
<span class="nc" id="L904">                                                holder.addButton.setVisibility(View.GONE);</span>
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L915" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7583)) {</span>
            // Show Add Button for the last item
<span class="nc bnc" id="L917" title="All 2 branches missed.">            if (fragment != null) {</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7582)) {</span>
<span class="nc bnc" id="L919" title="All 2 branches missed.">                    if (fragment.getView() != null) {</span>
<span class="nc" id="L920">                        ViewHolder lastItemHolder = (ViewHolder) ((RecyclerView) fragment.getView().findViewById(R.id.rv_descriptions)).findViewHolderForAdapterPosition(lastItemPosition);</span>
<span class="nc bnc" id="L921" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7581)) {</span>
<span class="nc bnc" id="L922" title="All 2 branches missed.">                            if (lastItemHolder != null) {</span>
<span class="nc bnc" id="L923" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7580)) {</span>
<span class="nc" id="L924">                                    lastItemHolder.addButton.setVisibility(View.VISIBLE);</span>
                                }
                            }
                        }
<span class="nc" id="L928">                    }</span>
                }
            } else {
<span class="nc bnc" id="L931" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7579)) {</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">                    if (this.activity != null) {</span>
<span class="nc" id="L933">                        ViewHolder lastItemHolder = (ViewHolder) ((RecyclerView) activity.findViewById(R.id.rv_descriptions_captions)).findViewHolderForAdapterPosition(lastItemPosition);</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7578)) {</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">                            if (lastItemHolder != null) {</span>
<span class="nc bnc" id="L936" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7577)) {</span>
<span class="nc" id="L937">                                    lastItemHolder.addButton.setVisibility(View.VISIBLE);</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L945">    }</span>

    public interface Callback {

        void showAlert(int mediaDetailDescription, int descriptionInfo);
    }

    public interface EventListener {

        void onPrimaryCaptionTextChange(boolean isNotEmpty);

        void addLanguage();
    }

<span class="nc" id="L959">    enum SelectedVoiceIcon {</span>

<span class="nc" id="L961">        CAPTION, DESCRIPTION</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>