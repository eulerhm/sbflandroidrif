<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.utils</a> &gt; <span class="el_source">ImageUtils.java</span></div><h1>ImageUtils.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.utils;

import android.app.ProgressDialog;
import android.app.WallpaperManager;
import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Color;
import android.net.Uri;
import androidx.annotation.IntDef;
import androidx.annotation.Nullable;
import androidx.core.content.ContextCompat;
import androidx.exifinterface.media.ExifInterface;
import com.facebook.common.executors.CallerThreadExecutor;
import com.facebook.common.references.CloseableReference;
import com.facebook.datasource.DataSource;
import com.facebook.drawee.backends.pipeline.Fresco;
import com.facebook.imagepipeline.core.ImagePipeline;
import com.facebook.imagepipeline.datasource.BaseBitmapDataSubscriber;
import com.facebook.imagepipeline.image.CloseableImage;
import com.facebook.imagepipeline.request.ImageRequest;
import com.facebook.imagepipeline.request.ImageRequestBuilder;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.mwapi.OkHttpJsonApiClient;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.CompositeDisposable;
import io.reactivex.schedulers.Schedulers;
import java.io.IOException;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L36">public class ImageUtils {</span>

    // 1
    public static final int IMAGE_DARK = 1 &lt;&lt; 0;

    // 2
    public static final int IMAGE_BLURRY = 1 &lt;&lt; 1;

    // 4
    public static final int IMAGE_DUPLICATE = 1 &lt;&lt; 2;

    // 8
    public static final int IMAGE_GEOLOCATION_DIFFERENT = 1 &lt;&lt; 3;

    /**
     * The parameter FILE_FBMD is returned from the class ReadFBMD if the uploaded image contains FBMD data else returns IMAGE_OK
     * ie. 10000
     */
    public static final int FILE_FBMD = 1 &lt;&lt; 4;

    /**
     * The parameter FILE_NO_EXIF is returned from the class EXIFReader if the uploaded image does not contains EXIF data else returns IMAGE_OK
     * ie. 100000
     */
    public static final int FILE_NO_EXIF = 1 &lt;&lt; 5;

    public static final int IMAGE_OK = 0;

    public static final int IMAGE_KEEP = -1;

    public static final int IMAGE_WAIT = -2;

    public static final int EMPTY_CAPTION = -3;

    public static final int FILE_NAME_EXISTS = 1 &lt;&lt; 6;

    static final int NO_CATEGORY_SELECTED = -5;

    private static ProgressDialog progressDialogWallpaper;

    private static ProgressDialog progressDialogAvatar;

    @IntDef(flag = true, value = { IMAGE_DARK, IMAGE_BLURRY, IMAGE_DUPLICATE, IMAGE_OK, IMAGE_KEEP, IMAGE_WAIT, EMPTY_CAPTION, FILE_NAME_EXISTS, NO_CATEGORY_SELECTED, IMAGE_GEOLOCATION_DIFFERENT })
    @Retention(RetentionPolicy.SOURCE)
    public @interface Result {
    }

    /**
     * @return IMAGE_OK if image is not too dark
     * IMAGE_DARK if image is too dark
     */
    @Result
    static int checkIfImageIsTooDark(String imagePath) {
<span class="nc" id="L89">        long millis = System.currentTimeMillis();</span>
        try {
<span class="nc" id="L91">            Bitmap bmp = new ExifInterface(imagePath).getThumbnailBitmap();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2297)) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                if (bmp == null) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2296)) {</span>
<span class="nc" id="L95">                        bmp = BitmapFactory.decodeFile(imagePath);</span>
                    }
                }
            }
<span class="nc bnc" id="L99" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2298)) {</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">                if (checkIfImageIsDark(bmp)) {</span>
<span class="nc" id="L101">                    return IMAGE_DARK;</span>
                }
            }
<span class="nc" id="L104">        } catch (Exception e) {</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2290)) {</span>
<span class="nc" id="L106">                Timber.d(e, &quot;Error while checking image darkness.&quot;);</span>
            }
        } finally {
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2295)) {</span>
<span class="nc bnc" id="L110" title="All 8 branches missed.">                Timber.d(&quot;Checking image darkness took &quot; + ((ListenerUtil.mutListener.listen(2294) ? (System.currentTimeMillis() % millis) : (ListenerUtil.mutListener.listen(2293) ? (System.currentTimeMillis() / millis) : (ListenerUtil.mutListener.listen(2292) ? (System.currentTimeMillis() * millis) : (ListenerUtil.mutListener.listen(2291) ? (System.currentTimeMillis() + millis) : (System.currentTimeMillis() - millis)))))) + &quot; ms.&quot;);</span>
            }
        }
<span class="nc" id="L113">        return IMAGE_OK;</span>
    }

    /**
     * @param geolocationOfFileString Geolocation of image. If geotag doesn't exists, then this will be an empty string
     * @param latLng Location of wikidata item will be edited after upload
     * @return false if image is neither dark nor blurry or if the input bitmapRegionDecoder provided is null
     * true if geolocation of the image and wikidata item are different
     */
    static boolean checkImageGeolocationIsDifferent(String geolocationOfFileString, LatLng latLng) {
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2299)) {</span>
<span class="nc" id="L124">            Timber.d(&quot;Comparing geolocation of file with nearby place location&quot;);</span>
        }
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2300)) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">            if (latLng == null) {</span>
                // Since we don't know geolocation of file, we choose letting upload
<span class="nc" id="L129">                return false;</span>
            }
        }
<span class="nc" id="L132">        String[] geolocationOfFile = geolocationOfFileString.split(&quot;\\|&quot;);</span>
<span class="nc" id="L133">        Double distance = LengthUtils.computeDistanceBetween(new LatLng(Double.parseDouble(geolocationOfFile[0]), Double.parseDouble(geolocationOfFile[1]), 0), latLng);</span>
        // Distance is more than 1 km, means that geolocation is wrong
<span class="nc bnc" id="L135" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(2305) ? (distance &lt;= 1000) : (ListenerUtil.mutListener.listen(2304) ? (distance &gt; 1000) : (ListenerUtil.mutListener.listen(2303) ? (distance &lt; 1000) : (ListenerUtil.mutListener.listen(2302) ? (distance != 1000) : (ListenerUtil.mutListener.listen(2301) ? (distance == 1000) : (distance &gt;= 1000))))));</span>
    }

    private static boolean checkIfImageIsDark(Bitmap bitmap) {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2307)) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">            if (bitmap == null) {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2306)) {</span>
<span class="nc" id="L142">                    Timber.e(&quot;Expected bitmap was null&quot;);</span>
                }
<span class="nc" id="L144">                return true;</span>
            }
        }
<span class="nc" id="L147">        int bitmapWidth = bitmap.getWidth();</span>
<span class="nc" id="L148">        int bitmapHeight = bitmap.getHeight();</span>
<span class="nc bnc" id="L149" title="All 8 branches missed.">        int allPixelsCount = (ListenerUtil.mutListener.listen(2311) ? (bitmapWidth % bitmapHeight) : (ListenerUtil.mutListener.listen(2310) ? (bitmapWidth / bitmapHeight) : (ListenerUtil.mutListener.listen(2309) ? (bitmapWidth - bitmapHeight) : (ListenerUtil.mutListener.listen(2308) ? (bitmapWidth + bitmapHeight) : (bitmapWidth * bitmapHeight)))));</span>
<span class="nc" id="L150">        int numberOfBrightPixels = 0;</span>
<span class="nc" id="L151">        int numberOfMediumBrightnessPixels = 0;</span>
<span class="nc bnc" id="L152" title="All 8 branches missed.">        double brightPixelThreshold = (ListenerUtil.mutListener.listen(2315) ? (0.025 % allPixelsCount) : (ListenerUtil.mutListener.listen(2314) ? (0.025 / allPixelsCount) : (ListenerUtil.mutListener.listen(2313) ? (0.025 - allPixelsCount) : (ListenerUtil.mutListener.listen(2312) ? (0.025 + allPixelsCount) : (0.025 * allPixelsCount)))));</span>
<span class="nc bnc" id="L153" title="All 8 branches missed.">        double mediumBrightPixelThreshold = (ListenerUtil.mutListener.listen(2319) ? (0.3 % allPixelsCount) : (ListenerUtil.mutListener.listen(2318) ? (0.3 / allPixelsCount) : (ListenerUtil.mutListener.listen(2317) ? (0.3 - allPixelsCount) : (ListenerUtil.mutListener.listen(2316) ? (0.3 + allPixelsCount) : (0.3 * allPixelsCount)))));</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2397)) {</span>
            {
<span class="nc" id="L156">                long _loopCounter31 = 0;</span>
<span class="nc bnc" id="L157" title="All 22 branches missed.">                for (int x = 0; (ListenerUtil.mutListener.listen(2396) ? (x &gt;= bitmapWidth) : (ListenerUtil.mutListener.listen(2395) ? (x &lt;= bitmapWidth) : (ListenerUtil.mutListener.listen(2394) ? (x &gt; bitmapWidth) : (ListenerUtil.mutListener.listen(2393) ? (x != bitmapWidth) : (ListenerUtil.mutListener.listen(2392) ? (x == bitmapWidth) : (x &lt; bitmapWidth)))))); x++) {</span>
<span class="nc" id="L158">                    ListenerUtil.loopListener.listen(&quot;_loopCounter31&quot;, ++_loopCounter31);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2391)) {</span>
                        {
<span class="nc" id="L161">                            long _loopCounter30 = 0;</span>
<span class="nc bnc" id="L162" title="All 22 branches missed.">                            for (int y = 0; (ListenerUtil.mutListener.listen(2390) ? (y &gt;= bitmapHeight) : (ListenerUtil.mutListener.listen(2389) ? (y &lt;= bitmapHeight) : (ListenerUtil.mutListener.listen(2388) ? (y &gt; bitmapHeight) : (ListenerUtil.mutListener.listen(2387) ? (y != bitmapHeight) : (ListenerUtil.mutListener.listen(2386) ? (y == bitmapHeight) : (y &lt; bitmapHeight)))))); y++) {</span>
<span class="nc" id="L163">                                ListenerUtil.loopListener.listen(&quot;_loopCounter30&quot;, ++_loopCounter30);</span>
<span class="nc" id="L164">                                int pixel = bitmap.getPixel(x, y);</span>
<span class="nc" id="L165">                                int r = Color.red(pixel);</span>
<span class="nc" id="L166">                                int g = Color.green(pixel);</span>
<span class="nc" id="L167">                                int b = Color.blue(pixel);</span>
<span class="nc bnc" id="L168" title="All 22 branches missed.">                                int secondMax = (ListenerUtil.mutListener.listen(2324) ? (r &gt;= g) : (ListenerUtil.mutListener.listen(2323) ? (r &lt;= g) : (ListenerUtil.mutListener.listen(2322) ? (r &lt; g) : (ListenerUtil.mutListener.listen(2321) ? (r != g) : (ListenerUtil.mutListener.listen(2320) ? (r == g) : (r &gt; g)))))) ? r : g;</span>
<span class="nc bnc" id="L169" title="All 118 branches missed.">                                double max = (ListenerUtil.mutListener.listen(2333) ? (((ListenerUtil.mutListener.listen(2329) ? (secondMax &gt;= b) : (ListenerUtil.mutListener.listen(2328) ? (secondMax &lt;= b) : (ListenerUtil.mutListener.listen(2327) ? (secondMax &lt; b) : (ListenerUtil.mutListener.listen(2326) ? (secondMax != b) : (ListenerUtil.mutListener.listen(2325) ? (secondMax == b) : (secondMax &gt; b)))))) ? secondMax : b) % 255.0) : (ListenerUtil.mutListener.listen(2332) ? (((ListenerUtil.mutListener.listen(2329) ? (secondMax &gt;= b) : (ListenerUtil.mutListener.listen(2328) ? (secondMax &lt;= b) : (ListenerUtil.mutListener.listen(2327) ? (secondMax &lt; b) : (ListenerUtil.mutListener.listen(2326) ? (secondMax != b) : (ListenerUtil.mutListener.listen(2325) ? (secondMax == b) : (secondMax &gt; b)))))) ? secondMax : b) * 255.0) : (ListenerUtil.mutListener.listen(2331) ? (((ListenerUtil.mutListener.listen(2329) ? (secondMax &gt;= b) : (ListenerUtil.mutListener.listen(2328) ? (secondMax &lt;= b) : (ListenerUtil.mutListener.listen(2327) ? (secondMax &lt; b) : (ListenerUtil.mutListener.listen(2326) ? (secondMax != b) : (ListenerUtil.mutListener.listen(2325) ? (secondMax == b) : (secondMax &gt; b)))))) ? secondMax : b) - 255.0) : (ListenerUtil.mutListener.listen(2330) ? (((ListenerUtil.mutListener.listen(2329) ? (secondMax &gt;= b) : (ListenerUtil.mutListener.listen(2328) ? (secondMax &lt;= b) : (ListenerUtil.mutListener.listen(2327) ? (secondMax &lt; b) : (ListenerUtil.mutListener.listen(2326) ? (secondMax != b) : (ListenerUtil.mutListener.listen(2325) ? (secondMax == b) : (secondMax &gt; b)))))) ? secondMax : b) + 255.0) : (((ListenerUtil.mutListener.listen(2329) ? (secondMax &gt;= b) : (ListenerUtil.mutListener.listen(2328) ? (secondMax &lt;= b) : (ListenerUtil.mutListener.listen(2327) ? (secondMax &lt; b) : (ListenerUtil.mutListener.listen(2326) ? (secondMax != b) : (ListenerUtil.mutListener.listen(2325) ? (secondMax == b) : (secondMax &gt; b)))))) ? secondMax : b) / 255.0)))));</span>
<span class="nc bnc" id="L170" title="All 22 branches missed.">                                int secondMin = (ListenerUtil.mutListener.listen(2338) ? (r &gt;= g) : (ListenerUtil.mutListener.listen(2337) ? (r &lt;= g) : (ListenerUtil.mutListener.listen(2336) ? (r &gt; g) : (ListenerUtil.mutListener.listen(2335) ? (r != g) : (ListenerUtil.mutListener.listen(2334) ? (r == g) : (r &lt; g)))))) ? r : g;</span>
<span class="nc bnc" id="L171" title="All 118 branches missed.">                                double min = (ListenerUtil.mutListener.listen(2347) ? (((ListenerUtil.mutListener.listen(2343) ? (secondMin &gt;= b) : (ListenerUtil.mutListener.listen(2342) ? (secondMin &lt;= b) : (ListenerUtil.mutListener.listen(2341) ? (secondMin &gt; b) : (ListenerUtil.mutListener.listen(2340) ? (secondMin != b) : (ListenerUtil.mutListener.listen(2339) ? (secondMin == b) : (secondMin &lt; b)))))) ? secondMin : b) % 255.0) : (ListenerUtil.mutListener.listen(2346) ? (((ListenerUtil.mutListener.listen(2343) ? (secondMin &gt;= b) : (ListenerUtil.mutListener.listen(2342) ? (secondMin &lt;= b) : (ListenerUtil.mutListener.listen(2341) ? (secondMin &gt; b) : (ListenerUtil.mutListener.listen(2340) ? (secondMin != b) : (ListenerUtil.mutListener.listen(2339) ? (secondMin == b) : (secondMin &lt; b)))))) ? secondMin : b) * 255.0) : (ListenerUtil.mutListener.listen(2345) ? (((ListenerUtil.mutListener.listen(2343) ? (secondMin &gt;= b) : (ListenerUtil.mutListener.listen(2342) ? (secondMin &lt;= b) : (ListenerUtil.mutListener.listen(2341) ? (secondMin &gt; b) : (ListenerUtil.mutListener.listen(2340) ? (secondMin != b) : (ListenerUtil.mutListener.listen(2339) ? (secondMin == b) : (secondMin &lt; b)))))) ? secondMin : b) - 255.0) : (ListenerUtil.mutListener.listen(2344) ? (((ListenerUtil.mutListener.listen(2343) ? (secondMin &gt;= b) : (ListenerUtil.mutListener.listen(2342) ? (secondMin &lt;= b) : (ListenerUtil.mutListener.listen(2341) ? (secondMin &gt; b) : (ListenerUtil.mutListener.listen(2340) ? (secondMin != b) : (ListenerUtil.mutListener.listen(2339) ? (secondMin == b) : (secondMin &lt; b)))))) ? secondMin : b) + 255.0) : (((ListenerUtil.mutListener.listen(2343) ? (secondMin &gt;= b) : (ListenerUtil.mutListener.listen(2342) ? (secondMin &lt;= b) : (ListenerUtil.mutListener.listen(2341) ? (secondMin &gt; b) : (ListenerUtil.mutListener.listen(2340) ? (secondMin != b) : (ListenerUtil.mutListener.listen(2339) ? (secondMin == b) : (secondMin &lt; b)))))) ? secondMin : b) / 255.0)))));</span>
<span class="nc bnc" id="L172" title="All 248 branches missed.">                                double luminance = (ListenerUtil.mutListener.listen(2359) ? (((ListenerUtil.mutListener.listen(2355) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) % 2.0) : (ListenerUtil.mutListener.listen(2354) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) * 2.0) : (ListenerUtil.mutListener.listen(2353) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) - 2.0) : (ListenerUtil.mutListener.listen(2352) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) + 2.0) : (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) / 2.0)))))) % 100) : (ListenerUtil.mutListener.listen(2358) ? (((ListenerUtil.mutListener.listen(2355) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) % 2.0) : (ListenerUtil.mutListener.listen(2354) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) * 2.0) : (ListenerUtil.mutListener.listen(2353) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) - 2.0) : (ListenerUtil.mutListener.listen(2352) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) + 2.0) : (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) / 2.0)))))) / 100) : (ListenerUtil.mutListener.listen(2357) ? (((ListenerUtil.mutListener.listen(2355) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) % 2.0) : (ListenerUtil.mutListener.listen(2354) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) * 2.0) : (ListenerUtil.mutListener.listen(2353) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) - 2.0) : (ListenerUtil.mutListener.listen(2352) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) + 2.0) : (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) / 2.0)))))) - 100) : (ListenerUtil.mutListener.listen(2356) ? (((ListenerUtil.mutListener.listen(2355) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) % 2.0) : (ListenerUtil.mutListener.listen(2354) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) * 2.0) : (ListenerUtil.mutListener.listen(2353) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) - 2.0) : (ListenerUtil.mutListener.listen(2352) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) + 2.0) : (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) / 2.0)))))) + 100) : (((ListenerUtil.mutListener.listen(2355) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) % 2.0) : (ListenerUtil.mutListener.listen(2354) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) * 2.0) : (ListenerUtil.mutListener.listen(2353) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) - 2.0) : (ListenerUtil.mutListener.listen(2352) ? (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) + 2.0) : (((ListenerUtil.mutListener.listen(2351) ? (max % min) : (ListenerUtil.mutListener.listen(2350) ? (max / min) : (ListenerUtil.mutListener.listen(2349) ? (max * min) : (ListenerUtil.mutListener.listen(2348) ? (max - min) : (max + min)))))) / 2.0)))))) * 100)))));</span>
<span class="nc" id="L173">                                int highBrightnessLuminance = 40;</span>
<span class="nc" id="L174">                                int mediumBrightnessLuminance = 26;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2373)) {</span>
<span class="nc bnc" id="L176" title="All 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(2364) ? (luminance &gt;= highBrightnessLuminance) : (ListenerUtil.mutListener.listen(2363) ? (luminance &lt;= highBrightnessLuminance) : (ListenerUtil.mutListener.listen(2362) ? (luminance &gt; highBrightnessLuminance) : (ListenerUtil.mutListener.listen(2361) ? (luminance != highBrightnessLuminance) : (ListenerUtil.mutListener.listen(2360) ? (luminance == highBrightnessLuminance) : (luminance &lt; highBrightnessLuminance))))))) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2372)) {</span>
<span class="nc bnc" id="L178" title="All 22 branches missed.">                                            if ((ListenerUtil.mutListener.listen(2370) ? (luminance &gt;= mediumBrightnessLuminance) : (ListenerUtil.mutListener.listen(2369) ? (luminance &lt;= mediumBrightnessLuminance) : (ListenerUtil.mutListener.listen(2368) ? (luminance &lt; mediumBrightnessLuminance) : (ListenerUtil.mutListener.listen(2367) ? (luminance != mediumBrightnessLuminance) : (ListenerUtil.mutListener.listen(2366) ? (luminance == mediumBrightnessLuminance) : (luminance &gt; mediumBrightnessLuminance))))))) {</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(2371)) {</span>
<span class="nc" id="L180">                                                    numberOfMediumBrightnessPixels++;</span>
                                                }
                                            }
                                        }
                                    } else {
<span class="nc bnc" id="L185" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2365)) {</span>
<span class="nc" id="L186">                                            numberOfBrightPixels++;</span>
                                        }
                                    }
                                }
<span class="nc bnc" id="L190" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2385)) {</span>
<span class="nc bnc" id="L191" title="All 90 branches missed.">                                    if ((ListenerUtil.mutListener.listen(2384) ? ((ListenerUtil.mutListener.listen(2378) ? (numberOfBrightPixels &lt;= brightPixelThreshold) : (ListenerUtil.mutListener.listen(2377) ? (numberOfBrightPixels &gt; brightPixelThreshold) : (ListenerUtil.mutListener.listen(2376) ? (numberOfBrightPixels &lt; brightPixelThreshold) : (ListenerUtil.mutListener.listen(2375) ? (numberOfBrightPixels != brightPixelThreshold) : (ListenerUtil.mutListener.listen(2374) ? (numberOfBrightPixels == brightPixelThreshold) : (numberOfBrightPixels &gt;= brightPixelThreshold)))))) &amp;&amp; (ListenerUtil.mutListener.listen(2383) ? (numberOfMediumBrightnessPixels &lt;= mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2382) ? (numberOfMediumBrightnessPixels &gt; mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2381) ? (numberOfMediumBrightnessPixels &lt; mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2380) ? (numberOfMediumBrightnessPixels != mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2379) ? (numberOfMediumBrightnessPixels == mediumBrightPixelThreshold) : (numberOfMediumBrightnessPixels &gt;= mediumBrightPixelThreshold))))))) : ((ListenerUtil.mutListener.listen(2378) ? (numberOfBrightPixels &lt;= brightPixelThreshold) : (ListenerUtil.mutListener.listen(2377) ? (numberOfBrightPixels &gt; brightPixelThreshold) : (ListenerUtil.mutListener.listen(2376) ? (numberOfBrightPixels &lt; brightPixelThreshold) : (ListenerUtil.mutListener.listen(2375) ? (numberOfBrightPixels != brightPixelThreshold) : (ListenerUtil.mutListener.listen(2374) ? (numberOfBrightPixels == brightPixelThreshold) : (numberOfBrightPixels &gt;= brightPixelThreshold)))))) || (ListenerUtil.mutListener.listen(2383) ? (numberOfMediumBrightnessPixels &lt;= mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2382) ? (numberOfMediumBrightnessPixels &gt; mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2381) ? (numberOfMediumBrightnessPixels &lt; mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2380) ? (numberOfMediumBrightnessPixels != mediumBrightPixelThreshold) : (ListenerUtil.mutListener.listen(2379) ? (numberOfMediumBrightnessPixels == mediumBrightPixelThreshold) : (numberOfMediumBrightnessPixels &gt;= mediumBrightPixelThreshold))))))))) {</span>
<span class="nc" id="L192">                                        return false;</span>
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L201">        return true;</span>
    }

    /**
     * Downloads the image from the URL and sets it as the phone's wallpaper
     * Fails silently if download or setting wallpaper fails.
     *
     * @param context context
     * @param imageUrl Url of the image
     */
    public static void setWallpaperFromImageUrl(Context context, Uri imageUrl) {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2398)) {</span>
<span class="nc" id="L213">            showSettingWallpaperProgressBar(context);</span>
        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2399)) {</span>
<span class="nc" id="L216">            Timber.d(&quot;Trying to set wallpaper from url %s&quot;, imageUrl.toString());</span>
        }
<span class="nc" id="L218">        ImageRequest imageRequest = ImageRequestBuilder.newBuilderWithSource(imageUrl).setAutoRotateEnabled(true).build();</span>
<span class="nc" id="L219">        ImagePipeline imagePipeline = Fresco.getImagePipeline();</span>
<span class="nc" id="L220">        final DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt; dataSource = imagePipeline.fetchDecodedImage(imageRequest, context);</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2408)) {</span>
<span class="nc" id="L222">            dataSource.subscribe(new BaseBitmapDataSubscriber() {</span>

                @Override
                public void onNewResultImpl(@Nullable Bitmap bitmap) {
<span class="nc bnc" id="L226" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2404)) {</span>
<span class="nc bnc" id="L227" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(2400) ? (dataSource.isFinished() || bitmap != null) : (dataSource.isFinished() &amp;&amp; bitmap != null))) {</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2401)) {</span>
<span class="nc" id="L229">                                Timber.d(&quot;Bitmap loaded from url %s&quot;, imageUrl.toString());</span>
                            }
<span class="nc bnc" id="L231" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2402)) {</span>
<span class="nc" id="L232">                                setWallpaper(context, Bitmap.createBitmap(bitmap));</span>
                            }
<span class="nc bnc" id="L234" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2403)) {</span>
<span class="nc" id="L235">                                dataSource.close();</span>
                            }
                        }
                    }
<span class="nc" id="L239">                }</span>

                @Override
                public void onFailureImpl(DataSource dataSource) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2405)) {</span>
<span class="nc" id="L244">                        Timber.d(&quot;Error getting bitmap from image url %s&quot;, imageUrl.toString());</span>
                    }
<span class="nc bnc" id="L246" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2407)) {</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">                        if (dataSource != null) {</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2406)) {</span>
<span class="nc" id="L249">                                dataSource.close();</span>
                            }
                        }
                    }
<span class="nc" id="L253">                }</span>
<span class="nc" id="L254">            }, CallerThreadExecutor.getInstance());</span>
        }
<span class="nc" id="L256">    }</span>

    /**
     * Calls the set avatar api to set the image url as user's avatar
     * @param context
     * @param url
     * @param username
     * @param okHttpJsonApiClient
     * @param compositeDisposable
     */
    public static void setAvatarFromImageUrl(Context context, String url, String username, OkHttpJsonApiClient okHttpJsonApiClient, CompositeDisposable compositeDisposable) {
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2409)) {</span>
<span class="nc" id="L268">            showSettingAvatarProgressBar(context);</span>
        }
        try {
<span class="nc bnc" id="L271" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2414)) {</span>
<span class="nc" id="L272">                compositeDisposable.add(okHttpJsonApiClient.setAvatar(username, url).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(response -&gt; {</span>
<span class="nc bnc" id="L273" title="All 4 branches missed.">                    if (response != null &amp;&amp; response.getStatus().equals(&quot;200&quot;)) {</span>
<span class="nc" id="L274">                        ViewUtil.showLongToast(context, context.getString(R.string.avatar_set_successfully));</span>
<span class="nc bnc" id="L275" title="All 4 branches missed.">                        if (progressDialogAvatar != null &amp;&amp; progressDialogAvatar.isShowing()) {</span>
<span class="nc" id="L276">                            progressDialogAvatar.dismiss();</span>
                        }
                    }
<span class="nc" id="L279">                }, t -&gt; {</span>
<span class="nc" id="L280">                    Timber.e(t, &quot;Setting Avatar Failed&quot;);</span>
<span class="nc" id="L281">                    ViewUtil.showLongToast(context, context.getString(R.string.avatar_set_unsuccessfully));</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">                    if (progressDialogAvatar != null) {</span>
<span class="nc" id="L283">                        progressDialogAvatar.cancel();</span>
                    }
<span class="nc" id="L285">                }));</span>
            }
<span class="nc" id="L287">        } catch (Exception e) {</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2410)) {</span>
<span class="nc" id="L289">                Timber.d(e + &quot;success&quot;);</span>
            }
<span class="nc bnc" id="L291" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2411)) {</span>
<span class="nc" id="L292">                ViewUtil.showLongToast(context, context.getString(R.string.avatar_set_unsuccessfully));</span>
            }
<span class="nc bnc" id="L294" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2413)) {</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">                if (progressDialogAvatar != null) {</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2412)) {</span>
<span class="nc" id="L297">                        progressDialogAvatar.cancel();</span>
                    }
                }
            }
<span class="nc" id="L301">        }</span>
<span class="nc" id="L302">    }</span>

    private static void setWallpaper(Context context, Bitmap bitmap) {
<span class="nc" id="L305">        WallpaperManager wallpaperManager = WallpaperManager.getInstance(context);</span>
        try {
<span class="nc bnc" id="L307" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2419)) {</span>
<span class="nc" id="L308">                wallpaperManager.setBitmap(bitmap);</span>
            }
<span class="nc bnc" id="L310" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2420)) {</span>
<span class="nc" id="L311">                ViewUtil.showLongToast(context, context.getString(R.string.wallpaper_set_successfully));</span>
            }
<span class="nc bnc" id="L313" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2423)) {</span>
<span class="nc bnc" id="L314" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(2421) ? (progressDialogWallpaper != null || progressDialogWallpaper.isShowing()) : (progressDialogWallpaper != null &amp;&amp; progressDialogWallpaper.isShowing()))) {</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2422)) {</span>
<span class="nc" id="L316">                        progressDialogWallpaper.dismiss();</span>
                    }
                }
            }
<span class="nc" id="L320">        } catch (IOException e) {</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2415)) {</span>
<span class="nc" id="L322">                Timber.e(e, &quot;Error setting wallpaper&quot;);</span>
            }
<span class="nc bnc" id="L324" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2416)) {</span>
<span class="nc" id="L325">                ViewUtil.showLongToast(context, context.getString(R.string.wallpaper_set_unsuccessfully));</span>
            }
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2418)) {</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">                if (progressDialogWallpaper != null) {</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2417)) {</span>
<span class="nc" id="L330">                        progressDialogWallpaper.cancel();</span>
                    }
                }
            }
<span class="nc" id="L334">        }</span>
<span class="nc" id="L335">    }</span>

    private static void showSettingWallpaperProgressBar(Context context) {
<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2424)) {</span>
<span class="nc" id="L339">            progressDialogWallpaper = ProgressDialog.show(context, context.getString(R.string.setting_wallpaper_dialog_title), context.getString(R.string.setting_wallpaper_dialog_message), true);</span>
        }
<span class="nc" id="L341">    }</span>

    private static void showSettingAvatarProgressBar(Context context) {
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2425)) {</span>
<span class="nc" id="L345">            progressDialogAvatar = ProgressDialog.show(context, context.getString(R.string.setting_avatar_dialog_title), context.getString(R.string.setting_avatar_dialog_message), true);</span>
        }
<span class="nc" id="L347">    }</span>

    /**
     * Result variable is a result of an or operation of all possible problems. Ie. if result
     * is 0001 means IMAGE_DARK
     * if result is 1100 IMAGE_DUPLICATE and IMAGE_GEOLOCATION_DIFFERENT
     */
    public static String getErrorMessageForResult(Context context, @Result int result) {
<span class="nc" id="L355">        StringBuilder errorMessage = new StringBuilder();</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2477)) {</span>
<span class="nc bnc" id="L357" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(2430) ? (result &gt;= 0) : (ListenerUtil.mutListener.listen(2429) ? (result &gt; 0) : (ListenerUtil.mutListener.listen(2428) ? (result &lt; 0) : (ListenerUtil.mutListener.listen(2427) ? (result != 0) : (ListenerUtil.mutListener.listen(2426) ? (result == 0) : (result &lt;= 0))))))) {</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2476)) {</span>
<span class="nc" id="L359">                    Timber.d(&quot;No issues to warn user is found&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L362" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2431)) {</span>
<span class="nc" id="L363">                    Timber.d(&quot;Issues found to warn user&quot;);</span>
                }
<span class="nc bnc" id="L365" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2432)) {</span>
<span class="nc" id="L366">                    errorMessage.append(context.getResources().getString(R.string.upload_problem_exist));</span>
                }
<span class="nc bnc" id="L368" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2439)) {</span>
<span class="nc bnc" id="L369" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2437) ? ((IMAGE_DARK &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2436) ? ((IMAGE_DARK &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2435) ? ((IMAGE_DARK &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2434) ? ((IMAGE_DARK &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2433) ? ((IMAGE_DARK &amp; result) == 0) : ((IMAGE_DARK &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2438)) {</span>
                            // We are checking image dark bit to see if that bit is set or not
<span class="nc" id="L372">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.upload_problem_image_dark));</span>
                        }
                    }
                }
<span class="nc bnc" id="L376" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2446)) {</span>
<span class="nc bnc" id="L377" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2444) ? ((IMAGE_BLURRY &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2443) ? ((IMAGE_BLURRY &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2442) ? ((IMAGE_BLURRY &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2441) ? ((IMAGE_BLURRY &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2440) ? ((IMAGE_BLURRY &amp; result) == 0) : ((IMAGE_BLURRY &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2445)) {</span>
<span class="nc" id="L379">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.upload_problem_image_blurry));</span>
                        }
                    }
                }
<span class="nc bnc" id="L383" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2453)) {</span>
<span class="nc bnc" id="L384" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2451) ? ((IMAGE_DUPLICATE &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2450) ? ((IMAGE_DUPLICATE &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2449) ? ((IMAGE_DUPLICATE &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2448) ? ((IMAGE_DUPLICATE &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2447) ? ((IMAGE_DUPLICATE &amp; result) == 0) : ((IMAGE_DUPLICATE &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2452)) {</span>
<span class="nc" id="L386">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.upload_problem_image_duplicate));</span>
                        }
                    }
                }
<span class="nc bnc" id="L390" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2460)) {</span>
<span class="nc bnc" id="L391" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2458) ? ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2457) ? ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2456) ? ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2455) ? ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2454) ? ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) == 0) : ((IMAGE_GEOLOCATION_DIFFERENT &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2459)) {</span>
<span class="nc" id="L393">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.upload_problem_different_geolocation));</span>
                        }
                    }
                }
<span class="nc bnc" id="L397" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2467)) {</span>
<span class="nc bnc" id="L398" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2465) ? ((FILE_FBMD &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2464) ? ((FILE_FBMD &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2463) ? ((FILE_FBMD &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2462) ? ((FILE_FBMD &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2461) ? ((FILE_FBMD &amp; result) == 0) : ((FILE_FBMD &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2466)) {</span>
<span class="nc" id="L400">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.upload_problem_fbmd));</span>
                        }
                    }
                }
<span class="nc bnc" id="L404" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2474)) {</span>
<span class="nc bnc" id="L405" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(2472) ? ((FILE_NO_EXIF &amp; result) &gt;= 0) : (ListenerUtil.mutListener.listen(2471) ? ((FILE_NO_EXIF &amp; result) &lt;= 0) : (ListenerUtil.mutListener.listen(2470) ? ((FILE_NO_EXIF &amp; result) &gt; 0) : (ListenerUtil.mutListener.listen(2469) ? ((FILE_NO_EXIF &amp; result) &lt; 0) : (ListenerUtil.mutListener.listen(2468) ? ((FILE_NO_EXIF &amp; result) == 0) : ((FILE_NO_EXIF &amp; result) != 0))))))) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2473)) {</span>
<span class="nc" id="L407">                            errorMessage.append(&quot;\n - &quot;).append(context.getResources().getString(R.string.internet_downloaded));</span>
                        }
                    }
                }
<span class="nc bnc" id="L411" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2475)) {</span>
<span class="nc" id="L412">                    errorMessage.append(&quot;\n\n&quot;).append(context.getResources().getString(R.string.upload_problem_do_you_continue));</span>
                }
            }
        }
<span class="nc" id="L416">        return errorMessage.toString();</span>
    }

    /**
     * Adds red border to a bitmap
     * @param bitmap
     * @param borderSize
     * @param context
     * @return
     */
    public static Bitmap addRedBorder(Bitmap bitmap, int borderSize, Context context) {
<span class="nc bnc" id="L427" title="All 16 branches missed.">        Bitmap bmpWithBorder = Bitmap.createBitmap(bitmap.getWidth() + (ListenerUtil.mutListener.listen(2481) ? (borderSize % 2) : (ListenerUtil.mutListener.listen(2480) ? (borderSize / 2) : (ListenerUtil.mutListener.listen(2479) ? (borderSize - 2) : (ListenerUtil.mutListener.listen(2478) ? (borderSize + 2) : (borderSize * 2))))), bitmap.getHeight() + (ListenerUtil.mutListener.listen(2485) ? (borderSize % 2) : (ListenerUtil.mutListener.listen(2484) ? (borderSize / 2) : (ListenerUtil.mutListener.listen(2483) ? (borderSize - 2) : (ListenerUtil.mutListener.listen(2482) ? (borderSize + 2) : (borderSize * 2))))), bitmap.getConfig());</span>
<span class="nc" id="L428">        Canvas canvas = new Canvas(bmpWithBorder);</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2486)) {</span>
<span class="nc" id="L430">            canvas.drawColor(ContextCompat.getColor(context, R.color.deleteRed));</span>
        }
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2487)) {</span>
<span class="nc" id="L433">            canvas.drawBitmap(bitmap, borderSize, borderSize, null);</span>
        }
<span class="nc" id="L435">        return bmpWithBorder;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>