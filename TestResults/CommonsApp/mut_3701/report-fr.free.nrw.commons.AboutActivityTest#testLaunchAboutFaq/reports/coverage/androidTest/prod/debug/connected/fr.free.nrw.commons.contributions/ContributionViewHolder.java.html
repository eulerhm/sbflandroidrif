<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContributionViewHolder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.contributions</a> &gt; <span class="el_source">ContributionViewHolder.java</span></div><h1>ContributionViewHolder.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.contributions;

import android.net.Uri;
import android.text.TextUtils;
import android.view.View;
import android.webkit.URLUtil;
import android.widget.ImageButton;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.TextView;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AlertDialog.Builder;
import androidx.recyclerview.widget.RecyclerView;
import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;
import com.facebook.drawee.view.SimpleDraweeView;
import com.facebook.imagepipeline.request.ImageRequest;
import com.facebook.imagepipeline.request.ImageRequestBuilder;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.contributions.ContributionsListAdapter.Callback;
import fr.free.nrw.commons.media.MediaClient;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.CompositeDisposable;
import io.reactivex.schedulers.Schedulers;
import java.io.File;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class ContributionViewHolder extends RecyclerView.ViewHolder {

    private final Callback callback;

    @BindView(R.id.contributionImage)
    SimpleDraweeView imageView;

    @BindView(R.id.contributionTitle)
    TextView titleView;

    @BindView(R.id.authorView)
    TextView authorView;

    @BindView(R.id.contributionState)
    TextView stateView;

    @BindView(R.id.contributionSequenceNumber)
    TextView seqNumView;

    @BindView(R.id.contributionProgress)
    ProgressBar progressView;

    @BindView(R.id.image_options)
    RelativeLayout imageOptions;

    @BindView(R.id.wikipediaButton)
    ImageButton addToWikipediaButton;

    @BindView(R.id.retryButton)
    ImageButton retryButton;

    @BindView(R.id.cancelButton)
    ImageButton cancelButton;

    @BindView(R.id.pauseResumeButton)
    ImageButton pauseResumeButton;

    private int position;

    private Contribution contribution;

<span class="nc" id="L71">    private final CompositeDisposable compositeDisposable = new CompositeDisposable();</span>

    private final MediaClient mediaClient;

    private boolean isWikipediaButtonDisplayed;

    private AlertDialog pausingPopUp;

    private View parent;

    private ImageRequest imageRequest;

    ContributionViewHolder(final View parent, final Callback callback, final MediaClient mediaClient) {
<span class="nc" id="L84">        super(parent);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1160)) {</span>
<span class="nc" id="L86">            this.parent = parent;</span>
        }
<span class="nc" id="L88">        this.mediaClient = mediaClient;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1161)) {</span>
<span class="nc" id="L90">            ButterKnife.bind(this, parent);</span>
        }
<span class="nc" id="L92">        this.callback = callback;</span>
        /* Set a dialog indicating that the upload is being paused. This is needed because pausing
        an upload might take a dozen seconds. */
<span class="nc" id="L95">        AlertDialog.Builder builder = new Builder(parent.getContext());</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1162)) {</span>
<span class="nc" id="L97">            builder.setCancelable(false);</span>
        }
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1163)) {</span>
<span class="nc" id="L100">            builder.setView(R.layout.progress_dialog);</span>
        }
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1164)) {</span>
<span class="nc" id="L103">            pausingPopUp = builder.create();</span>
        }
<span class="nc" id="L105">    }</span>

    public void init(final int position, final Contribution contribution) {
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1165)) {</span>
            // handling crashes when the contribution is null.
<span class="nc bnc" id="L110" title="All 2 branches missed.">            if (null == contribution) {</span>
<span class="nc" id="L111">                return;</span>
            }
        }
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1166)) {</span>
<span class="nc" id="L115">            this.contribution = contribution;</span>
        }
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1167)) {</span>
<span class="nc" id="L118">            this.position = position;</span>
        }
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1168)) {</span>
<span class="nc" id="L121">            titleView.setText(contribution.getMedia().getMostRelevantCaption());</span>
        }
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1169)) {</span>
<span class="nc" id="L124">            authorView.setText(contribution.getMedia().getAuthor());</span>
        }
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1170)) {</span>
            // Removes flicker of loading image.
<span class="nc" id="L128">            imageView.getHierarchy().setFadeDuration(0);</span>
        }
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1171)) {</span>
<span class="nc" id="L131">            imageView.getHierarchy().setPlaceholderImage(R.drawable.image_placeholder);</span>
        }
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1172)) {</span>
<span class="nc" id="L134">            imageView.getHierarchy().setFailureImage(R.drawable.image_placeholder);</span>
        }
<span class="nc" id="L136">        final String imageSource = chooseImageSource(contribution.getMedia().getThumbUrl(), contribution.getLocalUri());</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1178)) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            if (!TextUtils.isEmpty(imageSource)) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1175)) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                    if (URLUtil.isHttpsUrl(imageSource)) {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1174)) {</span>
<span class="nc" id="L142">                            imageRequest = ImageRequestBuilder.newBuilderWithSource(Uri.parse(imageSource)).setProgressiveRenderingEnabled(true).build();</span>
                        }
<span class="nc bnc" id="L144" title="All 2 branches missed.">                    } else if (imageSource != null) {</span>
<span class="nc" id="L145">                        final File file = new File(imageSource);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1173)) {</span>
<span class="nc" id="L147">                            imageRequest = ImageRequest.fromFile(file);</span>
                        }
                    }
                }
<span class="nc bnc" id="L151" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1177)) {</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">                    if (imageRequest != null) {</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1176)) {</span>
<span class="nc" id="L154">                            imageView.setImageRequest(imageRequest);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1183)) {</span>
<span class="nc bnc" id="L161" title="All 8 branches missed.">            seqNumView.setText(String.valueOf((ListenerUtil.mutListener.listen(1182) ? (position % 1) : (ListenerUtil.mutListener.listen(1181) ? (position / 1) : (ListenerUtil.mutListener.listen(1180) ? (position * 1) : (ListenerUtil.mutListener.listen(1179) ? (position - 1) : (position + 1)))))));</span>
        }
<span class="nc bnc" id="L163" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1184)) {</span>
<span class="nc" id="L164">            seqNumView.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1185)) {</span>
<span class="nc" id="L167">            addToWikipediaButton.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1242)) {</span>
<span class="nc bnc" id="L170" title="All 6 branches missed.">            switch(contribution.getState()) {</span>
                case Contribution.STATE_COMPLETED:
<span class="nc bnc" id="L172" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1186)) {</span>
<span class="nc" id="L173">                        stateView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L175" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1187)) {</span>
<span class="nc" id="L176">                        progressView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L178" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1188)) {</span>
<span class="nc" id="L179">                        imageOptions.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L181" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1189)) {</span>
<span class="nc" id="L182">                        stateView.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L184" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1190)) {</span>
<span class="nc" id="L185">                        checkIfMediaExistsOnWikipediaPage(contribution);</span>
                    }
                    break;
                case Contribution.STATE_QUEUED:
                case Contribution.STATE_QUEUED_LIMITED_CONNECTION_MODE:
<span class="nc bnc" id="L190" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1191)) {</span>
<span class="nc" id="L191">                        progressView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L193" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1192)) {</span>
<span class="nc" id="L194">                        stateView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L196" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1193)) {</span>
<span class="nc" id="L197">                        stateView.setText(R.string.contribution_state_queued);</span>
                    }
<span class="nc bnc" id="L199" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1194)) {</span>
<span class="nc" id="L200">                        imageOptions.setVisibility(View.GONE);</span>
                    }
                    break;
                case Contribution.STATE_IN_PROGRESS:
<span class="nc bnc" id="L204" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1195)) {</span>
<span class="nc" id="L205">                        stateView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L207" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1196)) {</span>
<span class="nc" id="L208">                        progressView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L210" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1197)) {</span>
<span class="nc" id="L211">                        addToWikipediaButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L213" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1198)) {</span>
<span class="nc" id="L214">                        pauseResumeButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L216" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1199)) {</span>
<span class="nc" id="L217">                        cancelButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L219" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1200)) {</span>
<span class="nc" id="L220">                        retryButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L222" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1201)) {</span>
<span class="nc" id="L223">                        imageOptions.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc" id="L225">                    final long total = contribution.getDataLength();</span>
<span class="nc" id="L226">                    final long transferred = contribution.getTransferred();</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1224)) {</span>
<span class="nc bnc" id="L228" title="All 90 branches missed.">                        if ((ListenerUtil.mutListener.listen(1212) ? ((ListenerUtil.mutListener.listen(1206) ? (transferred &gt;= 0) : (ListenerUtil.mutListener.listen(1205) ? (transferred &lt;= 0) : (ListenerUtil.mutListener.listen(1204) ? (transferred &gt; 0) : (ListenerUtil.mutListener.listen(1203) ? (transferred &lt; 0) : (ListenerUtil.mutListener.listen(1202) ? (transferred != 0) : (transferred == 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(1211) ? (transferred &lt;= total) : (ListenerUtil.mutListener.listen(1210) ? (transferred &gt; total) : (ListenerUtil.mutListener.listen(1209) ? (transferred &lt; total) : (ListenerUtil.mutListener.listen(1208) ? (transferred != total) : (ListenerUtil.mutListener.listen(1207) ? (transferred == total) : (transferred &gt;= total))))))) : ((ListenerUtil.mutListener.listen(1206) ? (transferred &gt;= 0) : (ListenerUtil.mutListener.listen(1205) ? (transferred &lt;= 0) : (ListenerUtil.mutListener.listen(1204) ? (transferred &gt; 0) : (ListenerUtil.mutListener.listen(1203) ? (transferred &lt; 0) : (ListenerUtil.mutListener.listen(1202) ? (transferred != 0) : (transferred == 0)))))) || (ListenerUtil.mutListener.listen(1211) ? (transferred &lt;= total) : (ListenerUtil.mutListener.listen(1210) ? (transferred &gt; total) : (ListenerUtil.mutListener.listen(1209) ? (transferred &lt; total) : (ListenerUtil.mutListener.listen(1208) ? (transferred != total) : (ListenerUtil.mutListener.listen(1207) ? (transferred == total) : (transferred &gt;= total))))))))) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1223)) {</span>
<span class="nc" id="L230">                                progressView.setIndeterminate(true);</span>
                            }
                        } else {
<span class="nc bnc" id="L233" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1213)) {</span>
<span class="nc" id="L234">                                progressView.setIndeterminate(false);</span>
                            }
<span class="nc bnc" id="L236" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1222)) {</span>
<span class="nc bnc" id="L237" title="All 48 branches missed.">                                progressView.setProgress((int) ((ListenerUtil.mutListener.listen(1221) ? (((ListenerUtil.mutListener.listen(1217) ? ((double) transferred % (double) total) : (ListenerUtil.mutListener.listen(1216) ? ((double) transferred * (double) total) : (ListenerUtil.mutListener.listen(1215) ? ((double) transferred - (double) total) : (ListenerUtil.mutListener.listen(1214) ? ((double) transferred + (double) total) : ((double) transferred / (double) total)))))) % 100) : (ListenerUtil.mutListener.listen(1220) ? (((ListenerUtil.mutListener.listen(1217) ? ((double) transferred % (double) total) : (ListenerUtil.mutListener.listen(1216) ? ((double) transferred * (double) total) : (ListenerUtil.mutListener.listen(1215) ? ((double) transferred - (double) total) : (ListenerUtil.mutListener.listen(1214) ? ((double) transferred + (double) total) : ((double) transferred / (double) total)))))) / 100) : (ListenerUtil.mutListener.listen(1219) ? (((ListenerUtil.mutListener.listen(1217) ? ((double) transferred % (double) total) : (ListenerUtil.mutListener.listen(1216) ? ((double) transferred * (double) total) : (ListenerUtil.mutListener.listen(1215) ? ((double) transferred - (double) total) : (ListenerUtil.mutListener.listen(1214) ? ((double) transferred + (double) total) : ((double) transferred / (double) total)))))) - 100) : (ListenerUtil.mutListener.listen(1218) ? (((ListenerUtil.mutListener.listen(1217) ? ((double) transferred % (double) total) : (ListenerUtil.mutListener.listen(1216) ? ((double) transferred * (double) total) : (ListenerUtil.mutListener.listen(1215) ? ((double) transferred - (double) total) : (ListenerUtil.mutListener.listen(1214) ? ((double) transferred + (double) total) : ((double) transferred / (double) total)))))) + 100) : (((ListenerUtil.mutListener.listen(1217) ? ((double) transferred % (double) total) : (ListenerUtil.mutListener.listen(1216) ? ((double) transferred * (double) total) : (ListenerUtil.mutListener.listen(1215) ? ((double) transferred - (double) total) : (ListenerUtil.mutListener.listen(1214) ? ((double) transferred + (double) total) : ((double) transferred / (double) total)))))) * 100)))))));</span>
                            }
                        }
                    }
                    break;
                case Contribution.STATE_PAUSED:
<span class="nc bnc" id="L243" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1225)) {</span>
<span class="nc" id="L244">                        progressView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L246" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1226)) {</span>
<span class="nc" id="L247">                        stateView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L249" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1227)) {</span>
<span class="nc" id="L250">                        stateView.setText(R.string.paused);</span>
                    }
<span class="nc bnc" id="L252" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1228)) {</span>
<span class="nc" id="L253">                        cancelButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L255" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1229)) {</span>
<span class="nc" id="L256">                        retryButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L258" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1230)) {</span>
<span class="nc" id="L259">                        pauseResumeButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L261" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1231)) {</span>
<span class="nc" id="L262">                        imageOptions.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L264" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1232)) {</span>
<span class="nc" id="L265">                        setResume();</span>
                    }
<span class="nc bnc" id="L267" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1234)) {</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">                        if (pausingPopUp.isShowing()) {</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1233)) {</span>
<span class="nc" id="L270">                                pausingPopUp.hide();</span>
                            }
                        }
                    }
                    break;
                case Contribution.STATE_FAILED:
<span class="nc bnc" id="L276" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1235)) {</span>
<span class="nc" id="L277">                        stateView.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L279" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1236)) {</span>
<span class="nc" id="L280">                        stateView.setText(R.string.contribution_state_failed);</span>
                    }
<span class="nc bnc" id="L282" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1237)) {</span>
<span class="nc" id="L283">                        progressView.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L285" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1238)) {</span>
<span class="nc" id="L286">                        cancelButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L288" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1239)) {</span>
<span class="nc" id="L289">                        retryButton.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L291" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1240)) {</span>
<span class="nc" id="L292">                        pauseResumeButton.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L294" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1241)) {</span>
<span class="nc" id="L295">                        imageOptions.setVisibility(View.VISIBLE);</span>
                    }
                    break;
            }
        }
<span class="nc" id="L300">    }</span>

    /**
     * Checks if a media exists on the corresponding Wikipedia article Currently the check is made
     * for the device's current language Wikipedia
     *
     * @param contribution
     */
    private void checkIfMediaExistsOnWikipediaPage(final Contribution contribution) {
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1244)) {</span>
<span class="nc bnc" id="L310" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1243) ? (contribution.getWikidataPlace() == null &amp;&amp; contribution.getWikidataPlace().getWikipediaArticle() == null) : (contribution.getWikidataPlace() == null || contribution.getWikidataPlace().getWikipediaArticle() == null))) {</span>
<span class="nc" id="L311">                return;</span>
            }
        }
<span class="nc" id="L314">        final String wikipediaArticle = contribution.getWikidataPlace().getWikipediaPageTitle();</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1245)) {</span>
<span class="nc" id="L316">            compositeDisposable.add(mediaClient.doesPageContainMedia(wikipediaArticle).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(mediaExists -&gt; {</span>
<span class="nc" id="L317">                displayWikipediaButton(mediaExists);</span>
<span class="nc" id="L318">            }));</span>
        }
<span class="nc" id="L320">    }</span>

    /**
     * Handle action buttons visibility if the corresponding wikipedia page doesn't contain any
     * media. This method needs to control the state of just the scenario where media does not
     * exists as other scenarios are already handled in the init method.
     *
     * @param mediaExists
     */
    private void displayWikipediaButton(Boolean mediaExists) {
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1251)) {</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">            if (!mediaExists) {</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1246)) {</span>
<span class="nc" id="L333">                    addToWikipediaButton.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L335" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1247)) {</span>
<span class="nc" id="L336">                    isWikipediaButtonDisplayed = true;</span>
                }
<span class="nc bnc" id="L338" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1248)) {</span>
<span class="nc" id="L339">                    cancelButton.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L341" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1249)) {</span>
<span class="nc" id="L342">                    retryButton.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L344" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1250)) {</span>
<span class="nc" id="L345">                    imageOptions.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc" id="L349">    }</span>

    /**
     * Returns the image source for the image view, first preference is given to thumbUrl if that is
     * null, moves to local uri and if both are null return null
     *
     * @param thumbUrl
     * @param localUri
     * @return
     */
    @Nullable
    private String chooseImageSource(final String thumbUrl, final Uri localUri) {
<span class="nc bnc" id="L361" title="All 4 branches missed.">        return !TextUtils.isEmpty(thumbUrl) ? thumbUrl : localUri != null ? localUri.toString() : null;</span>
    }

    /**
     * Retry upload when it is failed
     */
    @OnClick(R.id.retryButton)
    public void retryUpload() {
<span class="nc bnc" id="L369" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1252)) {</span>
<span class="nc" id="L370">            callback.retryUpload(contribution);</span>
        }
<span class="nc" id="L372">    }</span>

    /**
     * Delete a failed upload attempt
     */
    @OnClick(R.id.cancelButton)
    public void deleteUpload() {
<span class="nc bnc" id="L379" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1253)) {</span>
<span class="nc" id="L380">            callback.deleteUpload(contribution);</span>
        }
<span class="nc" id="L382">    }</span>

    @OnClick(R.id.contributionImage)
    public void imageClicked() {
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1254)) {</span>
<span class="nc" id="L387">            callback.openMediaDetail(position, isWikipediaButtonDisplayed);</span>
        }
<span class="nc" id="L389">    }</span>

    @OnClick(R.id.wikipediaButton)
    public void wikipediaButtonClicked() {
<span class="nc bnc" id="L393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1255)) {</span>
<span class="nc" id="L394">            callback.addImageToWikipedia(contribution);</span>
        }
<span class="nc" id="L396">    }</span>

    /**
     * Triggers a callback for pause/resume
     */
    @OnClick(R.id.pauseResumeButton)
    public void onPauseResumeButtonClicked() {
<span class="nc bnc" id="L403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1258)) {</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (pauseResumeButton.getTag().toString().equals(&quot;pause&quot;)) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1257)) {</span>
<span class="nc" id="L406">                    pause();</span>
                }
            } else {
<span class="nc bnc" id="L409" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1256)) {</span>
<span class="nc" id="L410">                    resume();</span>
                }
            }
        }
<span class="nc" id="L414">    }</span>

    private void resume() {
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1259)) {</span>
<span class="nc" id="L418">            callback.resumeUpload(contribution);</span>
        }
<span class="nc bnc" id="L420" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1260)) {</span>
<span class="nc" id="L421">            setPaused();</span>
        }
<span class="nc" id="L423">    }</span>

    private void pause() {
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1261)) {</span>
<span class="nc" id="L427">            pausingPopUp.show();</span>
        }
<span class="nc bnc" id="L429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1262)) {</span>
<span class="nc" id="L430">            callback.pauseUpload(contribution);</span>
        }
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1263)) {</span>
<span class="nc" id="L433">            setResume();</span>
        }
<span class="nc" id="L435">    }</span>

    /**
     * Update pause/resume button to show pause state
     */
    private void setPaused() {
<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1264)) {</span>
<span class="nc" id="L442">            pauseResumeButton.setImageResource(R.drawable.pause_icon);</span>
        }
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1265)) {</span>
<span class="nc" id="L445">            pauseResumeButton.setTag(parent.getContext().getString(R.string.pause));</span>
        }
<span class="nc" id="L447">    }</span>

    /**
     * Update pause/resume button to show resume state
     */
    private void setResume() {
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1266)) {</span>
<span class="nc" id="L454">            pauseResumeButton.setImageResource(R.drawable.play_icon);</span>
        }
<span class="nc bnc" id="L456" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1267)) {</span>
<span class="nc" id="L457">            pauseResumeButton.setTag(parent.getContext().getString(R.string.resume));</span>
        }
<span class="nc" id="L459">    }</span>

    public ImageRequest getImageRequest() {
<span class="nc" id="L462">        return imageRequest;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>