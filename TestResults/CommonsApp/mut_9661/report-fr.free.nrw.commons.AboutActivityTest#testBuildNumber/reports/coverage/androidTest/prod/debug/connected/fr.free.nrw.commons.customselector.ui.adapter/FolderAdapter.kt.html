<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FolderAdapter.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.customselector.ui.adapter</a> &gt; <span class="el_source">FolderAdapter.kt</span></div><h1>FolderAdapter.kt</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.customselector.ui.adapter

import android.content.Context
import android.view.View
import android.view.ViewGroup
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.DiffUtil
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import fr.free.nrw.commons.R
import fr.free.nrw.commons.customselector.listeners.FolderClickListener
import fr.free.nrw.commons.customselector.model.Folder
import fr.free.nrw.commons.customselector.model.Image

/**
 * Custom selector FolderAdapter.
 */
<span class="nc" id="L19">class FolderAdapter(</span>
    /**
     * Application context.
     */
    context: Context,

    /**
     * Folder Click listener for click events.
     */
<span class="nc" id="L28">    private val itemClickListener: FolderClickListener</span>

<span class="nc" id="L30">) : RecyclerViewAdapter&lt;FolderAdapter.FolderViewHolder?&gt;(context) {</span>

    /**
     * List of folders.
     */
<span class="nc" id="L35">    private var folders: MutableList&lt;Folder&gt; = mutableListOf()</span>

    /**
     * Create view holder, returns View holder item.
     */
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): FolderViewHolder {
<span class="nc" id="L41">        val itemView = inflater.inflate(R.layout.item_custom_selector_folder, parent, false)</span>
<span class="nc" id="L42">        return FolderViewHolder(itemView)</span>
    }

    /**
     * Bind view holder, setup the item view, title, count and click listener
     */
    override fun onBindViewHolder(holder: FolderViewHolder, position: Int) {
<span class="nc" id="L49">        val folder = folders[position]</span>
<span class="nc" id="L50">        val toBeRemoved = ArrayList&lt;Image&gt;()</span>

<span class="nc bnc" id="L52" title="All 2 branches missed.">        for(image in folder.images) {</span>
            // Remove all the top images that do not exist anymore
<span class="nc bnc" id="L54" title="All 2 branches missed.">            if(context.contentResolver.getType(image.uri) == null){</span>
                // File not found
<span class="nc" id="L56">                toBeRemoved.add(image)</span>
            } else {
<span class="nc" id="L58">                break</span>
            }
        }
<span class="nc" id="L61">        holder.image.setImageDrawable (null)</span>
<span class="nc" id="L62">        folder.images.removeAll(toBeRemoved)</span>
<span class="nc" id="L63">        val count = folder.images.size</span>

<span class="nc bnc" id="L65" title="All 2 branches missed.">        if(count == 0) {</span>
            // Folder is empty, remove folder from the adapter.
<span class="nc" id="L67">            holder.itemView.post{</span>
<span class="nc" id="L68">                val updatePosition = folders.indexOf(folder)</span>
<span class="nc" id="L69">                folders.removeAt(updatePosition)</span>
<span class="nc" id="L70">                notifyItemRemoved(updatePosition)</span>
<span class="nc" id="L71">                notifyItemRangeChanged(updatePosition, folders.size)</span>
<span class="nc" id="L72">            }</span>
        } else {
<span class="nc" id="L74">            val previewImage = folder.images[0]</span>
<span class="nc" id="L75">            Glide.with(holder.image).load(previewImage.uri).into(holder.image)</span>
<span class="nc" id="L76">            holder.name.text = folder.name</span>
<span class="nc" id="L77">            holder.count.text = count.toString()</span>
<span class="nc" id="L78">            holder.itemView.setOnClickListener {</span>
<span class="nc" id="L79">                itemClickListener.onFolderClick(folder.bucketId, folder.name, 0)</span>
<span class="nc" id="L80">            }</span>
        }
<span class="nc" id="L82">    }</span>

    /**
     * Initialise the data set.
     */
    fun init(newFolders: List&lt;Folder&gt;) {
<span class="nc" id="L88">        val oldFolderList: MutableList&lt;Folder&gt; = folders</span>
<span class="nc" id="L89">        val newFolderList = newFolders.toMutableList()</span>
<span class="nc" id="L90">        val diffResult = DiffUtil.calculateDiff(</span>
<span class="nc" id="L91">            FoldersDiffCallback(oldFolderList, newFolderList)</span>
        )
<span class="nc" id="L93">        folders = newFolderList</span>
<span class="nc" id="L94">        diffResult.dispatchUpdatesTo(this)</span>
<span class="nc" id="L95">    }</span>

    /**
     * returns item count.
     */
    override fun getItemCount(): Int {
<span class="nc" id="L101">        return folders.size</span>
    }

    /**
     * Folder view holder.
     */
<span class="nc" id="L107">    class FolderViewHolder(itemView:View) : RecyclerView.ViewHolder(itemView) {</span>

        /**
         * Folder thumbnail image view.
         */
<span class="nc" id="L112">        val image: ImageView = itemView.findViewById(R.id.folder_thumbnail)</span>

        /**
         * Folder/album name
         */
<span class="nc" id="L117">        val name: TextView = itemView.findViewById(R.id.folder_name)</span>

        /**
         * Item count in Folder/Item
         */
<span class="nc" id="L122">        val count: TextView = itemView.findViewById(R.id.folder_count)</span>
    }

    /**
     * DiffUtilCallback.
     */
<span class="nc" id="L128">    class FoldersDiffCallback(</span>
<span class="nc" id="L129">        var oldFolders: MutableList&lt;Folder&gt;,</span>
<span class="nc" id="L130">        var newFolders: MutableList&lt;Folder&gt;</span>
<span class="nc" id="L131">    ) : DiffUtil.Callback() {</span>
        /**
         * Returns the size of the old list.
         */
        override fun getOldListSize(): Int {
<span class="nc" id="L136">            return oldFolders.size</span>
        }

        /**
         * Returns the size of the new list.
         */
        override fun getNewListSize(): Int {
<span class="nc" id="L143">            return newFolders.size</span>
        }

        /**
         * Called by the DiffUtil to decide whether two object represent the same Item.
         */
        override fun areItemsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
<span class="nc bnc" id="L150" title="All 2 branches missed.">            return oldFolders.get(oldItemPosition).bucketId == newFolders.get(newItemPosition).bucketId</span>
        }

        /**
         * Called by the DiffUtil when it wants to check whether two items have the same data.
         * DiffUtil uses this information to detect if the contents of an item has changed.
         */
        override fun areContentsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
<span class="nc" id="L158">            return oldFolders.get(oldItemPosition).equals(newFolders.get(newItemPosition))</span>
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>