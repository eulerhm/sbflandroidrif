<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LeaderboardFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.profile.leaderboard</a> &gt; <span class="el_source">LeaderboardFragment.java</span></div><h1>LeaderboardFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.profile.leaderboard;

import static fr.free.nrw.commons.profile.leaderboard.LeaderboardConstants.LOADED;
import static fr.free.nrw.commons.profile.leaderboard.LeaderboardConstants.LOADING;
import static fr.free.nrw.commons.profile.leaderboard.LeaderboardConstants.PAGE_SIZE;
import static fr.free.nrw.commons.profile.leaderboard.LeaderboardConstants.START_OFFSET;
import android.accounts.Account;
import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemSelectedListener;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ProgressBar;
import android.widget.Spinner;
import android.widget.Toast;
import androidx.annotation.Nullable;
import androidx.lifecycle.ViewModelProvider;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.MergeAdapter;
import androidx.recyclerview.widget.RecyclerView;
import butterknife.BindView;
import butterknife.ButterKnife;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.auth.SessionManager;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.mwapi.OkHttpJsonApiClient;
import fr.free.nrw.commons.profile.ProfileActivity;
import fr.free.nrw.commons.utils.ConfigUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.CompositeDisposable;
import io.reactivex.schedulers.Schedulers;
import java.util.Objects;
import javax.inject.Inject;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * This class extends the CommonsDaggerSupportFragment and creates leaderboard fragment
 */
<span class="fc" id="L45">public class LeaderboardFragment extends CommonsDaggerSupportFragment {</span>

    @BindView(R.id.leaderboard_list)
    RecyclerView leaderboardListRecyclerView;

    @BindView(R.id.progressBar)
    ProgressBar progressBar;

    @BindView(R.id.category_spinner)
    Spinner categorySpinner;

    @BindView(R.id.duration_spinner)
    Spinner durationSpinner;

    @BindView(R.id.scroll)
    Button scrollButton;

    @Inject
    SessionManager sessionManager;

    @Inject
    OkHttpJsonApiClient okHttpJsonApiClient;

    @Inject
    ViewModelFactory viewModelFactory;

    /**
     * View model for the paged leaderboard list
     */
    private LeaderboardListViewModel viewModel;

    /**
     * Composite disposable for API call
     */
<span class="fc" id="L79">    private CompositeDisposable compositeDisposable = new CompositeDisposable();</span>

    /**
     * Duration of the leaderboard API
     */
    private String duration;

    /**
     * Category of the Leaderboard API
     */
    private String category;

    /**
     * Page size of the leaderboard API
     */
<span class="fc" id="L94">    private int limit = PAGE_SIZE;</span>

    /**
     * offset for the leaderboard API
     */
<span class="fc" id="L99">    private int offset = START_OFFSET;</span>

    /**
     * Set initial User Rank to 0
     */
    private int userRank;

    /**
     * This variable represents if user wants to scroll to his rank or not
     */
    private boolean scrollToRank;

    private String userName;

    @Override
    public void onCreate(@Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5357)) {</span>
<span class="fc" id="L116">            super.onCreate(savedInstanceState);</span>
        }
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5359)) {</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">            if (getArguments() != null) {</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5358)) {</span>
<span class="fc" id="L121">                    userName = getArguments().getString(ProfileActivity.KEY_USERNAME);</span>
                }
            }
        }
<span class="fc" id="L125">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
<span class="fc" id="L129">        View rootView = inflater.inflate(R.layout.fragment_leaderboard, container, false);</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5360)) {</span>
<span class="fc" id="L131">            ButterKnife.bind(this, rootView);</span>
        }
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5361)) {</span>
<span class="fc" id="L134">            hideLayouts();</span>
        }
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5364)) {</span>
            // Leaderboard currently unimplemented in Beta flavor. Skip all API calls and disable menu
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">            if (ConfigUtils.isBetaFlavour()) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5362)) {</span>
<span class="nc" id="L140">                    progressBar.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L142" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5363)) {</span>
<span class="nc" id="L143">                    scrollButton.setVisibility(View.GONE);</span>
                }
<span class="nc" id="L145">                return rootView;</span>
            }
        }
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5365)) {</span>
<span class="fc" id="L149">            progressBar.setVisibility(View.VISIBLE);</span>
        }
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5366)) {</span>
<span class="fc" id="L152">            setSpinners();</span>
        }
        /**
         * This array is for the duration filter, we have three filters weekly, yearly and all-time
         * each filter have a key and value pair, the value represents the param of the API
         */
<span class="fc" id="L158">        String[] durationValues = getContext().getResources().getStringArray(R.array.leaderboard_duration_values);</span>
        /**
         * This array is for the category filter, we have three filters upload, used and nearby
         * each filter have a key and value pair, the value represents the param of the API
         */
<span class="fc" id="L163">        String[] categoryValues = getContext().getResources().getStringArray(R.array.leaderboard_category_values);</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5367)) {</span>
<span class="fc" id="L165">            duration = durationValues[0];</span>
        }
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5368)) {</span>
<span class="fc" id="L168">            category = categoryValues[0];</span>
        }
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5369)) {</span>
<span class="fc" id="L171">            setLeaderboard(duration, category, limit, offset);</span>
        }
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5372)) {</span>
<span class="fc" id="L174">            durationSpinner.setOnItemSelectedListener(new OnItemSelectedListener() {</span>

                @Override
                public void onItemSelected(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5370)) {</span>
<span class="fc" id="L179">                        duration = durationValues[durationSpinner.getSelectedItemPosition()];</span>
                    }
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5371)) {</span>
<span class="fc" id="L182">                        refreshLeaderboard();</span>
                    }
<span class="fc" id="L184">                }</span>

                @Override
                public void onNothingSelected(AdapterView&lt;?&gt; adapterView) {
<span class="nc" id="L188">                }</span>
            });
        }
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5375)) {</span>
<span class="fc" id="L192">            categorySpinner.setOnItemSelectedListener(new OnItemSelectedListener() {</span>

                @Override
                public void onItemSelected(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5373)) {</span>
<span class="fc" id="L197">                        category = categoryValues[categorySpinner.getSelectedItemPosition()];</span>
                    }
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5374)) {</span>
<span class="fc" id="L200">                        refreshLeaderboard();</span>
                    }
<span class="fc" id="L202">                }</span>

                @Override
                public void onNothingSelected(AdapterView&lt;?&gt; adapterView) {
<span class="nc" id="L206">                }</span>
            });
        }
<span class="pc bpc" id="L209" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5376)) {</span>
<span class="pc" id="L210">            scrollButton.setOnClickListener(view -&gt; scrollToUserRank());</span>
        }
<span class="fc" id="L212">        return rootView;</span>
    }

    @Override
    public void setMenuVisibility(boolean visible) {
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5377)) {</span>
<span class="fc" id="L218">            super.setMenuVisibility(visible);</span>
        }
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5385)) {</span>
            // notify Beta users the page data is unavailable
<span class="pc bpc" id="L222" title="8 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5378) ? (ConfigUtils.isBetaFlavour() || visible) : (ConfigUtils.isBetaFlavour() &amp;&amp; visible))) {</span>
<span class="nc" id="L223">                Context ctx = null;</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5382)) {</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                    if (getContext() != null) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5381)) {</span>
<span class="nc" id="L227">                            ctx = getContext();</span>
                        }
<span class="nc bnc" id="L229" title="All 10 branches missed.">                    } else if ((ListenerUtil.mutListener.listen(5379) ? (getView() != null || getView().getContext() != null) : (getView() != null &amp;&amp; getView().getContext() != null))) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5380)) {</span>
<span class="nc" id="L231">                            ctx = getView().getContext();</span>
                        }
                    }
                }
<span class="nc bnc" id="L235" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5384)) {</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                    if (ctx != null) {</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5383)) {</span>
<span class="nc" id="L238">                            Toast.makeText(ctx, R.string.leaderboard_unavailable_beta, Toast.LENGTH_LONG).show();</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L244">    }</span>

    /**
     * Refreshes the leaderboard list
     */
    private void refreshLeaderboard() {
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5386)) {</span>
<span class="fc" id="L251">            scrollToRank = false;</span>
        }
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5389)) {</span>
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">            if (viewModel != null) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5387)) {</span>
<span class="nc" id="L256">                    viewModel.refresh(duration, category, limit, offset);</span>
                }
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5388)) {</span>
<span class="nc" id="L259">                    setLeaderboard(duration, category, limit, offset);</span>
                }
            }
        }
<span class="fc" id="L263">    }</span>

    /**
     * Performs Auto Scroll to the User's Rank
     * We use userRank+1 to load one extra user and prevent overlapping of my rank button
     * If you are viewing the leaderboard below userRank, it scrolls to the user rank at the top
     */
    private void scrollToUserRank() {
<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5423)) {</span>
<span class="nc bnc" id="L272" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(5394) ? (userRank &gt;= 0) : (ListenerUtil.mutListener.listen(5393) ? (userRank &lt;= 0) : (ListenerUtil.mutListener.listen(5392) ? (userRank &gt; 0) : (ListenerUtil.mutListener.listen(5391) ? (userRank &lt; 0) : (ListenerUtil.mutListener.listen(5390) ? (userRank != 0) : (userRank == 0))))))) {</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5422)) {</span>
<span class="nc" id="L274">                    Toast.makeText(getContext(), R.string.no_achievements_yet, Toast.LENGTH_SHORT).show();</span>
                }
            } else {
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5421)) {</span>
<span class="nc bnc" id="L278" title="All 70 branches missed.">                    if ((ListenerUtil.mutListener.listen(5403) ? (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() &gt;= (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))) : (ListenerUtil.mutListener.listen(5402) ? (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() &lt;= (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))) : (ListenerUtil.mutListener.listen(5401) ? (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() &lt; (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))) : (ListenerUtil.mutListener.listen(5400) ? (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() != (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))) : (ListenerUtil.mutListener.listen(5399) ? (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() == (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))) : (Objects.requireNonNull(leaderboardListRecyclerView.getAdapter()).getItemCount() &gt; (ListenerUtil.mutListener.listen(5398) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5397) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5396) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5395) ? (userRank - 1) : (userRank + 1)))))))))))) {</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5420)) {</span>
<span class="nc bnc" id="L280" title="All 8 branches missed.">                            leaderboardListRecyclerView.smoothScrollToPosition((ListenerUtil.mutListener.listen(5419) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5418) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5417) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5416) ? (userRank - 1) : (userRank + 1))))));</span>
                        }
                    } else {
<span class="nc bnc" id="L283" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5415)) {</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">                            if (viewModel != null) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5408)) {</span>
<span class="nc bnc" id="L286" title="All 8 branches missed.">                                    viewModel.refresh(duration, category, (ListenerUtil.mutListener.listen(5407) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5406) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5405) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5404) ? (userRank - 1) : (userRank + 1))))), 0);</span>
                                }
<span class="nc bnc" id="L288" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5413)) {</span>
<span class="nc bnc" id="L289" title="All 8 branches missed.">                                    setLeaderboard(duration, category, (ListenerUtil.mutListener.listen(5412) ? (userRank % 1) : (ListenerUtil.mutListener.listen(5411) ? (userRank / 1) : (ListenerUtil.mutListener.listen(5410) ? (userRank * 1) : (ListenerUtil.mutListener.listen(5409) ? (userRank - 1) : (userRank + 1))))), 0);</span>
                                }
<span class="nc bnc" id="L291" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5414)) {</span>
<span class="nc" id="L292">                                    scrollToRank = true;</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L300">    }</span>

    /**
     * Set the spinners for the leaderboard filters
     */
    private void setSpinners() {
<span class="fc" id="L306">        ArrayAdapter&lt;CharSequence&gt; categoryAdapter = ArrayAdapter.createFromResource(getContext(), R.array.leaderboard_categories, android.R.layout.simple_spinner_item);</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5424)) {</span>
<span class="fc" id="L308">            categoryAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
        }
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5425)) {</span>
<span class="fc" id="L311">            categorySpinner.setAdapter(categoryAdapter);</span>
        }
<span class="fc" id="L313">        ArrayAdapter&lt;CharSequence&gt; durationAdapter = ArrayAdapter.createFromResource(getContext(), R.array.leaderboard_durations, android.R.layout.simple_spinner_item);</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5426)) {</span>
<span class="fc" id="L315">            durationAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
        }
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5427)) {</span>
<span class="fc" id="L318">            durationSpinner.setAdapter(durationAdapter);</span>
        }
<span class="fc" id="L320">    }</span>

    /**
     * To call the API to get results
     * which then sets the views using setLeaderboardUser method
     */
    private void setLeaderboard(String duration, String category, int limit, int offset) {
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5430)) {</span>
<span class="pc bpc" id="L328" title="1 of 2 branches missed.">            if (checkAccount()) {</span>
                try {
<span class="pc bpc" id="L330" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5429)) {</span>
<span class="fc" id="L331">                        compositeDisposable.add(okHttpJsonApiClient.getLeaderboard(Objects.requireNonNull(userName), duration, category, null, null).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(response -&gt; {</span>
<span class="nc bnc" id="L332" title="All 4 branches missed.">                            if (response != null &amp;&amp; response.getStatus() == 200) {</span>
<span class="nc" id="L333">                                userRank = response.getRank();</span>
<span class="nc" id="L334">                                setViews(response, duration, category, limit, offset);</span>
                            }
<span class="nc" id="L336">                        }, t -&gt; {</span>
<span class="nc" id="L337">                            Timber.e(t, &quot;Fetching leaderboard statistics failed&quot;);</span>
<span class="nc" id="L338">                            onError();</span>
<span class="nc" id="L339">                        }));</span>
                    }
<span class="nc" id="L341">                } catch (Exception e) {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5428)) {</span>
<span class="nc" id="L343">                        Timber.d(e + &quot;success&quot;);</span>
                    }
<span class="fc" id="L345">                }</span>
            }
        }
<span class="fc" id="L348">    }</span>

    /**
     * Set the views
     * @param response Leaderboard Response Object
     */
    private void setViews(LeaderboardResponse response, String duration, String category, int limit, int offset) {
<span class="nc bnc" id="L355" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5431)) {</span>
<span class="nc" id="L356">            viewModel = new ViewModelProvider(this, viewModelFactory).get(LeaderboardListViewModel.class);</span>
        }
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5432)) {</span>
<span class="nc" id="L359">            viewModel.setParams(duration, category, limit, offset);</span>
        }
<span class="nc" id="L361">        LeaderboardListAdapter leaderboardListAdapter = new LeaderboardListAdapter();</span>
<span class="nc" id="L362">        UserDetailAdapter userDetailAdapter = new UserDetailAdapter(response);</span>
<span class="nc" id="L363">        MergeAdapter mergeAdapter = new MergeAdapter(userDetailAdapter, leaderboardListAdapter);</span>
<span class="nc" id="L364">        LinearLayoutManager linearLayoutManager = new LinearLayoutManager(getContext());</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5433)) {</span>
<span class="nc" id="L366">            leaderboardListRecyclerView.setLayoutManager(linearLayoutManager);</span>
        }
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5434)) {</span>
<span class="nc" id="L369">            leaderboardListRecyclerView.setAdapter(mergeAdapter);</span>
        }
<span class="nc bnc" id="L371" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5435)) {</span>
<span class="nc" id="L372">            viewModel.getListLiveData().observe(getViewLifecycleOwner(), leaderboardListAdapter::submitList);</span>
        }
<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5436)) {</span>
<span class="nc" id="L375">            viewModel.getProgressLoadStatus().observe(getViewLifecycleOwner(), status -&gt; {</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">                if (Objects.requireNonNull(status).equalsIgnoreCase(LOADING)) {</span>
<span class="nc" id="L377">                    showProgressBar();</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">                } else if (status.equalsIgnoreCase(LOADED)) {</span>
<span class="nc" id="L379">                    hideProgressBar();</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">                    if (scrollToRank) {</span>
<span class="nc" id="L381">                        leaderboardListRecyclerView.smoothScrollToPosition(userRank + 1);</span>
                    }
                }
<span class="nc" id="L384">            });</span>
        }
<span class="nc" id="L386">    }</span>

    /**
     * to hide progressbar
     */
    private void hideProgressBar() {
<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5442)) {</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">            if (progressBar != null) {</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5437)) {</span>
<span class="nc" id="L395">                    progressBar.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L397" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5438)) {</span>
<span class="nc" id="L398">                    categorySpinner.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L400" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5439)) {</span>
<span class="nc" id="L401">                    durationSpinner.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L403" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5440)) {</span>
<span class="nc" id="L404">                    scrollButton.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L406" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5441)) {</span>
<span class="nc" id="L407">                    leaderboardListRecyclerView.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc" id="L411">    }</span>

    /**
     * to show progressbar
     */
    private void showProgressBar() {
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5444)) {</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (progressBar != null) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5443)) {</span>
<span class="nc" id="L420">                    progressBar.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L424" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5445)) {</span>
<span class="nc" id="L425">            scrollButton.setVisibility(View.INVISIBLE);</span>
        }
<span class="nc" id="L427">    }</span>

    /**
     * used to hide the layouts while fetching results from api
     */
    private void hideLayouts() {
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5446)) {</span>
<span class="fc" id="L434">            categorySpinner.setVisibility(View.INVISIBLE);</span>
        }
<span class="pc bpc" id="L436" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5447)) {</span>
<span class="fc" id="L437">            durationSpinner.setVisibility(View.INVISIBLE);</span>
        }
<span class="pc bpc" id="L439" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5448)) {</span>
<span class="fc" id="L440">            leaderboardListRecyclerView.setVisibility(View.INVISIBLE);</span>
        }
<span class="fc" id="L442">    }</span>

    /**
     * check to ensure that user is logged in
     * @return
     */
    private boolean checkAccount() {
<span class="fc" id="L449">        Account currentAccount = sessionManager.getCurrentAccount();</span>
<span class="pc bpc" id="L450" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5452)) {</span>
<span class="pc bpc" id="L451" title="1 of 2 branches missed.">            if (currentAccount == null) {</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5449)) {</span>
<span class="nc" id="L453">                    Timber.d(&quot;Current account is null&quot;);</span>
                }
<span class="nc bnc" id="L455" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5450)) {</span>
<span class="nc" id="L456">                    ViewUtil.showLongToast(getActivity(), getResources().getString(R.string.user_not_logged_in));</span>
                }
<span class="nc bnc" id="L458" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5451)) {</span>
<span class="nc" id="L459">                    sessionManager.forceLogin(getActivity());</span>
                }
<span class="nc" id="L461">                return false;</span>
            }
        }
<span class="fc" id="L464">        return true;</span>
    }

    /**
     * Shows a generic error toast when error occurs while loading leaderboard
     */
    private void onError() {
<span class="nc bnc" id="L471" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5453)) {</span>
<span class="nc" id="L472">            ViewUtil.showLongToast(getActivity(), getResources().getString(R.string.error_occurred));</span>
        }
<span class="nc bnc" id="L474" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5454)) {</span>
<span class="nc" id="L475">            progressBar.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L477">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>