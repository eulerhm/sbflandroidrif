<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReviewImageFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.review</a> &gt; <span class="el_source">ReviewImageFragment.java</span></div><h1>ReviewImageFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.review;

import android.graphics.Color;
import android.os.Bundle;
import android.text.Html;
import android.text.TextUtils;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ProgressBar;
import android.widget.TextView;
import androidx.annotation.NonNull;
import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;
import fr.free.nrw.commons.Media;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L25">public class ReviewImageFragment extends CommonsDaggerSupportFragment {</span>

    static final int CATEGORY = 2;

    private static final int SPAM = 0;

    private static final int COPYRIGHT = 1;

    private static final int THANKS = 3;

    private int position;

    public ProgressBar progressBar;

    @BindView(R.id.tv_review_question)
    TextView textViewQuestion;

    @BindView(R.id.tv_review_question_context)
    TextView textViewQuestionContext;

    @BindView(R.id.button_yes)
    Button yesButton;

    @BindView(R.id.button_no)
    Button noButton;

    // Constant variable used to store user's key name for onSaveInstanceState method
<span class="fc" id="L52">    private final String SAVED_USER = &quot;saved_user&quot;;</span>

    // Variable that stores the value of user
    private String user;

    public void update(int position) {
<span class="nc bnc" id="L58" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5853)) {</span>
<span class="nc" id="L59">            this.position = position;</span>
        }
<span class="nc" id="L61">    }</span>

    private String updateCategoriesQuestion() {
<span class="nc" id="L64">        Media media = getReviewActivity().getMedia();</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5869)) {</span>
<span class="nc bnc" id="L66" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(5855) ? ((ListenerUtil.mutListener.listen(5854) ? (media != null || media.getCategoriesHiddenStatus() != null) : (media != null &amp;&amp; media.getCategoriesHiddenStatus() != null)) || isAdded()) : ((ListenerUtil.mutListener.listen(5854) ? (media != null || media.getCategoriesHiddenStatus() != null) : (media != null &amp;&amp; media.getCategoriesHiddenStatus() != null)) &amp;&amp; isAdded()))) {</span>
                // Filter category name attribute from all categories
<span class="nc" id="L68">                List&lt;String&gt; categories = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5864)) {</span>
                    {
<span class="nc" id="L71">                        long _loopCounter83 = 0;</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">                        for (String key : media.getCategoriesHiddenStatus().keySet()) {</span>
<span class="nc" id="L73">                            ListenerUtil.loopListener.listen(&quot;_loopCounter83&quot;, ++_loopCounter83);</span>
<span class="nc" id="L74">                            String value = String.valueOf(key);</span>
                            // so remove the prefix &quot;Category:&quot;
<span class="nc" id="L76">                            int index = key.indexOf(&quot;Category:&quot;);</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5862)) {</span>
<span class="nc bnc" id="L78" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(5860) ? (index &gt;= 0) : (ListenerUtil.mutListener.listen(5859) ? (index &lt;= 0) : (ListenerUtil.mutListener.listen(5858) ? (index &gt; 0) : (ListenerUtil.mutListener.listen(5857) ? (index &lt; 0) : (ListenerUtil.mutListener.listen(5856) ? (index != 0) : (index == 0))))))) {</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(5861)) {</span>
<span class="nc" id="L80">                                        value = key.substring(9);</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L84" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5863)) {</span>
<span class="nc" id="L85">                                categories.add(value);</span>
                            }
<span class="nc" id="L87">                        }</span>
                    }
                }
<span class="nc" id="L90">                String catString = TextUtils.join(&quot;, &quot;, categories);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5868)) {</span>
<span class="nc bnc" id="L92" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(5866) ? ((ListenerUtil.mutListener.listen(5865) ? (catString != null || !catString.equals(&quot;&quot;)) : (catString != null &amp;&amp; !catString.equals(&quot;&quot;))) || textViewQuestionContext != null) : ((ListenerUtil.mutListener.listen(5865) ? (catString != null || !catString.equals(&quot;&quot;)) : (catString != null &amp;&amp; !catString.equals(&quot;&quot;))) &amp;&amp; textViewQuestionContext != null))) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5867)) {</span>
<span class="nc" id="L94">                            catString = &quot;&lt;b&gt;&quot; + catString + &quot;&lt;/b&gt;&quot;;</span>
                        }
<span class="nc" id="L96">                        String stringToConvertHtml = String.format(getResources().getString(R.string.review_category_explanation), catString);</span>
<span class="nc" id="L97">                        return Html.fromHtml(stringToConvertHtml).toString();</span>
                    }
                }
            }
        }
<span class="nc" id="L102">        return getResources().getString(R.string.review_no_category);</span>
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5870)) {</span>
<span class="fc" id="L108">            super.onCreate(savedInstanceState);</span>
        }
<span class="fc" id="L110">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5871)) {</span>
<span class="fc" id="L115">            position = getArguments().getInt(&quot;position&quot;);</span>
        }
<span class="fc" id="L117">        View layoutView = inflater.inflate(R.layout.fragment_review_image, container, false);</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5872)) {</span>
<span class="fc" id="L119">            ButterKnife.bind(this, layoutView);</span>
        }
<span class="fc" id="L121">        String question, explanation = null, yesButtonText, noButtonText;</span>
<span class="pc bpc" id="L122" title="3 of 5 branches missed.">        switch(position) {</span>
            case SPAM:
<span class="fc" id="L124">                question = getString(R.string.review_spam);</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5873)) {</span>
<span class="fc" id="L126">                    explanation = getString(R.string.review_spam_explanation);</span>
                }
<span class="fc" id="L128">                yesButtonText = getString(R.string.yes);</span>
<span class="fc" id="L129">                noButtonText = getString(R.string.no);</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5874)) {</span>
<span class="pc" id="L131">                    noButton.setOnClickListener(view -&gt; getReviewActivity().reviewController.reportSpam(requireActivity(), getReviewCallback()));</span>
                }
                break;
            case COPYRIGHT:
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5875)) {</span>
<span class="fc" id="L136">                    enableButtons();</span>
                }
<span class="fc" id="L138">                question = getString(R.string.review_copyright);</span>
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5876)) {</span>
<span class="fc" id="L140">                    explanation = getString(R.string.review_copyright_explanation);</span>
                }
<span class="fc" id="L142">                yesButtonText = getString(R.string.yes);</span>
<span class="fc" id="L143">                noButtonText = getString(R.string.no);</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5877)) {</span>
<span class="pc" id="L145">                    noButton.setOnClickListener(view -&gt; getReviewActivity().reviewController.reportPossibleCopyRightViolation(requireActivity(), getReviewCallback()));</span>
                }
                break;
            case CATEGORY:
<span class="nc bnc" id="L149" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5878)) {</span>
<span class="nc" id="L150">                    enableButtons();</span>
                }
<span class="nc" id="L152">                question = getString(R.string.review_category);</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5879)) {</span>
<span class="nc" id="L154">                    explanation = updateCategoriesQuestion();</span>
                }
<span class="nc" id="L156">                yesButtonText = getString(R.string.yes);</span>
<span class="nc" id="L157">                noButtonText = getString(R.string.no);</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5880)) {</span>
<span class="nc" id="L159">                    noButton.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L160">                        getReviewActivity().reviewController.reportWrongCategory(requireActivity(), getReviewCallback());</span>
<span class="nc" id="L161">                        getReviewActivity().swipeToNext();</span>
<span class="nc" id="L162">                    });</span>
                }
                break;
            case THANKS:
<span class="nc bnc" id="L166" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5881)) {</span>
<span class="nc" id="L167">                    enableButtons();</span>
                }
<span class="nc" id="L169">                question = getString(R.string.review_thanks);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5885)) {</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                    if (getReviewActivity().reviewController.firstRevision != null) {</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5884)) {</span>
<span class="nc" id="L173">                            user = getReviewActivity().reviewController.firstRevision.getUser();</span>
                        }
                    } else {
<span class="nc bnc" id="L176" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5883)) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                            if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5882)) {</span>
<span class="nc" id="L179">                                    user = savedInstanceState.getString(SAVED_USER);</span>
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L185" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5887)) {</span>
                    // if the user is null because of whatsoever reason, review will not be sent anyways
<span class="nc bnc" id="L187" title="All 2 branches missed.">                    if (!TextUtils.isEmpty(user)) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5886)) {</span>
<span class="nc" id="L189">                            explanation = getString(R.string.review_thanks_explanation, user);</span>
                        }
                    }
                }
                // Note that the yes and no buttons are swapped in this section
<span class="nc" id="L194">                yesButtonText = getString(R.string.review_thanks_yes_button_text);</span>
<span class="nc" id="L195">                noButtonText = getString(R.string.review_thanks_no_button_text);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5888)) {</span>
<span class="nc" id="L197">                    yesButton.setTextColor(Color.parseColor(&quot;#116aaa&quot;));</span>
                }
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5889)) {</span>
<span class="nc" id="L200">                    noButton.setTextColor(Color.parseColor(&quot;#228b22&quot;));</span>
                }
<span class="nc bnc" id="L202" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5890)) {</span>
<span class="nc" id="L203">                    noButton.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L204">                        getReviewActivity().reviewController.sendThanks(getReviewActivity());</span>
<span class="nc" id="L205">                        getReviewActivity().swipeToNext();</span>
<span class="nc" id="L206">                    });</span>
                }
                break;
            default:
<span class="nc bnc" id="L210" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5891)) {</span>
<span class="nc" id="L211">                    enableButtons();</span>
                }
<span class="nc" id="L213">                question = &quot;How did we get here?&quot;;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5892)) {</span>
<span class="nc" id="L215">                    explanation = &quot;No idea.&quot;;</span>
                }
<span class="nc" id="L217">                yesButtonText = &quot;yes&quot;;</span>
<span class="nc" id="L218">                noButtonText = &quot;no&quot;;</span>
        }
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5893)) {</span>
<span class="fc" id="L221">            textViewQuestion.setText(question);</span>
        }
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5894)) {</span>
<span class="fc" id="L224">            textViewQuestionContext.setText(explanation);</span>
        }
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5895)) {</span>
<span class="fc" id="L227">            yesButton.setText(yesButtonText);</span>
        }
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5896)) {</span>
<span class="fc" id="L230">            noButton.setText(noButtonText);</span>
        }
<span class="fc" id="L232">        return layoutView;</span>
    }

    /**
     * This method will be called when configuration changes happen
     *
     * @param outState
     */
    @Override
    public void onSaveInstanceState(@NonNull Bundle outState) {
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5897)) {</span>
<span class="nc" id="L243">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5898)) {</span>
            // Save user name when configuration changes happen
<span class="nc" id="L247">            outState.putString(SAVED_USER, user);</span>
        }
<span class="nc" id="L249">    }</span>

    private ReviewController.ReviewCallback getReviewCallback() {
<span class="nc" id="L252">        return new ReviewController.ReviewCallback() {</span>

            @Override
            public void onSuccess() {
<span class="nc bnc" id="L256" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5899)) {</span>
<span class="nc" id="L257">                    getReviewActivity().runRandomizer();</span>
                }
<span class="nc" id="L259">            }</span>

            @Override
            public void onFailure() {
<span class="nc" id="L263">            }</span>
        };
    }

    /**
     * This function is called when an image has
     * been loaded to enable the review buttons.
     */
    public void enableButtons() {
<span class="pc bpc" id="L272" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5900)) {</span>
<span class="fc" id="L273">            yesButton.setEnabled(true);</span>
        }
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5901)) {</span>
<span class="fc" id="L276">            yesButton.setAlpha(1);</span>
        }
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5902)) {</span>
<span class="fc" id="L279">            noButton.setEnabled(true);</span>
        }
<span class="pc bpc" id="L281" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5903)) {</span>
<span class="fc" id="L282">            noButton.setAlpha(1);</span>
        }
<span class="fc" id="L284">    }</span>

    /**
     * This function is called when an image is being loaded
     * to disable the review buttons
     */
    public void disableButtons() {
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5904)) {</span>
<span class="nc" id="L292">            yesButton.setEnabled(false);</span>
        }
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5905)) {</span>
<span class="nc" id="L295">            yesButton.setAlpha(0.5f);</span>
        }
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5906)) {</span>
<span class="nc" id="L298">            noButton.setEnabled(false);</span>
        }
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5907)) {</span>
<span class="nc" id="L301">            noButton.setAlpha(0.5f);</span>
        }
<span class="nc" id="L303">    }</span>

    @OnClick(R.id.button_yes)
    void onYesButtonClicked() {
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5908)) {</span>
<span class="nc" id="L308">            getReviewActivity().swipeToNext();</span>
        }
<span class="nc" id="L310">    }</span>

    private ReviewActivity getReviewActivity() {
<span class="nc" id="L313">        return (ReviewActivity) requireActivity();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>