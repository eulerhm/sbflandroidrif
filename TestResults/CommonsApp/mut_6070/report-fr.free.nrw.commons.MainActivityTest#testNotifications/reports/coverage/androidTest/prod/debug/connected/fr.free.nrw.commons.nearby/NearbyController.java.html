<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NearbyController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.nearby</a> &gt; <span class="el_source">NearbyController.java</span></div><h1>NearbyController.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.nearby;

import static fr.free.nrw.commons.utils.LengthUtils.computeDistanceBetween;
import static fr.free.nrw.commons.utils.LengthUtils.formatDistanceBetween;
import android.content.Context;
import android.content.res.Resources;
import android.graphics.Bitmap;
import androidx.annotation.MainThread;
import androidx.annotation.Nullable;
import androidx.vectordrawable.graphics.drawable.VectorDrawableCompat;
import com.mapbox.mapboxsdk.annotations.IconFactory;
import com.mapbox.mapboxsdk.annotations.Marker;
import fr.free.nrw.commons.MapController;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.utils.UiUtils;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.ListIterator;
import java.util.Locale;
import java.util.Map;
import javax.inject.Inject;
import timber.log.Timber;
import static fr.free.nrw.commons.utils.LengthUtils.computeDistanceBetween;
import static fr.free.nrw.commons.utils.LengthUtils.formatDistanceBetween;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class NearbyController extends MapController {

    private static final int MAX_RESULTS = 1000;

    private final NearbyPlaces nearbyPlaces;

    // in kilometers
<span class="fc" id="L37">    public static double currentLocationSearchRadius = 10.0;</span>

    // Users latest fetched location
    public static LatLng currentLocation;

    // Can be current and camera target on search this area button is used
    public static LatLng latestSearchLocation;

    // Any last search radius except closest result search
<span class="fc" id="L46">    public static double latestSearchRadius = 10.0;</span>

<span class="fc" id="L48">    public static List&lt;MarkerPlaceGroup&gt; markerLabelList = new ArrayList&lt;&gt;();</span>

    public static Map&lt;Boolean, Marker&gt; markerExistsMap;

    public static Map&lt;Boolean, Marker&gt; markerNeedPicMap;

    @Inject
<span class="fc" id="L55">    public NearbyController(NearbyPlaces nearbyPlaces) {</span>
<span class="fc" id="L56">        this.nearbyPlaces = nearbyPlaces;</span>
<span class="fc" id="L57">    }</span>

    /**
     * Prepares Place list to make their distance information update later.
     *
     * @param curLatLng current location for user
     * @param searchLatLng the location user wants to search around
     * @param returnClosestResult if this search is done to find closest result or all results
     * @param customQuery if this search is done via an advanced query
     * @return NearbyPlacesInfo a variable holds Place list without distance information
     * and boundary coordinates of current Place List
     */
    public NearbyPlacesInfo loadAttractionsFromLocation(final LatLng curLatLng, final LatLng searchLatLng, final boolean returnClosestResult, final boolean checkingAroundCurrentLocation, final boolean shouldQueryForMonuments, @Nullable final String customQuery) throws Exception {
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3462)) {</span>
<span class="fc" id="L71">            Timber.d(&quot;Loading attractions near %s&quot;, searchLatLng);</span>
        }
<span class="fc" id="L73">        NearbyPlacesInfo nearbyPlacesInfo = new NearbyPlacesInfo();</span>
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3464)) {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">            if (searchLatLng == null) {</span>
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3463)) {</span>
<span class="fc" id="L77">                    Timber.d(&quot;Loading attractions nearby, but curLatLng is null&quot;);</span>
                }
<span class="fc" id="L79">                return null;</span>
            }
        }
<span class="nc" id="L82">        List&lt;Place&gt; places = nearbyPlaces.radiusExpander(searchLatLng, Locale.getDefault().getLanguage(), returnClosestResult, shouldQueryForMonuments, customQuery);</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3522)) {</span>
<span class="nc bnc" id="L84" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(3470) ? (null != places || (ListenerUtil.mutListener.listen(3469) ? (places.size() &gt;= 0) : (ListenerUtil.mutListener.listen(3468) ? (places.size() &lt;= 0) : (ListenerUtil.mutListener.listen(3467) ? (places.size() &lt; 0) : (ListenerUtil.mutListener.listen(3466) ? (places.size() != 0) : (ListenerUtil.mutListener.listen(3465) ? (places.size() == 0) : (places.size() &gt; 0))))))) : (null != places &amp;&amp; (ListenerUtil.mutListener.listen(3469) ? (places.size() &gt;= 0) : (ListenerUtil.mutListener.listen(3468) ? (places.size() &lt;= 0) : (ListenerUtil.mutListener.listen(3467) ? (places.size() &lt; 0) : (ListenerUtil.mutListener.listen(3466) ? (places.size() != 0) : (ListenerUtil.mutListener.listen(3465) ? (places.size() == 0) : (places.size() &gt; 0))))))))) {</span>
<span class="nc" id="L85">                LatLng[] boundaryCoordinates = { // south</span>
<span class="nc" id="L86">                places.get(0).location, // north</span>
<span class="nc" id="L87">                places.get(0).location, // west</span>
<span class="nc" id="L88">                places.get(0).location, // east, init with a random location</span>
<span class="nc" id="L89">                places.get(0).location };</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3503)) {</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                    if (curLatLng != null) {</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3471)) {</span>
<span class="nc" id="L93">                            Timber.d(&quot;Sorting places by distance...&quot;);</span>
                        }
<span class="nc" id="L95">                        final Map&lt;Place, Double&gt; distances = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3501)) {</span>
                            {
<span class="nc" id="L98">                                long _loopCounter50 = 0;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                                for (Place place : places) {</span>
<span class="nc" id="L100">                                    ListenerUtil.loopListener.listen(&quot;_loopCounter50&quot;, ++_loopCounter50);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3472)) {</span>
<span class="nc" id="L102">                                        distances.put(place, computeDistanceBetween(place.location, curLatLng));</span>
                                    }
<span class="nc bnc" id="L104" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3479)) {</span>
                                        // Find boundaries with basic find max approach
<span class="nc bnc" id="L106" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(3477) ? (place.location.getLatitude() &gt;= boundaryCoordinates[0].getLatitude()) : (ListenerUtil.mutListener.listen(3476) ? (place.location.getLatitude() &lt;= boundaryCoordinates[0].getLatitude()) : (ListenerUtil.mutListener.listen(3475) ? (place.location.getLatitude() &gt; boundaryCoordinates[0].getLatitude()) : (ListenerUtil.mutListener.listen(3474) ? (place.location.getLatitude() != boundaryCoordinates[0].getLatitude()) : (ListenerUtil.mutListener.listen(3473) ? (place.location.getLatitude() == boundaryCoordinates[0].getLatitude()) : (place.location.getLatitude() &lt; boundaryCoordinates[0].getLatitude()))))))) {</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3478)) {</span>
<span class="nc" id="L108">                                                boundaryCoordinates[0] = place.location;</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L112" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3486)) {</span>
<span class="nc bnc" id="L113" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(3484) ? (place.location.getLatitude() &gt;= boundaryCoordinates[1].getLatitude()) : (ListenerUtil.mutListener.listen(3483) ? (place.location.getLatitude() &lt;= boundaryCoordinates[1].getLatitude()) : (ListenerUtil.mutListener.listen(3482) ? (place.location.getLatitude() &lt; boundaryCoordinates[1].getLatitude()) : (ListenerUtil.mutListener.listen(3481) ? (place.location.getLatitude() != boundaryCoordinates[1].getLatitude()) : (ListenerUtil.mutListener.listen(3480) ? (place.location.getLatitude() == boundaryCoordinates[1].getLatitude()) : (place.location.getLatitude() &gt; boundaryCoordinates[1].getLatitude()))))))) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3485)) {</span>
<span class="nc" id="L115">                                                boundaryCoordinates[1] = place.location;</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L119" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3493)) {</span>
<span class="nc bnc" id="L120" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(3491) ? (place.location.getLongitude() &gt;= boundaryCoordinates[2].getLongitude()) : (ListenerUtil.mutListener.listen(3490) ? (place.location.getLongitude() &lt;= boundaryCoordinates[2].getLongitude()) : (ListenerUtil.mutListener.listen(3489) ? (place.location.getLongitude() &gt; boundaryCoordinates[2].getLongitude()) : (ListenerUtil.mutListener.listen(3488) ? (place.location.getLongitude() != boundaryCoordinates[2].getLongitude()) : (ListenerUtil.mutListener.listen(3487) ? (place.location.getLongitude() == boundaryCoordinates[2].getLongitude()) : (place.location.getLongitude() &lt; boundaryCoordinates[2].getLongitude()))))))) {</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3492)) {</span>
<span class="nc" id="L122">                                                boundaryCoordinates[2] = place.location;</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L126" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3500)) {</span>
<span class="nc bnc" id="L127" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(3498) ? (place.location.getLongitude() &gt;= boundaryCoordinates[3].getLongitude()) : (ListenerUtil.mutListener.listen(3497) ? (place.location.getLongitude() &lt;= boundaryCoordinates[3].getLongitude()) : (ListenerUtil.mutListener.listen(3496) ? (place.location.getLongitude() &lt; boundaryCoordinates[3].getLongitude()) : (ListenerUtil.mutListener.listen(3495) ? (place.location.getLongitude() != boundaryCoordinates[3].getLongitude()) : (ListenerUtil.mutListener.listen(3494) ? (place.location.getLongitude() == boundaryCoordinates[3].getLongitude()) : (place.location.getLongitude() &gt; boundaryCoordinates[3].getLongitude()))))))) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3499)) {</span>
<span class="nc" id="L129">                                                boundaryCoordinates[3] = place.location;</span>
                                            }
                                        }
                                    }
<span class="nc" id="L133">                                }</span>
                            }
                        }
<span class="nc bnc" id="L136" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3502)) {</span>
<span class="nc" id="L137">                            Collections.sort(places, (lhs, rhs) -&gt; {</span>
<span class="nc" id="L138">                                double lhsDistance = distances.get(lhs);</span>
<span class="nc" id="L139">                                double rhsDistance = distances.get(rhs);</span>
<span class="nc" id="L140">                                return (int) (lhsDistance - rhsDistance);</span>
                            });
                        }
                    }
                }
<span class="nc bnc" id="L145" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3504)) {</span>
<span class="nc" id="L146">                    nearbyPlacesInfo.curLatLng = curLatLng;</span>
                }
<span class="nc bnc" id="L148" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3505)) {</span>
<span class="nc" id="L149">                    nearbyPlacesInfo.searchLatLng = searchLatLng;</span>
                }
<span class="nc bnc" id="L151" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3506)) {</span>
<span class="nc" id="L152">                    nearbyPlacesInfo.placeList = places;</span>
                }
<span class="nc bnc" id="L154" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3507)) {</span>
<span class="nc" id="L155">                    nearbyPlacesInfo.boundaryCoordinates = boundaryCoordinates;</span>
                }
<span class="nc bnc" id="L157" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3521)) {</span>
                    // Returning closes result means we use the controller for nearby card. So no need to set search this area flags
<span class="nc bnc" id="L159" title="All 2 branches missed.">                    if (!returnClosestResult) {</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3508)) {</span>
                            // To remember latest search either around user or any point on map
<span class="nc" id="L162">                            latestSearchLocation = searchLatLng;</span>
                        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3513)) {</span>
                            // to meter
<span class="nc bnc" id="L166" title="All 8 branches missed.">                            latestSearchRadius = (ListenerUtil.mutListener.listen(3512) ? (nearbyPlaces.radius % 1000) : (ListenerUtil.mutListener.listen(3511) ? (nearbyPlaces.radius / 1000) : (ListenerUtil.mutListener.listen(3510) ? (nearbyPlaces.radius - 1000) : (ListenerUtil.mutListener.listen(3509) ? (nearbyPlaces.radius + 1000) : (nearbyPlaces.radius * 1000)))));</span>
                        }
<span class="nc bnc" id="L168" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3520)) {</span>
                            // Our radius searched around us, will be used to understand when user search their own location, we will follow them
<span class="nc bnc" id="L170" title="All 2 branches missed.">                            if (checkingAroundCurrentLocation) {</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3518)) {</span>
                                    // to meter
<span class="nc bnc" id="L173" title="All 8 branches missed.">                                    currentLocationSearchRadius = (ListenerUtil.mutListener.listen(3517) ? (nearbyPlaces.radius % 1000) : (ListenerUtil.mutListener.listen(3516) ? (nearbyPlaces.radius / 1000) : (ListenerUtil.mutListener.listen(3515) ? (nearbyPlaces.radius - 1000) : (ListenerUtil.mutListener.listen(3514) ? (nearbyPlaces.radius + 1000) : (nearbyPlaces.radius * 1000)))));</span>
                                }
<span class="nc bnc" id="L175" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3519)) {</span>
<span class="nc" id="L176">                                    currentLocation = curLatLng;</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L184">        return nearbyPlacesInfo;</span>
    }

    /**
     * Prepares Place list to make their distance information update later.
     *
     * @param curLatLng           current location for user
     * @param searchLatLng        the location user wants to search around
     * @param returnClosestResult if this search is done to find closest result or all results
     * @return NearbyPlacesInfo a variable holds Place list without distance information and
     * boundary coordinates of current Place List
     */
    public NearbyPlacesInfo loadAttractionsFromLocation(final LatLng curLatLng, final LatLng searchLatLng, final boolean returnClosestResult, final boolean checkingAroundCurrentLocation, final boolean shouldQueryForMonuments) throws Exception {
<span class="fc" id="L197">        return loadAttractionsFromLocation(curLatLng, searchLatLng, returnClosestResult, checkingAroundCurrentLocation, shouldQueryForMonuments, null);</span>
    }

    /**
     * Loads attractions from location for map view, we need to return BaseMarkerOption data type.
     *
     * @param curLatLng users current location
     * @param placeList list of nearby places in Place data type
     * @return BaseMarkerOptions list that holds nearby places
     */
    public static List&lt;NearbyBaseMarker&gt; loadAttractionsFromLocationToBaseMarkerOptions(LatLng curLatLng, List&lt;Place&gt; placeList, Context context, List&lt;Place&gt; bookmarkplacelist) {
<span class="nc" id="L208">        List&lt;NearbyBaseMarker&gt; baseMarkerOptions = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3523)) {</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if (placeList == null) {</span>
<span class="nc" id="L211">                return baseMarkerOptions;</span>
            }
        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3524)) {</span>
<span class="nc" id="L215">            placeList = placeList.subList(0, Math.min(placeList.size(), MAX_RESULTS));</span>
        }
<span class="nc" id="L217">        VectorDrawableCompat vectorDrawable = null;</span>
<span class="nc" id="L218">        VectorDrawableCompat vectorDrawableGreen = null;</span>
<span class="nc" id="L219">        VectorDrawableCompat vectorDrawableGrey = null;</span>
<span class="nc" id="L220">        VectorDrawableCompat vectorDrawableMonuments = null;</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3525)) {</span>
<span class="nc" id="L222">            vectorDrawable = null;</span>
        }
        try {
<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3526)) {</span>
<span class="nc" id="L226">                vectorDrawable = VectorDrawableCompat.create(context.getResources(), R.drawable.ic_custom_map_marker, context.getTheme());</span>
            }
<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3527)) {</span>
<span class="nc" id="L229">                vectorDrawableGreen = VectorDrawableCompat.create(context.getResources(), R.drawable.ic_custom_map_marker_green, context.getTheme());</span>
            }
<span class="nc bnc" id="L231" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3528)) {</span>
<span class="nc" id="L232">                vectorDrawableGrey = VectorDrawableCompat.create(context.getResources(), R.drawable.ic_custom_map_marker_grey, context.getTheme());</span>
            }
<span class="nc bnc" id="L234" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3529)) {</span>
<span class="nc" id="L235">                vectorDrawableMonuments = VectorDrawableCompat.create(context.getResources(), R.drawable.ic_custom_map_marker_monuments, context.getTheme());</span>
            }
<span class="nc" id="L237">        } catch (Resources.NotFoundException e) {</span>
<span class="nc" id="L238">        }</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3543)) {</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">            if (vectorDrawable != null) {</span>
<span class="nc" id="L241">                Bitmap icon = UiUtils.getBitmap(vectorDrawable);</span>
<span class="nc" id="L242">                Bitmap iconGreen = UiUtils.getBitmap(vectorDrawableGreen);</span>
<span class="nc" id="L243">                Bitmap iconGrey = UiUtils.getBitmap(vectorDrawableGrey);</span>
<span class="nc" id="L244">                Bitmap iconMonuments = UiUtils.getBitmap(vectorDrawableMonuments);</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3542)) {</span>
                    {
<span class="nc" id="L247">                        long _loopCounter51 = 0;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">                        for (Place place : placeList) {</span>
<span class="nc" id="L249">                            ListenerUtil.loopListener.listen(&quot;_loopCounter51&quot;, ++_loopCounter51);</span>
<span class="nc" id="L250">                            NearbyBaseMarker nearbyBaseMarker = new NearbyBaseMarker();</span>
<span class="nc" id="L251">                            String distance = formatDistanceBetween(curLatLng, place.location);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3530)) {</span>
<span class="nc" id="L253">                                place.setDistance(distance);</span>
                            }
<span class="nc bnc" id="L255" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3531)) {</span>
<span class="nc" id="L256">                                nearbyBaseMarker.title(place.name);</span>
                            }
<span class="nc bnc" id="L258" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3532)) {</span>
<span class="nc" id="L259">                                nearbyBaseMarker.position(new com.mapbox.mapboxsdk.geometry.LatLng(place.location.getLatitude(), place.location.getLongitude()));</span>
                            }
<span class="nc bnc" id="L261" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3533)) {</span>
<span class="nc" id="L262">                                nearbyBaseMarker.place(place);</span>
                            }
<span class="nc bnc" id="L264" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3540)) {</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                                if (place.isMonument()) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3539)) {</span>
<span class="nc" id="L267">                                        nearbyBaseMarker.icon(IconFactory.getInstance(context).fromBitmap(iconMonuments));</span>
                                    }
<span class="nc bnc" id="L269" title="All 2 branches missed.">                                } else if (!place.pic.trim().isEmpty()) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3538)) {</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">                                        if (iconGreen != null) {</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3537)) {</span>
<span class="nc" id="L273">                                                nearbyBaseMarker.icon(IconFactory.getInstance(context).fromBitmap(iconGreen));</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L277" title="All 2 branches missed.">                                } else if (!place.exists) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3536)) {</span>
                                        // Means that the topic of the Wikidata item does not exist in the real world anymore, for instance it is a past event, or a place that was destroyed
<span class="nc bnc" id="L280" title="All 2 branches missed.">                                        if (iconGrey != null) {</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3535)) {</span>
<span class="nc" id="L282">                                                nearbyBaseMarker.icon(IconFactory.getInstance(context).fromBitmap(iconGrey));</span>
                                            }
                                        }
                                    }
                                } else {
<span class="nc bnc" id="L287" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3534)) {</span>
<span class="nc" id="L288">                                        nearbyBaseMarker.icon(IconFactory.getInstance(context).fromBitmap(icon));</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L292" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3541)) {</span>
<span class="nc" id="L293">                                baseMarkerOptions.add(nearbyBaseMarker);</span>
                            }
<span class="nc" id="L295">                        }</span>
                    }
                }
            }
        }
<span class="nc" id="L300">        return baseMarkerOptions;</span>
    }

    /**
     * Updates makerLabelList item isBookmarked value
     * @param place place which is bookmarked
     * @param isBookmarked true is bookmarked, false if bookmark removed
     */
    @MainThread
    public static void updateMarkerLabelListBookmark(Place place, boolean isBookmarked) {
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3546)) {</span>
            {
<span class="nc" id="L312">                long _loopCounter52 = 0;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                for (ListIterator&lt;MarkerPlaceGroup&gt; iter = markerLabelList.listIterator(); iter.hasNext(); ) {</span>
<span class="nc" id="L314">                    ListenerUtil.loopListener.listen(&quot;_loopCounter52&quot;, ++_loopCounter52);</span>
<span class="nc" id="L315">                    MarkerPlaceGroup markerPlaceGroup = iter.next();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3545)) {</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                        if (markerPlaceGroup.getPlace().getWikiDataEntityId().equals(place.getWikiDataEntityId())) {</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3544)) {</span>
<span class="nc" id="L319">                                iter.set(new MarkerPlaceGroup(markerPlaceGroup.getMarker(), isBookmarked, place));</span>
                            }
                        }
                    }
<span class="nc" id="L323">                }</span>
            }
        }
<span class="nc" id="L326">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>