<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TransformGestureDetector.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.media.zoomControllers.gestures</a> &gt; <span class="el_source">TransformGestureDetector.java</span></div><h1>TransformGestureDetector.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.media.zoomControllers.gestures;

import android.view.MotionEvent;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * Component that detects translation, scale and rotation based on touch events.
 *
 * This class notifies its listeners whenever a gesture begins, updates or ends. The instance of
 * this detector is passed to the listeners, so it can be queried for pivot, translation, scale or
 * rotation.
 */
public class TransformGestureDetector implements MultiPointerGestureDetector.Listener {

    /**
     * The listener for receiving notifications when gestures occur.
     */
    public interface Listener {

        /**
         * A callback called right before the gesture is about to start.
         */
        public void onGestureBegin(TransformGestureDetector detector);

        /**
         * A callback called each time the gesture gets updated.
         */
        public void onGestureUpdate(TransformGestureDetector detector);

        /**
         * A callback called right after the gesture has finished.
         */
        public void onGestureEnd(TransformGestureDetector detector);
    }

    private final MultiPointerGestureDetector mDetector;

<span class="nc" id="L38">    private Listener mListener = null;</span>

<span class="nc" id="L40">    public TransformGestureDetector(MultiPointerGestureDetector multiPointerGestureDetector) {</span>
<span class="nc" id="L41">        mDetector = multiPointerGestureDetector;</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8647)) {</span>
<span class="nc" id="L43">            mDetector.setListener(this);</span>
        }
<span class="nc" id="L45">    }</span>

    /**
     * Factory method that creates a new instance of TransformGestureDetector
     */
    public static TransformGestureDetector newInstance() {
<span class="nc" id="L51">        return new TransformGestureDetector(MultiPointerGestureDetector.newInstance());</span>
    }

    /**
     * Sets the listener.
     *
     * @param listener listener to set
     */
    public void setListener(Listener listener) {
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8648)) {</span>
<span class="nc" id="L61">            mListener = listener;</span>
        }
<span class="nc" id="L63">    }</span>

    /**
     * Resets the component to the initial state.
     */
    public void reset() {
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8649)) {</span>
<span class="nc" id="L70">            mDetector.reset();</span>
        }
<span class="nc" id="L72">    }</span>

    /**
     * Handles the given motion event.
     *
     * @param event event to handle
     * @return whether or not the event was handled
     */
    public boolean onTouchEvent(final MotionEvent event) {
<span class="nc" id="L81">        return mDetector.onTouchEvent(event);</span>
    }

    @Override
    public void onGestureBegin(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8651)) {</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8650)) {</span>
<span class="nc" id="L89">                    mListener.onGestureBegin(this);</span>
                }
            }
        }
<span class="nc" id="L93">    }</span>

    @Override
    public void onGestureUpdate(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8653)) {</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8652)) {</span>
<span class="nc" id="L100">                    mListener.onGestureUpdate(this);</span>
                }
            }
        }
<span class="nc" id="L104">    }</span>

    @Override
    public void onGestureEnd(MultiPointerGestureDetector detector) {
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8655)) {</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8654)) {</span>
<span class="nc" id="L111">                    mListener.onGestureEnd(this);</span>
                }
            }
        }
<span class="nc" id="L115">    }</span>

    private float calcAverage(float[] arr, int len) {
<span class="nc" id="L118">        float sum = 0;</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8662)) {</span>
            {
<span class="nc" id="L121">                long _loopCounter145 = 0;</span>
<span class="nc bnc" id="L122" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(8661) ? (i &gt;= len) : (ListenerUtil.mutListener.listen(8660) ? (i &lt;= len) : (ListenerUtil.mutListener.listen(8659) ? (i &gt; len) : (ListenerUtil.mutListener.listen(8658) ? (i != len) : (ListenerUtil.mutListener.listen(8657) ? (i == len) : (i &lt; len)))))); i++) {</span>
<span class="nc" id="L123">                    ListenerUtil.loopListener.listen(&quot;_loopCounter145&quot;, ++_loopCounter145);</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8656)) {</span>
<span class="nc" id="L125">                        sum += arr[i];</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L130" title="All 30 branches missed.">        return ((ListenerUtil.mutListener.listen(8667) ? (len &gt;= 0) : (ListenerUtil.mutListener.listen(8666) ? (len &lt;= 0) : (ListenerUtil.mutListener.listen(8665) ? (len &lt; 0) : (ListenerUtil.mutListener.listen(8664) ? (len != 0) : (ListenerUtil.mutListener.listen(8663) ? (len == 0) : (len &gt; 0))))))) ? (ListenerUtil.mutListener.listen(8671) ? (sum % len) : (ListenerUtil.mutListener.listen(8670) ? (sum * len) : (ListenerUtil.mutListener.listen(8669) ? (sum - len) : (ListenerUtil.mutListener.listen(8668) ? (sum + len) : (sum / len))))) : 0;</span>
    }

    /**
     * Restarts the current gesture (if any).
     */
    public void restartGesture() {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8672)) {</span>
<span class="nc" id="L138">            mDetector.restartGesture();</span>
        }
<span class="nc" id="L140">    }</span>

    /**
     * Gets whether there is a gesture in progress
     */
    public boolean isGestureInProgress() {
<span class="nc" id="L146">        return mDetector.isGestureInProgress();</span>
    }

    /**
     * Gets the number of pointers after the current gesture
     */
    public int getNewPointerCount() {
<span class="nc" id="L153">        return mDetector.getNewPointerCount();</span>
    }

    /**
     * Gets the number of pointers in the current gesture
     */
    public int getPointerCount() {
<span class="nc" id="L160">        return mDetector.getPointerCount();</span>
    }

    /**
     * Gets the X coordinate of the pivot point
     */
    public float getPivotX() {
<span class="nc" id="L167">        return calcAverage(mDetector.getStartX(), mDetector.getPointerCount());</span>
    }

    /**
     * Gets the Y coordinate of the pivot point
     */
    public float getPivotY() {
<span class="nc" id="L174">        return calcAverage(mDetector.getStartY(), mDetector.getPointerCount());</span>
    }

    /**
     * Gets the X component of the translation
     */
    public float getTranslationX() {
<span class="nc bnc" id="L181" title="All 8 branches missed.">        return (ListenerUtil.mutListener.listen(8676) ? (calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount()) % calcAverage(mDetector.getStartX(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8675) ? (calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount()) / calcAverage(mDetector.getStartX(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8674) ? (calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount()) * calcAverage(mDetector.getStartX(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8673) ? (calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount()) + calcAverage(mDetector.getStartX(), mDetector.getPointerCount())) : (calcAverage(mDetector.getCurrentX(), mDetector.getPointerCount()) - calcAverage(mDetector.getStartX(), mDetector.getPointerCount()))))));</span>
    }

    /**
     * Gets the Y component of the translation
     */
    public float getTranslationY() {
<span class="nc bnc" id="L188" title="All 8 branches missed.">        return (ListenerUtil.mutListener.listen(8680) ? (calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount()) % calcAverage(mDetector.getStartY(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8679) ? (calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount()) / calcAverage(mDetector.getStartY(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8678) ? (calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount()) * calcAverage(mDetector.getStartY(), mDetector.getPointerCount())) : (ListenerUtil.mutListener.listen(8677) ? (calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount()) + calcAverage(mDetector.getStartY(), mDetector.getPointerCount())) : (calcAverage(mDetector.getCurrentY(), mDetector.getPointerCount()) - calcAverage(mDetector.getStartY(), mDetector.getPointerCount()))))));</span>
    }

    /**
     * Gets the scale
     */
    public float getScale() {
<span class="nc bnc" id="L195" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(8685) ? (mDetector.getPointerCount() &gt;= 2) : (ListenerUtil.mutListener.listen(8684) ? (mDetector.getPointerCount() &lt;= 2) : (ListenerUtil.mutListener.listen(8683) ? (mDetector.getPointerCount() &gt; 2) : (ListenerUtil.mutListener.listen(8682) ? (mDetector.getPointerCount() != 2) : (ListenerUtil.mutListener.listen(8681) ? (mDetector.getPointerCount() == 2) : (mDetector.getPointerCount() &lt; 2))))))) {</span>
<span class="nc" id="L196">            return 1;</span>
        } else {
<span class="nc bnc" id="L198" title="All 8 branches missed.">            float startDeltaX = (ListenerUtil.mutListener.listen(8689) ? (mDetector.getStartX()[1] % mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8688) ? (mDetector.getStartX()[1] / mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8687) ? (mDetector.getStartX()[1] * mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8686) ? (mDetector.getStartX()[1] + mDetector.getStartX()[0]) : (mDetector.getStartX()[1] - mDetector.getStartX()[0])))));</span>
<span class="nc bnc" id="L199" title="All 8 branches missed.">            float startDeltaY = (ListenerUtil.mutListener.listen(8693) ? (mDetector.getStartY()[1] % mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8692) ? (mDetector.getStartY()[1] / mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8691) ? (mDetector.getStartY()[1] * mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8690) ? (mDetector.getStartY()[1] + mDetector.getStartY()[0]) : (mDetector.getStartY()[1] - mDetector.getStartY()[0])))));</span>
<span class="nc bnc" id="L200" title="All 8 branches missed.">            float currentDeltaX = (ListenerUtil.mutListener.listen(8697) ? (mDetector.getCurrentX()[1] % mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8696) ? (mDetector.getCurrentX()[1] / mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8695) ? (mDetector.getCurrentX()[1] * mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8694) ? (mDetector.getCurrentX()[1] + mDetector.getCurrentX()[0]) : (mDetector.getCurrentX()[1] - mDetector.getCurrentX()[0])))));</span>
<span class="nc bnc" id="L201" title="All 8 branches missed.">            float currentDeltaY = (ListenerUtil.mutListener.listen(8701) ? (mDetector.getCurrentY()[1] % mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8700) ? (mDetector.getCurrentY()[1] / mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8699) ? (mDetector.getCurrentY()[1] * mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8698) ? (mDetector.getCurrentY()[1] + mDetector.getCurrentY()[0]) : (mDetector.getCurrentY()[1] - mDetector.getCurrentY()[0])))));</span>
<span class="nc" id="L202">            float startDist = (float) Math.hypot(startDeltaX, startDeltaY);</span>
<span class="nc" id="L203">            float currentDist = (float) Math.hypot(currentDeltaX, currentDeltaY);</span>
<span class="nc bnc" id="L204" title="All 8 branches missed.">            return (ListenerUtil.mutListener.listen(8705) ? (currentDist % startDist) : (ListenerUtil.mutListener.listen(8704) ? (currentDist * startDist) : (ListenerUtil.mutListener.listen(8703) ? (currentDist - startDist) : (ListenerUtil.mutListener.listen(8702) ? (currentDist + startDist) : (currentDist / startDist)))));</span>
        }
    }

    /**
     * Gets the rotation in radians
     */
    public float getRotation() {
<span class="nc bnc" id="L212" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(8710) ? (mDetector.getPointerCount() &gt;= 2) : (ListenerUtil.mutListener.listen(8709) ? (mDetector.getPointerCount() &lt;= 2) : (ListenerUtil.mutListener.listen(8708) ? (mDetector.getPointerCount() &gt; 2) : (ListenerUtil.mutListener.listen(8707) ? (mDetector.getPointerCount() != 2) : (ListenerUtil.mutListener.listen(8706) ? (mDetector.getPointerCount() == 2) : (mDetector.getPointerCount() &lt; 2))))))) {</span>
<span class="nc" id="L213">            return 0;</span>
        } else {
<span class="nc bnc" id="L215" title="All 8 branches missed.">            float startDeltaX = (ListenerUtil.mutListener.listen(8714) ? (mDetector.getStartX()[1] % mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8713) ? (mDetector.getStartX()[1] / mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8712) ? (mDetector.getStartX()[1] * mDetector.getStartX()[0]) : (ListenerUtil.mutListener.listen(8711) ? (mDetector.getStartX()[1] + mDetector.getStartX()[0]) : (mDetector.getStartX()[1] - mDetector.getStartX()[0])))));</span>
<span class="nc bnc" id="L216" title="All 8 branches missed.">            float startDeltaY = (ListenerUtil.mutListener.listen(8718) ? (mDetector.getStartY()[1] % mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8717) ? (mDetector.getStartY()[1] / mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8716) ? (mDetector.getStartY()[1] * mDetector.getStartY()[0]) : (ListenerUtil.mutListener.listen(8715) ? (mDetector.getStartY()[1] + mDetector.getStartY()[0]) : (mDetector.getStartY()[1] - mDetector.getStartY()[0])))));</span>
<span class="nc bnc" id="L217" title="All 8 branches missed.">            float currentDeltaX = (ListenerUtil.mutListener.listen(8722) ? (mDetector.getCurrentX()[1] % mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8721) ? (mDetector.getCurrentX()[1] / mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8720) ? (mDetector.getCurrentX()[1] * mDetector.getCurrentX()[0]) : (ListenerUtil.mutListener.listen(8719) ? (mDetector.getCurrentX()[1] + mDetector.getCurrentX()[0]) : (mDetector.getCurrentX()[1] - mDetector.getCurrentX()[0])))));</span>
<span class="nc bnc" id="L218" title="All 8 branches missed.">            float currentDeltaY = (ListenerUtil.mutListener.listen(8726) ? (mDetector.getCurrentY()[1] % mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8725) ? (mDetector.getCurrentY()[1] / mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8724) ? (mDetector.getCurrentY()[1] * mDetector.getCurrentY()[0]) : (ListenerUtil.mutListener.listen(8723) ? (mDetector.getCurrentY()[1] + mDetector.getCurrentY()[0]) : (mDetector.getCurrentY()[1] - mDetector.getCurrentY()[0])))));</span>
<span class="nc" id="L219">            float startAngle = (float) Math.atan2(startDeltaY, startDeltaX);</span>
<span class="nc" id="L220">            float currentAngle = (float) Math.atan2(currentDeltaY, currentDeltaX);</span>
<span class="nc bnc" id="L221" title="All 8 branches missed.">            return (ListenerUtil.mutListener.listen(8730) ? (currentAngle % startAngle) : (ListenerUtil.mutListener.listen(8729) ? (currentAngle / startAngle) : (ListenerUtil.mutListener.listen(8728) ? (currentAngle * startAngle) : (ListenerUtil.mutListener.listen(8727) ? (currentAngle + startAngle) : (currentAngle - startAngle)))));</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>