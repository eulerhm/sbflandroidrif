<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContributionsListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.contributions</a> &gt; <span class="el_source">ContributionsListFragment.java</span></div><h1>ContributionsListFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.contributions;

import static android.view.View.GONE;
import static android.view.View.VISIBLE;
import static fr.free.nrw.commons.di.NetworkingModule.NAMED_LANGUAGE_WIKI_PEDIA_WIKI_SITE;
import android.Manifest.permission;
import android.content.Context;
import android.content.res.Configuration;
import android.net.Uri;
import android.os.Bundle;
import android.os.Parcelable;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.Animation;
import android.view.animation.AnimationUtils;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.TextView;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.VisibleForTesting;
import androidx.appcompat.widget.AppCompatTextView;
import androidx.fragment.app.FragmentManager;
import androidx.recyclerview.widget.GridLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import androidx.recyclerview.widget.RecyclerView.AdapterDataObserver;
import androidx.recyclerview.widget.RecyclerView.ItemAnimator;
import androidx.recyclerview.widget.RecyclerView.OnItemTouchListener;
import androidx.recyclerview.widget.SimpleItemAnimator;
import com.google.android.material.floatingactionbutton.FloatingActionButton;
import fr.free.nrw.commons.CommonsApplication;
import fr.free.nrw.commons.Media;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.auth.SessionManager;
import fr.free.nrw.commons.databinding.FragmentContributionsListBinding;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.media.MediaClient;
import fr.free.nrw.commons.profile.ProfileActivity;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.SystemThemeUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import java.util.Locale;
import java.util.Map;
import java.util.Objects;
import javax.inject.Inject;
import javax.inject.Named;
import org.apache.commons.lang3.StringUtils;
import org.wikipedia.dataclient.WikiSite;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L57">public class ContributionsListFragment extends CommonsDaggerSupportFragment implements ContributionsListContract.View, ContributionsListAdapter.Callback, WikipediaInstructionsDialogFragment.Callback {</span>

    private static final String RV_STATE = &quot;rv_scroll_state&quot;;

    @Inject
    SystemThemeUtils systemThemeUtils;

    @Inject
    ContributionController controller;

    @Inject
    MediaClient mediaClient;

    @Named(NAMED_LANGUAGE_WIKI_PEDIA_WIKI_SITE)
    @Inject
    WikiSite languageWikipediaSite;

    @Inject
    ContributionsListPresenter contributionsListPresenter;

    @Inject
    SessionManager sessionManager;

    private FragmentContributionsListBinding binding;

    private Animation fab_close;

    private Animation fab_open;

    private Animation rotate_forward;

    private Animation rotate_backward;

    private boolean isFabOpen;

    @VisibleForTesting
    protected RecyclerView rvContributionsList;

    @VisibleForTesting
    protected ContributionsListAdapter adapter;

    @Nullable
    @VisibleForTesting
    protected Callback callback;

<span class="fc" id="L102">    private final int SPAN_COUNT_LANDSCAPE = 3;</span>

<span class="fc" id="L104">    private final int SPAN_COUNT_PORTRAIT = 1;</span>

    private int contributionsSize;

    private String userName;

<span class="fc" id="L110">    private ActivityResultLauncher&lt;String[]&gt; inAppCameraLocationPermissionLauncher = registerForActivityResult(new ActivityResultContracts.RequestMultiplePermissions(), new ActivityResultCallback&lt;Map&lt;String, Boolean&gt;&gt;() {</span>

        @Override
        public void onActivityResult(Map&lt;String, Boolean&gt; result) {
<span class="nc" id="L114">            boolean areAllGranted = true;</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(751)) {</span>
                {
<span class="nc" id="L117">                    long _loopCounter14 = 0;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">                    for (final boolean b : result.values()) {</span>
<span class="nc" id="L119">                        ListenerUtil.loopListener.listen(&quot;_loopCounter14&quot;, ++_loopCounter14);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(750)) {</span>
<span class="nc bnc" id="L121" title="All 10 branches missed.">                            areAllGranted = (ListenerUtil.mutListener.listen(749) ? (areAllGranted || b) : (areAllGranted &amp;&amp; b));</span>
                        }
<span class="nc" id="L123">                    }</span>
                }
            }
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(756)) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                if (areAllGranted) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(755)) {</span>
<span class="nc" id="L129">                        controller.locationPermissionCallback.onLocationPermissionGranted();</span>
                    }
                } else {
<span class="nc bnc" id="L132" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(754)) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                        if (shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(753)) {</span>
<span class="nc" id="L135">                                controller.handleShowRationaleFlowCameraLocation(getActivity());</span>
                            }
                        } else {
<span class="nc bnc" id="L138" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(752)) {</span>
<span class="nc" id="L139">                                controller.locationPermissionCallback.onLocationPermissionDenied(getActivity().getString(R.string.in_app_camera_location_permission_denied));</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L145">        }</span>
    });

    @Override
    public void onCreate(@Nullable @org.jetbrains.annotations.Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(757)) {</span>
<span class="fc" id="L151">            super.onCreate(savedInstanceState);</span>
        }
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(759)) {</span>
            // any userName- we expect it to be passed as an argument
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">            if (getArguments() != null) {</span>
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(758)) {</span>
<span class="fc" id="L157">                    userName = getArguments().getString(ProfileActivity.KEY_USERNAME);</span>
                }
            }
        }
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(761)) {</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">            if (StringUtils.isEmpty(userName)) {</span>
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(760)) {</span>
<span class="fc" id="L164">                    userName = sessionManager.getUserName();</span>
                }
            }
        }
<span class="fc" id="L168">    }</span>

    @Override
    public View onCreateView(final LayoutInflater inflater, @Nullable final ViewGroup container, @Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(762)) {</span>
<span class="fc" id="L173">            binding = FragmentContributionsListBinding.inflate(inflater, container, false);</span>
        }
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(763)) {</span>
<span class="fc" id="L176">            rvContributionsList = binding.contributionsList;</span>
        }
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(764)) {</span>
<span class="fc" id="L179">            contributionsListPresenter.onAttachView(this);</span>
        }
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(765)) {</span>
<span class="pc" id="L182">            binding.fabCustomGallery.setOnClickListener(v -&gt; launchCustomSelector());</span>
        }
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(771)) {</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">            if (Objects.equals(sessionManager.getUserName(), userName)) {</span>
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(769)) {</span>
<span class="fc" id="L187">                    binding.tvContributionsOfUser.setVisibility(GONE);</span>
                }
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(770)) {</span>
<span class="fc" id="L190">                    binding.fabLayout.setVisibility(VISIBLE);</span>
                }
            } else {
<span class="nc bnc" id="L193" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(766)) {</span>
<span class="nc" id="L194">                    binding.tvContributionsOfUser.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L196" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(767)) {</span>
<span class="nc" id="L197">                    binding.tvContributionsOfUser.setText(getString(R.string.contributions_of_user, userName));</span>
                }
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(768)) {</span>
<span class="nc" id="L200">                    binding.fabLayout.setVisibility(GONE);</span>
                }
            }
        }
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(772)) {</span>
<span class="fc" id="L205">            initAdapter();</span>
        }
<span class="fc" id="L207">        return binding.getRoot();</span>
    }

    @Override
    public void onDestroyView() {
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(773)) {</span>
<span class="fc" id="L213">            binding = null;</span>
        }
<span class="pc bpc" id="L215" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(774)) {</span>
<span class="fc" id="L216">            super.onDestroyView();</span>
        }
<span class="fc" id="L218">    }</span>

    @Override
    public void onAttach(Context context) {
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(775)) {</span>
<span class="fc" id="L223">            super.onAttach(context);</span>
        }
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(778)) {</span>
<span class="pc bpc" id="L226" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(776) ? (getParentFragment() != null || getParentFragment() instanceof ContributionsFragment) : (getParentFragment() != null &amp;&amp; getParentFragment() instanceof ContributionsFragment))) {</span>
<span class="pc bpc" id="L227" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(777)) {</span>
<span class="fc" id="L228">                    callback = ((ContributionsFragment) getParentFragment());</span>
                }
            }
        }
<span class="fc" id="L232">    }</span>

    @Override
    public void onDetach() {
<span class="nc bnc" id="L236" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(779)) {</span>
<span class="nc" id="L237">            super.onDetach();</span>
        }
<span class="nc bnc" id="L239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(780)) {</span>
            // To avoid possible memory leak
<span class="nc" id="L241">            callback = null;</span>
        }
<span class="nc" id="L243">    }</span>

    private void initAdapter() {
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(781)) {</span>
<span class="fc" id="L247">            adapter = new ContributionsListAdapter(this, mediaClient);</span>
        }
<span class="fc" id="L249">    }</span>

    @Override
    public void onViewCreated(final View view, @Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(782)) {</span>
<span class="fc" id="L254">            super.onViewCreated(view, savedInstanceState);</span>
        }
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(783)) {</span>
<span class="fc" id="L257">            initRecyclerView();</span>
        }
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(784)) {</span>
<span class="fc" id="L260">            initializeAnimations();</span>
        }
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(785)) {</span>
<span class="fc" id="L263">            setListeners();</span>
        }
<span class="fc" id="L265">    }</span>

    private void initRecyclerView() {
<span class="fc" id="L268">        final GridLayoutManager layoutManager = new GridLayoutManager(getContext(), getSpanCount(getResources().getConfiguration().orientation));</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(786)) {</span>
<span class="fc" id="L270">            rvContributionsList.setLayoutManager(layoutManager);</span>
        }
        // Setting flicker animation of recycler view to false.
<span class="fc" id="L273">        final ItemAnimator animator = rvContributionsList.getItemAnimator();</span>
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(788)) {</span>
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">            if (animator instanceof SimpleItemAnimator) {</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(787)) {</span>
<span class="fc" id="L277">                    ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);</span>
                }
            }
        }
<span class="pc bpc" id="L281" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(789)) {</span>
<span class="fc" id="L282">            contributionsListPresenter.setup(userName, Objects.equals(sessionManager.getUserName(), userName));</span>
        }
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(790)) {</span>
<span class="fc" id="L285">            contributionsListPresenter.contributionList.observe(getViewLifecycleOwner(), list -&gt; {</span>
<span class="fc" id="L286">                contributionsSize = list.size();</span>
<span class="fc" id="L287">                adapter.submitList(list);</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">                if (callback != null) {</span>
<span class="fc" id="L289">                    callback.notifyDataSetChanged();</span>
                }
<span class="fc" id="L291">            });</span>
        }
<span class="pc bpc" id="L293" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(791)) {</span>
<span class="fc" id="L294">            rvContributionsList.setAdapter(adapter);</span>
        }
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(813)) {</span>
<span class="fc" id="L297">            adapter.registerAdapterDataObserver(new AdapterDataObserver() {</span>

                @Override
                public void onItemRangeInserted(int positionStart, int itemCount) {
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(792)) {</span>
<span class="fc" id="L302">                        super.onItemRangeInserted(positionStart, itemCount);</span>
                    }
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(793)) {</span>
<span class="fc" id="L305">                        contributionsSize = adapter.getItemCount();</span>
                    }
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(795)) {</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">                        if (callback != null) {</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(794)) {</span>
<span class="fc" id="L310">                                callback.notifyDataSetChanged();</span>
                            }
                        }
                    }
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(809)) {</span>
<span class="pc bpc" id="L315" title="83 of 90 branches missed.">                        if ((ListenerUtil.mutListener.listen(806) ? ((ListenerUtil.mutListener.listen(800) ? (itemCount &gt;= 0) : (ListenerUtil.mutListener.listen(799) ? (itemCount &lt;= 0) : (ListenerUtil.mutListener.listen(798) ? (itemCount &lt; 0) : (ListenerUtil.mutListener.listen(797) ? (itemCount != 0) : (ListenerUtil.mutListener.listen(796) ? (itemCount == 0) : (itemCount &gt; 0)))))) || (ListenerUtil.mutListener.listen(805) ? (positionStart &gt;= 0) : (ListenerUtil.mutListener.listen(804) ? (positionStart &lt;= 0) : (ListenerUtil.mutListener.listen(803) ? (positionStart &gt; 0) : (ListenerUtil.mutListener.listen(802) ? (positionStart &lt; 0) : (ListenerUtil.mutListener.listen(801) ? (positionStart != 0) : (positionStart == 0))))))) : ((ListenerUtil.mutListener.listen(800) ? (itemCount &gt;= 0) : (ListenerUtil.mutListener.listen(799) ? (itemCount &lt;= 0) : (ListenerUtil.mutListener.listen(798) ? (itemCount &lt; 0) : (ListenerUtil.mutListener.listen(797) ? (itemCount != 0) : (ListenerUtil.mutListener.listen(796) ? (itemCount == 0) : (itemCount &gt; 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(805) ? (positionStart &gt;= 0) : (ListenerUtil.mutListener.listen(804) ? (positionStart &lt;= 0) : (ListenerUtil.mutListener.listen(803) ? (positionStart &gt; 0) : (ListenerUtil.mutListener.listen(802) ? (positionStart &lt; 0) : (ListenerUtil.mutListener.listen(801) ? (positionStart != 0) : (positionStart == 0))))))))) {</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(808)) {</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                                if (adapter.getContributionForPosition(positionStart) != null) {</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(807)) {</span>
<span class="nc" id="L319">                                        rvContributionsList.scrollToPosition(// Newly upload items are always added to the top</span>
                                        0);
                                    }
                                }
                            }
                        }
                    }
<span class="fc" id="L326">                }</span>

                /**
                 * Called whenever items in the list have changed
                 * Calls viewPagerNotifyDataSetChanged() that will notify the viewpager
                 */
                @Override
                public void onItemRangeChanged(final int positionStart, final int itemCount) {
<span class="nc bnc" id="L334" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(810)) {</span>
<span class="nc" id="L335">                        super.onItemRangeChanged(positionStart, itemCount);</span>
                    }
<span class="nc bnc" id="L337" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(812)) {</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">                        if (callback != null) {</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(811)) {</span>
<span class="nc" id="L340">                                callback.viewPagerNotifyDataSetChanged();</span>
                            }
                        }
                    }
<span class="nc" id="L344">                }</span>
            });
        }
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(817)) {</span>
            // Fab close on touch outside (Scrolling or taping on item triggers this action).
<span class="fc" id="L349">            rvContributionsList.addOnItemTouchListener(new OnItemTouchListener() {</span>

                /**
                 * Silently observe and/or take over touch events sent to the RecyclerView before
                 * they are handled by either the RecyclerView itself or its child views.
                 */
                @Override
                public boolean onInterceptTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {
<span class="nc bnc" id="L357" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(816)) {</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                        if (e.getAction() == MotionEvent.ACTION_DOWN) {</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(815)) {</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">                                if (isFabOpen) {</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(814)) {</span>
<span class="nc" id="L362">                                        animateFAB(isFabOpen);</span>
                                    }
                                }
                            }
                        }
                    }
<span class="nc" id="L368">                    return false;</span>
                }

                /**
                 * Process a touch event as part of a gesture that was claimed by returning true
                 * from a previous call to {@link #onInterceptTouchEvent}.
                 *
                 * @param rv
                 * @param e  MotionEvent describing the touch event. All coordinates are in the
                 *           RecyclerView's coordinate system.
                 */
                @Override
                public void onTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {
<span class="nc" id="L381">                }</span>

                /**
                 * Called when a child of RecyclerView does not want RecyclerView and its ancestors
                 * to intercept touch events with {@link ViewGroup#onInterceptTouchEvent(MotionEvent)}.
                 *
                 * @param disallowIntercept True if the child does not want the parent to intercept
                 *                          touch events.
                 */
                @Override
                public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {
<span class="nc" id="L392">                }</span>
            });
        }
<span class="fc" id="L395">    }</span>

    private int getSpanCount(final int orientation) {
<span class="pc bpc" id="L398" title="1 of 2 branches missed.">        return orientation == Configuration.ORIENTATION_LANDSCAPE ? SPAN_COUNT_LANDSCAPE : SPAN_COUNT_PORTRAIT;</span>
    }

    @Override
    public void onConfigurationChanged(final Configuration newConfig) {
<span class="nc bnc" id="L403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(818)) {</span>
<span class="nc" id="L404">            super.onConfigurationChanged(newConfig);</span>
        }
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(819)) {</span>
            // check orientation
<span class="nc bnc" id="L408" title="All 2 branches missed.">            binding.fabLayout.setOrientation(newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE ? LinearLayout.HORIZONTAL : LinearLayout.VERTICAL);</span>
        }
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(820)) {</span>
<span class="nc" id="L411">            rvContributionsList.setLayoutManager(new GridLayoutManager(getContext(), getSpanCount(newConfig.orientation)));</span>
        }
<span class="nc" id="L413">    }</span>

    private void initializeAnimations() {
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(821)) {</span>
<span class="fc" id="L417">            fab_open = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_open);</span>
        }
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(822)) {</span>
<span class="fc" id="L420">            fab_close = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_close);</span>
        }
<span class="pc bpc" id="L422" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(823)) {</span>
<span class="fc" id="L423">            rotate_forward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_forward);</span>
        }
<span class="pc bpc" id="L425" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(824)) {</span>
<span class="fc" id="L426">            rotate_backward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_backward);</span>
        }
<span class="fc" id="L428">    }</span>

    private void setListeners() {
<span class="pc bpc" id="L431" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(825)) {</span>
<span class="pc" id="L432">            binding.fabPlus.setOnClickListener(view -&gt; animateFAB(isFabOpen));</span>
        }
<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(826)) {</span>
<span class="fc" id="L435">            binding.fabCamera.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L436">                controller.initiateCameraPick(getActivity(), inAppCameraLocationPermissionLauncher);</span>
<span class="nc" id="L437">                animateFAB(isFabOpen);</span>
<span class="nc" id="L438">            });</span>
        }
<span class="pc bpc" id="L440" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(827)) {</span>
<span class="fc" id="L441">            binding.fabGallery.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L442">                controller.initiateGalleryPick(getActivity(), true);</span>
<span class="nc" id="L443">                animateFAB(isFabOpen);</span>
<span class="nc" id="L444">            });</span>
        }
<span class="fc" id="L446">    }</span>

    /**
     * Launch Custom Selector.
     */
    protected void launchCustomSelector() {
<span class="nc bnc" id="L452" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(828)) {</span>
<span class="nc" id="L453">            controller.initiateCustomGalleryPickWithPermission(getActivity());</span>
        }
<span class="nc bnc" id="L455" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(829)) {</span>
<span class="nc" id="L456">            animateFAB(isFabOpen);</span>
        }
<span class="nc" id="L458">    }</span>

    public void scrollToTop() {
<span class="nc bnc" id="L461" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(830)) {</span>
<span class="nc" id="L462">            rvContributionsList.smoothScrollToPosition(0);</span>
        }
<span class="nc" id="L464">    }</span>

    private void animateFAB(final boolean isFabOpen) {
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(831)) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            this.isFabOpen = !isFabOpen;</span>
        }
<span class="nc bnc" id="L470" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(848)) {</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">            if (binding.fabPlus.isShown()) {</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(846)) {</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                    if (isFabOpen) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(839)) {</span>
<span class="nc" id="L475">                            binding.fabPlus.startAnimation(rotate_backward);</span>
                        }
<span class="nc bnc" id="L477" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(840)) {</span>
<span class="nc" id="L478">                            binding.fabCamera.startAnimation(fab_close);</span>
                        }
<span class="nc bnc" id="L480" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(841)) {</span>
<span class="nc" id="L481">                            binding.fabGallery.startAnimation(fab_close);</span>
                        }
<span class="nc bnc" id="L483" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(842)) {</span>
<span class="nc" id="L484">                            binding.fabCustomGallery.startAnimation(fab_close);</span>
                        }
<span class="nc bnc" id="L486" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(843)) {</span>
<span class="nc" id="L487">                            binding.fabCamera.hide();</span>
                        }
<span class="nc bnc" id="L489" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(844)) {</span>
<span class="nc" id="L490">                            binding.fabGallery.hide();</span>
                        }
<span class="nc bnc" id="L492" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(845)) {</span>
<span class="nc" id="L493">                            binding.fabCustomGallery.hide();</span>
                        }
                    } else {
<span class="nc bnc" id="L496" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(832)) {</span>
<span class="nc" id="L497">                            binding.fabPlus.startAnimation(rotate_forward);</span>
                        }
<span class="nc bnc" id="L499" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(833)) {</span>
<span class="nc" id="L500">                            binding.fabCamera.startAnimation(fab_open);</span>
                        }
<span class="nc bnc" id="L502" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(834)) {</span>
<span class="nc" id="L503">                            binding.fabGallery.startAnimation(fab_open);</span>
                        }
<span class="nc bnc" id="L505" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(835)) {</span>
<span class="nc" id="L506">                            binding.fabCustomGallery.startAnimation(fab_open);</span>
                        }
<span class="nc bnc" id="L508" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(836)) {</span>
<span class="nc" id="L509">                            binding.fabCamera.show();</span>
                        }
<span class="nc bnc" id="L511" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(837)) {</span>
<span class="nc" id="L512">                            binding.fabGallery.show();</span>
                        }
<span class="nc bnc" id="L514" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(838)) {</span>
<span class="nc" id="L515">                            binding.fabCustomGallery.show();</span>
                        }
                    }
                }
<span class="nc bnc" id="L519" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(847)) {</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">                    this.isFabOpen = !isFabOpen;</span>
                }
            }
        }
<span class="nc" id="L524">    }</span>

    /**
     * Shows welcome message if user has no contributions yet i.e. new user.
     */
    @Override
    public void showWelcomeTip(final boolean shouldShow) {
<span class="nc bnc" id="L531" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(849)) {</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">            binding.noContributionsYet.setVisibility(shouldShow ? VISIBLE : GONE);</span>
        }
<span class="nc" id="L534">    }</span>

    /**
     * Responsible to set progress bar invisible and visible
     *
     * @param shouldShow True when contributions list should be hidden.
     */
    @Override
    public void showProgress(final boolean shouldShow) {
<span class="nc bnc" id="L543" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(850)) {</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">            binding.loadingContributionsProgressBar.setVisibility(shouldShow ? VISIBLE : GONE);</span>
        }
<span class="nc" id="L546">    }</span>

    @Override
    public void showNoContributionsUI(final boolean shouldShow) {
<span class="nc bnc" id="L550" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(851)) {</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">            binding.noContributionsYet.setVisibility(shouldShow ? VISIBLE : GONE);</span>
        }
<span class="nc" id="L553">    }</span>

    @Override
    public void onSaveInstanceState(@NonNull Bundle outState) {
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(852)) {</span>
<span class="nc" id="L558">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc" id="L560">        final GridLayoutManager layoutManager = (GridLayoutManager) rvContributionsList.getLayoutManager();</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(853)) {</span>
<span class="nc" id="L562">            outState.putParcelable(RV_STATE, layoutManager.onSaveInstanceState());</span>
        }
<span class="nc" id="L564">    }</span>

    @Override
    public void onViewStateRestored(@Nullable Bundle savedInstanceState) {
<span class="pc bpc" id="L568" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(854)) {</span>
<span class="fc" id="L569">            super.onViewStateRestored(savedInstanceState);</span>
        }
<span class="pc bpc" id="L571" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(856)) {</span>
<span class="pc bpc" id="L572" title="1 of 2 branches missed.">            if (null != savedInstanceState) {</span>
<span class="nc" id="L573">                final Parcelable savedRecyclerLayoutState = savedInstanceState.getParcelable(RV_STATE);</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(855)) {</span>
<span class="nc" id="L575">                    rvContributionsList.getLayoutManager().onRestoreInstanceState(savedRecyclerLayoutState);</span>
                }
            }
        }
<span class="fc" id="L579">    }</span>

    @Override
    public void retryUpload(final Contribution contribution) {
<span class="nc bnc" id="L583" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(858)) {</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">            if (null != callback) {</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(857)) {</span>
                    // Just being safe, ideally they won't be called when detached
<span class="nc" id="L587">                    callback.retryUpload(contribution);</span>
                }
            }
        }
<span class="nc" id="L591">    }</span>

    @Override
    public void deleteUpload(final Contribution contribution) {
<span class="nc bnc" id="L595" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(859)) {</span>
<span class="nc" id="L596">            DialogUtil.showAlertDialog(getActivity(), String.format(Locale.getDefault(), getString(R.string.cancelling_upload)), String.format(Locale.getDefault(), getString(R.string.cancel_upload_dialog)), String.format(Locale.getDefault(), getString(R.string.yes)), String.format(Locale.getDefault(), getString(R.string.no)), () -&gt; {</span>
<span class="nc" id="L597">                ViewUtil.showShortToast(getContext(), R.string.cancelling_upload);</span>
<span class="nc" id="L598">                contributionsListPresenter.deleteUpload(contribution);</span>
<span class="nc" id="L599">                CommonsApplication.cancelledUploads.add(contribution.getPageId());</span>
<span class="nc" id="L600">            }, () -&gt; {</span>
<span class="nc" id="L601">            });</span>
        }
<span class="nc" id="L603">    }</span>

    @Override
    public void openMediaDetail(final int position, boolean isWikipediaButtonDisplayed) {
<span class="nc bnc" id="L607" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(861)) {</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">            if (null != callback) {</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(860)) {</span>
                    // Just being safe, ideally they won't be called when detached
<span class="nc" id="L611">                    callback.showDetail(position, isWikipediaButtonDisplayed);</span>
                }
            }
        }
<span class="nc" id="L615">    }</span>

    /**
     * Handle callback for wikipedia icon clicked
     *
     * @param contribution
     */
    @Override
    public void addImageToWikipedia(Contribution contribution) {
<span class="nc bnc" id="L624" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(862)) {</span>
<span class="nc" id="L625">            DialogUtil.showAlertDialog(getActivity(), getString(R.string.add_picture_to_wikipedia_article_title), getString(R.string.add_picture_to_wikipedia_article_desc), () -&gt; {</span>
<span class="nc" id="L626">                showAddImageToWikipediaInstructions(contribution);</span>
<span class="nc" id="L627">            }, () -&gt; {</span>
<span class="nc" id="L628">            });</span>
        }
<span class="nc" id="L630">    }</span>

    /**
     * Pauses the current upload
     *
     * @param contribution
     */
    @Override
    public void pauseUpload(Contribution contribution) {
<span class="nc bnc" id="L639" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(863)) {</span>
<span class="nc" id="L640">            ViewUtil.showShortToast(getContext(), R.string.pausing_upload);</span>
        }
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(864)) {</span>
<span class="nc" id="L643">            callback.pauseUpload(contribution);</span>
        }
<span class="nc" id="L645">    }</span>

    /**
     * Resumes the current upload
     *
     * @param contribution
     */
    @Override
    public void resumeUpload(Contribution contribution) {
<span class="nc bnc" id="L654" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(865)) {</span>
<span class="nc" id="L655">            ViewUtil.showShortToast(getContext(), R.string.resuming_upload);</span>
        }
<span class="nc bnc" id="L657" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(866)) {</span>
<span class="nc" id="L658">            callback.retryUpload(contribution);</span>
        }
<span class="nc" id="L660">    }</span>

    /**
     * Display confirmation dialog with instructions when the user tries to add image to wikipedia
     *
     * @param contribution
     */
    private void showAddImageToWikipediaInstructions(Contribution contribution) {
<span class="nc" id="L668">        FragmentManager fragmentManager = getFragmentManager();</span>
<span class="nc" id="L669">        WikipediaInstructionsDialogFragment fragment = WikipediaInstructionsDialogFragment.newInstance(contribution);</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(867)) {</span>
<span class="nc" id="L671">            fragment.setCallback(this::onConfirmClicked);</span>
        }
<span class="nc bnc" id="L673" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(868)) {</span>
<span class="nc" id="L674">            fragment.show(fragmentManager, &quot;WikimediaFragment&quot;);</span>
        }
<span class="nc" id="L676">    }</span>

    public Media getMediaAtPosition(final int i) {
<span class="nc bnc" id="L679" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(869)) {</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">            if (adapter.getContributionForPosition(i) != null) {</span>
<span class="nc" id="L681">                return adapter.getContributionForPosition(i).getMedia();</span>
            }
        }
<span class="nc" id="L684">        return null;</span>
    }

    public int getTotalMediaCount() {
<span class="nc" id="L688">        return contributionsSize;</span>
    }

    /**
     * Open the editor for the language Wikipedia
     *
     * @param contribution
     */
    @Override
    public void onConfirmClicked(@Nullable Contribution contribution, boolean copyWikicode) {
<span class="nc bnc" id="L698" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(871)) {</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if (copyWikicode) {</span>
<span class="nc" id="L700">                String wikicode = contribution.getMedia().getWikiCode();</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(870)) {</span>
<span class="nc" id="L702">                    Utils.copy(&quot;wikicode&quot;, wikicode, getContext());</span>
                }
            }
        }
<span class="nc" id="L706">        final String url = languageWikipediaSite.mobileUrl() + &quot;/wiki/&quot; + contribution.getWikidataPlace().getWikipediaPageTitle();</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(872)) {</span>
<span class="nc" id="L708">            Utils.handleWebUrl(getContext(), Uri.parse(url));</span>
        }
<span class="nc" id="L710">    }</span>

    public Integer getContributionStateAt(int position) {
<span class="nc" id="L713">        return adapter.getContributionForPosition(position).getState();</span>
    }

    public interface Callback {

        void notifyDataSetChanged();

        void retryUpload(Contribution contribution);

        void showDetail(int position, boolean isWikipediaButtonDisplayed);

        void pauseUpload(Contribution contribution);

        // Notify the viewpager that number of items have changed.
        void viewPagerNotifyDataSetChanged();
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>