<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NearbyParentFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.nearby.fragments</a> &gt; <span class="el_source">NearbyParentFragment.java</span></div><h1>NearbyParentFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.nearby.fragments;

import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.CUSTOM_QUERY;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.LOCATION_SIGNIFICANTLY_CHANGED;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.LOCATION_SLIGHTLY_CHANGED;
import static fr.free.nrw.commons.location.LocationServiceManager.LocationChangeType.MAP_UPDATED;
import static fr.free.nrw.commons.wikidata.WikidataConstants.PLACE_OBJECT;
import android.Manifest;
import android.Manifest.permission;
import android.annotation.SuppressLint;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.pm.PackageManager;
import android.content.res.Configuration;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.drawable.Drawable;
import android.location.Location;
import android.location.LocationManager;
import android.net.Uri;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.provider.Settings;
import android.text.Html;
import android.text.method.LinkMovementMethod;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.MenuItem.OnMenuItemClickListener;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.Animation;
import android.view.animation.AnimationUtils;
import android.widget.Button;
import android.widget.FrameLayout;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.Toast;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.DrawableRes;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.widget.AppCompatButton;
import androidx.appcompat.widget.AppCompatImageView;
import androidx.appcompat.widget.AppCompatTextView;
import androidx.appcompat.widget.SearchView;
import androidx.core.content.ContextCompat;
import androidx.recyclerview.widget.DividerItemDecoration;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;
import com.google.android.material.bottomsheet.BottomSheetBehavior;
import com.google.android.material.chip.Chip;
import com.google.android.material.chip.ChipGroup;
import com.google.android.material.floatingactionbutton.FloatingActionButton;
import com.google.android.material.snackbar.Snackbar;
import com.jakewharton.rxbinding2.view.RxView;
import com.jakewharton.rxbinding3.appcompat.RxSearchView;
import com.mapbox.mapboxsdk.annotations.Marker;
import com.mapbox.mapboxsdk.geometry.LatLng;
import com.mapbox.mapboxsdk.geometry.LatLngBounds;
import fr.free.nrw.commons.CommonsApplication;
import fr.free.nrw.commons.MapController.NearbyPlacesInfo;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.auth.LoginActivity;
import fr.free.nrw.commons.bookmarks.locations.BookmarkLocationsDao;
import fr.free.nrw.commons.contributions.ContributionController;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.contributions.MainActivity.ActiveFragment;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.location.LocationServiceManager;
import fr.free.nrw.commons.location.LocationUpdateListener;
import fr.free.nrw.commons.nearby.CheckBoxTriStates;
import fr.free.nrw.commons.nearby.Label;
import fr.free.nrw.commons.nearby.MarkerPlaceGroup;
import fr.free.nrw.commons.nearby.NearbyBaseMarker;
import fr.free.nrw.commons.nearby.NearbyController;
import fr.free.nrw.commons.nearby.NearbyFilterSearchRecyclerViewAdapter;
import fr.free.nrw.commons.nearby.NearbyFilterState;
import fr.free.nrw.commons.nearby.NearbyMarker;
import fr.free.nrw.commons.nearby.Place;
import fr.free.nrw.commons.nearby.contract.NearbyParentFragmentContract;
import fr.free.nrw.commons.nearby.fragments.AdvanceQueryFragment.Callback;
import fr.free.nrw.commons.nearby.presenter.NearbyParentFragmentPresenter;
import fr.free.nrw.commons.upload.FileUtils;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.ExecutorUtils;
import fr.free.nrw.commons.utils.LayoutUtils;
import fr.free.nrw.commons.utils.LocationUtils;
import fr.free.nrw.commons.utils.NearbyFABUtils;
import fr.free.nrw.commons.utils.NetworkUtils;
import fr.free.nrw.commons.utils.PermissionUtils;
import fr.free.nrw.commons.utils.SystemThemeUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import fr.free.nrw.commons.wikidata.WikidataEditListener;
import io.reactivex.Observable;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.schedulers.Schedulers;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.concurrent.TimeUnit;
import javax.inject.Inject;
import javax.inject.Named;
import kotlin.Unit;
import org.jetbrains.annotations.NotNull;
import org.osmdroid.events.MapEventsReceiver;
import org.osmdroid.events.MapListener;
import org.osmdroid.events.ScrollEvent;
import org.osmdroid.events.ZoomEvent;
import org.osmdroid.tileprovider.tilesource.TileSourceFactory;
import org.osmdroid.util.GeoPoint;
import org.osmdroid.util.constants.GeoConstants;
import org.osmdroid.views.CustomZoomButtonsController;
import org.osmdroid.views.overlay.ItemizedIconOverlay.OnItemGestureListener;
import org.osmdroid.views.overlay.ItemizedOverlayWithFocus;
import org.osmdroid.views.overlay.MapEventsOverlay;
import org.osmdroid.views.overlay.Overlay;
import org.osmdroid.views.overlay.OverlayItem;
import org.osmdroid.views.overlay.ScaleBarOverlay;
import org.osmdroid.views.overlay.ScaleDiskOverlay;
import org.osmdroid.views.overlay.TilesOverlay;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L142">public class NearbyParentFragment extends CommonsDaggerSupportFragment implements NearbyParentFragmentContract.View, WikidataEditListener.WikidataP18EditListener, LocationUpdateListener {</span>

    @BindView(R.id.bottom_sheet)
    RelativeLayout rlBottomSheet;

    @BindView(R.id.bottom_sheet_details)
    View bottomSheetDetails;

    @BindView(R.id.transparentView)
    View transparentView;

    @BindView(R.id.directionsButtonText)
    TextView directionsButtonText;

    @BindView(R.id.wikipediaButtonText)
    TextView wikipediaButtonText;

    @BindView(R.id.wikidataButtonText)
    TextView wikidataButtonText;

    @BindView(R.id.commonsButtonText)
    TextView commonsButtonText;

    @BindView(R.id.fab_plus)
    FloatingActionButton fabPlus;

    @BindView(R.id.fab_camera)
    FloatingActionButton fabCamera;

    @BindView(R.id.fab_gallery)
    FloatingActionButton fabGallery;

    @BindView(R.id.fab_recenter)
    FloatingActionButton fabRecenter;

    @BindView(R.id.bookmarkButtonImage)
    ImageView bookmarkButtonImage;

    @BindView(R.id.bookmarkButton)
    LinearLayout bookmarkButton;

    @BindView(R.id.wikipediaButton)
    LinearLayout wikipediaButton;

    @BindView(R.id.wikidataButton)
    LinearLayout wikidataButton;

    @BindView(R.id.directionsButton)
    LinearLayout directionsButton;

    @BindView(R.id.commonsButton)
    LinearLayout commonsButton;

    @BindView(R.id.description)
    TextView description;

    @BindView(R.id.title)
    TextView title;

    @BindView(R.id.category)
    TextView distance;

    @BindView(R.id.icon)
    ImageView icon;

    @BindView(R.id.search_this_area_button)
    Button searchThisAreaButton;

    @BindView(R.id.map_progress_bar)
    ProgressBar progressBar;

    @BindView(R.id.choice_chip_exists)
    Chip chipExists;

    @BindView(R.id.choice_chip_wlm)
    Chip chipWlm;

    @BindView(R.id.choice_chip_needs_photo)
    Chip chipNeedsPhoto;

    @BindView(R.id.choice_chip_group)
    ChipGroup choiceChipGroup;

    @BindView(R.id.search_view)
    SearchView searchView;

    @BindView(R.id.search_list_view)
    RecyclerView recyclerView;

    @BindView(R.id.nearby_filter_list)
    View nearbyFilterList;

    @BindView(R.id.checkbox_tri_states)
    CheckBoxTriStates checkBoxTriStates;

    @BindView(R.id.map)
    org.osmdroid.views.MapView mapView;

    @BindView(R.id.rv_nearby_list)
    RecyclerView rvNearbyList;

    @BindView(R.id.no_results_message)
    TextView noResultsView;

    @BindView(R.id.tv_attribution)
    AppCompatTextView tvAttribution;

    @BindView(R.id.rl_container_wlm_month_message)
    RelativeLayout rlContainerWLMMonthMessage;

    @BindView(R.id.tv_learn_more)
    AppCompatTextView tvLearnMore;

    @BindView(R.id.iv_toggle_chips)
    AppCompatImageView ivToggleChips;

    @BindView(R.id.chip_view)
    View llContainerChips;

    @BindView(R.id.btn_advanced_options)
    AppCompatButton btnAdvancedOptions;

    @BindView(R.id.fl_container_nearby_children)
    FrameLayout flConainerNearbyChildren;

    @Inject
    LocationServiceManager locationManager;

    @Inject
    NearbyController nearbyController;

    @Inject
    @Named(&quot;default_preferences&quot;)
    JsonKvStore applicationKvStore;

    @Inject
    BookmarkLocationsDao bookmarkLocationDao;

    @Inject
    ContributionController controller;

    @Inject
    WikidataEditListener wikidataEditListener;

    @Inject
    SystemThemeUtils systemThemeUtils;

    @Inject
    CommonPlaceClickActions commonPlaceClickActions;

    private NearbyFilterSearchRecyclerViewAdapter nearbyFilterSearchRecyclerViewAdapter;

    private BottomSheetBehavior bottomSheetListBehavior;

    private BottomSheetBehavior bottomSheetDetailsBehavior;

    private Animation rotate_backward;

    private Animation fab_close;

    private Animation fab_open;

    private Animation rotate_forward;

    private static final float ZOOM_LEVEL = 14f;

<span class="fc" id="L308">    private final String NETWORK_INTENT_ACTION = &quot;android.net.conn.CONNECTIVITY_CHANGE&quot;;</span>

    private BroadcastReceiver broadcastReceiver;

    private boolean isNetworkErrorOccurred;

    private Snackbar snackbar;

    private View view;

    private NearbyParentFragmentPresenter presenter;

    private boolean isDarkTheme;

    private boolean isFABsExpanded;

    private Marker selectedMarker;

    private Place selectedPlace;

    private Place clickedMarkerPlace;

    private boolean isClickedMarkerBookmarked;

<span class="fc" id="L332">    private final double CAMERA_TARGET_SHIFT_FACTOR_PORTRAIT = 0.005;</span>

<span class="fc" id="L334">    private final double CAMERA_TARGET_SHIFT_FACTOR_LANDSCAPE = 0.004;</span>

    private boolean isPermissionDenied;

    private boolean recenterToUserLocation;

    private GeoPoint mapCenter;

<span class="fc" id="L342">    IntentFilter intentFilter = new IntentFilter(NETWORK_INTENT_ACTION);</span>

    private Marker currentLocationMarker;

    private Place lastPlaceToCenter;

    private fr.free.nrw.commons.location.LatLng lastKnownLocation;

    private boolean isVisibleToUser;

    private fr.free.nrw.commons.location.LatLng lastFocusLocation;

    private LatLngBounds latLngBounds;

    private PlaceAdapter adapter;

    private GeoPoint lastMapFocus;

    private NearbyParentFragmentInstanceReadyCallback nearbyParentFragmentInstanceReadyCallback;

<span class="fc" id="L362">    private boolean isAdvancedQueryFragmentVisible = false;</span>

    private Place nearestPlace;

<span class="fc" id="L366">    private ActivityResultLauncher&lt;String[]&gt; inAppCameraLocationPermissionLauncher = registerForActivityResult(new ActivityResultContracts.RequestMultiplePermissions(), new ActivityResultCallback&lt;Map&lt;String, Boolean&gt;&gt;() {</span>

        @Override
        public void onActivityResult(Map&lt;String, Boolean&gt; result) {
<span class="nc" id="L370">            boolean areAllGranted = true;</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2673)) {</span>
                {
<span class="nc" id="L373">                    long _loopCounter38 = 0;</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">                    for (final boolean b : result.values()) {</span>
<span class="nc" id="L375">                        ListenerUtil.loopListener.listen(&quot;_loopCounter38&quot;, ++_loopCounter38);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2672)) {</span>
<span class="nc bnc" id="L377" title="All 10 branches missed.">                            areAllGranted = (ListenerUtil.mutListener.listen(2671) ? (areAllGranted || b) : (areAllGranted &amp;&amp; b));</span>
                        }
<span class="nc" id="L379">                    }</span>
                }
            }
<span class="nc bnc" id="L382" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2678)) {</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">                if (areAllGranted) {</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2677)) {</span>
<span class="nc" id="L385">                        controller.locationPermissionCallback.onLocationPermissionGranted();</span>
                    }
                } else {
<span class="nc bnc" id="L388" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2676)) {</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">                        if (shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)) {</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2675)) {</span>
<span class="nc" id="L391">                                controller.handleShowRationaleFlowCameraLocation(getActivity());</span>
                            }
                        } else {
<span class="nc bnc" id="L394" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2674)) {</span>
<span class="nc" id="L395">                                controller.locationPermissionCallback.onLocationPermissionDenied(getActivity().getString(R.string.in_app_camera_location_permission_denied));</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L401">        }</span>
    });

<span class="fc" id="L404">    private ActivityResultLauncher&lt;String&gt; locationPermissionLauncher = registerForActivityResult(new ActivityResultContracts.RequestPermission(), isGranted -&gt; {</span>
<span class="pc bpc" id="L405" title="1 of 2 branches missed.">        if (isGranted) {</span>
<span class="fc" id="L406">            locationPermissionGranted();</span>
        } else {
<span class="nc bnc" id="L408" title="All 2 branches missed.">            if (shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)) {</span>
<span class="nc" id="L409">                DialogUtil.showAlertDialog(getActivity(), getActivity().getString(R.string.location_permission_title), getActivity().getString(R.string.location_permission_rationale_nearby), getActivity().getString(android.R.string.ok), getActivity().getString(android.R.string.cancel), () -&gt; {</span>
<span class="nc bnc" id="L410" title="All 4 branches missed.">                    if (!(locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())) {</span>
<span class="nc" id="L411">                        showLocationOffDialog();</span>
                    }
<span class="nc" id="L413">                }, () -&gt; isPermissionDenied = true, null, false);</span>
            } else {
<span class="nc" id="L415">                isPermissionDenied = true;</span>
            }
        }
<span class="fc" id="L418">    });</span>

    /**
     * WLM URL
     */
    public static final String WLM_URL = &quot;https://commons.wikimedia.org/wiki/Commons:Mobile_app/Contributing_to_WLM_using_the_app&quot;;

    /**
     * Saves response of list of places for the first time
     */
<span class="fc" id="L428">    private List&lt;Place&gt; places = new ArrayList&lt;&gt;();</span>

    @NonNull
    public static NearbyParentFragment newInstance() {
<span class="fc" id="L432">        NearbyParentFragment fragment = new NearbyParentFragment();</span>
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2679)) {</span>
<span class="fc" id="L434">            fragment.setRetainInstance(true);</span>
        }
<span class="fc" id="L436">        return fragment;</span>
    }

    @Override
    public View onCreateView(@NonNull final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
<span class="pc bpc" id="L441" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2680)) {</span>
<span class="fc" id="L442">            view = inflater.inflate(R.layout.fragment_nearby_parent, container, false);</span>
        }
<span class="pc bpc" id="L444" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2681)) {</span>
<span class="fc" id="L445">            ButterKnife.bind(this, view);</span>
        }
<span class="pc bpc" id="L447" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2682)) {</span>
<span class="fc" id="L448">            initNetworkBroadCastReceiver();</span>
        }
<span class="pc bpc" id="L450" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2683)) {</span>
<span class="fc" id="L451">            presenter = new NearbyParentFragmentPresenter(bookmarkLocationDao);</span>
        }
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2684)) {</span>
<span class="fc" id="L454">            setHasOptionsMenu(true);</span>
        }
        // Inflate the layout for this fragment
<span class="fc" id="L457">        return view;</span>
    }

    @Override
    public void onCreateOptionsMenu(@NonNull final Menu menu, @NonNull final MenuInflater inflater) {
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2685)) {</span>
<span class="fc" id="L463">            inflater.inflate(R.menu.nearby_fragment_menu, menu);</span>
        }
<span class="fc" id="L465">        MenuItem listMenu = menu.findItem(R.id.list_sheet);</span>
<span class="pc bpc" id="L466" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2687)) {</span>
<span class="fc" id="L467">            listMenu.setOnMenuItemClickListener(new OnMenuItemClickListener() {</span>

                @Override
                public boolean onMenuItemClick(MenuItem item) {
<span class="pc bpc" id="L471" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2686)) {</span>
<span class="fc" id="L472">                        listOptionMenuItemClicked();</span>
                    }
<span class="fc" id="L474">                    return false;</span>
                }
            });
        }
<span class="fc" id="L478">    }</span>

    @Override
    public void onViewCreated(@NonNull final View view, @Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L482" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2688)) {</span>
<span class="fc" id="L483">            super.onViewCreated(view, savedInstanceState);</span>
        }
<span class="pc bpc" id="L485" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2689)) {</span>
<span class="fc" id="L486">            isDarkTheme = systemThemeUtils.isDeviceInNightMode();</span>
        }
<span class="pc bpc" id="L488" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2692)) {</span>
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">            if (Utils.isMonumentsEnabled(new Date())) {</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2691)) {</span>
<span class="nc" id="L491">                    rlContainerWLMMonthMessage.setVisibility(View.VISIBLE);</span>
                }
            } else {
<span class="pc bpc" id="L494" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2690)) {</span>
<span class="fc" id="L495">                    rlContainerWLMMonthMessage.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="pc bpc" id="L499" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2693)) {</span>
<span class="fc" id="L500">            presenter.attachView(this);</span>
        }
<span class="pc bpc" id="L502" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2694)) {</span>
<span class="fc" id="L503">            isPermissionDenied = false;</span>
        }
<span class="pc bpc" id="L505" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2695)) {</span>
<span class="fc" id="L506">            recenterToUserLocation = false;</span>
        }
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2696)) {</span>
<span class="fc" id="L509">            initThemePreferences();</span>
        }
<span class="pc bpc" id="L511" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2697)) {</span>
<span class="fc" id="L512">            initViews();</span>
        }
<span class="pc bpc" id="L514" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2698)) {</span>
<span class="fc" id="L515">            presenter.setActionListeners(applicationKvStore);</span>
        }
<span class="pc bpc" id="L517" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2699)) {</span>
<span class="fc" id="L518">            org.osmdroid.config.Configuration.getInstance().load(this.getContext(), PreferenceManager.getDefaultSharedPreferences(this.getContext()));</span>
        }
<span class="pc bpc" id="L520" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2700)) {</span>
            // restrictions that we do not satisfy.
<span class="fc" id="L522">            mapView.setTileSource(TileSourceFactory.WIKIMEDIA);</span>
        }
<span class="pc bpc" id="L524" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2701)) {</span>
<span class="fc" id="L525">            mapView.setTilesScaledToDpi(true);</span>
        }
<span class="pc bpc" id="L527" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2702)) {</span>
            // This was suggested by Dmitry Brant within an email thread between us and WMF.
<span class="fc" id="L529">            org.osmdroid.config.Configuration.getInstance().getAdditionalHttpRequestProperties().put(&quot;Referer&quot;, &quot;http://maps.wikimedia.org/&quot;);</span>
        }
<span class="pc bpc" id="L531" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2705)) {</span>
<span class="pc bpc" id="L532" title="1 of 2 branches missed.">            if (applicationKvStore.getString(&quot;LastLocation&quot;) != null) {</span>
                // Checking for last searched location
<span class="fc" id="L534">                String[] locationLatLng = applicationKvStore.getString(&quot;LastLocation&quot;).split(&quot;,&quot;);</span>
<span class="pc bpc" id="L535" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2704)) {</span>
<span class="fc" id="L536">                    lastMapFocus = new GeoPoint(Double.valueOf(locationLatLng[0]), Double.valueOf(locationLatLng[1]));</span>
                }
<span class="fc" id="L538">            } else {</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2703)) {</span>
<span class="nc" id="L540">                    lastMapFocus = new GeoPoint(51.50550, -0.07520);</span>
                }
            }
        }
<span class="fc" id="L544">        ScaleBarOverlay scaleBarOverlay = new ScaleBarOverlay(mapView);</span>
<span class="pc bpc" id="L545" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2706)) {</span>
<span class="fc" id="L546">            scaleBarOverlay.setScaleBarOffset(15, 25);</span>
        }
<span class="fc" id="L548">        Paint barPaint = new Paint();</span>
<span class="pc bpc" id="L549" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2707)) {</span>
<span class="fc" id="L550">            barPaint.setARGB(200, 255, 250, 250);</span>
        }
<span class="pc bpc" id="L552" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2708)) {</span>
<span class="fc" id="L553">            scaleBarOverlay.setBackgroundPaint(barPaint);</span>
        }
<span class="pc bpc" id="L555" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2709)) {</span>
<span class="fc" id="L556">            scaleBarOverlay.enableScaleBar();</span>
        }
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2710)) {</span>
<span class="fc" id="L559">            mapView.getOverlays().add(scaleBarOverlay);</span>
        }
<span class="pc bpc" id="L561" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2711)) {</span>
<span class="fc" id="L562">            mapView.getZoomController().setVisibility(CustomZoomButtonsController.Visibility.NEVER);</span>
        }
<span class="pc bpc" id="L564" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2712)) {</span>
<span class="fc" id="L565">            mapView.getController().setZoom(ZOOM_LEVEL);</span>
        }
<span class="pc bpc" id="L567" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2720)) {</span>
<span class="fc" id="L568">            mapView.getOverlays().add(new MapEventsOverlay(new MapEventsReceiver() {</span>

                @Override
                public boolean singleTapConfirmedHelper(GeoPoint p) {
<span class="nc bnc" id="L572" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2716)) {</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                        if (clickedMarkerPlace != null) {</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2714)) {</span>
<span class="nc" id="L575">                                removeMarker(clickedMarkerPlace);</span>
                            }
<span class="nc bnc" id="L577" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2715)) {</span>
<span class="nc" id="L578">                                addMarkerToMap(clickedMarkerPlace, isClickedMarkerBookmarked);</span>
                            }
                        } else {
<span class="nc bnc" id="L581" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2713)) {</span>
<span class="nc" id="L582">                                Timber.e(&quot;CLICKED MARKER IS NULL&quot;);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L586" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2719)) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                        if (isListBottomSheetExpanded()) {</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2718)) {</span>
                                // Back should first hide the bottom sheet if it is expanded
<span class="nc" id="L590">                                hideBottomSheet();</span>
                            }
<span class="nc bnc" id="L592" title="All 2 branches missed.">                        } else if (isDetailsBottomSheetVisible()) {</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2717)) {</span>
<span class="nc" id="L594">                                hideBottomDetailsSheet();</span>
                            }
                        }
                    }
<span class="nc" id="L598">                    return true;</span>
                }

                @Override
                public boolean longPressHelper(GeoPoint p) {
<span class="nc" id="L603">                    return false;</span>
                }
            }));
        }
<span class="pc bpc" id="L607" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2749)) {</span>
<span class="fc" id="L608">            mapView.addMapListener(new MapListener() {</span>

                @Override
                public boolean onScroll(ScrollEvent event) {
<span class="pc bpc" id="L612" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2748)) {</span>
<span class="pc bpc" id="L613" title="1 of 2 branches missed.">                        if (lastMapFocus != null) {</span>
<span class="fc" id="L614">                            Location mylocation = new Location(&quot;&quot;);</span>
<span class="fc" id="L615">                            Location dest_location = new Location(&quot;&quot;);</span>
<span class="pc bpc" id="L616" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2721)) {</span>
<span class="fc" id="L617">                                dest_location.setLatitude(mapView.getMapCenter().getLatitude());</span>
                            }
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2722)) {</span>
<span class="fc" id="L620">                                dest_location.setLongitude(mapView.getMapCenter().getLongitude());</span>
                            }
<span class="pc bpc" id="L622" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2723)) {</span>
<span class="fc" id="L623">                                mylocation.setLatitude(lastMapFocus.getLatitude());</span>
                            }
<span class="pc bpc" id="L625" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2724)) {</span>
<span class="fc" id="L626">                                mylocation.setLongitude(lastMapFocus.getLongitude());</span>
                            }
                            // in meters
<span class="fc" id="L629">                            Float distance = mylocation.distanceTo(dest_location);</span>
<span class="pc bpc" id="L630" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2747)) {</span>
<span class="pc bpc" id="L631" title="1 of 2 branches missed.">                                if (lastMapFocus != null) {</span>
<span class="pc bpc" id="L632" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2746)) {</span>
<span class="pc bpc" id="L633" title="171 of 186 branches missed.">                                        if ((ListenerUtil.mutListener.listen(2737) ? (isNetworkConnectionEstablished() || ((ListenerUtil.mutListener.listen(2736) ? ((ListenerUtil.mutListener.listen(2730) ? (event.getX() &gt;= 0) : (ListenerUtil.mutListener.listen(2729) ? (event.getX() &lt;= 0) : (ListenerUtil.mutListener.listen(2728) ? (event.getX() &lt; 0) : (ListenerUtil.mutListener.listen(2727) ? (event.getX() != 0) : (ListenerUtil.mutListener.listen(2726) ? (event.getX() == 0) : (event.getX() &gt; 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(2735) ? (event.getY() &gt;= 0) : (ListenerUtil.mutListener.listen(2734) ? (event.getY() &lt;= 0) : (ListenerUtil.mutListener.listen(2733) ? (event.getY() &lt; 0) : (ListenerUtil.mutListener.listen(2732) ? (event.getY() != 0) : (ListenerUtil.mutListener.listen(2731) ? (event.getY() == 0) : (event.getY() &gt; 0))))))) : ((ListenerUtil.mutListener.listen(2730) ? (event.getX() &gt;= 0) : (ListenerUtil.mutListener.listen(2729) ? (event.getX() &lt;= 0) : (ListenerUtil.mutListener.listen(2728) ? (event.getX() &lt; 0) : (ListenerUtil.mutListener.listen(2727) ? (event.getX() != 0) : (ListenerUtil.mutListener.listen(2726) ? (event.getX() == 0) : (event.getX() &gt; 0)))))) || (ListenerUtil.mutListener.listen(2735) ? (event.getY() &gt;= 0) : (ListenerUtil.mutListener.listen(2734) ? (event.getY() &lt;= 0) : (ListenerUtil.mutListener.listen(2733) ? (event.getY() &lt; 0) : (ListenerUtil.mutListener.listen(2732) ? (event.getY() != 0) : (ListenerUtil.mutListener.listen(2731) ? (event.getY() == 0) : (event.getY() &gt; 0)))))))))) : (isNetworkConnectionEstablished() &amp;&amp; ((ListenerUtil.mutListener.listen(2736) ? ((ListenerUtil.mutListener.listen(2730) ? (event.getX() &gt;= 0) : (ListenerUtil.mutListener.listen(2729) ? (event.getX() &lt;= 0) : (ListenerUtil.mutListener.listen(2728) ? (event.getX() &lt; 0) : (ListenerUtil.mutListener.listen(2727) ? (event.getX() != 0) : (ListenerUtil.mutListener.listen(2726) ? (event.getX() == 0) : (event.getX() &gt; 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(2735) ? (event.getY() &gt;= 0) : (ListenerUtil.mutListener.listen(2734) ? (event.getY() &lt;= 0) : (ListenerUtil.mutListener.listen(2733) ? (event.getY() &lt; 0) : (ListenerUtil.mutListener.listen(2732) ? (event.getY() != 0) : (ListenerUtil.mutListener.listen(2731) ? (event.getY() == 0) : (event.getY() &gt; 0))))))) : ((ListenerUtil.mutListener.listen(2730) ? (event.getX() &gt;= 0) : (ListenerUtil.mutListener.listen(2729) ? (event.getX() &lt;= 0) : (ListenerUtil.mutListener.listen(2728) ? (event.getX() &lt; 0) : (ListenerUtil.mutListener.listen(2727) ? (event.getX() != 0) : (ListenerUtil.mutListener.listen(2726) ? (event.getX() == 0) : (event.getX() &gt; 0)))))) || (ListenerUtil.mutListener.listen(2735) ? (event.getY() &gt;= 0) : (ListenerUtil.mutListener.listen(2734) ? (event.getY() &lt;= 0) : (ListenerUtil.mutListener.listen(2733) ? (event.getY() &lt; 0) : (ListenerUtil.mutListener.listen(2732) ? (event.getY() != 0) : (ListenerUtil.mutListener.listen(2731) ? (event.getY() == 0) : (event.getY() &gt; 0)))))))))))) {</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2745)) {</span>
<span class="nc bnc" id="L635" title="All 22 branches missed.">                                                if ((ListenerUtil.mutListener.listen(2742) ? (distance &gt;= 2000.0) : (ListenerUtil.mutListener.listen(2741) ? (distance &lt;= 2000.0) : (ListenerUtil.mutListener.listen(2740) ? (distance &lt; 2000.0) : (ListenerUtil.mutListener.listen(2739) ? (distance != 2000.0) : (ListenerUtil.mutListener.listen(2738) ? (distance == 2000.0) : (distance &gt; 2000.0))))))) {</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(2744)) {</span>
<span class="nc" id="L637">                                                        setSearchThisAreaButtonVisibility(true);</span>
                                                    }
                                                } else {
<span class="nc bnc" id="L640" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(2743)) {</span>
<span class="nc" id="L641">                                                        setSearchThisAreaButtonVisibility(false);</span>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                } else {
<span class="nc bnc" id="L648" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2725)) {</span>
<span class="nc" id="L649">                                        setSearchThisAreaButtonVisibility(false);</span>
                                    }
                                }
                            }
                        }
                    }
<span class="fc" id="L655">                    return true;</span>
                }

                @Override
                public boolean onZoom(ZoomEvent event) {
<span class="nc" id="L660">                    return false;</span>
                }
            });
        }
<span class="pc bpc" id="L664" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2750)) {</span>
<span class="fc" id="L665">            mapView.setMultiTouchControls(true);</span>
        }
<span class="pc bpc" id="L667" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2752)) {</span>
<span class="pc bpc" id="L668" title="1 of 2 branches missed.">            if (nearbyParentFragmentInstanceReadyCallback != null) {</span>
<span class="nc bnc" id="L669" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2751)) {</span>
<span class="nc" id="L670">                    nearbyParentFragmentInstanceReadyCallback.onReady();</span>
                }
            }
        }
<span class="pc bpc" id="L674" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2753)) {</span>
<span class="fc" id="L675">            initNearbyFilter();</span>
        }
<span class="pc bpc" id="L677" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2754)) {</span>
<span class="fc" id="L678">            addCheckBoxCallback();</span>
        }
<span class="pc bpc" id="L680" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2755)) {</span>
<span class="fc" id="L681">            performMapReadyActions();</span>
        }
<span class="pc bpc" id="L683" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2756)) {</span>
<span class="fc" id="L684">            moveCameraToPosition(lastMapFocus);</span>
        }
<span class="pc bpc" id="L686" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2757)) {</span>
<span class="fc" id="L687">            initRvNearbyList();</span>
        }
<span class="pc bpc" id="L689" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2758)) {</span>
<span class="fc" id="L690">            onResume();</span>
        }
<span class="pc bpc" id="L692" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2759)) {</span>
<span class="fc" id="L693">            tvAttribution.setText(Html.fromHtml(getString(R.string.map_attribution)));</span>
        }
<span class="pc bpc" id="L695" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2760)) {</span>
<span class="fc" id="L696">            tvAttribution.setMovementMethod(LinkMovementMethod.getInstance());</span>
        }
<span class="pc bpc" id="L698" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2761)) {</span>
<span class="fc" id="L699">            btnAdvancedOptions.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L700">                searchView.clearFocus();</span>
<span class="nc" id="L701">                showHideAdvancedQueryFragment(true);</span>
<span class="nc" id="L702">                final AdvanceQueryFragment fragment = new AdvanceQueryFragment();</span>
<span class="nc" id="L703">                final Bundle bundle = new Bundle();</span>
                try {
<span class="nc" id="L705">                    bundle.putString(&quot;query&quot;, FileUtils.readFromResource(&quot;/queries/nearby_query.rq&quot;));</span>
<span class="nc" id="L706">                } catch (IOException e) {</span>
<span class="nc" id="L707">                    Timber.e(e);</span>
<span class="nc" id="L708">                }</span>
<span class="nc" id="L709">                fragment.setArguments(bundle);</span>
<span class="nc" id="L710">                fragment.callback = new Callback() {</span>

                    @Override
                    public void close() {
<span class="nc" id="L714">                        showHideAdvancedQueryFragment(false);</span>
<span class="nc" id="L715">                    }</span>

                    @Override
                    public void reset() {
<span class="nc" id="L719">                        presenter.setAdvancedQuery(null);</span>
<span class="nc" id="L720">                        presenter.updateMapAndList(LOCATION_SIGNIFICANTLY_CHANGED);</span>
<span class="nc" id="L721">                        showHideAdvancedQueryFragment(false);</span>
<span class="nc" id="L722">                    }</span>

                    @Override
                    public void apply(@NotNull final String query) {
<span class="nc" id="L726">                        presenter.setAdvancedQuery(query);</span>
<span class="nc" id="L727">                        presenter.updateMapAndList(CUSTOM_QUERY);</span>
<span class="nc" id="L728">                        showHideAdvancedQueryFragment(false);</span>
<span class="nc" id="L729">                    }</span>
                };
<span class="nc" id="L731">                getChildFragmentManager().beginTransaction().replace(R.id.fl_container_nearby_children, fragment).commit();</span>
<span class="nc" id="L732">            });</span>
        }
<span class="fc" id="L734">    }</span>

    /**
     * Initialise background based on theme, this should be doe ideally via styles, that would need
     * another refactor
     */
    private void initThemePreferences() {
<span class="pc bpc" id="L741" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2771)) {</span>
<span class="pc bpc" id="L742" title="1 of 2 branches missed.">            if (isDarkTheme) {</span>
<span class="nc bnc" id="L743" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2766)) {</span>
<span class="nc" id="L744">                    rvNearbyList.setBackgroundColor(getContext().getResources().getColor(R.color.contributionListDarkBackground));</span>
                }
<span class="nc bnc" id="L746" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2767)) {</span>
<span class="nc" id="L747">                    checkBoxTriStates.setTextColor(getContext().getResources().getColor(android.R.color.white));</span>
                }
<span class="nc bnc" id="L749" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2768)) {</span>
<span class="nc" id="L750">                    checkBoxTriStates.setTextColor(getContext().getResources().getColor(android.R.color.white));</span>
                }
<span class="nc bnc" id="L752" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2769)) {</span>
<span class="nc" id="L753">                    nearbyFilterList.setBackgroundColor(getContext().getResources().getColor(R.color.contributionListDarkBackground));</span>
                }
<span class="nc bnc" id="L755" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2770)) {</span>
<span class="nc" id="L756">                    mapView.getOverlayManager().getTilesOverlay().setColorFilter(TilesOverlay.INVERT_COLORS);</span>
                }
            } else {
<span class="pc bpc" id="L759" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2762)) {</span>
<span class="fc" id="L760">                    rvNearbyList.setBackgroundColor(getContext().getResources().getColor(android.R.color.white));</span>
                }
<span class="pc bpc" id="L762" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2763)) {</span>
<span class="fc" id="L763">                    checkBoxTriStates.setTextColor(getContext().getResources().getColor(R.color.contributionListDarkBackground));</span>
                }
<span class="pc bpc" id="L765" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2764)) {</span>
<span class="fc" id="L766">                    nearbyFilterList.setBackgroundColor(getContext().getResources().getColor(android.R.color.white));</span>
                }
<span class="pc bpc" id="L768" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2765)) {</span>
<span class="fc" id="L769">                    nearbyFilterList.setBackgroundColor(getContext().getResources().getColor(android.R.color.white));</span>
                }
            }
        }
<span class="fc" id="L773">    }</span>

    private void initRvNearbyList() {
<span class="pc bpc" id="L776" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2772)) {</span>
<span class="fc" id="L777">            rvNearbyList.setLayoutManager(new LinearLayoutManager(getContext()));</span>
        }
<span class="pc bpc" id="L779" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2773)) {</span>
<span class="fc" id="L780">            adapter = new PlaceAdapter(bookmarkLocationDao, place -&gt; {</span>
<span class="nc" id="L781">                moveCameraToPosition(new GeoPoint(place.location.getLatitude(), place.location.getLongitude()));</span>
<span class="nc" id="L782">                return Unit.INSTANCE;</span>
            }, (place, isBookmarked) -&gt; {
<span class="nc" id="L784">                updateMarker(isBookmarked, place, null);</span>
<span class="nc" id="L785">                mapView.invalidate();</span>
<span class="nc" id="L786">                return Unit.INSTANCE;</span>
            }, commonPlaceClickActions, inAppCameraLocationPermissionLauncher);
        }
<span class="pc bpc" id="L789" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2774)) {</span>
<span class="fc" id="L790">            rvNearbyList.setAdapter(adapter);</span>
        }
<span class="fc" id="L792">    }</span>

    private void addCheckBoxCallback() {
<span class="pc bpc" id="L795" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2775)) {</span>
<span class="fc" id="L796">            checkBoxTriStates.setCallback((o, state, b, b1) -&gt; presenter.filterByMarkerType(o, state, b, b1));</span>
        }
<span class="fc" id="L798">    }</span>

    private void performMapReadyActions() {
<span class="pc bpc" id="L801" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2780)) {</span>
<span class="pc bpc" id="L802" title="1 of 2 branches missed.">            if (((MainActivity) getActivity()).activeFragment == ActiveFragment.NEARBY) {</span>
<span class="pc bpc" id="L803" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2779)) {</span>
<span class="pc bpc" id="L804" title="8 of 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(2776) ? (!applicationKvStore.getBoolean(&quot;doNotAskForLocationPermission&quot;, false) &amp;&amp; PermissionUtils.hasPermission(getActivity(), new String[] { Manifest.permission.ACCESS_FINE_LOCATION })) : (!applicationKvStore.getBoolean(&quot;doNotAskForLocationPermission&quot;, false) || PermissionUtils.hasPermission(getActivity(), new String[] { Manifest.permission.ACCESS_FINE_LOCATION })))) {</span>
<span class="pc bpc" id="L805" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2778)) {</span>
<span class="fc" id="L806">                            checkPermissionsAndPerformAction();</span>
                        }
                    } else {
<span class="nc bnc" id="L809" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2777)) {</span>
<span class="nc" id="L810">                            isPermissionDenied = true;</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L816">    }</span>

    private void locationPermissionGranted() {
<span class="pc bpc" id="L819" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2781)) {</span>
<span class="fc" id="L820">            isPermissionDenied = false;</span>
        }
<span class="pc bpc" id="L822" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2782)) {</span>
<span class="fc" id="L823">            applicationKvStore.putBoolean(&quot;doNotAskForLocationPermission&quot;, false);</span>
        }
<span class="pc bpc" id="L825" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2783)) {</span>
<span class="fc" id="L826">            lastKnownLocation = locationManager.getLastLocation();</span>
        }
<span class="fc" id="L828">        fr.free.nrw.commons.location.LatLng target = lastKnownLocation;</span>
<span class="pc bpc" id="L829" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2793)) {</span>
<span class="pc bpc" id="L830" title="1 of 2 branches missed.">            if (lastKnownLocation != null) {</span>
<span class="fc" id="L831">                GeoPoint targetP = new GeoPoint(target.getLatitude(), target.getLongitude());</span>
<span class="pc bpc" id="L832" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2789)) {</span>
<span class="fc" id="L833">                    mapCenter = targetP;</span>
                }
<span class="pc bpc" id="L835" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2790)) {</span>
<span class="fc" id="L836">                    mapView.getController().setCenter(targetP);</span>
                }
<span class="pc bpc" id="L838" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2791)) {</span>
<span class="fc" id="L839">                    recenterMarkerToPosition(targetP);</span>
                }
<span class="pc bpc" id="L841" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2792)) {</span>
<span class="fc" id="L842">                    moveCameraToPosition(targetP);</span>
                }
<span class="pc bnc" id="L844" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(2784) ? (locationManager.isGPSProviderEnabled() &amp;&amp; locationManager.isNetworkProviderEnabled()) : (locationManager.isGPSProviderEnabled() || locationManager.isNetworkProviderEnabled()))) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2786)) {</span>
<span class="nc" id="L846">                    locationManager.requestLocationUpdatesFromProvider(LocationManager.NETWORK_PROVIDER);</span>
                }
<span class="nc bnc" id="L848" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2787)) {</span>
<span class="nc" id="L849">                    locationManager.requestLocationUpdatesFromProvider(LocationManager.GPS_PROVIDER);</span>
                }
<span class="nc bnc" id="L851" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2788)) {</span>
<span class="nc" id="L852">                    setProgressBarVisibility(true);</span>
                }
            } else {
<span class="nc bnc" id="L855" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2785)) {</span>
<span class="nc" id="L856">                    Toast.makeText(getContext(), getString(R.string.nearby_location_not_available), Toast.LENGTH_LONG).show();</span>
                }
            }
        }
<span class="pc bpc" id="L860" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2794)) {</span>
<span class="fc" id="L861">            presenter.onMapReady();</span>
        }
<span class="pc bpc" id="L863" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2795)) {</span>
<span class="fc" id="L864">            registerUnregisterLocationListener(false);</span>
        }
<span class="fc" id="L866">    }</span>

    @Override
    public void onResume() {
<span class="pc bpc" id="L870" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2796)) {</span>
<span class="fc" id="L871">            super.onResume();</span>
        }
<span class="pc bpc" id="L873" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2797)) {</span>
<span class="fc" id="L874">            mapView.onResume();</span>
        }
<span class="pc bpc" id="L876" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2798)) {</span>
<span class="fc" id="L877">            presenter.attachView(this);</span>
        }
<span class="pc bpc" id="L879" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2799)) {</span>
<span class="fc" id="L880">            registerNetworkReceiver();</span>
        }
<span class="pc bpc" id="L882" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2807)) {</span>
<span class="pc bpc" id="L883" title="6 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(2800) ? (isResumed() || ((MainActivity) getActivity()).activeFragment == ActiveFragment.NEARBY) : (isResumed() &amp;&amp; ((MainActivity) getActivity()).activeFragment == ActiveFragment.NEARBY))) {</span>
<span class="pc bpc" id="L884" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2806)) {</span>
<span class="pc bpc" id="L885" title="7 of 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(2801) ? (!isPermissionDenied || !applicationKvStore.getBoolean(&quot;doNotAskForLocationPermission&quot;, false)) : (!isPermissionDenied &amp;&amp; !applicationKvStore.getBoolean(&quot;doNotAskForLocationPermission&quot;, false)))) {</span>
<span class="pc bpc" id="L886" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2805)) {</span>
<span class="pc bpc" id="L887" title="1 of 2 branches missed.">                            if (!locationManager.isGPSProviderEnabled()) {</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2804)) {</span>
<span class="nc" id="L889">                                    startMapWithCondition(&quot;Without GPS&quot;);</span>
                                }
                            } else {
<span class="pc bpc" id="L892" title="1 of 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2803)) {</span>
<span class="fc" id="L893">                                    startTheMap();</span>
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L898" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2802)) {</span>
<span class="nc" id="L899">                            startMapWithCondition(&quot;Without Permission&quot;);</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L905">    }</span>

    /**
     * Starts the map without GPS and without permission By default it points to 51.50550,-0.07520
     * coordinates, other than that it points to the last known location which can be get by the key
     * &quot;LastLocation&quot; from applicationKvStore
     *
     * @param condition : for which condition the map should start
     */
    private void startMapWithCondition(final String condition) {
<span class="nc bnc" id="L915" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2809)) {</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">            if (condition.equals(&quot;Without Permission&quot;)) {</span>
<span class="nc bnc" id="L917" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2808)) {</span>
<span class="nc" id="L918">                    applicationKvStore.putBoolean(&quot;doNotAskForLocationPermission&quot;, true);</span>
                }
            }
        }
<span class="nc bnc" id="L922" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2812)) {</span>
<span class="nc bnc" id="L923" title="All 2 branches missed.">            if (applicationKvStore.getString(&quot;LastLocation&quot;) != null) {</span>
<span class="nc" id="L924">                final String[] locationLatLng = applicationKvStore.getString(&quot;LastLocation&quot;).split(&quot;,&quot;);</span>
<span class="nc bnc" id="L925" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2811)) {</span>
<span class="nc" id="L926">                    lastKnownLocation = new fr.free.nrw.commons.location.LatLng(Double.parseDouble(locationLatLng[0]), Double.parseDouble(locationLatLng[1]), 1f);</span>
                }
<span class="nc" id="L928">            } else {</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2810)) {</span>
<span class="nc" id="L930">                    lastKnownLocation = new fr.free.nrw.commons.location.LatLng(51.50550, -0.07520, 1f);</span>
                }
            }
        }
<span class="nc bnc" id="L934" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2814)) {</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">            if (mapView != null) {</span>
<span class="nc bnc" id="L936" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2813)) {</span>
<span class="nc" id="L937">                    recenterMap(lastKnownLocation);</span>
                }
            }
        }
<span class="nc" id="L941">    }</span>

    private void registerNetworkReceiver() {
<span class="pc bpc" id="L944" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2816)) {</span>
<span class="pc bpc" id="L945" title="1 of 2 branches missed.">            if (getActivity() != null) {</span>
<span class="pc bpc" id="L946" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2815)) {</span>
<span class="fc" id="L947">                    getActivity().registerReceiver(broadcastReceiver, intentFilter);</span>
                }
            }
        }
<span class="fc" id="L951">    }</span>

    @Override
    public void onPause() {
<span class="pc bpc" id="L955" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2817)) {</span>
<span class="fc" id="L956">            super.onPause();</span>
        }
<span class="pc bpc" id="L958" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2818)) {</span>
<span class="fc" id="L959">            mapView.onPause();</span>
        }
<span class="pc bpc" id="L961" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2819)) {</span>
<span class="fc" id="L962">            compositeDisposable.clear();</span>
        }
<span class="pc bpc" id="L964" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2820)) {</span>
<span class="fc" id="L965">            presenter.detachView();</span>
        }
<span class="pc bpc" id="L967" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2821)) {</span>
<span class="fc" id="L968">            registerUnregisterLocationListener(true);</span>
        }
        try {
<span class="pc bpc" id="L971" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2825)) {</span>
<span class="pc bpc" id="L972" title="7 of 10 branches missed.">                if ((ListenerUtil.mutListener.listen(2823) ? (broadcastReceiver != null || getActivity() != null) : (broadcastReceiver != null &amp;&amp; getActivity() != null))) {</span>
<span class="pc bpc" id="L973" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2824)) {</span>
<span class="fc" id="L974">                        getContext().unregisterReceiver(broadcastReceiver);</span>
                    }
                }
            }
<span class="pc bpc" id="L978" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2829)) {</span>
<span class="pc bpc" id="L979" title="7 of 10 branches missed.">                if ((ListenerUtil.mutListener.listen(2826) ? (locationManager != null || presenter != null) : (locationManager != null &amp;&amp; presenter != null))) {</span>
<span class="pc bpc" id="L980" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2827)) {</span>
<span class="fc" id="L981">                        locationManager.removeLocationListener(presenter);</span>
                    }
<span class="pc bpc" id="L983" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2828)) {</span>
<span class="fc" id="L984">                        locationManager.unregisterLocationManager();</span>
                    }
                }
            }
<span class="nc" id="L988">        } catch (final Exception e) {</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2822)) {</span>
<span class="nc" id="L990">                Timber.e(e);</span>
            }
<span class="fc" id="L992">        }</span>
<span class="fc" id="L993">    }</span>

    @Override
    public void onDestroyView() {
<span class="pc bpc" id="L997" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2830)) {</span>
<span class="fc" id="L998">            super.onDestroyView();</span>
        }
<span class="pc bpc" id="L1000" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2831)) {</span>
<span class="fc" id="L1001">            presenter.removeNearbyPreferences(applicationKvStore);</span>
        }
<span class="fc" id="L1003">    }</span>

    private void initViews() {
<span class="pc bpc" id="L1006" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2832)) {</span>
<span class="fc" id="L1007">            Timber.d(&quot;init views called&quot;);</span>
        }
<span class="pc bpc" id="L1009" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2833)) {</span>
<span class="fc" id="L1010">            initBottomSheets();</span>
        }
<span class="pc bpc" id="L1012" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2834)) {</span>
<span class="fc" id="L1013">            loadAnimations();</span>
        }
<span class="pc bpc" id="L1015" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2835)) {</span>
<span class="fc" id="L1016">            setBottomSheetCallbacks();</span>
        }
<span class="pc bpc" id="L1018" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2836)) {</span>
<span class="fc" id="L1019">            decideButtonVisibilities();</span>
        }
<span class="pc bpc" id="L1021" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2837)) {</span>
<span class="fc" id="L1022">            addActionToTitle();</span>
        }
<span class="pc bpc" id="L1024" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2839)) {</span>
<span class="pc bpc" id="L1025" title="1 of 2 branches missed.">            if (!Utils.isMonumentsEnabled(new Date())) {</span>
<span class="pc bpc" id="L1026" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2838)) {</span>
<span class="fc" id="L1027">                    chipWlm.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="fc" id="L1031">    }</span>

    /**
     * a) Creates bottom sheet behaviours from bottom sheets, sets initial states and visibility b)
     * Gets the touch event on the map to perform following actions: if fab is open then close fab.
     * if bottom sheet details are expanded then collapse bottom sheet details. if bottom sheet
     * details are collapsed then hide the bottom sheet details. if listBottomSheet is open then
     * hide the list bottom sheet.
     */
    @SuppressLint(&quot;ClickableViewAccessibility&quot;)
    private void initBottomSheets() {
<span class="pc bpc" id="L1042" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2840)) {</span>
<span class="fc" id="L1043">            bottomSheetListBehavior = BottomSheetBehavior.from(rlBottomSheet);</span>
        }
<span class="pc bpc" id="L1045" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2841)) {</span>
<span class="fc" id="L1046">            bottomSheetDetailsBehavior = BottomSheetBehavior.from(bottomSheetDetails);</span>
        }
<span class="pc bpc" id="L1048" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2842)) {</span>
<span class="fc" id="L1049">            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
        }
<span class="pc bpc" id="L1051" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2843)) {</span>
<span class="fc" id="L1052">            bottomSheetDetails.setVisibility(View.VISIBLE);</span>
        }
<span class="pc bpc" id="L1054" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2844)) {</span>
<span class="fc" id="L1055">            bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
        }
<span class="fc" id="L1057">    }</span>

    public void initNearbyFilter() {
<span class="pc bpc" id="L1060" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2845)) {</span>
<span class="fc" id="L1061">            nearbyFilterList.setVisibility(View.GONE);</span>
        }
<span class="pc bpc" id="L1063" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2846)) {</span>
<span class="fc" id="L1064">            hideBottomSheet();</span>
        }
<span class="pc bpc" id="L1066" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2847)) {</span>
<span class="fc" id="L1067">            searchView.setOnQueryTextFocusChangeListener((v, hasFocus) -&gt; {</span>
<span class="nc" id="L1068">                LayoutUtils.setLayoutHeightAllignedToWidth(1.25, nearbyFilterList);</span>
<span class="nc bnc" id="L1069" title="All 2 branches missed.">                if (hasFocus) {</span>
<span class="nc" id="L1070">                    nearbyFilterList.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L1071">                    presenter.searchViewGainedFocus();</span>
                } else {
<span class="nc" id="L1073">                    nearbyFilterList.setVisibility(View.GONE);</span>
                }
<span class="nc" id="L1075">            });</span>
        }
<span class="pc bpc" id="L1077" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2848)) {</span>
<span class="fc" id="L1078">            recyclerView.setHasFixedSize(true);</span>
        }
<span class="pc bpc" id="L1080" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2849)) {</span>
<span class="fc" id="L1081">            recyclerView.addItemDecoration(new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL));</span>
        }
<span class="fc" id="L1083">        final LinearLayoutManager linearLayoutManager = new LinearLayoutManager(getActivity());</span>
<span class="pc bpc" id="L1084" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2850)) {</span>
<span class="fc" id="L1085">            linearLayoutManager.setOrientation(LinearLayoutManager.VERTICAL);</span>
        }
<span class="pc bpc" id="L1087" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2851)) {</span>
<span class="fc" id="L1088">            recyclerView.setLayoutManager(linearLayoutManager);</span>
        }
<span class="pc bpc" id="L1090" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2852)) {</span>
<span class="fc" id="L1091">            nearbyFilterSearchRecyclerViewAdapter = new NearbyFilterSearchRecyclerViewAdapter(getContext(), new ArrayList&lt;&gt;(Label.valuesAsList()), recyclerView);</span>
        }
<span class="pc bpc" id="L1093" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2855)) {</span>
<span class="fc" id="L1094">            nearbyFilterSearchRecyclerViewAdapter.setCallback(new NearbyFilterSearchRecyclerViewAdapter.Callback() {</span>

                @Override
                public void setCheckboxUnknown() {
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2853)) {</span>
<span class="nc" id="L1099">                        presenter.setCheckboxUnknown();</span>
                    }
<span class="nc" id="L1101">                }</span>

                @Override
                public void filterByMarkerType(final ArrayList&lt;Label&gt; selectedLabels, final int i, final boolean b, final boolean b1) {
<span class="nc bnc" id="L1105" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2854)) {</span>
<span class="nc" id="L1106">                        presenter.filterByMarkerType(selectedLabels, i, b, b1);</span>
                    }
<span class="nc" id="L1108">                }</span>

                @Override
                public boolean isDarkTheme() {
<span class="nc" id="L1112">                    return isDarkTheme;</span>
                }
            });
        }
<span class="pc bpc" id="L1116" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2856)) {</span>
<span class="fc" id="L1117">            nearbyFilterList.getLayoutParams().width = (int) LayoutUtils.getScreenWidth(getActivity(), 0.75);</span>
        }
<span class="pc bpc" id="L1119" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2857)) {</span>
<span class="fc" id="L1120">            recyclerView.setAdapter(nearbyFilterSearchRecyclerViewAdapter);</span>
        }
<span class="pc bpc" id="L1122" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2858)) {</span>
<span class="fc" id="L1123">            LayoutUtils.setLayoutHeightAllignedToWidth(1.25, nearbyFilterList);</span>
        }
<span class="pc bpc" id="L1125" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2859)) {</span>
<span class="fc" id="L1126">            compositeDisposable.add(RxSearchView.queryTextChanges(searchView).takeUntil(RxView.detaches(searchView)).debounce(500, TimeUnit.MILLISECONDS).observeOn(AndroidSchedulers.mainThread()).subscribe(query -&gt; {</span>
<span class="fc" id="L1127">                ((NearbyFilterSearchRecyclerViewAdapter) recyclerView.getAdapter()).getFilter().filter(query.toString());</span>
<span class="fc" id="L1128">            }));</span>
        }
<span class="pc bpc" id="L1130" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2860)) {</span>
<span class="fc" id="L1131">            initFilterChips();</span>
        }
<span class="fc" id="L1133">    }</span>

    @Override
    public void setCheckBoxAction() {
<span class="pc bpc" id="L1137" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2861)) {</span>
<span class="fc" id="L1138">            checkBoxTriStates.addAction();</span>
        }
<span class="pc bpc" id="L1140" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2862)) {</span>
<span class="fc" id="L1141">            checkBoxTriStates.setState(CheckBoxTriStates.UNKNOWN);</span>
        }
<span class="fc" id="L1143">    }</span>

    @Override
    public void setCheckBoxState(final int state) {
<span class="nc bnc" id="L1147" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2863)) {</span>
<span class="nc" id="L1148">            checkBoxTriStates.setState(state);</span>
        }
<span class="nc" id="L1150">    }</span>

    @Override
    public void setFilterState() {
<span class="pc bpc" id="L1154" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2864)) {</span>
<span class="fc" id="L1155">            chipNeedsPhoto.setChecked(NearbyFilterState.getInstance().isNeedPhotoSelected());</span>
        }
<span class="pc bpc" id="L1157" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2865)) {</span>
<span class="fc" id="L1158">            chipExists.setChecked(NearbyFilterState.getInstance().isExistsSelected());</span>
        }
<span class="pc bpc" id="L1160" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2866)) {</span>
<span class="fc" id="L1161">            chipWlm.setChecked(NearbyFilterState.getInstance().isWlmSelected());</span>
        }
<span class="pc bpc" id="L1163" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2868)) {</span>
<span class="pc bpc" id="L1164" title="1 of 2 branches missed.">            if (NearbyController.currentLocation != null) {</span>
<span class="pc bpc" id="L1165" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2867)) {</span>
<span class="fc" id="L1166">                    presenter.filterByMarkerType(nearbyFilterSearchRecyclerViewAdapter.selectedLabels, checkBoxTriStates.getState(), true, false);</span>
                }
            }
        }
<span class="fc" id="L1170">    }</span>

    private void initFilterChips() {
<span class="pc bpc" id="L1173" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2869)) {</span>
<span class="fc" id="L1174">            chipNeedsPhoto.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {</span>
<span class="pc bpc" id="L1175" title="1 of 2 branches missed.">                if (NearbyController.currentLocation != null) {</span>
<span class="fc" id="L1176">                    checkBoxTriStates.setState(CheckBoxTriStates.CHECKED);</span>
<span class="fc" id="L1177">                    NearbyFilterState.setNeedPhotoSelected(isChecked);</span>
<span class="fc" id="L1178">                    presenter.filterByMarkerType(nearbyFilterSearchRecyclerViewAdapter.selectedLabels, checkBoxTriStates.getState(), true, true);</span>
<span class="fc" id="L1179">                    updatePlaceList(chipNeedsPhoto.isChecked(), chipExists.isChecked(), chipWlm.isChecked());</span>
                } else {
<span class="nc bnc" id="L1181" title="All 2 branches missed.">                    chipNeedsPhoto.setChecked(!isChecked);</span>
                }
<span class="fc" id="L1183">            });</span>
        }
<span class="pc bpc" id="L1185" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2870)) {</span>
<span class="fc" id="L1186">            chipExists.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {</span>
<span class="pc bpc" id="L1187" title="1 of 2 branches missed.">                if (NearbyController.currentLocation != null) {</span>
<span class="fc" id="L1188">                    checkBoxTriStates.setState(CheckBoxTriStates.CHECKED);</span>
<span class="fc" id="L1189">                    NearbyFilterState.setExistsSelected(isChecked);</span>
<span class="fc" id="L1190">                    presenter.filterByMarkerType(nearbyFilterSearchRecyclerViewAdapter.selectedLabels, checkBoxTriStates.getState(), true, true);</span>
<span class="fc" id="L1191">                    updatePlaceList(chipNeedsPhoto.isChecked(), chipExists.isChecked(), chipWlm.isChecked());</span>
                } else {
<span class="nc bnc" id="L1193" title="All 2 branches missed.">                    chipExists.setChecked(!isChecked);</span>
                }
<span class="fc" id="L1195">            });</span>
        }
<span class="pc bpc" id="L1197" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2871)) {</span>
<span class="fc" id="L1198">            chipWlm.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {</span>
<span class="pc bpc" id="L1199" title="1 of 2 branches missed.">                if (NearbyController.currentLocation != null) {</span>
<span class="fc" id="L1200">                    checkBoxTriStates.setState(CheckBoxTriStates.CHECKED);</span>
<span class="fc" id="L1201">                    NearbyFilterState.setWlmSelected(isChecked);</span>
<span class="fc" id="L1202">                    presenter.filterByMarkerType(nearbyFilterSearchRecyclerViewAdapter.selectedLabels, checkBoxTriStates.getState(), true, true);</span>
<span class="fc" id="L1203">                    updatePlaceList(chipNeedsPhoto.isChecked(), chipExists.isChecked(), chipWlm.isChecked());</span>
                } else {
<span class="nc bnc" id="L1205" title="All 2 branches missed.">                    chipWlm.setChecked(!isChecked);</span>
                }
<span class="fc" id="L1207">            });</span>
        }
<span class="fc" id="L1209">    }</span>

    /**
     * Updates Nearby place list according to available chip states
     *
     * @param needsPhoto is chipNeedsPhoto checked
     * @param exists     is chipExists checked
     * @param isWlm      is chipWlm checked
     */
    private void updatePlaceList(final boolean needsPhoto, final boolean exists, final boolean isWlm) {
<span class="fc" id="L1219">        final List&lt;Place&gt; updatedPlaces = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L1220" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2877)) {</span>
<span class="pc bpc" id="L1221" title="1 of 2 branches missed.">            if (needsPhoto) {</span>
<span class="pc bpc" id="L1222" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2876)) {</span>
                    {
<span class="fc" id="L1224">                        long _loopCounter39 = 0;</span>
<span class="fc bfc" id="L1225" title="All 2 branches covered.">                        for (final Place place : places) {</span>
<span class="fc" id="L1226">                            ListenerUtil.loopListener.listen(&quot;_loopCounter39&quot;, ++_loopCounter39);</span>
<span class="pc bpc" id="L1227" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2875)) {</span>
<span class="pc bpc" id="L1228" title="6 of 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(2873) ? (place.pic.trim().isEmpty() || !updatedPlaces.contains(place)) : (place.pic.trim().isEmpty() &amp;&amp; !updatedPlaces.contains(place)))) {</span>
<span class="pc bpc" id="L1229" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2874)) {</span>
<span class="fc" id="L1230">                                        updatedPlaces.add(place);</span>
                                    }
                                }
                            }
<span class="fc" id="L1234">                        }</span>
<span class="fc" id="L1235">                    }</span>
                }
            } else {
<span class="nc bnc" id="L1238" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2872)) {</span>
<span class="nc" id="L1239">                    updatedPlaces.addAll(places);</span>
                }
            }
        }
<span class="pc bpc" id="L1243" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2881)) {</span>
<span class="fc bfc" id="L1244" title="All 2 branches covered.">            if (exists) {</span>
<span class="pc bpc" id="L1245" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2880)) {</span>
                    {
<span class="fc" id="L1247">                        long _loopCounter40 = 0;</span>
<span class="fc bfc" id="L1248" title="All 2 branches covered.">                        for (final Iterator&lt;Place&gt; placeIterator = updatedPlaces.iterator(); placeIterator.hasNext(); ) {</span>
<span class="fc" id="L1249">                            ListenerUtil.loopListener.listen(&quot;_loopCounter40&quot;, ++_loopCounter40);</span>
<span class="fc" id="L1250">                            final Place place = placeIterator.next();</span>
<span class="pc bpc" id="L1251" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2879)) {</span>
<span class="pc bpc" id="L1252" title="1 of 2 branches missed.">                                if (!place.exists) {</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2878)) {</span>
<span class="nc" id="L1254">                                        placeIterator.remove();</span>
                                    }
                                }
                            }
<span class="fc" id="L1258">                        }</span>
                    }
                }
            }
        }
<span class="pc bpc" id="L1263" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2890)) {</span>
<span class="fc bfc" id="L1264" title="All 2 branches covered.">            if (!isWlm) {</span>
<span class="pc bpc" id="L1265" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2889)) {</span>
                    {
<span class="fc" id="L1267">                        long _loopCounter42 = 0;</span>
<span class="fc bfc" id="L1268" title="All 2 branches covered.">                        for (final Place place : places) {</span>
<span class="fc" id="L1269">                            ListenerUtil.loopListener.listen(&quot;_loopCounter42&quot;, ++_loopCounter42);</span>
<span class="pc bpc" id="L1270" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2888)) {</span>
<span class="pc bpc" id="L1271" title="8 of 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(2886) ? (place.isMonument() || updatedPlaces.contains(place)) : (place.isMonument() &amp;&amp; updatedPlaces.contains(place)))) {</span>
<span class="nc bnc" id="L1272" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2887)) {</span>
<span class="nc" id="L1273">                                        updatedPlaces.remove(place);</span>
                                    }
                                }
                            }
<span class="fc" id="L1277">                        }</span>
<span class="fc" id="L1278">                    }</span>
                }
            } else {
<span class="pc bpc" id="L1281" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2885)) {</span>
                    {
<span class="fc" id="L1283">                        long _loopCounter41 = 0;</span>
<span class="fc bfc" id="L1284" title="All 2 branches covered.">                        for (final Place place : places) {</span>
<span class="fc" id="L1285">                            ListenerUtil.loopListener.listen(&quot;_loopCounter41&quot;, ++_loopCounter41);</span>
<span class="pc bpc" id="L1286" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2884)) {</span>
<span class="pc bpc" id="L1287" title="8 of 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(2882) ? (place.isMonument() || !updatedPlaces.contains(place)) : (place.isMonument() &amp;&amp; !updatedPlaces.contains(place)))) {</span>
<span class="nc bnc" id="L1288" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2883)) {</span>
<span class="nc" id="L1289">                                        updatedPlaces.add(place);</span>
                                    }
                                }
                            }
<span class="fc" id="L1293">                        }</span>
                    }
                }
            }
        }
<span class="pc bpc" id="L1298" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2891)) {</span>
<span class="fc" id="L1299">            adapter.setItems(updatedPlaces);</span>
        }
<span class="pc bpc" id="L1301" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2892)) {</span>
<span class="pc bpc" id="L1302" title="1 of 2 branches missed.">            noResultsView.setVisibility(updatedPlaces.isEmpty() ? View.VISIBLE : View.GONE);</span>
        }
<span class="fc" id="L1304">    }</span>

    /**
     * Defines how bottom sheets will act on click
     */
    private void setBottomSheetCallbacks() {
<span class="pc bpc" id="L1310" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2894)) {</span>
<span class="fc" id="L1311">            bottomSheetDetailsBehavior.setBottomSheetCallback(new BottomSheetBehavior.BottomSheetCallback() {</span>

                @Override
                public void onStateChanged(@NonNull final View bottomSheet, final int newState) {
<span class="nc bnc" id="L1315" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2893)) {</span>
<span class="nc" id="L1316">                        prepareViewsForSheetPosition(newState);</span>
                    }
<span class="nc" id="L1318">                }</span>

                @Override
                public void onSlide(@NonNull final View bottomSheet, final float slideOffset) {
<span class="nc" id="L1322">                }</span>
            });
        }
<span class="pc bpc" id="L1325" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2895)) {</span>
<span class="fc" id="L1326">            bottomSheetDetails.setOnClickListener(v -&gt; {</span>
<span class="nc bnc" id="L1327" title="All 2 branches missed.">                if (bottomSheetDetailsBehavior.getState() == BottomSheetBehavior.STATE_COLLAPSED) {</span>
<span class="nc" id="L1328">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_EXPANDED);</span>
<span class="nc bnc" id="L1329" title="All 2 branches missed.">                } else if (bottomSheetDetailsBehavior.getState() == BottomSheetBehavior.STATE_EXPANDED) {</span>
<span class="nc" id="L1330">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
                }
<span class="nc" id="L1332">            });</span>
        }
<span class="pc bpc" id="L1334" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2904)) {</span>
<span class="pc bpc" id="L1335" title="40 of 48 branches missed.">            rlBottomSheet.getLayoutParams().height = (ListenerUtil.mutListener.listen(2903) ? ((ListenerUtil.mutListener.listen(2899) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(2898) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(2897) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(2896) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) % 9) : (ListenerUtil.mutListener.listen(2902) ? ((ListenerUtil.mutListener.listen(2899) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(2898) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(2897) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(2896) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) / 9) : (ListenerUtil.mutListener.listen(2901) ? ((ListenerUtil.mutListener.listen(2899) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(2898) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(2897) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(2896) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) - 9) : (ListenerUtil.mutListener.listen(2900) ? ((ListenerUtil.mutListener.listen(2899) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(2898) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(2897) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(2896) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) + 9) : ((ListenerUtil.mutListener.listen(2899) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(2898) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(2897) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(2896) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) * 9)))));</span>
        }
<span class="pc bpc" id="L1337" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2905)) {</span>
<span class="fc" id="L1338">            bottomSheetListBehavior = BottomSheetBehavior.from(rlBottomSheet);</span>
        }
<span class="pc bpc" id="L1340" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2906)) {</span>
<span class="fc" id="L1341">            bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
        }
<span class="pc bpc" id="L1343" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2909)) {</span>
<span class="fc" id="L1344">            bottomSheetListBehavior.setBottomSheetCallback(new BottomSheetBehavior.BottomSheetCallback() {</span>

                @Override
                public void onStateChanged(@NonNull final View bottomSheet, final int newState) {
<span class="pc bpc" id="L1348" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2908)) {</span>
<span class="fc bfc" id="L1349" title="All 2 branches covered.">                        if (newState == BottomSheetBehavior.STATE_EXPANDED) {</span>
<span class="pc bpc" id="L1350" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2907)) {</span>
<span class="fc" id="L1351">                                bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
                            }
                        }
                    }
<span class="fc" id="L1355">                }</span>

                @Override
                public void onSlide(@NonNull final View bottomSheet, final float slideOffset) {
<span class="fc" id="L1359">                }</span>
            });
        }
<span class="fc" id="L1362">    }</span>

    /**
     * Loads animations will be used for FABs
     */
    private void loadAnimations() {
<span class="pc bpc" id="L1368" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2910)) {</span>
<span class="fc" id="L1369">            fab_open = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_open);</span>
        }
<span class="pc bpc" id="L1371" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2911)) {</span>
<span class="fc" id="L1372">            fab_close = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_close);</span>
        }
<span class="pc bpc" id="L1374" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2912)) {</span>
<span class="fc" id="L1375">            rotate_forward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_forward);</span>
        }
<span class="pc bpc" id="L1377" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2913)) {</span>
<span class="fc" id="L1378">            rotate_backward = AnimationUtils.loadAnimation(getActivity(), R.anim.rotate_backward);</span>
        }
<span class="fc" id="L1380">    }</span>

    /**
     * Fits buttons according to our layout
     */
    private void decideButtonVisibilities() {
<span class="pc bpc" id="L1386" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2924)) {</span>
            // Only need to check for directions button because it is the longest
<span class="pc bpc" id="L1388" title="42 of 50 branches missed.">            if ((ListenerUtil.mutListener.listen(2919) ? ((ListenerUtil.mutListener.listen(2918) ? (directionsButtonText.getLineCount() &gt;= 1) : (ListenerUtil.mutListener.listen(2917) ? (directionsButtonText.getLineCount() &lt;= 1) : (ListenerUtil.mutListener.listen(2916) ? (directionsButtonText.getLineCount() &lt; 1) : (ListenerUtil.mutListener.listen(2915) ? (directionsButtonText.getLineCount() != 1) : (ListenerUtil.mutListener.listen(2914) ? (directionsButtonText.getLineCount() == 1) : (directionsButtonText.getLineCount() &gt; 1)))))) &amp;&amp; directionsButtonText.getLineCount() == 0) : ((ListenerUtil.mutListener.listen(2918) ? (directionsButtonText.getLineCount() &gt;= 1) : (ListenerUtil.mutListener.listen(2917) ? (directionsButtonText.getLineCount() &lt;= 1) : (ListenerUtil.mutListener.listen(2916) ? (directionsButtonText.getLineCount() &lt; 1) : (ListenerUtil.mutListener.listen(2915) ? (directionsButtonText.getLineCount() != 1) : (ListenerUtil.mutListener.listen(2914) ? (directionsButtonText.getLineCount() == 1) : (directionsButtonText.getLineCount() &gt; 1)))))) || directionsButtonText.getLineCount() == 0))) {</span>
<span class="pc bpc" id="L1389" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2920)) {</span>
<span class="fc" id="L1390">                    wikipediaButtonText.setVisibility(View.GONE);</span>
                }
<span class="pc bpc" id="L1392" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2921)) {</span>
<span class="fc" id="L1393">                    wikidataButtonText.setVisibility(View.GONE);</span>
                }
<span class="pc bpc" id="L1395" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2922)) {</span>
<span class="fc" id="L1396">                    commonsButtonText.setVisibility(View.GONE);</span>
                }
<span class="pc bpc" id="L1398" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2923)) {</span>
<span class="fc" id="L1399">                    directionsButtonText.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="fc" id="L1403">    }</span>

    /**
     */
    private void addActionToTitle() {
<span class="pc bpc" id="L1408" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2925)) {</span>
<span class="fc" id="L1409">            title.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L1410">                Utils.copy(&quot;place&quot;, title.getText().toString(), getContext());</span>
<span class="nc" id="L1411">                Toast.makeText(getContext(), R.string.text_copy, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L1412">                return true;</span>
            });
        }
<span class="pc bpc" id="L1415" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2926)) {</span>
<span class="fc" id="L1416">            title.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L1417">                bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
<span class="nc bnc" id="L1418" title="All 2 branches missed.">                if (bottomSheetDetailsBehavior.getState() == BottomSheetBehavior.STATE_COLLAPSED) {</span>
<span class="nc" id="L1419">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_EXPANDED);</span>
                } else {
<span class="nc" id="L1421">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
                }
<span class="nc" id="L1423">            });</span>
        }
<span class="fc" id="L1425">    }</span>

    /**
     * Centers the map in nearby fragment to a given place and updates nearestPlace
     *
     * @param place is new center of the map
     */
    @Override
    public void centerMapToPlace(@Nullable final Place place) {
<span class="nc bnc" id="L1434" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2927)) {</span>
<span class="nc" id="L1435">            Timber.d(&quot;Map is centered to place&quot;);</span>
        }
        final double cameraShift;
<span class="nc bnc" id="L1438" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2930)) {</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">            if (null != place) {</span>
<span class="nc bnc" id="L1440" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2928)) {</span>
<span class="nc" id="L1441">                    lastPlaceToCenter = place;</span>
                }
<span class="nc bnc" id="L1443" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2929)) {</span>
<span class="nc" id="L1444">                    nearestPlace = place;</span>
                }
            }
        }
<span class="nc bnc" id="L1448" title="All 2 branches missed.">        if (null != lastPlaceToCenter) {</span>
<span class="nc" id="L1449">            final Configuration configuration = getActivity().getResources().getConfiguration();</span>
<span class="nc bnc" id="L1450" title="All 2 branches missed.">            if (configuration.orientation == Configuration.ORIENTATION_PORTRAIT) {</span>
<span class="nc" id="L1451">                cameraShift = CAMERA_TARGET_SHIFT_FACTOR_PORTRAIT;</span>
            } else {
<span class="nc" id="L1453">                cameraShift = CAMERA_TARGET_SHIFT_FACTOR_LANDSCAPE;</span>
            }
<span class="nc bnc" id="L1455" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2935)) {</span>
<span class="nc bnc" id="L1456" title="All 8 branches missed.">                recenterMap(new fr.free.nrw.commons.location.LatLng((ListenerUtil.mutListener.listen(2934) ? (lastPlaceToCenter.location.getLatitude() % cameraShift) : (ListenerUtil.mutListener.listen(2933) ? (lastPlaceToCenter.location.getLatitude() / cameraShift) : (ListenerUtil.mutListener.listen(2932) ? (lastPlaceToCenter.location.getLatitude() * cameraShift) : (ListenerUtil.mutListener.listen(2931) ? (lastPlaceToCenter.location.getLatitude() + cameraShift) : (lastPlaceToCenter.location.getLatitude() - cameraShift))))), lastPlaceToCenter.getLocation().getLongitude(), 0));</span>
            }
        }
<span class="nc" id="L1459">    }</span>

    @Override
    public void updateListFragment(final List&lt;Place&gt; placeList) {
<span class="pc bpc" id="L1463" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2936)) {</span>
<span class="fc" id="L1464">            places = placeList;</span>
        }
<span class="pc bpc" id="L1466" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2937)) {</span>
<span class="fc" id="L1467">            adapter.setItems(placeList);</span>
        }
<span class="pc bpc" id="L1469" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2938)) {</span>
<span class="pc bpc" id="L1470" title="1 of 2 branches missed.">            noResultsView.setVisibility(placeList.isEmpty() ? View.VISIBLE : View.GONE);</span>
        }
<span class="fc" id="L1472">    }</span>

    @Override
    public fr.free.nrw.commons.location.LatLng getLastLocation() {
<span class="nc" id="L1476">        return lastKnownLocation;</span>
    }

    @Override
    public fr.free.nrw.commons.location.LatLng getLastMapFocus() {
<span class="fc" id="L1481">        fr.free.nrw.commons.location.LatLng latLng = new fr.free.nrw.commons.location.LatLng(lastMapFocus.getLatitude(), lastMapFocus.getLongitude(), 100);</span>
<span class="fc" id="L1482">        return latLng;</span>
    }

    /**
     * Computes location where map should be centered
     *
     * @return returns the last location, if available, else returns default location
     */
    @Override
    public fr.free.nrw.commons.location.LatLng getMapCenter() {
<span class="pc bpc" id="L1492" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2941)) {</span>
<span class="pc bpc" id="L1493" title="1 of 2 branches missed.">            if (applicationKvStore.getString(&quot;LastLocation&quot;) != null) {</span>
<span class="fc" id="L1494">                final String[] locationLatLng = applicationKvStore.getString(&quot;LastLocation&quot;).split(&quot;,&quot;);</span>
<span class="pc bpc" id="L1495" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2940)) {</span>
<span class="fc" id="L1496">                    lastKnownLocation = new fr.free.nrw.commons.location.LatLng(Double.parseDouble(locationLatLng[0]), Double.parseDouble(locationLatLng[1]), 1f);</span>
                }
<span class="fc" id="L1498">            } else {</span>
<span class="nc bnc" id="L1499" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2939)) {</span>
<span class="nc" id="L1500">                    lastKnownLocation = new fr.free.nrw.commons.location.LatLng(51.50550, -0.07520, 1f);</span>
                }
            }
        }
<span class="fc" id="L1504">        fr.free.nrw.commons.location.LatLng latLnge = lastKnownLocation;</span>
<span class="pc bpc" id="L1505" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2943)) {</span>
<span class="pc bpc" id="L1506" title="1 of 2 branches missed.">            if (mapCenter != null) {</span>
<span class="pc bpc" id="L1507" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2942)) {</span>
<span class="fc" id="L1508">                    latLnge = new fr.free.nrw.commons.location.LatLng(mapCenter.getLatitude(), mapCenter.getLongitude(), 100);</span>
                }
            }
        }
<span class="fc" id="L1512">        return latLnge;</span>
    }

    @Override
    public fr.free.nrw.commons.location.LatLng getMapFocus() {
<span class="nc" id="L1517">        fr.free.nrw.commons.location.LatLng mapFocusedLatLng = new fr.free.nrw.commons.location.LatLng(mapView.getMapCenter().getLatitude(), mapView.getMapCenter().getLongitude(), 100);</span>
<span class="nc" id="L1518">        return mapFocusedLatLng;</span>
    }

    @Override
    public LatLng getLastFocusLocation() {
<span class="nc bnc" id="L1523" title="All 2 branches missed.">        return lastFocusLocation == null ? null : LocationUtils.commonsLatLngToMapBoxLatLng(lastFocusLocation);</span>
    }

    @Override
    public boolean isCurrentLocationMarkerVisible() {
<span class="pc bpc" id="L1528" title="8 of 10 branches missed.">        if ((ListenerUtil.mutListener.listen(2944) ? (latLngBounds == null &amp;&amp; currentLocationMarker == null) : (latLngBounds == null || currentLocationMarker == null))) {</span>
<span class="pc bpc" id="L1529" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2945)) {</span>
<span class="fc" id="L1530">                Timber.d(&quot;Map projection bounds are null&quot;);</span>
            }
<span class="fc" id="L1532">            return false;</span>
        } else {
<span class="nc" id="L1534">            return latLngBounds.contains(currentLocationMarker.getPosition());</span>
        }
    }

    @Override
    public boolean isAdvancedQueryFragmentVisible() {
<span class="nc" id="L1540">        return isAdvancedQueryFragmentVisible;</span>
    }

    @Override
    public void showHideAdvancedQueryFragment(final boolean shouldShow) {
<span class="nc bnc" id="L1545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2946)) {</span>
<span class="nc bnc" id="L1546" title="All 2 branches missed.">            setHasOptionsMenu(!shouldShow);</span>
        }
<span class="nc bnc" id="L1548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2947)) {</span>
<span class="nc bnc" id="L1549" title="All 2 branches missed.">            flConainerNearbyChildren.setVisibility(shouldShow ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L1551" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2948)) {</span>
<span class="nc" id="L1552">            isAdvancedQueryFragmentVisible = shouldShow;</span>
        }
<span class="nc" id="L1554">    }</span>

    @Override
    public void centerMapToPosition(fr.free.nrw.commons.location.LatLng searchLatLng) {
<span class="nc bnc" id="L1558" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2952)) {</span>
<span class="nc bnc" id="L1559" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(2950) ? (null != searchLatLng || !((ListenerUtil.mutListener.listen(2949) ? (mapView.getMapCenter().getLatitude() == searchLatLng.getLatitude() || mapView.getMapCenter().getLongitude() == searchLatLng.getLongitude()) : (mapView.getMapCenter().getLatitude() == searchLatLng.getLatitude() &amp;&amp; mapView.getMapCenter().getLongitude() == searchLatLng.getLongitude())))) : (null != searchLatLng &amp;&amp; !((ListenerUtil.mutListener.listen(2949) ? (mapView.getMapCenter().getLatitude() == searchLatLng.getLatitude() || mapView.getMapCenter().getLongitude() == searchLatLng.getLongitude()) : (mapView.getMapCenter().getLatitude() == searchLatLng.getLatitude() &amp;&amp; mapView.getMapCenter().getLongitude() == searchLatLng.getLongitude())))))) {</span>
<span class="nc bnc" id="L1560" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2951)) {</span>
<span class="nc" id="L1561">                    recenterMarkerToPosition(new GeoPoint(searchLatLng.getLatitude(), searchLatLng.getLongitude()));</span>
                }
            }
        }
<span class="nc" id="L1565">    }</span>

    @Override
    public boolean isNetworkConnectionEstablished() {
<span class="fc" id="L1569">        return NetworkUtils.isInternetConnectionEstablished(getActivity());</span>
    }

    /**
     * Adds network broadcast receiver to recognize connection established
     */
    private void initNetworkBroadCastReceiver() {
<span class="pc bpc" id="L1576" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2967)) {</span>
<span class="fc" id="L1577">            broadcastReceiver = new BroadcastReceiver() {</span>

                @Override
                public void onReceive(final Context context, final Intent intent) {
<span class="pc bpc" id="L1581" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2966)) {</span>
<span class="pc bpc" id="L1582" title="1 of 2 branches missed.">                        if (getActivity() != null) {</span>
<span class="pc bpc" id="L1583" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2965)) {</span>
<span class="pc bpc" id="L1584" title="1 of 2 branches missed.">                                if (NetworkUtils.isInternetConnectionEstablished(getActivity())) {</span>
<span class="pc bpc" id="L1585" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2961)) {</span>
<span class="pc bpc" id="L1586" title="1 of 2 branches missed.">                                        if (isNetworkErrorOccurred) {</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2959)) {</span>
<span class="nc" id="L1588">                                                presenter.updateMapAndList(LOCATION_SIGNIFICANTLY_CHANGED);</span>
                                            }
<span class="nc bnc" id="L1590" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2960)) {</span>
<span class="nc" id="L1591">                                                isNetworkErrorOccurred = false;</span>
                                            }
                                        }
                                    }
<span class="pc bpc" id="L1595" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2964)) {</span>
<span class="pc bpc" id="L1596" title="1 of 2 branches missed.">                                        if (snackbar != null) {</span>
<span class="nc bnc" id="L1597" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2962)) {</span>
<span class="nc" id="L1598">                                                snackbar.dismiss();</span>
                                            }
<span class="nc bnc" id="L1600" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2963)) {</span>
<span class="nc" id="L1601">                                                snackbar = null;</span>
                                            }
                                        }
                                    }
                                } else {
<span class="nc bnc" id="L1606" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2956)) {</span>
<span class="nc bnc" id="L1607" title="All 2 branches missed.">                                        if (snackbar == null) {</span>
<span class="nc bnc" id="L1608" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2953)) {</span>
<span class="nc" id="L1609">                                                snackbar = Snackbar.make(view, R.string.no_internet, Snackbar.LENGTH_INDEFINITE);</span>
                                            }
<span class="nc bnc" id="L1611" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2954)) {</span>
<span class="nc" id="L1612">                                                setSearchThisAreaButtonVisibility(false);</span>
                                            }
<span class="nc bnc" id="L1614" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(2955)) {</span>
<span class="nc" id="L1615">                                                setProgressBarVisibility(false);</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L1619" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2957)) {</span>
<span class="nc" id="L1620">                                        isNetworkErrorOccurred = true;</span>
                                    }
<span class="nc bnc" id="L1622" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(2958)) {</span>
<span class="nc" id="L1623">                                        snackbar.show();</span>
                                    }
                                }
                            }
                        }
                    }
<span class="fc" id="L1629">                }</span>
            };
        }
<span class="fc" id="L1632">    }</span>

    /**
     * Hide or expand bottom sheet according to states of all sheets
     */
    @Override
    public void listOptionMenuItemClicked() {
<span class="pc bpc" id="L1639" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2968)) {</span>
<span class="fc" id="L1640">            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
        }
<span class="pc bpc" id="L1642" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2972)) {</span>
<span class="pc bpc" id="L1643" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(2969) ? (bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_COLLAPSED &amp;&amp; bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_HIDDEN) : (bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_COLLAPSED || bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_HIDDEN))) {</span>
<span class="pc bpc" id="L1644" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2971)) {</span>
<span class="fc" id="L1645">                    bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_EXPANDED);</span>
                }
<span class="nc bnc" id="L1647" title="All 2 branches missed.">            } else if (bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_EXPANDED) {</span>
<span class="nc bnc" id="L1648" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2970)) {</span>
<span class="nc" id="L1649">                    bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
                }
            }
        }
<span class="fc" id="L1653">    }</span>

    @Override
    public void populatePlaces(final fr.free.nrw.commons.location.LatLng curlatLng) {
<span class="pc bpc" id="L1657" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2975)) {</span>
<span class="pc bpc" id="L1658" title="1 of 2 branches missed.">            if (curlatLng.equals(getLastMapFocus())) {</span>
<span class="nc bnc" id="L1659" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2974)) {</span>
                    // Means we are checking around current location
<span class="nc" id="L1661">                    populatePlacesForCurrentLocation(getLastMapFocus(), curlatLng, null);</span>
                }
            } else {
<span class="pc bpc" id="L1664" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2973)) {</span>
<span class="fc" id="L1665">                    populatePlacesForAnotherLocation(getLastMapFocus(), curlatLng, null);</span>
                }
            }
        }
<span class="pc bpc" id="L1669" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2977)) {</span>
<span class="pc bpc" id="L1670" title="1 of 2 branches missed.">            if (recenterToUserLocation) {</span>
<span class="nc bnc" id="L1671" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2976)) {</span>
<span class="nc" id="L1672">                    recenterToUserLocation = false;</span>
                }
            }
        }
<span class="fc" id="L1676">    }</span>

    @Override
    public void populatePlaces(final fr.free.nrw.commons.location.LatLng curlatLng, @Nullable final String customQuery) {
<span class="nc bnc" id="L1680" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2980)) {</span>
<span class="nc bnc" id="L1681" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(2978) ? (customQuery == null &amp;&amp; customQuery.isEmpty()) : (customQuery == null || customQuery.isEmpty()))) {</span>
<span class="nc bnc" id="L1682" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2979)) {</span>
<span class="nc" id="L1683">                    populatePlaces(curlatLng);</span>
                }
<span class="nc" id="L1685">                return;</span>
            }
        }
<span class="nc bnc" id="L1688" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2985)) {</span>
<span class="nc bnc" id="L1689" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(2982) ? ((ListenerUtil.mutListener.listen(2981) ? (curlatLng.equals(lastFocusLocation) &amp;&amp; lastFocusLocation == null) : (curlatLng.equals(lastFocusLocation) || lastFocusLocation == null)) &amp;&amp; recenterToUserLocation) : ((ListenerUtil.mutListener.listen(2981) ? (curlatLng.equals(lastFocusLocation) &amp;&amp; lastFocusLocation == null) : (curlatLng.equals(lastFocusLocation) || lastFocusLocation == null)) || recenterToUserLocation))) {</span>
<span class="nc bnc" id="L1690" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2984)) {</span>
                    // Means we are checking around current location
<span class="nc" id="L1692">                    populatePlacesForCurrentLocation(lastKnownLocation, curlatLng, customQuery);</span>
                }
            } else {
<span class="nc bnc" id="L1695" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2983)) {</span>
<span class="nc" id="L1696">                    populatePlacesForAnotherLocation(lastKnownLocation, curlatLng, customQuery);</span>
                }
            }
        }
<span class="nc bnc" id="L1700" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2987)) {</span>
<span class="nc bnc" id="L1701" title="All 2 branches missed.">            if (recenterToUserLocation) {</span>
<span class="nc bnc" id="L1702" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2986)) {</span>
<span class="nc" id="L1703">                    recenterToUserLocation = false;</span>
                }
            }
        }
<span class="nc" id="L1707">    }</span>

    private void populatePlacesForCurrentLocation(final fr.free.nrw.commons.location.LatLng curlatLng, final fr.free.nrw.commons.location.LatLng searchLatLng, @Nullable final String customQuery) {
<span class="nc" id="L1710">        final Observable&lt;NearbyController.NearbyPlacesInfo&gt; nearbyPlacesInfoObservable = Observable.fromCallable(() -&gt; nearbyController.loadAttractionsFromLocation(curlatLng, searchLatLng, false, true, Utils.isMonumentsEnabled(new Date()), customQuery));</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2988)) {</span>
<span class="nc" id="L1712">            compositeDisposable.add(nearbyPlacesInfoObservable.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(nearbyPlacesInfo -&gt; {</span>
<span class="nc bnc" id="L1713" title="All 4 branches missed.">                if (nearbyPlacesInfo.placeList == null || nearbyPlacesInfo.placeList.isEmpty()) {</span>
<span class="nc" id="L1714">                    showErrorMessage(getString(R.string.no_nearby_places_around));</span>
                } else {
<span class="nc" id="L1716">                    updateMapMarkers(nearbyPlacesInfo, true);</span>
<span class="nc" id="L1717">                    lastFocusLocation = searchLatLng;</span>
<span class="nc" id="L1718">                    lastMapFocus = new GeoPoint(searchLatLng.getLatitude(), searchLatLng.getLongitude());</span>
                }
<span class="nc" id="L1720">            }, throwable -&gt; {</span>
<span class="nc" id="L1721">                Timber.d(throwable);</span>
<span class="nc" id="L1722">                showErrorMessage(getString(R.string.error_fetching_nearby_places) + throwable.getLocalizedMessage());</span>
<span class="nc" id="L1723">                setProgressBarVisibility(false);</span>
<span class="nc" id="L1724">                presenter.lockUnlockNearby(false);</span>
<span class="nc" id="L1725">                setFilterState();</span>
<span class="nc" id="L1726">            }));</span>
        }
<span class="nc" id="L1728">    }</span>

    private void populatePlacesForAnotherLocation(final fr.free.nrw.commons.location.LatLng curlatLng, final fr.free.nrw.commons.location.LatLng searchLatLng, @Nullable final String customQuery) {
<span class="fc" id="L1731">        final Observable&lt;NearbyPlacesInfo&gt; nearbyPlacesInfoObservable = Observable.fromCallable(() -&gt; nearbyController.loadAttractionsFromLocation(curlatLng, searchLatLng, false, true, Utils.isMonumentsEnabled(new Date()), customQuery));</span>
<span class="pc bpc" id="L1732" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2989)) {</span>
<span class="fc" id="L1733">            compositeDisposable.add(nearbyPlacesInfoObservable.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(nearbyPlacesInfo -&gt; {</span>
<span class="pc bpc" id="L1734" title="2 of 4 branches missed.">                if (nearbyPlacesInfo.placeList == null || nearbyPlacesInfo.placeList.isEmpty()) {</span>
<span class="nc" id="L1735">                    showErrorMessage(getString(R.string.no_nearby_places_around));</span>
                } else {
                    // Updating last searched location
<span class="fc" id="L1738">                    applicationKvStore.putString(&quot;LastLocation&quot;, searchLatLng.getLatitude() + &quot;,&quot; + searchLatLng.getLongitude());</span>
<span class="fc" id="L1739">                    updateMapMarkers(nearbyPlacesInfo, false);</span>
<span class="fc" id="L1740">                    lastMapFocus = new GeoPoint(searchLatLng.getLatitude(), searchLatLng.getLongitude());</span>
                }
<span class="fc" id="L1742">            }, throwable -&gt; {</span>
<span class="nc" id="L1743">                Timber.e(throwable);</span>
<span class="nc" id="L1744">                showErrorMessage(getString(R.string.error_fetching_nearby_places) + throwable.getLocalizedMessage());</span>
<span class="nc" id="L1745">                setProgressBarVisibility(false);</span>
<span class="nc" id="L1746">                presenter.lockUnlockNearby(false);</span>
<span class="nc" id="L1747">                setFilterState();</span>
<span class="nc" id="L1748">            }));</span>
        }
<span class="fc" id="L1750">    }</span>

    /**
     * Populates places for your location, should be used for finding nearby places around a
     * location where you are.
     *
     * @param nearbyPlacesInfo This variable has place list information and distances.
     */
    private void updateMapMarkers(final NearbyController.NearbyPlacesInfo nearbyPlacesInfo, final boolean shouldUpdateSelectedMarker) {
<span class="pc bpc" id="L1759" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2990)) {</span>
<span class="fc" id="L1760">            presenter.updateMapMarkers(nearbyPlacesInfo, selectedMarker, shouldUpdateSelectedMarker);</span>
        }
<span class="pc bpc" id="L1762" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2991)) {</span>
            // TODO
<span class="fc" id="L1764">            setFilterState();</span>
        }
<span class="fc" id="L1766">    }</span>

    @Override
    public boolean isListBottomSheetExpanded() {
<span class="nc bnc" id="L1770" title="All 2 branches missed.">        return bottomSheetListBehavior.getState() == BottomSheetBehavior.STATE_EXPANDED;</span>
    }

    @Override
    public boolean isDetailsBottomSheetVisible() {
<span class="nc bnc" id="L1775" title="All 2 branches missed.">        return !(bottomSheetDetailsBehavior.getState() == BottomSheetBehavior.STATE_HIDDEN);</span>
    }

    @Override
    public void setBottomSheetDetailsSmaller() {
<span class="nc bnc" id="L1780" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2994)) {</span>
<span class="nc bnc" id="L1781" title="All 2 branches missed.">            if (bottomSheetDetailsBehavior.getState() == BottomSheetBehavior.STATE_EXPANDED) {</span>
<span class="nc bnc" id="L1782" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2993)) {</span>
<span class="nc" id="L1783">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
                }
            } else {
<span class="nc bnc" id="L1786" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2992)) {</span>
<span class="nc" id="L1787">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
                }
            }
        }
<span class="nc" id="L1791">    }</span>

    @Override
    public void addSearchThisAreaButtonAction() {
<span class="pc bpc" id="L1795" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2995)) {</span>
<span class="fc" id="L1796">            searchThisAreaButton.setOnClickListener(presenter.onSearchThisAreaClicked());</span>
        }
<span class="fc" id="L1798">    }</span>

    @Override
    public void setSearchThisAreaButtonVisibility(final boolean isVisible) {
<span class="nc bnc" id="L1802" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2998)) {</span>
<span class="nc bnc" id="L1803" title="All 2 branches missed.">            if (isVisible) {</span>
<span class="nc bnc" id="L1804" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2997)) {</span>
<span class="nc" id="L1805">                    searchThisAreaButton.setVisibility(View.VISIBLE);</span>
                }
            } else {
<span class="nc bnc" id="L1808" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2996)) {</span>
<span class="nc" id="L1809">                    searchThisAreaButton.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc" id="L1813">    }</span>

    @Override
    public void setRecyclerViewAdapterAllSelected() {
<span class="pc bpc" id="L1817" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3001)) {</span>
<span class="pc bpc" id="L1818" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(2999) ? (nearbyFilterSearchRecyclerViewAdapter != null || NearbyController.currentLocation != null) : (nearbyFilterSearchRecyclerViewAdapter != null &amp;&amp; NearbyController.currentLocation != null))) {</span>
<span class="pc bpc" id="L1819" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3000)) {</span>
<span class="fc" id="L1820">                    nearbyFilterSearchRecyclerViewAdapter.setRecyclerViewAdapterAllSelected();</span>
                }
            }
        }
<span class="fc" id="L1824">    }</span>

    @Override
    public void setRecyclerViewAdapterItemsGreyedOut() {
<span class="nc bnc" id="L1828" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3004)) {</span>
<span class="nc bnc" id="L1829" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3002) ? (nearbyFilterSearchRecyclerViewAdapter != null || NearbyController.currentLocation != null) : (nearbyFilterSearchRecyclerViewAdapter != null &amp;&amp; NearbyController.currentLocation != null))) {</span>
<span class="nc bnc" id="L1830" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3003)) {</span>
<span class="nc" id="L1831">                    nearbyFilterSearchRecyclerViewAdapter.setRecyclerViewAdapterItemsGreyedOut();</span>
                }
            }
        }
<span class="nc" id="L1835">    }</span>

    @Override
    public void setProgressBarVisibility(final boolean isVisible) {
<span class="pc bpc" id="L1839" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3007)) {</span>
<span class="fc bfc" id="L1840" title="All 2 branches covered.">            if (isVisible) {</span>
<span class="pc bpc" id="L1841" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3006)) {</span>
<span class="fc" id="L1842">                    progressBar.setVisibility(View.VISIBLE);</span>
                }
            } else {
<span class="pc bpc" id="L1845" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3005)) {</span>
<span class="fc" id="L1846">                    progressBar.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="fc" id="L1850">    }</span>

    @Override
    public void setTabItemContributions() {
<span class="nc bnc" id="L1854" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3008)) {</span>
<span class="nc" id="L1855">            ((MainActivity) getActivity()).viewPager.setCurrentItem(0);</span>
        }
<span class="nc" id="L1857">    }</span>

    @Override
    public void checkPermissionsAndPerformAction() {
<span class="pc bpc" id="L1861" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3009)) {</span>
<span class="fc" id="L1862">            Timber.d(&quot;Checking permission and perfoming action&quot;);</span>
        }
<span class="pc bpc" id="L1864" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3010)) {</span>
<span class="fc" id="L1865">            locationPermissionLauncher.launch(permission.ACCESS_FINE_LOCATION);</span>
        }
<span class="fc" id="L1867">    }</span>

    /**
     * Starts animation of fab plus (turning on opening) and other FABs
     */
    @Override
    public void animateFABs() {
<span class="nc bnc" id="L1874" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3014)) {</span>
<span class="nc bnc" id="L1875" title="All 2 branches missed.">            if (fabPlus.isShown()) {</span>
<span class="nc bnc" id="L1876" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3013)) {</span>
<span class="nc bnc" id="L1877" title="All 2 branches missed.">                    if (isFABsExpanded) {</span>
<span class="nc bnc" id="L1878" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3012)) {</span>
<span class="nc" id="L1879">                            collapseFABs(isFABsExpanded);</span>
                        }
                    } else {
<span class="nc bnc" id="L1882" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3011)) {</span>
<span class="nc" id="L1883">                            expandFABs(isFABsExpanded);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1889">    }</span>

    private void showFABs() {
<span class="nc bnc" id="L1892" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3015)) {</span>
<span class="nc" id="L1893">            NearbyFABUtils.addAnchorToBigFABs(fabPlus, bottomSheetDetails.getId());</span>
        }
<span class="nc bnc" id="L1895" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3016)) {</span>
<span class="nc" id="L1896">            fabPlus.show();</span>
        }
<span class="nc bnc" id="L1898" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3017)) {</span>
<span class="nc" id="L1899">            NearbyFABUtils.addAnchorToSmallFABs(fabGallery, getView().findViewById(R.id.empty_view).getId());</span>
        }
<span class="nc bnc" id="L1901" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3018)) {</span>
<span class="nc" id="L1902">            NearbyFABUtils.addAnchorToSmallFABs(fabCamera, getView().findViewById(R.id.empty_view1).getId());</span>
        }
<span class="nc" id="L1904">    }</span>

    /**
     * Expands camera and gallery FABs, turn forward plus FAB
     *
     * @param isFABsExpanded true if they are already expanded
     */
    private void expandFABs(final boolean isFABsExpanded) {
<span class="nc bnc" id="L1912" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3026)) {</span>
<span class="nc bnc" id="L1913" title="All 2 branches missed.">            if (!isFABsExpanded) {</span>
<span class="nc bnc" id="L1914" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3019)) {</span>
<span class="nc" id="L1915">                    showFABs();</span>
                }
<span class="nc bnc" id="L1917" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3020)) {</span>
<span class="nc" id="L1918">                    fabPlus.startAnimation(rotate_forward);</span>
                }
<span class="nc bnc" id="L1920" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3021)) {</span>
<span class="nc" id="L1921">                    fabCamera.startAnimation(fab_open);</span>
                }
<span class="nc bnc" id="L1923" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3022)) {</span>
<span class="nc" id="L1924">                    fabGallery.startAnimation(fab_open);</span>
                }
<span class="nc bnc" id="L1926" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3023)) {</span>
<span class="nc" id="L1927">                    fabCamera.show();</span>
                }
<span class="nc bnc" id="L1929" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3024)) {</span>
<span class="nc" id="L1930">                    fabGallery.show();</span>
                }
<span class="nc bnc" id="L1932" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3025)) {</span>
<span class="nc" id="L1933">                    this.isFABsExpanded = true;</span>
                }
            }
        }
<span class="nc" id="L1937">    }</span>

    /**
     * Hides all fabs
     */
    private void hideFABs() {
<span class="nc bnc" id="L1943" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3027)) {</span>
<span class="nc" id="L1944">            NearbyFABUtils.removeAnchorFromFAB(fabPlus);</span>
        }
<span class="nc bnc" id="L1946" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3028)) {</span>
<span class="nc" id="L1947">            fabPlus.hide();</span>
        }
<span class="nc bnc" id="L1949" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3029)) {</span>
<span class="nc" id="L1950">            NearbyFABUtils.removeAnchorFromFAB(fabCamera);</span>
        }
<span class="nc bnc" id="L1952" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3030)) {</span>
<span class="nc" id="L1953">            fabCamera.hide();</span>
        }
<span class="nc bnc" id="L1955" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3031)) {</span>
<span class="nc" id="L1956">            NearbyFABUtils.removeAnchorFromFAB(fabGallery);</span>
        }
<span class="nc bnc" id="L1958" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3032)) {</span>
<span class="nc" id="L1959">            fabGallery.hide();</span>
        }
<span class="nc" id="L1961">    }</span>

    /**
     * Collapses camera and gallery FABs, turn back plus FAB
     *
     * @param isFABsExpanded
     */
    private void collapseFABs(final boolean isFABsExpanded) {
<span class="nc bnc" id="L1969" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3039)) {</span>
<span class="nc bnc" id="L1970" title="All 2 branches missed.">            if (isFABsExpanded) {</span>
<span class="nc bnc" id="L1971" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3033)) {</span>
<span class="nc" id="L1972">                    fabPlus.startAnimation(rotate_backward);</span>
                }
<span class="nc bnc" id="L1974" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3034)) {</span>
<span class="nc" id="L1975">                    fabCamera.startAnimation(fab_close);</span>
                }
<span class="nc bnc" id="L1977" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3035)) {</span>
<span class="nc" id="L1978">                    fabGallery.startAnimation(fab_close);</span>
                }
<span class="nc bnc" id="L1980" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3036)) {</span>
<span class="nc" id="L1981">                    fabCamera.hide();</span>
                }
<span class="nc bnc" id="L1983" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3037)) {</span>
<span class="nc" id="L1984">                    fabGallery.hide();</span>
                }
<span class="nc bnc" id="L1986" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3038)) {</span>
<span class="nc" id="L1987">                    this.isFABsExpanded = false;</span>
                }
            }
        }
<span class="nc" id="L1991">    }</span>

    @Override
    public void displayLoginSkippedWarning() {
<span class="nc bnc" id="L1995" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3041)) {</span>
<span class="nc bnc" id="L1996" title="All 2 branches missed.">            if (applicationKvStore.getBoolean(&quot;login_skipped&quot;, false)) {</span>
<span class="nc bnc" id="L1997" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3040)) {</span>
                    // prompt the user to login
<span class="nc" id="L1999">                    new AlertDialog.Builder(getContext()).setMessage(R.string.login_alert_message).setPositiveButton(R.string.login, (dialog, which) -&gt; {</span>
                        // logout of the app
<span class="nc" id="L2001">                        BaseLogoutListener logoutListener = new BaseLogoutListener();</span>
<span class="nc" id="L2002">                        CommonsApplication app = (CommonsApplication) getActivity().getApplication();</span>
<span class="nc" id="L2003">                        app.clearApplicationData(getContext(), logoutListener);</span>
<span class="nc" id="L2004">                    }).show();</span>
                }
            }
        }
<span class="nc" id="L2008">    }</span>

    private void handleLocationUpdate(final fr.free.nrw.commons.location.LatLng latLng, final LocationServiceManager.LocationChangeType locationChangeType) {
<span class="pc bpc" id="L2011" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3042)) {</span>
<span class="fc" id="L2012">            lastKnownLocation = latLng;</span>
        }
<span class="pc bpc" id="L2014" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3043)) {</span>
<span class="fc" id="L2015">            NearbyController.currentLocation = lastKnownLocation;</span>
        }
<span class="pc bpc" id="L2017" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3044)) {</span>
<span class="fc" id="L2018">            presenter.updateMapAndList(locationChangeType);</span>
        }
<span class="fc" id="L2020">    }</span>

    @Override
    public void onLocationChangedSignificantly(final fr.free.nrw.commons.location.LatLng latLng) {
<span class="nc bnc" id="L2024" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3045)) {</span>
<span class="nc" id="L2025">            Timber.d(&quot;Location significantly changed&quot;);</span>
        }
<span class="nc bnc" id="L2027" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3047)) {</span>
<span class="nc bnc" id="L2028" title="All 2 branches missed.">            if (latLng != null) {</span>
<span class="nc bnc" id="L2029" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3046)) {</span>
<span class="nc" id="L2030">                    handleLocationUpdate(latLng, LOCATION_SIGNIFICANTLY_CHANGED);</span>
                }
            }
        }
<span class="nc" id="L2034">    }</span>

    @Override
    public void onLocationChangedSlightly(final fr.free.nrw.commons.location.LatLng latLng) {
<span class="pc bpc" id="L2038" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3048)) {</span>
<span class="fc" id="L2039">            Timber.d(&quot;Location slightly changed&quot;);</span>
        }
<span class="pc bpc" id="L2041" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3050)) {</span>
<span class="pc bpc" id="L2042" title="1 of 2 branches missed.">            if (latLng != null) {</span>
<span class="pc bpc" id="L2043" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3049)) {</span>
                    // If the map has never ever shown the current location, lets do it know
<span class="fc" id="L2045">                    handleLocationUpdate(latLng, LOCATION_SLIGHTLY_CHANGED);</span>
                }
            }
        }
<span class="fc" id="L2049">    }</span>

    @Override
    public void onLocationChangedMedium(final fr.free.nrw.commons.location.LatLng latLng) {
<span class="nc bnc" id="L2053" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3051)) {</span>
<span class="nc" id="L2054">            Timber.d(&quot;Location changed medium&quot;);</span>
        }
<span class="nc bnc" id="L2056" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3053)) {</span>
<span class="nc bnc" id="L2057" title="All 2 branches missed.">            if (latLng != null) {</span>
<span class="nc bnc" id="L2058" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3052)) {</span>
                    // If the map has never ever shown the current location, lets do it know
<span class="nc" id="L2060">                    handleLocationUpdate(latLng, LOCATION_SIGNIFICANTLY_CHANGED);</span>
                }
            }
        }
<span class="nc" id="L2064">    }</span>

    public boolean backButtonClicked() {
<span class="nc" id="L2067">        return presenter.backButtonClicked();</span>
    }

    /**
     * onLogoutComplete is called after shared preferences and data stored in local database are
     * cleared.
     */
<span class="nc" id="L2074">    private class BaseLogoutListener implements CommonsApplication.LogoutListener {</span>

        @Override
        public void onLogoutComplete() {
<span class="nc bnc" id="L2078" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3054)) {</span>
<span class="nc" id="L2079">                Timber.d(&quot;Logout complete callback received.&quot;);</span>
            }
<span class="nc" id="L2081">            final Intent nearbyIntent = new Intent(getActivity(), LoginActivity.class);</span>
<span class="nc bnc" id="L2082" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3055)) {</span>
<span class="nc" id="L2083">                nearbyIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK);</span>
            }
<span class="nc bnc" id="L2085" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3056)) {</span>
<span class="nc" id="L2086">                nearbyIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span>
            }
<span class="nc bnc" id="L2088" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3057)) {</span>
<span class="nc" id="L2089">                startActivity(nearbyIntent);</span>
            }
<span class="nc bnc" id="L2091" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3058)) {</span>
<span class="nc" id="L2092">                getActivity().finish();</span>
            }
<span class="nc" id="L2094">        }</span>
    }

    @Override
    public void setFABPlusAction(final View.OnClickListener onClickListener) {
<span class="pc bpc" id="L2099" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3059)) {</span>
<span class="fc" id="L2100">            fabPlus.setOnClickListener(onClickListener);</span>
        }
<span class="fc" id="L2102">    }</span>

    @Override
    public void setFABRecenterAction(final View.OnClickListener onClickListener) {
<span class="pc bpc" id="L2106" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3060)) {</span>
<span class="fc" id="L2107">            fabRecenter.setOnClickListener(onClickListener);</span>
        }
<span class="fc" id="L2109">    }</span>

    @Override
    public void disableFABRecenter() {
<span class="pc bpc" id="L2113" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3061)) {</span>
<span class="fc" id="L2114">            fabRecenter.setEnabled(false);</span>
        }
<span class="fc" id="L2116">    }</span>

    @Override
    public void enableFABRecenter() {
<span class="pc bpc" id="L2120" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3062)) {</span>
<span class="fc" id="L2121">            fabRecenter.setEnabled(true);</span>
        }
<span class="fc" id="L2123">    }</span>

    /**
     * Adds a marker for the user's current position. Adds a circle which uses the accuracy * 2, to
     * draw a circle which represents the user's position with an accuracy of 95%.
     * &lt;p&gt;
     * Should be called only on creation of mapboxMap, there is other method to update markers
     * location with users move.
     *
     * @param curLatLng current location
     */
    @Override
    public void addCurrentLocationMarker(final fr.free.nrw.commons.location.LatLng curLatLng) {
<span class="nc bnc" id="L2136" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3067)) {</span>
<span class="nc bnc" id="L2137" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(3064) ? ((ListenerUtil.mutListener.listen(3063) ? (null != curLatLng || !isPermissionDenied) : (null != curLatLng &amp;&amp; !isPermissionDenied)) || locationManager.isGPSProviderEnabled()) : ((ListenerUtil.mutListener.listen(3063) ? (null != curLatLng || !isPermissionDenied) : (null != curLatLng &amp;&amp; !isPermissionDenied)) &amp;&amp; locationManager.isGPSProviderEnabled()))) {</span>
<span class="nc bnc" id="L2138" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3066)) {</span>
<span class="nc" id="L2139">                    ExecutorUtils.get().submit(() -&gt; {</span>
<span class="nc" id="L2140">                        Timber.d(&quot;Adds current location marker&quot;);</span>
<span class="nc" id="L2141">                        recenterMarkerToPosition(new GeoPoint(curLatLng.getLatitude(), curLatLng.getLongitude()));</span>
<span class="nc" id="L2142">                    });</span>
                }
            } else {
<span class="nc bnc" id="L2145" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3065)) {</span>
<span class="nc" id="L2146">                    Timber.d(&quot;not adding current location marker..current location is null&quot;);</span>
                }
            }
        }
<span class="nc" id="L2150">    }</span>

    /**
     * Makes map camera follow users location with animation
     *
     * @param curLatLng current location of user
     */
    @Override
    public void updateMapToTrackPosition(final fr.free.nrw.commons.location.LatLng curLatLng) {
<span class="nc bnc" id="L2159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3068)) {</span>
<span class="nc" id="L2160">            Timber.d(&quot;Updates map camera to track user position&quot;);</span>
        }
<span class="nc bnc" id="L2162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3070)) {</span>
<span class="nc bnc" id="L2163" title="All 2 branches missed.">            if (null != mapView) {</span>
<span class="nc bnc" id="L2164" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3069)) {</span>
<span class="nc" id="L2165">                    recenterMap(curLatLng);</span>
                }
            }
        }
<span class="nc" id="L2169">    }</span>

    @Override
    public void updateMapMarkers(final List&lt;NearbyBaseMarker&gt; nearbyBaseMarkers, final Marker selectedMarker) {
<span class="pc bpc" id="L2173" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3072)) {</span>
<span class="pc bpc" id="L2174" title="1 of 2 branches missed.">            if (mapView != null) {</span>
<span class="pc bpc" id="L2175" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3071)) {</span>
<span class="fc" id="L2176">                    presenter.updateMapMarkersToController(nearbyBaseMarkers);</span>
                }
            }
        }
<span class="fc" id="L2180">    }</span>

    @Override
    public void filterOutAllMarkers() {
<span class="nc bnc" id="L2184" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3073)) {</span>
<span class="nc" id="L2185">            clearAllMarkers();</span>
        }
<span class="nc" id="L2187">    }</span>

    /**
     * Displays all markers
     */
    @Override
    public void displayAllMarkers() {
<span class="nc bnc" id="L2194" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3075)) {</span>
            {
<span class="nc" id="L2196">                long _loopCounter43 = 0;</span>
<span class="nc bnc" id="L2197" title="All 2 branches missed.">                for (final MarkerPlaceGroup markerPlaceGroup : NearbyController.markerLabelList) {</span>
<span class="nc" id="L2198">                    ListenerUtil.loopListener.listen(&quot;_loopCounter43&quot;, ++_loopCounter43);</span>
<span class="nc bnc" id="L2199" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3074)) {</span>
<span class="nc" id="L2200">                        updateMarker(markerPlaceGroup.getIsBookmarked(), markerPlaceGroup.getPlace(), NearbyController.currentLocation);</span>
                    }
<span class="nc" id="L2202">                }</span>
            }
        }
<span class="nc" id="L2205">    }</span>

    /**
     * Filters markers based on selectedLabels and chips
     *
     * @param selectedLabels       label list that user clicked
     * @param displayExists        chip for displaying only existing places
     * @param displayNeedsPhoto    chip for displaying only places need photos
     * @param filterForPlaceState  true if we filter places for place state
     * @param filterForAllNoneType true if we filter places with all none button
     */
    @Override
    public void filterMarkersByLabels(final List&lt;Label&gt; selectedLabels, final boolean displayExists, final boolean displayNeedsPhoto, final boolean displayWlm, final boolean filterForPlaceState, final boolean filterForAllNoneType) {
<span class="pc bpc" id="L2218" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3076)) {</span>
            // Remove the previous markers before updating them
<span class="fc" id="L2220">            clearAllMarkers();</span>
        }
<span class="pc bpc" id="L2222" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3102)) {</span>
            {
<span class="fc" id="L2224">                long _loopCounter44 = 0;</span>
<span class="fc bfc" id="L2225" title="All 2 branches covered.">                for (final MarkerPlaceGroup markerPlaceGroup : NearbyController.markerLabelList) {</span>
<span class="fc" id="L2226">                    ListenerUtil.loopListener.listen(&quot;_loopCounter44&quot;, ++_loopCounter44);</span>
<span class="fc" id="L2227">                    final Place place = markerPlaceGroup.getPlace();</span>
<span class="pc bpc" id="L2228" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3082)) {</span>
                        // then compare it against place's label
<span class="pc bpc" id="L2230" title="98 of 106 branches missed.">                        if ((ListenerUtil.mutListener.listen(3081) ? ((ListenerUtil.mutListener.listen(3078) ? (selectedLabels != null || ((ListenerUtil.mutListener.listen(3077) ? (selectedLabels.size() != 0 &amp;&amp; !filterForPlaceState) : (selectedLabels.size() != 0 || !filterForPlaceState)))) : (selectedLabels != null &amp;&amp; ((ListenerUtil.mutListener.listen(3077) ? (selectedLabels.size() != 0 &amp;&amp; !filterForPlaceState) : (selectedLabels.size() != 0 || !filterForPlaceState))))) || ((ListenerUtil.mutListener.listen(3080) ? (!selectedLabels.contains(place.getLabel()) || !((ListenerUtil.mutListener.listen(3079) ? (selectedLabels.contains(Label.BOOKMARKS) || markerPlaceGroup.getIsBookmarked()) : (selectedLabels.contains(Label.BOOKMARKS) &amp;&amp; markerPlaceGroup.getIsBookmarked())))) : (!selectedLabels.contains(place.getLabel()) &amp;&amp; !((ListenerUtil.mutListener.listen(3079) ? (selectedLabels.contains(Label.BOOKMARKS) || markerPlaceGroup.getIsBookmarked()) : (selectedLabels.contains(Label.BOOKMARKS) &amp;&amp; markerPlaceGroup.getIsBookmarked()))))))) : ((ListenerUtil.mutListener.listen(3078) ? (selectedLabels != null || ((ListenerUtil.mutListener.listen(3077) ? (selectedLabels.size() != 0 &amp;&amp; !filterForPlaceState) : (selectedLabels.size() != 0 || !filterForPlaceState)))) : (selectedLabels != null &amp;&amp; ((ListenerUtil.mutListener.listen(3077) ? (selectedLabels.size() != 0 &amp;&amp; !filterForPlaceState) : (selectedLabels.size() != 0 || !filterForPlaceState))))) &amp;&amp; ((ListenerUtil.mutListener.listen(3080) ? (!selectedLabels.contains(place.getLabel()) || !((ListenerUtil.mutListener.listen(3079) ? (selectedLabels.contains(Label.BOOKMARKS) || markerPlaceGroup.getIsBookmarked()) : (selectedLabels.contains(Label.BOOKMARKS) &amp;&amp; markerPlaceGroup.getIsBookmarked())))) : (!selectedLabels.contains(place.getLabel()) &amp;&amp; !((ListenerUtil.mutListener.listen(3079) ? (selectedLabels.contains(Label.BOOKMARKS) || markerPlaceGroup.getIsBookmarked()) : (selectedLabels.contains(Label.BOOKMARKS) &amp;&amp; markerPlaceGroup.getIsBookmarked()))))))))) {</span>
<span class="nc" id="L2231">                            continue;</span>
                        }
                    }
<span class="pc bpc" id="L2234" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3084)) {</span>
<span class="pc bpc" id="L2235" title="8 of 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(3083) ? (!displayWlm || place.isMonument()) : (!displayWlm &amp;&amp; place.isMonument()))) {</span>
<span class="nc" id="L2236">                            continue;</span>
                        }
                    }
<span class="fc" id="L2239">                    boolean shouldUpdateMarker = false;</span>
<span class="pc bpc" id="L2240" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3099)) {</span>
<span class="pc bpc" id="L2241" title="7 of 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(3085) ? (displayWlm || place.isMonument()) : (displayWlm &amp;&amp; place.isMonument()))) {</span>
<span class="nc bnc" id="L2242" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3098)) {</span>
<span class="nc" id="L2243">                                shouldUpdateMarker = true;</span>
                            }
<span class="pc bpc" id="L2245" title="7 of 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(3086) ? (displayExists || displayNeedsPhoto) : (displayExists &amp;&amp; displayNeedsPhoto))) {</span>
<span class="pc bpc" id="L2246" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3097)) {</span>
                                // Exists and needs photo
<span class="pc bpc" id="L2248" title="6 of 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(3095) ? (place.exists || place.pic.trim().isEmpty()) : (place.exists &amp;&amp; place.pic.trim().isEmpty()))) {</span>
<span class="pc bpc" id="L2249" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3096)) {</span>
<span class="fc" id="L2250">                                        shouldUpdateMarker = true;</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L2254" title="All 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(3087) ? (displayExists || !displayNeedsPhoto) : (displayExists &amp;&amp; !displayNeedsPhoto))) {</span>
<span class="nc bnc" id="L2255" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3094)) {</span>
                                // Exists and all included needs and doesn't needs photo
<span class="nc bnc" id="L2257" title="All 2 branches missed.">                                if (place.exists) {</span>
<span class="nc bnc" id="L2258" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3093)) {</span>
<span class="nc" id="L2259">                                        shouldUpdateMarker = true;</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L2263" title="All 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(3088) ? (!displayExists || displayNeedsPhoto) : (!displayExists &amp;&amp; displayNeedsPhoto))) {</span>
<span class="nc bnc" id="L2264" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3092)) {</span>
                                // All and only needs photo
<span class="nc bnc" id="L2266" title="All 2 branches missed.">                                if (place.pic.trim().isEmpty()) {</span>
<span class="nc bnc" id="L2267" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3091)) {</span>
<span class="nc" id="L2268">                                        shouldUpdateMarker = true;</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L2272" title="All 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(3089) ? (!displayExists || !displayNeedsPhoto) : (!displayExists &amp;&amp; !displayNeedsPhoto))) {</span>
<span class="nc bnc" id="L2273" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3090)) {</span>
                                // all
<span class="nc" id="L2275">                                shouldUpdateMarker = true;</span>
                            }
                        }
                    }
<span class="pc bpc" id="L2279" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3101)) {</span>
<span class="fc bfc" id="L2280" title="All 2 branches covered.">                        if (shouldUpdateMarker) {</span>
<span class="pc bpc" id="L2281" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3100)) {</span>
<span class="fc" id="L2282">                                updateMarker(markerPlaceGroup.getIsBookmarked(), place, NearbyController.currentLocation);</span>
                            }
                        }
                    }
<span class="fc" id="L2286">                }</span>
            }
        }
<span class="pc bpc" id="L2289" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3108)) {</span>
<span class="pc bpc" id="L2290" title="6 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3103) ? (selectedLabels == null &amp;&amp; selectedLabels.size() == 0) : (selectedLabels == null || selectedLabels.size() == 0))) {</span>
<span class="fc" id="L2291">                ArrayList&lt;NearbyBaseMarker&gt; markerArrayList = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L2292" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3106)) {</span>
                    {
<span class="fc" id="L2294">                        long _loopCounter45 = 0;</span>
<span class="fc bfc" id="L2295" title="All 2 branches covered.">                        for (final MarkerPlaceGroup markerPlaceGroup : NearbyController.markerLabelList) {</span>
<span class="fc" id="L2296">                            ListenerUtil.loopListener.listen(&quot;_loopCounter45&quot;, ++_loopCounter45);</span>
<span class="fc" id="L2297">                            NearbyBaseMarker nearbyBaseMarker = new NearbyBaseMarker();</span>
<span class="pc bpc" id="L2298" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3104)) {</span>
<span class="fc" id="L2299">                                nearbyBaseMarker.place(markerPlaceGroup.getPlace());</span>
                            }
<span class="pc bpc" id="L2301" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3105)) {</span>
<span class="fc" id="L2302">                                markerArrayList.add(nearbyBaseMarker);</span>
                            }
<span class="fc" id="L2304">                        }</span>
                    }
                }
<span class="pc bpc" id="L2307" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3107)) {</span>
<span class="fc" id="L2308">                    addMarkersToMap(markerArrayList, null);</span>
                }
            }
        }
<span class="fc" id="L2312">    }</span>

    @Override
    public fr.free.nrw.commons.location.LatLng getCameraTarget() {
<span class="nc bnc" id="L2316" title="All 2 branches missed.">        return mapView == null ? null : getMapFocus();</span>
    }

    /**
     * Sets marker icon according to marker status. Sets title and distance.
     *
     * @param isBookmarked true if place is bookmarked
     * @param place
     * @param curLatLng    current location
     */
    public void updateMarker(final boolean isBookmarked, final Place place, @Nullable final fr.free.nrw.commons.location.LatLng curLatLng) {
<span class="pc bpc" id="L2327" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3109)) {</span>
<span class="fc" id="L2328">            addMarkerToMap(place, isBookmarked);</span>
        }
<span class="fc" id="L2330">    }</span>

    /**
     * Highlights nearest place when user clicks on home nearby banner
     *
     * @param nearestPlace nearest place, which has to be highlighted
     */
    private void highlightNearestPlace(Place nearestPlace) {
<span class="nc bnc" id="L2338" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3110)) {</span>
<span class="nc" id="L2339">            passInfoToSheet(nearestPlace);</span>
        }
<span class="nc bnc" id="L2341" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3111)) {</span>
<span class="nc" id="L2342">            hideBottomSheet();</span>
        }
<span class="nc bnc" id="L2344" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3112)) {</span>
<span class="nc" id="L2345">            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
        }
<span class="nc" id="L2347">    }</span>

    /**
     * Returns drawable of marker icon for given place
     *
     * @param place where marker is to be added
     * @param isBookmarked true if place is bookmarked
     * @return returns the drawable of marker according to the place information
     */
    @DrawableRes
    private int getIconFor(Place place, Boolean isBookmarked) {
<span class="pc bpc" id="L2358" title="1 of 2 branches missed.">        if (nearestPlace != null) {</span>
<span class="nc bnc" id="L2359" title="All 2 branches missed.">            if (place.name.equals(nearestPlace.name)) {</span>
<span class="nc bnc" id="L2360" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3113)) {</span>
                    // Highlight nearest place only when user clicks on the home nearby banner
<span class="nc" id="L2362">                    highlightNearestPlace(place);</span>
                }
<span class="nc bnc" id="L2364" title="All 2 branches missed.">                return (isBookmarked ? R.drawable.ic_custom_map_marker_purple_bookmarked : R.drawable.ic_custom_map_marker_purple);</span>
            }
        }
<span class="pc bpc" id="L2367" title="1 of 2 branches missed.">        if (place.isMonument()) {</span>
<span class="nc" id="L2368">            return R.drawable.ic_custom_map_marker_monuments;</span>
<span class="fc bfc" id="L2369" title="All 2 branches covered.">        } else if (!place.pic.trim().isEmpty()) {</span>
<span class="pc bpc" id="L2370" title="1 of 2 branches missed.">            return (isBookmarked ? R.drawable.ic_custom_map_marker_green_bookmarked : R.drawable.ic_custom_map_marker_green);</span>
<span class="pc bpc" id="L2371" title="1 of 2 branches missed.">        } else if (!place.exists) {</span>
            // Means that the topic of the Wikidata item does not exist in the real world anymore, for instance it is a past event, or a place that was destroyed
<span class="nc bnc" id="L2373" title="All 2 branches missed.">            return (isBookmarked ? R.drawable.ic_custom_map_marker_grey_bookmarked : R.drawable.ic_custom_map_marker_grey);</span>
        } else {
<span class="pc bpc" id="L2375" title="1 of 2 branches missed.">            return (isBookmarked ? R.drawable.ic_custom_map_marker_blue_bookmarked : R.drawable.ic_custom_map_marker);</span>
        }
    }

    /**
     * Adds a marker representing a place to the map with optional bookmark icon.
     *
     * @param place        The Place object containing information about the location.
     * @param isBookMarked A Boolean flag indicating whether the place is bookmarked or not.
     */
    private void addMarkerToMap(Place place, Boolean isBookMarked) {
<span class="fc" id="L2386">        ArrayList&lt;OverlayItem&gt; items = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L2387">        Drawable icon = ContextCompat.getDrawable(getContext(), getIconFor(place, isBookMarked));</span>
<span class="fc" id="L2388">        GeoPoint point = new GeoPoint(place.location.getLatitude(), place.location.getLongitude());</span>
<span class="fc" id="L2389">        OverlayItem item = new OverlayItem(place.name, null, point);</span>
<span class="pc bpc" id="L2390" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3114)) {</span>
<span class="fc" id="L2391">            item.setMarker(icon);</span>
        }
<span class="pc bpc" id="L2393" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3115)) {</span>
<span class="fc" id="L2394">            items.add(item);</span>
        }
<span class="fc" id="L2396">        ItemizedOverlayWithFocus overlay = new ItemizedOverlayWithFocus(items, new OnItemGestureListener&lt;OverlayItem&gt;() {</span>

            @Override
            public boolean onItemSingleTapUp(int index, OverlayItem item) {
<span class="nc bnc" id="L2400" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3116)) {</span>
<span class="nc" id="L2401">                    passInfoToSheet(place);</span>
                }
<span class="nc bnc" id="L2403" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3117)) {</span>
<span class="nc" id="L2404">                    hideBottomSheet();</span>
                }
<span class="nc bnc" id="L2406" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3120)) {</span>
<span class="nc bnc" id="L2407" title="All 2 branches missed.">                    if (clickedMarkerPlace != null) {</span>
<span class="nc bnc" id="L2408" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3118)) {</span>
<span class="nc" id="L2409">                            removeMarker(clickedMarkerPlace);</span>
                        }
<span class="nc bnc" id="L2411" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3119)) {</span>
<span class="nc" id="L2412">                            addMarkerToMap(clickedMarkerPlace, isClickedMarkerBookmarked);</span>
                        }
                    }
                }
<span class="nc bnc" id="L2416" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3121)) {</span>
<span class="nc" id="L2417">                    clickedMarkerPlace = place;</span>
                }
<span class="nc bnc" id="L2419" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3122)) {</span>
<span class="nc" id="L2420">                    isClickedMarkerBookmarked = isBookMarked;</span>
                }
<span class="nc bnc" id="L2422" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3123)) {</span>
<span class="nc" id="L2423">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
                }
<span class="nc" id="L2425">                return true;</span>
            }

            @Override
            public boolean onItemLongPress(int index, OverlayItem item) {
<span class="nc" id="L2430">                return false;</span>
            }
<span class="fc" id="L2432">        }, getContext());</span>
<span class="pc bpc" id="L2433" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3124)) {</span>
<span class="fc" id="L2434">            overlay.setFocusItemsOnTap(true);</span>
        }
<span class="pc bpc" id="L2436" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3125)) {</span>
            // Add the overlay to the map
<span class="fc" id="L2438">            mapView.getOverlays().add(overlay);</span>
        }
<span class="fc" id="L2440">    }</span>

    /**
     * Adds multiple markers representing places to the map and handles item gestures.
     *
     * @param nearbyBaseMarkers The list of Place objects containing information about the
     *                          locations.
     */
    private void addMarkersToMap(List&lt;NearbyBaseMarker&gt; nearbyBaseMarkers, final Marker selectedMarker) {
<span class="fc" id="L2449">        ArrayList&lt;OverlayItem&gt; items = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L2450" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3133)) {</span>
            {
<span class="fc" id="L2452">                long _loopCounter46 = 0;</span>
<span class="pc bpc" id="L2453" title="15 of 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(3132) ? (i &gt;= nearbyBaseMarkers.size()) : (ListenerUtil.mutListener.listen(3131) ? (i &lt;= nearbyBaseMarkers.size()) : (ListenerUtil.mutListener.listen(3130) ? (i &gt; nearbyBaseMarkers.size()) : (ListenerUtil.mutListener.listen(3129) ? (i != nearbyBaseMarkers.size()) : (ListenerUtil.mutListener.listen(3128) ? (i == nearbyBaseMarkers.size()) : (i &lt; nearbyBaseMarkers.size())))))); i++) {</span>
<span class="fc" id="L2454">                    ListenerUtil.loopListener.listen(&quot;_loopCounter46&quot;, ++_loopCounter46);</span>
<span class="fc" id="L2455">                    Drawable icon = ContextCompat.getDrawable(getContext(), getIconFor(nearbyBaseMarkers.get(i).getPlace(), false));</span>
<span class="fc" id="L2456">                    GeoPoint point = new GeoPoint(nearbyBaseMarkers.get(i).getPlace().location.getLatitude(), nearbyBaseMarkers.get(i).getPlace().location.getLongitude());</span>
<span class="fc" id="L2457">                    OverlayItem item = new OverlayItem(nearbyBaseMarkers.get(i).getPlace().name, null, point);</span>
<span class="pc bpc" id="L2458" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3126)) {</span>
<span class="fc" id="L2459">                        item.setMarker(icon);</span>
                    }
<span class="pc bpc" id="L2461" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3127)) {</span>
<span class="fc" id="L2462">                        items.add(item);</span>
                    }
                }
            }
        }
<span class="fc" id="L2467">        ItemizedOverlayWithFocus overlay = new ItemizedOverlayWithFocus(items, new OnItemGestureListener&lt;OverlayItem&gt;() {</span>

            @Override
            public boolean onItemSingleTapUp(int index, OverlayItem item) {
<span class="nc" id="L2471">                final Place place = nearbyBaseMarkers.get(index).getPlace();</span>
<span class="nc bnc" id="L2472" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3134)) {</span>
<span class="nc" id="L2473">                    passInfoToSheet(place);</span>
                }
<span class="nc bnc" id="L2475" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3135)) {</span>
<span class="nc" id="L2476">                    hideBottomSheet();</span>
                }
<span class="nc bnc" id="L2478" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3138)) {</span>
<span class="nc bnc" id="L2479" title="All 2 branches missed.">                    if (clickedMarkerPlace != null) {</span>
<span class="nc bnc" id="L2480" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3136)) {</span>
<span class="nc" id="L2481">                            removeMarker(clickedMarkerPlace);</span>
                        }
<span class="nc bnc" id="L2483" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3137)) {</span>
<span class="nc" id="L2484">                            addMarkerToMap(clickedMarkerPlace, isClickedMarkerBookmarked);</span>
                        }
                    }
                }
<span class="nc bnc" id="L2488" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3139)) {</span>
<span class="nc" id="L2489">                    clickedMarkerPlace = place;</span>
                }
<span class="nc bnc" id="L2491" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3140)) {</span>
<span class="nc" id="L2492">                    isClickedMarkerBookmarked = false;</span>
                }
<span class="nc bnc" id="L2494" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3141)) {</span>
<span class="nc" id="L2495">                    bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
                }
<span class="nc" id="L2497">                return true;</span>
            }

            @Override
            public boolean onItemLongPress(int index, OverlayItem item) {
<span class="nc" id="L2502">                return false;</span>
            }
<span class="fc" id="L2504">        }, getContext());</span>
<span class="pc bpc" id="L2505" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3142)) {</span>
<span class="fc" id="L2506">            overlay.setFocusItemsOnTap(true);</span>
        }
<span class="pc bpc" id="L2508" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3143)) {</span>
<span class="fc" id="L2509">            mapView.getOverlays().add(overlay);</span>
        }
<span class="fc" id="L2511">    }</span>

    private void removeMarker(Place place) {
<span class="nc" id="L2514">        List&lt;Overlay&gt; overlays = mapView.getOverlays();</span>
<span class="nc bnc" id="L2515" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3154)) {</span>
            {
<span class="nc" id="L2517">                long _loopCounter47 = 0;</span>
<span class="nc bnc" id="L2518" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(3153) ? (i &gt;= overlays.size()) : (ListenerUtil.mutListener.listen(3152) ? (i &lt;= overlays.size()) : (ListenerUtil.mutListener.listen(3151) ? (i &gt; overlays.size()) : (ListenerUtil.mutListener.listen(3150) ? (i != overlays.size()) : (ListenerUtil.mutListener.listen(3149) ? (i == overlays.size()) : (i &lt; overlays.size())))))); i++) {</span>
<span class="nc" id="L2519">                    ListenerUtil.loopListener.listen(&quot;_loopCounter47&quot;, ++_loopCounter47);</span>
<span class="nc bnc" id="L2520" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3148)) {</span>
<span class="nc bnc" id="L2521" title="All 2 branches missed.">                        if (overlays.get(i) instanceof ItemizedOverlayWithFocus) {</span>
<span class="nc" id="L2522">                            ItemizedOverlayWithFocus item = (ItemizedOverlayWithFocus) overlays.get(i);</span>
<span class="nc" id="L2523">                            OverlayItem overlayItem = item.getItem(0);</span>
<span class="nc" id="L2524">                            fr.free.nrw.commons.location.LatLng diffLatLang = new fr.free.nrw.commons.location.LatLng(overlayItem.getPoint().getLatitude(), overlayItem.getPoint().getLongitude(), 100);</span>
<span class="nc bnc" id="L2525" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3147)) {</span>
<span class="nc bnc" id="L2526" title="All 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(3144) ? (place.location.getLatitude() == overlayItem.getPoint().getLatitude() || place.location.getLongitude() == overlayItem.getPoint().getLongitude()) : (place.location.getLatitude() == overlayItem.getPoint().getLatitude() &amp;&amp; place.location.getLongitude() == overlayItem.getPoint().getLongitude()))) {</span>
<span class="nc bnc" id="L2527" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3145)) {</span>
<span class="nc" id="L2528">                                        mapView.getOverlays().remove(i);</span>
                                    }
<span class="nc bnc" id="L2530" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3146)) {</span>
<span class="nc" id="L2531">                                        mapView.invalidate();</span>
                                    }
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L2541">    }</span>

    @Override
    public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {
<span class="nc bnc" id="L2545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3162)) {</span>
<span class="nc bnc" id="L2546" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3155) ? (isPermissionDenied &amp;&amp; curLatLng == null) : (isPermissionDenied || curLatLng == null))) {</span>
<span class="nc bnc" id="L2547" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3156)) {</span>
<span class="nc" id="L2548">                    recenterToUserLocation = true;</span>
                }
<span class="nc bnc" id="L2550" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3157)) {</span>
<span class="nc" id="L2551">                    checkPermissionsAndPerformAction();</span>
                }
<span class="nc bnc" id="L2553" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3161)) {</span>
<span class="nc bnc" id="L2554" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(3159) ? (!isPermissionDenied || !((ListenerUtil.mutListener.listen(3158) ? (locationManager.isNetworkProviderEnabled() &amp;&amp; locationManager.isGPSProviderEnabled()) : (locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())))) : (!isPermissionDenied &amp;&amp; !((ListenerUtil.mutListener.listen(3158) ? (locationManager.isNetworkProviderEnabled() &amp;&amp; locationManager.isGPSProviderEnabled()) : (locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())))))) {</span>
<span class="nc bnc" id="L2555" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3160)) {</span>
<span class="nc" id="L2556">                            showLocationOffDialog();</span>
                        }
                    }
                }
<span class="nc" id="L2560">                return;</span>
            }
        }
<span class="nc bnc" id="L2563" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3163)) {</span>
<span class="nc" id="L2564">            addCurrentLocationMarker(curLatLng);</span>
        }
<span class="nc bnc" id="L2566" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3164)) {</span>
<span class="nc" id="L2567">            mapView.getController().animateTo(new GeoPoint(curLatLng.getLatitude(), curLatLng.getLongitude()));</span>
        }
<span class="nc bnc" id="L2569" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3180)) {</span>
<span class="nc bnc" id="L2570" title="All 2 branches missed.">            if (lastMapFocus != null) {</span>
<span class="nc" id="L2571">                Location mylocation = new Location(&quot;&quot;);</span>
<span class="nc" id="L2572">                Location dest_location = new Location(&quot;&quot;);</span>
<span class="nc bnc" id="L2573" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3165)) {</span>
<span class="nc" id="L2574">                    dest_location.setLatitude(mapView.getMapCenter().getLatitude());</span>
                }
<span class="nc bnc" id="L2576" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3166)) {</span>
<span class="nc" id="L2577">                    dest_location.setLongitude(mapView.getMapCenter().getLongitude());</span>
                }
<span class="nc bnc" id="L2579" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3167)) {</span>
<span class="nc" id="L2580">                    mylocation.setLatitude(lastMapFocus.getLatitude());</span>
                }
<span class="nc bnc" id="L2582" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3168)) {</span>
<span class="nc" id="L2583">                    mylocation.setLongitude(lastMapFocus.getLongitude());</span>
                }
                // in meters
<span class="nc" id="L2586">                Float distance = mylocation.distanceTo(dest_location);</span>
<span class="nc bnc" id="L2587" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3179)) {</span>
<span class="nc bnc" id="L2588" title="All 2 branches missed.">                    if (lastMapFocus != null) {</span>
<span class="nc bnc" id="L2589" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3178)) {</span>
<span class="nc bnc" id="L2590" title="All 2 branches missed.">                            if (isNetworkConnectionEstablished()) {</span>
<span class="nc bnc" id="L2591" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3177)) {</span>
<span class="nc bnc" id="L2592" title="All 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(3174) ? (distance &gt;= 2000.0) : (ListenerUtil.mutListener.listen(3173) ? (distance &lt;= 2000.0) : (ListenerUtil.mutListener.listen(3172) ? (distance &lt; 2000.0) : (ListenerUtil.mutListener.listen(3171) ? (distance != 2000.0) : (ListenerUtil.mutListener.listen(3170) ? (distance == 2000.0) : (distance &gt; 2000.0))))))) {</span>
<span class="nc bnc" id="L2593" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3176)) {</span>
<span class="nc" id="L2594">                                            setSearchThisAreaButtonVisibility(true);</span>
                                        }
                                    } else {
<span class="nc bnc" id="L2597" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3175)) {</span>
<span class="nc" id="L2598">                                            setSearchThisAreaButtonVisibility(false);</span>
                                        }
                                    }
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L2605" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3169)) {</span>
<span class="nc" id="L2606">                            setSearchThisAreaButtonVisibility(false);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L2612">    }</span>

    @Override
    public void showLocationOffDialog() {
<span class="nc bnc" id="L2616" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3181)) {</span>
            // This creates a dialog box that prompts the user to enable location
<span class="nc" id="L2618">            DialogUtil.showAlertDialog(getActivity(), getString(R.string.ask_to_turn_location_on), getString(R.string.nearby_needs_location), getString(R.string.yes), getString(R.string.no), this::openLocationSettings, null);</span>
        }
<span class="nc" id="L2620">    }</span>

    @Override
    public void openLocationSettings() {
        // This method opens the location settings of the device along with a followup toast.
<span class="nc" id="L2625">        final Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);</span>
<span class="nc" id="L2626">        final PackageManager packageManager = getActivity().getPackageManager();</span>
<span class="nc bnc" id="L2627" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3185)) {</span>
<span class="nc bnc" id="L2628" title="All 2 branches missed.">            if (intent.resolveActivity(packageManager) != null) {</span>
<span class="nc bnc" id="L2629" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3183)) {</span>
<span class="nc" id="L2630">                    startActivity(intent);</span>
                }
<span class="nc bnc" id="L2632" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3184)) {</span>
<span class="nc" id="L2633">                    Toast.makeText(getContext(), R.string.recommend_high_accuracy_mode, Toast.LENGTH_LONG).show();</span>
                }
            } else {
<span class="nc bnc" id="L2636" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3182)) {</span>
<span class="nc" id="L2637">                    Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();</span>
                }
            }
        }
<span class="nc" id="L2641">    }</span>

    @Override
    public void hideBottomSheet() {
<span class="pc bpc" id="L2645" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3186)) {</span>
<span class="fc" id="L2646">            bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
        }
<span class="fc" id="L2648">    }</span>

    @Override
    public void hideBottomDetailsSheet() {
<span class="nc bnc" id="L2652" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3187)) {</span>
<span class="nc" id="L2653">            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
        }
<span class="nc" id="L2655">    }</span>

    @Override
    public void displayBottomSheetWithInfo(final Marker marker) {
<span class="nc bnc" id="L2659" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3188)) {</span>
<span class="nc" id="L2660">            selectedMarker = marker;</span>
        }
<span class="nc" id="L2662">        final NearbyMarker nearbyMarker = (NearbyMarker) marker;</span>
<span class="nc" id="L2663">        final Place place = nearbyMarker.getNearbyBaseMarker().getPlace();</span>
<span class="nc bnc" id="L2664" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3189)) {</span>
<span class="nc" id="L2665">            passInfoToSheet(place);</span>
        }
<span class="nc bnc" id="L2667" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3190)) {</span>
<span class="nc" id="L2668">            hideBottomSheet();</span>
        }
<span class="nc bnc" id="L2670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3191)) {</span>
<span class="nc" id="L2671">            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);</span>
        }
<span class="nc" id="L2673">    }</span>

    /**
     * If nearby details bottom sheet state is collapsed: show fab plus If nearby details bottom
     * sheet state is expanded: show fab plus If nearby details bottom sheet state is hidden: hide
     * all fabs
     *
     * @param bottomSheetState see bottom sheet states
     */
    public void prepareViewsForSheetPosition(final int bottomSheetState) {
<span class="nc bnc" id="L2683" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3199)) {</span>
<span class="nc bnc" id="L2684" title="All 3 branches missed.">            switch(bottomSheetState) {</span>
                case (BottomSheetBehavior.STATE_COLLAPSED):
<span class="nc bnc" id="L2686" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3192)) {</span>
<span class="nc" id="L2687">                        collapseFABs(isFABsExpanded);</span>
                    }
<span class="nc bnc" id="L2689" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3194)) {</span>
<span class="nc bnc" id="L2690" title="All 2 branches missed.">                        if (!fabPlus.isShown()) {</span>
<span class="nc bnc" id="L2691" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3193)) {</span>
<span class="nc" id="L2692">                                showFABs();</span>
                            }
                        }
                    }
                    break;
                case (BottomSheetBehavior.STATE_HIDDEN):
<span class="nc bnc" id="L2698" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3195)) {</span>
<span class="nc" id="L2699">                        transparentView.setClickable(false);</span>
                    }
<span class="nc bnc" id="L2701" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3196)) {</span>
<span class="nc" id="L2702">                        transparentView.setAlpha(0);</span>
                    }
<span class="nc bnc" id="L2704" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3197)) {</span>
<span class="nc" id="L2705">                        collapseFABs(isFABsExpanded);</span>
                    }
<span class="nc bnc" id="L2707" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3198)) {</span>
<span class="nc" id="L2708">                        hideFABs();</span>
                    }
                    break;
            }
        }
<span class="nc" id="L2713">    }</span>

    /**
     * Same bottom sheet carries information for all nearby places, so we need to pass information
     * (title, description, distance and links) to view on nearby marker click
     *
     * @param place Place of clicked nearby marker
     */
    private void passInfoToSheet(final Place place) {
<span class="nc bnc" id="L2722" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3200)) {</span>
<span class="nc" id="L2723">            selectedPlace = place;</span>
        }
<span class="nc bnc" id="L2725" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3201)) {</span>
<span class="nc" id="L2726">            updateBookmarkButtonImage(selectedPlace);</span>
        }
<span class="nc bnc" id="L2728" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3202)) {</span>
<span class="nc" id="L2729">            bookmarkButton.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L2730">                final boolean isBookmarked = bookmarkLocationDao.updateBookmarkLocation(selectedPlace);</span>
<span class="nc" id="L2731">                updateBookmarkButtonImage(selectedPlace);</span>
<span class="nc" id="L2732">                updateMarker(isBookmarked, selectedPlace, locationManager.getLastLocation());</span>
<span class="nc" id="L2733">                mapView.invalidate();</span>
<span class="nc" id="L2734">            });</span>
        }
<span class="nc bnc" id="L2736" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3203)) {</span>
<span class="nc" id="L2737">            bookmarkButton.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L2738">                Toast.makeText(getContext(), R.string.menu_bookmark, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L2739">                return true;</span>
            });
        }
<span class="nc bnc" id="L2742" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3204)) {</span>
<span class="nc bnc" id="L2743" title="All 2 branches missed.">            wikipediaButton.setVisibility(place.hasWikipediaLink() ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L2745" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3205)) {</span>
<span class="nc" id="L2746">            wikipediaButton.setOnClickListener(view -&gt; Utils.handleWebUrl(getContext(), selectedPlace.siteLinks.getWikipediaLink()));</span>
        }
<span class="nc bnc" id="L2748" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3206)) {</span>
<span class="nc" id="L2749">            wikipediaButton.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L2750">                Toast.makeText(getContext(), R.string.nearby_wikipedia, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L2751">                return true;</span>
            });
        }
<span class="nc bnc" id="L2754" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3207)) {</span>
<span class="nc bnc" id="L2755" title="All 2 branches missed.">            wikidataButton.setVisibility(place.hasWikidataLink() ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L2757" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3208)) {</span>
<span class="nc" id="L2758">            wikidataButton.setOnClickListener(view -&gt; Utils.handleWebUrl(getContext(), selectedPlace.siteLinks.getWikidataLink()));</span>
        }
<span class="nc bnc" id="L2760" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3209)) {</span>
<span class="nc" id="L2761">            wikidataButton.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L2762">                Toast.makeText(getContext(), R.string.nearby_wikidata, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L2763">                return true;</span>
            });
        }
<span class="nc bnc" id="L2766" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3210)) {</span>
<span class="nc" id="L2767">            directionsButton.setOnClickListener(view -&gt; Utils.handleGeoCoordinates(getActivity(), selectedPlace.getLocation()));</span>
        }
<span class="nc bnc" id="L2769" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3211)) {</span>
<span class="nc" id="L2770">            directionsButton.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L2771">                Toast.makeText(getContext(), R.string.nearby_directions, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L2772">                return true;</span>
            });
        }
<span class="nc bnc" id="L2775" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3212)) {</span>
<span class="nc bnc" id="L2776" title="All 2 branches missed.">            commonsButton.setVisibility(selectedPlace.hasCommonsLink() ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L2778" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3213)) {</span>
<span class="nc" id="L2779">            commonsButton.setOnClickListener(view -&gt; Utils.handleWebUrl(getContext(), selectedPlace.siteLinks.getCommonsLink()));</span>
        }
<span class="nc bnc" id="L2781" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3214)) {</span>
<span class="nc" id="L2782">            commonsButton.setOnLongClickListener(view -&gt; {</span>
<span class="nc" id="L2783">                Toast.makeText(getContext(), R.string.nearby_commons, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L2784">                return true;</span>
            });
        }
<span class="nc bnc" id="L2787" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3215)) {</span>
<span class="nc" id="L2788">            icon.setImageResource(selectedPlace.getLabel().getIcon());</span>
        }
<span class="nc bnc" id="L2790" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3216)) {</span>
<span class="nc" id="L2791">            title.setText(selectedPlace.name);</span>
        }
<span class="nc bnc" id="L2793" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3217)) {</span>
<span class="nc" id="L2794">            distance.setText(selectedPlace.distance);</span>
        }
        // Remove label since it is double information
<span class="nc" id="L2797">        String descriptionText = selectedPlace.getLongDescription().replace(selectedPlace.getName() + &quot; (&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L2798" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3218)) {</span>
<span class="nc bnc" id="L2799" title="All 2 branches missed.">            descriptionText = (descriptionText.equals(selectedPlace.getLongDescription()) ? descriptionText : descriptionText.replaceFirst(&quot;.$&quot;, &quot;&quot;));</span>
        }
<span class="nc bnc" id="L2801" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3219)) {</span>
            // Set the short description after we remove place name from long description
<span class="nc" id="L2803">            description.setText(descriptionText);</span>
        }
<span class="nc bnc" id="L2805" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3220)) {</span>
<span class="nc" id="L2806">            fabCamera.setOnClickListener(view -&gt; {</span>
<span class="nc bnc" id="L2807" title="All 2 branches missed.">                if (fabCamera.isShown()) {</span>
<span class="nc" id="L2808">                    Timber.d(&quot;Camera button tapped. Place: %s&quot;, selectedPlace.toString());</span>
<span class="nc" id="L2809">                    storeSharedPrefs(selectedPlace);</span>
<span class="nc" id="L2810">                    controller.initiateCameraPick(getActivity(), inAppCameraLocationPermissionLauncher);</span>
                }
<span class="nc" id="L2812">            });</span>
        }
<span class="nc bnc" id="L2814" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3221)) {</span>
<span class="nc" id="L2815">            fabGallery.setOnClickListener(view -&gt; {</span>
<span class="nc bnc" id="L2816" title="All 2 branches missed.">                if (fabGallery.isShown()) {</span>
<span class="nc" id="L2817">                    Timber.d(&quot;Gallery button tapped. Place: %s&quot;, selectedPlace.toString());</span>
<span class="nc" id="L2818">                    storeSharedPrefs(selectedPlace);</span>
<span class="nc" id="L2819">                    controller.initiateGalleryPick(getActivity(), chipWlm.isChecked());</span>
                }
<span class="nc" id="L2821">            });</span>
        }
<span class="nc" id="L2823">    }</span>

    private void storeSharedPrefs(final Place selectedPlace) {
<span class="nc bnc" id="L2826" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3222)) {</span>
<span class="nc" id="L2827">            applicationKvStore.putJson(PLACE_OBJECT, selectedPlace);</span>
        }
<span class="nc" id="L2829">        Place place = applicationKvStore.getJson(PLACE_OBJECT, Place.class);</span>
<span class="nc bnc" id="L2830" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3223)) {</span>
<span class="nc" id="L2831">            Timber.d(&quot;Stored place object %s&quot;, place.toString());</span>
        }
<span class="nc" id="L2833">    }</span>

    private void updateBookmarkButtonImage(final Place place) {
        final int bookmarkIcon;
<span class="nc bnc" id="L2837" title="All 2 branches missed.">        if (bookmarkLocationDao.findBookmarkLocation(place)) {</span>
<span class="nc" id="L2838">            bookmarkIcon = R.drawable.ic_round_star_filled_24px;</span>
        } else {
<span class="nc" id="L2840">            bookmarkIcon = R.drawable.ic_round_star_border_24px;</span>
        }
<span class="nc bnc" id="L2842" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3225)) {</span>
<span class="nc bnc" id="L2843" title="All 2 branches missed.">            if (bookmarkButtonImage != null) {</span>
<span class="nc bnc" id="L2844" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3224)) {</span>
<span class="nc" id="L2845">                    bookmarkButtonImage.setImageResource(bookmarkIcon);</span>
                }
            }
        }
<span class="nc" id="L2849">    }</span>

    @Override
    public void onAttach(final Context context) {
<span class="pc bpc" id="L2853" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3226)) {</span>
<span class="fc" id="L2854">            super.onAttach(context);</span>
        }
<span class="pc bpc" id="L2856" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3227)) {</span>
<span class="fc" id="L2857">            wikidataEditListener.setAuthenticationStateListener(this);</span>
        }
<span class="fc" id="L2859">    }</span>

    @Override
    public void onDestroy() {
<span class="pc bpc" id="L2863" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3228)) {</span>
<span class="fc" id="L2864">            super.onDestroy();</span>
        }
<span class="pc bpc" id="L2866" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3229)) {</span>
<span class="fc" id="L2867">            wikidataEditListener.setAuthenticationStateListener(null);</span>
        }
<span class="fc" id="L2869">    }</span>

    @Override
    public void onWikidataEditSuccessful() {
<span class="nc bnc" id="L2873" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3232)) {</span>
<span class="nc bnc" id="L2874" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3230) ? (presenter != null || locationManager != null) : (presenter != null &amp;&amp; locationManager != null))) {</span>
<span class="nc bnc" id="L2875" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3231)) {</span>
<span class="nc" id="L2876">                    presenter.updateMapAndList(MAP_UPDATED);</span>
                }
            }
        }
<span class="nc" id="L2880">    }</span>

    private void showErrorMessage(final String message) {
<span class="nc bnc" id="L2883" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3233)) {</span>
<span class="nc" id="L2884">            ViewUtil.showLongToast(getActivity(), message);</span>
        }
<span class="nc" id="L2886">    }</span>

    public void registerUnregisterLocationListener(final boolean removeLocationListener) {
        try {
<span class="pc bpc" id="L2890" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3241)) {</span>
<span class="fc bfc" id="L2891" title="All 2 branches covered.">                if (removeLocationListener) {</span>
<span class="pc bpc" id="L2892" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3238)) {</span>
<span class="fc" id="L2893">                        locationManager.unregisterLocationManager();</span>
                    }
<span class="pc bpc" id="L2895" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3239)) {</span>
<span class="fc" id="L2896">                        locationManager.removeLocationListener(this);</span>
                    }
<span class="pc bpc" id="L2898" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3240)) {</span>
<span class="fc" id="L2899">                        Timber.d(&quot;Location service manager unregistered and removed&quot;);</span>
                    }
                } else {
<span class="pc bpc" id="L2902" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3235)) {</span>
<span class="fc" id="L2903">                        locationManager.addLocationListener(this);</span>
                    }
<span class="pc bpc" id="L2905" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3236)) {</span>
<span class="fc" id="L2906">                        locationManager.registerLocationManager();</span>
                    }
<span class="pc bpc" id="L2908" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3237)) {</span>
<span class="fc" id="L2909">                        Timber.d(&quot;Location service manager added and registered&quot;);</span>
                    }
                }
            }
<span class="nc" id="L2913">        } catch (final Exception e) {</span>
<span class="nc bnc" id="L2914" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3234)) {</span>
<span class="nc" id="L2915">                Timber.e(e);</span>
            }
<span class="fc" id="L2917">        }</span>
<span class="fc" id="L2918">    }</span>

    @Override
    public void setUserVisibleHint(final boolean isVisibleToUser) {
<span class="nc bnc" id="L2922" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3242)) {</span>
<span class="nc" id="L2923">            super.setUserVisibleHint(isVisibleToUser);</span>
        }
<span class="nc bnc" id="L2925" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3243)) {</span>
<span class="nc" id="L2926">            this.isVisibleToUser = isVisibleToUser;</span>
        }
<span class="nc bnc" id="L2928" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3250)) {</span>
<span class="nc bnc" id="L2929" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3244) ? (isResumed() || isVisibleToUser) : (isResumed() &amp;&amp; isVisibleToUser))) {</span>
<span class="nc bnc" id="L2930" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3249)) {</span>
<span class="nc" id="L2931">                    startTheMap();</span>
                }
            } else {
<span class="nc bnc" id="L2934" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3246)) {</span>
<span class="nc bnc" id="L2935" title="All 2 branches missed.">                    if (null != bottomSheetListBehavior) {</span>
<span class="nc bnc" id="L2936" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3245)) {</span>
<span class="nc" id="L2937">                            bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
                        }
                    }
                }
<span class="nc bnc" id="L2941" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3248)) {</span>
<span class="nc bnc" id="L2942" title="All 2 branches missed.">                    if (null != bottomSheetDetailsBehavior) {</span>
<span class="nc bnc" id="L2943" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3247)) {</span>
<span class="nc" id="L2944">                            bottomSheetDetailsBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L2950">    }</span>

    private void startTheMap() {
<span class="pc bpc" id="L2953" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3251)) {</span>
<span class="fc" id="L2954">            performMapReadyActions();</span>
        }
<span class="fc" id="L2956">    }</span>

    /**
     * Clears all markers from the map and resets certain map overlays and gestures. After clearing
     * markers, it re-adds a scale bar overlay and rotation gesture overlay to the map.
     */
    @Override
    public void clearAllMarkers() {
<span class="pc bpc" id="L2964" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3252)) {</span>
<span class="fc" id="L2965">            mapView.getOverlayManager().clear();</span>
        }
<span class="pc bpc" id="L2967" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3253)) {</span>
<span class="fc" id="L2968">            mapView.invalidate();</span>
        }
<span class="fc" id="L2970">        GeoPoint geoPoint = mapCenter;</span>
<span class="pc bpc" id="L2971" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3270)) {</span>
<span class="pc bpc" id="L2972" title="1 of 2 branches missed.">            if (geoPoint != null) {</span>
<span class="fc" id="L2973">                List&lt;Overlay&gt; overlays = mapView.getOverlays();</span>
<span class="fc" id="L2974">                ScaleDiskOverlay diskOverlay = new ScaleDiskOverlay(this.getContext(), geoPoint, 2000, GeoConstants.UnitOfMeasure.foot);</span>
<span class="fc" id="L2975">                Paint circlePaint = new Paint();</span>
<span class="pc bpc" id="L2976" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3254)) {</span>
<span class="fc" id="L2977">                    circlePaint.setColor(Color.rgb(128, 128, 128));</span>
                }
<span class="pc bpc" id="L2979" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3255)) {</span>
<span class="fc" id="L2980">                    circlePaint.setStyle(Paint.Style.STROKE);</span>
                }
<span class="pc bpc" id="L2982" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3256)) {</span>
<span class="fc" id="L2983">                    circlePaint.setStrokeWidth(2f);</span>
                }
<span class="pc bpc" id="L2985" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3257)) {</span>
<span class="fc" id="L2986">                    diskOverlay.setCirclePaint2(circlePaint);</span>
                }
<span class="fc" id="L2988">                Paint diskPaint = new Paint();</span>
<span class="pc bpc" id="L2989" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3258)) {</span>
<span class="fc" id="L2990">                    diskPaint.setColor(Color.argb(40, 128, 128, 128));</span>
                }
<span class="pc bpc" id="L2992" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3259)) {</span>
<span class="fc" id="L2993">                    diskPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span>
                }
<span class="pc bpc" id="L2995" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3260)) {</span>
<span class="fc" id="L2996">                    diskOverlay.setCirclePaint1(diskPaint);</span>
                }
<span class="pc bpc" id="L2998" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3261)) {</span>
<span class="fc" id="L2999">                    diskOverlay.setDisplaySizeMin(900);</span>
                }
<span class="pc bpc" id="L3001" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3262)) {</span>
<span class="fc" id="L3002">                    diskOverlay.setDisplaySizeMax(1700);</span>
                }
<span class="pc bpc" id="L3004" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3263)) {</span>
<span class="fc" id="L3005">                    mapView.getOverlays().add(diskOverlay);</span>
                }
<span class="fc" id="L3007">                org.osmdroid.views.overlay.Marker startMarker = new org.osmdroid.views.overlay.Marker(mapView);</span>
<span class="pc bpc" id="L3008" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3264)) {</span>
<span class="fc" id="L3009">                    startMarker.setPosition(geoPoint);</span>
                }
<span class="pc bpc" id="L3011" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3265)) {</span>
<span class="fc" id="L3012">                    startMarker.setAnchor(org.osmdroid.views.overlay.Marker.ANCHOR_CENTER, org.osmdroid.views.overlay.Marker.ANCHOR_BOTTOM);</span>
                }
<span class="pc bpc" id="L3014" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3266)) {</span>
<span class="fc" id="L3015">                    startMarker.setIcon(ContextCompat.getDrawable(this.getContext(), R.drawable.current_location_marker));</span>
                }
<span class="pc bpc" id="L3017" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3267)) {</span>
<span class="fc" id="L3018">                    startMarker.setTitle(&quot;Your Location&quot;);</span>
                }
<span class="pc bpc" id="L3020" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3268)) {</span>
<span class="fc" id="L3021">                    startMarker.setTextLabelFontSize(24);</span>
                }
<span class="pc bpc" id="L3023" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3269)) {</span>
<span class="fc" id="L3024">                    mapView.getOverlays().add(startMarker);</span>
                }
            }
        }
<span class="fc" id="L3028">        ScaleBarOverlay scaleBarOverlay = new ScaleBarOverlay(mapView);</span>
<span class="pc bpc" id="L3029" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3271)) {</span>
<span class="fc" id="L3030">            scaleBarOverlay.setScaleBarOffset(15, 25);</span>
        }
<span class="fc" id="L3032">        Paint barPaint = new Paint();</span>
<span class="pc bpc" id="L3033" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3272)) {</span>
<span class="fc" id="L3034">            barPaint.setARGB(200, 255, 250, 250);</span>
        }
<span class="pc bpc" id="L3036" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3273)) {</span>
<span class="fc" id="L3037">            scaleBarOverlay.setBackgroundPaint(barPaint);</span>
        }
<span class="pc bpc" id="L3039" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3274)) {</span>
<span class="fc" id="L3040">            scaleBarOverlay.enableScaleBar();</span>
        }
<span class="pc bpc" id="L3042" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3275)) {</span>
<span class="fc" id="L3043">            mapView.getOverlays().add(scaleBarOverlay);</span>
        }
<span class="pc bpc" id="L3045" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3283)) {</span>
<span class="fc" id="L3046">            mapView.getOverlays().add(new MapEventsOverlay(new MapEventsReceiver() {</span>

                @Override
                public boolean singleTapConfirmedHelper(GeoPoint p) {
<span class="nc bnc" id="L3050" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3279)) {</span>
<span class="nc bnc" id="L3051" title="All 2 branches missed.">                        if (clickedMarkerPlace != null) {</span>
<span class="nc bnc" id="L3052" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3277)) {</span>
<span class="nc" id="L3053">                                removeMarker(clickedMarkerPlace);</span>
                            }
<span class="nc bnc" id="L3055" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3278)) {</span>
<span class="nc" id="L3056">                                addMarkerToMap(clickedMarkerPlace, isClickedMarkerBookmarked);</span>
                            }
                        } else {
<span class="nc bnc" id="L3059" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3276)) {</span>
<span class="nc" id="L3060">                                Timber.e(&quot;CLICKED MARKER IS NULL&quot;);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L3064" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3282)) {</span>
<span class="nc bnc" id="L3065" title="All 2 branches missed.">                        if (isListBottomSheetExpanded()) {</span>
<span class="nc bnc" id="L3066" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3281)) {</span>
                                // Back should first hide the bottom sheet if it is expanded
<span class="nc" id="L3068">                                hideBottomSheet();</span>
                            }
<span class="nc bnc" id="L3070" title="All 2 branches missed.">                        } else if (isDetailsBottomSheetVisible()) {</span>
<span class="nc bnc" id="L3071" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3280)) {</span>
<span class="nc" id="L3072">                                hideBottomDetailsSheet();</span>
                            }
                        }
                    }
<span class="nc" id="L3076">                    return true;</span>
                }

                @Override
                public boolean longPressHelper(GeoPoint p) {
<span class="nc" id="L3081">                    return false;</span>
                }
            }));
        }
<span class="pc bpc" id="L3085" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3284)) {</span>
<span class="fc" id="L3086">            mapView.setMultiTouchControls(true);</span>
        }
<span class="fc" id="L3088">    }</span>

    /**
     * Recenters the map to the Center and adds a scale disk overlay and a marker at the position.
     *
     * @param geoPoint The GeoPoint representing the new center position of the map.
     */
    private void recenterMarkerToPosition(GeoPoint geoPoint) {
<span class="pc bpc" id="L3096" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3311)) {</span>
<span class="pc bpc" id="L3097" title="1 of 2 branches missed.">            if (geoPoint != null) {</span>
<span class="pc bpc" id="L3098" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3285)) {</span>
<span class="fc" id="L3099">                    mapView.getController().setCenter(geoPoint);</span>
                }
<span class="fc" id="L3101">                List&lt;Overlay&gt; overlays = mapView.getOverlays();</span>
<span class="pc bpc" id="L3102" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3294)) {</span>
                    {
<span class="fc" id="L3104">                        long _loopCounter48 = 0;</span>
<span class="pc bpc" id="L3105" title="15 of 22 branches missed.">                        for (int i = 0; (ListenerUtil.mutListener.listen(3293) ? (i &gt;= overlays.size()) : (ListenerUtil.mutListener.listen(3292) ? (i &lt;= overlays.size()) : (ListenerUtil.mutListener.listen(3291) ? (i &gt; overlays.size()) : (ListenerUtil.mutListener.listen(3290) ? (i != overlays.size()) : (ListenerUtil.mutListener.listen(3289) ? (i == overlays.size()) : (i &lt; overlays.size())))))); i++) {</span>
<span class="fc" id="L3106">                            ListenerUtil.loopListener.listen(&quot;_loopCounter48&quot;, ++_loopCounter48);</span>
<span class="pc bpc" id="L3107" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3288)) {</span>
<span class="pc bpc" id="L3108" title="1 of 2 branches missed.">                                if (overlays.get(i) instanceof org.osmdroid.views.overlay.Marker) {</span>
<span class="nc bnc" id="L3109" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3287)) {</span>
<span class="nc" id="L3110">                                        mapView.getOverlays().remove(i);</span>
                                    }
<span class="fc bfc" id="L3112" title="All 2 branches covered.">                                } else if (overlays.get(i) instanceof ScaleDiskOverlay) {</span>
<span class="pc bpc" id="L3113" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3286)) {</span>
<span class="fc" id="L3114">                                        mapView.getOverlays().remove(i);</span>
                                    }
                                }
                            }
                        }
                    }
                }
<span class="fc" id="L3121">                ScaleDiskOverlay diskOverlay = new ScaleDiskOverlay(this.getContext(), geoPoint, 2000, GeoConstants.UnitOfMeasure.foot);</span>
<span class="fc" id="L3122">                Paint circlePaint = new Paint();</span>
<span class="pc bpc" id="L3123" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3295)) {</span>
<span class="fc" id="L3124">                    circlePaint.setColor(Color.rgb(128, 128, 128));</span>
                }
<span class="pc bpc" id="L3126" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3296)) {</span>
<span class="fc" id="L3127">                    circlePaint.setStyle(Paint.Style.STROKE);</span>
                }
<span class="pc bpc" id="L3129" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3297)) {</span>
<span class="fc" id="L3130">                    circlePaint.setStrokeWidth(2f);</span>
                }
<span class="pc bpc" id="L3132" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3298)) {</span>
<span class="fc" id="L3133">                    diskOverlay.setCirclePaint2(circlePaint);</span>
                }
<span class="fc" id="L3135">                Paint diskPaint = new Paint();</span>
<span class="pc bpc" id="L3136" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3299)) {</span>
<span class="fc" id="L3137">                    diskPaint.setColor(Color.argb(40, 128, 128, 128));</span>
                }
<span class="pc bpc" id="L3139" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3300)) {</span>
<span class="fc" id="L3140">                    diskPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span>
                }
<span class="pc bpc" id="L3142" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3301)) {</span>
<span class="fc" id="L3143">                    diskOverlay.setCirclePaint1(diskPaint);</span>
                }
<span class="pc bpc" id="L3145" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3302)) {</span>
<span class="fc" id="L3146">                    diskOverlay.setDisplaySizeMin(900);</span>
                }
<span class="pc bpc" id="L3148" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3303)) {</span>
<span class="fc" id="L3149">                    diskOverlay.setDisplaySizeMax(1700);</span>
                }
<span class="pc bpc" id="L3151" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3304)) {</span>
<span class="fc" id="L3152">                    mapView.getOverlays().add(diskOverlay);</span>
                }
<span class="fc" id="L3154">                org.osmdroid.views.overlay.Marker startMarker = new org.osmdroid.views.overlay.Marker(mapView);</span>
<span class="pc bpc" id="L3155" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3305)) {</span>
<span class="fc" id="L3156">                    startMarker.setPosition(geoPoint);</span>
                }
<span class="pc bpc" id="L3158" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3306)) {</span>
<span class="fc" id="L3159">                    startMarker.setAnchor(org.osmdroid.views.overlay.Marker.ANCHOR_CENTER, org.osmdroid.views.overlay.Marker.ANCHOR_BOTTOM);</span>
                }
<span class="pc bpc" id="L3161" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3307)) {</span>
<span class="fc" id="L3162">                    startMarker.setIcon(ContextCompat.getDrawable(this.getContext(), R.drawable.current_location_marker));</span>
                }
<span class="pc bpc" id="L3164" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3308)) {</span>
<span class="fc" id="L3165">                    startMarker.setTitle(&quot;Your Location&quot;);</span>
                }
<span class="pc bpc" id="L3167" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3309)) {</span>
<span class="fc" id="L3168">                    startMarker.setTextLabelFontSize(24);</span>
                }
<span class="pc bpc" id="L3170" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3310)) {</span>
<span class="fc" id="L3171">                    mapView.getOverlays().add(startMarker);</span>
                }
            }
        }
<span class="fc" id="L3175">    }</span>

    private void moveCameraToPosition(GeoPoint geoPoint) {
<span class="pc bpc" id="L3178" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3312)) {</span>
<span class="fc" id="L3179">            mapView.getController().animateTo(geoPoint);</span>
        }
<span class="fc" id="L3181">    }</span>

    public interface NearbyParentFragmentInstanceReadyCallback {

        void onReady();
    }

    public void setNearbyParentFragmentInstanceReadyCallback(NearbyParentFragmentInstanceReadyCallback nearbyParentFragmentInstanceReadyCallback) {
<span class="nc bnc" id="L3189" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3313)) {</span>
<span class="nc" id="L3190">            this.nearbyParentFragmentInstanceReadyCallback = nearbyParentFragmentInstanceReadyCallback;</span>
        }
<span class="nc" id="L3192">    }</span>

    @Override
    public void onConfigurationChanged(@NonNull final Configuration newConfig) {
<span class="nc bnc" id="L3196" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3314)) {</span>
<span class="nc" id="L3197">            super.onConfigurationChanged(newConfig);</span>
        }
<span class="nc" id="L3199">        ViewGroup.LayoutParams rlBottomSheetLayoutParams = rlBottomSheet.getLayoutParams();</span>
<span class="nc bnc" id="L3200" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3323)) {</span>
<span class="nc bnc" id="L3201" title="All 48 branches missed.">            rlBottomSheetLayoutParams.height = (ListenerUtil.mutListener.listen(3322) ? ((ListenerUtil.mutListener.listen(3318) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(3317) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(3316) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(3315) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) % 9) : (ListenerUtil.mutListener.listen(3321) ? ((ListenerUtil.mutListener.listen(3318) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(3317) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(3316) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(3315) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) / 9) : (ListenerUtil.mutListener.listen(3320) ? ((ListenerUtil.mutListener.listen(3318) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(3317) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(3316) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(3315) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) - 9) : (ListenerUtil.mutListener.listen(3319) ? ((ListenerUtil.mutListener.listen(3318) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(3317) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(3316) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(3315) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) + 9) : ((ListenerUtil.mutListener.listen(3318) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() % 16) : (ListenerUtil.mutListener.listen(3317) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() * 16) : (ListenerUtil.mutListener.listen(3316) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() - 16) : (ListenerUtil.mutListener.listen(3315) ? (getActivity().getWindowManager().getDefaultDisplay().getHeight() + 16) : (getActivity().getWindowManager().getDefaultDisplay().getHeight() / 16))))) * 9)))));</span>
        }
<span class="nc bnc" id="L3203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3324)) {</span>
<span class="nc" id="L3204">            rlBottomSheet.setLayoutParams(rlBottomSheetLayoutParams);</span>
        }
<span class="nc" id="L3206">    }</span>

    @OnClick(R.id.tv_learn_more)
    public void onLearnMoreClicked() {
<span class="nc" id="L3210">        Intent intent = new Intent(Intent.ACTION_VIEW);</span>
<span class="nc bnc" id="L3211" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3325)) {</span>
<span class="nc" id="L3212">            intent.setData(Uri.parse(WLM_URL));</span>
        }
<span class="nc bnc" id="L3214" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3326)) {</span>
<span class="nc" id="L3215">            startActivity(intent);</span>
        }
<span class="nc" id="L3217">    }</span>

    @OnClick(R.id.iv_toggle_chips)
    public void onToggleChipsClicked() {
<span class="nc bnc" id="L3221" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3329)) {</span>
<span class="nc bnc" id="L3222" title="All 2 branches missed.">            if (llContainerChips.getVisibility() == View.VISIBLE) {</span>
<span class="nc bnc" id="L3223" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3328)) {</span>
<span class="nc" id="L3224">                    llContainerChips.setVisibility(View.GONE);</span>
                }
            } else {
<span class="nc bnc" id="L3227" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3327)) {</span>
<span class="nc" id="L3228">                    llContainerChips.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L3232" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3330)) {</span>
<span class="nc" id="L3233">            ivToggleChips.setRotation(ivToggleChips.getRotation() + 180);</span>
        }
<span class="nc" id="L3235">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>