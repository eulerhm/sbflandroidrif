<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SettingsFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.settings</a> &gt; <span class="el_source">SettingsFragment.java</span></div><h1>SettingsFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.settings;

import static android.content.Context.MODE_PRIVATE;
import android.Manifest.permission;
import android.app.Activity;
import android.app.Dialog;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.net.Uri;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.View;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.TextView;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.preference.ListPreference;
import androidx.preference.MultiSelectListPreference;
import androidx.preference.Preference;
import androidx.preference.Preference.OnPreferenceClickListener;
import androidx.preference.PreferenceFragmentCompat;
import androidx.preference.PreferenceGroupAdapter;
import androidx.preference.PreferenceScreen;
import androidx.preference.PreferenceViewHolder;
import androidx.recyclerview.widget.RecyclerView.Adapter;
import com.karumi.dexter.Dexter;
import com.karumi.dexter.MultiplePermissionsReport;
import com.karumi.dexter.PermissionToken;
import com.karumi.dexter.listener.PermissionRequest;
import com.karumi.dexter.listener.multi.MultiplePermissionsListener;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.campaigns.CampaignView;
import fr.free.nrw.commons.contributions.ContributionController;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.di.ApplicationlessInjection;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.location.LocationServiceManager;
import fr.free.nrw.commons.logging.CommonsLogSender;
import fr.free.nrw.commons.recentlanguages.Language;
import fr.free.nrw.commons.recentlanguages.RecentLanguagesAdapter;
import fr.free.nrw.commons.recentlanguages.RecentLanguagesDao;
import fr.free.nrw.commons.upload.LanguagesAdapter;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.PermissionUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import javax.inject.Inject;
import javax.inject.Named;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L62">public class SettingsFragment extends PreferenceFragmentCompat {</span>

    @Inject
    @Named(&quot;default_preferences&quot;)
    JsonKvStore defaultKvStore;

    @Inject
    CommonsLogSender commonsLogSender;

    @Inject
    RecentLanguagesDao recentLanguagesDao;

    @Inject
    ContributionController contributionController;

    @Inject
    LocationServiceManager locationManager;

    private ListPreference themeListPreference;

    private Preference descriptionLanguageListPreference;

    private Preference appUiLanguageListPreference;

    private String keyLanguageListPreference;

    private TextView recentLanguagesTextView;

    private View separator;

    private ListView languageHistoryListView;

    private static final String GET_CONTENT_PICKER_HELP_URL = &quot;https://commons-app.github.io/docs.html#get-content&quot;;

<span class="fc" id="L96">    private ActivityResultLauncher&lt;String[]&gt; inAppCameraLocationPermissionLauncher = registerForActivityResult(new ActivityResultContracts.RequestMultiplePermissions(), new ActivityResultCallback&lt;Map&lt;String, Boolean&gt;&gt;() {</span>

        @Override
        public void onActivityResult(Map&lt;String, Boolean&gt; result) {
<span class="nc" id="L100">            boolean areAllGranted = true;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(30)) {</span>
                {
<span class="nc" id="L103">                    long _loopCounter0 = 0;</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                    for (final boolean b : result.values()) {</span>
<span class="nc" id="L105">                        ListenerUtil.loopListener.listen(&quot;_loopCounter0&quot;, ++_loopCounter0);</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(29)) {</span>
<span class="nc bnc" id="L107" title="All 10 branches missed.">                            areAllGranted = (ListenerUtil.mutListener.listen(28) ? (areAllGranted || b) : (areAllGranted &amp;&amp; b));</span>
                        }
<span class="nc" id="L109">                    }</span>
                }
            }
<span class="nc bnc" id="L112" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(33)) {</span>
<span class="nc bnc" id="L113" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(31) ? (!areAllGranted || shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)) : (!areAllGranted &amp;&amp; shouldShowRequestPermissionRationale(permission.ACCESS_FINE_LOCATION)))) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(32)) {</span>
<span class="nc" id="L115">                        contributionController.handleShowRationaleFlowCameraLocation(getActivity());</span>
                    }
                }
            }
<span class="nc" id="L119">        }</span>
    });

    @Override
    public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(34)) {</span>
<span class="nc" id="L125">            ApplicationlessInjection.getInstance(getActivity().getApplicationContext()).getCommonsApplicationComponent().inject(this);</span>
        }
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(35)) {</span>
            // Set the preferences from an XML resource
<span class="nc" id="L129">            setPreferencesFromResource(R.xml.preferences, rootKey);</span>
        }
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(36)) {</span>
<span class="nc" id="L132">            themeListPreference = findPreference(Prefs.KEY_THEME_VALUE);</span>
        }
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(37)) {</span>
<span class="nc" id="L135">            prepareTheme();</span>
        }
<span class="nc" id="L137">        MultiSelectListPreference multiSelectListPref = findPreference(Prefs.MANAGED_EXIF_TAGS);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(39)) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (multiSelectListPref != null) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(38)) {</span>
<span class="nc" id="L141">                    multiSelectListPref.setOnPreferenceChangeListener((preference, newValue) -&gt; {</span>
<span class="nc bnc" id="L142" title="All 4 branches missed.">                        if (newValue instanceof HashSet &amp;&amp; !((HashSet) newValue).contains(getString(R.string.exif_tag_location))) {</span>
<span class="nc" id="L143">                            defaultKvStore.putBoolean(&quot;has_user_manually_removed_location&quot;, true);</span>
                        }
<span class="nc" id="L145">                        return true;</span>
                    });
                }
            }
        }
<span class="nc" id="L150">        Preference inAppCameraLocationPref = findPreference(&quot;inAppCameraLocationPref&quot;);</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(40)) {</span>
<span class="nc" id="L152">            inAppCameraLocationPref.setOnPreferenceChangeListener((preference, newValue) -&gt; {</span>
<span class="nc" id="L153">                boolean isInAppCameraLocationTurnedOn = (boolean) newValue;</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">                if (isInAppCameraLocationTurnedOn) {</span>
<span class="nc" id="L155">                    createDialogsAndHandleLocationPermissions(getActivity());</span>
                }
<span class="nc" id="L157">                return true;</span>
            });
        }
        // Gets current language code from shared preferences
        String languageCode;
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(41)) {</span>
<span class="nc" id="L163">            appUiLanguageListPreference = findPreference(&quot;appUiDefaultLanguagePref&quot;);</span>
        }
<span class="nc bnc" id="L165" title="All 2 branches missed.">        assert appUiLanguageListPreference != null;</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(42)) {</span>
<span class="nc" id="L167">            keyLanguageListPreference = appUiLanguageListPreference.getKey();</span>
        }
<span class="nc" id="L169">        languageCode = getCurrentLanguageCode(keyLanguageListPreference);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">        assert languageCode != null;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(45)) {</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (languageCode.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(44)) {</span>
                    // If current language code is empty, means none selected by user yet so use phone local
<span class="nc" id="L175">                    appUiLanguageListPreference.setSummary(Locale.getDefault().getDisplayLanguage());</span>
                }
            } else {
                // If any language is selected by user previously, use it
<span class="nc" id="L179">                Locale defLocale = new Locale(languageCode);</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(43)) {</span>
<span class="nc" id="L181">                    appUiLanguageListPreference.setSummary((defLocale).getDisplayLanguage(defLocale));</span>
                }
            }
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(47)) {</span>
<span class="nc" id="L186">            appUiLanguageListPreference.setOnPreferenceClickListener(new OnPreferenceClickListener() {</span>

                @Override
                public boolean onPreferenceClick(Preference preference) {
<span class="nc bnc" id="L190" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(46)) {</span>
<span class="nc" id="L191">                        prepareAppLanguages(appUiLanguageListPreference.getKey());</span>
                    }
<span class="nc" id="L193">                    return true;</span>
                }
            });
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(48)) {</span>
<span class="nc" id="L198">            descriptionLanguageListPreference = findPreference(&quot;descriptionDefaultLanguagePref&quot;);</span>
        }
<span class="nc bnc" id="L200" title="All 2 branches missed.">        assert descriptionLanguageListPreference != null;</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(49)) {</span>
<span class="nc" id="L202">            keyLanguageListPreference = descriptionLanguageListPreference.getKey();</span>
        }
<span class="nc" id="L204">        languageCode = getCurrentLanguageCode(keyLanguageListPreference);</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">        assert languageCode != null;</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(52)) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (languageCode.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(51)) {</span>
                    // If current language code is empty, means none selected by user yet so use phone local
<span class="nc" id="L210">                    descriptionLanguageListPreference.setSummary(Locale.getDefault().getDisplayLanguage());</span>
                }
            } else {
                // If any language is selected by user previously, use it
<span class="nc" id="L214">                Locale defLocale = new Locale(languageCode);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(50)) {</span>
<span class="nc" id="L216">                    descriptionLanguageListPreference.setSummary(defLocale.getDisplayLanguage(defLocale));</span>
                }
            }
        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(54)) {</span>
<span class="nc" id="L221">            descriptionLanguageListPreference.setOnPreferenceClickListener(new OnPreferenceClickListener() {</span>

                @Override
                public boolean onPreferenceClick(Preference preference) {
<span class="nc bnc" id="L225" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(53)) {</span>
<span class="nc" id="L226">                        prepareAppLanguages(descriptionLanguageListPreference.getKey());</span>
                    }
<span class="nc" id="L228">                    return true;</span>
                }
            });
        }
<span class="nc" id="L232">        Preference betaTesterPreference = findPreference(&quot;becomeBetaTester&quot;);</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(55)) {</span>
<span class="nc" id="L234">            betaTesterPreference.setOnPreferenceClickListener(preference -&gt; {</span>
<span class="nc" id="L235">                Utils.handleWebUrl(getActivity(), Uri.parse(getResources().getString(R.string.beta_opt_in_link)));</span>
<span class="nc" id="L236">                return true;</span>
            });
        }
<span class="nc" id="L239">        Preference sendLogsPreference = findPreference(&quot;sendLogFile&quot;);</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(56)) {</span>
<span class="nc" id="L241">            sendLogsPreference.setOnPreferenceClickListener(preference -&gt; {</span>
<span class="nc" id="L242">                checkPermissionsAndSendLogs();</span>
<span class="nc" id="L243">                return true;</span>
            });
        }
<span class="nc" id="L246">        Preference documentBasedPickerPreference = findPreference(&quot;openDocumentPhotoPickerPref&quot;);</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(57)) {</span>
<span class="nc" id="L248">            documentBasedPickerPreference.setOnPreferenceChangeListener((preference, newValue) -&gt; {</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">                boolean isGetContentPickerTurnedOn = !(boolean) newValue;</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">                if (isGetContentPickerTurnedOn) {</span>
<span class="nc" id="L251">                    showLocationLossWarning();</span>
                }
<span class="nc" id="L253">                return true;</span>
            });
        }
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(67)) {</span>
            // Disable some settings when not logged in.
<span class="nc bnc" id="L258" title="All 2 branches missed.">            if (defaultKvStore.getBoolean(&quot;login_skipped&quot;, false)) {</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(58)) {</span>
<span class="nc" id="L260">                    findPreference(&quot;useExternalStorage&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L262" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(59)) {</span>
<span class="nc" id="L263">                    findPreference(&quot;useAuthorName&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L265" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(60)) {</span>
<span class="nc" id="L266">                    findPreference(&quot;displayNearbyCardView&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L268" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(61)) {</span>
<span class="nc" id="L269">                    findPreference(&quot;descriptionDefaultLanguagePref&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L271" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(62)) {</span>
<span class="nc" id="L272">                    findPreference(&quot;displayLocationPermissionForCardView&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L274" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(63)) {</span>
<span class="nc" id="L275">                    findPreference(CampaignView.CAMPAIGNS_DEFAULT_PREFERENCE).setEnabled(false);</span>
                }
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(64)) {</span>
<span class="nc" id="L278">                    findPreference(&quot;managed_exif_tags&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L280" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(65)) {</span>
<span class="nc" id="L281">                    findPreference(&quot;openDocumentPhotoPickerPref&quot;).setEnabled(false);</span>
                }
<span class="nc bnc" id="L283" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(66)) {</span>
<span class="nc" id="L284">                    findPreference(&quot;inAppCameraLocationPref&quot;).setEnabled(false);</span>
                }
            }
        }
<span class="nc" id="L288">    }</span>

    /**
     * Asks users to provide location access
     *
     * @param activity
     */
    private void createDialogsAndHandleLocationPermissions(Activity activity) {
<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(68)) {</span>
<span class="nc" id="L297">            inAppCameraLocationPermissionLauncher.launch(new String[] { permission.ACCESS_FINE_LOCATION });</span>
        }
<span class="nc" id="L299">    }</span>

    /**
     * On some devices, the new Photo Picker with GET_CONTENT takeover
     * redacts location tags from EXIF metadata
     *
     * Show warning to the user when ACTION_GET_CONTENT intent is enabled
     */
    private void showLocationLossWarning() {
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(69)) {</span>
<span class="nc" id="L309">            DialogUtil.showAlertDialog(getActivity(), null, getString(R.string.location_loss_warning), getString(R.string.ok), getString(R.string.read_help_link), () -&gt; {</span>
<span class="nc" id="L310">            }, () -&gt; Utils.handleWebUrl(requireContext(), Uri.parse(GET_CONTENT_PICKER_HELP_URL)), null, true);</span>
        }
<span class="nc" id="L312">    }</span>

    @Override
    protected Adapter onCreateAdapter(final PreferenceScreen preferenceScreen) {
<span class="nc" id="L316">        return new PreferenceGroupAdapter(preferenceScreen) {</span>

            @Override
            public void onBindViewHolder(PreferenceViewHolder holder, int position) {
<span class="nc bnc" id="L320" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(70)) {</span>
<span class="nc" id="L321">                    super.onBindViewHolder(holder, position);</span>
                }
<span class="nc" id="L323">                Preference preference = getItem(position);</span>
<span class="nc" id="L324">                View iconFrame = holder.itemView.findViewById(R.id.icon_frame);</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(72)) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                    if (iconFrame != null) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(71)) {</span>
<span class="nc" id="L328">                            iconFrame.setVisibility(View.GONE);</span>
                        }
                    }
                }
<span class="nc" id="L332">            }</span>
        };
    }

    /**
     * Sets the theme pref
     */
    private void prepareTheme() {
<span class="nc bnc" id="L340" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(73)) {</span>
<span class="nc" id="L341">            themeListPreference.setOnPreferenceChangeListener((preference, newValue) -&gt; {</span>
<span class="nc" id="L342">                getActivity().recreate();</span>
<span class="nc" id="L343">                return true;</span>
            });
        }
<span class="nc" id="L346">    }</span>

    /**
     * Prepare and Show language selection dialog box
     * Uses previously saved language if there is any, if not uses phone locale as initial language.
     * Disable default/already selected language from dialog box
     * Get ListPreference key and act accordingly for each ListPreference.
     * saves value chosen by user to shared preferences
     * to remember later and recall MainActivity to reflect language changes
     * @param keyListPreference
     */
    private void prepareAppLanguages(final String keyListPreference) {
        // Gets current language code from shared preferences
<span class="nc" id="L359">        final String languageCode = getCurrentLanguageCode(keyListPreference);</span>
<span class="nc" id="L360">        final List&lt;Language&gt; recentLanguages = recentLanguagesDao.getRecentLanguages();</span>
<span class="nc" id="L361">        HashMap&lt;Integer, String&gt; selectedLanguages = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(80)) {</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (keyListPreference.equals(&quot;appUiDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">                assert languageCode != null;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(79)) {</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                    if (languageCode.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(78)) {</span>
<span class="nc" id="L368">                            selectedLanguages.put(0, Locale.getDefault().getLanguage());</span>
                        }
                    } else {
<span class="nc bnc" id="L371" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(77)) {</span>
<span class="nc" id="L372">                            selectedLanguages.put(0, languageCode);</span>
                        }
                    }
                }
<span class="nc bnc" id="L376" title="All 2 branches missed.">            } else if (keyListPreference.equals(&quot;descriptionDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">                assert languageCode != null;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(76)) {</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">                    if (languageCode.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(75)) {</span>
<span class="nc" id="L381">                            selectedLanguages.put(0, Locale.getDefault().getLanguage());</span>
                        }
                    } else {
<span class="nc bnc" id="L384" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(74)) {</span>
<span class="nc" id="L385">                            selectedLanguages.put(0, languageCode);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L391">        LanguagesAdapter languagesAdapter = new LanguagesAdapter(getActivity(), selectedLanguages);</span>
<span class="nc" id="L392">        Dialog dialog = new Dialog(getActivity());</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(81)) {</span>
<span class="nc" id="L394">            dialog.setContentView(R.layout.dialog_select_language);</span>
        }
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(82)) {</span>
<span class="nc" id="L397">            dialog.setCanceledOnTouchOutside(true);</span>
        }
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(91)) {</span>
<span class="nc bnc" id="L400" title="All 16 branches missed.">            dialog.getWindow().setLayout((int) ((ListenerUtil.mutListener.listen(86) ? (getActivity().getResources().getDisplayMetrics().widthPixels % 0.90) : (ListenerUtil.mutListener.listen(85) ? (getActivity().getResources().getDisplayMetrics().widthPixels / 0.90) : (ListenerUtil.mutListener.listen(84) ? (getActivity().getResources().getDisplayMetrics().widthPixels - 0.90) : (ListenerUtil.mutListener.listen(83) ? (getActivity().getResources().getDisplayMetrics().widthPixels + 0.90) : (getActivity().getResources().getDisplayMetrics().widthPixels * 0.90)))))), (int) ((ListenerUtil.mutListener.listen(90) ? (getActivity().getResources().getDisplayMetrics().heightPixels % 0.90) : (ListenerUtil.mutListener.listen(89) ? (getActivity().getResources().getDisplayMetrics().heightPixels / 0.90) : (ListenerUtil.mutListener.listen(88) ? (getActivity().getResources().getDisplayMetrics().heightPixels - 0.90) : (ListenerUtil.mutListener.listen(87) ? (getActivity().getResources().getDisplayMetrics().heightPixels + 0.90) : (getActivity().getResources().getDisplayMetrics().heightPixels * 0.90)))))));</span>
        }
<span class="nc bnc" id="L402" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(92)) {</span>
<span class="nc" id="L403">            dialog.show();</span>
        }
<span class="nc" id="L405">        EditText editText = dialog.findViewById(R.id.search_language);</span>
<span class="nc" id="L406">        ListView listView = dialog.findViewById(R.id.language_list);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(93)) {</span>
<span class="nc" id="L408">            languageHistoryListView = dialog.findViewById(R.id.language_history_list);</span>
        }
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(94)) {</span>
<span class="nc" id="L411">            recentLanguagesTextView = dialog.findViewById(R.id.recent_searches);</span>
        }
<span class="nc bnc" id="L413" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(95)) {</span>
<span class="nc" id="L414">            separator = dialog.findViewById(R.id.separator);</span>
        }
<span class="nc bnc" id="L416" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(96)) {</span>
<span class="nc" id="L417">            setUpRecentLanguagesSection(recentLanguages, selectedLanguages);</span>
        }
<span class="nc bnc" id="L419" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(97)) {</span>
<span class="nc" id="L420">            listView.setAdapter(languagesAdapter);</span>
        }
<span class="nc bnc" id="L422" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(100)) {</span>
<span class="nc" id="L423">            editText.addTextChangedListener(new TextWatcher() {</span>

                @Override
                public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2) {
<span class="nc bnc" id="L427" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(98)) {</span>
<span class="nc" id="L428">                        hideRecentLanguagesSection();</span>
                    }
<span class="nc" id="L430">                }</span>

                @Override
                public void onTextChanged(CharSequence charSequence, int i, int i1, int i2) {
<span class="nc bnc" id="L434" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(99)) {</span>
<span class="nc" id="L435">                        languagesAdapter.getFilter().filter(charSequence);</span>
                    }
<span class="nc" id="L437">                }</span>

                @Override
                public void afterTextChanged(Editable editable) {
<span class="nc" id="L441">                }</span>
            });
        }
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(101)) {</span>
<span class="nc" id="L445">            languageHistoryListView.setOnItemClickListener((adapterView, view, position, id) -&gt; {</span>
<span class="nc" id="L446">                onRecentLanguageClicked(keyListPreference, dialog, adapterView, position);</span>
<span class="nc" id="L447">            });</span>
        }
<span class="nc bnc" id="L449" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(113)) {</span>
<span class="nc" id="L450">            listView.setOnItemClickListener(new OnItemClickListener() {</span>

                @Override
                public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
<span class="nc" id="L454">                    String languageCode = ((LanguagesAdapter) adapterView.getAdapter()).getLanguageCode(i);</span>
<span class="nc" id="L455">                    final String languageName = ((LanguagesAdapter) adapterView.getAdapter()).getLanguageName(i);</span>
<span class="nc" id="L456">                    final boolean isExists = recentLanguagesDao.findRecentLanguage(languageCode);</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(103)) {</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                        if (isExists) {</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(102)) {</span>
<span class="nc" id="L460">                                recentLanguagesDao.deleteRecentLanguage(languageCode);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L464" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(104)) {</span>
<span class="nc" id="L465">                        recentLanguagesDao.addRecentLanguage(new Language(languageName, languageCode));</span>
                    }
<span class="nc bnc" id="L467" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(105)) {</span>
<span class="nc" id="L468">                        saveLanguageValue(languageCode, keyListPreference);</span>
                    }
<span class="nc" id="L470">                    Locale defLocale = new Locale(languageCode);</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(111)) {</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">                        if (keyListPreference.equals(&quot;appUiDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(107)) {</span>
<span class="nc" id="L474">                                appUiLanguageListPreference.setSummary(defLocale.getDisplayLanguage(defLocale));</span>
                            }
<span class="nc bnc" id="L476" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(108)) {</span>
<span class="nc" id="L477">                                setLocale(requireActivity(), languageCode);</span>
                            }
<span class="nc bnc" id="L479" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(109)) {</span>
<span class="nc" id="L480">                                getActivity().recreate();</span>
                            }
<span class="nc" id="L482">                            final Intent intent = new Intent(getActivity(), MainActivity.class);</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(110)) {</span>
<span class="nc" id="L484">                                startActivity(intent);</span>
                            }
<span class="nc" id="L486">                        } else {</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(106)) {</span>
<span class="nc" id="L488">                                descriptionLanguageListPreference.setSummary(defLocale.getDisplayLanguage(defLocale));</span>
                            }
                        }
                    }
<span class="nc bnc" id="L492" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(112)) {</span>
<span class="nc" id="L493">                        dialog.dismiss();</span>
                    }
<span class="nc" id="L495">                }</span>
            });
        }
<span class="nc bnc" id="L498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(114)) {</span>
<span class="nc" id="L499">            dialog.setOnDismissListener(dialogInterface -&gt; languagesAdapter.getFilter().filter(&quot;&quot;));</span>
        }
<span class="nc" id="L501">    }</span>

    /**
     * Set up recent languages section
     *
     * @param recentLanguages recently used languages
     * @param selectedLanguages selected languages
     */
    private void setUpRecentLanguagesSection(List&lt;Language&gt; recentLanguages, HashMap&lt;Integer, String&gt; selectedLanguages) {
<span class="nc bnc" id="L510" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(139)) {</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">            if (recentLanguages.isEmpty()) {</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(136)) {</span>
<span class="nc" id="L513">                    languageHistoryListView.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L515" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(137)) {</span>
<span class="nc" id="L516">                    recentLanguagesTextView.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L518" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(138)) {</span>
<span class="nc" id="L519">                    separator.setVisibility(View.GONE);</span>
                }
            } else {
<span class="nc bnc" id="L522" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(131)) {</span>
<span class="nc bnc" id="L523" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(119) ? (recentLanguages.size() &gt;= 5) : (ListenerUtil.mutListener.listen(118) ? (recentLanguages.size() &lt;= 5) : (ListenerUtil.mutListener.listen(117) ? (recentLanguages.size() &lt; 5) : (ListenerUtil.mutListener.listen(116) ? (recentLanguages.size() != 5) : (ListenerUtil.mutListener.listen(115) ? (recentLanguages.size() == 5) : (recentLanguages.size() &gt; 5))))))) {</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(130)) {</span>
                            {
<span class="nc" id="L526">                                long _loopCounter1 = 0;</span>
<span class="nc bnc" id="L527" title="All 30 branches missed.">                                for (int i = (ListenerUtil.mutListener.listen(129) ? (recentLanguages.size() % 1) : (ListenerUtil.mutListener.listen(128) ? (recentLanguages.size() / 1) : (ListenerUtil.mutListener.listen(127) ? (recentLanguages.size() * 1) : (ListenerUtil.mutListener.listen(126) ? (recentLanguages.size() + 1) : (recentLanguages.size() - 1))))); (ListenerUtil.mutListener.listen(125) ? (i &lt;= 5) : (ListenerUtil.mutListener.listen(124) ? (i &gt; 5) : (ListenerUtil.mutListener.listen(123) ? (i &lt; 5) : (ListenerUtil.mutListener.listen(122) ? (i != 5) : (ListenerUtil.mutListener.listen(121) ? (i == 5) : (i &gt;= 5)))))); i--) {</span>
<span class="nc" id="L528">                                    ListenerUtil.loopListener.listen(&quot;_loopCounter1&quot;, ++_loopCounter1);</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(120)) {</span>
<span class="nc" id="L530">                                        recentLanguagesDao.deleteRecentLanguage(recentLanguages.get(i).getLanguageCode());</span>
                                    }
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L537" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(132)) {</span>
<span class="nc" id="L538">                    languageHistoryListView.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L540" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(133)) {</span>
<span class="nc" id="L541">                    recentLanguagesTextView.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L543" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(134)) {</span>
<span class="nc" id="L544">                    separator.setVisibility(View.VISIBLE);</span>
                }
<span class="nc" id="L546">                final RecentLanguagesAdapter recentLanguagesAdapter = new RecentLanguagesAdapter(getActivity(), recentLanguagesDao.getRecentLanguages(), selectedLanguages);</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(135)) {</span>
<span class="nc" id="L548">                    languageHistoryListView.setAdapter(recentLanguagesAdapter);</span>
                }
            }
        }
<span class="nc" id="L552">    }</span>

    /**
     * Handles click event for recent language section
     */
    private void onRecentLanguageClicked(String keyListPreference, Dialog dialog, AdapterView&lt;?&gt; adapterView, int position) {
<span class="nc" id="L558">        final String recentLanguageCode = ((RecentLanguagesAdapter) adapterView.getAdapter()).getLanguageCode(position);</span>
<span class="nc" id="L559">        final String recentLanguageName = ((RecentLanguagesAdapter) adapterView.getAdapter()).getLanguageName(position);</span>
<span class="nc" id="L560">        final boolean isExists = recentLanguagesDao.findRecentLanguage(recentLanguageCode);</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(141)) {</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (isExists) {</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(140)) {</span>
<span class="nc" id="L564">                    recentLanguagesDao.deleteRecentLanguage(recentLanguageCode);</span>
                }
            }
        }
<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(142)) {</span>
<span class="nc" id="L569">            recentLanguagesDao.addRecentLanguage(new Language(recentLanguageName, recentLanguageCode));</span>
        }
<span class="nc bnc" id="L571" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(143)) {</span>
<span class="nc" id="L572">            saveLanguageValue(recentLanguageCode, keyListPreference);</span>
        }
<span class="nc" id="L574">        final Locale defLocale = new Locale(recentLanguageCode);</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(149)) {</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">            if (keyListPreference.equals(&quot;appUiDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(145)) {</span>
<span class="nc" id="L578">                    appUiLanguageListPreference.setSummary(defLocale.getDisplayLanguage(defLocale));</span>
                }
<span class="nc bnc" id="L580" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(146)) {</span>
<span class="nc" id="L581">                    setLocale(requireActivity(), recentLanguageCode);</span>
                }
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(147)) {</span>
<span class="nc" id="L584">                    getActivity().recreate();</span>
                }
<span class="nc" id="L586">                final Intent intent = new Intent(getActivity(), MainActivity.class);</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(148)) {</span>
<span class="nc" id="L588">                    startActivity(intent);</span>
                }
<span class="nc" id="L590">            } else {</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(144)) {</span>
<span class="nc" id="L592">                    descriptionLanguageListPreference.setSummary(defLocale.getDisplayLanguage(defLocale));</span>
                }
            }
        }
<span class="nc bnc" id="L596" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(150)) {</span>
<span class="nc" id="L597">            dialog.dismiss();</span>
        }
<span class="nc" id="L599">    }</span>

    /**
     * Remove the section of recent languages
     */
    private void hideRecentLanguagesSection() {
<span class="nc bnc" id="L605" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(151)) {</span>
<span class="nc" id="L606">            languageHistoryListView.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(152)) {</span>
<span class="nc" id="L609">            recentLanguagesTextView.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L611" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(153)) {</span>
<span class="nc" id="L612">            separator.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L614">    }</span>

    /**
     * Changing the default app language with selected one and save it to SharedPreferences
     */
    public void setLocale(final Activity activity, String userSelectedValue) {
<span class="pc bpc" id="L620" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(155)) {</span>
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">            if (userSelectedValue.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(154)) {</span>
<span class="nc" id="L623">                    userSelectedValue = Locale.getDefault().getLanguage();</span>
                }
            }
        }
<span class="fc" id="L627">        final Locale locale = new Locale(userSelectedValue);</span>
<span class="pc bpc" id="L628" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(156)) {</span>
<span class="fc" id="L629">            Locale.setDefault(locale);</span>
        }
<span class="fc" id="L631">        final Configuration configuration = new Configuration();</span>
<span class="pc bpc" id="L632" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(157)) {</span>
<span class="fc" id="L633">            configuration.locale = locale;</span>
        }
<span class="pc bpc" id="L635" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(158)) {</span>
<span class="fc" id="L636">            activity.getBaseContext().getResources().updateConfiguration(configuration, activity.getBaseContext().getResources().getDisplayMetrics());</span>
        }
<span class="fc" id="L638">        final SharedPreferences.Editor editor = activity.getSharedPreferences(&quot;Settings&quot;, MODE_PRIVATE).edit();</span>
<span class="pc bpc" id="L639" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(159)) {</span>
<span class="fc" id="L640">            editor.putString(&quot;language&quot;, userSelectedValue);</span>
        }
<span class="pc bpc" id="L642" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(160)) {</span>
<span class="fc" id="L643">            editor.apply();</span>
        }
<span class="fc" id="L645">    }</span>

    /**
     * Save userselected language in List Preference
     * @param userSelectedValue
     * @param preferenceKey
     */
    private void saveLanguageValue(final String userSelectedValue, final String preferenceKey) {
<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(163)) {</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">            if (preferenceKey.equals(&quot;appUiDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(162)) {</span>
<span class="nc" id="L656">                    defaultKvStore.putString(Prefs.APP_UI_LANGUAGE, userSelectedValue);</span>
                }
<span class="nc bnc" id="L658" title="All 2 branches missed.">            } else if (preferenceKey.equals(&quot;descriptionDefaultLanguagePref&quot;)) {</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(161)) {</span>
<span class="nc" id="L660">                    defaultKvStore.putString(Prefs.DESCRIPTION_LANGUAGE, userSelectedValue);</span>
                }
            }
        }
<span class="nc" id="L664">    }</span>

    /**
     * Gets current language code from shared preferences
     * @param preferenceKey
     * @return
     */
    private String getCurrentLanguageCode(final String preferenceKey) {
<span class="nc bnc" id="L672" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(164)) {</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">            if (preferenceKey.equals(&quot;appUiDefaultLanguagePref&quot;)) {</span>
<span class="nc" id="L674">                return defaultKvStore.getString(Prefs.APP_UI_LANGUAGE, &quot;&quot;);</span>
            }
        }
<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(165)) {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">            if (preferenceKey.equals(&quot;descriptionDefaultLanguagePref&quot;)) {</span>
<span class="nc" id="L679">                return defaultKvStore.getString(Prefs.DESCRIPTION_LANGUAGE, &quot;&quot;);</span>
            }
        }
<span class="nc" id="L682">        return null;</span>
    }

    /**
     * First checks for external storage permissions and then sends logs via email
     */
    private void checkPermissionsAndSendLogs() {
<span class="nc bnc" id="L689" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(168)) {</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">            if (PermissionUtils.hasPermission(getActivity(), PermissionUtils.PERMISSIONS_STORAGE)) {</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(167)) {</span>
<span class="nc" id="L692">                    commonsLogSender.send(getActivity(), null);</span>
                }
            } else {
<span class="nc bnc" id="L695" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(166)) {</span>
<span class="nc" id="L696">                    requestExternalStoragePermissions();</span>
                }
            }
        }
<span class="nc" id="L700">    }</span>

    /**
     * Requests external storage permissions and shows a toast stating that log collection has
     * started
     */
    private void requestExternalStoragePermissions() {
<span class="nc bnc" id="L707" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(170)) {</span>
<span class="nc" id="L708">            Dexter.withActivity(getActivity()).withPermissions(PermissionUtils.PERMISSIONS_STORAGE).withListener(new MultiplePermissionsListener() {</span>

                @Override
                public void onPermissionsChecked(MultiplePermissionsReport report) {
<span class="nc bnc" id="L712" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(169)) {</span>
<span class="nc" id="L713">                        ViewUtil.showLongToast(getActivity(), getResources().getString(R.string.log_collection_started));</span>
                    }
<span class="nc" id="L715">                }</span>

                @Override
                public void onPermissionRationaleShouldBeShown(List&lt;PermissionRequest&gt; permissions, PermissionToken token) {
<span class="nc" id="L719">                }</span>
<span class="nc" id="L720">            }).onSameThread().check();</span>
        }
<span class="nc" id="L722">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>