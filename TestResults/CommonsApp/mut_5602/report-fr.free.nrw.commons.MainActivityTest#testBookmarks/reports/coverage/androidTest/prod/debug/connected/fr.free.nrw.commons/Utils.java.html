<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Utils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons</a> &gt; <span class="el_source">Utils.java</span></div><h1>Utils.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons;

import android.content.ClipData;
import android.content.ClipboardManager;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.net.Uri;
import android.text.SpannableString;
import android.text.style.UnderlineSpan;
import android.view.View;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.browser.customtabs.CustomTabColorSchemeParams;
import androidx.browser.customtabs.CustomTabsIntent;
import androidx.core.content.ContextCompat;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import java.util.Calendar;
import java.util.Date;
import org.wikipedia.dataclient.WikiSite;
import org.wikipedia.page.PageTitle;
import java.util.Locale;
import java.util.regex.Pattern;
import fr.free.nrw.commons.location.LatLng;
import fr.free.nrw.commons.settings.Prefs;
import fr.free.nrw.commons.utils.ViewUtil;
import timber.log.Timber;
import static android.widget.Toast.LENGTH_SHORT;
import static fr.free.nrw.commons.campaigns.CampaignView.CAMPAIGNS_DEFAULT_PREFERENCE;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L33">public class Utils {</span>

    public static PageTitle getPageTitle(@NonNull String title) {
<span class="nc" id="L36">        return new PageTitle(title, new WikiSite(BuildConfig.COMMONS_URL));</span>
    }

    /**
     * Generates licence name with given ID
     * @param license License ID
     * @return Name of license
     */
    public static int licenseNameFor(String license) {
<span class="nc bnc" id="L45" title="All 6 branches missed.">        switch(license) {</span>
            case Prefs.Licenses.CC_BY_3:
<span class="nc" id="L47">                return R.string.license_name_cc_by;</span>
            case Prefs.Licenses.CC_BY_4:
<span class="nc" id="L49">                return R.string.license_name_cc_by_four;</span>
            case Prefs.Licenses.CC_BY_SA_3:
<span class="nc" id="L51">                return R.string.license_name_cc_by_sa;</span>
            case Prefs.Licenses.CC_BY_SA_4:
<span class="nc" id="L53">                return R.string.license_name_cc_by_sa_four;</span>
            case Prefs.Licenses.CC0:
<span class="nc" id="L55">                return R.string.license_name_cc0;</span>
        }
<span class="nc" id="L57">        throw new IllegalStateException(&quot;Unrecognized license value: &quot; + license);</span>
    }

    @NonNull
    public static String licenseUrlFor(String license) {
<span class="nc bnc" id="L62" title="All 6 branches missed.">        switch(license) {</span>
            case Prefs.Licenses.CC_BY_3:
<span class="nc" id="L64">                return &quot;https://creativecommons.org/licenses/by/3.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_4:
<span class="nc" id="L66">                return &quot;https://creativecommons.org/licenses/by/4.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_SA_3:
<span class="nc" id="L68">                return &quot;https://creativecommons.org/licenses/by-sa/3.0/&quot;;</span>
            case Prefs.Licenses.CC_BY_SA_4:
<span class="nc" id="L70">                return &quot;https://creativecommons.org/licenses/by-sa/4.0/&quot;;</span>
            case Prefs.Licenses.CC0:
<span class="nc" id="L72">                return &quot;https://creativecommons.org/publicdomain/zero/1.0/&quot;;</span>
            default:
<span class="nc" id="L74">                throw new IllegalStateException(&quot;Unrecognized license value: &quot; + license);</span>
        }
    }

    /**
     * Adds extension to filename. Converts to .jpg if system provides .jpeg, adds .jpg if no extension detected
     * @param title File name
     * @param extension Correct extension
     * @return File with correct extension
     */
    public static String fixExtension(String title, String extension) {
<span class="nc" id="L85">        Pattern jpegPattern = Pattern.compile(&quot;\\.jpeg$&quot;, Pattern.CASE_INSENSITIVE);</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9613)) {</span>
            // People are used to &quot;.jpg&quot; more than &quot;.jpeg&quot; which the system gives us.
<span class="nc bnc" id="L88" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9611) ? (extension != null || extension.toLowerCase(Locale.ENGLISH).equals(&quot;jpeg&quot;)) : (extension != null &amp;&amp; extension.toLowerCase(Locale.ENGLISH).equals(&quot;jpeg&quot;)))) {</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9612)) {</span>
<span class="nc" id="L90">                    extension = &quot;jpg&quot;;</span>
                }
            }
        }
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9614)) {</span>
<span class="nc" id="L95">            title = jpegPattern.matcher(title).replaceFirst(&quot;.jpg&quot;);</span>
        }
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9617)) {</span>
<span class="nc bnc" id="L98" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9615) ? (extension != null || !title.toLowerCase(Locale.getDefault()).endsWith(&quot;.&quot; + extension.toLowerCase(Locale.ENGLISH))) : (extension != null &amp;&amp; !title.toLowerCase(Locale.getDefault()).endsWith(&quot;.&quot; + extension.toLowerCase(Locale.ENGLISH))))) {</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9616)) {</span>
<span class="nc" id="L100">                    title += &quot;.&quot; + extension;</span>
                }
            }
        }
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9626)) {</span>
            // If title has an extension in it, if won't be true
<span class="nc bnc" id="L106" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(9623) ? (extension == null || (ListenerUtil.mutListener.listen(9622) ? (title.lastIndexOf(&quot;.&quot;) &gt;= 0) : (ListenerUtil.mutListener.listen(9621) ? (title.lastIndexOf(&quot;.&quot;) &gt; 0) : (ListenerUtil.mutListener.listen(9620) ? (title.lastIndexOf(&quot;.&quot;) &lt; 0) : (ListenerUtil.mutListener.listen(9619) ? (title.lastIndexOf(&quot;.&quot;) != 0) : (ListenerUtil.mutListener.listen(9618) ? (title.lastIndexOf(&quot;.&quot;) == 0) : (title.lastIndexOf(&quot;.&quot;) &lt;= 0))))))) : (extension == null &amp;&amp; (ListenerUtil.mutListener.listen(9622) ? (title.lastIndexOf(&quot;.&quot;) &gt;= 0) : (ListenerUtil.mutListener.listen(9621) ? (title.lastIndexOf(&quot;.&quot;) &gt; 0) : (ListenerUtil.mutListener.listen(9620) ? (title.lastIndexOf(&quot;.&quot;) &lt; 0) : (ListenerUtil.mutListener.listen(9619) ? (title.lastIndexOf(&quot;.&quot;) != 0) : (ListenerUtil.mutListener.listen(9618) ? (title.lastIndexOf(&quot;.&quot;) == 0) : (title.lastIndexOf(&quot;.&quot;) &lt;= 0))))))))) {</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9624)) {</span>
<span class="nc" id="L108">                    extension = &quot;jpg&quot;;</span>
                }
<span class="nc bnc" id="L110" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9625)) {</span>
<span class="nc" id="L111">                    title += &quot;.&quot; + extension;</span>
                }
            }
        }
<span class="nc" id="L115">        return title;</span>
    }

    /**
     * Launches intent to rate app
     * @param context
     */
    public static void rateApp(Context context) {
<span class="nc" id="L123">        final String appPackageName = context.getPackageName();</span>
        try {
<span class="nc bnc" id="L125" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9628)) {</span>
<span class="nc" id="L126">                context.startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(Urls.PLAY_STORE_PREFIX + appPackageName)));</span>
            }
<span class="nc" id="L128">        } catch (android.content.ActivityNotFoundException anfe) {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9627)) {</span>
<span class="nc" id="L130">                handleWebUrl(context, Uri.parse(Urls.PLAY_STORE_URL_PREFIX + appPackageName));</span>
            }
<span class="nc" id="L132">        }</span>
<span class="nc" id="L133">    }</span>

    /**
     * Opens Custom Tab Activity with in-app browser for the specified URL.
     * Launches intent for web URL
     * @param context
     * @param url
     */
    public static void handleWebUrl(Context context, Uri url) {
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9629)) {</span>
<span class="nc" id="L143">            Timber.d(&quot;Launching web url %s&quot;, url.toString());</span>
        }
<span class="nc" id="L145">        Intent browserIntent = new Intent(Intent.ACTION_VIEW, url);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9631)) {</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">            if (browserIntent.resolveActivity(context.getPackageManager()) == null) {</span>
<span class="nc" id="L148">                Toast toast = Toast.makeText(context, context.getString(R.string.no_web_browser), LENGTH_SHORT);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9630)) {</span>
<span class="nc" id="L150">                    toast.show();</span>
                }
<span class="nc" id="L152">                return;</span>
            }
        }
<span class="nc" id="L155">        final CustomTabColorSchemeParams color = new CustomTabColorSchemeParams.Builder().setToolbarColor(ContextCompat.getColor(context, R.color.primaryColor)).setSecondaryToolbarColor(ContextCompat.getColor(context, R.color.primaryDarkColor)).build();</span>
<span class="nc" id="L156">        CustomTabsIntent.Builder builder = new CustomTabsIntent.Builder();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9632)) {</span>
<span class="nc" id="L158">            builder.setDefaultColorSchemeParams(color);</span>
        }
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9633)) {</span>
<span class="nc" id="L161">            builder.setExitAnimations(context, android.R.anim.slide_in_left, android.R.anim.slide_out_right);</span>
        }
<span class="nc" id="L163">        CustomTabsIntent customTabsIntent = builder.build();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9634)) {</span>
            // Clear previous browser tasks, so that back/exit buttons work as intended.
<span class="nc" id="L166">            customTabsIntent.intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK);</span>
        }
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9635)) {</span>
<span class="nc" id="L169">            customTabsIntent.launchUrl(context, url);</span>
        }
<span class="nc" id="L171">    }</span>

    /**
     * Util function to handle geo coordinates
     * It no longer depends on google maps and any app capable of handling the map intent can handle it
     * @param context
     * @param latLng
     */
    public static void handleGeoCoordinates(Context context, LatLng latLng) {
<span class="nc" id="L180">        Intent mapIntent = new Intent(Intent.ACTION_VIEW, latLng.getGmmIntentUri());</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9638)) {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (mapIntent.resolveActivity(context.getPackageManager()) != null) {</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9637)) {</span>
<span class="nc" id="L184">                    context.startActivity(mapIntent);</span>
                }
            } else {
<span class="nc bnc" id="L187" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9636)) {</span>
<span class="nc" id="L188">                    ViewUtil.showShortToast(context, context.getString(R.string.map_application_missing));</span>
                }
            }
        }
<span class="nc" id="L192">    }</span>

    /**
     * To take screenshot of the screen and return it in Bitmap format
     *
     * @param view
     * @return
     */
    public static Bitmap getScreenShot(View view) {
<span class="nc" id="L201">        View screenView = view.getRootView();</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9639)) {</span>
<span class="nc" id="L203">            screenView.setDrawingCacheEnabled(true);</span>
        }
<span class="nc" id="L205">        Bitmap drawingCache = screenView.getDrawingCache();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9641)) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (drawingCache != null) {</span>
<span class="nc" id="L208">                Bitmap bitmap = Bitmap.createBitmap(drawingCache);</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9640)) {</span>
<span class="nc" id="L210">                    screenView.setDrawingCacheEnabled(false);</span>
                }
<span class="nc" id="L212">                return bitmap;</span>
            }
        }
<span class="nc" id="L215">        return null;</span>
    }

    /*
    *Copies the content to the clipboard
    *
    */
    public static void copy(String label, String text, Context context) {
<span class="nc" id="L223">        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(Context.CLIPBOARD_SERVICE);</span>
<span class="nc" id="L224">        ClipData clip = ClipData.newPlainText(label, text);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9642)) {</span>
<span class="nc" id="L226">            clipboard.setPrimaryClip(clip);</span>
        }
<span class="nc" id="L228">    }</span>

    /**
     * This method sets underlined string text to a TextView
     *
     * @param textView TextView associated with string resource
     * @param stringResourceName string resource name
     * @param context
     */
    public static void setUnderlinedText(TextView textView, int stringResourceName, Context context) {
<span class="nc" id="L238">        SpannableString content = new SpannableString(context.getString(stringResourceName));</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9643)) {</span>
<span class="nc" id="L240">            content.setSpan(new UnderlineSpan(), 0, content.length(), 0);</span>
        }
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9644)) {</span>
<span class="nc" id="L243">            textView.setText(content);</span>
        }
<span class="nc" id="L245">    }</span>

    /**
     * For now we are enabling the monuments only when the date lies between 1 Sept &amp; 31 OCt
     * @param date
     * @return
     */
    public static boolean isMonumentsEnabled(final Date date) {
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9650)) {</span>
<span class="pc bpc" id="L254" title="16 of 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9649) ? (date.getMonth() &gt;= 8) : (ListenerUtil.mutListener.listen(9648) ? (date.getMonth() &lt;= 8) : (ListenerUtil.mutListener.listen(9647) ? (date.getMonth() &gt; 8) : (ListenerUtil.mutListener.listen(9646) ? (date.getMonth() &lt; 8) : (ListenerUtil.mutListener.listen(9645) ? (date.getMonth() != 8) : (date.getMonth() == 8))))))) {</span>
<span class="nc" id="L255">                return true;</span>
            }
        }
<span class="fc" id="L258">        return false;</span>
    }

    /**
     * Util function to get the start date of wlm monument
     * For this release we are hardcoding it to be 1st September
     * @return
     */
    public static String getWLMStartDate() {
<span class="fc" id="L267">        return &quot;1 Sep&quot;;</span>
    }

    /**
     *  Util function to get the end date of wlm monument
     *  For this release we are hardcoding it to be 31st October
     *  @return
     */
    public static String getWLMEndDate() {
<span class="fc" id="L276">        return &quot;30 Sep&quot;;</span>
    }

    /**
     *  Function to get the current WLM year
     *  It increments at the start of September in line with the other WLM functions
     *  (No consideration of locales for now)
     *  @param calendar
     *  @return
     */
    public static int getWikiLovesMonumentsYear(Calendar calendar) {
<span class="nc" id="L287">        int year = calendar.get(Calendar.YEAR);</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9657)) {</span>
<span class="nc bnc" id="L289" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9655) ? (calendar.get(Calendar.MONTH) &gt;= Calendar.SEPTEMBER) : (ListenerUtil.mutListener.listen(9654) ? (calendar.get(Calendar.MONTH) &lt;= Calendar.SEPTEMBER) : (ListenerUtil.mutListener.listen(9653) ? (calendar.get(Calendar.MONTH) &gt; Calendar.SEPTEMBER) : (ListenerUtil.mutListener.listen(9652) ? (calendar.get(Calendar.MONTH) != Calendar.SEPTEMBER) : (ListenerUtil.mutListener.listen(9651) ? (calendar.get(Calendar.MONTH) == Calendar.SEPTEMBER) : (calendar.get(Calendar.MONTH) &lt; Calendar.SEPTEMBER))))))) {</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9656)) {</span>
<span class="nc" id="L291">                    year -= 1;</span>
                }
            }
        }
<span class="nc" id="L295">        return year;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>