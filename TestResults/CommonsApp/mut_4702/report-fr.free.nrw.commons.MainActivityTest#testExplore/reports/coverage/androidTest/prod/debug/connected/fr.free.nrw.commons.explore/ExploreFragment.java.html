<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExploreFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.explore</a> &gt; <span class="el_source">ExploreFragment.java</span></div><h1>ExploreFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.explore;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.viewpager.widget.ViewPager.OnPageChangeListener;
import butterknife.BindView;
import butterknife.ButterKnife;
import com.google.android.material.tabs.TabLayout;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.ViewPagerAdapter;
import fr.free.nrw.commons.contributions.MainActivity;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.theme.BaseActivity;
import fr.free.nrw.commons.utils.ActivityUtils;
import java.util.ArrayList;
import java.util.List;
import javax.inject.Inject;
import javax.inject.Named;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L30">public class ExploreFragment extends CommonsDaggerSupportFragment {</span>

    private static final String FEATURED_IMAGES_CATEGORY = &quot;Featured_pictures_on_Wikimedia_Commons&quot;;

    private static final String MOBILE_UPLOADS_CATEGORY = &quot;Uploaded_with_Mobile/Android&quot;;

    private static final String EXPLORE_MAP = &quot;Map&quot;;

    private static final String MEDIA_DETAILS_FRAGMENT_TAG = &quot;MediaDetailsFragment&quot;;

    @BindView(R.id.tab_layout)
    TabLayout tabLayout;

    @BindView(R.id.viewPager)
    ParentViewPager viewPager;

    ViewPagerAdapter viewPagerAdapter;

    private ExploreListRootFragment featuredRootFragment;

    private ExploreListRootFragment mobileRootFragment;

    private ExploreMapRootFragment mapRootFragment;

    @Inject
    @Named(&quot;default_preferences&quot;)
    public JsonKvStore applicationKvStore;

    public void setScroll(boolean canScroll) {
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4514)) {</span>
<span class="nc" id="L60">            viewPager.setCanScroll(canScroll);</span>
        }
<span class="nc" id="L62">    }</span>

    @NonNull
    public static ExploreFragment newInstance() {
<span class="fc" id="L66">        ExploreFragment fragment = new ExploreFragment();</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4515)) {</span>
<span class="fc" id="L68">            fragment.setRetainInstance(true);</span>
        }
<span class="fc" id="L70">        return fragment;</span>
    }

    @Override
    public void onCreate(@Nullable final Bundle savedInstanceState) {
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4516)) {</span>
<span class="fc" id="L76">            super.onCreate(savedInstanceState);</span>
        }
<span class="fc" id="L78">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4517)) {</span>
<span class="fc" id="L83">            super.onCreate(savedInstanceState);</span>
        }
<span class="fc" id="L85">        View view = inflater.inflate(R.layout.fragment_explore, container, false);</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4518)) {</span>
<span class="fc" id="L87">            ButterKnife.bind(this, view);</span>
        }
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4519)) {</span>
<span class="fc" id="L90">            viewPagerAdapter = new ViewPagerAdapter(getChildFragmentManager());</span>
        }
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4520)) {</span>
<span class="fc" id="L93">            viewPager.setAdapter(viewPagerAdapter);</span>
        }
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4521)) {</span>
<span class="fc" id="L96">            viewPager.setId(R.id.viewPager);</span>
        }
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4522)) {</span>
<span class="fc" id="L99">            tabLayout.setupWithViewPager(viewPager);</span>
        }
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4531)) {</span>
<span class="fc" id="L102">            viewPager.addOnPageChangeListener(new OnPageChangeListener() {</span>

                @Override
                public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
<span class="fc" id="L106">                }</span>

                @Override
                public void onPageSelected(int position) {
<span class="nc bnc" id="L110" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4530)) {</span>
<span class="nc bnc" id="L111" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(4527) ? (position &gt;= 2) : (ListenerUtil.mutListener.listen(4526) ? (position &lt;= 2) : (ListenerUtil.mutListener.listen(4525) ? (position &gt; 2) : (ListenerUtil.mutListener.listen(4524) ? (position &lt; 2) : (ListenerUtil.mutListener.listen(4523) ? (position != 2) : (position == 2))))))) {</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4529)) {</span>
<span class="nc" id="L113">                                viewPager.setCanScroll(false);</span>
                            }
                        } else {
<span class="nc bnc" id="L116" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4528)) {</span>
<span class="nc" id="L117">                                viewPager.setCanScroll(true);</span>
                            }
                        }
                    }
<span class="nc" id="L121">                }</span>

                @Override
                public void onPageScrollStateChanged(int state) {
<span class="nc" id="L125">                }</span>
            });
        }
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4532)) {</span>
<span class="fc" id="L129">            setTabs();</span>
        }
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4533)) {</span>
<span class="fc" id="L132">            setHasOptionsMenu(true);</span>
        }
<span class="fc" id="L134">        return view;</span>
    }

    /**
     * Sets the titles in the tabLayout and fragments in the viewPager
     */
    public void setTabs() {
<span class="fc" id="L141">        List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L142">        List&lt;String&gt; titleList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L143">        Bundle featuredArguments = new Bundle();</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4534)) {</span>
<span class="fc" id="L145">            featuredArguments.putString(&quot;categoryName&quot;, FEATURED_IMAGES_CATEGORY);</span>
        }
<span class="fc" id="L147">        Bundle mobileArguments = new Bundle();</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4535)) {</span>
<span class="fc" id="L149">            mobileArguments.putString(&quot;categoryName&quot;, MOBILE_UPLOADS_CATEGORY);</span>
        }
<span class="fc" id="L151">        Bundle mapArguments = new Bundle();</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4536)) {</span>
<span class="fc" id="L153">            mapArguments.putString(&quot;categoryName&quot;, EXPLORE_MAP);</span>
        }
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4537)) {</span>
<span class="fc" id="L156">            featuredRootFragment = new ExploreListRootFragment(featuredArguments);</span>
        }
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4538)) {</span>
<span class="fc" id="L159">            mobileRootFragment = new ExploreListRootFragment(mobileArguments);</span>
        }
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4539)) {</span>
<span class="fc" id="L162">            mapRootFragment = new ExploreMapRootFragment(mapArguments);</span>
        }
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4540)) {</span>
<span class="fc" id="L165">            fragmentList.add(featuredRootFragment);</span>
        }
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4541)) {</span>
<span class="fc" id="L168">            titleList.add(getString(R.string.explore_tab_title_featured).toUpperCase());</span>
        }
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4542)) {</span>
<span class="fc" id="L171">            fragmentList.add(mobileRootFragment);</span>
        }
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4543)) {</span>
<span class="fc" id="L174">            titleList.add(getString(R.string.explore_tab_title_mobile).toUpperCase());</span>
        }
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4544)) {</span>
<span class="fc" id="L177">            fragmentList.add(mapRootFragment);</span>
        }
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4545)) {</span>
<span class="fc" id="L180">            titleList.add(getString(R.string.explore_tab_title_map).toUpperCase());</span>
        }
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4546)) {</span>
<span class="fc" id="L183">            ((MainActivity) getActivity()).showTabs();</span>
        }
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4547)) {</span>
<span class="fc" id="L186">            ((BaseActivity) getActivity()).getSupportActionBar().setDisplayHomeAsUpEnabled(false);</span>
        }
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4548)) {</span>
<span class="fc" id="L189">            viewPagerAdapter.setTabData(fragmentList, titleList);</span>
        }
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4549)) {</span>
<span class="fc" id="L192">            viewPagerAdapter.notifyDataSetChanged();</span>
        }
<span class="fc" id="L194">    }</span>

    public boolean onBackPressed() {
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4556)) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (tabLayout.getSelectedTabPosition() == 0) {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4555)) {</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">                    if (featuredRootFragment.backPressed()) {</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4554)) {</span>
<span class="nc" id="L202">                            ((BaseActivity) getActivity()).getSupportActionBar().setDisplayHomeAsUpEnabled(false);</span>
                        }
<span class="nc" id="L204">                        return true;</span>
                    }
                }
<span class="nc bnc" id="L207" title="All 2 branches missed.">            } else if (tabLayout.getSelectedTabPosition() == 1) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4553)) {</span>
                    // Mobile root fragment
<span class="nc bnc" id="L210" title="All 2 branches missed.">                    if (mobileRootFragment.backPressed()) {</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4552)) {</span>
<span class="nc" id="L212">                            ((BaseActivity) getActivity()).getSupportActionBar().setDisplayHomeAsUpEnabled(false);</span>
                        }
<span class="nc" id="L214">                        return true;</span>
                    }
                }
            } else {
<span class="nc bnc" id="L218" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4551)) {</span>
                    // explore map fragment
<span class="nc bnc" id="L220" title="All 2 branches missed.">                    if (mapRootFragment.backPressed()) {</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4550)) {</span>
<span class="nc" id="L222">                            ((BaseActivity) getActivity()).getSupportActionBar().setDisplayHomeAsUpEnabled(false);</span>
                        }
<span class="nc" id="L224">                        return true;</span>
                    }
                }
            }
        }
<span class="nc" id="L229">        return false;</span>
    }

    /**
     * This method inflates the menu in the toolbar
     */
    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4557)) {</span>
<span class="fc" id="L238">            inflater.inflate(R.menu.menu_search, menu);</span>
        }
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4558)) {</span>
<span class="fc" id="L241">            super.onCreateOptionsMenu(menu, inflater);</span>
        }
<span class="fc" id="L243">    }</span>

    /**
     * This method handles the logic on ItemSelect in toolbar menu Currently only 1 choice is
     * available to open search page of the app
     */
    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        // Handle item selection
<span class="nc bnc" id="L252" title="All 2 branches missed.">        switch(item.getItemId()) {</span>
            case R.id.action_search:
<span class="nc bnc" id="L254" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4559)) {</span>
<span class="nc" id="L255">                    ActivityUtils.startActivityWithFlags(getActivity(), SearchActivity.class);</span>
                }
<span class="nc" id="L257">                return true;</span>
            default:
<span class="nc" id="L259">                return super.onOptionsItemSelected(item);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>