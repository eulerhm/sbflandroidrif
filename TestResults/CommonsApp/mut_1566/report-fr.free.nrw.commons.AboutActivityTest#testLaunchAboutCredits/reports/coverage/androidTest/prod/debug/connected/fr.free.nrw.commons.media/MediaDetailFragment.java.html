<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediaDetailFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.media</a> &gt; <span class="el_source">MediaDetailFragment.java</span></div><h1>MediaDetailFragment.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.media;

import static android.app.Activity.RESULT_CANCELED;
import static android.app.Activity.RESULT_OK;
import static android.view.View.GONE;
import static android.view.View.VISIBLE;
import static fr.free.nrw.commons.category.CategoryClientKt.CATEGORY_NEEDING_CATEGORIES;
import static fr.free.nrw.commons.category.CategoryClientKt.CATEGORY_UNCATEGORISED;
import static fr.free.nrw.commons.description.EditDescriptionConstants.LIST_OF_DESCRIPTION_AND_CAPTION;
import static fr.free.nrw.commons.description.EditDescriptionConstants.UPDATED_WIKITEXT;
import static fr.free.nrw.commons.description.EditDescriptionConstants.WIKITEXT;
import static fr.free.nrw.commons.upload.mediaDetails.UploadMediaDetailFragment.LAST_LOCATION;
import static fr.free.nrw.commons.utils.LangCodeUtils.getLocalizedResources;
import android.annotation.SuppressLint;
import android.app.AlertDialog;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.graphics.drawable.Animatable;
import android.net.Uri;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.view.KeyEvent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnKeyListener;
import android.view.ViewGroup;
import android.view.ViewTreeObserver;
import android.view.ViewTreeObserver.OnGlobalLayoutListener;
import android.webkit.WebView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.ScrollView;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentTransaction;
import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;
import com.facebook.drawee.backends.pipeline.Fresco;
import com.facebook.drawee.controller.BaseControllerListener;
import com.facebook.drawee.controller.ControllerListener;
import com.facebook.drawee.interfaces.DraweeController;
import com.facebook.drawee.view.SimpleDraweeView;
import com.facebook.imagepipeline.image.ImageInfo;
import com.facebook.imagepipeline.request.ImageRequest;
import com.mapbox.mapboxsdk.camera.CameraPosition;
import com.mapbox.mapboxsdk.geometry.LatLng;
import fr.free.nrw.commons.BuildConfig;
import fr.free.nrw.commons.LocationPicker.LocationPicker;
import fr.free.nrw.commons.Media;
import fr.free.nrw.commons.MediaDataExtractor;
import fr.free.nrw.commons.R;
import fr.free.nrw.commons.Utils;
import fr.free.nrw.commons.actions.ThanksClient;
import fr.free.nrw.commons.auth.AccountUtil;
import fr.free.nrw.commons.auth.SessionManager;
import fr.free.nrw.commons.category.CategoryClient;
import fr.free.nrw.commons.category.CategoryDetailsActivity;
import fr.free.nrw.commons.category.CategoryEditHelper;
import fr.free.nrw.commons.contributions.ContributionsFragment;
import fr.free.nrw.commons.coordinates.CoordinateEditHelper;
import fr.free.nrw.commons.delete.DeleteHelper;
import fr.free.nrw.commons.delete.ReasonBuilder;
import fr.free.nrw.commons.description.DescriptionEditActivity;
import fr.free.nrw.commons.description.DescriptionEditHelper;
import fr.free.nrw.commons.di.ApplicationlessInjection;
import fr.free.nrw.commons.di.CommonsDaggerSupportFragment;
import fr.free.nrw.commons.explore.depictions.WikidataItemDetailsActivity;
import fr.free.nrw.commons.kvstore.JsonKvStore;
import fr.free.nrw.commons.location.LocationServiceManager;
import fr.free.nrw.commons.media.ZoomableActivity.ZoomableActivityConstants;
import fr.free.nrw.commons.profile.ProfileActivity;
import fr.free.nrw.commons.review.ReviewController;
import fr.free.nrw.commons.review.ReviewHelper;
import fr.free.nrw.commons.settings.Prefs;
import fr.free.nrw.commons.ui.widget.HtmlTextView;
import fr.free.nrw.commons.upload.categories.UploadCategoriesFragment;
import fr.free.nrw.commons.upload.depicts.DepictsFragment;
import fr.free.nrw.commons.upload.UploadMediaDetail;
import fr.free.nrw.commons.utils.DialogUtil;
import fr.free.nrw.commons.utils.PermissionUtils;
import fr.free.nrw.commons.utils.ViewUtil;
import fr.free.nrw.commons.utils.ViewUtilWrapper;
import io.reactivex.Observable;
import io.reactivex.ObservableSource;
import io.reactivex.Single;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.CompositeDisposable;
import io.reactivex.schedulers.Schedulers;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Objects;
import java.util.concurrent.Callable;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.inject.Inject;
import javax.inject.Named;
import org.apache.commons.lang3.StringUtils;
import org.wikipedia.dataclient.mwapi.MwQueryPage;
import org.wikipedia.language.AppLanguageLookUpTable;
import org.wikipedia.util.DateUtil;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L123">public class MediaDetailFragment extends CommonsDaggerSupportFragment implements CategoryEditHelper.Callback {</span>

    private static final int REQUEST_CODE = 1001;

    private static final int REQUEST_CODE_EDIT_DESCRIPTION = 1002;

    private static final String IMAGE_BACKGROUND_COLOR = &quot;image_background_color&quot;;

    static final int DEFAULT_IMAGE_BACKGROUND_COLOR = 0;

    private boolean editable;

    private boolean isCategoryImage;

    private MediaDetailPagerFragment.MediaDetailProvider detailProvider;

    private int index;

<span class="nc" id="L141">    private boolean isDeleted = false;</span>

    private boolean isWikipediaButtonDisplayed;

    private Callback callback;

    @Inject
    LocationServiceManager locationManager;

    public static MediaDetailFragment forMedia(int index, boolean editable, boolean isCategoryImage, boolean isWikipediaButtonDisplayed) {
<span class="nc" id="L151">        MediaDetailFragment mf = new MediaDetailFragment();</span>
<span class="nc" id="L152">        Bundle state = new Bundle();</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8738)) {</span>
<span class="nc" id="L154">            state.putBoolean(&quot;editable&quot;, editable);</span>
        }
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8739)) {</span>
<span class="nc" id="L157">            state.putBoolean(&quot;isCategoryImage&quot;, isCategoryImage);</span>
        }
<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8740)) {</span>
<span class="nc" id="L160">            state.putInt(&quot;index&quot;, index);</span>
        }
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8741)) {</span>
<span class="nc" id="L163">            state.putInt(&quot;listIndex&quot;, 0);</span>
        }
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8742)) {</span>
<span class="nc" id="L166">            state.putInt(&quot;listTop&quot;, 0);</span>
        }
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8743)) {</span>
<span class="nc" id="L169">            state.putBoolean(&quot;isWikipediaButtonDisplayed&quot;, isWikipediaButtonDisplayed);</span>
        }
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8744)) {</span>
<span class="nc" id="L172">            mf.setArguments(state);</span>
        }
<span class="nc" id="L174">        return mf;</span>
    }

    @Inject
    SessionManager sessionManager;

    @Inject
    MediaDataExtractor mediaDataExtractor;

    @Inject
    ReasonBuilder reasonBuilder;

    @Inject
    DeleteHelper deleteHelper;

    @Inject
    ReviewHelper reviewHelper;

    @Inject
    CategoryEditHelper categoryEditHelper;

    @Inject
    CoordinateEditHelper coordinateEditHelper;

    @Inject
    DescriptionEditHelper descriptionEditHelper;

    @Inject
    ViewUtilWrapper viewUtil;

    @Inject
    CategoryClient categoryClient;

    @Inject
    ThanksClient thanksClient;

    @Inject
    @Named(&quot;default_preferences&quot;)
    JsonKvStore applicationKvStore;

<span class="nc" id="L214">    private int initialListTop = 0;</span>

    @BindView(R.id.description_webview)
    WebView descriptionWebView;

    @BindView(R.id.mediaDetailFrameLayout)
    FrameLayout frameLayout;

    @BindView(R.id.mediaDetailImageView)
    SimpleDraweeView image;

    @BindView(R.id.mediaDetailImageViewSpacer)
    LinearLayout imageSpacer;

    @BindView(R.id.mediaDetailTitle)
    TextView title;

    @BindView(R.id.caption_layout)
    LinearLayout captionLayout;

    @BindView(R.id.depicts_layout)
    LinearLayout depictsLayout;

    @BindView(R.id.depictionsEditButton)
    Button depictEditButton;

    @BindView(R.id.media_detail_caption)
    TextView mediaCaption;

    @BindView(R.id.mediaDetailDesc)
    HtmlTextView desc;

    @BindView(R.id.mediaDetailAuthor)
    TextView author;

    @BindView(R.id.mediaDetailLicense)
    TextView license;

    @BindView(R.id.mediaDetailCoordinates)
    TextView coordinates;

    @BindView(R.id.mediaDetailuploadeddate)
    TextView uploadedDate;

    @BindView(R.id.mediaDetailDisc)
    TextView mediaDiscussion;

    @BindView(R.id.seeMore)
    TextView seeMore;

    @BindView(R.id.nominatedDeletionBanner)
    LinearLayout nominatedForDeletion;

    @BindView(R.id.mediaDetailCategoryContainer)
    LinearLayout categoryContainer;

    @BindView(R.id.categoryEditButton)
    Button categoryEditButton;

    @BindView(R.id.media_detail_depiction_container)
    LinearLayout depictionContainer;

    @BindView(R.id.authorLinearLayout)
    LinearLayout authorLayout;

    @BindView(R.id.nominateDeletion)
    Button delete;

    @BindView(R.id.mediaDetailScrollView)
    ScrollView scrollView;

    @BindView(R.id.toDoLayout)
    LinearLayout toDoLayout;

    @BindView(R.id.toDoReason)
    TextView toDoReason;

    @BindView(R.id.coordinate_edit)
    Button coordinateEditButton;

    @BindView(R.id.dummy_caption_description_container)
    LinearLayout showCaptionAndDescriptionContainer;

    @BindView(R.id.show_caption_description_textview)
    TextView showCaptionDescriptionTextView;

    @BindView(R.id.caption_listview)
    ListView captionsListView;

    @BindView(R.id.caption_label)
    TextView captionLabel;

    @BindView(R.id.description_label)
    TextView descriptionLabel;

    @BindView(R.id.pb_circular)
    ProgressBar progressBar;

    String descriptionHtmlCode;

    @BindView(R.id.progressBarDeletion)
    ProgressBar progressBarDeletion;

    @BindView(R.id.progressBarEdit)
    ProgressBar progressBarEditDescription;

    @BindView(R.id.progressBarEditCategory)
    ProgressBar progressBarEditCategory;

    @BindView(R.id.description_edit)
    Button editDescription;

    @BindView(R.id.sendThanks)
    Button sendThanksButton;

<span class="nc" id="L329">    private ArrayList&lt;String&gt; categoryNames = new ArrayList&lt;&gt;();</span>

    private String categorySearchQuery;

    /**
     * Depicts is a feature part of Structured data. Multiple Depictions can be added for an image just like categories.
     * However unlike categories depictions is multi-lingual
     * Ex: key: en value: monument
     */
    private ImageInfo imageInfoCache;

    private int oldWidthOfImageView;

    private int newWidthOfImageView;

    // helps in maintaining aspect ratio
<span class="nc" id="L345">    private boolean heightVerifyingBoolean = true;</span>

    // for layout stuff, only used once!
    private ViewTreeObserver.OnGlobalLayoutListener layoutListener;

    // Had to make this class variable, to implement various onClicks, which access the media, also I fell why make separate variables when one can serve the purpose
    private Media media;

    private ArrayList&lt;String&gt; reasonList;

    private ArrayList&lt;String&gt; reasonListEnglishMappings;

    /**
     * Height stores the height of the frame layout as soon as it is initialised and updates itself on
     * configuration changes.
     * Used to adjust aspect ratio of image when length of the image is too large.
     */
    private int frameLayoutHeight;

    /**
     * Minimum height of the metadata, in pixels.
     * Images with a very narrow aspect ratio will be reduced so that the metadata information panel always has at least this height.
     */
<span class="nc" id="L368">    private int minimumHeightOfMetadata = 200;</span>

    static final String NOMINATING_FOR_DELETION_MEDIA = &quot;Nominating for deletion %s&quot;;

    @Override
    public void onSaveInstanceState(Bundle outState) {
<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8745)) {</span>
<span class="nc" id="L375">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8746)) {</span>
<span class="nc" id="L378">            outState.putInt(&quot;index&quot;, index);</span>
        }
<span class="nc bnc" id="L380" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8747)) {</span>
<span class="nc" id="L381">            outState.putBoolean(&quot;editable&quot;, editable);</span>
        }
<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8748)) {</span>
<span class="nc" id="L384">            outState.putBoolean(&quot;isCategoryImage&quot;, isCategoryImage);</span>
        }
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8749)) {</span>
<span class="nc" id="L387">            outState.putBoolean(&quot;isWikipediaButtonDisplayed&quot;, isWikipediaButtonDisplayed);</span>
        }
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8750)) {</span>
<span class="nc" id="L390">            getScrollPosition();</span>
        }
<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8751)) {</span>
<span class="nc" id="L393">            outState.putInt(&quot;listTop&quot;, initialListTop);</span>
        }
<span class="nc" id="L395">    }</span>

    private void getScrollPosition() {
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8752)) {</span>
<span class="nc" id="L399">            initialListTop = scrollView.getScrollY();</span>
        }
<span class="nc" id="L401">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8755)) {</span>
<span class="nc bnc" id="L406" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8753) ? (getParentFragment() != null || getParentFragment() instanceof MediaDetailPagerFragment) : (getParentFragment() != null &amp;&amp; getParentFragment() instanceof MediaDetailPagerFragment))) {</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8754)) {</span>
<span class="nc" id="L408">                    detailProvider = ((MediaDetailPagerFragment) getParentFragment()).getMediaDetailProvider();</span>
                }
            }
        }
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8766)) {</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8761)) {</span>
<span class="nc" id="L415">                    editable = savedInstanceState.getBoolean(&quot;editable&quot;);</span>
                }
<span class="nc bnc" id="L417" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8762)) {</span>
<span class="nc" id="L418">                    isCategoryImage = savedInstanceState.getBoolean(&quot;isCategoryImage&quot;);</span>
                }
<span class="nc bnc" id="L420" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8763)) {</span>
<span class="nc" id="L421">                    isWikipediaButtonDisplayed = savedInstanceState.getBoolean(&quot;isWikipediaButtonDisplayed&quot;);</span>
                }
<span class="nc bnc" id="L423" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8764)) {</span>
<span class="nc" id="L424">                    index = savedInstanceState.getInt(&quot;index&quot;);</span>
                }
<span class="nc bnc" id="L426" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8765)) {</span>
<span class="nc" id="L427">                    initialListTop = savedInstanceState.getInt(&quot;listTop&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L430" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8756)) {</span>
<span class="nc" id="L431">                    editable = getArguments().getBoolean(&quot;editable&quot;);</span>
                }
<span class="nc bnc" id="L433" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8757)) {</span>
<span class="nc" id="L434">                    isCategoryImage = getArguments().getBoolean(&quot;isCategoryImage&quot;);</span>
                }
<span class="nc bnc" id="L436" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8758)) {</span>
<span class="nc" id="L437">                    isWikipediaButtonDisplayed = getArguments().getBoolean(&quot;isWikipediaButtonDisplayed&quot;);</span>
                }
<span class="nc bnc" id="L439" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8759)) {</span>
<span class="nc" id="L440">                    index = getArguments().getInt(&quot;index&quot;);</span>
                }
<span class="nc bnc" id="L442" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8760)) {</span>
<span class="nc" id="L443">                    initialListTop = 0;</span>
                }
            }
        }
<span class="nc bnc" id="L447" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8767)) {</span>
<span class="nc" id="L448">            reasonList = new ArrayList&lt;&gt;();</span>
        }
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8768)) {</span>
<span class="nc" id="L451">            reasonList.add(getString(R.string.deletion_reason_uploaded_by_mistake));</span>
        }
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8769)) {</span>
<span class="nc" id="L454">            reasonList.add(getString(R.string.deletion_reason_publicly_visible));</span>
        }
<span class="nc bnc" id="L456" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8770)) {</span>
<span class="nc" id="L457">            reasonList.add(getString(R.string.deletion_reason_not_interesting));</span>
        }
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8771)) {</span>
<span class="nc" id="L460">            reasonList.add(getString(R.string.deletion_reason_no_longer_want_public));</span>
        }
<span class="nc bnc" id="L462" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8772)) {</span>
<span class="nc" id="L463">            reasonList.add(getString(R.string.deletion_reason_bad_for_my_privacy));</span>
        }
<span class="nc bnc" id="L465" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8773)) {</span>
            // Add corresponding mappings in english locale so that we can upload it in deletion request
<span class="nc" id="L467">            reasonListEnglishMappings = new ArrayList&lt;&gt;();</span>
        }
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8774)) {</span>
<span class="nc" id="L470">            reasonListEnglishMappings.add(getLocalizedResources(getContext(), Locale.ENGLISH).getString(R.string.deletion_reason_uploaded_by_mistake));</span>
        }
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8775)) {</span>
<span class="nc" id="L473">            reasonListEnglishMappings.add(getLocalizedResources(getContext(), Locale.ENGLISH).getString(R.string.deletion_reason_publicly_visible));</span>
        }
<span class="nc bnc" id="L475" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8776)) {</span>
<span class="nc" id="L476">            reasonListEnglishMappings.add(getLocalizedResources(getContext(), Locale.ENGLISH).getString(R.string.deletion_reason_not_interesting));</span>
        }
<span class="nc bnc" id="L478" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8777)) {</span>
<span class="nc" id="L479">            reasonListEnglishMappings.add(getLocalizedResources(getContext(), Locale.ENGLISH).getString(R.string.deletion_reason_no_longer_want_public));</span>
        }
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8778)) {</span>
<span class="nc" id="L482">            reasonListEnglishMappings.add(getLocalizedResources(getContext(), Locale.ENGLISH).getString(R.string.deletion_reason_bad_for_my_privacy));</span>
        }
<span class="nc" id="L484">        final View view = inflater.inflate(R.layout.fragment_media_detail, container, false);</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8779)) {</span>
<span class="nc" id="L486">            ButterKnife.bind(this, view);</span>
        }
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8780)) {</span>
<span class="nc" id="L489">            Utils.setUnderlinedText(seeMore, R.string.nominated_see_more, requireContext());</span>
        }
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8783)) {</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">            if (isCategoryImage) {</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8782)) {</span>
<span class="nc" id="L494">                    authorLayout.setVisibility(VISIBLE);</span>
                }
            } else {
<span class="nc bnc" id="L497" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8781)) {</span>
<span class="nc" id="L498">                    authorLayout.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L502" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8785)) {</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">            if (!sessionManager.isUserLoggedIn()) {</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8784)) {</span>
<span class="nc" id="L505">                    categoryEditButton.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L509" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8788)) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">            if (applicationKvStore.getBoolean(&quot;login_skipped&quot;)) {</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8786)) {</span>
<span class="nc" id="L512">                    delete.setVisibility(GONE);</span>
                }
<span class="nc bnc" id="L514" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8787)) {</span>
<span class="nc" id="L515">                    coordinateEditButton.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L519" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8789)) {</span>
<span class="nc" id="L520">            handleBackEvent(view);</span>
        }
<span class="nc bnc" id="L522" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8792)) {</span>
            /**
             * Gets the height of the frame layout as soon as the view is ready and updates aspect ratio
             * of the picture.
             */
<span class="nc" id="L527">            view.post(new Runnable() {</span>

                @Override
                public void run() {
<span class="nc bnc" id="L531" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8790)) {</span>
<span class="nc" id="L532">                        frameLayoutHeight = frameLayout.getMeasuredHeight();</span>
                    }
<span class="nc bnc" id="L534" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8791)) {</span>
<span class="nc" id="L535">                        updateAspectRatio(scrollView.getWidth());</span>
                    }
<span class="nc" id="L537">                }</span>
            });
        }
<span class="nc" id="L540">        return view;</span>
    }

    @OnClick(R.id.mediaDetailImageViewSpacer)
    public void launchZoomActivity(final View view) {
<span class="nc" id="L545">        final boolean hasPermission = PermissionUtils.hasPermission(getActivity(), PermissionUtils.PERMISSIONS_STORAGE);</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8795)) {</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">            if (hasPermission) {</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8794)) {</span>
<span class="nc" id="L549">                    launchZoomActivityAfterPermissionCheck(view);</span>
                }
            } else {
<span class="nc bnc" id="L552" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8793)) {</span>
<span class="nc" id="L553">                    PermissionUtils.checkPermissionsAndPerformAction(getActivity(), () -&gt; {</span>
<span class="nc" id="L554">                        launchZoomActivityAfterPermissionCheck(view);</span>
<span class="nc" id="L555">                    }, R.string.storage_permission_title, R.string.read_storage_permission_rationale, PermissionUtils.PERMISSIONS_STORAGE);</span>
                }
            }
        }
<span class="nc" id="L559">    }</span>

    /**
     * launch zoom acitivity after permission check
     * @param view as ImageView
     */
    private void launchZoomActivityAfterPermissionCheck(final View view) {
<span class="nc bnc" id="L566" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8806)) {</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">            if (media.getImageUrl() != null) {</span>
<span class="nc" id="L568">                final Context ctx = view.getContext();</span>
<span class="nc" id="L569">                final Intent zoomableIntent = new Intent(ctx, ZoomableActivity.class);</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8796)) {</span>
<span class="nc" id="L571">                    zoomableIntent.setData(Uri.parse(media.getImageUrl()));</span>
                }
<span class="nc bnc" id="L573" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8797)) {</span>
<span class="nc" id="L574">                    zoomableIntent.putExtra(ZoomableActivity.ZoomableActivityConstants.ORIGIN, &quot;MediaDetails&quot;);</span>
                }
<span class="nc" id="L576">                int backgroundColor = getImageBackgroundColor();</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8804)) {</span>
<span class="nc bnc" id="L578" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(8802) ? (backgroundColor &gt;= DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8801) ? (backgroundColor &lt;= DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8800) ? (backgroundColor &gt; DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8799) ? (backgroundColor &lt; DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8798) ? (backgroundColor == DEFAULT_IMAGE_BACKGROUND_COLOR) : (backgroundColor != DEFAULT_IMAGE_BACKGROUND_COLOR))))))) {</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8803)) {</span>
<span class="nc" id="L580">                            zoomableIntent.putExtra(ZoomableActivity.ZoomableActivityConstants.PHOTO_BACKGROUND_COLOR, backgroundColor);</span>
                        }
                    }
                }
<span class="nc bnc" id="L584" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8805)) {</span>
<span class="nc" id="L585">                    ctx.startActivity(zoomableIntent);</span>
                }
            }
        }
<span class="nc" id="L589">    }</span>

    @Override
    public void onResume() {
<span class="nc bnc" id="L593" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8807)) {</span>
<span class="nc" id="L594">            super.onResume();</span>
        }
<span class="nc bnc" id="L596" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8811)) {</span>
<span class="nc bnc" id="L597" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8808) ? (getParentFragment() != null || getParentFragment().getParentFragment() != null) : (getParentFragment() != null &amp;&amp; getParentFragment().getParentFragment() != null))) {</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8810)) {</span>
                    // in the case when MediaDetailPagerFragment is directly started by the CategoryImagesActivity
<span class="nc bnc" id="L600" title="All 2 branches missed.">                    if (getParentFragment() instanceof ContributionsFragment) {</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8809)) {</span>
<span class="nc" id="L602">                            ((ContributionsFragment) (getParentFragment().getParentFragment())).nearbyNotificationCardView.setVisibility(View.GONE);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8814)) {</span>
            // detail provider is null when fragment is shown in review activity
<span class="nc bnc" id="L610" title="All 2 branches missed.">            if (detailProvider != null) {</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8813)) {</span>
<span class="nc" id="L612">                    media = detailProvider.getMediaAtPosition(index);</span>
                }
            } else {
<span class="nc bnc" id="L615" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8812)) {</span>
<span class="nc" id="L616">                    media = getArguments().getParcelable(&quot;media&quot;);</span>
                }
            }
        }
<span class="nc bnc" id="L620" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8817)) {</span>
<span class="nc bnc" id="L621" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8815) ? (media != null || applicationKvStore.getBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), false)) : (media != null &amp;&amp; applicationKvStore.getBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), false)))) {</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8816)) {</span>
<span class="nc" id="L623">                    enableProgressBar();</span>
                }
            }
        }
<span class="nc bnc" id="L627" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8822)) {</span>
<span class="nc bnc" id="L628" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(8819) ? ((ListenerUtil.mutListener.listen(8818) ? (AccountUtil.getUserName(getContext()) != null || media != null) : (AccountUtil.getUserName(getContext()) != null &amp;&amp; media != null)) || AccountUtil.getUserName(getContext()).equals(media.getAuthor())) : ((ListenerUtil.mutListener.listen(8818) ? (AccountUtil.getUserName(getContext()) != null || media != null) : (AccountUtil.getUserName(getContext()) != null &amp;&amp; media != null)) &amp;&amp; AccountUtil.getUserName(getContext()).equals(media.getAuthor())))) {</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8821)) {</span>
<span class="nc" id="L630">                    sendThanksButton.setVisibility(GONE);</span>
                }
            } else {
<span class="nc bnc" id="L633" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8820)) {</span>
<span class="nc" id="L634">                    sendThanksButton.setVisibility(VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8828)) {</span>
<span class="nc" id="L639">            scrollView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {</span>

                @Override
                public void onGlobalLayout() {
<span class="nc bnc" id="L643" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8823)) {</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">                        if (getContext() == null) {</span>
<span class="nc" id="L645">                            return;</span>
                        }
                    }
<span class="nc bnc" id="L648" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8824)) {</span>
<span class="nc" id="L649">                        scrollView.getViewTreeObserver().removeOnGlobalLayoutListener(this);</span>
                    }
<span class="nc bnc" id="L651" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8825)) {</span>
<span class="nc" id="L652">                        oldWidthOfImageView = scrollView.getWidth();</span>
                    }
<span class="nc bnc" id="L654" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8827)) {</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">                        if (media != null) {</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8826)) {</span>
<span class="nc" id="L657">                                displayMediaDetails();</span>
                            }
                        }
                    }
<span class="nc" id="L661">                }</span>
            });
        }
<span class="nc" id="L664">    }</span>

    @Override
    public void onConfigurationChanged(Configuration newConfig) {
<span class="nc bnc" id="L668" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8829)) {</span>
<span class="nc" id="L669">            super.onConfigurationChanged(newConfig);</span>
        }
<span class="nc bnc" id="L671" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8838)) {</span>
<span class="nc" id="L672">            scrollView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {</span>

                @Override
                public void onGlobalLayout() {
<span class="nc bnc" id="L676" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8832)) {</span>
                        /**
                         * We update the height of the frame layout as the configuration changes.
                         */
<span class="nc" id="L680">                        frameLayout.post(new Runnable() {</span>

                            @Override
                            public void run() {
<span class="nc bnc" id="L684" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8830)) {</span>
<span class="nc" id="L685">                                    frameLayoutHeight = frameLayout.getMeasuredHeight();</span>
                                }
<span class="nc bnc" id="L687" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8831)) {</span>
<span class="nc" id="L688">                                    updateAspectRatio(scrollView.getWidth());</span>
                                }
<span class="nc" id="L690">                            }</span>
                        });
                    }
<span class="nc bnc" id="L693" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8837)) {</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">                        if (scrollView.getWidth() != oldWidthOfImageView) {</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8835)) {</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                                if (newWidthOfImageView == 0) {</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(8833)) {</span>
<span class="nc" id="L698">                                        newWidthOfImageView = scrollView.getWidth();</span>
                                    }
<span class="nc bnc" id="L700" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(8834)) {</span>
<span class="nc" id="L701">                                        updateAspectRatio(newWidthOfImageView);</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L705" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8836)) {</span>
<span class="nc" id="L706">                                scrollView.getViewTreeObserver().removeOnGlobalLayoutListener(this);</span>
                            }
                        }
                    }
<span class="nc" id="L710">                }</span>
            });
        }
<span class="nc bnc" id="L713" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8843)) {</span>
            // Ensuring correct aspect ratio for landscape mode
<span class="nc bnc" id="L715" title="All 2 branches missed.">            if (heightVerifyingBoolean) {</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8841)) {</span>
<span class="nc" id="L717">                    updateAspectRatio(newWidthOfImageView);</span>
                }
<span class="nc bnc" id="L719" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8842)) {</span>
<span class="nc" id="L720">                    heightVerifyingBoolean = false;</span>
                }
            } else {
<span class="nc bnc" id="L723" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8839)) {</span>
<span class="nc" id="L724">                    updateAspectRatio(oldWidthOfImageView);</span>
                }
<span class="nc bnc" id="L726" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8840)) {</span>
<span class="nc" id="L727">                    heightVerifyingBoolean = true;</span>
                }
            }
        }
<span class="nc" id="L731">    }</span>

    private void displayMediaDetails() {
<span class="nc bnc" id="L734" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8844)) {</span>
<span class="nc" id="L735">            setTextFields(media);</span>
        }
<span class="nc bnc" id="L737" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8845)) {</span>
<span class="nc" id="L738">            compositeDisposable.addAll(mediaDataExtractor.refresh(media).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::onMediaRefreshed, Timber::e), mediaDataExtractor.getCurrentWikiText(Objects.requireNonNull(media.getFilename())).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::updateCategoryList, Timber::e), mediaDataExtractor.checkDeletionRequestExists(media).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::onDeletionPageExists, Timber::e), mediaDataExtractor.fetchDiscussion(media).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::onDiscussionLoaded, Timber::e));</span>
        }
<span class="nc" id="L740">    }</span>

    private void onMediaRefreshed(Media media) {
<span class="nc bnc" id="L743" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8846)) {</span>
<span class="nc" id="L744">            media.setCategories(this.media.getCategories());</span>
        }
<span class="nc bnc" id="L746" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8847)) {</span>
<span class="nc" id="L747">            this.media = media;</span>
        }
<span class="nc bnc" id="L749" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8848)) {</span>
<span class="nc" id="L750">            setTextFields(media);</span>
        }
<span class="nc bnc" id="L752" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8849)) {</span>
<span class="nc" id="L753">            compositeDisposable.addAll(mediaDataExtractor.fetchDepictionIdsAndLabels(media).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::onDepictionsLoaded, Timber::e));</span>
        }
<span class="nc" id="L755">    }</span>

    private void onDiscussionLoaded(String discussion) {
<span class="nc bnc" id="L758" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8850)) {</span>
<span class="nc" id="L759">            mediaDiscussion.setText(prettyDiscussion(discussion.trim()));</span>
        }
<span class="nc" id="L761">    }</span>

    private void onDeletionPageExists(Boolean deletionPageExists) {
<span class="nc bnc" id="L764" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8858)) {</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">            if (deletionPageExists) {</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8855)) {</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">                    if (applicationKvStore.getBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), false)) {</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8853)) {</span>
<span class="nc" id="L769">                            applicationKvStore.remove(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()));</span>
                        }
<span class="nc bnc" id="L771" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8854)) {</span>
<span class="nc" id="L772">                            progressBarDeletion.setVisibility(GONE);</span>
                        }
                    }
                }
<span class="nc bnc" id="L776" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8856)) {</span>
<span class="nc" id="L777">                    delete.setVisibility(GONE);</span>
                }
<span class="nc bnc" id="L779" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8857)) {</span>
<span class="nc" id="L780">                    nominatedForDeletion.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L782" title="All 2 branches missed.">            } else if (!isCategoryImage) {</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8851)) {</span>
<span class="nc" id="L784">                    delete.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L786" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8852)) {</span>
<span class="nc" id="L787">                    nominatedForDeletion.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc" id="L791">    }</span>

    private void onDepictionsLoaded(List&lt;IdAndCaptions&gt; idAndCaptions) {
<span class="nc bnc" id="L794" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8859)) {</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">            depictsLayout.setVisibility(idAndCaptions.isEmpty() ? GONE : VISIBLE);</span>
        }
<span class="nc bnc" id="L797" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8860)) {</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">            depictEditButton.setVisibility(idAndCaptions.isEmpty() ? GONE : VISIBLE);</span>
        }
<span class="nc bnc" id="L800" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8861)) {</span>
<span class="nc" id="L801">            buildDepictionList(idAndCaptions);</span>
        }
<span class="nc" id="L803">    }</span>

    /**
     * By clicking on the edit depictions button, it will send user to depict fragment
     */
    @OnClick(R.id.depictionsEditButton)
    public void onDepictionsEditButtonClicked() {
<span class="nc bnc" id="L810" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8862)) {</span>
<span class="nc" id="L811">            depictionContainer.removeAllViews();</span>
        }
<span class="nc bnc" id="L813" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8863)) {</span>
<span class="nc" id="L814">            depictEditButton.setVisibility(GONE);</span>
        }
<span class="nc" id="L816">        final Fragment depictsFragment = new DepictsFragment();</span>
<span class="nc" id="L817">        final Bundle bundle = new Bundle();</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8864)) {</span>
<span class="nc" id="L819">            bundle.putParcelable(&quot;Existing_Depicts&quot;, media);</span>
        }
<span class="nc bnc" id="L821" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8865)) {</span>
<span class="nc" id="L822">            depictsFragment.setArguments(bundle);</span>
        }
<span class="nc" id="L824">        final FragmentTransaction transaction = getChildFragmentManager().beginTransaction();</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8866)) {</span>
<span class="nc" id="L826">            transaction.replace(R.id.mediaDetailFrameLayout, depictsFragment);</span>
        }
<span class="nc bnc" id="L828" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8867)) {</span>
<span class="nc" id="L829">            transaction.addToBackStack(null);</span>
        }
<span class="nc bnc" id="L831" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8868)) {</span>
<span class="nc" id="L832">            transaction.commit();</span>
        }
<span class="nc" id="L834">    }</span>

    /**
     * The imageSpacer is Basically a transparent overlay for the SimpleDraweeView
     * which holds the image to be displayed( moreover this image is out of
     * the scroll view )
     *
     * If the image is sufficiently large i.e. the image height extends the view height, we reduce
     * the height and change the width to maintain the aspect ratio, otherwise image takes up the
     * total possible width and height is adjusted accordingly.
     *
     * @param scrollWidth the current width of the scrollView
     */
    private void updateAspectRatio(int scrollWidth) {
<span class="nc bnc" id="L848" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8906)) {</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">            if (imageInfoCache != null) {</span>
<span class="nc bnc" id="L850" title="All 48 branches missed.">                int finalHeight = (ListenerUtil.mutListener.listen(8876) ? (((ListenerUtil.mutListener.listen(8872) ? (scrollWidth % imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8871) ? (scrollWidth / imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8870) ? (scrollWidth - imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8869) ? (scrollWidth + imageInfoCache.getHeight()) : (scrollWidth * imageInfoCache.getHeight())))))) % imageInfoCache.getWidth()) : (ListenerUtil.mutListener.listen(8875) ? (((ListenerUtil.mutListener.listen(8872) ? (scrollWidth % imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8871) ? (scrollWidth / imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8870) ? (scrollWidth - imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8869) ? (scrollWidth + imageInfoCache.getHeight()) : (scrollWidth * imageInfoCache.getHeight())))))) * imageInfoCache.getWidth()) : (ListenerUtil.mutListener.listen(8874) ? (((ListenerUtil.mutListener.listen(8872) ? (scrollWidth % imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8871) ? (scrollWidth / imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8870) ? (scrollWidth - imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8869) ? (scrollWidth + imageInfoCache.getHeight()) : (scrollWidth * imageInfoCache.getHeight())))))) - imageInfoCache.getWidth()) : (ListenerUtil.mutListener.listen(8873) ? (((ListenerUtil.mutListener.listen(8872) ? (scrollWidth % imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8871) ? (scrollWidth / imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8870) ? (scrollWidth - imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8869) ? (scrollWidth + imageInfoCache.getHeight()) : (scrollWidth * imageInfoCache.getHeight())))))) + imageInfoCache.getWidth()) : (((ListenerUtil.mutListener.listen(8872) ? (scrollWidth % imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8871) ? (scrollWidth / imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8870) ? (scrollWidth - imageInfoCache.getHeight()) : (ListenerUtil.mutListener.listen(8869) ? (scrollWidth + imageInfoCache.getHeight()) : (scrollWidth * imageInfoCache.getHeight())))))) / imageInfoCache.getWidth())))));</span>
<span class="nc" id="L851">                ViewGroup.LayoutParams params = image.getLayoutParams();</span>
<span class="nc" id="L852">                ViewGroup.LayoutParams spacerParams = imageSpacer.getLayoutParams();</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8877)) {</span>
<span class="nc" id="L854">                    params.width = scrollWidth;</span>
                }
<span class="nc bnc" id="L856" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8901)) {</span>
<span class="nc bnc" id="L857" title="All 70 branches missed.">                    if ((ListenerUtil.mutListener.listen(8886) ? (finalHeight &gt;= (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))) : (ListenerUtil.mutListener.listen(8885) ? (finalHeight &lt;= (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))) : (ListenerUtil.mutListener.listen(8884) ? (finalHeight &lt; (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))) : (ListenerUtil.mutListener.listen(8883) ? (finalHeight != (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))) : (ListenerUtil.mutListener.listen(8882) ? (finalHeight == (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))) : (finalHeight &gt; (ListenerUtil.mutListener.listen(8881) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8880) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8879) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8878) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))))))))))) {</span>
                        // Adjust the height and width of image.
<span class="nc bnc" id="L859" title="All 8 branches missed.">                        int temp = (ListenerUtil.mutListener.listen(8890) ? (frameLayoutHeight % minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8889) ? (frameLayoutHeight / minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8888) ? (frameLayoutHeight * minimumHeightOfMetadata) : (ListenerUtil.mutListener.listen(8887) ? (frameLayoutHeight + minimumHeightOfMetadata) : (frameLayoutHeight - minimumHeightOfMetadata)))));</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8899)) {</span>
<span class="nc bnc" id="L861" title="All 48 branches missed.">                            params.width = (ListenerUtil.mutListener.listen(8898) ? (((ListenerUtil.mutListener.listen(8894) ? (scrollWidth % temp) : (ListenerUtil.mutListener.listen(8893) ? (scrollWidth / temp) : (ListenerUtil.mutListener.listen(8892) ? (scrollWidth - temp) : (ListenerUtil.mutListener.listen(8891) ? (scrollWidth + temp) : (scrollWidth * temp)))))) % finalHeight) : (ListenerUtil.mutListener.listen(8897) ? (((ListenerUtil.mutListener.listen(8894) ? (scrollWidth % temp) : (ListenerUtil.mutListener.listen(8893) ? (scrollWidth / temp) : (ListenerUtil.mutListener.listen(8892) ? (scrollWidth - temp) : (ListenerUtil.mutListener.listen(8891) ? (scrollWidth + temp) : (scrollWidth * temp)))))) * finalHeight) : (ListenerUtil.mutListener.listen(8896) ? (((ListenerUtil.mutListener.listen(8894) ? (scrollWidth % temp) : (ListenerUtil.mutListener.listen(8893) ? (scrollWidth / temp) : (ListenerUtil.mutListener.listen(8892) ? (scrollWidth - temp) : (ListenerUtil.mutListener.listen(8891) ? (scrollWidth + temp) : (scrollWidth * temp)))))) - finalHeight) : (ListenerUtil.mutListener.listen(8895) ? (((ListenerUtil.mutListener.listen(8894) ? (scrollWidth % temp) : (ListenerUtil.mutListener.listen(8893) ? (scrollWidth / temp) : (ListenerUtil.mutListener.listen(8892) ? (scrollWidth - temp) : (ListenerUtil.mutListener.listen(8891) ? (scrollWidth + temp) : (scrollWidth * temp)))))) + finalHeight) : (((ListenerUtil.mutListener.listen(8894) ? (scrollWidth % temp) : (ListenerUtil.mutListener.listen(8893) ? (scrollWidth / temp) : (ListenerUtil.mutListener.listen(8892) ? (scrollWidth - temp) : (ListenerUtil.mutListener.listen(8891) ? (scrollWidth + temp) : (scrollWidth * temp)))))) / finalHeight)))));</span>
                        }
<span class="nc bnc" id="L863" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8900)) {</span>
<span class="nc" id="L864">                            finalHeight = temp;</span>
                        }
                    }
                }
<span class="nc bnc" id="L868" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8902)) {</span>
<span class="nc" id="L869">                    params.height = finalHeight;</span>
                }
<span class="nc bnc" id="L871" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8903)) {</span>
<span class="nc" id="L872">                    spacerParams.height = finalHeight;</span>
                }
<span class="nc bnc" id="L874" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8904)) {</span>
<span class="nc" id="L875">                    image.setLayoutParams(params);</span>
                }
<span class="nc bnc" id="L877" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8905)) {</span>
<span class="nc" id="L878">                    imageSpacer.setLayoutParams(spacerParams);</span>
                }
            }
        }
<span class="nc" id="L882">    }</span>

<span class="nc" id="L884">    private final ControllerListener aspectRatioListener = new BaseControllerListener&lt;ImageInfo&gt;() {</span>

        @Override
        public void onIntermediateImageSet(String id, @Nullable ImageInfo imageInfo) {
<span class="nc bnc" id="L888" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8907)) {</span>
<span class="nc" id="L889">                imageInfoCache = imageInfo;</span>
            }
<span class="nc bnc" id="L891" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8908)) {</span>
<span class="nc" id="L892">                updateAspectRatio(scrollView.getWidth());</span>
            }
<span class="nc" id="L894">        }</span>

        @Override
        public void onFinalImageSet(String id, @Nullable ImageInfo imageInfo, @Nullable Animatable animatable) {
<span class="nc bnc" id="L898" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8909)) {</span>
<span class="nc" id="L899">                imageInfoCache = imageInfo;</span>
            }
<span class="nc bnc" id="L901" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8910)) {</span>
<span class="nc" id="L902">                updateAspectRatio(scrollView.getWidth());</span>
            }
<span class="nc" id="L904">        }</span>
    };

    /**
     * Uses two image sources.
     * - low resolution thumbnail is shown initially
     * - when the high resolution image is available, it replaces the low resolution image
     */
    private void setupImageView() {
<span class="nc" id="L913">        int imageBackgroundColor = getImageBackgroundColor();</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8917)) {</span>
<span class="nc bnc" id="L915" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8915) ? (imageBackgroundColor &gt;= DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8914) ? (imageBackgroundColor &lt;= DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8913) ? (imageBackgroundColor &gt; DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8912) ? (imageBackgroundColor &lt; DEFAULT_IMAGE_BACKGROUND_COLOR) : (ListenerUtil.mutListener.listen(8911) ? (imageBackgroundColor == DEFAULT_IMAGE_BACKGROUND_COLOR) : (imageBackgroundColor != DEFAULT_IMAGE_BACKGROUND_COLOR))))))) {</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8916)) {</span>
<span class="nc" id="L917">                    image.setBackgroundColor(imageBackgroundColor);</span>
                }
            }
        }
<span class="nc bnc" id="L921" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8918)) {</span>
<span class="nc" id="L922">            image.getHierarchy().setPlaceholderImage(R.drawable.image_placeholder);</span>
        }
<span class="nc bnc" id="L924" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8919)) {</span>
<span class="nc" id="L925">            image.getHierarchy().setFailureImage(R.drawable.image_placeholder);</span>
        }
<span class="nc bnc" id="L927" title="All 4 branches missed.">        DraweeController controller = Fresco.newDraweeControllerBuilder().setLowResImageRequest(ImageRequest.fromUri(media != null ? media.getThumbUrl() : null)).setRetainImageOnFailure(true).setImageRequest(ImageRequest.fromUri(media != null ? media.getImageUrl() : null)).setControllerListener(aspectRatioListener).setOldController(image.getController()).build();</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8920)) {</span>
<span class="nc" id="L929">            image.setController(controller);</span>
        }
<span class="nc" id="L931">    }</span>

    private void updateToDoWarning() {
<span class="nc" id="L934">        String toDoMessage = &quot;&quot;;</span>
<span class="nc" id="L935">        boolean toDoNeeded = false;</span>
<span class="nc bnc" id="L936" title="All 4 branches missed.">        boolean categoriesPresent = media.getCategories() == null ? false : (media.getCategories().size() == 0 ? false : true);</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8925)) {</span>
            // Check if the presented category is about need of category
<span class="nc bnc" id="L939" title="All 2 branches missed.">            if (categoriesPresent) {</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8924)) {</span>
                    {
<span class="nc" id="L942">                        long _loopCounter146 = 0;</span>
<span class="nc bnc" id="L943" title="All 2 branches missed.">                        for (String category : media.getCategories()) {</span>
<span class="nc" id="L944">                            ListenerUtil.loopListener.listen(&quot;_loopCounter146&quot;, ++_loopCounter146);</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8923)) {</span>
<span class="nc bnc" id="L946" title="All 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(8921) ? (category.toLowerCase().contains(CATEGORY_NEEDING_CATEGORIES) &amp;&amp; category.toLowerCase().contains(CATEGORY_UNCATEGORISED)) : (category.toLowerCase().contains(CATEGORY_NEEDING_CATEGORIES) || category.toLowerCase().contains(CATEGORY_UNCATEGORISED)))) {</span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(8922)) {</span>
<span class="nc" id="L948">                                        categoriesPresent = false;</span>
                                    }
                                }
                            }
                            break;
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L958" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8928)) {</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">            if (!categoriesPresent) {</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8926)) {</span>
<span class="nc" id="L961">                    toDoNeeded = true;</span>
                }
<span class="nc bnc" id="L963" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8927)) {</span>
<span class="nc" id="L964">                    toDoMessage += getString(R.string.missing_category);</span>
                }
            }
        }
<span class="nc bnc" id="L968" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8931)) {</span>
<span class="nc bnc" id="L969" title="All 2 branches missed.">            if (isWikipediaButtonDisplayed) {</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8929)) {</span>
<span class="nc" id="L971">                    toDoNeeded = true;</span>
                }
<span class="nc bnc" id="L973" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8930)) {</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">                    toDoMessage += (toDoMessage.isEmpty()) ? &quot;&quot; : &quot;\n&quot; + getString(R.string.missing_article);</span>
                }
            }
        }
<span class="nc bnc" id="L978" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8936)) {</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">            if (toDoNeeded) {</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8933)) {</span>
<span class="nc" id="L981">                    toDoMessage = getString(R.string.todo_improve) + &quot;\n&quot; + toDoMessage;</span>
                }
<span class="nc bnc" id="L983" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8934)) {</span>
<span class="nc" id="L984">                    toDoLayout.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L986" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8935)) {</span>
<span class="nc" id="L987">                    toDoReason.setText(toDoMessage);</span>
                }
            } else {
<span class="nc bnc" id="L990" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8932)) {</span>
<span class="nc" id="L991">                    toDoLayout.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc" id="L995">    }</span>

    @Override
    public void onDestroyView() {
<span class="nc bnc" id="L999" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8940)) {</span>
<span class="nc bnc" id="L1000" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8937) ? (layoutListener != null || getView() != null) : (layoutListener != null &amp;&amp; getView() != null))) {</span>
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8938)) {</span>
                    // old Android was on crack. CRACK IS WHACK
<span class="nc" id="L1003">                    getView().getViewTreeObserver().removeGlobalOnLayoutListener(layoutListener);</span>
                }
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8939)) {</span>
<span class="nc" id="L1006">                    layoutListener = null;</span>
                }
            }
        }
<span class="nc bnc" id="L1010" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8941)) {</span>
<span class="nc" id="L1011">            compositeDisposable.clear();</span>
        }
<span class="nc bnc" id="L1013" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8942)) {</span>
<span class="nc" id="L1014">            super.onDestroyView();</span>
        }
<span class="nc" id="L1016">    }</span>

    private void setTextFields(Media media) {
<span class="nc bnc" id="L1019" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8943)) {</span>
<span class="nc" id="L1020">            setupImageView();</span>
        }
<span class="nc bnc" id="L1022" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8944)) {</span>
<span class="nc" id="L1023">            title.setText(media.getDisplayTitle());</span>
        }
<span class="nc bnc" id="L1025" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8945)) {</span>
<span class="nc" id="L1026">            desc.setHtmlText(prettyDescription(media));</span>
        }
<span class="nc bnc" id="L1028" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8946)) {</span>
<span class="nc" id="L1029">            license.setText(prettyLicense(media));</span>
        }
<span class="nc bnc" id="L1031" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8947)) {</span>
<span class="nc" id="L1032">            coordinates.setText(prettyCoordinates(media));</span>
        }
<span class="nc bnc" id="L1034" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8948)) {</span>
<span class="nc" id="L1035">            uploadedDate.setText(prettyUploadedDate(media));</span>
        }
<span class="nc bnc" id="L1037" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8951)) {</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">            if (prettyCaption(media).equals(getContext().getString(R.string.detail_caption_empty))) {</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8950)) {</span>
<span class="nc" id="L1040">                    captionLayout.setVisibility(GONE);</span>
                }
            } else {
<span class="nc bnc" id="L1043" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8949)) {</span>
<span class="nc" id="L1044">                    mediaCaption.setText(prettyCaption(media));</span>
                }
            }
        }
<span class="nc bnc" id="L1048" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8952)) {</span>
<span class="nc" id="L1049">            categoryNames.clear();</span>
        }
<span class="nc bnc" id="L1051" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8953)) {</span>
<span class="nc" id="L1052">            categoryNames.addAll(media.getCategories());</span>
        }
<span class="nc bnc" id="L1054" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8957)) {</span>
<span class="nc bnc" id="L1055" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8954) ? (media.getAuthor() == null &amp;&amp; media.getAuthor().equals(&quot;&quot;)) : (media.getAuthor() == null || media.getAuthor().equals(&quot;&quot;)))) {</span>
<span class="nc bnc" id="L1056" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8956)) {</span>
<span class="nc" id="L1057">                    authorLayout.setVisibility(GONE);</span>
                }
            } else {
<span class="nc bnc" id="L1060" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8955)) {</span>
<span class="nc" id="L1061">                    author.setText(media.getAuthor());</span>
                }
            }
        }
<span class="nc" id="L1065">    }</span>

    /**
     * Gets new categories from the WikiText and updates it on the UI
     *
     * @param s WikiText
     */
    private void updateCategoryList(final String s) {
<span class="nc" id="L1073">        final List&lt;String&gt; allCategories = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L1074">        int i = s.indexOf(&quot;[[Category:&quot;);</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8970)) {</span>
            {
<span class="nc" id="L1077">                long _loopCounter147 = 0;</span>
<span class="nc bnc" id="L1078" title="All 22 branches missed.">                while ((ListenerUtil.mutListener.listen(8969) ? (i &gt;= -1) : (ListenerUtil.mutListener.listen(8968) ? (i &lt;= -1) : (ListenerUtil.mutListener.listen(8967) ? (i &gt; -1) : (ListenerUtil.mutListener.listen(8966) ? (i &lt; -1) : (ListenerUtil.mutListener.listen(8965) ? (i == -1) : (i != -1))))))) {</span>
<span class="nc" id="L1079">                    ListenerUtil.loopListener.listen(&quot;_loopCounter147&quot;, ++_loopCounter147);</span>
<span class="nc bnc" id="L1080" title="All 8 branches missed.">                    final String category = s.substring((ListenerUtil.mutListener.listen(8961) ? (i % 11) : (ListenerUtil.mutListener.listen(8960) ? (i / 11) : (ListenerUtil.mutListener.listen(8959) ? (i * 11) : (ListenerUtil.mutListener.listen(8958) ? (i - 11) : (i + 11))))), s.indexOf(&quot;]]&quot;, i));</span>
<span class="nc bnc" id="L1081" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8962)) {</span>
<span class="nc" id="L1082">                        allCategories.add(category);</span>
                    }
<span class="nc bnc" id="L1084" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8963)) {</span>
<span class="nc" id="L1085">                        i = s.indexOf(&quot;]]&quot;, i);</span>
                    }
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8964)) {</span>
<span class="nc" id="L1088">                        i = s.indexOf(&quot;[[Category:&quot;, i);</span>
                    }
<span class="nc" id="L1090">                }</span>
            }
        }
<span class="nc bnc" id="L1093" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8971)) {</span>
<span class="nc" id="L1094">            media.setCategories(allCategories);</span>
        }
<span class="nc bnc" id="L1096" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8973)) {</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">            if (allCategories.isEmpty()) {</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8972)) {</span>
                    // Stick in a filler element.
<span class="nc" id="L1100">                    allCategories.add(getString(R.string.detail_panel_cats_none));</span>
                }
            }
        }
<span class="nc bnc" id="L1104" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8974)) {</span>
<span class="nc" id="L1105">            categoryEditButton.setVisibility(VISIBLE);</span>
        }
<span class="nc bnc" id="L1107" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8975)) {</span>
<span class="nc" id="L1108">            rebuildCatList(allCategories);</span>
        }
<span class="nc" id="L1110">    }</span>

    /**
     * Updates the categories
     */
    public void updateCategories() {
<span class="nc" id="L1116">        List&lt;String&gt; allCategories = new ArrayList&lt;String&gt;(media.getAddedCategories());</span>
<span class="nc bnc" id="L1117" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8976)) {</span>
<span class="nc" id="L1118">            media.setCategories(allCategories);</span>
        }
<span class="nc bnc" id="L1120" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8978)) {</span>
<span class="nc bnc" id="L1121" title="All 2 branches missed.">            if (allCategories.isEmpty()) {</span>
<span class="nc bnc" id="L1122" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8977)) {</span>
                    // Stick in a filler element.
<span class="nc" id="L1124">                    allCategories.add(getString(R.string.detail_panel_cats_none));</span>
                }
            }
        }
<span class="nc bnc" id="L1128" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8979)) {</span>
<span class="nc" id="L1129">            rebuildCatList(allCategories);</span>
        }
<span class="nc" id="L1131">    }</span>

    /**
     * Populates media details fragment with depiction list
     * @param idAndCaptions
     */
    private void buildDepictionList(List&lt;IdAndCaptions&gt; idAndCaptions) {
<span class="nc bnc" id="L1138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8980)) {</span>
<span class="nc" id="L1139">            depictionContainer.removeAllViews();</span>
        }
<span class="nc" id="L1141">        String locale = Locale.getDefault().getLanguage();</span>
<span class="nc bnc" id="L1142" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8982)) {</span>
            {
<span class="nc" id="L1144">                long _loopCounter148 = 0;</span>
<span class="nc bnc" id="L1145" title="All 2 branches missed.">                for (IdAndCaptions idAndCaption : idAndCaptions) {</span>
<span class="nc" id="L1146">                    ListenerUtil.loopListener.listen(&quot;_loopCounter148&quot;, ++_loopCounter148);</span>
<span class="nc bnc" id="L1147" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8981)) {</span>
<span class="nc" id="L1148">                        depictionContainer.addView(buildDepictLabel(getDepictionCaption(idAndCaption, locale), idAndCaption.getId(), depictionContainer));</span>
                    }
<span class="nc" id="L1150">                }</span>
            }
        }
<span class="nc" id="L1153">    }</span>

    private String getDepictionCaption(IdAndCaptions idAndCaption, String locale) {
<span class="nc bnc" id="L1156" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8983)) {</span>
            // Check if the Depiction Caption is available in user's locale if not then check for english, else show any available.
<span class="nc bnc" id="L1158" title="All 2 branches missed.">            if (idAndCaption.getCaptions().get(locale) != null) {</span>
<span class="nc" id="L1159">                return idAndCaption.getCaptions().get(locale);</span>
            }
        }
<span class="nc bnc" id="L1162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8984)) {</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">            if (idAndCaption.getCaptions().get(&quot;en&quot;) != null) {</span>
<span class="nc" id="L1164">                return idAndCaption.getCaptions().get(&quot;en&quot;);</span>
            }
        }
<span class="nc" id="L1167">        return idAndCaption.getCaptions().values().iterator().next();</span>
    }

    @OnClick(R.id.mediaDetailLicense)
    public void onMediaDetailLicenceClicked() {
<span class="nc" id="L1172">        String url = media.getLicenseUrl();</span>
<span class="nc bnc" id="L1173" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8988)) {</span>
<span class="nc bnc" id="L1174" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8985) ? (!StringUtils.isBlank(url) || getActivity() != null) : (!StringUtils.isBlank(url) &amp;&amp; getActivity() != null))) {</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8987)) {</span>
<span class="nc" id="L1176">                    Utils.handleWebUrl(getActivity(), Uri.parse(url));</span>
                }
            } else {
<span class="nc bnc" id="L1179" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8986)) {</span>
<span class="nc" id="L1180">                    viewUtil.showShortToast(getActivity(), getString(R.string.null_url));</span>
                }
            }
        }
<span class="nc" id="L1184">    }</span>

    @OnClick(R.id.mediaDetailCoordinates)
    public void onMediaDetailCoordinatesClicked() {
<span class="nc bnc" id="L1188" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8991)) {</span>
<span class="nc bnc" id="L1189" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8989) ? (media.getCoordinates() != null || getActivity() != null) : (media.getCoordinates() != null &amp;&amp; getActivity() != null))) {</span>
<span class="nc bnc" id="L1190" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8990)) {</span>
<span class="nc" id="L1191">                    Utils.handleGeoCoordinates(getActivity(), media.getCoordinates());</span>
                }
            }
        }
<span class="nc" id="L1195">    }</span>

    @OnClick(R.id.copyWikicode)
    public void onCopyWikicodeClicked() {
<span class="nc" id="L1199">        String data = &quot;[[&quot; + media.getFilename() + &quot;|thumb|&quot; + media.getFallbackDescription() + &quot;]]&quot;;</span>
<span class="nc bnc" id="L1200" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8992)) {</span>
<span class="nc" id="L1201">            Utils.copy(&quot;wikiCode&quot;, data, getContext());</span>
        }
<span class="nc bnc" id="L1203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8993)) {</span>
<span class="nc" id="L1204">            Timber.d(&quot;Generated wikidata copy code: %s&quot;, data);</span>
        }
<span class="nc bnc" id="L1206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8994)) {</span>
<span class="nc" id="L1207">            Toast.makeText(getContext(), getString(R.string.wikicode_copied), Toast.LENGTH_SHORT).show();</span>
        }
<span class="nc" id="L1209">    }</span>

    /**
     * Sends thanks to author if the author is not the user
     */
    @OnClick(R.id.sendThanks)
    public void sendThanksToAuthor() {
<span class="nc" id="L1216">        String fileName = media.getFilename();</span>
<span class="nc bnc" id="L1217" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8996)) {</span>
<span class="nc bnc" id="L1218" title="All 2 branches missed.">            if (TextUtils.isEmpty(fileName)) {</span>
<span class="nc bnc" id="L1219" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8995)) {</span>
<span class="nc" id="L1220">                    Toast.makeText(getContext(), getString(R.string.error_sending_thanks), Toast.LENGTH_SHORT).show();</span>
                }
<span class="nc" id="L1222">                return;</span>
            }
        }
<span class="nc bnc" id="L1225" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8997)) {</span>
<span class="nc" id="L1226">            compositeDisposable.add(reviewHelper.getFirstRevisionOfFile(fileName).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(revision -&gt; sendThanks(getContext(), revision)));</span>
        }
<span class="nc" id="L1228">    }</span>

    /**
     * Api call for sending thanks to the author when the author is not the user
     * and display toast depending on the result
     * @param context context
     * @param firstRevision the revision id of the image
     */
    @SuppressLint({ &quot;CheckResult&quot;, &quot;StringFormatInvalid&quot; })
    void sendThanks(Context context, MwQueryPage.Revision firstRevision) {
<span class="nc bnc" id="L1238" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8998)) {</span>
<span class="nc" id="L1239">            ViewUtil.showShortToast(context, context.getString(R.string.send_thank_toast, media.getDisplayTitle()));</span>
        }
<span class="nc bnc" id="L1241" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8999)) {</span>
<span class="nc bnc" id="L1242" title="All 2 branches missed.">            if (firstRevision == null) {</span>
<span class="nc" id="L1243">                return;</span>
            }
        }
<span class="nc bnc" id="L1246" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9000)) {</span>
<span class="nc" id="L1247">            Observable.defer((Callable&lt;ObservableSource&lt;Boolean&gt;&gt;) () -&gt; thanksClient.thank(firstRevision.getRevisionId())).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe((result) -&gt; {</span>
<span class="nc" id="L1248">                displayThanksToast(context, result);</span>
<span class="nc" id="L1249">            }, Timber::e);</span>
        }
<span class="nc" id="L1251">    }</span>

    /**
     * Method to display toast when api call to thank the author is completed
     * @param context context
     * @param result true if success, false otherwise
     */
    @SuppressLint(&quot;StringFormatInvalid&quot;)
    private void displayThanksToast(final Context context, final boolean result) {
        final String message;
        final String title;
<span class="nc bnc" id="L1262" title="All 2 branches missed.">        if (result) {</span>
<span class="nc" id="L1263">            title = context.getString(R.string.send_thank_success_title);</span>
<span class="nc" id="L1264">            message = context.getString(R.string.send_thank_success_message, media.getDisplayTitle());</span>
        } else {
<span class="nc" id="L1266">            title = context.getString(R.string.send_thank_failure_title);</span>
<span class="nc" id="L1267">            message = context.getString(R.string.send_thank_failure_message, media.getDisplayTitle());</span>
        }
<span class="nc bnc" id="L1269" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9001)) {</span>
<span class="nc" id="L1270">            ViewUtil.showShortToast(context, message);</span>
        }
<span class="nc" id="L1272">    }</span>

    @OnClick(R.id.categoryEditButton)
    public void onCategoryEditButtonClicked() {
<span class="nc bnc" id="L1276" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9002)) {</span>
<span class="nc" id="L1277">            progressBarEditCategory.setVisibility(VISIBLE);</span>
        }
<span class="nc bnc" id="L1279" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9003)) {</span>
<span class="nc" id="L1280">            categoryEditButton.setVisibility(GONE);</span>
        }
<span class="nc bnc" id="L1282" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9004)) {</span>
<span class="nc" id="L1283">            getWikiText();</span>
        }
<span class="nc" id="L1285">    }</span>

    /**
     * Gets WikiText from the server and send it to catgory editor
     */
    private void getWikiText() {
<span class="nc bnc" id="L1291" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9005)) {</span>
<span class="nc" id="L1292">            compositeDisposable.add(mediaDataExtractor.getCurrentWikiText(Objects.requireNonNull(media.getFilename())).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::gotoCategoryEditor, Timber::e));</span>
        }
<span class="nc" id="L1294">    }</span>

    /**
     * Opens the category editor
     *
     * @param s WikiText
     */
    private void gotoCategoryEditor(final String s) {
<span class="nc bnc" id="L1302" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9006)) {</span>
<span class="nc" id="L1303">            categoryEditButton.setVisibility(VISIBLE);</span>
        }
<span class="nc bnc" id="L1305" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9007)) {</span>
<span class="nc" id="L1306">            progressBarEditCategory.setVisibility(GONE);</span>
        }
<span class="nc" id="L1308">        final Fragment categoriesFragment = new UploadCategoriesFragment();</span>
<span class="nc" id="L1309">        final Bundle bundle = new Bundle();</span>
<span class="nc bnc" id="L1310" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9008)) {</span>
<span class="nc" id="L1311">            bundle.putParcelable(&quot;Existing_Categories&quot;, media);</span>
        }
<span class="nc bnc" id="L1313" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9009)) {</span>
<span class="nc" id="L1314">            bundle.putString(&quot;WikiText&quot;, s);</span>
        }
<span class="nc bnc" id="L1316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9010)) {</span>
<span class="nc" id="L1317">            categoriesFragment.setArguments(bundle);</span>
        }
<span class="nc" id="L1319">        final FragmentTransaction transaction = getChildFragmentManager().beginTransaction();</span>
<span class="nc bnc" id="L1320" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9011)) {</span>
<span class="nc" id="L1321">            transaction.replace(R.id.mediaDetailFrameLayout, categoriesFragment);</span>
        }
<span class="nc bnc" id="L1323" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9012)) {</span>
<span class="nc" id="L1324">            transaction.addToBackStack(null);</span>
        }
<span class="nc bnc" id="L1326" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9013)) {</span>
<span class="nc" id="L1327">            transaction.commit();</span>
        }
<span class="nc" id="L1329">    }</span>

    @OnClick(R.id.coordinate_edit)
    public void onUpdateCoordinatesClicked() {
<span class="nc bnc" id="L1333" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9014)) {</span>
<span class="nc" id="L1334">            goToLocationPickerActivity();</span>
        }
<span class="nc" id="L1336">    }</span>

    /**
     * Start location picker activity with a request code and get the coordinates from the activity.
     */
    private void goToLocationPickerActivity() {
        /*
        If location is not provided in media this coordinates will act as a placeholder in
        location picker activity
         */
<span class="nc" id="L1346">        double defaultLatitude = 37.773972;</span>
<span class="nc" id="L1347">        double defaultLongitude = -122.431297;</span>
<span class="nc bnc" id="L1348" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9022)) {</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">            if (media.getCoordinates() != null) {</span>
<span class="nc bnc" id="L1350" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9020)) {</span>
<span class="nc" id="L1351">                    defaultLatitude = media.getCoordinates().getLatitude();</span>
                }
<span class="nc bnc" id="L1353" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9021)) {</span>
<span class="nc" id="L1354">                    defaultLongitude = media.getCoordinates().getLongitude();</span>
                }
            } else {
<span class="nc bnc" id="L1357" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9019)) {</span>
<span class="nc bnc" id="L1358" title="All 2 branches missed.">                    if (locationManager.getLastLocation() != null) {</span>
<span class="nc bnc" id="L1359" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9017)) {</span>
<span class="nc" id="L1360">                            defaultLatitude = locationManager.getLastLocation().getLatitude();</span>
                        }
<span class="nc bnc" id="L1362" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9018)) {</span>
<span class="nc" id="L1363">                            defaultLongitude = locationManager.getLastLocation().getLongitude();</span>
                        }
                    } else {
<span class="nc" id="L1366">                        String[] lastLocation = applicationKvStore.getString(LAST_LOCATION, (defaultLatitude + &quot;,&quot; + defaultLongitude)).split(&quot;,&quot;);</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9015)) {</span>
<span class="nc" id="L1368">                            defaultLatitude = Double.parseDouble(lastLocation[0]);</span>
                        }
<span class="nc bnc" id="L1370" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9016)) {</span>
<span class="nc" id="L1371">                            defaultLongitude = Double.parseDouble(lastLocation[1]);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1377" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9023)) {</span>
<span class="nc" id="L1378">            startActivityForResult(new LocationPicker.IntentBuilder().defaultLocation(new CameraPosition.Builder().target(new LatLng(defaultLatitude, defaultLongitude)).zoom(16).build()).activityKey(&quot;MediaActivity&quot;).build(getActivity()), REQUEST_CODE);</span>
        }
<span class="nc" id="L1380">    }</span>

    @OnClick(R.id.description_edit)
    public void onDescriptionEditClicked() {
<span class="nc bnc" id="L1384" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9024)) {</span>
<span class="nc" id="L1385">            progressBarEditDescription.setVisibility(VISIBLE);</span>
        }
<span class="nc bnc" id="L1387" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9025)) {</span>
<span class="nc" id="L1388">            editDescription.setVisibility(GONE);</span>
        }
<span class="nc bnc" id="L1390" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9026)) {</span>
<span class="nc" id="L1391">            getDescriptionList();</span>
        }
<span class="nc" id="L1393">    }</span>

    /**
     * Gets descriptions from wikitext
     */
    private void getDescriptionList() {
<span class="nc bnc" id="L1399" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9027)) {</span>
<span class="nc" id="L1400">            compositeDisposable.add(mediaDataExtractor.getCurrentWikiText(Objects.requireNonNull(media.getFilename())).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::extractCaptionDescription, Timber::e));</span>
        }
<span class="nc" id="L1402">    }</span>

    /**
     * Gets captions and descriptions and merge them according to language code and arranges it in a
     * single list.
     * Send the list to DescriptionEditActivity
     * @param s wikitext
     */
    private void extractCaptionDescription(final String s) {
<span class="nc" id="L1411">        final LinkedHashMap&lt;String, String&gt; descriptions = getDescriptions(s);</span>
<span class="nc" id="L1412">        final LinkedHashMap&lt;String, String&gt; captions = getCaptionsList();</span>
<span class="nc" id="L1413">        final ArrayList&lt;UploadMediaDetail&gt; descriptionAndCaptions = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1414" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9047)) {</span>
<span class="nc bnc" id="L1415" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9032) ? (captions.size() &lt;= descriptions.size()) : (ListenerUtil.mutListener.listen(9031) ? (captions.size() &gt; descriptions.size()) : (ListenerUtil.mutListener.listen(9030) ? (captions.size() &lt; descriptions.size()) : (ListenerUtil.mutListener.listen(9029) ? (captions.size() != descriptions.size()) : (ListenerUtil.mutListener.listen(9028) ? (captions.size() == descriptions.size()) : (captions.size() &gt;= descriptions.size()))))))) {</span>
<span class="nc bnc" id="L1416" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9043)) {</span>
                    {
<span class="nc" id="L1418">                        long _loopCounter151 = 0;</span>
<span class="nc bnc" id="L1419" title="All 2 branches missed.">                        for (final Map.Entry mapElement : captions.entrySet()) {</span>
<span class="nc" id="L1420">                            ListenerUtil.loopListener.listen(&quot;_loopCounter151&quot;, ++_loopCounter151);</span>
<span class="nc" id="L1421">                            final String language = (String) mapElement.getKey();</span>
<span class="nc bnc" id="L1422" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9042)) {</span>
<span class="nc bnc" id="L1423" title="All 2 branches missed.">                                if (descriptions.containsKey(language)) {</span>
<span class="nc bnc" id="L1424" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9041)) {</span>
<span class="nc" id="L1425">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, Objects.requireNonNull(descriptions.get(language)), (String) mapElement.getValue()));</span>
                                    }
                                } else {
<span class="nc bnc" id="L1428" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9040)) {</span>
<span class="nc" id="L1429">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, &quot;&quot;, (String) mapElement.getValue()));</span>
                                    }
                                }
                            }
<span class="nc" id="L1433">                        }</span>
                    }
                }
<span class="nc bnc" id="L1436" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9046)) {</span>
                    {
<span class="nc" id="L1438">                        long _loopCounter152 = 0;</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">                        for (final Map.Entry mapElement : descriptions.entrySet()) {</span>
<span class="nc" id="L1440">                            ListenerUtil.loopListener.listen(&quot;_loopCounter152&quot;, ++_loopCounter152);</span>
<span class="nc" id="L1441">                            final String language = (String) mapElement.getKey();</span>
<span class="nc bnc" id="L1442" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9045)) {</span>
<span class="nc bnc" id="L1443" title="All 2 branches missed.">                                if (!captions.containsKey(language)) {</span>
<span class="nc bnc" id="L1444" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9044)) {</span>
<span class="nc" id="L1445">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, Objects.requireNonNull(descriptions.get(language)), &quot;&quot;));</span>
                                    }
                                }
                            }
<span class="nc" id="L1449">                        }</span>
<span class="nc" id="L1450">                    }</span>
                }
            } else {
<span class="nc bnc" id="L1453" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9036)) {</span>
                    {
<span class="nc" id="L1455">                        long _loopCounter149 = 0;</span>
<span class="nc bnc" id="L1456" title="All 2 branches missed.">                        for (final Map.Entry mapElement : descriptions.entrySet()) {</span>
<span class="nc" id="L1457">                            ListenerUtil.loopListener.listen(&quot;_loopCounter149&quot;, ++_loopCounter149);</span>
<span class="nc" id="L1458">                            final String language = (String) mapElement.getKey();</span>
<span class="nc bnc" id="L1459" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9035)) {</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">                                if (captions.containsKey(language)) {</span>
<span class="nc bnc" id="L1461" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9034)) {</span>
<span class="nc" id="L1462">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, (String) mapElement.getValue(), Objects.requireNonNull(captions.get(language))));</span>
                                    }
                                } else {
<span class="nc bnc" id="L1465" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9033)) {</span>
<span class="nc" id="L1466">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, (String) mapElement.getValue(), &quot;&quot;));</span>
                                    }
                                }
                            }
<span class="nc" id="L1470">                        }</span>
                    }
                }
<span class="nc bnc" id="L1473" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9039)) {</span>
                    {
<span class="nc" id="L1475">                        long _loopCounter150 = 0;</span>
<span class="nc bnc" id="L1476" title="All 2 branches missed.">                        for (final Map.Entry mapElement : captions.entrySet()) {</span>
<span class="nc" id="L1477">                            ListenerUtil.loopListener.listen(&quot;_loopCounter150&quot;, ++_loopCounter150);</span>
<span class="nc" id="L1478">                            final String language = (String) mapElement.getKey();</span>
<span class="nc bnc" id="L1479" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9038)) {</span>
<span class="nc bnc" id="L1480" title="All 2 branches missed.">                                if (!descriptions.containsKey(language)) {</span>
<span class="nc bnc" id="L1481" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9037)) {</span>
<span class="nc" id="L1482">                                        descriptionAndCaptions.add(new UploadMediaDetail(language, &quot;&quot;, Objects.requireNonNull(descriptions.get(language))));</span>
                                    }
                                }
                            }
<span class="nc" id="L1486">                        }</span>
                    }
                }
            }
        }
<span class="nc" id="L1491">        final Intent intent = new Intent(requireContext(), DescriptionEditActivity.class);</span>
<span class="nc" id="L1492">        final Bundle bundle = new Bundle();</span>
<span class="nc bnc" id="L1493" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9048)) {</span>
<span class="nc" id="L1494">            bundle.putParcelableArrayList(LIST_OF_DESCRIPTION_AND_CAPTION, descriptionAndCaptions);</span>
        }
<span class="nc bnc" id="L1496" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9049)) {</span>
<span class="nc" id="L1497">            bundle.putString(WIKITEXT, s);</span>
        }
<span class="nc bnc" id="L1499" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9050)) {</span>
<span class="nc" id="L1500">            bundle.putString(Prefs.DESCRIPTION_LANGUAGE, applicationKvStore.getString(Prefs.DESCRIPTION_LANGUAGE, &quot;&quot;));</span>
        }
<span class="nc bnc" id="L1502" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9051)) {</span>
<span class="nc" id="L1503">            intent.putExtras(bundle);</span>
        }
<span class="nc bnc" id="L1505" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9052)) {</span>
<span class="nc" id="L1506">            startActivityForResult(intent, REQUEST_CODE_EDIT_DESCRIPTION);</span>
        }
<span class="nc" id="L1508">    }</span>

    /**
     * Filters descriptions from current wikiText and arranges it in LinkedHashmap according to the
     * language code
     * @param s wikitext
     * @return LinkedHashMap&lt;LanguageCode,Description&gt;
     */
    private LinkedHashMap&lt;String, String&gt; getDescriptions(String s) {
<span class="nc" id="L1517">        final Pattern pattern = Pattern.compile(&quot;[dD]escription *=(.*?)\n *\\|&quot;, Pattern.DOTALL);</span>
<span class="nc" id="L1518">        final Matcher matcher = pattern.matcher(s);</span>
<span class="nc" id="L1519">        String description = null;</span>
<span class="nc bnc" id="L1520" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9054)) {</span>
<span class="nc bnc" id="L1521" title="All 2 branches missed.">            if (matcher.find()) {</span>
<span class="nc bnc" id="L1522" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9053)) {</span>
<span class="nc" id="L1523">                    description = matcher.group();</span>
                }
            }
        }
<span class="nc bnc" id="L1527" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9055)) {</span>
<span class="nc bnc" id="L1528" title="All 2 branches missed.">            if (description == null) {</span>
<span class="nc" id="L1529">                return new LinkedHashMap&lt;&gt;();</span>
            }
        }
<span class="nc" id="L1532">        final LinkedHashMap&lt;String, String&gt; descriptionList = new LinkedHashMap&lt;&gt;();</span>
        // number of &quot;{{&quot;
<span class="nc" id="L1534">        int count = 0;</span>
<span class="nc" id="L1535">        int startCode = 0;</span>
<span class="nc" id="L1536">        int endCode = 0;</span>
<span class="nc" id="L1537">        int startDescription = 0;</span>
<span class="nc" id="L1538">        int endDescription = 0;</span>
<span class="nc" id="L1539">        final HashSet&lt;String&gt; allLanguageCodes = new HashSet&lt;&gt;(Arrays.asList(&quot;en&quot;, &quot;es&quot;, &quot;de&quot;, &quot;ja&quot;, &quot;fr&quot;, &quot;ru&quot;, &quot;pt&quot;, &quot;it&quot;, &quot;zh-hans&quot;, &quot;zh-hant&quot;, &quot;ar&quot;, &quot;ko&quot;, &quot;id&quot;, &quot;pl&quot;, &quot;nl&quot;, &quot;fa&quot;, &quot;hi&quot;, &quot;th&quot;, &quot;vi&quot;, &quot;sv&quot;, &quot;uk&quot;, &quot;cs&quot;, &quot;simple&quot;, &quot;hu&quot;, &quot;ro&quot;, &quot;fi&quot;, &quot;el&quot;, &quot;he&quot;, &quot;nb&quot;, &quot;da&quot;, &quot;sr&quot;, &quot;hr&quot;, &quot;ms&quot;, &quot;bg&quot;, &quot;ca&quot;, &quot;tr&quot;, &quot;sk&quot;, &quot;sh&quot;, &quot;bn&quot;, &quot;tl&quot;, &quot;mr&quot;, &quot;ta&quot;, &quot;kk&quot;, &quot;lt&quot;, &quot;az&quot;, &quot;bs&quot;, &quot;sl&quot;, &quot;sq&quot;, &quot;arz&quot;, &quot;zh-yue&quot;, &quot;ka&quot;, &quot;te&quot;, &quot;et&quot;, &quot;lv&quot;, &quot;ml&quot;, &quot;hy&quot;, &quot;uz&quot;, &quot;kn&quot;, &quot;af&quot;, &quot;nn&quot;, &quot;mk&quot;, &quot;gl&quot;, &quot;sw&quot;, &quot;eu&quot;, &quot;ur&quot;, &quot;ky&quot;, &quot;gu&quot;, &quot;bh&quot;, &quot;sco&quot;, &quot;ast&quot;, &quot;is&quot;, &quot;mn&quot;, &quot;be&quot;, &quot;an&quot;, &quot;km&quot;, &quot;si&quot;, &quot;ceb&quot;, &quot;jv&quot;, &quot;eo&quot;, &quot;als&quot;, &quot;ig&quot;, &quot;su&quot;, &quot;be-x-old&quot;, &quot;la&quot;, &quot;my&quot;, &quot;cy&quot;, &quot;ne&quot;, &quot;bar&quot;, &quot;azb&quot;, &quot;mzn&quot;, &quot;as&quot;, &quot;am&quot;, &quot;so&quot;, &quot;pa&quot;, &quot;map-bms&quot;, &quot;scn&quot;, &quot;tg&quot;, &quot;ckb&quot;, &quot;ga&quot;, &quot;lb&quot;, &quot;war&quot;, &quot;zh-min-nan&quot;, &quot;nds&quot;, &quot;fy&quot;, &quot;vec&quot;, &quot;pnb&quot;, &quot;zh-classical&quot;, &quot;lmo&quot;, &quot;tt&quot;, &quot;io&quot;, &quot;ia&quot;, &quot;br&quot;, &quot;hif&quot;, &quot;mg&quot;, &quot;wuu&quot;, &quot;gan&quot;, &quot;ang&quot;, &quot;or&quot;, &quot;oc&quot;, &quot;yi&quot;, &quot;ps&quot;, &quot;tk&quot;, &quot;ba&quot;, &quot;sah&quot;, &quot;fo&quot;, &quot;nap&quot;, &quot;vls&quot;, &quot;sa&quot;, &quot;ce&quot;, &quot;qu&quot;, &quot;ku&quot;, &quot;min&quot;, &quot;bcl&quot;, &quot;ilo&quot;, &quot;ht&quot;, &quot;li&quot;, &quot;wa&quot;, &quot;vo&quot;, &quot;nds-nl&quot;, &quot;pam&quot;, &quot;new&quot;, &quot;mai&quot;, &quot;sn&quot;, &quot;pms&quot;, &quot;eml&quot;, &quot;yo&quot;, &quot;ha&quot;, &quot;gn&quot;, &quot;frr&quot;, &quot;gd&quot;, &quot;hsb&quot;, &quot;cv&quot;, &quot;lo&quot;, &quot;os&quot;, &quot;se&quot;, &quot;cdo&quot;, &quot;sd&quot;, &quot;ksh&quot;, &quot;bat-smg&quot;, &quot;bo&quot;, &quot;nah&quot;, &quot;xmf&quot;, &quot;ace&quot;, &quot;roa-tara&quot;, &quot;hak&quot;, &quot;bjn&quot;, &quot;gv&quot;, &quot;mt&quot;, &quot;pfl&quot;, &quot;szl&quot;, &quot;bpy&quot;, &quot;rue&quot;, &quot;co&quot;, &quot;diq&quot;, &quot;sc&quot;, &quot;rw&quot;, &quot;vep&quot;, &quot;lij&quot;, &quot;kw&quot;, &quot;fur&quot;, &quot;pcd&quot;, &quot;lad&quot;, &quot;tpi&quot;, &quot;ext&quot;, &quot;csb&quot;, &quot;rm&quot;, &quot;kab&quot;, &quot;gom&quot;, &quot;udm&quot;, &quot;mhr&quot;, &quot;glk&quot;, &quot;za&quot;, &quot;pdc&quot;, &quot;om&quot;, &quot;iu&quot;, &quot;nv&quot;, &quot;mi&quot;, &quot;nrm&quot;, &quot;tcy&quot;, &quot;frp&quot;, &quot;myv&quot;, &quot;kbp&quot;, &quot;dsb&quot;, &quot;zu&quot;, &quot;ln&quot;, &quot;mwl&quot;, &quot;fiu-vro&quot;, &quot;tum&quot;, &quot;tet&quot;, &quot;tn&quot;, &quot;pnt&quot;, &quot;stq&quot;, &quot;nov&quot;, &quot;ny&quot;, &quot;xh&quot;, &quot;crh&quot;, &quot;lfn&quot;, &quot;st&quot;, &quot;pap&quot;, &quot;ay&quot;, &quot;zea&quot;, &quot;bxr&quot;, &quot;kl&quot;, &quot;sm&quot;, &quot;ak&quot;, &quot;ve&quot;, &quot;pag&quot;, &quot;nso&quot;, &quot;kaa&quot;, &quot;lez&quot;, &quot;gag&quot;, &quot;kv&quot;, &quot;bm&quot;, &quot;to&quot;, &quot;lbe&quot;, &quot;krc&quot;, &quot;jam&quot;, &quot;ss&quot;, &quot;roa-rup&quot;, &quot;dv&quot;, &quot;ie&quot;, &quot;av&quot;, &quot;cbk-zam&quot;, &quot;chy&quot;, &quot;inh&quot;, &quot;ug&quot;, &quot;ch&quot;, &quot;arc&quot;, &quot;pih&quot;, &quot;mrj&quot;, &quot;kg&quot;, &quot;rmy&quot;, &quot;dty&quot;, &quot;na&quot;, &quot;ts&quot;, &quot;xal&quot;, &quot;wo&quot;, &quot;fj&quot;, &quot;tyv&quot;, &quot;olo&quot;, &quot;ltg&quot;, &quot;ff&quot;, &quot;jbo&quot;, &quot;haw&quot;, &quot;ki&quot;, &quot;chr&quot;, &quot;sg&quot;, &quot;atj&quot;, &quot;sat&quot;, &quot;ady&quot;, &quot;ty&quot;, &quot;lrc&quot;, &quot;ti&quot;, &quot;din&quot;, &quot;gor&quot;, &quot;lg&quot;, &quot;rn&quot;, &quot;bi&quot;, &quot;cu&quot;, &quot;kbd&quot;, &quot;pi&quot;, &quot;cr&quot;, &quot;koi&quot;, &quot;ik&quot;, &quot;mdf&quot;, &quot;bug&quot;, &quot;ee&quot;, &quot;shn&quot;, &quot;tw&quot;, &quot;dz&quot;, &quot;srn&quot;, &quot;ks&quot;, &quot;test&quot;, &quot;en-x-piglatin&quot;, &quot;ab&quot;));</span>
<span class="nc bnc" id="L1540" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9103)) {</span>
            {
<span class="nc" id="L1542">                long _loopCounter153 = 0;</span>
<span class="nc bnc" id="L1543" title="All 70 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(9102) ? (i &gt;= (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1)))))) : (ListenerUtil.mutListener.listen(9101) ? (i &lt;= (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1)))))) : (ListenerUtil.mutListener.listen(9100) ? (i &gt; (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1)))))) : (ListenerUtil.mutListener.listen(9099) ? (i != (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1)))))) : (ListenerUtil.mutListener.listen(9098) ? (i == (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1)))))) : (i &lt; (ListenerUtil.mutListener.listen(9097) ? (description.length() % 1) : (ListenerUtil.mutListener.listen(9096) ? (description.length() / 1) : (ListenerUtil.mutListener.listen(9095) ? (description.length() * 1) : (ListenerUtil.mutListener.listen(9094) ? (description.length() + 1) : (description.length() - 1))))))))))); i++) {</span>
<span class="nc" id="L1544">                    ListenerUtil.loopListener.listen(&quot;_loopCounter153&quot;, ++_loopCounter153);</span>
<span class="nc bnc" id="L1545" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9093)) {</span>
<span class="nc bnc" id="L1546" title="All 2 branches missed.">                        if (description.startsWith(&quot;{{&quot;, i)) {</span>
<span class="nc bnc" id="L1547" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9090)) {</span>
<span class="nc bnc" id="L1548" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(9075) ? (count &gt;= 0) : (ListenerUtil.mutListener.listen(9074) ? (count &lt;= 0) : (ListenerUtil.mutListener.listen(9073) ? (count &gt; 0) : (ListenerUtil.mutListener.listen(9072) ? (count &lt; 0) : (ListenerUtil.mutListener.listen(9071) ? (count != 0) : (count == 0))))))) {</span>
<span class="nc bnc" id="L1549" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9076)) {</span>
<span class="nc" id="L1550">                                        startCode = i;</span>
                                    }
<span class="nc bnc" id="L1552" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9077)) {</span>
<span class="nc" id="L1553">                                        endCode = description.indexOf(&quot;|&quot;, i);</span>
                                    }
<span class="nc bnc" id="L1555" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9082)) {</span>
<span class="nc bnc" id="L1556" title="All 8 branches missed.">                                        startDescription = (ListenerUtil.mutListener.listen(9081) ? (endCode % 1) : (ListenerUtil.mutListener.listen(9080) ? (endCode / 1) : (ListenerUtil.mutListener.listen(9079) ? (endCode * 1) : (ListenerUtil.mutListener.listen(9078) ? (endCode - 1) : (endCode + 1)))));</span>
                                    }
<span class="nc bnc" id="L1558" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9089)) {</span>
<span class="nc bnc" id="L1559" title="All 10 branches missed.">                                        if (description.startsWith(&quot;1=&quot;, (ListenerUtil.mutListener.listen(9086) ? (endCode % 1) : (ListenerUtil.mutListener.listen(9085) ? (endCode / 1) : (ListenerUtil.mutListener.listen(9084) ? (endCode * 1) : (ListenerUtil.mutListener.listen(9083) ? (endCode - 1) : (endCode + 1))))))) {</span>
<span class="nc bnc" id="L1560" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9087)) {</span>
<span class="nc" id="L1561">                                                startDescription += 2;</span>
                                            }
<span class="nc bnc" id="L1563" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9088)) {</span>
<span class="nc" id="L1564">                                                i += 2;</span>
                                            }
                                        }
                                    }
                                }
                            }
<span class="nc bnc" id="L1570" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9091)) {</span>
<span class="nc" id="L1571">                                i++;</span>
                            }
<span class="nc bnc" id="L1573" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9092)) {</span>
<span class="nc" id="L1574">                                count++;</span>
                            }
<span class="nc bnc" id="L1576" title="All 2 branches missed.">                        } else if (description.startsWith(&quot;}}&quot;, i)) {</span>
<span class="nc bnc" id="L1577" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9056)) {</span>
<span class="nc" id="L1578">                                count--;</span>
                            }
<span class="nc bnc" id="L1580" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9069)) {</span>
<span class="nc bnc" id="L1581" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(9061) ? (count &gt;= 0) : (ListenerUtil.mutListener.listen(9060) ? (count &lt;= 0) : (ListenerUtil.mutListener.listen(9059) ? (count &gt; 0) : (ListenerUtil.mutListener.listen(9058) ? (count &lt; 0) : (ListenerUtil.mutListener.listen(9057) ? (count != 0) : (count == 0))))))) {</span>
<span class="nc bnc" id="L1582" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9062)) {</span>
<span class="nc" id="L1583">                                        endDescription = i;</span>
                                    }
<span class="nc bnc" id="L1585" title="All 8 branches missed.">                                    final String languageCode = description.substring((ListenerUtil.mutListener.listen(9066) ? (startCode % 2) : (ListenerUtil.mutListener.listen(9065) ? (startCode / 2) : (ListenerUtil.mutListener.listen(9064) ? (startCode * 2) : (ListenerUtil.mutListener.listen(9063) ? (startCode - 2) : (startCode + 2))))), endCode);</span>
<span class="nc" id="L1586">                                    final String languageDescription = description.substring(startDescription, endDescription);</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9068)) {</span>
<span class="nc bnc" id="L1588" title="All 2 branches missed.">                                        if (allLanguageCodes.contains(languageCode)) {</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9067)) {</span>
<span class="nc" id="L1590">                                                descriptionList.put(languageCode, languageDescription);</span>
                                            }
                                        }
                                    }
                                }
                            }
<span class="nc bnc" id="L1596" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9070)) {</span>
<span class="nc" id="L1597">                                i++;</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L1604">        return descriptionList;</span>
    }

    /**
     * Gets list of caption and arranges it in a LinkedHashmap according to the language code
     * @return LinkedHashMap&lt;LanguageCode,Caption&gt;
     */
    private LinkedHashMap&lt;String, String&gt; getCaptionsList() {
<span class="nc" id="L1612">        final LinkedHashMap&lt;String, String&gt; captionList = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L1613">        final Map&lt;String, String&gt; captions = media.getCaptions();</span>
<span class="nc bnc" id="L1614" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9105)) {</span>
            {
<span class="nc" id="L1616">                long _loopCounter154 = 0;</span>
<span class="nc bnc" id="L1617" title="All 2 branches missed.">                for (final Map.Entry&lt;String, String&gt; map : captions.entrySet()) {</span>
<span class="nc" id="L1618">                    ListenerUtil.loopListener.listen(&quot;_loopCounter154&quot;, ++_loopCounter154);</span>
<span class="nc" id="L1619">                    final String language = map.getKey();</span>
<span class="nc" id="L1620">                    final String languageCaption = map.getValue();</span>
<span class="nc bnc" id="L1621" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9104)) {</span>
<span class="nc" id="L1622">                        captionList.put(language, languageCaption);</span>
                    }
<span class="nc" id="L1624">                }</span>
            }
        }
<span class="nc" id="L1627">        return captionList;</span>
    }

    /**
     * Get the result from another activity and act accordingly.
     * @param requestCode
     * @param resultCode
     * @param data
     */
    @Override
    public void onActivityResult(final int requestCode, final int resultCode, @Nullable final Intent data) {
<span class="nc bnc" id="L1638" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9106)) {</span>
<span class="nc" id="L1639">            super.onActivityResult(requestCode, resultCode, data);</span>
        }
<span class="nc bnc" id="L1641" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9147)) {</span>
<span class="nc bnc" id="L1642" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(9112) ? ((ListenerUtil.mutListener.listen(9111) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9110) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9109) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9108) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9107) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(9111) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9110) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9109) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9108) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9107) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc bnc" id="L1643" title="All 2 branches missed.">                assert data != null;</span>
<span class="nc" id="L1644">                final CameraPosition cameraPosition = LocationPicker.getCameraPosition(data);</span>
<span class="nc bnc" id="L1645" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9146)) {</span>
<span class="nc bnc" id="L1646" title="All 2 branches missed.">                    if (cameraPosition != null) {</span>
<span class="nc" id="L1647">                        final String latitude = String.valueOf(cameraPosition.target.getLatitude());</span>
<span class="nc" id="L1648">                        final String longitude = String.valueOf(cameraPosition.target.getLongitude());</span>
<span class="nc" id="L1649">                        final String accuracy = String.valueOf(cameraPosition.target.getAltitude());</span>
<span class="nc" id="L1650">                        String currentLatitude = null;</span>
<span class="nc" id="L1651">                        String currentLongitude = null;</span>
<span class="nc bnc" id="L1652" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9141)) {</span>
<span class="nc bnc" id="L1653" title="All 2 branches missed.">                            if (media.getCoordinates() != null) {</span>
<span class="nc bnc" id="L1654" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9139)) {</span>
<span class="nc" id="L1655">                                    currentLatitude = String.valueOf(media.getCoordinates().getLatitude());</span>
                                }
<span class="nc bnc" id="L1657" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9140)) {</span>
<span class="nc" id="L1658">                                    currentLongitude = String.valueOf(media.getCoordinates().getLongitude());</span>
                                }
                            }
                        }
<span class="nc bnc" id="L1662" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9145)) {</span>
<span class="nc bnc" id="L1663" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(9142) ? (!latitude.equals(currentLatitude) &amp;&amp; !longitude.equals(currentLongitude)) : (!latitude.equals(currentLatitude) || !longitude.equals(currentLongitude)))) {</span>
<span class="nc bnc" id="L1664" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9144)) {</span>
<span class="nc" id="L1665">                                    updateCoordinates(latitude, longitude, accuracy);</span>
                                }
<span class="nc bnc" id="L1667" title="All 2 branches missed.">                            } else if (media.getCoordinates() == null) {</span>
<span class="nc bnc" id="L1668" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9143)) {</span>
<span class="nc" id="L1669">                                    updateCoordinates(latitude, longitude, accuracy);</span>
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L1675" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(9118) ? ((ListenerUtil.mutListener.listen(9117) ? (requestCode &gt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9116) ? (requestCode &lt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9115) ? (requestCode &gt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9114) ? (requestCode &lt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9113) ? (requestCode != REQUEST_CODE_EDIT_DESCRIPTION) : (requestCode == REQUEST_CODE_EDIT_DESCRIPTION)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(9117) ? (requestCode &gt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9116) ? (requestCode &lt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9115) ? (requestCode &gt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9114) ? (requestCode &lt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9113) ? (requestCode != REQUEST_CODE_EDIT_DESCRIPTION) : (requestCode == REQUEST_CODE_EDIT_DESCRIPTION)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc" id="L1676">                final String updatedWikiText = data.getStringExtra(UPDATED_WIKITEXT);</span>
<span class="nc bnc" id="L1677" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9134)) {</span>
<span class="nc" id="L1678">                    compositeDisposable.add(descriptionEditHelper.addDescription(getContext(), media, updatedWikiText).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(s -&gt; {</span>
<span class="nc" id="L1679">                        Timber.d(&quot;Descriptions are added.&quot;);</span>
<span class="nc" id="L1680">                    }));</span>
                }
<span class="nc" id="L1682">                final ArrayList&lt;UploadMediaDetail&gt; uploadMediaDetails = data.getParcelableArrayListExtra(LIST_OF_DESCRIPTION_AND_CAPTION);</span>
<span class="nc" id="L1683">                LinkedHashMap&lt;String, String&gt; updatedCaptions = new LinkedHashMap&lt;&gt;();</span>
<span class="nc bnc" id="L1684" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9136)) {</span>
                    {
<span class="nc" id="L1686">                        long _loopCounter155 = 0;</span>
<span class="nc bnc" id="L1687" title="All 2 branches missed.">                        for (UploadMediaDetail mediaDetail : uploadMediaDetails) {</span>
<span class="nc" id="L1688">                            ListenerUtil.loopListener.listen(&quot;_loopCounter155&quot;, ++_loopCounter155);</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9135)) {</span>
<span class="nc" id="L1690">                                compositeDisposable.add(descriptionEditHelper.addCaption(getContext(), media, mediaDetail.getLanguageCode(), mediaDetail.getCaptionText()).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(s -&gt; {</span>
<span class="nc" id="L1691">                                    updateCaptions(mediaDetail, updatedCaptions);</span>
<span class="nc" id="L1692">                                    Timber.d(&quot;Caption is added.&quot;);</span>
<span class="nc" id="L1693">                                }));</span>
                            }
<span class="nc" id="L1695">                        }</span>
                    }
                }
<span class="nc bnc" id="L1698" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9137)) {</span>
<span class="nc" id="L1699">                    progressBarEditDescription.setVisibility(GONE);</span>
                }
<span class="nc bnc" id="L1701" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9138)) {</span>
<span class="nc" id="L1702">                    editDescription.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L1704" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(9124) ? ((ListenerUtil.mutListener.listen(9123) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9122) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9121) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9120) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9119) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) || resultCode == RESULT_CANCELED) : ((ListenerUtil.mutListener.listen(9123) ? (requestCode &gt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9122) ? (requestCode &lt;= REQUEST_CODE) : (ListenerUtil.mutListener.listen(9121) ? (requestCode &gt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9120) ? (requestCode &lt; REQUEST_CODE) : (ListenerUtil.mutListener.listen(9119) ? (requestCode != REQUEST_CODE) : (requestCode == REQUEST_CODE)))))) &amp;&amp; resultCode == RESULT_CANCELED))) {</span>
<span class="nc bnc" id="L1705" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9133)) {</span>
<span class="nc" id="L1706">                    viewUtil.showShortToast(getContext(), requireContext().getString(R.string.coordinates_picking_unsuccessful));</span>
                }
<span class="nc bnc" id="L1708" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(9130) ? ((ListenerUtil.mutListener.listen(9129) ? (requestCode &gt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9128) ? (requestCode &lt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9127) ? (requestCode &gt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9126) ? (requestCode &lt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9125) ? (requestCode != REQUEST_CODE_EDIT_DESCRIPTION) : (requestCode == REQUEST_CODE_EDIT_DESCRIPTION)))))) || resultCode == RESULT_CANCELED) : ((ListenerUtil.mutListener.listen(9129) ? (requestCode &gt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9128) ? (requestCode &lt;= REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9127) ? (requestCode &gt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9126) ? (requestCode &lt; REQUEST_CODE_EDIT_DESCRIPTION) : (ListenerUtil.mutListener.listen(9125) ? (requestCode != REQUEST_CODE_EDIT_DESCRIPTION) : (requestCode == REQUEST_CODE_EDIT_DESCRIPTION)))))) &amp;&amp; resultCode == RESULT_CANCELED))) {</span>
<span class="nc bnc" id="L1709" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9131)) {</span>
<span class="nc" id="L1710">                    progressBarEditDescription.setVisibility(GONE);</span>
                }
<span class="nc bnc" id="L1712" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9132)) {</span>
<span class="nc" id="L1713">                    editDescription.setVisibility(VISIBLE);</span>
                }
            }
        }
<span class="nc" id="L1717">    }</span>

    /**
     * Adds caption to the map and updates captions
     * @param mediaDetail UploadMediaDetail
     * @param updatedCaptions updated captionds
     */
    private void updateCaptions(UploadMediaDetail mediaDetail, LinkedHashMap&lt;String, String&gt; updatedCaptions) {
<span class="nc bnc" id="L1725" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9148)) {</span>
<span class="nc" id="L1726">            updatedCaptions.put(mediaDetail.getLanguageCode(), mediaDetail.getCaptionText());</span>
        }
<span class="nc bnc" id="L1728" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9149)) {</span>
<span class="nc" id="L1729">            media.setCaptions(updatedCaptions);</span>
        }
<span class="nc" id="L1731">    }</span>

    /**
     * Fetched coordinates are replaced with existing coordinates by a POST API call.
     * @param Latitude to be added
     * @param Longitude to be added
     * @param Accuracy to be added
     */
    public void updateCoordinates(final String Latitude, final String Longitude, final String Accuracy) {
<span class="nc bnc" id="L1740" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9150)) {</span>
<span class="nc" id="L1741">            compositeDisposable.add(coordinateEditHelper.makeCoordinatesEdit(getContext(), media, Latitude, Longitude, Accuracy).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(s -&gt; {</span>
<span class="nc" id="L1742">                Timber.d(&quot;Coordinates are added.&quot;);</span>
<span class="nc" id="L1743">                coordinates.setText(prettyCoordinates(media));</span>
<span class="nc" id="L1744">            }));</span>
        }
<span class="nc" id="L1746">    }</span>

    @SuppressLint(&quot;StringFormatInvalid&quot;)
    @OnClick(R.id.nominateDeletion)
    public void onDeleteButtonClicked() {
<span class="nc bnc" id="L1751" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9165)) {</span>
<span class="nc bnc" id="L1752" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9151) ? (AccountUtil.getUserName(getContext()) != null || AccountUtil.getUserName(getContext()).equals(media.getAuthor())) : (AccountUtil.getUserName(getContext()) != null &amp;&amp; AccountUtil.getUserName(getContext()).equals(media.getAuthor())))) {</span>
<span class="nc" id="L1753">                final ArrayAdapter&lt;String&gt; languageAdapter = new ArrayAdapter&lt;&gt;(getActivity(), R.layout.simple_spinner_dropdown_list, reasonList);</span>
<span class="nc" id="L1754">                final Spinner spinner = new Spinner(getActivity());</span>
<span class="nc bnc" id="L1755" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9160)) {</span>
<span class="nc" id="L1756">                    spinner.setLayoutParams(new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT));</span>
                }
<span class="nc bnc" id="L1758" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9161)) {</span>
<span class="nc" id="L1759">                    spinner.setAdapter(languageAdapter);</span>
                }
<span class="nc bnc" id="L1761" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9162)) {</span>
<span class="nc" id="L1762">                    spinner.setGravity(17);</span>
                }
<span class="nc" id="L1764">                AlertDialog dialog = DialogUtil.showAlertDialog(getActivity(), getString(R.string.nominate_delete), null, getString(R.string.about_translate_proceed), getString(R.string.about_translate_cancel), () -&gt; onDeleteClicked(spinner), () -&gt; {</span>
<span class="nc" id="L1765">                }, spinner, true);</span>
<span class="nc bnc" id="L1766" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9164)) {</span>
<span class="nc bnc" id="L1767" title="All 2 branches missed.">                    if (isDeleted) {</span>
<span class="nc bnc" id="L1768" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9163)) {</span>
<span class="nc" id="L1769">                            dialog.getButton(AlertDialog.BUTTON_POSITIVE).setEnabled(false);</span>
                        }
                    }
                }
<span class="nc" id="L1773">            } else // enableDeleteButton(true);   makes sense ?</span>
            {
<span class="nc" id="L1775">                final EditText input = new EditText(getActivity());</span>
<span class="nc bnc" id="L1776" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9152)) {</span>
<span class="nc" id="L1777">                    input.requestFocus();</span>
                }
<span class="nc" id="L1779">                AlertDialog d = DialogUtil.showAlertDialog(getActivity(), null, getString(R.string.dialog_box_text_nomination, media.getDisplayTitle()), getString(R.string.ok), getString(R.string.cancel), () -&gt; {</span>
<span class="nc" id="L1780">                    String reason = input.getText().toString();</span>
<span class="nc" id="L1781">                    onDeleteClickeddialogtext(reason);</span>
<span class="nc" id="L1782">                }, () -&gt; {</span>
<span class="nc" id="L1783">                }, input, true);</span>
<span class="nc bnc" id="L1784" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9158)) {</span>
<span class="nc" id="L1785">                    input.addTextChangedListener(new TextWatcher() {</span>

                        private void handleText() {
<span class="nc" id="L1788">                            final Button okButton = d.getButton(AlertDialog.BUTTON_POSITIVE);</span>
<span class="nc bnc" id="L1789" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9156)) {</span>
<span class="nc bnc" id="L1790" title="All 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(9153) ? (input.getText().length() == 0 &amp;&amp; isDeleted) : (input.getText().length() == 0 || isDeleted))) {</span>
<span class="nc bnc" id="L1791" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9155)) {</span>
<span class="nc" id="L1792">                                        okButton.setEnabled(false);</span>
                                    }
                                } else {
<span class="nc bnc" id="L1795" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9154)) {</span>
<span class="nc" id="L1796">                                        okButton.setEnabled(true);</span>
                                    }
                                }
                            }
<span class="nc" id="L1800">                        }</span>

                        @Override
                        public void afterTextChanged(Editable arg0) {
<span class="nc bnc" id="L1804" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9157)) {</span>
<span class="nc" id="L1805">                                handleText();</span>
                            }
<span class="nc" id="L1807">                        }</span>

                        @Override
                        public void beforeTextChanged(CharSequence s, int start, int count, int after) {
<span class="nc" id="L1811">                        }</span>

                        @Override
                        public void onTextChanged(CharSequence s, int start, int before, int count) {
<span class="nc" id="L1815">                        }</span>
                    });
                }
<span class="nc bnc" id="L1818" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9159)) {</span>
<span class="nc" id="L1819">                    d.getButton(AlertDialog.BUTTON_POSITIVE).setEnabled(false);</span>
                }
            }
        }
<span class="nc" id="L1823">    }</span>

    @SuppressLint(&quot;CheckResult&quot;)
    private void onDeleteClicked(Spinner spinner) {
<span class="nc bnc" id="L1827" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9166)) {</span>
<span class="nc" id="L1828">            applicationKvStore.putBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), true);</span>
        }
<span class="nc bnc" id="L1830" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9167)) {</span>
<span class="nc" id="L1831">            enableProgressBar();</span>
        }
<span class="nc" id="L1833">        String reason = reasonListEnglishMappings.get(spinner.getSelectedItemPosition());</span>
<span class="nc" id="L1834">        String finalReason = reason;</span>
<span class="nc" id="L1835">        Single&lt;Boolean&gt; resultSingle = reasonBuilder.getReason(media, reason).flatMap(reasonString -&gt; deleteHelper.makeDeletion(getContext(), media, finalReason));</span>
<span class="nc bnc" id="L1836" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9168)) {</span>
<span class="nc" id="L1837">            resultSingle.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(s -&gt; {</span>
<span class="nc bnc" id="L1838" title="All 2 branches missed.">                if (applicationKvStore.getBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), false)) {</span>
<span class="nc" id="L1839">                    applicationKvStore.remove(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()));</span>
<span class="nc" id="L1840">                    callback.nominatingForDeletion(index);</span>
                }
<span class="nc" id="L1842">            });</span>
        }
<span class="nc" id="L1844">    }</span>

    @SuppressLint(&quot;CheckResult&quot;)
    private void onDeleteClickeddialogtext(String reason) {
<span class="nc bnc" id="L1848" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9169)) {</span>
<span class="nc" id="L1849">            applicationKvStore.putBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), true);</span>
        }
<span class="nc bnc" id="L1851" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9170)) {</span>
<span class="nc" id="L1852">            enableProgressBar();</span>
        }
<span class="nc" id="L1854">        Single&lt;Boolean&gt; resultSingletext = reasonBuilder.getReason(media, reason).flatMap(reasonString -&gt; deleteHelper.makeDeletion(getContext(), media, reason));</span>
<span class="nc bnc" id="L1855" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9171)) {</span>
<span class="nc" id="L1856">            resultSingletext.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(s -&gt; {</span>
<span class="nc bnc" id="L1857" title="All 2 branches missed.">                if (applicationKvStore.getBoolean(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()), false)) {</span>
<span class="nc" id="L1858">                    applicationKvStore.remove(String.format(NOMINATING_FOR_DELETION_MEDIA, media.getImageUrl()));</span>
<span class="nc" id="L1859">                    callback.nominatingForDeletion(index);</span>
                }
<span class="nc" id="L1861">            });</span>
        }
<span class="nc" id="L1863">    }</span>

    @OnClick(R.id.seeMore)
    public void onSeeMoreClicked() {
<span class="nc bnc" id="L1867" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9174)) {</span>
<span class="nc bnc" id="L1868" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9172) ? (nominatedForDeletion.getVisibility() == VISIBLE || getActivity() != null) : (nominatedForDeletion.getVisibility() == VISIBLE &amp;&amp; getActivity() != null))) {</span>
<span class="nc bnc" id="L1869" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9173)) {</span>
<span class="nc" id="L1870">                    Utils.handleWebUrl(getActivity(), Uri.parse(media.getPageTitle().getMobileUri()));</span>
                }
            }
        }
<span class="nc" id="L1874">    }</span>

    @OnClick(R.id.mediaDetailAuthor)
    public void onAuthorViewClicked() {
<span class="nc bnc" id="L1878" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9176)) {</span>
<span class="nc bnc" id="L1879" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9175) ? (media == null &amp;&amp; media.getUser() == null) : (media == null || media.getUser() == null))) {</span>
<span class="nc" id="L1880">                return;</span>
            }
        }
<span class="nc bnc" id="L1883" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9178)) {</span>
<span class="nc bnc" id="L1884" title="All 2 branches missed.">            if (sessionManager.getUserName() == null) {</span>
<span class="nc" id="L1885">                String userProfileLink = BuildConfig.COMMONS_URL + &quot;/wiki/User:&quot; + media.getUser();</span>
<span class="nc" id="L1886">                Intent browserIntent = new Intent(Intent.ACTION_VIEW, Uri.parse(userProfileLink));</span>
<span class="nc bnc" id="L1887" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9177)) {</span>
<span class="nc" id="L1888">                    startActivity(browserIntent);</span>
                }
<span class="nc" id="L1890">                return;</span>
            }
        }
<span class="nc bnc" id="L1893" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9179)) {</span>
<span class="nc bnc" id="L1894" title="All 2 branches missed.">            ProfileActivity.startYourself(getActivity(), media.getUser(), !Objects.equals(sessionManager.getUserName(), media.getUser()));</span>
        }
<span class="nc" id="L1896">    }</span>

    /**
     * Enable Progress Bar and Update delete button text.
     */
    private void enableProgressBar() {
<span class="nc bnc" id="L1902" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9180)) {</span>
<span class="nc" id="L1903">            progressBarDeletion.setVisibility(VISIBLE);</span>
        }
<span class="nc bnc" id="L1905" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9181)) {</span>
<span class="nc" id="L1906">            delete.setText(&quot;Nominating for Deletion&quot;);</span>
        }
<span class="nc bnc" id="L1908" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9182)) {</span>
<span class="nc" id="L1909">            isDeleted = true;</span>
        }
<span class="nc" id="L1911">    }</span>

    private void rebuildCatList(List&lt;String&gt; categories) {
<span class="nc bnc" id="L1914" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9183)) {</span>
<span class="nc" id="L1915">            categoryContainer.removeAllViews();</span>
        }
<span class="nc bnc" id="L1917" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9185)) {</span>
            {
<span class="nc" id="L1919">                long _loopCounter156 = 0;</span>
<span class="nc bnc" id="L1920" title="All 2 branches missed.">                for (String category : categories) {</span>
<span class="nc" id="L1921">                    ListenerUtil.loopListener.listen(&quot;_loopCounter156&quot;, ++_loopCounter156);</span>
<span class="nc bnc" id="L1922" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9184)) {</span>
<span class="nc" id="L1923">                        categoryContainer.addView(buildCatLabel(sanitise(category), categoryContainer));</span>
                    }
<span class="nc" id="L1925">                }</span>
            }
        }
<span class="nc" id="L1928">    }</span>

    // that was meant for alphabetical sorting of the categories and can be safely removed.
    private String sanitise(String category) {
<span class="nc" id="L1932">        int indexOfPipe = category.indexOf('|');</span>
<span class="nc bnc" id="L1933" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9191)) {</span>
<span class="nc bnc" id="L1934" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9190) ? (indexOfPipe &gt;= -1) : (ListenerUtil.mutListener.listen(9189) ? (indexOfPipe &lt;= -1) : (ListenerUtil.mutListener.listen(9188) ? (indexOfPipe &gt; -1) : (ListenerUtil.mutListener.listen(9187) ? (indexOfPipe &lt; -1) : (ListenerUtil.mutListener.listen(9186) ? (indexOfPipe == -1) : (indexOfPipe != -1))))))) {</span>
                // Removed everything after '|'
<span class="nc" id="L1936">                return category.substring(0, indexOfPipe);</span>
            }
        }
<span class="nc" id="L1939">        return category;</span>
    }

    /**
     * Add view to depictions obtained also tapping on depictions should open the url
     */
    private View buildDepictLabel(String depictionName, String entityId, LinearLayout depictionContainer) {
<span class="nc" id="L1946">        final View item = LayoutInflater.from(getContext()).inflate(R.layout.detail_category_item, depictionContainer, false);</span>
<span class="nc" id="L1947">        final TextView textView = item.findViewById(R.id.mediaDetailCategoryItemText);</span>
<span class="nc bnc" id="L1948" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9192)) {</span>
<span class="nc" id="L1949">            textView.setText(depictionName);</span>
        }
<span class="nc bnc" id="L1951" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9193)) {</span>
<span class="nc" id="L1952">            item.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L1953">                Intent intent = new Intent(getContext(), WikidataItemDetailsActivity.class);</span>
<span class="nc" id="L1954">                intent.putExtra(&quot;wikidataItemName&quot;, depictionName);</span>
<span class="nc" id="L1955">                intent.putExtra(&quot;entityId&quot;, entityId);</span>
<span class="nc" id="L1956">                intent.putExtra(&quot;fragment&quot;, &quot;MediaDetailFragment&quot;);</span>
<span class="nc" id="L1957">                getContext().startActivity(intent);</span>
<span class="nc" id="L1958">            });</span>
        }
<span class="nc" id="L1960">        return item;</span>
    }

    private View buildCatLabel(final String catName, ViewGroup categoryContainer) {
<span class="nc" id="L1964">        final View item = LayoutInflater.from(getContext()).inflate(R.layout.detail_category_item, categoryContainer, false);</span>
<span class="nc" id="L1965">        final TextView textView = item.findViewById(R.id.mediaDetailCategoryItemText);</span>
<span class="nc bnc" id="L1966" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9194)) {</span>
<span class="nc" id="L1967">            textView.setText(catName);</span>
        }
<span class="nc bnc" id="L1969" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9196)) {</span>
<span class="nc bnc" id="L1970" title="All 2 branches missed.">            if (!getString(R.string.detail_panel_cats_none).equals(catName)) {</span>
<span class="nc bnc" id="L1971" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9195)) {</span>
<span class="nc" id="L1972">                    textView.setOnClickListener(view -&gt; {</span>
                        // Open Category Details page
<span class="nc" id="L1974">                        Intent intent = new Intent(getContext(), CategoryDetailsActivity.class);</span>
<span class="nc" id="L1975">                        intent.putExtra(&quot;categoryName&quot;, catName);</span>
<span class="nc" id="L1976">                        getContext().startActivity(intent);</span>
<span class="nc" id="L1977">                    });</span>
                }
            }
        }
<span class="nc" id="L1981">        return item;</span>
    }

    /**
     * Returns captions for media details
     *
     * @param media object of class media
     * @return caption as string
     */
    private String prettyCaption(Media media) {
<span class="nc bnc" id="L1991" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9198)) {</span>
            {
<span class="nc" id="L1993">                long _loopCounter157 = 0;</span>
<span class="nc bnc" id="L1994" title="All 2 branches missed.">                for (String caption : media.getCaptions().values()) {</span>
<span class="nc" id="L1995">                    ListenerUtil.loopListener.listen(&quot;_loopCounter157&quot;, ++_loopCounter157);</span>
<span class="nc bnc" id="L1996" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9197)) {</span>
<span class="nc bnc" id="L1997" title="All 2 branches missed.">                        if (caption.equals(&quot;&quot;)) {</span>
<span class="nc" id="L1998">                            return getString(R.string.detail_caption_empty);</span>
                        } else {
<span class="nc" id="L2000">                            return caption;</span>
                        }
                    }
<span class="nc" id="L2003">                }</span>
            }
        }
<span class="nc" id="L2006">        return getString(R.string.detail_caption_empty);</span>
    }

    private String prettyDescription(Media media) {
<span class="nc" id="L2010">        final String description = chooseDescription(media);</span>
<span class="nc bnc" id="L2011" title="All 2 branches missed.">        return description.isEmpty() ? getString(R.string.detail_description_empty) : description;</span>
    }

    private String chooseDescription(Media media) {
<span class="nc" id="L2015">        final Map&lt;String, String&gt; descriptions = media.getDescriptions();</span>
<span class="nc" id="L2016">        final String multilingualDesc = descriptions.get(Locale.getDefault().getLanguage());</span>
<span class="nc bnc" id="L2017" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9199)) {</span>
<span class="nc bnc" id="L2018" title="All 2 branches missed.">            if (multilingualDesc != null) {</span>
<span class="nc" id="L2019">                return multilingualDesc;</span>
            }
        }
<span class="nc bnc" id="L2022" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9200)) {</span>
            {
<span class="nc" id="L2024">                long _loopCounter158 = 0;</span>
<span class="nc bnc" id="L2025" title="All 2 branches missed.">                for (String description : descriptions.values()) {</span>
<span class="nc" id="L2026">                    ListenerUtil.loopListener.listen(&quot;_loopCounter158&quot;, ++_loopCounter158);</span>
<span class="nc" id="L2027">                    return description;</span>
                }
            }
        }
<span class="nc" id="L2031">        return media.getFallbackDescription();</span>
    }

    private String prettyDiscussion(String discussion) {
<span class="nc bnc" id="L2035" title="All 2 branches missed.">        return discussion.isEmpty() ? getString(R.string.detail_discussion_empty) : discussion;</span>
    }

    private String prettyLicense(Media media) {
<span class="nc" id="L2039">        String licenseKey = media.getLicense();</span>
<span class="nc bnc" id="L2040" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9201)) {</span>
<span class="nc" id="L2041">            Timber.d(&quot;Media license is: %s&quot;, licenseKey);</span>
        }
<span class="nc bnc" id="L2043" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9203)) {</span>
<span class="nc bnc" id="L2044" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9202) ? (licenseKey == null &amp;&amp; licenseKey.equals(&quot;&quot;)) : (licenseKey == null || licenseKey.equals(&quot;&quot;)))) {</span>
<span class="nc" id="L2045">                return getString(R.string.detail_license_empty);</span>
            }
        }
<span class="nc" id="L2048">        return licenseKey;</span>
    }

    private String prettyUploadedDate(Media media) {
<span class="nc" id="L2052">        Date date = media.getDateUploaded();</span>
<span class="nc bnc" id="L2053" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9206)) {</span>
<span class="nc bnc" id="L2054" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(9205) ? ((ListenerUtil.mutListener.listen(9204) ? (date == null &amp;&amp; date.toString() == null) : (date == null || date.toString() == null)) &amp;&amp; date.toString().isEmpty()) : ((ListenerUtil.mutListener.listen(9204) ? (date == null &amp;&amp; date.toString() == null) : (date == null || date.toString() == null)) || date.toString().isEmpty()))) {</span>
<span class="nc" id="L2055">                return &quot;Uploaded date not available&quot;;</span>
            }
        }
<span class="nc" id="L2058">        return DateUtil.getDateStringWithSkeletonPattern(date, &quot;dd MMM yyyy&quot;);</span>
    }

    /**
     * Returns the coordinates nicely formatted.
     *
     * @return Coordinates as text.
     */
    private String prettyCoordinates(Media media) {
<span class="nc bnc" id="L2067" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9207)) {</span>
<span class="nc bnc" id="L2068" title="All 2 branches missed.">            if (media.getCoordinates() == null) {</span>
<span class="nc" id="L2069">                return getString(R.string.media_detail_coordinates_empty);</span>
            }
        }
<span class="nc" id="L2072">        return media.getCoordinates().getPrettyCoordinateString();</span>
    }

    @Override
    public boolean updateCategoryDisplay(List&lt;String&gt; categories) {
<span class="nc bnc" id="L2077" title="All 2 branches missed.">        if (categories == null) {</span>
<span class="nc" id="L2078">            return false;</span>
        } else {
<span class="nc bnc" id="L2080" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9208)) {</span>
<span class="nc" id="L2081">                rebuildCatList(categories);</span>
            }
<span class="nc" id="L2083">            return true;</span>
        }
    }

    @OnClick(R.id.show_caption_description_textview)
    void showCaptionAndDescription() {
<span class="nc bnc" id="L2089" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9212)) {</span>
<span class="nc bnc" id="L2090" title="All 2 branches missed.">            if (showCaptionAndDescriptionContainer.getVisibility() == GONE) {</span>
<span class="nc bnc" id="L2091" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9210)) {</span>
<span class="nc" id="L2092">                    showCaptionAndDescriptionContainer.setVisibility(VISIBLE);</span>
                }
<span class="nc bnc" id="L2094" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9211)) {</span>
<span class="nc" id="L2095">                    setUpCaptionAndDescriptionLayout();</span>
                }
            } else {
<span class="nc bnc" id="L2098" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9209)) {</span>
<span class="nc" id="L2099">                    showCaptionAndDescriptionContainer.setVisibility(GONE);</span>
                }
            }
        }
<span class="nc" id="L2103">    }</span>

    /**
     * setUp Caption And Description Layout
     */
    private void setUpCaptionAndDescriptionLayout() {
<span class="nc" id="L2109">        List&lt;Caption&gt; captions = getCaptions();</span>
<span class="nc bnc" id="L2110" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9214)) {</span>
<span class="nc bnc" id="L2111" title="All 2 branches missed.">            if (descriptionHtmlCode == null) {</span>
<span class="nc bnc" id="L2112" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9213)) {</span>
<span class="nc" id="L2113">                    progressBar.setVisibility(VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L2117" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9215)) {</span>
<span class="nc" id="L2118">            getDescription();</span>
        }
<span class="nc" id="L2120">        CaptionListViewAdapter adapter = new CaptionListViewAdapter(captions);</span>
<span class="nc bnc" id="L2121" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9216)) {</span>
<span class="nc" id="L2122">            captionsListView.setAdapter(adapter);</span>
        }
<span class="nc" id="L2124">    }</span>

    /**
     * Generate the caption with language
     */
    private List&lt;Caption&gt; getCaptions() {
<span class="nc" id="L2130">        List&lt;Caption&gt; captionList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L2131">        Map&lt;String, String&gt; captions = media.getCaptions();</span>
<span class="nc" id="L2132">        AppLanguageLookUpTable appLanguageLookUpTable = new AppLanguageLookUpTable(getContext());</span>
<span class="nc bnc" id="L2133" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9218)) {</span>
            {
<span class="nc" id="L2135">                long _loopCounter159 = 0;</span>
<span class="nc bnc" id="L2136" title="All 2 branches missed.">                for (Map.Entry&lt;String, String&gt; map : captions.entrySet()) {</span>
<span class="nc" id="L2137">                    ListenerUtil.loopListener.listen(&quot;_loopCounter159&quot;, ++_loopCounter159);</span>
<span class="nc" id="L2138">                    String language = appLanguageLookUpTable.getLocalizedName(map.getKey());</span>
<span class="nc" id="L2139">                    String languageCaption = map.getValue();</span>
<span class="nc bnc" id="L2140" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9217)) {</span>
<span class="nc" id="L2141">                        captionList.add(new Caption(language, languageCaption));</span>
                    }
<span class="nc" id="L2143">                }</span>
            }
        }
<span class="nc bnc" id="L2146" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9220)) {</span>
<span class="nc bnc" id="L2147" title="All 2 branches missed.">            if (captionList.size() == 0) {</span>
<span class="nc bnc" id="L2148" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9219)) {</span>
<span class="nc" id="L2149">                    captionList.add(new Caption(&quot;&quot;, &quot;No Caption&quot;));</span>
                }
            }
        }
<span class="nc" id="L2153">        return captionList;</span>
    }

    private void getDescription() {
<span class="nc bnc" id="L2157" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9221)) {</span>
<span class="nc" id="L2158">            compositeDisposable.add(mediaDataExtractor.getHtmlOfPage(media.getFilename()).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(this::extractDescription, Timber::e));</span>
        }
<span class="nc" id="L2160">    }</span>

    /**
     * extract the description from html of imagepage
     */
    private void extractDescription(String s) {
<span class="nc" id="L2166">        String descriptionClassName = &quot;&lt;td class=\&quot;description\&quot;&gt;&quot;;</span>
<span class="nc bnc" id="L2167" title="All 8 branches missed.">        int start = (ListenerUtil.mutListener.listen(9225) ? (s.indexOf(descriptionClassName) % descriptionClassName.length()) : (ListenerUtil.mutListener.listen(9224) ? (s.indexOf(descriptionClassName) / descriptionClassName.length()) : (ListenerUtil.mutListener.listen(9223) ? (s.indexOf(descriptionClassName) * descriptionClassName.length()) : (ListenerUtil.mutListener.listen(9222) ? (s.indexOf(descriptionClassName) - descriptionClassName.length()) : (s.indexOf(descriptionClassName) + descriptionClassName.length())))));</span>
<span class="nc" id="L2168">        int end = s.indexOf(&quot;&lt;/td&gt;&quot;, start);</span>
<span class="nc bnc" id="L2169" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9226)) {</span>
<span class="nc" id="L2170">            descriptionHtmlCode = &quot;&quot;;</span>
        }
<span class="nc bnc" id="L2172" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9233)) {</span>
            {
<span class="nc" id="L2174">                long _loopCounter160 = 0;</span>
<span class="nc bnc" id="L2175" title="All 22 branches missed.">                for (int i = start; (ListenerUtil.mutListener.listen(9232) ? (i &gt;= end) : (ListenerUtil.mutListener.listen(9231) ? (i &lt;= end) : (ListenerUtil.mutListener.listen(9230) ? (i &gt; end) : (ListenerUtil.mutListener.listen(9229) ? (i != end) : (ListenerUtil.mutListener.listen(9228) ? (i == end) : (i &lt; end)))))); i++) {</span>
<span class="nc" id="L2176">                    ListenerUtil.loopListener.listen(&quot;_loopCounter160&quot;, ++_loopCounter160);</span>
<span class="nc bnc" id="L2177" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9227)) {</span>
<span class="nc" id="L2178">                        descriptionHtmlCode = descriptionHtmlCode + s.toCharArray()[i];</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L2183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9234)) {</span>
<span class="nc" id="L2184">            descriptionWebView.loadDataWithBaseURL(null, descriptionHtmlCode, &quot;text/html&quot;, &quot;utf-8&quot;, null);</span>
        }
<span class="nc bnc" id="L2186" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9235)) {</span>
<span class="nc" id="L2187">            progressBar.setVisibility(GONE);</span>
        }
<span class="nc" id="L2189">    }</span>

    /**
     * Handle back event when fragment when showCaptionAndDescriptionContainer is visible
     */
    private void handleBackEvent(View view) {
<span class="nc bnc" id="L2195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9236)) {</span>
<span class="nc" id="L2196">            view.setFocusableInTouchMode(true);</span>
        }
<span class="nc bnc" id="L2198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9237)) {</span>
<span class="nc" id="L2199">            view.requestFocus();</span>
        }
<span class="nc bnc" id="L2201" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9241)) {</span>
<span class="nc" id="L2202">            view.setOnKeyListener(new OnKeyListener() {</span>

                @Override
                public boolean onKey(View view, int keycode, KeyEvent keyEvent) {
<span class="nc bnc" id="L2206" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9240)) {</span>
<span class="nc bnc" id="L2207" title="All 2 branches missed.">                        if (keycode == KeyEvent.KEYCODE_BACK) {</span>
<span class="nc bnc" id="L2208" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9239)) {</span>
<span class="nc bnc" id="L2209" title="All 2 branches missed.">                                if (showCaptionAndDescriptionContainer.getVisibility() == VISIBLE) {</span>
<span class="nc bnc" id="L2210" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9238)) {</span>
<span class="nc" id="L2211">                                        showCaptionAndDescriptionContainer.setVisibility(GONE);</span>
                                    }
<span class="nc" id="L2213">                                    return true;</span>
                                }
                            }
                        }
                    }
<span class="nc" id="L2218">                    return false;</span>
                }
            });
        }
<span class="nc" id="L2222">    }</span>

    public interface Callback {

        void nominatingForDeletion(int index);
    }

    /**
     * Called when the image background color is changed.
     * You should pass a useable color, not a resource id.
     * @param color
     */
    public void onImageBackgroundChanged(int color) {
<span class="nc" id="L2235">        int currentColor = getImageBackgroundColor();</span>
<span class="nc bnc" id="L2236" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9247)) {</span>
<span class="nc bnc" id="L2237" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9246) ? (currentColor &gt;= color) : (ListenerUtil.mutListener.listen(9245) ? (currentColor &lt;= color) : (ListenerUtil.mutListener.listen(9244) ? (currentColor &gt; color) : (ListenerUtil.mutListener.listen(9243) ? (currentColor &lt; color) : (ListenerUtil.mutListener.listen(9242) ? (currentColor != color) : (currentColor == color))))))) {</span>
<span class="nc" id="L2238">                return;</span>
            }
        }
<span class="nc bnc" id="L2241" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9248)) {</span>
<span class="nc" id="L2242">            image.setBackgroundColor(color);</span>
        }
<span class="nc bnc" id="L2244" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9249)) {</span>
<span class="nc" id="L2245">            getImageBackgroundColorPref().edit().putInt(IMAGE_BACKGROUND_COLOR, color).apply();</span>
        }
<span class="nc" id="L2247">    }</span>

    private SharedPreferences getImageBackgroundColorPref() {
<span class="nc" id="L2250">        return getContext().getSharedPreferences(IMAGE_BACKGROUND_COLOR + media.getPageId(), Context.MODE_PRIVATE);</span>
    }

    private int getImageBackgroundColor() {
<span class="nc" id="L2254">        SharedPreferences imageBackgroundColorPref = this.getImageBackgroundColorPref();</span>
<span class="nc" id="L2255">        return imageBackgroundColorPref.getInt(IMAGE_BACKGROUND_COLOR, DEFAULT_IMAGE_BACKGROUND_COLOR);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>