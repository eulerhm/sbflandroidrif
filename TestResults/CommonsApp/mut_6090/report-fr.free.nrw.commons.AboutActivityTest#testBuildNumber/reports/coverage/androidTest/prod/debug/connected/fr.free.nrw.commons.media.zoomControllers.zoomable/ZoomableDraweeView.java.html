<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ZoomableDraweeView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">prodDebug</a> &gt; <a href="index.source.html" class="el_package">fr.free.nrw.commons.media.zoomControllers.zoomable</a> &gt; <span class="el_source">ZoomableDraweeView.java</span></div><h1>ZoomableDraweeView.java</h1><pre class="source lang-java linenums">package fr.free.nrw.commons.media.zoomControllers.zoomable;

import android.content.Context;
import android.content.res.Resources;
import android.graphics.Canvas;
import android.graphics.Matrix;
import android.graphics.RectF;
import android.graphics.drawable.Animatable;
import android.util.AttributeSet;
import android.view.GestureDetector;
import android.view.MotionEvent;
import androidx.annotation.Nullable;
import androidx.core.view.ScrollingView;
import com.facebook.common.internal.Preconditions;
import com.facebook.common.logging.FLog;
import com.facebook.drawee.controller.AbstractDraweeController;
import com.facebook.drawee.controller.BaseControllerListener;
import com.facebook.drawee.controller.ControllerListener;
import com.facebook.drawee.drawable.ScalingUtils;
import com.facebook.drawee.generic.GenericDraweeHierarchy;
import com.facebook.drawee.generic.GenericDraweeHierarchyBuilder;
import com.facebook.drawee.generic.GenericDraweeHierarchyInflater;
import com.facebook.drawee.interfaces.DraweeController;
import com.facebook.drawee.view.DraweeView;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * DraweeView that has zoomable capabilities.
 *
 * &lt;p&gt;Once the image loads, pinch-to-zoom and translation gestures are enabled.
 */
public class ZoomableDraweeView extends DraweeView&lt;GenericDraweeHierarchy&gt; implements ScrollingView {

<span class="nc" id="L34">    private static final Class&lt;?&gt; TAG = ZoomableDraweeView.class;</span>

    private static final float HUGE_IMAGE_SCALE_FACTOR_THRESHOLD = 1.1f;

<span class="nc" id="L38">    private final RectF mImageBounds = new RectF();</span>

<span class="nc" id="L40">    private final RectF mViewBounds = new RectF();</span>

    private DraweeController mHugeImageController;

    private ZoomableController mZoomableController;

    private GestureDetector mTapGestureDetector;

<span class="nc" id="L48">    private boolean mAllowTouchInterceptionWhileZoomed = true;</span>

<span class="nc" id="L50">    private boolean mIsDialtoneEnabled = false;</span>

<span class="nc" id="L52">    private boolean mZoomingEnabled = true;</span>

    private TransformationListener transformationListener;

<span class="nc" id="L56">    private final ControllerListener mControllerListener = new BaseControllerListener&lt;Object&gt;() {</span>

        @Override
        public void onFinalImageSet(String id, @Nullable Object imageInfo, @Nullable Animatable animatable) {
<span class="nc bnc" id="L60" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8252)) {</span>
<span class="nc" id="L61">                ZoomableDraweeView.this.onFinalImageSet();</span>
            }
<span class="nc" id="L63">        }</span>

        @Override
        public void onRelease(String id) {
<span class="nc bnc" id="L67" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8253)) {</span>
<span class="nc" id="L68">                ZoomableDraweeView.this.onRelease();</span>
            }
<span class="nc" id="L70">        }</span>
    };

<span class="nc" id="L73">    private final ZoomableController.Listener mZoomableListener = new ZoomableController.Listener() {</span>

        @Override
        public void onTransformBegin(Matrix transform) {
<span class="nc" id="L77">        }</span>

        @Override
        public void onTransformChanged(Matrix transform) {
<span class="nc bnc" id="L81" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8254)) {</span>
<span class="nc" id="L82">                ZoomableDraweeView.this.onTransformChanged(transform);</span>
            }
<span class="nc" id="L84">        }</span>

        @Override
        public void onTransformEnd(Matrix transform) {
<span class="nc bnc" id="L88" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8256)) {</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">                if (null != transformationListener) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8255)) {</span>
<span class="nc" id="L91">                        transformationListener.onTransformationEnd();</span>
                    }
                }
            }
<span class="nc" id="L95">        }</span>
    };

    public void setTransformationListener(TransformationListener transformationListener) {
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8257)) {</span>
<span class="nc" id="L100">            this.transformationListener = transformationListener;</span>
        }
<span class="nc" id="L102">    }</span>

<span class="nc" id="L104">    private final GestureListenerWrapper mTapListenerWrapper = new GestureListenerWrapper();</span>

    public ZoomableDraweeView(Context context, GenericDraweeHierarchy hierarchy) {
<span class="nc" id="L107">        super(context);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8258)) {</span>
<span class="nc" id="L109">            setHierarchy(hierarchy);</span>
        }
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8259)) {</span>
<span class="nc" id="L112">            init();</span>
        }
<span class="nc" id="L114">    }</span>

    public ZoomableDraweeView(Context context) {
<span class="nc" id="L117">        super(context);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8260)) {</span>
<span class="nc" id="L119">            inflateHierarchy(context, null);</span>
        }
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8261)) {</span>
<span class="nc" id="L122">            init();</span>
        }
<span class="nc" id="L124">    }</span>

    public ZoomableDraweeView(Context context, AttributeSet attrs) {
<span class="nc" id="L127">        super(context, attrs);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8262)) {</span>
<span class="nc" id="L129">            inflateHierarchy(context, attrs);</span>
        }
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8263)) {</span>
<span class="nc" id="L132">            init();</span>
        }
<span class="nc" id="L134">    }</span>

    public ZoomableDraweeView(Context context, AttributeSet attrs, int defStyle) {
<span class="nc" id="L137">        super(context, attrs, defStyle);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8264)) {</span>
<span class="nc" id="L139">            inflateHierarchy(context, attrs);</span>
        }
<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8265)) {</span>
<span class="nc" id="L142">            init();</span>
        }
<span class="nc" id="L144">    }</span>

    protected void inflateHierarchy(Context context, @Nullable AttributeSet attrs) {
<span class="nc" id="L147">        Resources resources = context.getResources();</span>
<span class="nc" id="L148">        GenericDraweeHierarchyBuilder builder = new GenericDraweeHierarchyBuilder(resources).setActualImageScaleType(ScalingUtils.ScaleType.FIT_CENTER);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8266)) {</span>
<span class="nc" id="L150">            GenericDraweeHierarchyInflater.updateBuilder(builder, context, attrs);</span>
        }
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8267)) {</span>
<span class="nc" id="L153">            setAspectRatio(builder.getDesiredAspectRatio());</span>
        }
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8268)) {</span>
<span class="nc" id="L156">            setHierarchy(builder.build());</span>
        }
<span class="nc" id="L158">    }</span>

    private void init() {
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8269)) {</span>
<span class="nc" id="L162">            mZoomableController = createZoomableController();</span>
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8270)) {</span>
<span class="nc" id="L165">            mZoomableController.setListener(mZoomableListener);</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8271)) {</span>
<span class="nc" id="L168">            mTapGestureDetector = new GestureDetector(getContext(), mTapListenerWrapper);</span>
        }
<span class="nc" id="L170">    }</span>

    public void setIsDialtoneEnabled(boolean isDialtoneEnabled) {
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8272)) {</span>
<span class="nc" id="L174">            mIsDialtoneEnabled = isDialtoneEnabled;</span>
        }
<span class="nc" id="L176">    }</span>

    /**
     * Gets the original image bounds, in view-absolute coordinates.
     *
     * &lt;p&gt;The original image bounds are those reported by the hierarchy. The hierarchy itself may
     * apply scaling on its own (e.g. due to scale type) so the reported bounds are not necessarily
     * the same as the actual bitmap dimensions. In other words, the original image bounds correspond
     * to the image bounds within this view when no zoomable transformation is applied, but including
     * the potential scaling of the hierarchy. Having the actual bitmap dimensions abstracted away
     * from this view greatly simplifies implementation because the actual bitmap may change (e.g.
     * when a high-res image arrives and replaces the previously set low-res image). With proper
     * hierarchy scaling (e.g. FIT_CENTER), this underlying change will not affect this view nor the
     * zoomable transformation in any way.
     */
    protected void getImageBounds(RectF outBounds) {
<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8273)) {</span>
<span class="nc" id="L193">            getHierarchy().getActualImageBounds(outBounds);</span>
        }
<span class="nc" id="L195">    }</span>

    /**
     * Gets the bounds used to limit the translation, in view-absolute coordinates.
     *
     * &lt;p&gt;These bounds are passed to the zoomable controller in order to limit the translation. The
     * image is attempted to be centered within the limit bounds if the transformed image is smaller.
     * There will be no empty spaces within the limit bounds if the transformed image is bigger. This
     * applies to each dimension (horizontal and vertical) independently.
     *
     * &lt;p&gt;Unless overridden by a subclass, these bounds are same as the view bounds.
     */
    protected void getLimitBounds(RectF outBounds) {
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8274)) {</span>
<span class="nc" id="L209">            outBounds.set(0, 0, getWidth(), getHeight());</span>
        }
<span class="nc" id="L211">    }</span>

    /**
     * Sets a custom zoomable controller, instead of using the default one.
     */
    public void setZoomableController(ZoomableController zoomableController) {
<span class="nc bnc" id="L217" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8275)) {</span>
<span class="nc" id="L218">            Preconditions.checkNotNull(zoomableController);</span>
        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8276)) {</span>
<span class="nc" id="L221">            mZoomableController.setListener(null);</span>
        }
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8277)) {</span>
<span class="nc" id="L224">            mZoomableController = zoomableController;</span>
        }
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8278)) {</span>
<span class="nc" id="L227">            mZoomableController.setListener(mZoomableListener);</span>
        }
<span class="nc" id="L229">    }</span>

    /**
     * Gets the zoomable controller.
     *
     * &lt;p&gt;Zoomable controller can be used to zoom to point, or to map point from view to image
     * coordinates for instance.
     */
    public ZoomableController getZoomableController() {
<span class="nc" id="L238">        return mZoomableController;</span>
    }

    /**
     * Check whether the parent view can intercept touch events while zoomed. This can be used, for
     * example, to swipe between images in a view pager while zoomed.
     *
     * @return true if touch events can be intercepted
     */
    public boolean allowsTouchInterceptionWhileZoomed() {
<span class="nc" id="L248">        return mAllowTouchInterceptionWhileZoomed;</span>
    }

    /**
     * If this is set to true, parent views can intercept touch events while the view is zoomed. For
     * example, this can be used to swipe between images in a view pager while zoomed.
     *
     * @param allowTouchInterceptionWhileZoomed true if the parent needs to intercept touches
     */
    public void setAllowTouchInterceptionWhileZoomed(boolean allowTouchInterceptionWhileZoomed) {
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8279)) {</span>
<span class="nc" id="L259">            mAllowTouchInterceptionWhileZoomed = allowTouchInterceptionWhileZoomed;</span>
        }
<span class="nc" id="L261">    }</span>

    /**
     * Sets the tap listener.
     */
    public void setTapListener(GestureDetector.SimpleOnGestureListener tapListener) {
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8280)) {</span>
<span class="nc" id="L268">            mTapListenerWrapper.setListener(tapListener);</span>
        }
<span class="nc" id="L270">    }</span>

    /**
     * Sets whether long-press tap detection is enabled. Unfortunately, long-press conflicts with
     * onDoubleTapEvent.
     */
    public void setIsLongpressEnabled(boolean enabled) {
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8281)) {</span>
<span class="nc" id="L278">            mTapGestureDetector.setIsLongpressEnabled(enabled);</span>
        }
<span class="nc" id="L280">    }</span>

    public void setZoomingEnabled(boolean zoomingEnabled) {
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8282)) {</span>
<span class="nc" id="L284">            mZoomingEnabled = zoomingEnabled;</span>
        }
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8283)) {</span>
<span class="nc" id="L287">            mZoomableController.setEnabled(false);</span>
        }
<span class="nc" id="L289">    }</span>

    /**
     * Sets the image controller.
     */
    @Override
    public void setController(@Nullable DraweeController controller) {
<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8284)) {</span>
<span class="nc" id="L297">            setControllers(controller, null);</span>
        }
<span class="nc" id="L299">    }</span>

    /**
     * Sets the controllers for the normal and huge image.
     *
     * &lt;p&gt;The huge image controller is used after the image gets scaled above a certain threshold.
     *
     * &lt;p&gt;IMPORTANT: in order to avoid a flicker when switching to the huge image, the huge image
     * controller should have the normal-image-uri set as its low-res-uri.
     *
     * @param controller controller to be initially used
     * @param hugeImageController controller to be used after the client starts zooming-in
     */
    public void setControllers(@Nullable DraweeController controller, @Nullable DraweeController hugeImageController) {
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8285)) {</span>
<span class="nc" id="L314">            setControllersInternal(null, null);</span>
        }
<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8286)) {</span>
<span class="nc" id="L317">            mZoomableController.setEnabled(false);</span>
        }
<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8287)) {</span>
<span class="nc" id="L320">            setControllersInternal(controller, hugeImageController);</span>
        }
<span class="nc" id="L322">    }</span>

    private void setControllersInternal(@Nullable DraweeController controller, @Nullable DraweeController hugeImageController) {
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8288)) {</span>
<span class="nc" id="L326">            removeControllerListener(getController());</span>
        }
<span class="nc bnc" id="L328" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8289)) {</span>
<span class="nc" id="L329">            addControllerListener(controller);</span>
        }
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8290)) {</span>
<span class="nc" id="L332">            mHugeImageController = hugeImageController;</span>
        }
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8291)) {</span>
<span class="nc" id="L335">            super.setController(controller);</span>
        }
<span class="nc" id="L337">    }</span>

    private void maybeSetHugeImageController() {
<span class="nc bnc" id="L340" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8299)) {</span>
<span class="nc bnc" id="L341" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(8297) ? (mHugeImageController != null || (ListenerUtil.mutListener.listen(8296) ? (mZoomableController.getScaleFactor() &gt;= HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8295) ? (mZoomableController.getScaleFactor() &lt;= HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8294) ? (mZoomableController.getScaleFactor() &lt; HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8293) ? (mZoomableController.getScaleFactor() != HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8292) ? (mZoomableController.getScaleFactor() == HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (mZoomableController.getScaleFactor() &gt; HUGE_IMAGE_SCALE_FACTOR_THRESHOLD))))))) : (mHugeImageController != null &amp;&amp; (ListenerUtil.mutListener.listen(8296) ? (mZoomableController.getScaleFactor() &gt;= HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8295) ? (mZoomableController.getScaleFactor() &lt;= HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8294) ? (mZoomableController.getScaleFactor() &lt; HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8293) ? (mZoomableController.getScaleFactor() != HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (ListenerUtil.mutListener.listen(8292) ? (mZoomableController.getScaleFactor() == HUGE_IMAGE_SCALE_FACTOR_THRESHOLD) : (mZoomableController.getScaleFactor() &gt; HUGE_IMAGE_SCALE_FACTOR_THRESHOLD))))))))) {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8298)) {</span>
<span class="nc" id="L343">                    setControllersInternal(mHugeImageController, null);</span>
                }
            }
        }
<span class="nc" id="L347">    }</span>

    private void removeControllerListener(DraweeController controller) {
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8301)) {</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (controller instanceof AbstractDraweeController) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8300)) {</span>
<span class="nc" id="L353">                    ((AbstractDraweeController) controller).removeControllerListener(mControllerListener);</span>
                }
            }
        }
<span class="nc" id="L357">    }</span>

    private void addControllerListener(DraweeController controller) {
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8303)) {</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">            if (controller instanceof AbstractDraweeController) {</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8302)) {</span>
<span class="nc" id="L363">                    ((AbstractDraweeController) controller).addControllerListener(mControllerListener);</span>
                }
            }
        }
<span class="nc" id="L367">    }</span>

    @Override
    protected void onDraw(Canvas canvas) {
<span class="nc" id="L371">        int saveCount = canvas.save();</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8304)) {</span>
<span class="nc" id="L373">            canvas.concat(mZoomableController.getTransform());</span>
        }
        try {
<span class="nc bnc" id="L376" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8308)) {</span>
<span class="nc" id="L377">                super.onDraw(canvas);</span>
            }
<span class="nc" id="L379">        } catch (Exception e) {</span>
<span class="nc" id="L380">            DraweeController controller = getController();</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8307)) {</span>
<span class="nc bnc" id="L382" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8305) ? (controller != null || controller instanceof AbstractDraweeController) : (controller != null &amp;&amp; controller instanceof AbstractDraweeController))) {</span>
<span class="nc" id="L383">                    Object callerContext = ((AbstractDraweeController) controller).getCallerContext();</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8306)) {</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                        if (callerContext != null) {</span>
<span class="nc" id="L386">                            throw new RuntimeException(String.format(&quot;Exception in onDraw, callerContext=%s&quot;, callerContext.toString()), e);</span>
                        }
                    }
                }
            }
<span class="nc" id="L391">            throw e;</span>
<span class="nc" id="L392">        }</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8309)) {</span>
<span class="nc" id="L394">            canvas.restoreToCount(saveCount);</span>
        }
<span class="nc" id="L396">    }</span>

    @Override
    public boolean onTouchEvent(MotionEvent event) {
<span class="nc" id="L400">        int a = event.getActionMasked();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8310)) {</span>
<span class="nc" id="L402">            FLog.v(getLogTag(), &quot;onTouchEvent: %d, view %x, received&quot;, a, this.hashCode());</span>
        }
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8313)) {</span>
<span class="nc bnc" id="L405" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8311) ? (!mIsDialtoneEnabled || mTapGestureDetector.onTouchEvent(event)) : (!mIsDialtoneEnabled &amp;&amp; mTapGestureDetector.onTouchEvent(event)))) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8312)) {</span>
<span class="nc" id="L407">                    FLog.v(getLogTag(), &quot;onTouchEvent: %d, view %x, handled by tap gesture detector&quot;, a, this.hashCode());</span>
                }
<span class="nc" id="L409">                return true;</span>
            }
        }
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8319)) {</span>
<span class="nc bnc" id="L413" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8314) ? (!mIsDialtoneEnabled || mZoomableController.onTouchEvent(event)) : (!mIsDialtoneEnabled &amp;&amp; mZoomableController.onTouchEvent(event)))) {</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8315)) {</span>
<span class="nc" id="L415">                    FLog.v(getLogTag(), &quot;onTouchEvent: %d, view %x, handled by zoomable controller&quot;, a, this.hashCode());</span>
                }
<span class="nc bnc" id="L417" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8318)) {</span>
<span class="nc bnc" id="L418" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(8316) ? (!mAllowTouchInterceptionWhileZoomed || !mZoomableController.isIdentity()) : (!mAllowTouchInterceptionWhileZoomed &amp;&amp; !mZoomableController.isIdentity()))) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8317)) {</span>
<span class="nc" id="L420">                            getParent().requestDisallowInterceptTouchEvent(true);</span>
                        }
                    }
                }
<span class="nc" id="L424">                return true;</span>
            }
        }
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8321)) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">            if (super.onTouchEvent(event)) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8320)) {</span>
<span class="nc" id="L430">                    FLog.v(getLogTag(), &quot;onTouchEvent: %d, view %x, handled by the super&quot;, a, this.hashCode());</span>
                }
<span class="nc" id="L432">                return true;</span>
            }
        }
        // To prevent that we explicitly send one last cancel event when returning false.
<span class="nc" id="L436">        MotionEvent cancelEvent = MotionEvent.obtain(event);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8322)) {</span>
<span class="nc" id="L438">            cancelEvent.setAction(MotionEvent.ACTION_CANCEL);</span>
        }
<span class="nc bnc" id="L440" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8323)) {</span>
<span class="nc" id="L441">            mTapGestureDetector.onTouchEvent(cancelEvent);</span>
        }
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8324)) {</span>
<span class="nc" id="L444">            mZoomableController.onTouchEvent(cancelEvent);</span>
        }
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8325)) {</span>
<span class="nc" id="L447">            cancelEvent.recycle();</span>
        }
<span class="nc" id="L449">        return false;</span>
    }

    @Override
    public int computeHorizontalScrollRange() {
<span class="nc" id="L454">        return mZoomableController.computeHorizontalScrollRange();</span>
    }

    @Override
    public int computeHorizontalScrollOffset() {
<span class="nc" id="L459">        return mZoomableController.computeHorizontalScrollOffset();</span>
    }

    @Override
    public int computeHorizontalScrollExtent() {
<span class="nc" id="L464">        return mZoomableController.computeHorizontalScrollExtent();</span>
    }

    @Override
    public int computeVerticalScrollRange() {
<span class="nc" id="L469">        return mZoomableController.computeVerticalScrollRange();</span>
    }

    @Override
    public int computeVerticalScrollOffset() {
<span class="nc" id="L474">        return mZoomableController.computeVerticalScrollOffset();</span>
    }

    @Override
    public int computeVerticalScrollExtent() {
<span class="nc" id="L479">        return mZoomableController.computeVerticalScrollExtent();</span>
    }

    @Override
    protected void onLayout(boolean changed, int left, int top, int right, int bottom) {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8326)) {</span>
<span class="nc" id="L485">            FLog.v(getLogTag(), &quot;onLayout: view %x&quot;, this.hashCode());</span>
        }
<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8327)) {</span>
<span class="nc" id="L488">            super.onLayout(changed, left, top, right, bottom);</span>
        }
<span class="nc bnc" id="L490" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8328)) {</span>
<span class="nc" id="L491">            updateZoomableControllerBounds();</span>
        }
<span class="nc" id="L493">    }</span>

    private void onFinalImageSet() {
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8329)) {</span>
<span class="nc" id="L497">            FLog.v(getLogTag(), &quot;onFinalImageSet: view %x&quot;, this.hashCode());</span>
        }
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8333)) {</span>
<span class="nc bnc" id="L500" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(8330) ? (!mZoomableController.isEnabled() || mZoomingEnabled) : (!mZoomableController.isEnabled() &amp;&amp; mZoomingEnabled))) {</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8331)) {</span>
<span class="nc" id="L502">                    mZoomableController.setEnabled(true);</span>
                }
<span class="nc bnc" id="L504" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8332)) {</span>
<span class="nc" id="L505">                    updateZoomableControllerBounds();</span>
                }
            }
        }
<span class="nc" id="L509">    }</span>

    private void onRelease() {
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8334)) {</span>
<span class="nc" id="L513">            FLog.v(getLogTag(), &quot;onRelease: view %x&quot;, this.hashCode());</span>
        }
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8335)) {</span>
<span class="nc" id="L516">            mZoomableController.setEnabled(false);</span>
        }
<span class="nc" id="L518">    }</span>

    protected void onTransformChanged(Matrix transform) {
<span class="nc bnc" id="L521" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8336)) {</span>
<span class="nc" id="L522">            FLog.v(getLogTag(), &quot;onTransformChanged: view %x, transform: %s&quot;, this.hashCode(), transform);</span>
        }
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8337)) {</span>
<span class="nc" id="L525">            maybeSetHugeImageController();</span>
        }
<span class="nc bnc" id="L527" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8338)) {</span>
<span class="nc" id="L528">            invalidate();</span>
        }
<span class="nc" id="L530">    }</span>

    protected void updateZoomableControllerBounds() {
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8339)) {</span>
<span class="nc" id="L534">            getImageBounds(mImageBounds);</span>
        }
<span class="nc bnc" id="L536" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8340)) {</span>
<span class="nc" id="L537">            getLimitBounds(mViewBounds);</span>
        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8341)) {</span>
<span class="nc" id="L540">            mZoomableController.setImageBounds(mImageBounds);</span>
        }
<span class="nc bnc" id="L542" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8342)) {</span>
<span class="nc" id="L543">            mZoomableController.setViewBounds(mViewBounds);</span>
        }
<span class="nc bnc" id="L545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8343)) {</span>
<span class="nc" id="L546">            FLog.v(getLogTag(), &quot;updateZoomableControllerBounds: view %x, view bounds: %s, image bounds: %s&quot;, this.hashCode(), mViewBounds, mImageBounds);</span>
        }
<span class="nc" id="L548">    }</span>

    protected Class&lt;?&gt; getLogTag() {
<span class="nc" id="L551">        return TAG;</span>
    }

    protected ZoomableController createZoomableController() {
<span class="nc" id="L555">        return AnimatedZoomableController.newInstance();</span>
    }

    /**
     * Use this, If someone is willing to listen to scale change
     */
    public interface TransformationListener {

        void onTransformationEnd();
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.2</div></body></html>