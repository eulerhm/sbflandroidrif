<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Application.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.app</a> &gt; <span class="el_source">Application.java</span></div><h1>Application.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012-2017 Paul Watts (paulcwatts@gmail.com), 
 * University of South Florida, Microsoft Corporation.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.app;

import android.app.NotificationChannel;
import android.app.NotificationManager;
import android.content.Context;
import android.content.SharedPreferences;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.hardware.GeomagneticField;
import android.location.Location;
import android.location.LocationManager;
import android.os.Build;
import android.os.PowerManager;
import android.preference.PreferenceManager;
import android.text.TextUtils;
import android.util.Log;
import androidx.multidex.MultiDexApplication;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.GoogleApiAvailability;
import com.google.android.gms.common.api.GoogleApiClient;
import com.google.android.gms.location.FusedLocationProviderClient;
import com.google.android.gms.tasks.Task;
import com.google.firebase.analytics.FirebaseAnalytics;
import org.onebusaway.android.BuildConfig;
import org.onebusaway.android.R;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.io.ObaApi;
import org.onebusaway.android.io.elements.ObaRegion;
import org.onebusaway.android.provider.ObaContract;
import org.onebusaway.android.travelbehavior.TravelBehaviorManager;
import org.onebusaway.android.util.BuildFlavorUtils;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.PreferenceUtils;
import java.security.MessageDigest;
import java.util.Iterator;
import java.util.List;
import java.util.UUID;
import edu.usf.cutr.open311client.Open311Manager;
import edu.usf.cutr.open311client.models.Open311Option;
import static com.google.android.gms.location.LocationServices.getFusedLocationProviderClient;
import static org.onebusaway.android.util.UIUtils.setAppTheme;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="fc" id="L61">public class Application extends MultiDexApplication {</span>

    public static final String APP_UID = &quot;app_uid&quot;;

    // Region preference (long id)
    private static final String TAG = &quot;Application&quot;;

    public static final String CHANNEL_TRIP_PLAN_UPDATES_ID = &quot;trip_plan_updates&quot;;

    public static final String CHANNEL_ARRIVAL_REMINDERS_ID = &quot;arrival_reminders&quot;;

    public static final String CHANNEL_DESTINATION_ALERT_ID = &quot;destination_alerts&quot;;

    private SharedPreferences mPrefs;

    private static Application mApp;

    /**
     * We centralize location tracking in the Application class to allow all objects to make
     * use of the last known location that we've seen.  This is more reliable than using the
     * getLastKnownLocation() method of the location providers, and allows us to track both
     * Location
     * API v1 and fused provider.  It allows us to avoid strange behavior like animating a map view
     * change when opening a new Activity, even when the previous Activity had a current location.
     */
<span class="fc" id="L86">    private static Location mLastKnownLocation = null;</span>

    // Magnetic declination is based on location, so track this centrally too.
<span class="fc" id="L89">    static GeomagneticField mGeomagneticField = null;</span>

    private FirebaseAnalytics mFirebaseAnalytics;

    @Override
    public void onCreate() {
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6274)) {</span>
<span class="fc" id="L96">            super.onCreate();</span>
        }
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6275)) {</span>
<span class="fc" id="L99">            mApp = this;</span>
        }
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6276)) {</span>
<span class="fc" id="L102">            mPrefs = PreferenceManager.getDefaultSharedPreferences(this);</span>
        }
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6277)) {</span>
<span class="fc" id="L105">            initOba();</span>
        }
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6278)) {</span>
<span class="fc" id="L108">            initObaRegion();</span>
        }
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6279)) {</span>
<span class="fc" id="L111">            initOpen311(getCurrentRegion());</span>
        }
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6280)) {</span>
<span class="fc" id="L114">            reportAnalytics();</span>
        }
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6281)) {</span>
<span class="fc" id="L117">            createNotificationChannels();</span>
        }
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6282)) {</span>
<span class="fc" id="L120">            TravelBehaviorManager.startCollectingData(getApplicationContext());</span>
        }
<span class="fc" id="L122">    }</span>

    /**
     * Per http://developer.android.com/reference/android/app/Application.html#onTerminate(),
     * this code is only executed in emulated process environments - it will never be called
     * on a production Android device.
     */
    @Override
    public void onTerminate() {
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6283)) {</span>
<span class="nc" id="L132">            super.onTerminate();</span>
        }
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6284)) {</span>
<span class="nc" id="L135">            mApp = null;</span>
        }
<span class="nc" id="L137">    }</span>

    // 
    public static Application get() {
<span class="fc" id="L141">        return mApp;</span>
    }

    public static SharedPreferences getPrefs() {
<span class="fc" id="L145">        return get().mPrefs;</span>
    }

    /**
     * Returns the last known location that the application has seen, or null if we haven't seen a
     * location yet.  When trying to get a most recent location in one shot, this method should
     * always be called.
     *
     * @param cxt    The Context being used, or null if one isn't available
     * @param client The GoogleApiClient being used to obtain fused provider updates, or null if
     *               one
     *               isn't available
     * @return the last known location that the application has seen, or null if we haven't seen a
     * location yet
     */
    public static synchronized Location getLastKnownLocation(Context cxt, GoogleApiClient client) {
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6287)) {</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            if (mLastKnownLocation == null) {</span>
                // Try to get a last known location from the location providers
                try {
<span class="nc bnc" id="L165" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6286)) {</span>
<span class="nc" id="L166">                        mLastKnownLocation = getLocation2(cxt, client);</span>
                    }
<span class="nc" id="L168">                } catch (SecurityException e) {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6285)) {</span>
<span class="nc" id="L170">                        Log.e(TAG, &quot;User may have denied location permission - &quot; + e);</span>
                    }
<span class="nc" id="L172">                }</span>
            }
        }
        // Pass back last known saved location, hopefully from past location listener updates
<span class="nc" id="L176">        return mLastKnownLocation;</span>
    }

    /**
     * Sets the last known location observed by the application via an instance of LocationHelper
     *
     * @param l a location received by a LocationHelper instance
     */
    public static synchronized void setLastKnownLocation(Location l) {
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6292)) {</span>
            // If the new location is better than the old one, save it
<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (LocationUtils.compareLocations(l, mLastKnownLocation)) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6289)) {</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">                    if (mLastKnownLocation == null) {</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6288)) {</span>
<span class="nc" id="L191">                            mLastKnownLocation = new Location(&quot;Last known location&quot;);</span>
                        }
                    }
                }
<span class="nc bnc" id="L195" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6290)) {</span>
<span class="nc" id="L196">                    mLastKnownLocation.set(l);</span>
                }
<span class="nc bnc" id="L198" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6291)) {</span>
<span class="nc" id="L199">                    mGeomagneticField = new GeomagneticField((float) l.getLatitude(), (float) l.getLongitude(), (float) l.getAltitude(), System.currentTimeMillis());</span>
                }
            }
        }
<span class="nc" id="L203">    }</span>

    /**
     * Returns the declination of the horizontal component of the magnetic field from true north,
     * in
     * degrees (i.e. positive means the magnetic field is rotated east that much from true north).
     *
     * @return declination of the horizontal component of the magnetic field from true north, in
     * degrees (i.e. positive means the magnetic field is rotated east that much from true north),
     * or null if its not available
     */
    public static Float getMagneticDeclination() {
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (mGeomagneticField != null) {</span>
<span class="nc" id="L216">            return mGeomagneticField.getDeclination();</span>
        } else {
<span class="nc" id="L218">            return null;</span>
        }
    }

    /**
     * We need to provide the API for a location used to disambiguate stop IDs in case of
     * collision,
     * or to provide multiple results in the case multiple agencies. But we really don't need it to
     * be very accurate.
     * &lt;p/&gt;
     * Note that the GoogleApiClient must already have been initialized and connected prior to
     * calling
     * this method, since GoogleApiClient.connect() is asynchronous and doesn't connect before it
     * returns,
     * which requires additional initialization time (prior to calling this method)
     *
     * @param client an initialized and connected GoogleApiClient, or null if Google Play Services
     *               isn't available
     * @return a recent location, considering both Google Play Services (if available) and the
     * Android Location API
     */
    private static Location getLocation(Context cxt, GoogleApiClient client) {
<span class="nc" id="L240">        Location last = getLocation2(cxt, client);</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (last != null) {</span>
<span class="nc" id="L242">            return last;</span>
        } else {
<span class="nc" id="L244">            return LocationUtils.getDefaultSearchCenter();</span>
        }
    }

    /**
     * Returns a location, considering both Google Play Services (if available) and the Android
     * Location API
     * &lt;p/&gt;
     * Note that the GoogleApiClient must already have been initialized and connected prior to
     * calling
     * this method, since GoogleApiClient.connect() is asynchronous and doesn't connect before it
     * returns,
     * which requires additional initialization time (prior to calling this method)
     *
     * @param client an initialized and connected GoogleApiClient, or null if Google Play Services
     *               isn't available
     * @return a recent location, considering both Google Play Services (if available) and the
     * Android Location API
     * @throws SecurityException if the user has remove location permissions
     */
    private static Location getLocation2(Context cxt, GoogleApiClient client) throws SecurityException {
<span class="nc" id="L265">        GoogleApiAvailability api = GoogleApiAvailability.getInstance();</span>
<span class="nc" id="L266">        Location playServices = null;</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6299)) {</span>
<span class="nc bnc" id="L268" title="All 58 branches missed.">            if ((ListenerUtil.mutListener.listen(6295) ? ((ListenerUtil.mutListener.listen(6294) ? ((ListenerUtil.mutListener.listen(6293) ? (client != null || cxt != null) : (client != null &amp;&amp; cxt != null)) || api.isGooglePlayServicesAvailable(cxt) == ConnectionResult.SUCCESS) : ((ListenerUtil.mutListener.listen(6293) ? (client != null || cxt != null) : (client != null &amp;&amp; cxt != null)) &amp;&amp; api.isGooglePlayServicesAvailable(cxt) == ConnectionResult.SUCCESS)) || client.isConnected()) : ((ListenerUtil.mutListener.listen(6294) ? ((ListenerUtil.mutListener.listen(6293) ? (client != null || cxt != null) : (client != null &amp;&amp; cxt != null)) || api.isGooglePlayServicesAvailable(cxt) == ConnectionResult.SUCCESS) : ((ListenerUtil.mutListener.listen(6293) ? (client != null || cxt != null) : (client != null &amp;&amp; cxt != null)) &amp;&amp; api.isGooglePlayServicesAvailable(cxt) == ConnectionResult.SUCCESS)) &amp;&amp; client.isConnected()))) {</span>
<span class="nc" id="L269">                FusedLocationProviderClient fusedClient = getFusedLocationProviderClient(cxt);</span>
<span class="nc" id="L270">                Task&lt;Location&gt; task = fusedClient.getLastLocation();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6298)) {</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                    if (task.isComplete()) {</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6296)) {</span>
<span class="nc" id="L274">                            playServices = task.getResult();</span>
                        }
<span class="nc bnc" id="L276" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6297)) {</span>
<span class="nc" id="L277">                            Log.d(TAG, &quot;Got location from Google Play Services, testing against API v1...&quot;);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L283">        Location apiV1 = getLocationApiV1(cxt);</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (LocationUtils.compareLocationsByTime(playServices, apiV1)) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6301)) {</span>
<span class="nc" id="L286">                Log.d(TAG, &quot;Using location from Google Play Services&quot;);</span>
            }
<span class="nc" id="L288">            return playServices;</span>
        } else {
<span class="nc bnc" id="L290" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6300)) {</span>
<span class="nc" id="L291">                Log.d(TAG, &quot;Using location from Location API v1&quot;);</span>
            }
<span class="nc" id="L293">            return apiV1;</span>
        }
    }

    private static Location getLocationApiV1(Context cxt) {
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6302)) {</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (cxt == null) {</span>
<span class="nc" id="L300">                return null;</span>
            }
        }
<span class="nc" id="L303">        LocationManager mgr = (LocationManager) cxt.getSystemService(Context.LOCATION_SERVICE);</span>
<span class="nc" id="L304">        List&lt;String&gt; providers = mgr.getProviders(true);</span>
<span class="nc" id="L305">        Location last = null;</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6307)) {</span>
            {
<span class="nc" id="L308">                long _loopCounter64 = 0;</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                for (Iterator&lt;String&gt; i = providers.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L310">                    ListenerUtil.loopListener.listen(&quot;_loopCounter64&quot;, ++_loopCounter64);</span>
<span class="nc" id="L311">                    Location loc = null;</span>
                    try {
<span class="nc bnc" id="L313" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6304)) {</span>
<span class="nc" id="L314">                            loc = mgr.getLastKnownLocation(i.next());</span>
                        }
<span class="nc" id="L316">                    } catch (SecurityException e) {</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6303)) {</span>
<span class="nc" id="L318">                            Log.w(TAG, &quot;User may have denied location permission - &quot; + e);</span>
                        }
<span class="nc" id="L320">                    }</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6306)) {</span>
                        // 2. Our last location is older than this location.
<span class="nc bnc" id="L323" title="All 2 branches missed.">                        if (LocationUtils.compareLocationsByTime(loc, last)) {</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6305)) {</span>
<span class="nc" id="L325">                                last = loc;</span>
                            }
                        }
                    }
<span class="nc" id="L329">                }</span>
            }
        }
<span class="nc" id="L332">        return last;</span>
    }

    // 
    public synchronized ObaRegion getCurrentRegion() {
<span class="fc" id="L337">        return ObaApi.getDefaultContext().getRegion();</span>
    }

    public synchronized void setCurrentRegion(ObaRegion region) {
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6308)) {</span>
<span class="fc" id="L342">            setCurrentRegion(region, true);</span>
        }
<span class="fc" id="L344">    }</span>

    public synchronized void setCurrentRegion(ObaRegion region, boolean regionChanged) {
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6318)) {</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">            if (region != null) {</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6311)) {</span>
                    // First set it in preferences, then set it in OBA.
<span class="fc" id="L351">                    ObaApi.getDefaultContext().setRegion(region);</span>
                }
<span class="pc bpc" id="L353" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6312)) {</span>
<span class="fc" id="L354">                    PreferenceUtils.saveLong(mPrefs, getString(R.string.preference_key_region), region.getId());</span>
                }
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6313)) {</span>
                    // We're using a region, so clear the custom API URL preference
<span class="fc" id="L358">                    setCustomApiUrl(null);</span>
                }
<span class="pc bpc" id="L360" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6317)) {</span>
<span class="pc bpc" id="L361" title="7 of 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(6314) ? (regionChanged || region.getOtpBaseUrl() != null) : (regionChanged &amp;&amp; region.getOtpBaseUrl() != null))) {</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6315)) {</span>
<span class="fc" id="L363">                            setCustomOtpApiUrl(null);</span>
                        }
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6316)) {</span>
<span class="fc" id="L366">                            setUseOldOtpApiUrlVersion(false);</span>
                        }
                    }
                }
            } else {
<span class="pc bpc" id="L371" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6309)) {</span>
                    // User must have just entered a custom API URL via Preferences, so clear the region info
<span class="fc" id="L373">                    ObaApi.getDefaultContext().setRegion(null);</span>
                }
<span class="pc bpc" id="L375" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6310)) {</span>
<span class="fc" id="L376">                    PreferenceUtils.saveLong(mPrefs, getString(R.string.preference_key_region), -1);</span>
                }
            }
        }
<span class="pc bpc" id="L380" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6319)) {</span>
            // Init the reporting with the new endpoints
<span class="fc" id="L382">            initOpen311(region);</span>
        }
<span class="fc" id="L384">    }</span>

    /**
     * Gets the date at which the region information was last updated, in the number of
     * milliseconds
     * since January 1, 1970, 00:00:00 GMT
     * Default value is 0 if the region info has never been updated.
     *
     * @return the date at which the region information was last updated, in the number of
     * milliseconds since January 1, 1970, 00:00:00 GMT.  Default value is 0 if the region info has
     * never been updated.
     */
    public long getLastRegionUpdateDate() {
<span class="nc" id="L397">        SharedPreferences preferences = getPrefs();</span>
<span class="nc" id="L398">        return preferences.getLong(getString(R.string.preference_key_last_region_update), 0);</span>
    }

    /**
     * Sets the date at which the region information was last updated
     *
     * @param date the date at which the region information was last updated, in the number of
     *             milliseconds since January 1, 1970, 00:00:00 GMT
     */
    public void setLastRegionUpdateDate(long date) {
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6320)) {</span>
<span class="nc" id="L409">            PreferenceUtils.saveLong(mPrefs, getString(R.string.preference_key_last_region_update), date);</span>
        }
<span class="nc" id="L411">    }</span>

    /**
     * Returns the custom URL if the user has set a custom API URL manually via Preferences, or
     * null
     * if it has not been set
     *
     * @return the custom URL if the user has set a custom API URL manually via Preferences, or null
     * if it has not been set
     */
    public String getCustomApiUrl() {
<span class="fc" id="L422">        SharedPreferences preferences = getPrefs();</span>
<span class="fc" id="L423">        return preferences.getString(getString(R.string.preference_key_oba_api_url), null);</span>
    }

    /**
     * Sets the custom URL used to reach a OBA REST API server that is not available via the
     * Regions
     * REST API
     *
     * @param url the custom URL
     */
    public void setCustomApiUrl(String url) {
<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6321)) {</span>
<span class="fc" id="L435">            PreferenceUtils.saveString(getString(R.string.preference_key_oba_api_url), url);</span>
        }
<span class="fc" id="L437">    }</span>

    /**
     * Returns the custom OTP URL if the user has set a custom API URL manually via Preferences, or
     * null
     * if it has not been set
     *
     * @return the custom URL if the user has set a custom API URL manually via Preferences, or null
     * if it has not been set
     */
    public String getCustomOtpApiUrl() {
<span class="nc" id="L448">        SharedPreferences preferences = getPrefs();</span>
<span class="nc" id="L449">        return preferences.getString(getString(R.string.preference_key_otp_api_url), null);</span>
    }

    /**
     * Sets the custom OTP URL used to reach a OBA REST API server that is not available via the
     * Regions
     * REST API
     *
     * @param url the custom URL
     */
    public void setCustomOtpApiUrl(String url) {
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6322)) {</span>
<span class="fc" id="L461">            PreferenceUtils.saveString(getString(R.string.preference_key_otp_api_url), url);</span>
        }
<span class="fc" id="L463">    }</span>

    /**
     * @return true if the OTP url version is old, or false  if it has not been set
     */
    public boolean getUseOldOtpApiUrlVersion() {
<span class="nc" id="L469">        SharedPreferences preferences = getPrefs();</span>
<span class="nc" id="L470">        return preferences.getBoolean(getString(R.string.preference_key_otp_api_url_version), false);</span>
    }

    /**
     * Sets the OTP Api url version
     *
     * @param useOldOtpApiUrlVersion indicates that if otp url structure belongs to older version
     */
    public void setUseOldOtpApiUrlVersion(boolean useOldOtpApiUrlVersion) {
<span class="pc bpc" id="L479" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6323)) {</span>
<span class="fc" id="L480">            PreferenceUtils.saveBoolean(getString(R.string.preference_key_otp_api_url_version), useOldOtpApiUrlVersion);</span>
        }
<span class="fc" id="L482">    }</span>

    private static final String HEXES = &quot;0123456789abcdef&quot;;

    public static String getHex(byte[] raw) {
<span class="nc bnc" id="L487" title="All 8 branches missed.">        final StringBuilder hex = new StringBuilder((ListenerUtil.mutListener.listen(6327) ? (2 % raw.length) : (ListenerUtil.mutListener.listen(6326) ? (2 / raw.length) : (ListenerUtil.mutListener.listen(6325) ? (2 - raw.length) : (ListenerUtil.mutListener.listen(6324) ? (2 + raw.length) : (2 * raw.length))))));</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6329)) {</span>
            {
<span class="nc" id="L490">                long _loopCounter65 = 0;</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">                for (byte b : raw) {</span>
<span class="nc" id="L492">                    ListenerUtil.loopListener.listen(&quot;_loopCounter65&quot;, ++_loopCounter65);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6328)) {</span>
<span class="nc" id="L494">                        hex.append(HEXES.charAt((b &amp; 0xF0) &gt;&gt; 4)).append(HEXES.charAt((b &amp; 0x0F)));</span>
                    }
                }
            }
        }
<span class="nc" id="L499">        return hex.toString();</span>
    }

    private String getAppUid() {
<span class="fc" id="L503">        return UUID.randomUUID().toString();</span>
    }

    private void initOba() {
<span class="fc" id="L507">        String uuid = mPrefs.getString(APP_UID, null);</span>
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6332)) {</span>
<span class="pc bpc" id="L509" title="1 of 2 branches missed.">            if (uuid == null) {</span>
<span class="pc bpc" id="L510" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6330)) {</span>
                    // Generate one and save that.
<span class="fc" id="L512">                    uuid = getAppUid();</span>
                }
<span class="pc bpc" id="L514" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6331)) {</span>
<span class="fc" id="L515">                    PreferenceUtils.saveString(APP_UID, uuid);</span>
                }
            }
        }
<span class="pc bpc" id="L519" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6333)) {</span>
<span class="fc" id="L520">            checkArrivalStylePreferenceDefault();</span>
        }
<span class="pc bpc" id="L522" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6334)) {</span>
<span class="fc" id="L523">            checkDarkMode();</span>
        }
        // Get the current app version.
<span class="fc" id="L526">        PackageManager pm = getPackageManager();</span>
<span class="fc" id="L527">        PackageInfo appInfo = null;</span>
        try {
<span class="pc bpc" id="L529" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6335)) {</span>
<span class="fc" id="L530">                appInfo = pm.getPackageInfo(getPackageName(), PackageManager.GET_META_DATA);</span>
            }
<span class="nc" id="L532">        } catch (NameNotFoundException e) {</span>
            // Do nothing, perhaps we'll get to show it again? Or never.
<span class="nc" id="L534">            return;</span>
<span class="fc" id="L535">        }</span>
<span class="pc bpc" id="L536" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6336)) {</span>
<span class="fc" id="L537">            ObaApi.getDefaultContext().setAppInfo(appInfo.versionCode, uuid);</span>
        }
<span class="fc" id="L539">    }</span>

    private void checkArrivalStylePreferenceDefault() {
<span class="fc" id="L542">        String arrivalInfoStylePrefKey = getResources().getString(R.string.preference_key_arrival_info_style);</span>
<span class="fc" id="L543">        String arrivalInfoStylePref = mPrefs.getString(arrivalInfoStylePrefKey, null);</span>
<span class="pc bpc" id="L544" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6344)) {</span>
<span class="pc bpc" id="L545" title="1 of 2 branches missed.">            if (arrivalInfoStylePref == null) {</span>
<span class="pc bpc" id="L546" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6343)) {</span>
                    // First execution of app - set the default arrival info style based on the BuildConfig value
<span class="pc bpc" id="L548" title="2 of 3 branches missed.">                    switch(BuildConfig.ARRIVAL_INFO_STYLE) {</span>
                        case BuildFlavorUtils.ARRIVAL_INFO_STYLE_A:
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6337)) {</span>
                                // Use OBA classic style for default
<span class="fc" id="L552">                                PreferenceUtils.saveString(arrivalInfoStylePrefKey, BuildFlavorUtils.getPreferenceOptionForArrivalInfoBuildFlavorStyle(BuildFlavorUtils.ARRIVAL_INFO_STYLE_A));</span>
                            }
<span class="pc bpc" id="L554" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6338)) {</span>
<span class="fc" id="L555">                                Log.d(TAG, &quot;Using arrival info style A (OBA Classic) as default preference&quot;);</span>
                            }
                            break;
                        case BuildFlavorUtils.ARRIVAL_INFO_STYLE_B:
<span class="nc bnc" id="L559" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6339)) {</span>
                                // Use a card-styled footer for default
<span class="nc" id="L561">                                PreferenceUtils.saveString(arrivalInfoStylePrefKey, BuildFlavorUtils.getPreferenceOptionForArrivalInfoBuildFlavorStyle(BuildFlavorUtils.ARRIVAL_INFO_STYLE_B));</span>
                            }
<span class="nc bnc" id="L563" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6340)) {</span>
<span class="nc" id="L564">                                Log.d(TAG, &quot;Using arrival info style B (Cards) as default preference&quot;);</span>
                            }
                            break;
                        default:
<span class="nc bnc" id="L568" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6341)) {</span>
                                // Use a card-styled footer for default
<span class="nc" id="L570">                                PreferenceUtils.saveString(arrivalInfoStylePrefKey, BuildFlavorUtils.getPreferenceOptionForArrivalInfoBuildFlavorStyle(BuildFlavorUtils.ARRIVAL_INFO_STYLE_B));</span>
                            }
<span class="nc bnc" id="L572" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6342)) {</span>
<span class="nc" id="L573">                                Log.d(TAG, &quot;Using arrival info style B (Cards) as default preference&quot;);</span>
                            }
                            break;
                    }
                }
            }
        }
<span class="fc" id="L580">    }</span>

    private void checkDarkMode() {
<span class="fc" id="L583">        String appThemePrefKey = getResources().getString(R.string.preference_key_app_theme);</span>
<span class="fc" id="L584">        String appThemePref = mPrefs.getString(appThemePrefKey, null);</span>
<span class="pc bpc" id="L585" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6346)) {</span>
<span class="pc bpc" id="L586" title="1 of 2 branches missed.">            if (appThemePref != null) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6345)) {</span>
<span class="nc" id="L588">                    setAppTheme(appThemePref);</span>
                }
            }
        }
<span class="fc" id="L592">    }</span>

    private void initObaRegion() {
        // Read the region preference, look it up in the DB, then set the region.
<span class="fc" id="L596">        long id = mPrefs.getLong(getString(R.string.preference_key_region), -1);</span>
<span class="pc bpc" id="L597" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6353)) {</span>
<span class="pc bpc" id="L598" title="16 of 22 branches missed.">            if ((ListenerUtil.mutListener.listen(6351) ? (id &gt;= 0) : (ListenerUtil.mutListener.listen(6350) ? (id &lt;= 0) : (ListenerUtil.mutListener.listen(6349) ? (id &gt; 0) : (ListenerUtil.mutListener.listen(6348) ? (id != 0) : (ListenerUtil.mutListener.listen(6347) ? (id == 0) : (id &lt; 0))))))) {</span>
<span class="pc bpc" id="L599" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6352)) {</span>
<span class="fc" id="L600">                    Log.d(TAG, &quot;Regions preference ID is less than 0, returning...&quot;);</span>
                }
<span class="fc" id="L602">                return;</span>
            }
        }
<span class="nc" id="L605">        ObaRegion region = ObaContract.Regions.get(this, (int) id);</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6355)) {</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">            if (region == null) {</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6354)) {</span>
<span class="nc" id="L609">                    Log.d(TAG, &quot;Regions preference is null, returning...&quot;);</span>
                }
<span class="nc" id="L611">                return;</span>
            }
        }
<span class="nc bnc" id="L614" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6356)) {</span>
<span class="nc" id="L615">            ObaApi.getDefaultContext().setRegion(region);</span>
        }
<span class="nc" id="L617">    }</span>

    private void initOpen311(ObaRegion region) {
<span class="pc bpc" id="L620" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6360)) {</span>
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">            if (BuildConfig.DEBUG) {</span>
<span class="pc bpc" id="L622" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6357)) {</span>
<span class="fc" id="L623">                    Open311Manager.getSettings().setDebugMode(true);</span>
                }
<span class="pc bpc" id="L625" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6358)) {</span>
<span class="fc" id="L626">                    Open311Manager.getSettings().setDryRun(true);</span>
                }
<span class="pc bpc" id="L628" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6359)) {</span>
<span class="fc" id="L629">                    Log.w(TAG, &quot;Open311 issue reporting is in debug/dry run mode - no issues will be submitted.&quot;);</span>
                }
            }
        }
<span class="pc bpc" id="L633" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6361)) {</span>
            // Clear all open311 endpoints
<span class="fc" id="L635">            Open311Manager.clearOpen311();</span>
        }
<span class="pc bpc" id="L637" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6365)) {</span>
            // Read the open311 preferences from the region and set
<span class="pc bpc" id="L639" title="6 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(6362) ? (region != null || region.getOpen311Servers() != null) : (region != null &amp;&amp; region.getOpen311Servers() != null))) {</span>
<span class="pc bpc" id="L640" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6364)) {</span>
                    {
<span class="fc" id="L642">                        long _loopCounter66 = 0;</span>
<span class="fc bfc" id="L643" title="All 2 branches covered.">                        for (ObaRegion.Open311Server open311Server : region.getOpen311Servers()) {</span>
<span class="fc" id="L644">                            ListenerUtil.loopListener.listen(&quot;_loopCounter66&quot;, ++_loopCounter66);</span>
<span class="fc" id="L645">                            String jurisdictionId = open311Server.getJuridisctionId();</span>
<span class="pc bpc" id="L646" title="1 of 2 branches missed.">                            Open311Option option = new Open311Option(open311Server.getBaseUrl(), open311Server.getApiKey(), TextUtils.isEmpty(jurisdictionId) ? null : jurisdictionId);</span>
<span class="pc bpc" id="L647" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6363)) {</span>
<span class="fc" id="L648">                                Open311Manager.initOpen311WithOption(option);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="fc" id="L655">    }</span>

    private void reportAnalytics() {
<span class="pc bpc" id="L658" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6366)) {</span>
<span class="fc" id="L659">            mFirebaseAnalytics = FirebaseAnalytics.getInstance(this);</span>
        }
<span class="pc bpc" id="L661" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6374)) {</span>
<span class="pc bpc" id="L662" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(6367) ? (getCustomApiUrl() == null || getCurrentRegion() != null) : (getCustomApiUrl() == null &amp;&amp; getCurrentRegion() != null))) {</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6373)) {</span>
<span class="nc" id="L664">                    ObaAnalytics.setRegion(mFirebaseAnalytics, getCurrentRegion().getName());</span>
                }
<span class="pc bpc" id="L666" title="1 of 2 branches missed.">            } else if (Application.get().getCustomApiUrl() != null) {</span>
<span class="nc" id="L667">                String customUrl = null;</span>
<span class="nc" id="L668">                MessageDigest digest = null;</span>
                try {
<span class="nc bnc" id="L670" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6369)) {</span>
<span class="nc" id="L671">                        digest = MessageDigest.getInstance(&quot;SHA-1&quot;);</span>
                    }
<span class="nc bnc" id="L673" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6370)) {</span>
<span class="nc" id="L674">                        digest.update(getCustomApiUrl().getBytes());</span>
                    }
<span class="nc bnc" id="L676" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6371)) {</span>
<span class="nc" id="L677">                        customUrl = getString(R.string.analytics_label_custom_url) + &quot;: &quot; + getHex(digest.digest());</span>
                    }
<span class="nc" id="L679">                } catch (Exception e) {</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6368)) {</span>
<span class="nc" id="L681">                        customUrl = Application.get().getString(R.string.analytics_label_custom_url);</span>
                    }
<span class="nc" id="L683">                }</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6372)) {</span>
<span class="nc" id="L685">                    ObaAnalytics.setRegion(mFirebaseAnalytics, customUrl);</span>
                }
            }
        }
<span class="fc" id="L689">        Boolean experimentalRegions = getPrefs().getBoolean(getString(R.string.preference_key_experimental_regions), Boolean.FALSE);</span>
<span class="fc" id="L690">        Boolean autoRegion = getPrefs().getBoolean(getString(R.string.preference_key_auto_select_region), true);</span>
<span class="fc" id="L691">    }</span>

    /**
     * Method to check whether bikeshare layer is enabled or not.
     *
     * @return true if the bikeshare layer is an option that can be toggled on/off
     */
    public static boolean isBikeshareEnabled() {
        // process easier
<span class="nc bnc" id="L700" title="All 26 branches missed.">        return ((ListenerUtil.mutListener.listen(6376) ? (((ListenerUtil.mutListener.listen(6375) ? (Application.get().getCurrentRegion() != null || Application.get().getCurrentRegion().getSupportsOtpBikeshare()) : (Application.get().getCurrentRegion() != null &amp;&amp; Application.get().getCurrentRegion().getSupportsOtpBikeshare()))) &amp;&amp; !TextUtils.isEmpty(Application.get().getCustomOtpApiUrl())) : (((ListenerUtil.mutListener.listen(6375) ? (Application.get().getCurrentRegion() != null || Application.get().getCurrentRegion().getSupportsOtpBikeshare()) : (Application.get().getCurrentRegion() != null &amp;&amp; Application.get().getCurrentRegion().getSupportsOtpBikeshare()))) || !TextUtils.isEmpty(Application.get().getCustomOtpApiUrl()))));</span>
    }

    private void createNotificationChannels() {
<span class="pc bpc" id="L704" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6388)) {</span>
<span class="pc bpc" id="L705" title="16 of 22 branches missed.">            if ((ListenerUtil.mutListener.listen(6381) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(6380) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(6379) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(6378) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(6377) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O))))))) {</span>
<span class="fc" id="L706">                NotificationChannel channel1 = new NotificationChannel(CHANNEL_TRIP_PLAN_UPDATES_ID, &quot;Trip plan notifications (beta)&quot;, NotificationManager.IMPORTANCE_DEFAULT);</span>
<span class="pc bpc" id="L707" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6382)) {</span>
<span class="fc" id="L708">                    channel1.setDescription(&quot;After planning a trip, send notifications if the trip is delayed or no longer recommended.&quot;);</span>
                }
<span class="fc" id="L710">                NotificationChannel channel2 = new NotificationChannel(CHANNEL_ARRIVAL_REMINDERS_ID, &quot;Bus arrival notifications&quot;, NotificationManager.IMPORTANCE_DEFAULT);</span>
<span class="pc bpc" id="L711" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6383)) {</span>
<span class="fc" id="L712">                    channel2.setDescription(&quot;Notifications to remind the user of an arriving bus.&quot;);</span>
                }
<span class="fc" id="L714">                NotificationChannel channel3 = new NotificationChannel(CHANNEL_DESTINATION_ALERT_ID, &quot;Destination alerts&quot;, NotificationManager.IMPORTANCE_LOW);</span>
<span class="pc bpc" id="L715" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6384)) {</span>
<span class="fc" id="L716">                    channel2.setDescription(&quot;All notifications relating to Destination alerts&quot;);</span>
                }
<span class="fc" id="L718">                NotificationManager manager = getSystemService(NotificationManager.class);</span>
<span class="pc bpc" id="L719" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6385)) {</span>
<span class="fc" id="L720">                    manager.createNotificationChannel(channel1);</span>
                }
<span class="pc bpc" id="L722" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6386)) {</span>
<span class="fc" id="L723">                    manager.createNotificationChannel(channel2);</span>
                }
<span class="pc bpc" id="L725" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6387)) {</span>
<span class="fc" id="L726">                    manager.createNotificationChannel(channel3);</span>
                }
            }
        }
<span class="fc" id="L730">    }</span>

    public static Boolean isIgnoringBatteryOptimizations(Context applicationContext) {
<span class="nc" id="L733">        PowerManager pm = (PowerManager) applicationContext.getSystemService(Context.POWER_SERVICE);</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6395)) {</span>
<span class="nc bnc" id="L735" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(6394) ? ((ListenerUtil.mutListener.listen(6393) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6392) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6391) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6390) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6389) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.M) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M)))))) || pm.isIgnoringBatteryOptimizations(applicationContext.getPackageName())) : ((ListenerUtil.mutListener.listen(6393) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6392) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6391) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6390) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6389) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.M) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M)))))) &amp;&amp; pm.isIgnoringBatteryOptimizations(applicationContext.getPackageName())))) {</span>
<span class="nc" id="L736">                return true;</span>
            }
        }
<span class="nc bnc" id="L739" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(6401)) {</span>
<span class="nc bnc" id="L740" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(6400) ? (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6399) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6398) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6397) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(6396) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.M) : (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M))))))) {</span>
<span class="nc" id="L741">                return null;</span>
            }
        }
<span class="nc" id="L744">        return false;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>