<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NavigationDrawerFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">NavigationDrawerFragment.java</span></div><h1>NavigationDrawerFragment.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2014-2017 Google Inc.,
 * University of South Florida (sjbarbeau@gmail.com),
 * Microsoft Corporation.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Portions of code taken from the Google I/0 2014 (https://github.com/google/iosched)
 * and a generated NavigationDrawer app from Android Studio, modified for OneBusAway by USF
 */
package org.onebusaway.android.ui;


import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.io.elements.ObaRegion;
import org.onebusaway.android.util.UIUtils;
import org.onebusaway.android.view.ScrimInsetsScrollView;

import android.content.Context;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

import java.util.ArrayList;

import androidx.appcompat.app.ActionBar;
import androidx.appcompat.app.ActionBarDrawerToggle;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.view.GravityCompat;
import androidx.drawerlayout.widget.DrawerLayout;
import androidx.fragment.app.Fragment;

/**
 * Fragment used for managing interactions for and presentation of a navigation drawer.
 * See the &lt;a href=&quot;https://developer.android.com/design/patterns/navigation-drawer.html#Interaction&quot;&gt;
 * design guidelines&lt;/a&gt; for a complete explanation of the behaviors implemented here.
 */
public class NavigationDrawerFragment extends Fragment {

    public static final String TAG = &quot;NavDrawerFragment&quot;;

    /**
     * Remember the position of the selected item.
     */
    private static final String STATE_SELECTED_POSITION = &quot;selected_navigation_drawer_position&quot;;

    // symbols for navdrawer items (indices must correspond to array below). This is
    // not a list of items that are necessarily *present* in the Nav Drawer; rather,
    // it's a list of all possible items.
    protected static final int NAVDRAWER_ITEM_NEARBY = 0;

    protected static final int NAVDRAWER_ITEM_STARRED_STOPS = 1;

    protected static final int NAVDRAWER_ITEM_STARRED_ROUTES = 2;

    protected static final int NAVDRAWER_ITEM_MY_REMINDERS = 3;

    protected static final int NAVDRAWER_ITEM_SETTINGS = 4;

    protected static final int NAVDRAWER_ITEM_HELP = 5;

    protected static final int NAVDRAWER_ITEM_SEND_FEEDBACK = 6;

    protected static final int NAVDRAWER_ITEM_PLAN_TRIP = 7;



    @Deprecated
    protected static final int NAVDRAWER_ITEM_PINS = 8;

    @Deprecated
    protected static final int NAVDRAWER_ITEM_ACTIVITY_FEED = 9;

    @Deprecated
    protected static final int NAVDRAWER_ITEM_PROFILE = 10;

    @Deprecated
    protected static final int NAVDRAWER_ITEM_SIGN_IN = 11;

    protected static final int NAVDRAWER_ITEM_OPEN_SOURCE = 12;

    protected static final int NAVDRAWER_ITEM_PAY_FARE = 13;

    protected static final int NAVDRAWER_ITEM_INVALID = -1;

    protected static final int NAVDRAWER_ITEM_SEPARATOR = -2;

    // Currently selected navigation drawer item (must be value of one of the constants above)
<span class="nc" id="L109">    private int mCurrentSelectedPosition = NAVDRAWER_ITEM_NEARBY;</span>

    // titles for navdrawer items (indices must correspond to the above)
<span class="nc" id="L112">    private static final int[] NAVDRAWER_TITLE_RES_ID = new int[]{</span>
            R.string.navdrawer_item_nearby,
            R.string.navdrawer_item_starred_stops,
            R.string.navdrawer_item_starred_routes,
            R.string.navdrawer_item_my_reminders,
            R.string.navdrawer_item_settings,
            R.string.navdrawer_item_help,
            R.string.navdrawer_item_send_feedback,
            R.string.navdrawer_item_plan_trip,
            0, // Pinned discussions
            0, // Social activity feed
            0, // My profile
            0, // Sign in
            R.string.navdrawer_item_open_source,
            R.string.navdrawer_item_pay_fare
    };

    // icons for navdrawer items (indices must correspond to above array)
<span class="nc" id="L130">    private static final int[] NAVDRAWER_ICON_RES_ID = new int[]{</span>
            R.drawable.ic_drawer_maps_place,  // Nearby
            R.drawable.ic_stop_flag_triangle, // Starred Stops
            R.drawable.ic_bus, // Starred Routes
            R.drawable.ic_drawer_alarm, // My reminders
            0, // Settings
            0, // Help
            0, // Send feedback
            R.drawable.ic_maps_directions, // Plan a trip
            0, // Pinned discussions
            0, // Social activity feed
            0, // My profile
            0, // Sign in
            R.drawable.ic_drawer_github, // Open-source
            R.drawable.ic_payment // Pay my fare
    };

    // Secondary navdrawer item icons that appear align to right of list item layout
<span class="nc" id="L148">    private static final int[] NAVDRAWER_ICON_SECONDARY_RES_ID = new int[]{</span>
            0,  // Nearby
            0, // Starred Stops
            0, // Starred Routes
            0, // My reminders
            0, // Settings
            0, // Help
            0, // Send feedback
            0, // Plan a trip
            0, // Pinned discussions
            0, // Social activity feed
            0, // My profile
            0, // Sign in
            R.drawable.ic_drawer_link, // Open-source
            R.drawable.ic_drawer_link // Pay my fare
    };

    // list of navdrawer items that were actually added to the navdrawer, in order
<span class="nc" id="L166">    private ArrayList&lt;Integer&gt; mNavDrawerItems = new ArrayList&lt;Integer&gt;();</span>

    // views that correspond to each navdrawer item, null if not yet created
<span class="nc" id="L169">    private View[] mNavDrawerItemViews = null;</span>

    /**
     * A pointer to the current callbacks instance (the Activity).
     */
    private NavigationDrawerCallbacks mCallbacks;

    /**
     * Helper component that ties the action bar to the navigation drawer.
     */
    private ActionBarDrawerToggle mDrawerToggle;

    // Navigation drawer:
    private DrawerLayout mDrawerLayout;

    private View mDrawerItemsListContainer;

    private View mFragmentContainerView;

    private boolean isSignedIn;

<span class="nc" id="L190">    public NavigationDrawerFragment() {</span>
<span class="nc" id="L191">    }</span>

    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L195">        super.onCreate(savedInstanceState);</span>
        // Read in the flag indicating whether or not the user has demonstrated awareness of the
        // drawer. See PREF_USER_LEARNED_DRAWER for details.
<span class="nc" id="L198">        SharedPreferences sp = Application.getPrefs();</span>

<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (savedInstanceState != null) {</span>
<span class="nc" id="L201">            mCurrentSelectedPosition = savedInstanceState.getInt(STATE_SELECTED_POSITION);</span>
<span class="nc" id="L202">            Log.d(TAG, &quot;Using position from savedInstanceState = &quot; + mCurrentSelectedPosition);</span>
        } else {
            // Try to get the saved position from preferences
<span class="nc" id="L205">            mCurrentSelectedPosition = sp.getInt(STATE_SELECTED_POSITION, NAVDRAWER_ITEM_NEARBY);</span>
<span class="nc" id="L206">            Log.d(TAG, &quot;Using position from preferences = &quot; + mCurrentSelectedPosition);</span>
        }

        // Select either the default item (0) or the last selected item.
<span class="nc" id="L210">        selectItem(mCurrentSelectedPosition);</span>
<span class="nc" id="L211">    }</span>

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
<span class="nc" id="L215">        super.onActivityCreated(savedInstanceState);</span>
        // Indicate that this fragment would like to influence the set of actions in the action bar.
<span class="nc" id="L217">        setHasOptionsMenu(true);</span>
<span class="nc" id="L218">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
<span class="nc" id="L223">        mDrawerItemsListContainer = inflater</span>
<span class="nc" id="L224">                .inflate(R.layout.navdrawer_list, container, false);</span>

<span class="nc" id="L226">        return mDrawerItemsListContainer;</span>
    }

    /**
     * Users of this fragment must call this method to set up the navigation drawer interactions.
     *
     * @param fragmentId   The android:id of this fragment in its activity's layout.
     * @param drawerLayout The DrawerLayout containing this fragment's UI.
     */
    public void setUp(int fragmentId, DrawerLayout drawerLayout) {
<span class="nc" id="L236">        int selfItem = mCurrentSelectedPosition;</span>
<span class="nc" id="L237">        mFragmentContainerView = getActivity().findViewById(fragmentId);</span>
<span class="nc" id="L238">        mDrawerLayout = drawerLayout;</span>

<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (mDrawerLayout == null) {</span>
<span class="nc" id="L241">            return;</span>
        }

        // set a custom shadow that overlays the main content when the drawer opens
<span class="nc" id="L245">        mDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow, GravityCompat.START);</span>
<span class="nc" id="L246">        ScrimInsetsScrollView navDrawer = (ScrimInsetsScrollView)</span>
<span class="nc" id="L247">                mDrawerLayout.findViewById(R.id.navdrawer);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">        if (selfItem == NAVDRAWER_ITEM_INVALID) {</span>
            // do not show a nav drawer
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (navDrawer != null) {</span>
<span class="nc" id="L251">                ((ViewGroup) navDrawer.getParent()).removeView(navDrawer);</span>
            }
<span class="nc" id="L253">            mDrawerLayout = null;</span>
<span class="nc" id="L254">            return;</span>
        }

        // populate the nav drawer with the correct items
<span class="nc" id="L258">        populateNavDrawer();</span>

<span class="nc" id="L260">        ActionBar actionBar = getActionBar();</span>
<span class="nc" id="L261">        actionBar.setDisplayHomeAsUpEnabled(true);</span>
<span class="nc" id="L262">        actionBar.setHomeButtonEnabled(true);</span>

        // ActionBarDrawerToggle ties together the the proper interactions
        // between the navigation drawer and the action bar app icon.
<span class="nc" id="L266">        mDrawerToggle = new androidx.appcompat.app.ActionBarDrawerToggle(</span>
<span class="nc" id="L267">                getActivity(),                    /* host Activity */</span>
                mDrawerLayout,                    /* DrawerLayout object */
                R.string.navigation_drawer_open,  /* &quot;open drawer&quot; description for accessibility */
                R.string.navigation_drawer_close  /* &quot;close drawer&quot; description for accessibility */
<span class="nc" id="L271">        ) {</span>
            @Override
            public void onDrawerClosed(View drawerView) {
<span class="nc" id="L274">                super.onDrawerClosed(drawerView);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">                if (!isAdded()) {</span>
<span class="nc" id="L276">                    return;</span>
                }

<span class="nc" id="L279">                getActivity().supportInvalidateOptionsMenu(); // calls onPrepareOptionsMenu()</span>
<span class="nc" id="L280">            }</span>

            @Override
            public void onDrawerOpened(View drawerView) {
<span class="nc" id="L284">                super.onDrawerOpened(drawerView);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                if (!isAdded()) {</span>
<span class="nc" id="L286">                    return;</span>
                }

<span class="nc" id="L289">                getActivity().supportInvalidateOptionsMenu(); // calls onPrepareOptionsMenu()</span>
<span class="nc" id="L290">            }</span>
        };

        // Defer code dependent on restoration of previous instance state.
<span class="nc" id="L294">        mDrawerLayout.post(new Runnable() {</span>
            @Override
            public void run() {
<span class="nc" id="L297">                mDrawerToggle.syncState();</span>
<span class="nc" id="L298">            }</span>
        });

<span class="nc" id="L301">        mDrawerLayout.setDrawerListener(mDrawerToggle);</span>
<span class="nc" id="L302">    }</span>

    /**
     * Sets the currently selected navigation drawer item, based on the provided position
     * parameter,
     * which must be one of the NAVDRAWER_ITEM_* contants in this class.
     *
     * @param position the item to select in the navigation drawer - must be one of the
     *                 NAVDRAWER_ITEM_* contants in this class
     */
    public void selectItem(int position) {
<span class="nc" id="L313">        setSelectedNavDrawerItem(position);</span>
<span class="nc bnc" id="L314" title="All 4 branches missed.">        if (mDrawerLayout != null &amp;&amp; mFragmentContainerView != null) {</span>
<span class="nc" id="L315">            mDrawerLayout.closeDrawer(mFragmentContainerView);</span>
        }
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (mCallbacks != null) {</span>
<span class="nc" id="L318">            mCallbacks.onNavigationDrawerItemSelected(position);</span>
        }
<span class="nc" id="L320">    }</span>

    /**
     * Set the selected position as a preference
     */
    public void setSavedPosition(int position) {
<span class="nc" id="L326">        SharedPreferences sp = Application.getPrefs();</span>
<span class="nc" id="L327">        sp.edit().putInt(STATE_SELECTED_POSITION, position).apply();</span>
<span class="nc" id="L328">    }</span>

    /**
     * Sets up the given navdrawer item's appearance to the selected state. Note: this could
     * also be accomplished (perhaps more cleanly) with state-based layouts.
     */
    private void setSelectedNavDrawerItem(int itemId) {
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (!isNewActivityItem(itemId)) {</span>
            // We only change the selected item if it doesn't launch a new activity
<span class="nc" id="L337">            mCurrentSelectedPosition = itemId;</span>
<span class="nc" id="L338">            setSavedPosition(mCurrentSelectedPosition);</span>
        }

<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (mNavDrawerItemViews != null) {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">            for (int i = 0; i &lt; mNavDrawerItemViews.length; i++) {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                if (i &lt; mNavDrawerItems.size()) {</span>
<span class="nc" id="L344">                    int thisItemId = mNavDrawerItems.get(i);</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">                    formatNavDrawerItem(mNavDrawerItemViews[i], thisItemId, itemId == thisItemId);</span>
                }
            }
        }
<span class="nc" id="L349">    }</span>

    @Override
    public void onAttach(final Context context) {
<span class="nc" id="L353">        super.onAttach(context);</span>
        try {
<span class="nc" id="L355">            mCallbacks = (NavigationDrawerCallbacks) context;</span>
<span class="nc" id="L356">        } catch (ClassCastException e) {</span>
<span class="nc" id="L357">            throw new ClassCastException(&quot;Activity must implement NavigationDrawerCallbacks.&quot;);</span>
<span class="nc" id="L358">        }</span>
<span class="nc" id="L359">    }</span>

    @Override
    public void onDetach() {
<span class="nc" id="L363">        super.onDetach();</span>
<span class="nc" id="L364">        mCallbacks = null;</span>
<span class="nc" id="L365">    }</span>

    @Override
    public void onSaveInstanceState(Bundle outState) {
<span class="nc" id="L369">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L370">        Log.d(TAG, &quot;Saving position = &quot; + mCurrentSelectedPosition);</span>
<span class="nc" id="L371">        outState.putInt(STATE_SELECTED_POSITION, mCurrentSelectedPosition);</span>
<span class="nc" id="L372">    }</span>

    @Override
    public void onResume() {
<span class="nc" id="L376">        super.onResume();</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (isItemDeprecated(mCurrentSelectedPosition)) {</span>
            // Prevent access of deprecated options
<span class="nc" id="L379">            selectItem(NAVDRAWER_ITEM_NEARBY);</span>
        }
<span class="nc" id="L381">        populateNavDrawer();</span>
<span class="nc" id="L382">    }</span>

    @Override
    public void onConfigurationChanged(Configuration newConfig) {
<span class="nc" id="L386">        super.onConfigurationChanged(newConfig);</span>
        // Forward the new configuration the drawer toggle component.
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (mDrawerToggle != null) {</span>
<span class="nc" id="L389">            mDrawerToggle.onConfigurationChanged(newConfig);</span>
        }
<span class="nc" id="L391">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L395" title="All 4 branches missed.">        if (mDrawerToggle != null &amp;&amp; mDrawerToggle.onOptionsItemSelected(item)) {</span>
<span class="nc" id="L396">            return true;</span>
        }

<span class="nc" id="L399">        return super.onOptionsItemSelected(item);</span>
    }

    private ActionBar getActionBar() {
<span class="nc" id="L403">        return ((AppCompatActivity) getActivity()).getSupportActionBar();</span>
    }

    /**
     * Callbacks interface that all activities using this fragment must implement.
     */
    public interface NavigationDrawerCallbacks {

        /**
         * Called when an item in the navigation drawer is selected.
         */
        void onNavigationDrawerItemSelected(int position);
    }

    /** Populates the navigation drawer with the appropriate items. */
    public void populateNavDrawer() {
<span class="nc" id="L419">        ObaRegion currentRegion = Application.get().getCurrentRegion();</span>
<span class="nc" id="L420">        mNavDrawerItems.clear();</span>

<span class="nc" id="L422">        mNavDrawerItems.add(NAVDRAWER_ITEM_NEARBY);</span>
<span class="nc" id="L423">        mNavDrawerItems.add(NAVDRAWER_ITEM_STARRED_STOPS);</span>
<span class="nc" id="L424">        mNavDrawerItems.add(NAVDRAWER_ITEM_STARRED_ROUTES);</span>
<span class="nc" id="L425">        mNavDrawerItems.add(NAVDRAWER_ITEM_MY_REMINDERS);</span>

<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (currentRegion != null) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">            if (!TextUtils.isEmpty(currentRegion.getOtpBaseUrl())||</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">                    !TextUtils.isEmpty(Application.get().getCustomOtpApiUrl())) {</span>
<span class="nc" id="L430">                mNavDrawerItems.add(NAVDRAWER_ITEM_PLAN_TRIP);</span>
            }
<span class="nc bnc" id="L432" title="All 2 branches missed.">            if (!TextUtils.isEmpty(currentRegion.getPaymentAndroidAppId())) {</span>
<span class="nc" id="L433">                mNavDrawerItems.add(NAVDRAWER_ITEM_PAY_FARE);</span>
            }
        }

<span class="nc" id="L437">        mNavDrawerItems.add(NAVDRAWER_ITEM_SEPARATOR);</span>

<span class="nc" id="L439">        mNavDrawerItems.add(NAVDRAWER_ITEM_OPEN_SOURCE);</span>

<span class="nc" id="L441">        mNavDrawerItems.add(NAVDRAWER_ITEM_SEPARATOR);</span>

<span class="nc" id="L443">        mNavDrawerItems.add(NAVDRAWER_ITEM_SETTINGS);</span>
<span class="nc" id="L444">        mNavDrawerItems.add(NAVDRAWER_ITEM_HELP);</span>
<span class="nc" id="L445">        mNavDrawerItems.add(NAVDRAWER_ITEM_SEND_FEEDBACK);</span>

<span class="nc" id="L447">        createNavDrawerItems();</span>
<span class="nc" id="L448">    }</span>

    private void createNavDrawerItems() {
<span class="nc bnc" id="L451" title="All 4 branches missed.">        if (mDrawerItemsListContainer == null || getActivity() == null) {</span>
<span class="nc" id="L452">            return;</span>
        }

<span class="nc" id="L455">        mNavDrawerItemViews = new View[mNavDrawerItems.size()];</span>
<span class="nc" id="L456">        int i = 0;</span>

<span class="nc" id="L458">        LinearLayout containerLayout = (LinearLayout) mDrawerItemsListContainer.</span>
<span class="nc" id="L459">                findViewById(R.id.navdrawer_items_list);</span>
<span class="nc" id="L460">        containerLayout.removeAllViews();</span>

<span class="nc bnc" id="L462" title="All 2 branches missed.">        for (int itemId : mNavDrawerItems) {</span>
<span class="nc" id="L463">            mNavDrawerItemViews[i] = makeNavDrawerItem(itemId, containerLayout);</span>
<span class="nc" id="L464">            containerLayout.addView(mNavDrawerItemViews[i]);</span>
<span class="nc" id="L465">            ++i;</span>
<span class="nc" id="L466">        }</span>
<span class="nc" id="L467">    }</span>

    private View makeNavDrawerItem(final int itemId, ViewGroup container) {
<span class="nc bnc" id="L470" title="All 2 branches missed.">        boolean selected = mCurrentSelectedPosition == itemId;</span>
        int layoutToInflate;
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (itemId == NAVDRAWER_ITEM_SEPARATOR) {</span>
<span class="nc" id="L473">            layoutToInflate = R.layout.navdrawer_separator;</span>
        } else {
<span class="nc" id="L475">            layoutToInflate = R.layout.navdrawer_item;</span>
        }
<span class="nc" id="L477">        View view = getActivity().getLayoutInflater().inflate(layoutToInflate, container, false);</span>

<span class="nc bnc" id="L479" title="All 2 branches missed.">        if (isSeparator(itemId)) {</span>
            // we are done
<span class="nc" id="L481">            UIUtils.setAccessibilityIgnore(view);</span>
<span class="nc" id="L482">            return view;</span>
        }

<span class="nc" id="L485">        ImageView iconView = (ImageView) view.findViewById(R.id.icon);</span>
<span class="nc" id="L486">        TextView titleView = (TextView) view.findViewById(R.id.title);</span>
<span class="nc" id="L487">        ImageView secondaryIconView = view.findViewById(R.id.secondary_icon);</span>
<span class="nc bnc" id="L488" title="All 4 branches missed.">        int iconId = itemId &gt;= 0 &amp;&amp; itemId &lt; NAVDRAWER_ICON_RES_ID.length ?</span>
<span class="nc" id="L489">                NAVDRAWER_ICON_RES_ID[itemId] : 0;</span>
<span class="nc bnc" id="L490" title="All 4 branches missed.">        int titleId = itemId &gt;= 0 &amp;&amp; itemId &lt; NAVDRAWER_TITLE_RES_ID.length ?</span>
<span class="nc" id="L491">                NAVDRAWER_TITLE_RES_ID[itemId] : 0;</span>
<span class="nc bnc" id="L492" title="All 4 branches missed.">        int secondaryIconId = itemId &gt;= 0 &amp;&amp; itemId &lt; NAVDRAWER_ICON_SECONDARY_RES_ID.length ?</span>
<span class="nc" id="L493">                NAVDRAWER_ICON_SECONDARY_RES_ID[itemId] : 0;</span>

        // set icon and text
<span class="nc bnc" id="L496" title="All 2 branches missed.">        iconView.setVisibility(iconId &gt; 0 ? View.VISIBLE : View.GONE);</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">        if (iconId &gt; 0) {</span>
<span class="nc" id="L498">            iconView.setImageResource(iconId);</span>
        }
<span class="nc" id="L500">        titleView.setText(getString(titleId));</span>

        // Secondary icon
<span class="nc bnc" id="L503" title="All 2 branches missed.">        secondaryIconView.setVisibility(secondaryIconId &gt; 0 ? View.VISIBLE : View.GONE);</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">        if (secondaryIconId &gt; 0) {</span>
<span class="nc" id="L505">            secondaryIconView.setImageResource(secondaryIconId);</span>
        }

<span class="nc" id="L508">        formatNavDrawerItem(view, itemId, selected);</span>

<span class="nc" id="L510">        view.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View v) {
<span class="nc" id="L513">                selectItem(itemId);</span>
<span class="nc" id="L514">            }</span>
        });

<span class="nc" id="L517">        return view;</span>
    }

    private void formatNavDrawerItem(View view, int itemId, boolean selected) {
<span class="nc bnc" id="L521" title="All 2 branches missed.">        if (isSeparator(itemId)) {</span>
            // Don't do any formatting
<span class="nc" id="L523">            return;</span>
        }

<span class="nc" id="L526">        ImageView iconView = (ImageView) view.findViewById(R.id.icon);</span>
<span class="nc" id="L527">        TextView titleView = (TextView) view.findViewById(R.id.title);</span>
<span class="nc" id="L528">        ImageView secondaryIconView = (ImageView) view.findViewById(R.id.secondary_icon);</span>

        /**
         * Configure its appearance according to whether or not it's selected.  Certain items
         * (e.g., Settings) don't get formatted upon selection, since they open a new activity.
         */
<span class="nc bnc" id="L534" title="All 2 branches missed.">        if (selected) {</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">            if (isNewActivityItem(itemId)) {</span>
                // Don't change any formatting, since this is a category that launches a new activity
<span class="nc" id="L537">                return;</span>
            } else {
                // Show the category as highlighted by changing background, text, and icon color
<span class="nc" id="L540">                view.setSelected(true);</span>
<span class="nc" id="L541">                titleView.setTextColor(</span>
<span class="nc" id="L542">                        getResources().getColor(R.color.navdrawer_text_color_selected));</span>
<span class="nc" id="L543">                iconView.setColorFilter(</span>
<span class="nc" id="L544">                        getResources().getColor(R.color.navdrawer_icon_tint_selected));</span>
<span class="nc" id="L545">                secondaryIconView.setColorFilter(</span>
<span class="nc" id="L546">                        getResources().getColor(R.color.navdrawer_icon_tint_selected));</span>
            }
        } else {
            // Show the category as not highlighted, if its not currently selected
<span class="nc bnc" id="L550" title="All 2 branches missed.">            if (itemId != mCurrentSelectedPosition) {</span>
<span class="nc" id="L551">                view.setSelected(false);</span>
<span class="nc" id="L552">                titleView.setTextColor(getResources().getColor(R.color.navdrawer_text_color));</span>
<span class="nc" id="L553">                iconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint));</span>
<span class="nc" id="L554">                secondaryIconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint));</span>
            }
        }
<span class="nc" id="L557">    }</span>

    private boolean isSeparator(int itemId) {
<span class="nc bnc" id="L560" title="All 2 branches missed.">        return itemId == NAVDRAWER_ITEM_SEPARATOR;</span>
    }

    /**
     * Returns true if this is an item that should not allow selection (e.g., Settings),
     * because they launch a new Activity and aren't part of this screen, false if its selectable
     * and changes the current UI via a new fragment
     *
     * @return true if this is an item that should not allow selection (e.g., Settings),
     * because they launch a new Activity and aren't part of this screen, false if its selectable
     * and changes the current UI via a new fragment
     */
    private boolean isNewActivityItem(int itemId) {
<span class="nc bnc" id="L573" title="All 12 branches missed.">        return itemId == NAVDRAWER_ITEM_SETTINGS ||</span>
                itemId == NAVDRAWER_ITEM_HELP ||
                itemId == NAVDRAWER_ITEM_SEND_FEEDBACK ||
                itemId == NAVDRAWER_ITEM_PLAN_TRIP ||
                itemId == NAVDRAWER_ITEM_PAY_FARE ||
                itemId == NAVDRAWER_ITEM_OPEN_SOURCE;
    }

    /**
     * Returns true if the item has been deprecated.
     *
     * @return true if the item has been deprecated, false if the item is a valid selection.
     */
    public boolean isItemDeprecated(int itemId) {
<span class="nc bnc" id="L587" title="All 4 branches missed.">        return itemId &gt;= 7 &amp;&amp; itemId &lt;= 11;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>