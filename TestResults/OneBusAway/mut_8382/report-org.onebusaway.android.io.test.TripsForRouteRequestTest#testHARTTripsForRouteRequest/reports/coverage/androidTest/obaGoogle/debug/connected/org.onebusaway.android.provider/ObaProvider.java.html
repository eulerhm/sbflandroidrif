<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObaProvider.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.provider</a> &gt; <span class="el_source">ObaProvider.java</span></div><h1>ObaProvider.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2010-2017 Paul Watts (paulcwatts@gmail.com),
 * University of South Florida (sjbarbeau@gmail.com),
 * Microsoft Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.provider;

import org.onebusaway.android.BuildConfig;

import android.content.ContentProvider;
import android.content.ContentUris;
import android.content.ContentValues;
import android.content.Context;
import android.content.UriMatcher;
import android.database.Cursor;
import android.database.DatabaseUtils;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteException;
import android.database.sqlite.SQLiteOpenHelper;
import android.database.sqlite.SQLiteQueryBuilder;
import android.net.Uri;
import android.util.Log;

import java.io.File;
import java.util.HashMap;
import java.util.List;

<span class="fc" id="L40">public class ObaProvider extends ContentProvider {</span>

    public static final String TAG = &quot;ObaProvider&quot;;

    /**
     * The database name cannot be changed.  It needs to remain the same to support backwards
     * compatibility with existing installed apps
     */
    private static final String DATABASE_NAME = BuildConfig.APPLICATION_ID + &quot;.db&quot;;

    private class OpenHelper extends SQLiteOpenHelper {

        private static final int DATABASE_VERSION = 30;

<span class="fc" id="L54">        public OpenHelper(Context context) {</span>
<span class="fc" id="L55">            super(context, DATABASE_NAME, null, DATABASE_VERSION);</span>
<span class="fc" id="L56">        }</span>

        @Override
        public void onCreate(SQLiteDatabase db) {
<span class="fc" id="L60">            bootstrapDatabase(db);</span>
<span class="fc" id="L61">            onUpgrade(db, 12, DATABASE_VERSION);</span>
<span class="fc" id="L62">        }</span>

        @Override
        public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
<span class="fc" id="L66">            Log.d(TAG, &quot;Upgrading database from version &quot; + oldVersion + &quot; to &quot; + newVersion);</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">            if (oldVersion &lt; 12) {</span>
<span class="nc" id="L68">                dropTables(db);</span>
<span class="nc" id="L69">                bootstrapDatabase(db);</span>
<span class="nc" id="L70">                oldVersion = 12;</span>
            }
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">            if (oldVersion == 12) {</span>
<span class="fc" id="L73">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.StopRouteFilters.PATH + &quot; (&quot; +
                                ObaContract.StopRouteFilters.STOP_ID + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.StopRouteFilters.ROUTE_ID + &quot; VARCHAR NOT NULL&quot; +
                                &quot;);&quot;);
<span class="fc" id="L79">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">            if (oldVersion == 13) {</span>
<span class="fc" id="L82">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Stops.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Stops.USER_NAME);
<span class="fc" id="L85">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Stops.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Stops.ACCESS_TIME);
<span class="fc" id="L88">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Stops.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Stops.FAVORITE);
                // These are being added to the routes database as well,
                // even though some of them aren't accessible though the UI yet
                // (we don't allow people to rename routes)
<span class="fc" id="L94">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Routes.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Routes.USER_NAME);
<span class="fc" id="L97">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Routes.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Routes.ACCESS_TIME);
<span class="fc" id="L100">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Routes.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Routes.FAVORITE);
<span class="fc" id="L103">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L105" title="1 of 2 branches missed.">            if (oldVersion == 14) {</span>
<span class="fc" id="L106">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Routes.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Routes.URL);
<span class="fc" id="L109">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">            if (oldVersion == 15) {</span>
<span class="fc" id="L112">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.TripAlerts.PATH + &quot; (&quot; +
                                ObaContract.TripAlerts._ID + &quot; INTEGER PRIMARY KEY AUTOINCREMENT, &quot;
                                +
                                ObaContract.TripAlerts.TRIP_ID + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.TripAlerts.STOP_ID + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.TripAlerts.START_TIME + &quot; INTEGER NOT NULL, &quot; +
                                ObaContract.TripAlerts.STATE + &quot; INTEGER NOT NULL DEFAULT &quot; +
                                ObaContract.TripAlerts.STATE_SCHEDULED +
                                &quot;);&quot;);

<span class="fc" id="L124">                db.execSQL(&quot;DROP TRIGGER IF EXISTS trip_alerts_cleanup&quot;);</span>
<span class="fc" id="L125">                db.execSQL(</span>
                        &quot;CREATE TRIGGER trip_alerts_cleanup DELETE ON &quot; + ObaContract.Trips.PATH +
                                &quot; BEGIN &quot; +
                                &quot;DELETE FROM &quot; + ObaContract.TripAlerts.PATH +
                                &quot; WHERE &quot; + ObaContract.TripAlerts.TRIP_ID + &quot; = old.&quot;
                                + ObaContract.Trips._ID +
                                &quot; AND &quot; + ObaContract.TripAlerts.STOP_ID + &quot; = old.&quot;
                                + ObaContract.Trips.STOP_ID +
                                &quot;;&quot; +
                                &quot;END&quot;);
<span class="fc" id="L135">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">            if (oldVersion == 16) {</span>
<span class="fc" id="L138">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.ServiceAlerts.PATH + &quot; (&quot; +
                                ObaContract.ServiceAlerts._ID + &quot; VARCHAR PRIMARY KEY, &quot; +
                                ObaContract.ServiceAlerts.MARKED_READ_TIME + &quot; INTEGER &quot; +
                                &quot;);&quot;);
<span class="fc" id="L144">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">            if (oldVersion == 17) {</span>
<span class="fc" id="L147">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.Regions.PATH + &quot; (&quot; +
                                ObaContract.Regions._ID + &quot; INTEGER PRIMARY KEY AUTOINCREMENT, &quot; +
                                ObaContract.Regions.NAME + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.Regions.OBA_BASE_URL + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.Regions.SIRI_BASE_URL + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.Regions.LANGUAGE + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.Regions.CONTACT_EMAIL + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.Regions.SUPPORTS_OBA_DISCOVERY + &quot; INTEGER NOT NULL, &quot; +
                                ObaContract.Regions.SUPPORTS_OBA_REALTIME + &quot; INTEGER NOT NULL, &quot; +
                                ObaContract.Regions.SUPPORTS_SIRI_REALTIME + &quot; INTEGER NOT NULL &quot; +
                                &quot;);&quot;);
<span class="fc" id="L160">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.RegionBounds.PATH + &quot; (&quot; +
                                ObaContract.RegionBounds._ID
                                + &quot; INTEGER PRIMARY KEY AUTOINCREMENT, &quot; +
                                ObaContract.RegionBounds.REGION_ID + &quot; INTEGER NOT NULL, &quot; +
                                ObaContract.RegionBounds.LATITUDE + &quot; REAL NOT NULL, &quot; +
                                ObaContract.RegionBounds.LONGITUDE + &quot; REAL NOT NULL, &quot; +
                                ObaContract.RegionBounds.LAT_SPAN + &quot; REAL NOT NULL, &quot; +
                                ObaContract.RegionBounds.LON_SPAN + &quot; REAL NOT NULL &quot; +
                                &quot;);&quot;);
<span class="fc" id="L171">                db.execSQL(&quot;DROP TRIGGER IF EXISTS region_bounds_cleanup&quot;);</span>
<span class="fc" id="L172">                db.execSQL(</span>
                        &quot;CREATE TRIGGER region_bounds_cleanup DELETE ON &quot; + ObaContract.Regions.PATH
                                +
                                &quot; BEGIN &quot; +
                                &quot;DELETE FROM &quot; + ObaContract.RegionBounds.PATH +
                                &quot; WHERE &quot; + ObaContract.RegionBounds.REGION_ID + &quot; = old.&quot;
                                + ObaContract.Regions._ID +
                                &quot;;&quot; +
                                &quot;END&quot;);
<span class="fc" id="L181">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Stops.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Stops.REGION_ID + &quot; INTEGER&quot;);
<span class="fc" id="L184">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Routes.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Routes.REGION_ID + &quot; INTEGER&quot;);
<span class="fc" id="L187">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">            if (oldVersion == 18) {</span>
<span class="fc" id="L190">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.TWITTER_URL + &quot; VARCHAR&quot;);
<span class="fc" id="L193">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">            if (oldVersion == 19) {</span>
<span class="fc" id="L196">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.EXPERIMENTAL + &quot; INTEGER&quot;);
<span class="fc" id="L199">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">            if (oldVersion == 20) {</span>
<span class="fc" id="L202">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.STOP_INFO_URL + &quot; VARCHAR&quot;);
<span class="fc" id="L205">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">            if (oldVersion == 21) {</span>
<span class="fc" id="L208">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.RouteHeadsignFavorites.PATH + &quot; (&quot; +
                                ObaContract.RouteHeadsignFavorites.ROUTE_ID + &quot; VARCHAR NOT NULL, &quot;
                                +
                                ObaContract.RouteHeadsignFavorites.HEADSIGN + &quot; VARCHAR NOT NULL, &quot;
                                +
                                ObaContract.RouteHeadsignFavorites.STOP_ID + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.RouteHeadsignFavorites.EXCLUDE + &quot; INTEGER NOT NULL &quot; +
                                &quot;);&quot;);
<span class="fc" id="L218">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">            if (oldVersion == 22) {</span>
<span class="fc" id="L221">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.RegionOpen311Servers.PATH + &quot; (&quot; +
                                ObaContract.RegionOpen311Servers._ID
                                + &quot; INTEGER PRIMARY KEY AUTOINCREMENT, &quot; +
                                ObaContract.RegionOpen311Servers.REGION_ID + &quot; INTEGER NOT NULL, &quot; +
                                ObaContract.RegionOpen311Servers.JURISDICTION + &quot; VARCHAR, &quot; +
                                ObaContract.RegionOpen311Servers.API_KEY + &quot; VARCHAR NOT NULL, &quot; +
                                ObaContract.RegionOpen311Servers.BASE_URL + &quot; VARCHAR NOT NULL &quot; +
                                &quot;);&quot;);
<span class="fc" id="L231">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">            if (oldVersion == 23) {</span>
<span class="fc" id="L234">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.OTP_BASE_URL + &quot; VARCHAR&quot;);
<span class="fc" id="L237">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.OTP_CONTACT_EMAIL + &quot; VARCHAR&quot;);
<span class="fc" id="L240">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">            if (oldVersion == 24) {</span>
<span class="fc" id="L243">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.ServiceAlerts.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.ServiceAlerts.HIDDEN + &quot; INTEGER&quot;);
<span class="fc" id="L246">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">            if (oldVersion == 25) {</span>
<span class="fc" id="L249">                db.execSQL(</span>
                        &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.SUPPORTS_OTP_BIKESHARE + &quot; INTEGER&quot;);
<span class="fc" id="L252">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">            if (oldVersion == 26) {</span>
                /**
                 * Bike share and Embedded Social both added columns in version 26;
                 * Bike share in Beta, Embedded Social in alpha
                 * We are adding extra logic here to prevent either group from breaking on update
                 */
                try {
<span class="nc" id="L261">                    db.execSQL(</span>
                            &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                    &quot; ADD COLUMN &quot; + ObaContract.Regions.SUPPORTS_OTP_BIKESHARE + &quot; INTEGER&quot;);
<span class="fc" id="L264">                } catch (SQLiteException e) {</span>
<span class="fc" id="L265">                    Log.w(TAG, &quot;Database already has bike share column - &quot; + e);</span>
<span class="nc" id="L266">                }</span>

                try {
<span class="fc" id="L269">                    db.execSQL(</span>
                            &quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +
                                    &quot; ADD COLUMN &quot; + ObaContract.Regions.SUPPORTS_EMBEDDED_SOCIAL + &quot; INTEGER&quot;);
<span class="nc" id="L272">                } catch (SQLiteException e) {</span>
<span class="nc" id="L273">                    Log.w(TAG, &quot;Database already has embedded social column - &quot; + e);</span>
<span class="fc" id="L274">                }</span>
<span class="fc" id="L275">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">            if (oldVersion == 27) {</span>
<span class="fc" id="L278">                db.execSQL(&quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +</span>
                                &quot; ADD COLUMN &quot; + ObaContract.Regions.PAYMENT_ANDROID_APP_ID + &quot; VARCHAR&quot;);
<span class="fc" id="L280">                db.execSQL(&quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +</span>
                        &quot; ADD COLUMN &quot; + ObaContract.Regions.PAYMENT_WARNING_TITLE + &quot; VARCHAR&quot;);
<span class="fc" id="L282">                db.execSQL(&quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +</span>
                        &quot; ADD COLUMN &quot; + ObaContract.Regions.PAYMENT_WARNING_BODY + &quot; VARCHAR&quot;);
<span class="fc" id="L284">                ++oldVersion;</span>
            }
<span class="pc bpc" id="L286" title="1 of 2 branches missed.">            if (oldVersion == 28) {</span>
<span class="fc" id="L287">                db.execSQL(</span>
                        &quot;CREATE TABLE &quot; +
                                ObaContract.NavStops.PATH + &quot; (&quot; +
                                ObaContract.NavStops._ID + &quot; INTEGER PRIMARY KEY AUTOINCREMENT, &quot;
                                + ObaContract.NavStops.NAV_ID + &quot; VARCHAR NOT NULL, &quot;
                                + ObaContract.NavStops.START_TIME + &quot; INTEGER NOT NULL, &quot;
                                + ObaContract.NavStops.TRIP_ID + &quot; VARCHAR NOT NULL, &quot;
                                + ObaContract.NavStops.DESTINATION_ID + &quot; VARCHAR NOT NULL, &quot;
                                + ObaContract.NavStops.BEFORE_ID + &quot; VARCHAR NOT NULL, &quot;
                                + ObaContract.NavStops.SEQUENCE + &quot; INTEGER NOT NULL, &quot;
                                + ObaContract.NavStops.ACTIVE + &quot; INTEGER NOT NULL &quot; +
                                &quot;);&quot;
                );
<span class="fc" id="L300">                ++oldVersion;</span>
            }

<span class="pc bpc" id="L303" title="1 of 2 branches missed.">            if (oldVersion == 29) {</span>
<span class="fc" id="L304">                db.execSQL(&quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +</span>
                        &quot; ADD COLUMN &quot; + ObaContract.Regions.TRAVEL_BEHAVIOR_DATA_COLLECTION + &quot; INTEGER&quot;);
<span class="fc" id="L306">                db.execSQL(&quot;ALTER TABLE &quot; + ObaContract.Regions.PATH +</span>
                        &quot; ADD COLUMN &quot; + ObaContract.Regions.ENROLL_PARTICIPANTS_IN_STUDY + &quot; INTEGER&quot;);
            }
<span class="fc" id="L309">        }</span>

        @Override
        public void onDowngrade(SQLiteDatabase db, int oldVersion, int newVersion) {
            /**
             * See #473 - This can happen if the user does a backup of stops/routes, updates to a
             * new version of the app that includes a database upgrade, and then tries to restore
             * the backup.  This is because our current backup/restore mechanism is simply copying
             * the database. In this case, we should try to make sure the schema is current so no
             * code fails on missing tables or columns.
             */
<span class="nc" id="L320">            Log.d(TAG, &quot;Downgrading database from version &quot; + oldVersion + &quot; to &quot; + newVersion);</span>
<span class="nc" id="L321">            onUpgrade(db, newVersion, newVersion);</span>
<span class="nc" id="L322">        }</span>

        private void bootstrapDatabase(SQLiteDatabase db) {
<span class="fc" id="L325">            db.execSQL(</span>
                    &quot;CREATE TABLE &quot; +
                            ObaContract.Stops.PATH + &quot; (&quot; +
                            ObaContract.Stops._ID + &quot; VARCHAR PRIMARY KEY, &quot; +
                            ObaContract.Stops.CODE + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Stops.NAME + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Stops.DIRECTION + &quot; CHAR[2] NOT NULL,&quot; +
                            ObaContract.Stops.USE_COUNT + &quot; INTEGER NOT NULL,&quot; +
                            ObaContract.Stops.LATITUDE + &quot; DOUBLE NOT NULL,&quot; +
                            ObaContract.Stops.LONGITUDE + &quot; DOUBLE NOT NULL&quot; +
                            &quot;);&quot;);
<span class="fc" id="L336">            db.execSQL(</span>
                    &quot;CREATE TABLE &quot; +
                            ObaContract.Routes.PATH + &quot; (&quot; +
                            ObaContract.Routes._ID + &quot; VARCHAR PRIMARY KEY, &quot; +
                            ObaContract.Routes.SHORTNAME + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Routes.LONGNAME + &quot; VARCHAR, &quot; +
                            ObaContract.Routes.USE_COUNT + &quot; INTEGER NOT NULL&quot; +
                            &quot;);&quot;);
<span class="fc" id="L344">            db.execSQL(</span>
                    &quot;CREATE TABLE &quot; +
                            ObaContract.Trips.PATH + &quot; (&quot; +
                            ObaContract.Trips._ID + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Trips.STOP_ID + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Trips.ROUTE_ID + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Trips.DEPARTURE + &quot; INTEGER NOT NULL, &quot; +
                            ObaContract.Trips.HEADSIGN + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Trips.NAME + &quot; VARCHAR NOT NULL, &quot; +
                            ObaContract.Trips.REMINDER + &quot; INTEGER NOT NULL, &quot; +
                            ObaContract.Trips.DAYS + &quot; INTEGER NOT NULL&quot; +
                            &quot;);&quot;);
<span class="fc" id="L356">        }</span>

        private void dropTables(SQLiteDatabase db) {
<span class="nc" id="L359">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.StopRouteFilters.PATH);</span>
<span class="nc" id="L360">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.Routes.PATH);</span>
<span class="nc" id="L361">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.Stops.PATH);</span>
<span class="nc" id="L362">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.Trips.PATH);</span>
<span class="nc" id="L363">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.TripAlerts.PATH);</span>
<span class="nc" id="L364">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.ServiceAlerts.PATH);</span>
<span class="nc" id="L365">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.Regions.PATH);</span>
<span class="nc" id="L366">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.RegionBounds.PATH);</span>
<span class="nc" id="L367">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.RegionOpen311Servers.PATH);</span>
<span class="nc" id="L368">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.RouteHeadsignFavorites.PATH);</span>
<span class="nc" id="L369">            db.execSQL(&quot;DROP TABLE IF EXISTS &quot; + ObaContract.NavStops.PATH);</span>
<span class="nc" id="L370">        }</span>
    }

    private static final int STOPS = 1;

    private static final int STOPS_ID = 2;

    private static final int ROUTES = 3;

    private static final int ROUTES_ID = 4;

    private static final int TRIPS = 5;

    private static final int TRIPS_ID = 6;

    private static final int TRIP_ALERTS = 7;

    private static final int TRIP_ALERTS_ID = 8;

    private static final int STOP_ROUTE_FILTERS = 9;

    private static final int SERVICE_ALERTS = 10;

    private static final int SERVICE_ALERTS_ID = 11;

    private static final int REGIONS = 12;

    private static final int REGIONS_ID = 13;

    private static final int REGION_BOUNDS = 14;

    private static final int REGION_BOUNDS_ID = 15;

    private static final int ROUTE_HEADSIGN_FAVORITES = 16;

    private static final int REGION_OPEN311_SERVERS = 17;

    private static final int REGION_OPEN311_SERVERS_ID = 18;

    private static final int NAV_STOPS = 19;

    private static final UriMatcher sUriMatcher;

    private static final HashMap&lt;String, String&gt; sStopsProjectionMap;

    private static final HashMap&lt;String, String&gt; sRoutesProjectionMap;

    private static final HashMap&lt;String, String&gt; sTripsProjectionMap;

    private static final HashMap&lt;String, String&gt; sTripAlertsProjectionMap;

    private static final HashMap&lt;String, String&gt; sServiceAlertsProjectionMap;

    private static final HashMap&lt;String, String&gt; sRegionsProjectionMap;

    private static final HashMap&lt;String, String&gt; sRegionBoundsProjectionMap;

    private static final HashMap&lt;String, String&gt; sRegionOpen311ProjectionMap;

    // Insert helpers are useful.
    private DatabaseUtils.InsertHelper mStopsInserter;

    private DatabaseUtils.InsertHelper mRoutesInserter;

    private DatabaseUtils.InsertHelper mTripsInserter;

    private DatabaseUtils.InsertHelper mTripAlertsInserter;

    private DatabaseUtils.InsertHelper mFilterInserter;

    private DatabaseUtils.InsertHelper mServiceAlertsInserter;

    private DatabaseUtils.InsertHelper mRegionsInserter;

    private DatabaseUtils.InsertHelper mRegionBoundsInserter;

    private DatabaseUtils.InsertHelper mRegionOpen311ServersInserter;

    private DatabaseUtils.InsertHelper mRouteHeadsignFavoritesInserter;

    private DatabaseUtils.InsertHelper mNavStopsInserter;

    static {
<span class="fc" id="L453">        sUriMatcher = new UriMatcher(UriMatcher.NO_MATCH);</span>
<span class="fc" id="L454">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Stops.PATH, STOPS);</span>
<span class="fc" id="L455">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Stops.PATH + &quot;/*&quot;, STOPS_ID);</span>
<span class="fc" id="L456">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Routes.PATH, ROUTES);</span>
<span class="fc" id="L457">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Routes.PATH + &quot;/*&quot;, ROUTES_ID);</span>
<span class="fc" id="L458">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Trips.PATH, TRIPS);</span>
<span class="fc" id="L459">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Trips.PATH + &quot;/*/*&quot;, TRIPS_ID);</span>
<span class="fc" id="L460">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.TripAlerts.PATH, TRIP_ALERTS);</span>
<span class="fc" id="L461">        sUriMatcher</span>
<span class="fc" id="L462">                .addURI(ObaContract.AUTHORITY, ObaContract.TripAlerts.PATH + &quot;/#&quot;, TRIP_ALERTS_ID);</span>
<span class="fc" id="L463">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.StopRouteFilters.PATH,</span>
                STOP_ROUTE_FILTERS);
<span class="fc" id="L465">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.ServiceAlerts.PATH, SERVICE_ALERTS);</span>
<span class="fc" id="L466">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.ServiceAlerts.PATH + &quot;/*&quot;,</span>
                SERVICE_ALERTS_ID);
<span class="fc" id="L468">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Regions.PATH, REGIONS);</span>
<span class="fc" id="L469">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.Regions.PATH + &quot;/#&quot;, REGIONS_ID);</span>
<span class="fc" id="L470">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.RegionBounds.PATH, REGION_BOUNDS);</span>
<span class="fc" id="L471">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.RegionBounds.PATH + &quot;/#&quot;,</span>
                REGION_BOUNDS_ID);
<span class="fc" id="L473">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.RegionOpen311Servers.PATH, REGION_OPEN311_SERVERS);</span>
<span class="fc" id="L474">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.RegionOpen311Servers.PATH + &quot;/#&quot;,</span>
                REGION_OPEN311_SERVERS_ID);
<span class="fc" id="L476">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.RouteHeadsignFavorites.PATH,</span>
                ROUTE_HEADSIGN_FAVORITES);
<span class="fc" id="L478">        sUriMatcher.addURI(ObaContract.AUTHORITY, ObaContract.NavStops.PATH, NAV_STOPS);</span>

<span class="fc" id="L480">        sStopsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L481">        sStopsProjectionMap.put(ObaContract.Stops._ID, ObaContract.Stops._ID);</span>
<span class="fc" id="L482">        sStopsProjectionMap.put(ObaContract.Stops.CODE, ObaContract.Stops.CODE);</span>
<span class="fc" id="L483">        sStopsProjectionMap.put(ObaContract.Stops.NAME, ObaContract.Stops.NAME);</span>
<span class="fc" id="L484">        sStopsProjectionMap.put(ObaContract.Stops.DIRECTION, ObaContract.Stops.DIRECTION);</span>
<span class="fc" id="L485">        sStopsProjectionMap.put(ObaContract.Stops.USE_COUNT, ObaContract.Stops.USE_COUNT);</span>
<span class="fc" id="L486">        sStopsProjectionMap.put(ObaContract.Stops.LATITUDE, ObaContract.Stops.LATITUDE);</span>
<span class="fc" id="L487">        sStopsProjectionMap.put(ObaContract.Stops.LONGITUDE, ObaContract.Stops.LONGITUDE);</span>
<span class="fc" id="L488">        sStopsProjectionMap.put(ObaContract.Stops.USER_NAME, ObaContract.Stops.USER_NAME);</span>
<span class="fc" id="L489">        sStopsProjectionMap.put(ObaContract.Stops.ACCESS_TIME, ObaContract.Stops.ACCESS_TIME);</span>
<span class="fc" id="L490">        sStopsProjectionMap.put(ObaContract.Stops.FAVORITE, ObaContract.Stops.FAVORITE);</span>
<span class="fc" id="L491">        sStopsProjectionMap.put(ObaContract.Stops._COUNT, &quot;count(*)&quot;);</span>
<span class="fc" id="L492">        sStopsProjectionMap.put(ObaContract.Stops.UI_NAME,</span>
                &quot;CASE WHEN &quot; + ObaContract.Stops.USER_NAME + &quot; IS NOT NULL THEN &quot; +
                        ObaContract.Stops.USER_NAME + &quot; ELSE &quot; +
                        ObaContract.Stops.NAME + &quot; END AS &quot; +
                        ObaContract.Stops.UI_NAME);

<span class="fc" id="L498">        sRoutesProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L499">        sRoutesProjectionMap.put(ObaContract.Routes._ID, ObaContract.Routes._ID);</span>
<span class="fc" id="L500">        sRoutesProjectionMap.put(ObaContract.Routes.SHORTNAME, ObaContract.Routes.SHORTNAME);</span>
<span class="fc" id="L501">        sRoutesProjectionMap.put(ObaContract.Routes.LONGNAME, ObaContract.Routes.LONGNAME);</span>
<span class="fc" id="L502">        sRoutesProjectionMap.put(ObaContract.Routes.USE_COUNT, ObaContract.Routes.USE_COUNT);</span>
<span class="fc" id="L503">        sRoutesProjectionMap.put(ObaContract.Routes.USER_NAME, ObaContract.Routes.USER_NAME);</span>
<span class="fc" id="L504">        sRoutesProjectionMap.put(ObaContract.Routes.ACCESS_TIME, ObaContract.Routes.ACCESS_TIME);</span>
<span class="fc" id="L505">        sRoutesProjectionMap.put(ObaContract.Routes.FAVORITE, ObaContract.Routes.FAVORITE);</span>
<span class="fc" id="L506">        sRoutesProjectionMap.put(ObaContract.Routes.URL, ObaContract.Routes.URL);</span>
<span class="fc" id="L507">        sRoutesProjectionMap.put(ObaContract.Routes._COUNT, &quot;count(*)&quot;);</span>

<span class="fc" id="L509">        sTripsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L510">        sTripsProjectionMap.put(ObaContract.Trips._ID, ObaContract.Trips._ID);</span>
<span class="fc" id="L511">        sTripsProjectionMap.put(ObaContract.Trips.STOP_ID, ObaContract.Trips.STOP_ID);</span>
<span class="fc" id="L512">        sTripsProjectionMap.put(ObaContract.Trips.ROUTE_ID, ObaContract.Trips.ROUTE_ID);</span>
<span class="fc" id="L513">        sTripsProjectionMap.put(ObaContract.Trips.DEPARTURE, ObaContract.Trips.DEPARTURE);</span>
<span class="fc" id="L514">        sTripsProjectionMap.put(ObaContract.Trips.HEADSIGN, ObaContract.Trips.HEADSIGN);</span>
<span class="fc" id="L515">        sTripsProjectionMap.put(ObaContract.Trips.NAME, ObaContract.Trips.NAME);</span>
<span class="fc" id="L516">        sTripsProjectionMap.put(ObaContract.Trips.REMINDER, ObaContract.Trips.REMINDER);</span>
<span class="fc" id="L517">        sTripsProjectionMap.put(ObaContract.Trips.DAYS, ObaContract.Trips.DAYS);</span>
<span class="fc" id="L518">        sTripsProjectionMap.put(ObaContract.Trips._COUNT, &quot;count(*)&quot;);</span>

<span class="fc" id="L520">        sTripAlertsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L521">        sTripAlertsProjectionMap.put(ObaContract.TripAlerts._ID, ObaContract.TripAlerts._ID);</span>
<span class="fc" id="L522">        sTripAlertsProjectionMap</span>
<span class="fc" id="L523">                .put(ObaContract.TripAlerts.TRIP_ID, ObaContract.TripAlerts.TRIP_ID);</span>
<span class="fc" id="L524">        sTripAlertsProjectionMap</span>
<span class="fc" id="L525">                .put(ObaContract.TripAlerts.STOP_ID, ObaContract.TripAlerts.STOP_ID);</span>
<span class="fc" id="L526">        sTripAlertsProjectionMap</span>
<span class="fc" id="L527">                .put(ObaContract.TripAlerts.START_TIME, ObaContract.TripAlerts.START_TIME);</span>
<span class="fc" id="L528">        sTripAlertsProjectionMap.put(ObaContract.TripAlerts.STATE, ObaContract.TripAlerts.STATE);</span>
<span class="fc" id="L529">        sTripAlertsProjectionMap.put(ObaContract.TripAlerts._COUNT, &quot;count(*)&quot;);</span>

<span class="fc" id="L531">        sServiceAlertsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L532">        sServiceAlertsProjectionMap</span>
<span class="fc" id="L533">                .put(ObaContract.ServiceAlerts._ID, ObaContract.ServiceAlerts._ID);</span>
<span class="fc" id="L534">        sServiceAlertsProjectionMap.put(ObaContract.ServiceAlerts.MARKED_READ_TIME,</span>
                ObaContract.ServiceAlerts.MARKED_READ_TIME);
<span class="fc" id="L536">        sServiceAlertsProjectionMap.put(ObaContract.ServiceAlerts.HIDDEN,</span>
                ObaContract.ServiceAlerts.HIDDEN);

<span class="fc" id="L539">        sRegionsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L540">        sRegionsProjectionMap.put(ObaContract.Regions._ID, ObaContract.Regions._ID);</span>
<span class="fc" id="L541">        sRegionsProjectionMap.put(ObaContract.Regions.NAME, ObaContract.Regions.NAME);</span>
<span class="fc" id="L542">        sRegionsProjectionMap</span>
<span class="fc" id="L543">                .put(ObaContract.Regions.OBA_BASE_URL, ObaContract.Regions.OBA_BASE_URL);</span>
<span class="fc" id="L544">        sRegionsProjectionMap</span>
<span class="fc" id="L545">                .put(ObaContract.Regions.SIRI_BASE_URL, ObaContract.Regions.SIRI_BASE_URL);</span>
<span class="fc" id="L546">        sRegionsProjectionMap.put(ObaContract.Regions.LANGUAGE, ObaContract.Regions.LANGUAGE);</span>
<span class="fc" id="L547">        sRegionsProjectionMap</span>
<span class="fc" id="L548">                .put(ObaContract.Regions.CONTACT_EMAIL, ObaContract.Regions.CONTACT_EMAIL);</span>
<span class="fc" id="L549">        sRegionsProjectionMap.put(ObaContract.Regions.SUPPORTS_OBA_DISCOVERY,</span>
                ObaContract.Regions.SUPPORTS_OBA_DISCOVERY);
<span class="fc" id="L551">        sRegionsProjectionMap.put(ObaContract.Regions.SUPPORTS_OBA_REALTIME,</span>
                ObaContract.Regions.SUPPORTS_OBA_REALTIME);
<span class="fc" id="L553">        sRegionsProjectionMap.put(ObaContract.Regions.SUPPORTS_SIRI_REALTIME,</span>
                ObaContract.Regions.SUPPORTS_SIRI_REALTIME);
<span class="fc" id="L555">        sRegionsProjectionMap.put(ObaContract.Regions.SUPPORTS_EMBEDDED_SOCIAL,</span>
                ObaContract.Regions.SUPPORTS_EMBEDDED_SOCIAL);
<span class="fc" id="L557">        sRegionsProjectionMap.put(ObaContract.Regions.TWITTER_URL, ObaContract.Regions.TWITTER_URL);</span>
<span class="fc" id="L558">        sRegionsProjectionMap</span>
<span class="fc" id="L559">                .put(ObaContract.Regions.EXPERIMENTAL, ObaContract.Regions.EXPERIMENTAL);</span>
<span class="fc" id="L560">        sRegionsProjectionMap</span>
<span class="fc" id="L561">                .put(ObaContract.Regions.STOP_INFO_URL, ObaContract.Regions.STOP_INFO_URL);</span>
<span class="fc" id="L562">        sRegionsProjectionMap</span>
<span class="fc" id="L563">                .put(ObaContract.Regions.OTP_BASE_URL, ObaContract.Regions.OTP_BASE_URL);</span>
<span class="fc" id="L564">        sRegionsProjectionMap</span>
<span class="fc" id="L565">                .put(ObaContract.Regions.OTP_CONTACT_EMAIL, ObaContract.Regions.OTP_CONTACT_EMAIL);</span>
<span class="fc" id="L566">        sRegionsProjectionMap</span>
<span class="fc" id="L567">                .put(ObaContract.Regions.SUPPORTS_OTP_BIKESHARE, ObaContract.Regions.SUPPORTS_OTP_BIKESHARE);</span>
<span class="fc" id="L568">        sRegionsProjectionMap</span>
<span class="fc" id="L569">                .put(ObaContract.Regions.PAYMENT_ANDROID_APP_ID, ObaContract.Regions.PAYMENT_ANDROID_APP_ID);</span>
<span class="fc" id="L570">        sRegionsProjectionMap</span>
<span class="fc" id="L571">                .put(ObaContract.Regions.PAYMENT_WARNING_TITLE, ObaContract.Regions.PAYMENT_WARNING_TITLE);</span>
<span class="fc" id="L572">        sRegionsProjectionMap</span>
<span class="fc" id="L573">                .put(ObaContract.Regions.PAYMENT_WARNING_BODY, ObaContract.Regions.PAYMENT_WARNING_BODY);</span>
<span class="fc" id="L574">        sRegionsProjectionMap</span>
<span class="fc" id="L575">                .put(ObaContract.Regions.TRAVEL_BEHAVIOR_DATA_COLLECTION, ObaContract.Regions.TRAVEL_BEHAVIOR_DATA_COLLECTION);</span>
<span class="fc" id="L576">        sRegionsProjectionMap</span>
<span class="fc" id="L577">                .put(ObaContract.Regions.ENROLL_PARTICIPANTS_IN_STUDY, ObaContract.Regions.ENROLL_PARTICIPANTS_IN_STUDY);</span>

<span class="fc" id="L579">        sRegionBoundsProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L580">        sRegionBoundsProjectionMap.put(ObaContract.RegionBounds._ID, ObaContract.RegionBounds._ID);</span>
<span class="fc" id="L581">        sRegionBoundsProjectionMap</span>
<span class="fc" id="L582">                .put(ObaContract.RegionBounds.REGION_ID, ObaContract.RegionBounds.REGION_ID);</span>
<span class="fc" id="L583">        sRegionBoundsProjectionMap</span>
<span class="fc" id="L584">                .put(ObaContract.RegionBounds.LATITUDE, ObaContract.RegionBounds.LATITUDE);</span>
<span class="fc" id="L585">        sRegionBoundsProjectionMap</span>
<span class="fc" id="L586">                .put(ObaContract.RegionBounds.LONGITUDE, ObaContract.RegionBounds.LONGITUDE);</span>
<span class="fc" id="L587">        sRegionBoundsProjectionMap</span>
<span class="fc" id="L588">                .put(ObaContract.RegionBounds.LAT_SPAN, ObaContract.RegionBounds.LAT_SPAN);</span>
<span class="fc" id="L589">        sRegionBoundsProjectionMap</span>
<span class="fc" id="L590">                .put(ObaContract.RegionBounds.LON_SPAN, ObaContract.RegionBounds.LON_SPAN);</span>

<span class="fc" id="L592">        sRegionOpen311ProjectionMap = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L593">        sRegionOpen311ProjectionMap</span>
<span class="fc" id="L594">                .put(ObaContract.RegionOpen311Servers._ID, ObaContract.RegionOpen311Servers._ID);</span>
<span class="fc" id="L595">        sRegionOpen311ProjectionMap</span>
<span class="fc" id="L596">                .put(ObaContract.RegionOpen311Servers.REGION_ID, ObaContract.RegionOpen311Servers.REGION_ID);</span>
<span class="fc" id="L597">        sRegionOpen311ProjectionMap</span>
<span class="fc" id="L598">                .put(ObaContract.RegionOpen311Servers.JURISDICTION, ObaContract.RegionOpen311Servers.JURISDICTION);</span>
<span class="fc" id="L599">        sRegionOpen311ProjectionMap</span>
<span class="fc" id="L600">                .put(ObaContract.RegionOpen311Servers.API_KEY, ObaContract.RegionOpen311Servers.API_KEY);</span>
<span class="fc" id="L601">        sRegionOpen311ProjectionMap</span>
<span class="fc" id="L602">                .put(ObaContract.RegionOpen311Servers.BASE_URL, ObaContract.RegionOpen311Servers.BASE_URL);</span>
<span class="fc" id="L603">    }</span>

    private SQLiteDatabase mDb;

    private OpenHelper mOpenHelper;

    public static File getDatabasePath(Context context) {
<span class="nc" id="L610">        return context.getDatabasePath(DATABASE_NAME);</span>
    }

    @Override
    public boolean onCreate() {
<span class="fc" id="L615">        mOpenHelper = new OpenHelper(getContext());</span>
<span class="fc" id="L616">        return true;</span>
    }

    @Override
    public String getType(Uri uri) {
<span class="nc" id="L621">        int match = sUriMatcher.match(uri);</span>
<span class="nc bnc" id="L622" title="All 20 branches missed.">        switch (match) {</span>
            case STOPS:
<span class="nc" id="L624">                return ObaContract.Stops.CONTENT_DIR_TYPE;</span>
            case STOPS_ID:
<span class="nc" id="L626">                return ObaContract.Stops.CONTENT_TYPE;</span>
            case ROUTES:
<span class="nc" id="L628">                return ObaContract.Routes.CONTENT_DIR_TYPE;</span>
            case ROUTES_ID:
<span class="nc" id="L630">                return ObaContract.Routes.CONTENT_TYPE;</span>
            case TRIPS:
<span class="nc" id="L632">                return ObaContract.Trips.CONTENT_DIR_TYPE;</span>
            case TRIPS_ID:
<span class="nc" id="L634">                return ObaContract.Trips.CONTENT_TYPE;</span>
            case TRIP_ALERTS:
<span class="nc" id="L636">                return ObaContract.TripAlerts.CONTENT_DIR_TYPE;</span>
            case TRIP_ALERTS_ID:
<span class="nc" id="L638">                return ObaContract.TripAlerts.CONTENT_TYPE;</span>
            case STOP_ROUTE_FILTERS:
<span class="nc" id="L640">                return ObaContract.StopRouteFilters.CONTENT_DIR_TYPE;</span>
            case SERVICE_ALERTS:
<span class="nc" id="L642">                return ObaContract.ServiceAlerts.CONTENT_DIR_TYPE;</span>
            case SERVICE_ALERTS_ID:
<span class="nc" id="L644">                return ObaContract.ServiceAlerts.CONTENT_TYPE;</span>
            case REGIONS:
<span class="nc" id="L646">                return ObaContract.Regions.CONTENT_DIR_TYPE;</span>
            case REGIONS_ID:
<span class="nc" id="L648">                return ObaContract.Regions.CONTENT_TYPE;</span>
            case REGION_BOUNDS:
<span class="nc" id="L650">                return ObaContract.RegionBounds.CONTENT_DIR_TYPE;</span>
            case REGION_BOUNDS_ID:
<span class="nc" id="L652">                return ObaContract.RegionBounds.CONTENT_TYPE;</span>
            case REGION_OPEN311_SERVERS:
<span class="nc" id="L654">                return ObaContract.RegionOpen311Servers.CONTENT_DIR_TYPE;</span>
            case REGION_OPEN311_SERVERS_ID:
<span class="nc" id="L656">                return ObaContract.RegionOpen311Servers.CONTENT_TYPE;</span>
            case ROUTE_HEADSIGN_FAVORITES:
<span class="nc" id="L658">                return ObaContract.RouteHeadsignFavorites.CONTENT_DIR_TYPE;</span>
            case NAV_STOPS:
<span class="nc" id="L660">                return ObaContract.NavStops.CONTENT_DIR_TYPE;</span>
            default:
<span class="nc" id="L662">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
    }

    @Override
    public Uri insert(Uri uri, ContentValues values) {
<span class="fc" id="L668">        final SQLiteDatabase db = getDatabase();</span>
<span class="fc" id="L669">        db.beginTransaction();</span>
        try {
<span class="fc" id="L671">            Uri result = insertInternal(db, uri, values);</span>
<span class="fc" id="L672">            getContext().getContentResolver().notifyChange(uri, null);</span>
<span class="fc" id="L673">            db.setTransactionSuccessful();</span>
<span class="fc" id="L674">            return result;</span>
        } finally {
<span class="fc" id="L676">            db.endTransaction();</span>
        }
    }

    @Override
    public Cursor query(Uri uri, String[] projection, String selection,
                        String[] selectionArgs, String sortOrder) {
<span class="fc" id="L683">        final SQLiteDatabase db = getDatabase();</span>
<span class="fc" id="L684">        return queryInternal(db, uri, projection, selection, selectionArgs, sortOrder);</span>
    }

    @Override
    public int update(Uri uri, ContentValues values, String selection,
                      String[] selectionArgs) {
<span class="fc" id="L690">        final SQLiteDatabase db = getDatabase();</span>
<span class="fc" id="L691">        db.beginTransaction();</span>
        try {
<span class="fc" id="L693">            int result = updateInternal(db, uri, values, selection, selectionArgs);</span>
<span class="fc bfc" id="L694" title="All 2 branches covered.">            if (result &gt; 0) {</span>
<span class="fc" id="L695">                getContext().getContentResolver().notifyChange(uri, null);</span>
            }
<span class="fc" id="L697">            db.setTransactionSuccessful();</span>
<span class="fc" id="L698">            return result;</span>
        } finally {
<span class="fc" id="L700">            db.endTransaction();</span>
        }
    }

    @Override
    public int delete(Uri uri, String selection, String[] selectionArgs) {
<span class="fc" id="L706">        final SQLiteDatabase db = getDatabase();</span>
<span class="fc" id="L707">        db.beginTransaction();</span>
        try {
<span class="fc" id="L709">            int result = deleteInternal(db, uri, selection, selectionArgs);</span>
<span class="fc bfc" id="L710" title="All 2 branches covered.">            if (result &gt; 0) {</span>
<span class="fc" id="L711">                getContext().getContentResolver().notifyChange(uri, null);</span>
            }
<span class="fc" id="L713">            db.setTransactionSuccessful();</span>
<span class="fc" id="L714">            return result;</span>
        } finally {
<span class="fc" id="L716">            db.endTransaction();</span>
        }
    }

    private Uri insertInternal(SQLiteDatabase db, Uri uri, ContentValues values) {
<span class="fc" id="L721">        final int match = sUriMatcher.match(uri);</span>
        String id;
        Uri result;
        long longId;

<span class="pc bpc" id="L726" title="7 of 13 branches missed.">        switch (match) {</span>
            case STOPS:
                // Pull out the Stop ID from the values to construct the new URI
                // (And we'd better have a stop ID)
<span class="fc" id="L730">                id = values.getAsString(ObaContract.Stops._ID);</span>
<span class="pc bpc" id="L731" title="1 of 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L732">                    throw new IllegalArgumentException(&quot;Need a stop ID to insert! &quot; + uri);</span>
                }
<span class="fc" id="L734">                result = Uri.withAppendedPath(ObaContract.Stops.CONTENT_URI, id);</span>
<span class="fc" id="L735">                mStopsInserter.insert(values);</span>
<span class="fc" id="L736">                return result;</span>

            case ROUTES:
                // Pull out the Route ID from the values to construct the new URI
                // (And we'd better have a route ID)
<span class="nc" id="L741">                id = values.getAsString(ObaContract.Routes._ID);</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L743">                    throw new IllegalArgumentException(&quot;Need a routes ID to insert! &quot; + uri);</span>
                }
<span class="nc" id="L745">                result = Uri.withAppendedPath(ObaContract.Routes.CONTENT_URI, id);</span>
<span class="nc" id="L746">                mRoutesInserter.insert(values);</span>
<span class="nc" id="L747">                return result;</span>

            case TRIPS:
                // Pull out the Trip ID from the values to construct the new URI
                // (And we'd better have a trip ID)
<span class="nc" id="L752">                id = values.getAsString(ObaContract.Trips._ID);</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L754">                    throw new IllegalArgumentException(&quot;Need a trip ID to insert! &quot; + uri);</span>
                }
<span class="nc" id="L756">                result = Uri.withAppendedPath(ObaContract.Trips.CONTENT_URI, id);</span>
<span class="nc" id="L757">                mTripsInserter.insert(values);</span>
<span class="nc" id="L758">                return result;</span>

            case TRIP_ALERTS:
<span class="fc" id="L761">                longId = mTripAlertsInserter.insert(values);</span>
<span class="fc" id="L762">                result = ContentUris.withAppendedId(ObaContract.TripAlerts.CONTENT_URI, longId);</span>
<span class="fc" id="L763">                return result;</span>

            case STOP_ROUTE_FILTERS:
                // TODO: We should provide a &quot;virtual&quot; column that is an array,
                // so clients don't have to call the content provider for each item to insert.
                // Pull out the stop ID from the values to construct the new URI
                // (And we'd better have a stop ID)
<span class="nc" id="L770">                id = values.getAsString(ObaContract.StopRouteFilters.STOP_ID);</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L772">                    throw new IllegalArgumentException(&quot;Need a stop ID to insert! &quot; + uri);</span>
                }
<span class="nc" id="L774">                result = Uri.withAppendedPath(ObaContract.StopRouteFilters.CONTENT_URI, id);</span>
<span class="nc" id="L775">                mFilterInserter.insert(values);</span>
<span class="nc" id="L776">                return result;</span>

            case SERVICE_ALERTS:
                // Pull out the Situation ID from the values to construct the new URI
                // (And we'd better have a situation ID)
<span class="nc" id="L781">                id = values.getAsString(ObaContract.ServiceAlerts._ID);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L783">                    throw new IllegalArgumentException(&quot;Need a situation ID to insert! &quot; + uri);</span>
                }
<span class="nc" id="L785">                result = Uri.withAppendedPath(ObaContract.ServiceAlerts.CONTENT_URI, id);</span>
<span class="nc" id="L786">                mServiceAlertsInserter.insert(values);</span>
<span class="nc" id="L787">                return result;</span>

            case REGIONS:
<span class="fc" id="L790">                longId = mRegionsInserter.insert(values);</span>
<span class="fc" id="L791">                result = ContentUris.withAppendedId(ObaContract.Regions.CONTENT_URI, longId);</span>
<span class="fc" id="L792">                return result;</span>

            case REGION_BOUNDS:
<span class="fc" id="L795">                longId = mRegionBoundsInserter.insert(values);</span>
<span class="fc" id="L796">                result = ContentUris.withAppendedId(ObaContract.RegionBounds.CONTENT_URI, longId);</span>
<span class="fc" id="L797">                return result;</span>

            case REGION_OPEN311_SERVERS:
<span class="fc" id="L800">                longId = mRegionOpen311ServersInserter.insert(values);</span>
<span class="fc" id="L801">                result = ContentUris.withAppendedId(ObaContract.RegionOpen311Servers.CONTENT_URI, longId);</span>
<span class="fc" id="L802">                return result;</span>

            case ROUTE_HEADSIGN_FAVORITES:
<span class="fc" id="L805">                id = values.getAsString(ObaContract.RouteHeadsignFavorites.ROUTE_ID);</span>
<span class="pc bpc" id="L806" title="1 of 2 branches missed.">                if (id == null) {</span>
<span class="nc" id="L807">                    throw new IllegalArgumentException(&quot;Need a route ID to insert! &quot; + uri);</span>
                }
<span class="fc" id="L809">                result = Uri.withAppendedPath(ObaContract.RouteHeadsignFavorites.CONTENT_URI, id);</span>
<span class="fc" id="L810">                mRouteHeadsignFavoritesInserter.insert(values);</span>
<span class="fc" id="L811">                return result;</span>

            case NAV_STOPS:
<span class="nc" id="L814">                longId = mNavStopsInserter.insert(values);</span>
<span class="nc" id="L815">                result = ContentUris.withAppendedId(ObaContract.NavStops.CONTENT_URI, longId);</span>
<span class="nc" id="L816">                return result;</span>

            // What would these mean, anyway??
            case STOPS_ID:
            case ROUTES_ID:
            case TRIPS_ID:
            case TRIP_ALERTS_ID:
            case SERVICE_ALERTS_ID:
            case REGIONS_ID:
            case REGION_BOUNDS_ID:
<span class="nc" id="L826">                throw new UnsupportedOperationException(&quot;Cannot insert to this URI: &quot; + uri);</span>
            default:
<span class="nc" id="L828">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
    }

    private Cursor queryInternal(SQLiteDatabase db,
                                 Uri uri, String[] projection, String selection,
                                 String[] selectionArgs, String sortOrder) {
<span class="fc" id="L835">        final int match = sUriMatcher.match(uri);</span>
<span class="fc" id="L836">        final String limit = uri.getQueryParameter(&quot;limit&quot;);</span>

<span class="fc" id="L838">        SQLiteQueryBuilder qb = new SQLiteQueryBuilder();</span>

<span class="pc bpc" id="L840" title="11 of 20 branches missed.">        switch (match) {</span>
            case STOPS:
<span class="fc" id="L842">                qb.setTables(ObaContract.Stops.PATH);</span>
<span class="fc" id="L843">                qb.setProjectionMap(sStopsProjectionMap);</span>
<span class="fc" id="L844">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case STOPS_ID:
<span class="fc" id="L848">                qb.setTables(ObaContract.Stops.PATH);</span>
<span class="fc" id="L849">                qb.setProjectionMap(sStopsProjectionMap);</span>
<span class="fc" id="L850">                qb.appendWhere(ObaContract.Stops._ID);</span>
<span class="fc" id="L851">                qb.appendWhere(&quot;=&quot;);</span>
<span class="fc" id="L852">                qb.appendWhereEscapeString(uri.getLastPathSegment());</span>
<span class="fc" id="L853">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case ROUTES:
<span class="nc" id="L857">                qb.setTables(ObaContract.Routes.PATH);</span>
<span class="nc" id="L858">                qb.setProjectionMap(sRoutesProjectionMap);</span>
<span class="nc" id="L859">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case ROUTES_ID:
<span class="nc" id="L863">                qb.setTables(ObaContract.Routes.PATH);</span>
<span class="nc" id="L864">                qb.setProjectionMap(sRoutesProjectionMap);</span>
<span class="nc" id="L865">                qb.appendWhere(ObaContract.Routes._ID);</span>
<span class="nc" id="L866">                qb.appendWhere(&quot;=&quot;);</span>
<span class="nc" id="L867">                qb.appendWhereEscapeString(uri.getLastPathSegment());</span>
<span class="nc" id="L868">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case TRIPS:
<span class="nc" id="L872">                qb.setTables(ObaContract.Trips.PATH);</span>
<span class="nc" id="L873">                qb.setProjectionMap(sTripsProjectionMap);</span>
<span class="nc" id="L874">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case TRIPS_ID:
<span class="nc" id="L878">                qb.setTables(ObaContract.Trips.PATH);</span>
<span class="nc" id="L879">                qb.setProjectionMap(sTripsProjectionMap);</span>
<span class="nc" id="L880">                qb.appendWhere(tripWhere(uri));</span>
<span class="nc" id="L881">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case TRIP_ALERTS:
<span class="fc" id="L885">                qb.setTables(ObaContract.TripAlerts.PATH);</span>
<span class="fc" id="L886">                qb.setProjectionMap(sTripAlertsProjectionMap);</span>
<span class="fc" id="L887">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case TRIP_ALERTS_ID:
<span class="fc" id="L891">                qb.setTables(ObaContract.TripAlerts.PATH);</span>
<span class="fc" id="L892">                qb.setProjectionMap(sTripAlertsProjectionMap);</span>
<span class="fc" id="L893">                qb.appendWhere(ObaContract.TripAlerts._ID);</span>
<span class="fc" id="L894">                qb.appendWhere(&quot;=&quot;);</span>
<span class="fc" id="L895">                qb.appendWhere(String.valueOf(ContentUris.parseId(uri)));</span>
<span class="fc" id="L896">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case STOP_ROUTE_FILTERS:
<span class="nc" id="L900">                qb.setTables(ObaContract.StopRouteFilters.PATH);</span>
<span class="nc" id="L901">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case SERVICE_ALERTS:
<span class="nc" id="L905">                qb.setTables(ObaContract.ServiceAlerts.PATH);</span>
<span class="nc" id="L906">                qb.setProjectionMap(sServiceAlertsProjectionMap);</span>
<span class="nc" id="L907">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case SERVICE_ALERTS_ID:
<span class="nc" id="L911">                qb.setTables(ObaContract.ServiceAlerts.PATH);</span>
<span class="nc" id="L912">                qb.setProjectionMap(sServiceAlertsProjectionMap);</span>
<span class="nc" id="L913">                qb.appendWhere(ObaContract.ServiceAlerts._ID);</span>
<span class="nc" id="L914">                qb.appendWhere(&quot;=&quot;);</span>
<span class="nc" id="L915">                qb.appendWhereEscapeString(uri.getLastPathSegment());</span>
<span class="nc" id="L916">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGIONS:
<span class="fc" id="L920">                qb.setTables(ObaContract.Regions.PATH);</span>
<span class="fc" id="L921">                qb.setProjectionMap(sRegionsProjectionMap);</span>
<span class="fc" id="L922">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGIONS_ID:
<span class="fc" id="L926">                qb.setTables(ObaContract.Regions.PATH);</span>
<span class="fc" id="L927">                qb.setProjectionMap(sRegionsProjectionMap);</span>
<span class="fc" id="L928">                qb.appendWhere(ObaContract.Regions._ID);</span>
<span class="fc" id="L929">                qb.appendWhere(&quot;=&quot;);</span>
<span class="fc" id="L930">                qb.appendWhere(String.valueOf(ContentUris.parseId(uri)));</span>
<span class="fc" id="L931">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGION_BOUNDS:
<span class="fc" id="L935">                qb.setTables(ObaContract.RegionBounds.PATH);</span>
<span class="fc" id="L936">                qb.setProjectionMap(sRegionBoundsProjectionMap);</span>
<span class="fc" id="L937">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGION_BOUNDS_ID:
<span class="nc" id="L941">                qb.setTables(ObaContract.RegionBounds.PATH);</span>
<span class="nc" id="L942">                qb.setProjectionMap(sRegionBoundsProjectionMap);</span>
<span class="nc" id="L943">                qb.appendWhere(ObaContract.RegionBounds._ID);</span>
<span class="nc" id="L944">                qb.appendWhere(&quot;=&quot;);</span>
<span class="nc" id="L945">                qb.appendWhere(String.valueOf(ContentUris.parseId(uri)));</span>
<span class="nc" id="L946">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGION_OPEN311_SERVERS:
<span class="fc" id="L950">                qb.setTables(ObaContract.RegionOpen311Servers.PATH);</span>
<span class="fc" id="L951">                qb.setProjectionMap(sRegionOpen311ProjectionMap);</span>
<span class="fc" id="L952">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case REGION_OPEN311_SERVERS_ID:
<span class="nc" id="L956">                qb.setTables(ObaContract.RegionOpen311Servers.PATH);</span>
<span class="nc" id="L957">                qb.setProjectionMap(sRegionOpen311ProjectionMap);</span>
<span class="nc" id="L958">                qb.appendWhere(ObaContract.RegionOpen311Servers._ID);</span>
<span class="nc" id="L959">                qb.appendWhere(&quot;=&quot;);</span>
<span class="nc" id="L960">                qb.appendWhere(String.valueOf(ContentUris.parseId(uri)));</span>
<span class="nc" id="L961">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);

            case ROUTE_HEADSIGN_FAVORITES:
<span class="fc" id="L965">                qb.setTables(ObaContract.RouteHeadsignFavorites.PATH);</span>
<span class="fc" id="L966">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);
            case NAV_STOPS:
<span class="nc" id="L969">                qb.setTables(ObaContract.NavStops.PATH);</span>
<span class="nc" id="L970">                return qb.query(mDb, projection, selection, selectionArgs,</span>
                        null, null, sortOrder, limit);
            default:
<span class="nc" id="L973">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
    }

    private int updateInternal(SQLiteDatabase db,
                               Uri uri, ContentValues values, String selection,
                               String[] selectionArgs) {
<span class="fc" id="L980">        final int match = sUriMatcher.match(uri);</span>
<span class="pc bpc" id="L981" title="16 of 20 branches missed.">        switch (match) {</span>
            case STOPS:
<span class="nc" id="L983">                return db.update(ObaContract.Stops.PATH, values, selection, selectionArgs);</span>

            case STOPS_ID:
<span class="fc" id="L986">                return db.update(ObaContract.Stops.PATH, values,</span>
<span class="fc" id="L987">                        where(ObaContract.Stops._ID, uri), selectionArgs);</span>

            case ROUTES:
<span class="nc" id="L990">                return db.update(ObaContract.Routes.PATH, values, selection, selectionArgs);</span>

            case ROUTES_ID:
<span class="fc" id="L993">                return db.update(ObaContract.Routes.PATH, values,</span>
<span class="fc" id="L994">                        where(ObaContract.Routes._ID, uri), selectionArgs);</span>

            case TRIPS:
<span class="nc" id="L997">                return db.update(ObaContract.Trips.PATH, values, selection, selectionArgs);</span>

            case TRIPS_ID:
<span class="nc" id="L1000">                return db.update(ObaContract.Trips.PATH, values, tripWhere(uri), selectionArgs);</span>

            case TRIP_ALERTS:
<span class="nc" id="L1003">                return db.update(ObaContract.TripAlerts.PATH, values, selection, selectionArgs);</span>

            case TRIP_ALERTS_ID:
<span class="fc" id="L1006">                return db.update(ObaContract.TripAlerts.PATH, values,</span>
<span class="fc" id="L1007">                        whereLong(ObaContract.TripAlerts._ID, uri), selectionArgs);</span>

            // Can we do anything here??
            case STOP_ROUTE_FILTERS:
<span class="nc" id="L1011">                return 0;</span>

            case SERVICE_ALERTS:
<span class="nc" id="L1014">                return db.update(ObaContract.ServiceAlerts.PATH, values, selection, selectionArgs);</span>

            case SERVICE_ALERTS_ID:
<span class="nc" id="L1017">                return db.update(ObaContract.ServiceAlerts.PATH, values,</span>
<span class="nc" id="L1018">                        where(ObaContract.ServiceAlerts._ID, uri), selectionArgs);</span>

            case REGIONS:
<span class="nc" id="L1021">                return db.update(ObaContract.Regions.PATH, values, selection, selectionArgs);</span>

            case REGIONS_ID:
<span class="fc" id="L1024">                return db.update(ObaContract.Regions.PATH, values,</span>
<span class="fc" id="L1025">                        whereLong(ObaContract.Regions._ID, uri), selectionArgs);</span>

            case REGION_BOUNDS:
<span class="nc" id="L1028">                return db.update(ObaContract.RegionBounds.PATH, values, selection, selectionArgs);</span>

            case REGION_BOUNDS_ID:
<span class="nc" id="L1031">                return db.update(ObaContract.RegionBounds.PATH, values,</span>
<span class="nc" id="L1032">                        whereLong(ObaContract.RegionBounds._ID, uri), selectionArgs);</span>

            case REGION_OPEN311_SERVERS:
<span class="nc" id="L1035">                return db.update(ObaContract.RegionOpen311Servers.PATH, values, selection, selectionArgs);</span>

            case REGION_OPEN311_SERVERS_ID:
<span class="nc" id="L1038">                return db.update(ObaContract.RegionOpen311Servers.PATH, values,</span>
<span class="nc" id="L1039">                        whereLong(ObaContract.RegionOpen311Servers._ID, uri), selectionArgs);</span>

            case ROUTE_HEADSIGN_FAVORITES:
<span class="nc" id="L1042">                return 0;</span>

            case NAV_STOPS:
<span class="nc" id="L1045">                return db.update(ObaContract.NavStops.PATH, values,</span>
<span class="nc" id="L1046">                        where(ObaContract.NavStops._ID, uri), selectionArgs);</span>

            default:
<span class="nc" id="L1049">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
    }

    private int deleteInternal(SQLiteDatabase db,
                               Uri uri, String selection, String[] selectionArgs) {
<span class="fc" id="L1055">        final int match = sUriMatcher.match(uri);</span>
<span class="pc bpc" id="L1056" title="13 of 20 branches missed.">        switch (match) {</span>
            case STOPS:
<span class="nc" id="L1058">                return db.delete(ObaContract.Stops.PATH, selection, selectionArgs);</span>

            case STOPS_ID:
<span class="fc" id="L1061">                return db.delete(ObaContract.Stops.PATH,</span>
<span class="fc" id="L1062">                        where(ObaContract.Stops._ID, uri), selectionArgs);</span>

            case ROUTES:
<span class="nc" id="L1065">                return db.delete(ObaContract.Routes.PATH, selection, selectionArgs);</span>

            case ROUTES_ID:
<span class="nc" id="L1068">                return db.delete(ObaContract.Routes.PATH,</span>
<span class="nc" id="L1069">                        where(ObaContract.Routes._ID, uri), selectionArgs);</span>

            case TRIPS:
<span class="nc" id="L1072">                return db.delete(ObaContract.Trips.PATH, selection, selectionArgs);</span>

            case TRIPS_ID:
<span class="nc" id="L1075">                return db.delete(ObaContract.Trips.PATH, tripWhere(uri), selectionArgs);</span>

            case TRIP_ALERTS:
<span class="nc" id="L1078">                return db.delete(ObaContract.TripAlerts.PATH, selection, selectionArgs);</span>

            case TRIP_ALERTS_ID:
<span class="fc" id="L1081">                return db.delete(ObaContract.TripAlerts.PATH,</span>
<span class="fc" id="L1082">                        whereLong(ObaContract.TripAlerts._ID, uri), selectionArgs);</span>

            case STOP_ROUTE_FILTERS:
<span class="nc" id="L1085">                return db.delete(ObaContract.StopRouteFilters.PATH, selection, selectionArgs);</span>

            case SERVICE_ALERTS:
<span class="nc" id="L1088">                return db.delete(ObaContract.ServiceAlerts.PATH, selection, selectionArgs);</span>

            case SERVICE_ALERTS_ID:
<span class="nc" id="L1091">                return db.delete(ObaContract.ServiceAlerts.PATH,</span>
<span class="nc" id="L1092">                        where(ObaContract.ServiceAlerts._ID, uri), selectionArgs);</span>

            case REGIONS:
<span class="fc" id="L1095">                return db.delete(ObaContract.Regions.PATH, selection, selectionArgs);</span>

            case REGIONS_ID:
<span class="fc" id="L1098">                return db.delete(ObaContract.Regions.PATH,</span>
<span class="fc" id="L1099">                        whereLong(ObaContract.Regions._ID, uri), selectionArgs);</span>

            case REGION_BOUNDS:
<span class="fc" id="L1102">                return db.delete(ObaContract.RegionBounds.PATH, selection, selectionArgs);</span>

            case REGION_BOUNDS_ID:
<span class="nc" id="L1105">                return db.delete(ObaContract.RegionBounds.PATH,</span>
<span class="nc" id="L1106">                        whereLong(ObaContract.RegionBounds._ID, uri), selectionArgs);</span>

            case REGION_OPEN311_SERVERS:
<span class="fc" id="L1109">                return db.delete(ObaContract.RegionOpen311Servers.PATH, selection, selectionArgs);</span>

            case REGION_OPEN311_SERVERS_ID:
<span class="nc" id="L1112">                return db.delete(ObaContract.RegionOpen311Servers.PATH,</span>
<span class="nc" id="L1113">                        whereLong(ObaContract.RegionOpen311Servers._ID, uri), selectionArgs);</span>

            case ROUTE_HEADSIGN_FAVORITES:
<span class="fc" id="L1116">                return db.delete(ObaContract.RouteHeadsignFavorites.PATH, selection, selectionArgs);</span>

            case NAV_STOPS:
<span class="nc" id="L1119">                return db.delete(ObaContract.NavStops.PATH, selection, selectionArgs);</span>

            default:
<span class="nc" id="L1122">                throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);</span>
        }
    }

    private String where(String column, Uri uri) {
<span class="fc" id="L1127">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L1128">        sb.append(column);</span>
<span class="fc" id="L1129">        sb.append('=');</span>
<span class="fc" id="L1130">        DatabaseUtils.appendValueToSql(sb, uri.getLastPathSegment());</span>
<span class="fc" id="L1131">        return sb.toString();</span>
    }

    private String whereLong(String column, Uri uri) {
<span class="fc" id="L1135">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L1136">        sb.append(column);</span>
<span class="fc" id="L1137">        sb.append('=');</span>
<span class="fc" id="L1138">        sb.append(String.valueOf(ContentUris.parseId(uri)));</span>
<span class="fc" id="L1139">        return sb.toString();</span>
    }

    private String tripWhere(Uri uri) {
<span class="nc" id="L1143">        List&lt;String&gt; segments = uri.getPathSegments();</span>
<span class="nc" id="L1144">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L1145">        sb.append(&quot;(&quot;);</span>
<span class="nc" id="L1146">        sb.append(ObaContract.Trips._ID);</span>
<span class="nc" id="L1147">        sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1148">        DatabaseUtils.appendValueToSql(sb, segments.get(1));</span>
<span class="nc" id="L1149">        sb.append(&quot; AND &quot;);</span>
<span class="nc" id="L1150">        sb.append(ObaContract.Trips.STOP_ID);</span>
<span class="nc" id="L1151">        sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1152">        DatabaseUtils.appendValueToSql(sb, segments.get(2));</span>
<span class="nc" id="L1153">        sb.append(&quot;)&quot;);</span>
<span class="nc" id="L1154">        return sb.toString();</span>
    }

    private SQLiteDatabase getDatabase() {
<span class="fc bfc" id="L1158" title="All 2 branches covered.">        if (mDb == null) {</span>
<span class="fc" id="L1159">            mDb = mOpenHelper.getWritableDatabase();</span>
            // Initialize the insert helpers
<span class="fc" id="L1161">            mStopsInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.Stops.PATH);</span>
<span class="fc" id="L1162">            mRoutesInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.Routes.PATH);</span>
<span class="fc" id="L1163">            mTripsInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.Trips.PATH);</span>
<span class="fc" id="L1164">            mTripAlertsInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.TripAlerts.PATH);</span>
<span class="fc" id="L1165">            mFilterInserter = new DatabaseUtils.InsertHelper(mDb,</span>
                    ObaContract.StopRouteFilters.PATH);
<span class="fc" id="L1167">            mServiceAlertsInserter = new DatabaseUtils.InsertHelper(mDb,</span>
                    ObaContract.ServiceAlerts.PATH);
<span class="fc" id="L1169">            mRegionsInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.Regions.PATH);</span>
<span class="fc" id="L1170">            mRegionBoundsInserter = new DatabaseUtils.InsertHelper(mDb,</span>
                    ObaContract.RegionBounds.PATH);
<span class="fc" id="L1172">            mRegionOpen311ServersInserter = new DatabaseUtils.InsertHelper(mDb,</span>
                    ObaContract.RegionOpen311Servers.PATH);
<span class="fc" id="L1174">            mRouteHeadsignFavoritesInserter = new DatabaseUtils.InsertHelper(mDb,</span>
                    ObaContract.RouteHeadsignFavorites.PATH);
<span class="fc" id="L1176">            mNavStopsInserter = new DatabaseUtils.InsertHelper(mDb, ObaContract.NavStops.PATH);</span>
        }
<span class="fc" id="L1178">        return mDb;</span>
    }

    //
    // Closes the database
    //
    public void closeDB() {
<span class="nc" id="L1185">        mOpenHelper.close();</span>
<span class="nc" id="L1186">        mDb = null;</span>
<span class="nc" id="L1187">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>