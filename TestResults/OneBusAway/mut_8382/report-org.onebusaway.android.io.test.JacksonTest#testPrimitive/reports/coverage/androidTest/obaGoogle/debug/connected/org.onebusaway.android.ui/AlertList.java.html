<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AlertList.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">AlertList.java</span></div><h1>AlertList.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012 Paul Watts (paulcwatts@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.util.ArrayAdapter;
import org.onebusaway.android.util.UIUtils;

import android.content.Context;
import android.content.res.Resources;
import android.graphics.drawable.Drawable;
import android.os.Build;
import android.text.style.ClickableSpan;
import android.view.View;
import android.widget.ListView;
import android.widget.TextView;

import java.util.Collection;

import androidx.core.content.ContextCompat;
import androidx.core.graphics.drawable.DrawableCompat;

class AlertList {

    interface Alert {

        public static final int TYPE_ERROR = 1;
        public static final int TYPE_WARNING = 2;
        public static final int TYPE_INFO = 3;
        public static final int TYPE_SHOW_HIDDEN_ALERTS = 4;

        // Adds an affordance to show that it's clickable
        // and you can see more..
        public static final int FLAG_HASMORE = 0x1;

        String getId();

        int getType();

        int getFlags();

        CharSequence getString();

        void onClick();
    }

    //
    // Adapter
    //
    private static class Adapter extends ArrayAdapter&lt;Alert&gt; {

        public Adapter(Context context) {
<span class="nc" id="L67">            super(context, R.layout.alert_item);</span>
<span class="nc" id="L68">        }</span>

        /**
         * Initialize the views - if the alert is a service alert that should be shown, populate
         * that text.  If its a response error (i.e., couldn't update from server), show that.
         * If it's an alert showing that some alerts are filtered, show that.
         */
        @Override
        protected void initView(View view, final Alert alert) {
<span class="nc" id="L77">            TextView alertView = (TextView) view.findViewById(android.R.id.text1);</span>
<span class="nc" id="L78">            View filterGroupView = view.findViewById(R.id.filter_alert_group);</span>
<span class="nc" id="L79">            TextView filterTextView = (TextView) view.findViewById(R.id.filter_alert_text);</span>
<span class="nc" id="L80">            TextView showAllView = (TextView) view.findViewById(R.id.show_all_alerts);</span>

<span class="nc" id="L82">            alertView.setText(alert.getString());</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">            boolean clickable = (alert.getFlags() &amp; Alert.FLAG_HASMORE) == Alert.FLAG_HASMORE;</span>
<span class="nc" id="L84">            int type = alert.getType();</span>
<span class="nc" id="L85">            Resources r = Application.get().getResources();</span>

<span class="nc" id="L87">            int bg = R.color.alert_text_background_info;</span>
<span class="nc" id="L88">            int arrowColor = R.color.alert_text_color_info;</span>
<span class="nc" id="L89">            int alertColor = R.color.alert_icon_info;</span>
<span class="nc" id="L90">            int resourceIdAlert = 0;</span>

<span class="nc bnc" id="L92" title="All 4 branches missed.">            switch (type) {</span>
                case Alert.TYPE_ERROR:
<span class="nc" id="L94">                    bg = R.color.alert_text_background_error;</span>
<span class="nc" id="L95">                    arrowColor = R.color.alert_text_color_error;</span>
<span class="nc" id="L96">                    resourceIdAlert = R.drawable.ic_alert_warning;</span>
<span class="nc" id="L97">                    alertColor = R.color.alert_icon_error;</span>
<span class="nc" id="L98">                    alertView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L99">                    filterGroupView.setVisibility(View.GONE);</span>
<span class="nc" id="L100">                    break;</span>
                case Alert.TYPE_WARNING:
<span class="nc" id="L102">                    bg = R.color.alert_text_background_warning;</span>
<span class="nc" id="L103">                    arrowColor = R.color.alert_text_color_warning;</span>
<span class="nc" id="L104">                    resourceIdAlert = R.drawable.ic_alert_warning;</span>
<span class="nc" id="L105">                    alertColor = R.color.alert_icon_warning;</span>
<span class="nc" id="L106">                    alertView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L107">                    filterGroupView.setVisibility(View.GONE);</span>
<span class="nc" id="L108">                    break;</span>
                case Alert.TYPE_SHOW_HIDDEN_ALERTS:
<span class="nc" id="L110">                    alertView.setVisibility(View.GONE);</span>
<span class="nc" id="L111">                    filterGroupView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L112">                    filterTextView.setText(alert.getString());</span>
<span class="nc" id="L113">                    break;</span>
                case Alert.TYPE_INFO:
                default:
<span class="nc" id="L116">                    bg = R.color.alert_text_background_info;</span>
<span class="nc" id="L117">                    arrowColor = R.color.alert_text_color_info;</span>
<span class="nc" id="L118">                    alertView.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L119">                    filterGroupView.setVisibility(View.GONE);</span>
                    break;
            }
            // Set text color to same as arrow color
<span class="nc" id="L123">            alertView.setTextColor(r.getColor(arrowColor));</span>

            Drawable dWarning;
<span class="nc" id="L126">            Drawable wdWarning = null;</span>

<span class="nc bnc" id="L128" title="All 2 branches missed.">            if (resourceIdAlert != 0) {</span>
                dWarning = ContextCompat
<span class="nc" id="L130">                        .getDrawable(Application.get().getApplicationContext(), resourceIdAlert);</span>
<span class="nc" id="L131">                wdWarning = DrawableCompat.wrap(dWarning);</span>
<span class="nc" id="L132">                wdWarning = wdWarning.mutate();</span>
                // Tint the icon
<span class="nc" id="L134">                DrawableCompat.setTint(wdWarning, r.getColor(alertColor));</span>
            }

            Drawable dArrow;
<span class="nc" id="L138">            Drawable wdArrow = null;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            int resourceIdArrow = clickable ? R.drawable.ic_navigation_chevron_right : 0;</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">            if (resourceIdArrow != 0) {</span>
                dArrow = ContextCompat
<span class="nc" id="L143">                        .getDrawable(Application.get().getApplicationContext(), resourceIdArrow);</span>
<span class="nc" id="L144">                wdArrow = DrawableCompat.wrap(dArrow);</span>
<span class="nc" id="L145">                wdArrow = wdArrow.mutate();</span>
                // Tint the icon
<span class="nc" id="L147">                DrawableCompat.setTint(wdArrow, r.getColor(arrowColor));</span>
            }

<span class="nc" id="L150">            alertView.setCompoundDrawablesWithIntrinsicBounds(wdWarning, null, wdArrow, null);</span>

            // Set the background color
<span class="nc" id="L153">            view.setBackgroundResource(bg);</span>

            // Even if we don't think it's clickable, we still need to
            // reset the onclick listener because we could be reusing this view.
<span class="nc" id="L157">            View.OnClickListener listener = new View.OnClickListener() {</span>
                @Override
                public void onClick(View v) {
<span class="nc" id="L160">                    alert.onClick();</span>
<span class="nc" id="L161">                }</span>
            };
<span class="nc" id="L163">            view.setOnClickListener(listener);</span>

            // Remove any previous clickable spans - we're recycling views between fragments for efficiency
<span class="nc" id="L166">            UIUtils.removeAllClickableSpans(showAllView);</span>
<span class="nc" id="L167">            ClickableSpan showAllClick = new ClickableSpan() {</span>
                public void onClick(View v) {
<span class="nc" id="L169">                    alert.onClick();</span>
<span class="nc" id="L170">                }</span>
            };
<span class="nc" id="L172">            UIUtils.setClickableSpan(showAllView, showAllClick);</span>
<span class="nc" id="L173">        }</span>
    }

    private Adapter mAdapter;

    private boolean mIsAlertHidden;

    private int mHiddenAlertCount;

    //
    // Cached views
    //
    private ListView mView;

<span class="nc" id="L187">    AlertList(Context context) {</span>
<span class="nc" id="L188">        mAdapter = new Adapter(context);</span>
<span class="nc" id="L189">    }</span>

    void initView(View view) {
<span class="nc" id="L192">        mView = (ListView) view;</span>
<span class="nc" id="L193">        mView.setAdapter(mAdapter);</span>
<span class="nc" id="L194">    }</span>

    //
    // Array / adapter methods
    //
    void add(Alert alert) {
<span class="nc" id="L200">        mAdapter.add(alert);</span>
<span class="nc" id="L201">    }</span>

    void addAll(Collection&lt;? extends Alert&gt; alerts) {
<span class="nc bnc" id="L204" title="All 2 branches missed.">        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) {</span>
<span class="nc" id="L205">            mAdapter.addAll(alerts);</span>
        } else {
<span class="nc bnc" id="L207" title="All 2 branches missed.">            for (Alert a : alerts) {</span>
<span class="nc" id="L208">                mAdapter.add(a);</span>
<span class="nc" id="L209">            }</span>
        }
<span class="nc" id="L211">    }</span>

    void insert(Alert alert, int index) {
<span class="nc" id="L214">        mAdapter.insert(alert, index);</span>
<span class="nc" id="L215">    }</span>

    int getPosition(Alert alert) {
<span class="nc" id="L218">        return mAdapter.getPosition(alert);</span>
    }

    void remove(Alert alert) {
<span class="nc" id="L222">        mAdapter.remove(alert);</span>
<span class="nc" id="L223">    }</span>

    int getCount() {
<span class="nc" id="L226">        return mAdapter.getCount();</span>
    }

    Alert getItem(int position) {
<span class="nc" id="L230">        return mAdapter.getItem(position);</span>
    }

    /**
     * Returns true if some alerts have previously been hidden that would otherwise
     * appear in this list, false if all alerts are visible
     *
     * @return true if some alerts have previously been hidden that would otherwise
     * appear in this list, false if all alerts are visible
     */
    public boolean isAlertHidden() {
<span class="nc" id="L241">        return mIsAlertHidden;</span>
    }

    /**
     * Set to true if there are some alerts that have been previously hidden that would
     * otherwise appear in this list, , false if all alerts are visible
     *
     * @param alertHidden true if there are some alerts that have been previously hidden that would
     *                    otherwise appear in this list, false if all alerts are visible
     */
    public void setAlertHidden(boolean alertHidden) {
<span class="nc" id="L252">        mIsAlertHidden = alertHidden;</span>
<span class="nc" id="L253">    }</span>

    /**
     * Returns the number of active alerts hidden that would otherwise appear in this list
     *
     * @return the number of active alerts hidden that would otherwise appear in this list
     */
    public int getHiddenAlertCount() {
<span class="nc" id="L261">        return mHiddenAlertCount;</span>
    }

    /**
     * Sets the number of active alerts hidden that would otherwise appear in this list
     *
     * @param hiddenAlertCount the number of active alerts hidden that would otherwise appear in
     *                         this list
     */
    public void setHiddenAlertCount(int hiddenAlertCount) {
<span class="nc" id="L271">        mHiddenAlertCount = hiddenAlertCount;</span>
<span class="nc" id="L272">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>