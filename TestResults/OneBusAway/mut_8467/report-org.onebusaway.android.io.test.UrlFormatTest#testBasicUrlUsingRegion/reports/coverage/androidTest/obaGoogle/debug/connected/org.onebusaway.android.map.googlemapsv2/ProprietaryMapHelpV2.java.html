<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProprietaryMapHelpV2.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.map.googlemapsv2</a> &gt; <span class="el_source">ProprietaryMapHelpV2.java</span></div><h1>ProprietaryMapHelpV2.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 University of South Florida, Sean J. Barbeau (sjbarbeau@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.map.googlemapsv2;

import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.net.Uri;
import android.view.View;

import androidx.fragment.app.Fragment;

import com.google.android.gms.common.GooglePlayServicesNotAvailableException;
import com.google.android.gms.common.GooglePlayServicesRepairableException;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.LatLngBounds;
import com.google.android.gms.maps.model.Marker;
import com.google.android.libraries.places.compat.Place;
import com.google.android.libraries.places.compat.ui.PlaceAutocomplete;

import org.onebusaway.android.R;
import org.onebusaway.android.directions.util.CustomAddress;
import org.onebusaway.android.io.elements.ObaRegion;

/**
 * Helper methods specific to Google Maps API v2
 */
<span class="nc" id="L45">public class ProprietaryMapHelpV2 {</span>

    private static final String TAG = &quot;ProprietaryMapHelpV2&quot;;

    private static final String PLACES_ADDRESS_SEPARATOR = &quot;,&quot;;

    /**
     * Returns true if Android Maps V2 is installed, false if it is not
     */
    public static boolean isMapsInstalled(Context context) {
        try {
<span class="nc" id="L56">            ApplicationInfo info = context.getPackageManager()</span>
<span class="nc" id="L57">                    .getApplicationInfo(&quot;com.google.android.apps.maps&quot;, 0);</span>
<span class="nc" id="L58">            return true;</span>
<span class="nc" id="L59">        } catch (PackageManager.NameNotFoundException e) {</span>
<span class="nc" id="L60">            return false;</span>
        }
    }

    /**
     * Prompts the user to install Android Maps V2 from Google Play
     */
    public static void promptUserInstallMaps(final Context context) {
<span class="nc" id="L68">        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L69">        builder.setMessage(context.getString(R.string.please_install_google_maps_dialog_title));</span>
<span class="nc" id="L70">        builder.setCancelable(false);</span>
<span class="nc" id="L71">        builder.setPositiveButton(context.getString(R.string.install_google_maps_positive_button),</span>
<span class="nc" id="L72">                new DialogInterface.OnClickListener() {</span>
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L75">                        Intent intent = new Intent(Intent.ACTION_VIEW,</span>
<span class="nc" id="L76">                                Uri.parse(context.getString(R.string.android_maps_v2_market_url)));</span>
<span class="nc" id="L77">                        ResolveInfo info = context.getPackageManager()</span>
<span class="nc" id="L78">                                .resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">                        if (info != null) {</span>
<span class="nc" id="L80">                            context.startActivity(intent);</span>
                        } else {
                            // User doesn't have Play Store installed
<span class="nc" id="L83">                            AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L84">                            builder.setMessage(context.getString(</span>
                                    R.string.no_play_store));
<span class="nc" id="L86">                            builder.setCancelable(true);</span>
<span class="nc" id="L87">                            builder.setPositiveButton(context.getString(R.string.ok),</span>
<span class="nc" id="L88">                                    new DialogInterface.OnClickListener() {</span>
                                        public void onClick(DialogInterface dialog, int id) {
<span class="nc" id="L90">                                            dialog.dismiss();</span>
<span class="nc" id="L91">                                        }</span>
                                    });
<span class="nc" id="L93">                            AlertDialog d = builder.create();</span>
<span class="nc" id="L94">                            d.show();</span>
                        }
<span class="nc" id="L96">                    }</span>
                }
        );
<span class="nc" id="L99">        AlertDialog dialog = builder.create();</span>
<span class="nc" id="L100">        dialog.show();</span>
<span class="nc" id="L101">    }</span>

    /**
     * Decode the result of an Intent to Google Places Autocomplete into a CustomAddress.
     * Here because of LatLng, Place which are specific to Google Places API.
     */
    public static CustomAddress getCustomAddressFromPlacesIntent(Context context, Intent intent) {
<span class="nc" id="L108">        Place place = PlaceAutocomplete.getPlace(context, intent);</span>

<span class="nc" id="L110">        CustomAddress address = new CustomAddress();</span>

<span class="nc" id="L112">        String placeName = place.getName().toString();</span>
<span class="nc" id="L113">        address.setAddressLine(0, placeName);</span>

<span class="nc" id="L115">        String addressString = place.getAddress().toString();</span>
<span class="nc" id="L116">        String[] tokens = addressString.split(PLACES_ADDRESS_SEPARATOR);</span>

        // Posible that first line of address is place name.
<span class="nc bnc" id="L119" title="All 2 branches missed.">        int start = placeName.equals(tokens[0]) ? 1 : 0;</span>

<span class="nc" id="L121">        int j = 1; // address line index</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        for (int i = start; i &lt; tokens.length; i++) {</span>
<span class="nc" id="L123">            address.setAddressLine(j++, tokens[i]);</span>
        }

<span class="nc" id="L126">        LatLng loc = place.getLatLng();</span>

<span class="nc" id="L128">        address.setLatitude(loc.latitude);</span>
<span class="nc" id="L129">        address.setLongitude(loc.longitude);</span>

<span class="nc" id="L131">        return address;</span>
    }

    /**
     * Helper class to start Google Places Autocomplete when a field is clicked.
     * Does not check that Google API is available.
     * Here because of the use of LatLngBounds. Decode result with
     * getCustomAddressFromPlacesIntent.
     */
    public static class StartPlacesAutocompleteOnClick implements View.OnClickListener {

        int mRequestCode;
        Fragment mFragment;
        ObaRegion mRegion;

<span class="nc" id="L146">        public StartPlacesAutocompleteOnClick(int requestCode, Fragment fragment, ObaRegion region) {</span>
<span class="nc" id="L147">            mRequestCode = requestCode;</span>
<span class="nc" id="L148">            mFragment = fragment;</span>
<span class="nc" id="L149">            mRegion = region;</span>
<span class="nc" id="L150">        }</span>

        @Override
        public void onClick(View v) {
<span class="nc" id="L154">            Intent intent = null;</span>
<span class="nc" id="L155">            PlaceAutocomplete.IntentBuilder builder =</span>
                    new PlaceAutocomplete.IntentBuilder(PlaceAutocomplete.MODE_OVERLAY);

<span class="nc bnc" id="L158" title="All 2 branches missed.">            if (mRegion != null) {</span>
                // Bias search results to region bounds
<span class="nc" id="L160">                LatLngBounds bounds = MapHelpV2.getRegionBounds(mRegion);</span>
<span class="nc" id="L161">                builder.setBoundsBias(bounds);</span>
            }

            try {
<span class="nc" id="L165">                intent = builder.build(mFragment.getActivity());</span>
<span class="nc" id="L166">            } catch (GooglePlayServicesRepairableException e) {</span>
<span class="nc" id="L167">                e.printStackTrace();</span>
<span class="nc" id="L168">            } catch (GooglePlayServicesNotAvailableException e) {</span>
<span class="nc" id="L169">                e.printStackTrace();</span>
<span class="nc" id="L170">            }</span>

<span class="nc" id="L172">            mFragment.startActivityForResult(intent, mRequestCode);</span>
<span class="nc" id="L173">        }</span>
    }

    /**
     * Sets the zIndex for the given marker to the given zIndex.
     * @param m marker to set the zIndex for
     * @param zIndex zIndex to set on the given marker (default is 0)
     */
    public static void setZIndex(Marker m, float zIndex) {
<span class="nc" id="L182">        m.setZIndex(zIndex);</span>
<span class="nc" id="L183">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>