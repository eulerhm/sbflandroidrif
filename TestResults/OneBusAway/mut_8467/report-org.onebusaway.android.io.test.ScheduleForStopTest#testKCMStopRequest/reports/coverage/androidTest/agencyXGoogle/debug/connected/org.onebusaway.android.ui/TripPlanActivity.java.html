<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TripPlanActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">TripPlanActivity.java</span></div><h1>TripPlanActivity.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2016-2017 Cambridge Systematics, Inc.,
 * University of South Florida (sjbarbeau@gmail.com),
 * Microsoft Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.app.AlertDialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.location.Location;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.ViewTreeObserver;
import android.widget.ListView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import com.google.firebase.analytics.FirebaseAnalytics;
import com.sothree.slidinguppanel.ScrollableViewHelper;
import com.sothree.slidinguppanel.SlidingUpPanelLayout;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.directions.tasks.TripRequest;
import org.onebusaway.android.directions.util.OTPConstants;
import org.onebusaway.android.directions.util.TripRequestBuilder;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.travelbehavior.TravelBehaviorManager;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.UIUtils;
import org.opentripplanner.api.model.Itinerary;
import org.opentripplanner.api.model.TripPlan;
import org.opentripplanner.api.ws.Message;
import java.util.ArrayList;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L53">public class TripPlanActivity extends AppCompatActivity implements TripRequest.Callback, TripResultsFragment.Listener, TripPlanFragment.Listener {</span>

    private static final String TAG = &quot;TripPlanActivity&quot;;

    TripRequestBuilder mBuilder;

<span class="nc" id="L59">    TripRequest mTripRequest = null;</span>

    SlidingUpPanelLayout mPanel;

    AlertDialog mFeedbackDialog;

    private static final String PLAN_ERROR_CODE = &quot;org.onebusaway.android.PLAN_ERROR_CODE&quot;;

    private static final String PLAN_ERROR_URL = &quot;org.onebusaway.android.PLAN_ERROR_URL&quot;;

    private static final String PLAN_REQUEST_URL = &quot;org.onebusaway.android.PLAN_REQUEST_URL&quot;;

    private static final String PANEL_STATE_EXPANDED = &quot;org.onebusaway.android.PANEL_STATE_EXPANDED&quot;;

    private static final String SHOW_ERROR_DIALOG = &quot;org.onebusaway.android.SHOW_ERROR_DIALOG&quot;;

    private static final String REQUEST_LOADING = &quot;org.onebusaway.android.REQUEST_LOADING&quot;;

    TripResultsFragment mResultsFragment;

    private ProgressDialog mProgressDialog;

<span class="nc" id="L81">    boolean mRequestLoading = false;</span>

    private FirebaseAnalytics mFirebaseAnalytics;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1450)) {</span>
<span class="nc" id="L88">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1451)) {</span>
<span class="nc" id="L91">            setContentView(R.layout.activity_trip_plan);</span>
        }
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1452)) {</span>
<span class="nc" id="L94">            UIUtils.setupActionBar(this);</span>
        }
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1453)) {</span>
<span class="nc" id="L97">            mFirebaseAnalytics = FirebaseAnalytics.getInstance(this);</span>
        }
<span class="nc bnc" id="L99" title="All 2 branches missed.">        Bundle bundle = (savedInstanceState == null) ? new Bundle() : savedInstanceState;</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1454)) {</span>
<span class="nc" id="L101">            mBuilder = new TripRequestBuilder(bundle);</span>
        }
<span class="nc" id="L103">    }</span>

    @Override
    protected void onResume() {
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1455)) {</span>
<span class="nc" id="L108">            super.onResume();</span>
        }
<span class="nc" id="L110">        Bundle bundle = mBuilder.getBundle();</span>
<span class="nc" id="L111">        boolean newItineraries = false;</span>
        // see if there is data from intent
<span class="nc" id="L113">        Intent intent = getIntent();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1470)) {</span>
<span class="nc bnc" id="L115" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1456) ? (intent != null || intent.getExtras() != null) : (intent != null &amp;&amp; intent.getExtras() != null))) {</span>
<span class="nc" id="L116">                OTPConstants.Source source = (OTPConstants.Source) intent.getSerializableExtra(OTPConstants.INTENT_SOURCE);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1469)) {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">                    if (source != null) {</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1458)) {</span>
                            // Copy planning params - necessary if this intent came from a notification.
<span class="nc bnc" id="L121" title="All 2 branches missed.">                            if (source == OTPConstants.Source.NOTIFICATION) {</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1457)) {</span>
<span class="nc" id="L123">                                    new TripRequestBuilder(intent.getExtras()).copyIntoBundle(bundle);</span>
                                }
                            }
                        }
<span class="nc" id="L127">                        ArrayList&lt;Itinerary&gt; itineraries = (ArrayList&lt;Itinerary&gt;) intent.getExtras().getSerializable(OTPConstants.ITINERARIES);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1461)) {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                            if (itineraries != null) {</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1459)) {</span>
<span class="nc" id="L131">                                    bundle.putSerializable(OTPConstants.ITINERARIES, itineraries);</span>
                                }
<span class="nc bnc" id="L133" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1460)) {</span>
<span class="nc" id="L134">                                    newItineraries = true;</span>
                                }
                            }
                        }
<span class="nc bnc" id="L138" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1465)) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                            if (intent.getIntExtra(PLAN_ERROR_CODE, -1) != -1) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1462)) {</span>
<span class="nc" id="L141">                                    bundle.putSerializable(SHOW_ERROR_DIALOG, true);</span>
                                }
<span class="nc bnc" id="L143" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1463)) {</span>
<span class="nc" id="L144">                                    bundle.putInt(PLAN_ERROR_CODE, intent.getIntExtra(PLAN_ERROR_CODE, 0));</span>
                                }
<span class="nc bnc" id="L146" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(1464)) {</span>
<span class="nc" id="L147">                                    bundle.putString(PLAN_ERROR_URL, intent.getStringExtra(PLAN_ERROR_URL));</span>
                                }
                            }
                        }
<span class="nc bnc" id="L151" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1466)) {</span>
<span class="nc" id="L152">                            setIntent(null);</span>
                        }
<span class="nc bnc" id="L154" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1467)) {</span>
<span class="nc" id="L155">                            bundle.putBoolean(REQUEST_LOADING, false);</span>
                        }
<span class="nc bnc" id="L157" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1468)) {</span>
<span class="nc" id="L158">                            mRequestLoading = false;</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1473)) {</span>
<span class="nc bnc" id="L165" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1471) ? (mRequestLoading &amp;&amp; bundle.getBoolean(REQUEST_LOADING)) : (mRequestLoading || bundle.getBoolean(REQUEST_LOADING)))) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1472)) {</span>
<span class="nc" id="L167">                    showProgressDialog();</span>
                }
            }
        }
        // Check which fragment to create
<span class="nc bnc" id="L172" title="All 2 branches missed.">        boolean haveTripPlan = bundle.getSerializable(OTPConstants.ITINERARIES) != null;</span>
<span class="nc" id="L173">        TripPlanFragment fragment = (TripPlanFragment) getSupportFragmentManager().findFragmentById(R.id.trip_plan_fragment_container);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1478)) {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (fragment == null) {</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1474)) {</span>
<span class="nc" id="L177">                    fragment = new TripPlanFragment();</span>
                }
<span class="nc bnc" id="L179" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1475)) {</span>
<span class="nc" id="L180">                    fragment.setArguments(bundle);</span>
                }
<span class="nc bnc" id="L182" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1476)) {</span>
<span class="nc" id="L183">                    fragment.setListener(this);</span>
                }
<span class="nc bnc" id="L185" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1477)) {</span>
<span class="nc" id="L186">                    getSupportFragmentManager().beginTransaction().add(R.id.trip_plan_fragment_container, fragment, TripPlanFragment.TAG).commit();</span>
                }
            }
        }
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1479)) {</span>
<span class="nc" id="L191">            mPanel = (SlidingUpPanelLayout) findViewById(R.id.trip_plan_sliding_layout);</span>
        }
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1480)) {</span>
<span class="nc" id="L194">            mPanel.setEnabled(haveTripPlan);</span>
        }
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1485)) {</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if (haveTripPlan) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1481)) {</span>
<span class="nc" id="L199">                    initResultsFragment();</span>
                }
<span class="nc bnc" id="L201" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1484)) {</span>
<span class="nc bnc" id="L202" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(1482) ? (bundle.getBoolean(PANEL_STATE_EXPANDED) &amp;&amp; newItineraries) : (bundle.getBoolean(PANEL_STATE_EXPANDED) || newItineraries))) {</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1483)) {</span>
<span class="nc" id="L204">                            mPanel.setPanelState(SlidingUpPanelLayout.PanelState.EXPANDED);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1490)) {</span>
            // show error dialog if necessary
<span class="nc bnc" id="L212" title="All 2 branches missed.">            if (bundle.getBoolean(SHOW_ERROR_DIALOG)) {</span>
<span class="nc" id="L213">                int planErrorCode = 0;</span>
<span class="nc" id="L214">                String planErrorUrl = null;</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1488)) {</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                    if (intent != null) {</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1486)) {</span>
<span class="nc" id="L218">                            planErrorCode = intent.getIntExtra(PLAN_ERROR_CODE, 0);</span>
                        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1487)) {</span>
<span class="nc" id="L221">                            planErrorUrl = intent.getStringExtra(PLAN_ERROR_URL);</span>
                        }
                    }
                }
<span class="nc bnc" id="L225" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1489)) {</span>
<span class="nc" id="L226">                    showFeedbackDialog(planErrorCode, planErrorUrl);</span>
                }
            }
        }
<span class="nc bnc" id="L230" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1494)) {</span>
<span class="nc bnc" id="L231" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1491) ? (fragment != null || intent != null) : (fragment != null &amp;&amp; intent != null))) {</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1492)) {</span>
<span class="nc" id="L233">                    fragment.setPlanErrorUrl(intent.getStringExtra(PLAN_ERROR_URL));</span>
                }
<span class="nc bnc" id="L235" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1493)) {</span>
<span class="nc" id="L236">                    fragment.setPlanRequestUrl(intent.getStringExtra(PLAN_REQUEST_URL));</span>
                }
            }
        }
        // Set the height of the panel after drawing occurs.
<span class="nc" id="L241">        final ViewGroup layout = (ViewGroup) findViewById(R.id.trip_plan_fragment_container);</span>
<span class="nc" id="L242">        ViewTreeObserver vto = layout.getViewTreeObserver();</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1501)) {</span>
<span class="nc" id="L244">            vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {</span>

                @Override
                public void onGlobalLayout() {
<span class="nc bnc" id="L248" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1495)) {</span>
<span class="nc" id="L249">                        layout.getViewTreeObserver().removeGlobalOnLayoutListener(this);</span>
                    }
<span class="nc" id="L251">                    int viewHeight = mPanel.getHeight();</span>
<span class="nc" id="L252">                    int height = layout.getMeasuredHeight();</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1500)) {</span>
<span class="nc bnc" id="L254" title="All 8 branches missed.">                        mPanel.setPanelHeight((ListenerUtil.mutListener.listen(1499) ? (viewHeight % height) : (ListenerUtil.mutListener.listen(1498) ? (viewHeight / height) : (ListenerUtil.mutListener.listen(1497) ? (viewHeight * height) : (ListenerUtil.mutListener.listen(1496) ? (viewHeight + height) : (viewHeight - height))))));</span>
                    }
<span class="nc" id="L256">                }</span>
            });
        }
<span class="nc" id="L259">    }</span>

    @Override
    public void onNewIntent(Intent intent) {
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1502)) {</span>
<span class="nc" id="L264">            setIntent(intent);</span>
        }
<span class="nc" id="L266">    }</span>

    @Override
    public void onSaveInstanceState(Bundle bundle) {
<span class="nc bnc" id="L270" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1511)) {</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">            if (mBuilder != null) {</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1503)) {</span>
<span class="nc" id="L273">                    mBuilder.copyIntoBundle(bundle);</span>
                }
                // We also saved the itineraries and the results state in this bundle
<span class="nc" id="L276">                Bundle source = mBuilder.getBundle();</span>
<span class="nc" id="L277">                ArrayList&lt;Itinerary&gt; itineraries = (ArrayList&lt;Itinerary&gt;) source.getSerializable(OTPConstants.ITINERARIES);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1505)) {</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">                    if (itineraries != null) {</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(1504)) {</span>
<span class="nc" id="L281">                            bundle.putSerializable(OTPConstants.ITINERARIES, itineraries);</span>
                        }
                    }
                }
<span class="nc" id="L285">                int rank = source.getInt(OTPConstants.SELECTED_ITINERARY);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1506)) {</span>
<span class="nc" id="L287">                    bundle.putInt(OTPConstants.SELECTED_ITINERARY, rank);</span>
                }
<span class="nc" id="L289">                boolean showMap = source.getBoolean(OTPConstants.SHOW_MAP);</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1507)) {</span>
<span class="nc" id="L291">                    bundle.putBoolean(OTPConstants.SHOW_MAP, showMap);</span>
                }
<span class="nc bnc" id="L293" title="All 2 branches missed.">                boolean panelStateExpanded = (mPanel.getPanelState() == SlidingUpPanelLayout.PanelState.EXPANDED);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1508)) {</span>
<span class="nc" id="L295">                    bundle.putBoolean(PANEL_STATE_EXPANDED, panelStateExpanded);</span>
                }
<span class="nc" id="L297">                boolean showError = source.getBoolean(SHOW_ERROR_DIALOG);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1509)) {</span>
<span class="nc" id="L299">                    bundle.putBoolean(SHOW_ERROR_DIALOG, showError);</span>
                }
<span class="nc bnc" id="L301" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1510)) {</span>
<span class="nc" id="L302">                    bundle.putBoolean(REQUEST_LOADING, mRequestLoading);</span>
                }
            }
        }
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1512)) {</span>
<span class="nc" id="L307">            super.onSaveInstanceState(bundle);</span>
        }
<span class="nc" id="L309">    }</span>

    @Override
    public void onPause() {
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1513)) {</span>
<span class="nc" id="L314">            super.onPause();</span>
        }
<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1515)) {</span>
            // Close possible progress dialog.
<span class="nc bnc" id="L318" title="All 2 branches missed.">            if (mProgressDialog != null) {</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1514)) {</span>
<span class="nc" id="L320">                    mProgressDialog.dismiss();</span>
                }
            }
        }
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1517)) {</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">            if (mFeedbackDialog != null) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1516)) {</span>
<span class="nc" id="L327">                    mFeedbackDialog.dismiss();</span>
                }
            }
        }
<span class="nc" id="L331">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1521)) {</span>
<span class="nc bnc" id="L336" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1518) ? (mPanel != null || mPanel.getPanelState() == SlidingUpPanelLayout.PanelState.EXPANDED) : (mPanel != null &amp;&amp; mPanel.getPanelState() == SlidingUpPanelLayout.PanelState.EXPANDED))) {</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1520)) {</span>
<span class="nc" id="L338">                    mPanel.setPanelState(SlidingUpPanelLayout.PanelState.COLLAPSED);</span>
                }
            } else {
<span class="nc bnc" id="L341" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1519)) {</span>
<span class="nc" id="L342">                    super.onBackPressed();</span>
                }
            }
        }
<span class="nc" id="L346">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1523)) {</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (item.getItemId() == android.R.id.home) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1522)) {</span>
                    // Ensure the software and hardware back buttons have the same behavior
<span class="nc" id="L354">                    onBackPressed();</span>
                }
<span class="nc" id="L356">                return true;</span>
            }
        }
<span class="nc" id="L359">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    public void onTripRequestReady() {
        // Remove results fragment if it exists
<span class="nc" id="L365">        Fragment fragment = getSupportFragmentManager().findFragmentById(R.id.trip_results_fragment_container);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1525)) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (fragment != null) {</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1524)) {</span>
<span class="nc" id="L369">                    getSupportFragmentManager().beginTransaction().remove(fragment).commit();</span>
                }
            }
        }
<span class="nc bnc" id="L373" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1526)) {</span>
<span class="nc" id="L374">            mTripRequest = mBuilder.setListener(this).execute(this);</span>
        }
        // clear out selected itinerary from bundle
<span class="nc" id="L377">        Bundle bundle = mBuilder.getBundle();</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1527)) {</span>
<span class="nc" id="L379">            bundle.remove(OTPConstants.ITINERARIES);</span>
        }
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1528)) {</span>
<span class="nc" id="L382">            bundle.remove(OTPConstants.SELECTED_ITINERARY);</span>
        }
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1529)) {</span>
<span class="nc" id="L385">            ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_trip_plan), null);</span>
        }
<span class="nc bnc" id="L387" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1530)) {</span>
<span class="nc" id="L388">            showProgressDialog();</span>
        }
<span class="nc" id="L390">    }</span>

    private void initResultsFragment() {
<span class="nc bnc" id="L393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1531)) {</span>
<span class="nc" id="L394">            mResultsFragment = (TripResultsFragment) getSupportFragmentManager().findFragmentById(R.id.trip_results_fragment_container);</span>
        }
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1533)) {</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">            if (mResultsFragment != null) {</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1532)) {</span>
                    // bundle arguments already set
<span class="nc" id="L400">                    mResultsFragment.displayNewResults();</span>
                }
<span class="nc" id="L402">                return;</span>
            }
        }
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1534)) {</span>
<span class="nc" id="L406">            mResultsFragment = new TripResultsFragment();</span>
        }
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1535)) {</span>
<span class="nc" id="L409">            mResultsFragment.setListener(this);</span>
        }
<span class="nc bnc" id="L411" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1536)) {</span>
<span class="nc" id="L412">            mResultsFragment.setArguments(mBuilder.getBundle());</span>
        }
<span class="nc bnc" id="L414" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1537)) {</span>
<span class="nc" id="L415">            getSupportFragmentManager().beginTransaction().add(R.id.trip_results_fragment_container, mResultsFragment).commit();</span>
        }
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1538)) {</span>
<span class="nc" id="L418">            getSupportFragmentManager().executePendingTransactions();</span>
        }
<span class="nc" id="L420">    }</span>

    @Override
    public void onTripRequestComplete(TripPlan tripPlan, String url) {
<span class="nc bnc" id="L424" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1539)) {</span>
<span class="nc" id="L425">            TravelBehaviorManager.saveTripPlan(tripPlan, url, getApplicationContext());</span>
        }
        // Send intent to ourselves...
<span class="nc" id="L428">        Intent intent = new Intent(this, TripPlanActivity.class).setAction(Intent.ACTION_MAIN).addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP).putExtra(OTPConstants.ITINERARIES, (ArrayList&lt;Itinerary&gt;) tripPlan.getItinerary()).putExtra(OTPConstants.INTENT_SOURCE, OTPConstants.Source.ACTIVITY).putExtra(PLAN_REQUEST_URL, url);</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1540)) {</span>
<span class="nc" id="L430">            startActivity(intent);</span>
        }
<span class="nc" id="L432">    }</span>

    @Override
    public void onTripRequestFailure(int errorCode, String url) {
<span class="nc" id="L436">        Intent intent = new Intent(this, TripPlanActivity.class).setAction(Intent.ACTION_MAIN).addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP).putExtra(PLAN_ERROR_CODE, errorCode).putExtra(PLAN_ERROR_URL, url).putExtra(OTPConstants.INTENT_SOURCE, OTPConstants.Source.ACTIVITY);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1541)) {</span>
<span class="nc" id="L438">            startActivity(intent);</span>
        }
<span class="nc" id="L440">    }</span>

    private void showFeedbackDialog(int errorCode, final String url) {
<span class="nc" id="L443">        String msg = getString(R.string.tripplanner_error_not_defined);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1549)) {</span>
<span class="nc bnc" id="L445" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(1547) ? ((ListenerUtil.mutListener.listen(1546) ? (errorCode &gt;= 0) : (ListenerUtil.mutListener.listen(1545) ? (errorCode &lt;= 0) : (ListenerUtil.mutListener.listen(1544) ? (errorCode &lt; 0) : (ListenerUtil.mutListener.listen(1543) ? (errorCode != 0) : (ListenerUtil.mutListener.listen(1542) ? (errorCode == 0) : (errorCode &gt; 0)))))) || errorCode != Message.PLAN_OK.getId()) : ((ListenerUtil.mutListener.listen(1546) ? (errorCode &gt;= 0) : (ListenerUtil.mutListener.listen(1545) ? (errorCode &lt;= 0) : (ListenerUtil.mutListener.listen(1544) ? (errorCode &lt; 0) : (ListenerUtil.mutListener.listen(1543) ? (errorCode != 0) : (ListenerUtil.mutListener.listen(1542) ? (errorCode == 0) : (errorCode &gt; 0)))))) &amp;&amp; errorCode != Message.PLAN_OK.getId()))) {</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1548)) {</span>
<span class="nc" id="L447">                    msg = getErrorMessage(errorCode);</span>
                }
            }
        }
<span class="nc" id="L451">        final Bundle bundle = mBuilder.getBundle();</span>
<span class="nc" id="L452">        AlertDialog.Builder feedback = new AlertDialog.Builder(this).setTitle(R.string.tripplanner_error_dialog_title).setMessage(msg);</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1552)) {</span>
<span class="nc" id="L454">            feedback.setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() {</span>

                @Override
                public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L458" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1550)) {</span>
<span class="nc" id="L459">                        bundle.putBoolean(SHOW_ERROR_DIALOG, false);</span>
                    }
<span class="nc bnc" id="L461" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(1551)) {</span>
<span class="nc" id="L462">                        clearBundleErrors();</span>
                    }
<span class="nc" id="L464">                }</span>
            });
        }
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1563)) {</span>
<span class="nc bnc" id="L468" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1553) ? (errorCode != Message.SYSTEM_ERROR.getId() || errorCode != Message.REQUEST_TIMEOUT.getId()) : (errorCode != Message.SYSTEM_ERROR.getId() &amp;&amp; errorCode != Message.REQUEST_TIMEOUT.getId()))) {</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1562)) {</span>
                    // Only add the report button if we get a server response (see #747)
<span class="nc" id="L471">                    feedback.setNegativeButton(R.string.report_problem_report, new DialogInterface.OnClickListener() {</span>

                        @Override
                        public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L475">                            String email = Application.get().getCurrentRegion().getOtpContactEmail();</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1559)) {</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">                                if (!TextUtils.isEmpty(email)) {</span>
<span class="nc" id="L478">                                    Location loc = Application.getLastKnownLocation(getApplicationContext(), null);</span>
<span class="nc" id="L479">                                    String locString = null;</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(1556)) {</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">                                        if (loc != null) {</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(1555)) {</span>
<span class="nc" id="L483">                                                locString = LocationUtils.printLocationDetails(loc);</span>
                                            }
                                        }
                                    }
<span class="nc bnc" id="L487" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(1557)) {</span>
<span class="nc" id="L488">                                        UIUtils.sendEmail(TripPlanActivity.this, email, locString, url, true);</span>
                                    }
<span class="nc bnc" id="L490" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(1558)) {</span>
<span class="nc" id="L491">                                        ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_app_feedback_otp), null);</span>
                                    }
<span class="nc" id="L493">                                } else {</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(1554)) {</span>
<span class="nc" id="L495">                                        Toast.makeText(TripPlanActivity.this, getString(R.string.tripplanner_no_contact), Toast.LENGTH_SHORT).show();</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L499" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1560)) {</span>
<span class="nc" id="L500">                                bundle.putBoolean(SHOW_ERROR_DIALOG, false);</span>
                            }
<span class="nc bnc" id="L502" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(1561)) {</span>
<span class="nc" id="L503">                                clearBundleErrors();</span>
                            }
<span class="nc" id="L505">                        }</span>
                    });
                }
            }
        }
<span class="nc bnc" id="L510" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1564)) {</span>
<span class="nc" id="L511">            mFeedbackDialog = feedback.create();</span>
        }
<span class="nc bnc" id="L513" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1565)) {</span>
<span class="nc" id="L514">            mFeedbackDialog.show();</span>
        }
<span class="nc" id="L516">    }</span>

    private void showProgressDialog() {
<span class="nc bnc" id="L519" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1566)) {</span>
<span class="nc" id="L520">            mRequestLoading = true;</span>
        }
<span class="nc bnc" id="L522" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1569)) {</span>
<span class="nc bnc" id="L523" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(1567) ? (mProgressDialog == null &amp;&amp; !mProgressDialog.isShowing()) : (mProgressDialog == null || !mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1568)) {</span>
<span class="nc" id="L525">                    mProgressDialog = ProgressDialog.show(this, &quot;&quot;, getResources().getText(R.string.task_progress_tripplanner_progress), true);</span>
                }
            }
        }
<span class="nc" id="L529">    }</span>

    private String getErrorMessage(int errorCode) {
<span class="nc bnc" id="L532" title="All 2 branches missed.">        if (errorCode == Message.SYSTEM_ERROR.getId()) {</span>
<span class="nc" id="L533">            return (getString(R.string.tripplanner_error_system));</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">        } else if (errorCode == Message.OUTSIDE_BOUNDS.getId()) {</span>
<span class="nc" id="L535">            return (getString(R.string.tripplanner_error_outside_bounds));</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">        } else if (errorCode == Message.PATH_NOT_FOUND.getId()) {</span>
<span class="nc" id="L537">            return (getString(R.string.tripplanner_error_path_not_found));</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">        } else if (errorCode == Message.NO_TRANSIT_TIMES.getId()) {</span>
<span class="nc" id="L539">            return (getString(R.string.tripplanner_error_no_transit_times));</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">        } else if (errorCode == Message.REQUEST_TIMEOUT.getId()) {</span>
<span class="nc" id="L541">            return (getString(R.string.tripplanner_error_request_timeout));</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">        } else if (errorCode == Message.BOGUS_PARAMETER.getId()) {</span>
<span class="nc" id="L543">            return (getString(R.string.tripplanner_error_bogus_parameter));</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_NOT_FOUND.getId()) {</span>
<span class="nc" id="L545">            return (getString(R.string.tripplanner_error_geocode_from_not_found));</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_TO_NOT_FOUND.getId()) {</span>
<span class="nc" id="L547">            return (getString(R.string.tripplanner_error_geocode_to_not_found));</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_TO_NOT_FOUND.getId()) {</span>
<span class="nc" id="L549">            return (getString(R.string.tripplanner_error_geocode_from_to_not_found));</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">        } else if (errorCode == Message.TOO_CLOSE.getId()) {</span>
<span class="nc" id="L551">            return (getString(R.string.tripplanner_error_too_close));</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">        } else if (errorCode == Message.LOCATION_NOT_ACCESSIBLE.getId()) {</span>
<span class="nc" id="L553">            return (getString(R.string.tripplanner_error_location_not_accessible));</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L555">            return (getString(R.string.tripplanner_error_geocode_from_ambiguous));</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_TO_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L557">            return (getString(R.string.tripplanner_error_geocode_to_ambiguous));</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_TO_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L559">            return (getString(R.string.tripplanner_error_geocode_from_to_ambiguous));</span>
<span class="nc bnc" id="L560" title="All 58 branches missed.">        } else if ((ListenerUtil.mutListener.listen(1572) ? ((ListenerUtil.mutListener.listen(1571) ? ((ListenerUtil.mutListener.listen(1570) ? (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() &amp;&amp; errorCode == Message.TRIANGLE_NOT_AFFINE.getId()) : (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() || errorCode == Message.TRIANGLE_NOT_AFFINE.getId())) &amp;&amp; errorCode == Message.TRIANGLE_OPTIMIZE_TYPE_NOT_SET.getId()) : ((ListenerUtil.mutListener.listen(1570) ? (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() &amp;&amp; errorCode == Message.TRIANGLE_NOT_AFFINE.getId()) : (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() || errorCode == Message.TRIANGLE_NOT_AFFINE.getId())) || errorCode == Message.TRIANGLE_OPTIMIZE_TYPE_NOT_SET.getId())) &amp;&amp; errorCode == Message.TRIANGLE_VALUES_NOT_SET.getId()) : ((ListenerUtil.mutListener.listen(1571) ? ((ListenerUtil.mutListener.listen(1570) ? (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() &amp;&amp; errorCode == Message.TRIANGLE_NOT_AFFINE.getId()) : (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() || errorCode == Message.TRIANGLE_NOT_AFFINE.getId())) &amp;&amp; errorCode == Message.TRIANGLE_OPTIMIZE_TYPE_NOT_SET.getId()) : ((ListenerUtil.mutListener.listen(1570) ? (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() &amp;&amp; errorCode == Message.TRIANGLE_NOT_AFFINE.getId()) : (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId() || errorCode == Message.TRIANGLE_NOT_AFFINE.getId())) || errorCode == Message.TRIANGLE_OPTIMIZE_TYPE_NOT_SET.getId())) || errorCode == Message.TRIANGLE_VALUES_NOT_SET.getId()))) {</span>
<span class="nc" id="L561">            return (getString(R.string.tripplanner_error_triangle));</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">        } else if (errorCode == TripRequest.NO_SERVER_SELECTED) {</span>
<span class="nc" id="L563">            return getString(R.string.tripplanner_no_server_selected_error);</span>
        } else {
<span class="nc" id="L565">            return null;</span>
        }
    }

    private void clearBundleErrors() {
<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1573)) {</span>
<span class="nc" id="L571">            mBuilder.getBundle().remove(PLAN_ERROR_CODE);</span>
        }
<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1574)) {</span>
<span class="nc" id="L574">            mBuilder.getBundle().remove(PLAN_ERROR_URL);</span>
        }
<span class="nc" id="L576">    }</span>

    // Handle the sliding panel's interactions with the list view and the map view.
    @Override
    public void onResultViewCreated(View container, final ListView listView, View mapView) {
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(1577)) {</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">            if (mPanel != null) {</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1575)) {</span>
<span class="nc" id="L584">                    mPanel.setScrollableViewHelper(new ScrollableViewHelper() {</span>

                        @Override
                        public int getScrollableViewScrollPosition(View scrollableView, boolean isSlidingUp) {
<span class="nc bnc" id="L588" title="All 2 branches missed.">                            if (mResultsFragment.isMapShowing()) {</span>
                                // Map can scroll infinitely, so return a positive value
<span class="nc" id="L590">                                return 1;</span>
                            } else {
<span class="nc" id="L592">                                return super.getScrollableViewScrollPosition(listView, isSlidingUp);</span>
                            }
                        }
                    });
                }
<span class="nc bnc" id="L597" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(1576)) {</span>
<span class="nc" id="L598">                    mPanel.setScrollableView(container);</span>
                }
            }
        }
<span class="nc" id="L602">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>