<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TripRequestBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.directions.util</a> &gt; <span class="el_source">TripRequestBuilder.java</span></div><h1>TripRequestBuilder.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2016 Cambridge Systematics, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.directions.util;

import android.app.Activity;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.directions.tasks.TripRequest;
import org.onebusaway.android.ui.TripModes;
import org.onebusaway.android.util.RegionUtils;
import org.opentripplanner.api.ws.Request;
import org.opentripplanner.routing.core.OptimizeType;
import org.opentripplanner.routing.core.TraverseMode;
import java.io.UnsupportedEncodingException;
import java.lang.ref.WeakReference;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLEncoder;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Date;
import java.util.List;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class TripRequestBuilder {

    private static final String ENCODING = &quot;UTF-8&quot;;

    private static final String TAG = &quot;TripRequestBuilder&quot;;

    private static final String ARRIVE_BY = &quot;.ARRIVE_BY&quot;;

    private static final String FROM_ADDRESS = &quot;.FROM_ADDRESS&quot;;

    private static final String FROM_LAT = &quot;.FROM_LAT&quot;;

    private static final String FROM_LON = &quot;.FROM_LON&quot;;

    private static final String FROM_NAME = &quot;.FROM_NAME&quot;;

    private static final String TO_ADDRESS = &quot;.TO_ADDRESS&quot;;

    private static final String TO_LAT = &quot;.TO_LAT&quot;;

    private static final String TO_LON = &quot;.TO_LON&quot;;

    private static final String TO_NAME = &quot;.TO_NAME&quot;;

    private static final String OPTIMIZE_TRANSFERS = &quot;.OPTIMIZE_TRANSFERS&quot;;

    private static final String WHEELCHAIR_ACCESSIBLE = &quot;.WHEELCHAIR_ACCESSIBLE&quot;;

    private static final String MAX_WALK_DISTANCE = &quot;.MAX_WALK_DISTANCE&quot;;

    private static final String MODE_SET = &quot;.MODE_SET&quot;;

    private static final String DATE_TIME = &quot;.DATE_TIME&quot;;

    private TripRequest.Callback mListener;

    private Bundle mBundle;

    private int mModeId;

<span class="nc" id="L82">    public TripRequestBuilder(Bundle bundle) {</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5561)) {</span>
<span class="nc" id="L84">            this.mBundle = bundle;</span>
        }
<span class="nc" id="L86">    }</span>

    public TripRequestBuilder setDepartureTime(Calendar calendar) {
<span class="nc bnc" id="L89" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5562)) {</span>
<span class="nc" id="L90">            mBundle.putBoolean(ARRIVE_BY, false);</span>
        }
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5563)) {</span>
<span class="nc" id="L93">            setDateTime(calendar.getTime());</span>
        }
<span class="nc" id="L95">        return this;</span>
    }

    public TripRequestBuilder setArrivalTime(Calendar calendar) {
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5564)) {</span>
<span class="nc" id="L100">            mBundle.putBoolean(ARRIVE_BY, true);</span>
        }
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5565)) {</span>
<span class="nc" id="L103">            setDateTime(calendar.getTime());</span>
        }
<span class="nc" id="L105">        return this;</span>
    }

    // default value is false
    public boolean getArriveBy() {
<span class="nc" id="L110">        Boolean b = mBundle.getBoolean(ARRIVE_BY);</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">        return b == null ? false : b;</span>
    }

    public TripRequestBuilder setFrom(CustomAddress from) {
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5566)) {</span>
<span class="nc" id="L116">            mBundle.putParcelable(FROM_ADDRESS, from);</span>
        }
<span class="nc" id="L118">        return this;</span>
    }

    public CustomAddress getFrom() {
<span class="nc" id="L122">        return (CustomAddress) mBundle.getParcelable(FROM_ADDRESS);</span>
    }

    public CustomAddress getTo() {
<span class="nc" id="L126">        return (CustomAddress) mBundle.getParcelable(TO_ADDRESS);</span>
    }

    public TripRequestBuilder setTo(CustomAddress to) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5567)) {</span>
<span class="nc" id="L131">            mBundle.putParcelable(TO_ADDRESS, to);</span>
        }
<span class="nc" id="L133">        return this;</span>
    }

    public TripRequestBuilder setListener(TripRequest.Callback listener) {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5568)) {</span>
<span class="nc" id="L138">            this.mListener = listener;</span>
        }
<span class="nc" id="L140">        return this;</span>
    }

    public TripRequestBuilder setOptimizeTransfers(boolean set) {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5569)) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            mBundle.putSerializable(OPTIMIZE_TRANSFERS, set ? OptimizeType.TRANSFERS : OptimizeType.QUICK);</span>
        }
<span class="nc" id="L147">        return this;</span>
    }

    private OptimizeType getOptimizeType() {
<span class="nc" id="L151">        OptimizeType type = (OptimizeType) mBundle.getSerializable(OPTIMIZE_TRANSFERS);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        return type == null ? OptimizeType.QUICK : type;</span>
    }

    public boolean getOptimizeTransfers() {
<span class="nc bnc" id="L156" title="All 2 branches missed.">        return getOptimizeType() == OptimizeType.TRANSFERS;</span>
    }

    public TripRequestBuilder setWheelchairAccessible(boolean wheelchair) {
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5570)) {</span>
<span class="nc" id="L161">            mBundle.putBoolean(WHEELCHAIR_ACCESSIBLE, wheelchair);</span>
        }
<span class="nc" id="L163">        return this;</span>
    }

    public boolean getWheelchairAccessible() {
<span class="nc" id="L167">        return mBundle.getBoolean(WHEELCHAIR_ACCESSIBLE);</span>
    }

    public TripRequestBuilder setMaxWalkDistance(double walkDistance) {
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5571)) {</span>
<span class="nc" id="L172">            mBundle.putDouble(MAX_WALK_DISTANCE, walkDistance);</span>
        }
<span class="nc" id="L174">        return this;</span>
    }

    public Double getMaxWalkDistance() {
<span class="nc" id="L178">        Double d = mBundle.getDouble(MAX_WALK_DISTANCE);</span>
<span class="nc bnc" id="L179" title="All 90 branches missed.">        return ((ListenerUtil.mutListener.listen(5582) ? ((ListenerUtil.mutListener.listen(5576) ? (d &gt;= 0) : (ListenerUtil.mutListener.listen(5575) ? (d &lt;= 0) : (ListenerUtil.mutListener.listen(5574) ? (d &gt; 0) : (ListenerUtil.mutListener.listen(5573) ? (d &lt; 0) : (ListenerUtil.mutListener.listen(5572) ? (d == 0) : (d != 0)))))) || (ListenerUtil.mutListener.listen(5581) ? (d &gt;= Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5580) ? (d &lt;= Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5579) ? (d &gt; Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5578) ? (d &lt; Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5577) ? (d == Double.MAX_VALUE) : (d != Double.MAX_VALUE))))))) : ((ListenerUtil.mutListener.listen(5576) ? (d &gt;= 0) : (ListenerUtil.mutListener.listen(5575) ? (d &lt;= 0) : (ListenerUtil.mutListener.listen(5574) ? (d &gt; 0) : (ListenerUtil.mutListener.listen(5573) ? (d &lt; 0) : (ListenerUtil.mutListener.listen(5572) ? (d == 0) : (d != 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5581) ? (d &gt;= Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5580) ? (d &lt;= Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5579) ? (d &gt; Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5578) ? (d &lt; Double.MAX_VALUE) : (ListenerUtil.mutListener.listen(5577) ? (d == Double.MAX_VALUE) : (d != Double.MAX_VALUE))))))))) ? d : null;</span>
    }

    // rail only -&gt; RAIL,TRAM,WALK (TRAM is included to allow light rail)
    public TripRequestBuilder setModeSetById(int id) {
        List&lt;String&gt; modes;
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5583)) {</span>
<span class="nc" id="L186">            mModeId = id;</span>
        }
<span class="nc bnc" id="L188" title="All 6 branches missed.">        switch(id) {</span>
            // Transit only
            case TripModes.TRANSIT_ONLY:
<span class="nc" id="L191">                modes = Arrays.asList(TraverseMode.TRANSIT.toString(), TraverseMode.WALK.toString());</span>
<span class="nc" id="L192">                break;</span>
            // Transit &amp; bikeshare
            case TripModes.TRANSIT_AND_BIKE:
<span class="nc bnc" id="L195" title="All 2 branches missed.">                if (Application.isBikeshareEnabled()) {</span>
<span class="nc" id="L196">                    modes = Arrays.asList(TraverseMode.TRANSIT.toString(), TraverseMode.WALK.toString(), Application.get().getString(R.string.traverse_mode_bicycle_rent));</span>
                } else {
<span class="nc" id="L198">                    modes = Arrays.asList(TraverseMode.TRANSIT.toString(), TraverseMode.WALK.toString());</span>
                }
<span class="nc" id="L200">                break;</span>
            case TripModes.BUS_ONLY:
<span class="nc" id="L202">                modes = Arrays.asList(TraverseMode.BUS.toString(), TraverseMode.WALK.toString());</span>
<span class="nc" id="L203">                break;</span>
            case TripModes.RAIL_ONLY:
<span class="nc" id="L205">                modes = Arrays.asList(TraverseMode.RAIL.toString(), TraverseMode.TRAM.toString(), TraverseMode.WALK.toString());</span>
<span class="nc" id="L206">                break;</span>
            case TripModes.BIKESHARE:
<span class="nc" id="L208">                modes = Arrays.asList(Application.get().getString(R.string.traverse_mode_bicycle_rent));</span>
<span class="nc" id="L209">                break;</span>
            default:
<span class="nc bnc" id="L211" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5584)) {</span>
<span class="nc" id="L212">                    Log.e(TAG, &quot;Invalid mode set ID&quot;);</span>
                }
<span class="nc" id="L214">                modes = Arrays.asList(TraverseMode.TRANSIT.toString(), TraverseMode.WALK.toString());</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5585)) {</span>
<span class="nc" id="L216">                    mModeId = -1;</span>
                }
        }
<span class="nc" id="L219">        String modeString = TextUtils.join(&quot;,&quot;, modes);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5586)) {</span>
<span class="nc" id="L221">            mBundle.putString(MODE_SET, modeString);</span>
        }
<span class="nc" id="L223">        return this;</span>
    }

    public int getModeSetId() {
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5588)) {</span>
            // IF bike mode is selected in the trip plan additional preferences but bikeshare is not enabled use the default mode (TRANSTI)
<span class="nc bnc" id="L229" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5587) ? (TripModes.BIKESHARE == mModeId || !Application.isBikeshareEnabled()) : (TripModes.BIKESHARE == mModeId &amp;&amp; !Application.isBikeshareEnabled()))) {</span>
<span class="nc" id="L230">                return TripModes.TRANSIT_ONLY;</span>
            }
        }
<span class="nc" id="L233">        return mModeId;</span>
    }

    private List&lt;String&gt; getModes() {
<span class="nc" id="L237">        String modeString = mBundle.getString(MODE_SET);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5589)) {</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (TextUtils.isEmpty(modeString)) {</span>
<span class="nc" id="L240">                return Arrays.asList(TraverseMode.TRANSIT.toString(), TraverseMode.WALK.toString());</span>
            }
        }
<span class="nc" id="L243">        return Arrays.asList(TextUtils.split(modeString, &quot;,&quot;));</span>
    }

    private String getModeString() {
<span class="nc" id="L247">        return mBundle.getString(MODE_SET);</span>
    }

    public TripRequest execute(Activity activity) {
<span class="nc" id="L251">        String from = getAddressString(getFrom());</span>
<span class="nc" id="L252">        String to = getAddressString(getTo());</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5591)) {</span>
<span class="nc bnc" id="L254" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5590) ? (TextUtils.isEmpty(from) &amp;&amp; TextUtils.isEmpty(to)) : (TextUtils.isEmpty(from) || TextUtils.isEmpty(to)))) {</span>
<span class="nc" id="L255">                throw new IllegalArgumentException(&quot;Must supply start and end to route between.&quot;);</span>
            }
        }
<span class="nc" id="L258">        Request request = new Request();</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5592)) {</span>
<span class="nc" id="L260">            request.setArriveBy(getArriveBy());</span>
        }
<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5593)) {</span>
<span class="nc" id="L263">            request.setFrom(from);</span>
        }
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5594)) {</span>
<span class="nc" id="L266">            request.setTo(to);</span>
        }
<span class="nc bnc" id="L268" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5595)) {</span>
<span class="nc" id="L269">            request.setOptimize(getOptimizeType());</span>
        }
<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5596)) {</span>
<span class="nc" id="L272">            request.setWheelchair(getWheelchairAccessible());</span>
        }
<span class="nc" id="L274">        Double maxWalkDistance = getMaxWalkDistance();</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5598)) {</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            if (maxWalkDistance != null) {</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5597)) {</span>
<span class="nc" id="L278">                    request.setMaxWalkDistance(maxWalkDistance);</span>
                }
            }
        }
<span class="nc" id="L282">        Date d = getDateTime();</span>
        // OTP expects date/time in this format
<span class="nc" id="L284">        String date = getFormattedDate(OTPConstants.FORMAT_OTP_SERVER_DATE_REQUEST, d);</span>
<span class="nc" id="L285">        String time = getFormattedDate(OTPConstants.FORMAT_OTP_SERVER_TIME_REQUEST, d);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5599)) {</span>
<span class="nc" id="L287">            request.setDateTime(date, time);</span>
        }
        // Request mode set does not work properly
<span class="nc" id="L290">        String modeString = mBundle.getString(MODE_SET);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5601)) {</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">            if (modeString != null) {</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5600)) {</span>
<span class="nc" id="L294">                    request.getParameters().put(&quot;mode&quot;, modeString);</span>
                }
            }
        }
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5602)) {</span>
            // Our default. This could be configurable.
<span class="nc" id="L300">            request.setShowIntermediateStops(true);</span>
        }
        // TripRequest will accept a null value and give a user-friendly error
        String otpBaseUrl;
<span class="nc" id="L304">        Application app = Application.get();</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">        if (!TextUtils.isEmpty(app.getCustomOtpApiUrl())) {</span>
<span class="nc" id="L306">            otpBaseUrl = app.getCustomOtpApiUrl();</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5603)) {</span>
<span class="nc" id="L308">                Log.d(TAG, &quot;Using custom OTP API URL set by user '&quot; + otpBaseUrl + &quot;'.&quot;);</span>
            }
        } else {
<span class="nc" id="L311">            otpBaseUrl = app.getCurrentRegion().getOtpBaseUrl();</span>
        }
        try {
            // URI.parse() doesn't tell us if the scheme is missing, so use URL() instead (#126)
<span class="nc" id="L315">            URL url = new URL(otpBaseUrl);</span>
<span class="nc" id="L316">        } catch (MalformedURLException e) {</span>
            // Assume HTTPS scheme, since without a scheme the Uri won't parse the authority
<span class="nc" id="L318">            otpBaseUrl = activity.getString(R.string.https_prefix) + otpBaseUrl;</span>
<span class="nc" id="L319">        }</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">        String fmtOtpBaseUrl = otpBaseUrl != null ? RegionUtils.formatOtpBaseUrl(otpBaseUrl) : null;</span>
        TripRequest tripRequest;
<span class="nc bnc" id="L322" title="All 2 branches missed.">        if (activity == null) {</span>
<span class="nc" id="L323">            tripRequest = new TripRequest(fmtOtpBaseUrl, mListener);</span>
        } else {
<span class="nc" id="L325">            WeakReference&lt;Activity&gt; ref = new WeakReference&lt;Activity&gt;(activity);</span>
<span class="nc" id="L326">            tripRequest = new TripRequest(fmtOtpBaseUrl, mListener);</span>
        }
<span class="nc bnc" id="L328" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5604)) {</span>
<span class="nc" id="L329">            tripRequest.execute(request);</span>
        }
<span class="nc" id="L331">        return tripRequest;</span>
    }

    public void execute() {
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5605)) {</span>
<span class="nc" id="L336">            execute(null);</span>
        }
<span class="nc" id="L338">    }</span>

    private String getAddressString(CustomAddress address) {
<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (address == null) {</span>
<span class="nc" id="L342">            return null;</span>
        }
<span class="nc bnc" id="L344" title="All 10 branches missed.">        if ((ListenerUtil.mutListener.listen(5606) ? (address.hasLatitude() || address.hasLongitude()) : (address.hasLatitude() &amp;&amp; address.hasLongitude()))) {</span>
<span class="nc" id="L345">            double lat = address.getLatitude();</span>
<span class="nc" id="L346">            double lon = address.getLongitude();</span>
<span class="nc" id="L347">            return String.format(OTPConstants.OTP_LOCALE, &quot;%g,%g&quot;, lat, lon);</span>
        }
        // Not set via geocoder OR via location service. Use raw string (set in TripPlanFragment to first line of address).
<span class="nc" id="L350">        String line = address.getAddressLine(0);</span>
        try {
<span class="nc" id="L352">            return URLEncoder.encode(line, ENCODING);</span>
<span class="nc" id="L353">        } catch (UnsupportedEncodingException ex) {</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5607)) {</span>
<span class="nc" id="L355">                Log.e(TAG, &quot;Error encoding address: &quot; + ex);</span>
            }
<span class="nc" id="L357">            return &quot;&quot;;</span>
        }
    }

    public TripRequestBuilder setDateTime(Date d) {
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5608)) {</span>
<span class="nc" id="L363">            mBundle.putLong(DATE_TIME, d.getTime());</span>
        }
<span class="nc" id="L365">        return this;</span>
    }

    public TripRequestBuilder setDateTime(Calendar cal) {
<span class="nc" id="L369">        return setDateTime(cal.getTime());</span>
    }

    public Date getDateTime() {
<span class="nc" id="L373">        Long time = mBundle.getLong(DATE_TIME);</span>
<span class="nc bnc" id="L374" title="All 50 branches missed.">        if ((ListenerUtil.mutListener.listen(5614) ? (time == null &amp;&amp; (ListenerUtil.mutListener.listen(5613) ? (time &gt;= 0L) : (ListenerUtil.mutListener.listen(5612) ? (time &lt;= 0L) : (ListenerUtil.mutListener.listen(5611) ? (time &gt; 0L) : (ListenerUtil.mutListener.listen(5610) ? (time &lt; 0L) : (ListenerUtil.mutListener.listen(5609) ? (time != 0L) : (time == 0L))))))) : (time == null || (ListenerUtil.mutListener.listen(5613) ? (time &gt;= 0L) : (ListenerUtil.mutListener.listen(5612) ? (time &lt;= 0L) : (ListenerUtil.mutListener.listen(5611) ? (time &gt; 0L) : (ListenerUtil.mutListener.listen(5610) ? (time &lt; 0L) : (ListenerUtil.mutListener.listen(5609) ? (time != 0L) : (time == 0L))))))))) {</span>
<span class="nc" id="L375">            return null;</span>
        } else {
<span class="nc" id="L377">            return new Date(time);</span>
        }
    }

    public Bundle getBundle() {
<span class="nc" id="L382">        return mBundle;</span>
    }

    /**
     * Copy all the data from this builder's bundle into another bundle
     * @param target bundle
     */
    public void copyIntoBundle(Bundle target) {
<span class="nc bnc" id="L390" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5615)) {</span>
<span class="nc" id="L391">            target.putBoolean(ARRIVE_BY, getArriveBy());</span>
        }
<span class="nc bnc" id="L393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5616)) {</span>
<span class="nc" id="L394">            target.putParcelable(FROM_ADDRESS, getFrom());</span>
        }
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5617)) {</span>
<span class="nc" id="L397">            target.putParcelable(TO_ADDRESS, getTo());</span>
        }
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5618)) {</span>
<span class="nc" id="L400">            target.putSerializable(OPTIMIZE_TRANSFERS, getOptimizeType());</span>
        }
<span class="nc bnc" id="L402" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5619)) {</span>
<span class="nc" id="L403">            target.putBoolean(WHEELCHAIR_ACCESSIBLE, getWheelchairAccessible());</span>
        }
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5621)) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            if (getMaxWalkDistance() != null) {</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5620)) {</span>
<span class="nc" id="L408">                    target.putDouble(MAX_WALK_DISTANCE, getMaxWalkDistance());</span>
                }
            }
        }
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5622)) {</span>
<span class="nc" id="L413">            target.putString(MODE_SET, getModeString());</span>
        }
<span class="nc bnc" id="L415" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5624)) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">            if (getDateTime() != null) {</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5623)) {</span>
<span class="nc" id="L418">                    target.putLong(DATE_TIME, getDateTime().getTime());</span>
                }
            }
        }
<span class="nc" id="L422">    }</span>

    /**
     * Copy all the data from this builder's bundle into another bundle, but only use simple data types
     * @param target bundle
     */
    public void copyIntoBundleSimple(Bundle target) {
<span class="nc bnc" id="L429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5625)) {</span>
<span class="nc" id="L430">            target.putBoolean(ARRIVE_BY, getArriveBy());</span>
        }
<span class="nc" id="L432">        CustomAddress from = getFrom(), to = getTo();</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5626)) {</span>
<span class="nc" id="L434">            target.putDouble(FROM_LAT, from.getLatitude());</span>
        }
<span class="nc bnc" id="L436" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5627)) {</span>
<span class="nc" id="L437">            target.putDouble(FROM_LON, from.getLongitude());</span>
        }
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5628)) {</span>
<span class="nc" id="L440">            target.putString(FROM_NAME, from.toString());</span>
        }
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5629)) {</span>
<span class="nc" id="L443">            target.putDouble(TO_LAT, to.getLatitude());</span>
        }
<span class="nc bnc" id="L445" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5630)) {</span>
<span class="nc" id="L446">            target.putDouble(TO_LON, to.getLongitude());</span>
        }
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5631)) {</span>
<span class="nc" id="L449">            target.putString(TO_NAME, to.toString());</span>
        }
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5632)) {</span>
<span class="nc" id="L452">            target.putString(OPTIMIZE_TRANSFERS, getOptimizeType().toString());</span>
        }
<span class="nc bnc" id="L454" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5633)) {</span>
<span class="nc" id="L455">            target.putBoolean(WHEELCHAIR_ACCESSIBLE, getWheelchairAccessible());</span>
        }
<span class="nc bnc" id="L457" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5635)) {</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">            if (getMaxWalkDistance() != null) {</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5634)) {</span>
<span class="nc" id="L460">                    target.putDouble(MAX_WALK_DISTANCE, getMaxWalkDistance());</span>
                }
            }
        }
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5636)) {</span>
<span class="nc" id="L465">            target.putString(MODE_SET, getModeString());</span>
        }
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5638)) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (getDateTime() != null) {</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5637)) {</span>
<span class="nc" id="L470">                    target.putLong(DATE_TIME, getDateTime().getTime());</span>
                }
            }
        }
<span class="nc" id="L474">    }</span>

    /**
     * Initialize from a BaseBundle
     */
    public static TripRequestBuilder initFromBundleSimple(Bundle bundle) {
<span class="nc" id="L480">        Bundle target = new Bundle();</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5639)) {</span>
<span class="nc" id="L482">            target.putBoolean(ARRIVE_BY, bundle.getBoolean(ARRIVE_BY));</span>
        }
<span class="nc" id="L484">        CustomAddress from = new CustomAddress();</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5640)) {</span>
<span class="nc" id="L486">            from.setLatitude(bundle.getDouble(FROM_LAT));</span>
        }
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5641)) {</span>
<span class="nc" id="L489">            from.setLongitude(bundle.getDouble(FROM_LON));</span>
        }
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5642)) {</span>
<span class="nc" id="L492">            from.setAddressLine(0, bundle.getString(FROM_NAME));</span>
        }
<span class="nc" id="L494">        CustomAddress to = new CustomAddress();</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5643)) {</span>
<span class="nc" id="L496">            to.setLatitude(bundle.getDouble(TO_LAT));</span>
        }
<span class="nc bnc" id="L498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5644)) {</span>
<span class="nc" id="L499">            to.setLongitude(bundle.getDouble(TO_LON));</span>
        }
<span class="nc bnc" id="L501" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5645)) {</span>
<span class="nc" id="L502">            to.setAddressLine(0, bundle.getString(TO_NAME));</span>
        }
<span class="nc bnc" id="L504" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5646)) {</span>
<span class="nc" id="L505">            target.putParcelable(FROM_ADDRESS, from);</span>
        }
<span class="nc bnc" id="L507" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5647)) {</span>
<span class="nc" id="L508">            target.putParcelable(TO_ADDRESS, to);</span>
        }
<span class="nc" id="L510">        String optName = bundle.getString(OPTIMIZE_TRANSFERS);</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5649)) {</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">            if (optName != null) {</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5648)) {</span>
<span class="nc" id="L514">                    target.putSerializable(OPTIMIZE_TRANSFERS, OptimizeType.valueOf(optName));</span>
                }
            }
        }
<span class="nc bnc" id="L518" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5650)) {</span>
<span class="nc" id="L519">            target.putBoolean(WHEELCHAIR_ACCESSIBLE, bundle.getBoolean(WHEELCHAIR_ACCESSIBLE));</span>
        }
<span class="nc bnc" id="L521" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5651)) {</span>
<span class="nc" id="L522">            target.putDouble(MAX_WALK_DISTANCE, bundle.getDouble(MAX_WALK_DISTANCE));</span>
        }
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5652)) {</span>
<span class="nc" id="L525">            target.putString(MODE_SET, bundle.getString(MODE_SET));</span>
        }
<span class="nc bnc" id="L527" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5653)) {</span>
<span class="nc" id="L528">            target.putLong(DATE_TIME, bundle.getLong(DATE_TIME));</span>
        }
<span class="nc" id="L530">        return new TripRequestBuilder(target);</span>
    }

    /**
     * Determine whether this trip request can be submitted to an OTP server.
     * @return true if ready to submit, false otherwise
     */
    public boolean ready() {
<span class="nc bnc" id="L538" title="All 122 branches missed.">        return (ListenerUtil.mutListener.listen(5657) ? ((ListenerUtil.mutListener.listen(5656) ? ((ListenerUtil.mutListener.listen(5655) ? ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) || getTo() != null) : ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) &amp;&amp; getTo() != null)) || getTo().isSet()) : ((ListenerUtil.mutListener.listen(5655) ? ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) || getTo() != null) : ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) &amp;&amp; getTo() != null)) &amp;&amp; getTo().isSet())) || getDateTime() != null) : ((ListenerUtil.mutListener.listen(5656) ? ((ListenerUtil.mutListener.listen(5655) ? ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) || getTo() != null) : ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) &amp;&amp; getTo() != null)) || getTo().isSet()) : ((ListenerUtil.mutListener.listen(5655) ? ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) || getTo() != null) : ((ListenerUtil.mutListener.listen(5654) ? (getFrom() != null || getFrom().isSet()) : (getFrom() != null &amp;&amp; getFrom().isSet())) &amp;&amp; getTo() != null)) &amp;&amp; getTo().isSet())) &amp;&amp; getDateTime() != null));</span>
    }

    private static String getFormattedDate(String format, Date date) {
<span class="nc" id="L542">        return new SimpleDateFormat(format, OTPConstants.OTP_LOCALE).format(date);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>