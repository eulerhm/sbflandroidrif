<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RealtimeIndicatorView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.view</a> &gt; <span class="el_source">RealtimeIndicatorView.java</span></div><h1>RealtimeIndicatorView.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 University of South Florida (sjbarbeau@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.view;

import org.onebusaway.android.R;
import android.annotation.TargetApi;
import android.content.Context;
import android.content.res.TypedArray;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.os.Build;
import android.util.AttributeSet;
import android.view.View;
import android.view.ViewTreeObserver;
import android.view.animation.Animation;
import android.view.animation.Transformation;
import androidx.interpolator.view.animation.FastOutLinearInInterpolator;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * View that animates a circle expanding and contracting to indicate real-time information
 */
public class RealtimeIndicatorView extends View {

    private Paint mFillPaint;

    private Paint mLinePaint;

    private Animation mAnimation1;

    private float mNewRadius;

    /**
     * Percentage of total view size that the circle should be drawn
     */
    private static final float SCALE = 0.45f;

    /**
     * Default fill color
     */
<span class="nc" id="L54">    public int mFillColor = 0xbbFFFFFF;</span>

    /**
     * Default line color
     */
<span class="nc" id="L59">    public int mLineColor = 0xFFFFFFFF;</span>

    // ms
<span class="nc" id="L62">    private int mDuration = 1000;</span>

    /**
     * Set to true after the animation has been initialized
     */
<span class="nc" id="L67">    private boolean mInitComplete = false;</span>

    public RealtimeIndicatorView(Context context, AttributeSet attrs) {
<span class="nc" id="L70">        super(context, attrs);</span>
        // Get the custom attributes defined in XML
<span class="nc" id="L72">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.RealtimeIndicatorView, 0, 0);</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10509)) {</span>
<span class="nc" id="L74">            mFillColor = a.getColor(R.styleable.RealtimeIndicatorView_fillColor, mFillColor);</span>
        }
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10510)) {</span>
<span class="nc" id="L77">            mLineColor = a.getColor(R.styleable.RealtimeIndicatorView_lineColor, mLineColor);</span>
        }
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10511)) {</span>
<span class="nc" id="L80">            mDuration = a.getInteger(R.styleable.RealtimeIndicatorView_duration, mDuration);</span>
        }
<span class="nc bnc" id="L82" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10512)) {</span>
<span class="nc" id="L83">            a.recycle();</span>
        }
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10513)) {</span>
<span class="nc" id="L86">            mFillPaint = new Paint();</span>
        }
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10514)) {</span>
<span class="nc" id="L89">            mFillPaint.setColor(mFillColor);</span>
        }
<span class="nc bnc" id="L91" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10515)) {</span>
<span class="nc" id="L92">            mFillPaint.setStyle(Paint.Style.FILL);</span>
        }
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10516)) {</span>
<span class="nc" id="L95">            mFillPaint.setAntiAlias(true);</span>
        }
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10517)) {</span>
<span class="nc" id="L98">            mLinePaint = new Paint();</span>
        }
<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10518)) {</span>
<span class="nc" id="L101">            mLinePaint.setStrokeWidth(3);</span>
        }
<span class="nc bnc" id="L103" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10519)) {</span>
<span class="nc" id="L104">            mLinePaint.setColor(mLineColor);</span>
        }
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10520)) {</span>
<span class="nc" id="L107">            mLinePaint.setStyle(Paint.Style.STROKE);</span>
        }
<span class="nc bnc" id="L109" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10521)) {</span>
<span class="nc" id="L110">            mLinePaint.setAntiAlias(true);</span>
        }
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10522)) {</span>
<span class="nc" id="L113">            setOnMeasureCallback();</span>
        }
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10523)) {</span>
<span class="nc" id="L116">            ensureInit();</span>
        }
<span class="nc" id="L118">    }</span>

    private void setOnMeasureCallback() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10526)) {</span>
<span class="nc" id="L122">            getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {</span>

                @Override
                public void onGlobalLayout() {
<span class="nc bnc" id="L126" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10524)) {</span>
<span class="nc" id="L127">                        removeOnGlobalLayoutListener(this);</span>
                    }
<span class="nc bnc" id="L129" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10525)) {</span>
<span class="nc" id="L130">                        initAnimation();</span>
                    }
<span class="nc" id="L132">                }</span>
            });
        }
<span class="nc" id="L135">    }</span>

    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
    private void removeOnGlobalLayoutListener(ViewTreeObserver.OnGlobalLayoutListener listener) {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10534)) {</span>
<span class="nc bnc" id="L140" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10531) ? (Build.VERSION.SDK_INT &gt;= 16) : (ListenerUtil.mutListener.listen(10530) ? (Build.VERSION.SDK_INT &lt;= 16) : (ListenerUtil.mutListener.listen(10529) ? (Build.VERSION.SDK_INT &gt; 16) : (ListenerUtil.mutListener.listen(10528) ? (Build.VERSION.SDK_INT != 16) : (ListenerUtil.mutListener.listen(10527) ? (Build.VERSION.SDK_INT == 16) : (Build.VERSION.SDK_INT &lt; 16))))))) {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10533)) {</span>
<span class="nc" id="L142">                    getViewTreeObserver().removeGlobalOnLayoutListener(listener);</span>
                }
            } else {
<span class="nc bnc" id="L145" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10532)) {</span>
<span class="nc" id="L146">                    getViewTreeObserver().removeOnGlobalLayoutListener(listener);</span>
                }
            }
        }
<span class="nc" id="L150">    }</span>

    /**
     * Makes sure the animation has been initialized.  This is a workaround to make sure
     * the animation is shown when this view is used within a list with an adapter.
     */
    private synchronized void ensureInit() {
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10535)) {</span>
<span class="nc" id="L158">            initAnimation();</span>
        }
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10538)) {</span>
<span class="nc" id="L161">            this.postDelayed(new Runnable() {</span>

                @Override
                public void run() {
<span class="nc bnc" id="L165" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10537)) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">                        if (!mInitComplete) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10536)) {</span>
<span class="nc" id="L168">                                initAnimation();</span>
                            }
                        }
                    }
<span class="nc" id="L172">                }</span>
            }, 500);
        }
<span class="nc" id="L175">    }</span>

    /**
     * Setup the animation
     */
    private synchronized void initAnimation() {
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10545)) {</span>
            // Animate circle expand/contract
<span class="nc" id="L183">            mAnimation1 = new Animation() {</span>

                @Override
                protected void applyTransformation(float interpolatedTime, Transformation t) {
<span class="nc" id="L187">                    int height = getHeight();</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10543)) {</span>
<span class="nc bnc" id="L189" title="All 8 branches missed.">                        mNewRadius = (ListenerUtil.mutListener.listen(10542) ? (height % interpolatedTime) : (ListenerUtil.mutListener.listen(10541) ? (height / interpolatedTime) : (ListenerUtil.mutListener.listen(10540) ? (height - interpolatedTime) : (ListenerUtil.mutListener.listen(10539) ? (height + interpolatedTime) : (height * interpolatedTime)))));</span>
                    }
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10544)) {</span>
<span class="nc" id="L192">                        invalidate();</span>
                    }
<span class="nc" id="L194">                }</span>
            };
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10546)) {</span>
<span class="nc" id="L198">            mAnimation1.setDuration(mDuration);</span>
        }
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10547)) {</span>
<span class="nc" id="L201">            mAnimation1.setRepeatMode(Animation.REVERSE);</span>
        }
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10548)) {</span>
<span class="nc" id="L204">            mAnimation1.setInterpolator(new FastOutLinearInInterpolator());</span>
        }
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10549)) {</span>
<span class="nc" id="L207">            mAnimation1.setRepeatCount(Animation.INFINITE);</span>
        }
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10550)) {</span>
<span class="nc" id="L210">            startAnimation(mAnimation1);</span>
        }
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10551)) {</span>
<span class="nc" id="L213">            mInitComplete = true;</span>
        }
<span class="nc" id="L215">    }</span>

    @Override
    protected void onDraw(Canvas canvas) {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10552)) {</span>
<span class="nc" id="L220">            super.onDraw(canvas);</span>
        }
<span class="nc" id="L222">        int height = getHeight();</span>
<span class="nc" id="L223">        int width = getWidth();</span>
<span class="nc bnc" id="L224" title="All 8 branches missed.">        float x = (ListenerUtil.mutListener.listen(10556) ? (width % 2.0f) : (ListenerUtil.mutListener.listen(10555) ? (width * 2.0f) : (ListenerUtil.mutListener.listen(10554) ? (width - 2.0f) : (ListenerUtil.mutListener.listen(10553) ? (width + 2.0f) : (width / 2.0f)))));</span>
<span class="nc bnc" id="L225" title="All 8 branches missed.">        float y = (ListenerUtil.mutListener.listen(10560) ? (height % 2.0f) : (ListenerUtil.mutListener.listen(10559) ? (height * 2.0f) : (ListenerUtil.mutListener.listen(10558) ? (height - 2.0f) : (ListenerUtil.mutListener.listen(10557) ? (height + 2.0f) : (height / 2.0f)))));</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10565)) {</span>
<span class="nc bnc" id="L227" title="All 8 branches missed.">            canvas.drawCircle(x, y, (ListenerUtil.mutListener.listen(10564) ? (mNewRadius % SCALE) : (ListenerUtil.mutListener.listen(10563) ? (mNewRadius / SCALE) : (ListenerUtil.mutListener.listen(10562) ? (mNewRadius - SCALE) : (ListenerUtil.mutListener.listen(10561) ? (mNewRadius + SCALE) : (mNewRadius * SCALE))))), mFillPaint);</span>
        }
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10570)) {</span>
<span class="nc bnc" id="L230" title="All 8 branches missed.">            canvas.drawCircle(x, y, (ListenerUtil.mutListener.listen(10569) ? (mNewRadius % SCALE) : (ListenerUtil.mutListener.listen(10568) ? (mNewRadius / SCALE) : (ListenerUtil.mutListener.listen(10567) ? (mNewRadius - SCALE) : (ListenerUtil.mutListener.listen(10566) ? (mNewRadius + SCALE) : (mNewRadius * SCALE))))), mLinePaint);</span>
        }
<span class="nc" id="L232">    }</span>

    /**
     * Set the fill color to be used when drawing the expanding/contracting circle, in the format
     * 0xbbFFFFFF.
     *
     * @param color the fill color to be used when drawing the expanding/contracting circle, in the
     *              format
     *              0xbbFFFFFF.
     */
    public void setFillColor(int color) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10571)) {</span>
<span class="nc" id="L244">            mFillColor = color;</span>
        }
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10572)) {</span>
<span class="nc" id="L247">            mFillPaint.setColor(color);</span>
        }
<span class="nc" id="L249">    }</span>

    /**
     * Set the line (i.e., stroke) color to be used when drawing the expanding/contracting circle,
     * in the format
     * 0xbbFFFFFF.
     *
     * @param color the line (i.e., stroke) to be used when drawing the expanding/contracting
     *              circle, in the format
     *              0xbbFFFFFF.
     */
    public void setLineColor(int color) {
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10573)) {</span>
<span class="nc" id="L262">            mLineColor = color;</span>
        }
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10574)) {</span>
<span class="nc" id="L265">            mLinePaint.setColor(color);</span>
        }
<span class="nc" id="L267">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>