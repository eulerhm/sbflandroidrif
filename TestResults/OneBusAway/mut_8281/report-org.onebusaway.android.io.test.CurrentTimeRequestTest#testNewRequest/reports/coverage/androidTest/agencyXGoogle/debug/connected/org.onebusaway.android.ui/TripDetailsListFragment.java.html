<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TripDetailsListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">TripDetailsListFragment.java</span></div><h1>TripDetailsListFragment.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012-2015 Paul Watts (paulcwatts@gmail.com), University of South Florida,
 * Benjamin Du (bendu@me.com), and individual contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.Dialog;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.IntentSender;
import android.content.SharedPreferences;
import android.content.res.ColorStateList;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.PorterDuff;
import android.graphics.drawable.Drawable;
import android.graphics.drawable.GradientDrawable;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.provider.Settings;
import android.text.TextUtils;
import android.text.format.DateUtils;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.BaseAdapter;
import android.widget.CheckBox;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.core.graphics.drawable.DrawableCompat;
import androidx.loader.app.LoaderManager;
import androidx.loader.content.AsyncTaskLoader;
import androidx.loader.content.Loader;
import com.google.android.gms.common.api.ApiException;
import com.google.android.gms.common.api.ResolvableApiException;
import com.google.android.gms.location.LocationRequest;
import com.google.android.gms.location.LocationServices;
import com.google.android.gms.location.LocationSettingsRequest;
import com.google.android.gms.location.LocationSettingsResponse;
import com.google.android.gms.location.LocationSettingsStatusCodes;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.analytics.FirebaseAnalytics;
import org.apache.commons.lang3.StringUtils;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.io.ObaApi;
import org.onebusaway.android.io.elements.ObaReferences;
import org.onebusaway.android.io.elements.ObaRoute;
import org.onebusaway.android.io.elements.ObaStop;
import org.onebusaway.android.io.elements.ObaTrip;
import org.onebusaway.android.io.elements.ObaTripSchedule;
import org.onebusaway.android.io.elements.ObaTripStatus;
import org.onebusaway.android.io.elements.OccupancyState;
import org.onebusaway.android.io.elements.Status;
import org.onebusaway.android.io.request.ObaTripDetailsRequest;
import org.onebusaway.android.io.request.ObaTripDetailsResponse;
import org.onebusaway.android.nav.NavigationService;
import org.onebusaway.android.travelbehavior.TravelBehaviorManager;
import org.onebusaway.android.util.ArrivalInfoUtils;
import org.onebusaway.android.util.DBUtil;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.PreferenceUtils;
import org.onebusaway.android.util.UIUtils;
import java.util.Calendar;
import java.util.GregorianCalendar;
import java.util.concurrent.TimeUnit;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L96">public class TripDetailsListFragment extends ListFragment {</span>

    public static final String TAG = &quot;TripDetailsListFragment&quot;;

    public static final String TRIP_ID = &quot;.TripId&quot;;

    public static final String STOP_ID = &quot;.StopId&quot;;

    public static final String ROUTE_ID = &quot;.RouteId&quot;;

    public static final String SCROLL_MODE = &quot;.ScrollMode&quot;;

    public static final String SCROLL_MODE_VEHICLE = &quot;vehicle&quot;;

    public static final String SCROLL_MODE_STOP = &quot;stop&quot;;

    public static final String TRIP_ACTIVE = &quot;.TripActive&quot;;

    public static final String DEST_ID = &quot;.DestinationId&quot;;

    public static final String ACTION_SERVICE_DESTROYED = &quot;NavigationServiceDestroyed&quot;;

    private static final long REFRESH_PERIOD = 60 * 1000;

    private static final int TRIP_DETAILS_LOADER = 0;

    public static final int REQUEST_ENABLE_LOCATION = 1;

    private String mTripId;

    private String mRouteId;

    private String mStopId;

    private String mScrollMode;

    private String mDestinationId;

    private Integer mStopIndex;

    private Integer mDestinationIndex;

    private boolean mActiveTrip;

    private ObaTripDetailsResponse mTripInfo;

    private TripDetailsAdapter mAdapter;

<span class="nc" id="L144">    private final TripDetailsLoaderCallback mTripDetailsCallback = new TripDetailsLoaderCallback();</span>

    private LocationRequest mLocationRequest;

    private Task&lt;LocationSettingsResponse&gt; mResult;

    private FirebaseAnalytics mFirebaseAnalytics;

    /**
     * Builds an intent used to set the trip and stop for the TripDetailsListFragment directly
     * (i.e., when TripDetailsActivity is not used)
     */
    public static class IntentBuilder {

        private Intent mIntent;

<span class="nc" id="L160">        public IntentBuilder(Context context, String tripId) {</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3222)) {</span>
<span class="nc" id="L162">                mIntent = new Intent(context, TripDetailsListFragment.class);</span>
            }
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3223)) {</span>
<span class="nc" id="L165">                mIntent.putExtra(TripDetailsListFragment.TRIP_ID, tripId);</span>
            }
<span class="nc" id="L167">        }</span>

        public IntentBuilder setStopId(String stopId) {
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3224)) {</span>
<span class="nc" id="L171">                mIntent.putExtra(TripDetailsListFragment.STOP_ID, stopId);</span>
            }
<span class="nc" id="L173">            return this;</span>
        }

        public Intent build() {
<span class="nc" id="L177">            return mIntent;</span>
        }
    }

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3225)) {</span>
<span class="nc" id="L184">            super.onActivityCreated(savedInstanceState);</span>
        }
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3226)) {</span>
            // Start out with a progress indicator.
<span class="nc" id="L188">            setListShown(false);</span>
        }
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3227)) {</span>
            // We have a menu item to show in action bar.
<span class="nc" id="L192">            setHasOptionsMenu(true);</span>
        }
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3228)) {</span>
<span class="nc" id="L195">            getListView().setOnItemClickListener(mClickListener);</span>
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3229)) {</span>
<span class="nc" id="L198">            getListView().setOnItemLongClickListener(mLongClickListener);</span>
        }
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3231)) {</span>
            // Get saved routeId if it exists - avoids potential NPE in onOptionsItemSelected() (#515)
<span class="nc bnc" id="L202" title="All 2 branches missed.">            if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3230)) {</span>
<span class="nc" id="L204">                    mRouteId = savedInstanceState.getString(ROUTE_ID);</span>
                }
            }
        }
<span class="nc" id="L208">        Bundle args = getArguments();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3232)) {</span>
<span class="nc" id="L210">            mTripId = args.getString(TRIP_ID);</span>
        }
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3234)) {</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">            if (mTripId == null) {</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3233)) {</span>
<span class="nc" id="L215">                    Log.e(TAG, &quot;TripId is null&quot;);</span>
                }
<span class="nc" id="L217">                throw new RuntimeException(&quot;TripId should not be null&quot;);</span>
            }
        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3235)) {</span>
<span class="nc" id="L221">            mStopId = args.getString(STOP_ID);</span>
        }
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3236)) {</span>
<span class="nc" id="L224">            mScrollMode = args.getString(SCROLL_MODE);</span>
        }
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3237)) {</span>
<span class="nc" id="L227">            mActiveTrip = args.getBoolean(TRIP_ACTIVE);</span>
        }
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3238)) {</span>
<span class="nc" id="L230">            mDestinationId = args.getString(DEST_ID);</span>
        }
<span class="nc bnc" id="L232" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3239)) {</span>
<span class="nc" id="L233">            getLoaderManager().initLoader(TRIP_DETAILS_LOADER, null, mTripDetailsCallback);</span>
        }
<span class="nc" id="L235">    }</span>

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup root, Bundle savedInstanceState) {
<span class="nc bnc" id="L239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3240)) {</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">            if (root == null) {</span>
                // reason to create our view.
<span class="nc" id="L242">                return null;</span>
            }
        }
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3241)) {</span>
<span class="nc" id="L246">            mFirebaseAnalytics = FirebaseAnalytics.getInstance(getActivity());</span>
        }
<span class="nc" id="L248">        return inflater.inflate(R.layout.trip_details, null);</span>
    }

    @Override
    public void onSaveInstanceState(Bundle outState) {
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3242)) {</span>
<span class="nc" id="L254">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3244)) {</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (mRouteId != null) {</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3243)) {</span>
<span class="nc" id="L259">                    outState.putString(ROUTE_ID, mRouteId);</span>
                }
            }
        }
<span class="nc" id="L263">    }</span>

    @Override
    public void onPause() {
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3245)) {</span>
<span class="nc" id="L268">            mRefreshHandler.removeCallbacks(mRefresh);</span>
        }
<span class="nc bnc" id="L270" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3246)) {</span>
<span class="nc" id="L271">            super.onPause();</span>
        }
<span class="nc" id="L273">    }</span>

    @Override
    public void onResume() {
        // Try to show any old data just in case we're coming out of sleep
<span class="nc" id="L278">        TripDetailsLoader loader = getTripDetailsLoader();</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3249)) {</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">            if (loader != null) {</span>
<span class="nc" id="L281">                ObaTripDetailsResponse lastGood = loader.getLastGoodResponse();</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3248)) {</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">                    if (lastGood != null) {</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3247)) {</span>
<span class="nc" id="L285">                            setTripDetails(lastGood);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3250)) {</span>
<span class="nc" id="L292">            getLoaderManager().restartLoader(TRIP_DETAILS_LOADER, null, mTripDetailsCallback);</span>
        }
        // If our timer would have gone off, then refresh.
<span class="nc" id="L295">        long lastResponseTime = getTripDetailsLoader().getLastResponseTime();</span>
<span class="nc bnc" id="L296" title="All 48 branches missed.">        long newPeriod = Math.min(REFRESH_PERIOD, (ListenerUtil.mutListener.listen(3258) ? (((ListenerUtil.mutListener.listen(3254) ? (lastResponseTime % REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3253) ? (lastResponseTime / REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3252) ? (lastResponseTime * REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3251) ? (lastResponseTime - REFRESH_PERIOD) : (lastResponseTime + REFRESH_PERIOD)))))) % System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(3257) ? (((ListenerUtil.mutListener.listen(3254) ? (lastResponseTime % REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3253) ? (lastResponseTime / REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3252) ? (lastResponseTime * REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3251) ? (lastResponseTime - REFRESH_PERIOD) : (lastResponseTime + REFRESH_PERIOD)))))) / System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(3256) ? (((ListenerUtil.mutListener.listen(3254) ? (lastResponseTime % REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3253) ? (lastResponseTime / REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3252) ? (lastResponseTime * REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3251) ? (lastResponseTime - REFRESH_PERIOD) : (lastResponseTime + REFRESH_PERIOD)))))) * System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(3255) ? (((ListenerUtil.mutListener.listen(3254) ? (lastResponseTime % REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3253) ? (lastResponseTime / REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3252) ? (lastResponseTime * REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3251) ? (lastResponseTime - REFRESH_PERIOD) : (lastResponseTime + REFRESH_PERIOD)))))) + System.currentTimeMillis()) : (((ListenerUtil.mutListener.listen(3254) ? (lastResponseTime % REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3253) ? (lastResponseTime / REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3252) ? (lastResponseTime * REFRESH_PERIOD) : (ListenerUtil.mutListener.listen(3251) ? (lastResponseTime - REFRESH_PERIOD) : (lastResponseTime + REFRESH_PERIOD)))))) - System.currentTimeMillis()))))));</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3266)) {</span>
            // Log.d(TAG, &quot;Refresh period:&quot; + newPeriod);
<span class="nc bnc" id="L299" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(3263) ? (newPeriod &gt;= 0) : (ListenerUtil.mutListener.listen(3262) ? (newPeriod &gt; 0) : (ListenerUtil.mutListener.listen(3261) ? (newPeriod &lt; 0) : (ListenerUtil.mutListener.listen(3260) ? (newPeriod != 0) : (ListenerUtil.mutListener.listen(3259) ? (newPeriod == 0) : (newPeriod &lt;= 0))))))) {</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3265)) {</span>
<span class="nc" id="L301">                    refresh();</span>
                }
            } else {
<span class="nc bnc" id="L304" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3264)) {</span>
<span class="nc" id="L305">                    mRefreshHandler.postDelayed(mRefresh, newPeriod);</span>
                }
            }
        }
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3267)) {</span>
<span class="nc" id="L310">            super.onResume();</span>
        }
<span class="nc" id="L312">    }</span>

    // 
    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3268)) {</span>
<span class="nc" id="L318">            inflater.inflate(R.menu.trip_details, menu);</span>
        }
<span class="nc" id="L320">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L324">        final int id = item.getItemId();</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3271)) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">            if (id == R.id.refresh) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3270)) {</span>
<span class="nc" id="L328">                    refresh();</span>
                }
<span class="nc" id="L330">                return true;</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">            } else if (id == R.id.show_on_map) {</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3269)) {</span>
<span class="nc" id="L333">                    HomeActivity.start(getActivity(), mRouteId);</span>
                }
<span class="nc" id="L335">                return true;</span>
            }
        }
<span class="nc" id="L338">        return false;</span>
    }

    private void setTripDetails(ObaTripDetailsResponse data) {
<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3272)) {</span>
<span class="nc" id="L343">            mTripInfo = data;</span>
        }
<span class="nc" id="L345">        final int code = mTripInfo.getCode();</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3275)) {</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">            if (code == ObaApi.OBA_OK) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3274)) {</span>
<span class="nc" id="L349">                    setEmptyText(&quot;&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L352" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3273)) {</span>
<span class="nc" id="L353">                    setEmptyText(UIUtils.getRouteErrorString(getActivity(), code));</span>
                }
<span class="nc" id="L355">                return;</span>
            }
        }
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3276)) {</span>
<span class="nc" id="L359">            setUpHeader();</span>
        }
<span class="nc" id="L361">        final ListView listView = getListView();</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3301)) {</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (mAdapter == null) {</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3279)) {</span>
                    // first time displaying list
<span class="nc" id="L366">                    mAdapter = new TripDetailsAdapter();</span>
                }
<span class="nc bnc" id="L368" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3280)) {</span>
<span class="nc" id="L369">                    getListView().setDivider(null);</span>
                }
<span class="nc bnc" id="L371" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3281)) {</span>
<span class="nc" id="L372">                    setListAdapter(mAdapter);</span>
                }
<span class="nc bnc" id="L374" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3282)) {</span>
<span class="nc" id="L375">                    setScroller(listView);</span>
                }
<span class="nc bnc" id="L377" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3294)) {</span>
                    // Scroll to stop if we have the stopId available
<span class="nc bnc" id="L379" title="All 2 branches missed.">                    if (mStopId != null) {</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3290)) {</span>
<span class="nc" id="L381">                            mStopIndex = findIndexForStop(mTripInfo.getSchedule().getStopTimes(), mStopId);</span>
                        }
<span class="nc bnc" id="L383" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3293)) {</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                            if (mStopIndex != null) {</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3292)) {</span>
<span class="nc" id="L386">                                    listView.post(new Runnable() {</span>

                                        @Override
                                        public void run() {
<span class="nc bnc" id="L390" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3291)) {</span>
<span class="nc" id="L391">                                                listView.setSelection(mStopIndex);</span>
                                            }
<span class="nc" id="L393">                                        }</span>
                                    });
                                }
                            }
                        }
                    } else {
                        // If we don't have a stop, then scroll to the current position of the bus
<span class="nc" id="L400">                        final Integer nextStop = mAdapter.getNextStopIndex();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3289)) {</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">                            if (nextStop != null) {</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3288)) {</span>
<span class="nc" id="L404">                                    listView.post(new Runnable() {</span>

                                        @Override
                                        public void run() {
<span class="nc bnc" id="L408" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3287)) {</span>
<span class="nc bnc" id="L409" title="All 8 branches missed.">                                                listView.setSelection((ListenerUtil.mutListener.listen(3286) ? (nextStop % 1) : (ListenerUtil.mutListener.listen(3285) ? (nextStop / 1) : (ListenerUtil.mutListener.listen(3284) ? (nextStop * 1) : (ListenerUtil.mutListener.listen(3283) ? (nextStop + 1) : (nextStop - 1))))));</span>
                                            }
<span class="nc" id="L411">                                        }</span>
                                    });
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L418" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3299)) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                    if (mDestinationId != null) {</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3295)) {</span>
<span class="nc" id="L421">                            mDestinationIndex = findIndexForStop(mTripInfo.getSchedule().getStopTimes(), mDestinationId);</span>
                        }
<span class="nc bnc" id="L423" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3298)) {</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">                            if (mDestinationIndex != null) {</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3297)) {</span>
<span class="nc" id="L426">                                    listView.post(new Runnable() {</span>

                                        @Override
                                        public void run() {
<span class="nc bnc" id="L430" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3296)) {</span>
<span class="nc" id="L431">                                                listView.setSelection(mDestinationIndex);</span>
                                            }
<span class="nc" id="L433">                                        }</span>
                                    });
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L440" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3300)) {</span>
<span class="nc" id="L441">                    mAdapter.notifyDataSetChanged();</span>
                }
            } else {
                // refresh, keep scroll position
<span class="nc" id="L445">                int index = listView.getFirstVisiblePosition();</span>
<span class="nc" id="L446">                View v = listView.getChildAt(0);</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">                int top = (v == null) ? 0 : v.getTop();</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3277)) {</span>
<span class="nc" id="L449">                    mAdapter.notifyDataSetChanged();</span>
                }
<span class="nc bnc" id="L451" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3278)) {</span>
<span class="nc" id="L452">                    listView.setSelectionFromTop(index, top);</span>
                }
            }
        }
<span class="nc" id="L456">    }</span>

    private void setUpHeader() {
<span class="nc" id="L459">        ObaTripStatus status = mTripInfo.getStatus();</span>
<span class="nc" id="L460">        ObaReferences refs = mTripInfo.getRefs();</span>
<span class="nc" id="L461">        Context context = getActivity();</span>
<span class="nc" id="L462">        String tripId = mTripInfo.getId();</span>
<span class="nc" id="L463">        ObaTrip trip = refs.getTrip(tripId);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3302)) {</span>
<span class="nc" id="L465">            mRouteId = trip.getRouteId();</span>
        }
<span class="nc" id="L467">        ObaRoute route = refs.getRoute(mRouteId);</span>
<span class="nc" id="L468">        TextView routeShortName = (TextView) getView().findViewById(R.id.short_name);</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3303)) {</span>
<span class="nc" id="L470">            routeShortName.setText(route.getShortName());</span>
        }
<span class="nc" id="L472">        TextView headsign = (TextView) getView().findViewById(R.id.long_name);</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3304)) {</span>
<span class="nc" id="L474">            headsign.setText(trip.getHeadsign());</span>
        }
<span class="nc" id="L476">        TextView tripShortName = (TextView) getView().findViewById(R.id.trip_short_name);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3308)) {</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (!StringUtils.isBlank(trip.getShortName())) {</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3306)) {</span>
<span class="nc" id="L480">                    tripShortName.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L482" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3307)) {</span>
<span class="nc" id="L483">                    tripShortName.setText(trip.getShortName());</span>
                }
            } else {
<span class="nc bnc" id="L486" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3305)) {</span>
<span class="nc" id="L487">                    tripShortName.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc" id="L491">        TextView agency = (TextView) getView().findViewById(R.id.agency);</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3309)) {</span>
<span class="nc" id="L493">            agency.setText(refs.getAgency(route.getAgencyId()).getName());</span>
        }
<span class="nc" id="L495">        TextView vehicleView = (TextView) getView().findViewById(R.id.vehicle);</span>
<span class="nc" id="L496">        TextView vehicleDeviation = (TextView) getView().findViewById(R.id.status);</span>
<span class="nc" id="L497">        ViewGroup realtime = (ViewGroup) getView().findViewById(R.id.eta_realtime_indicator);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3310)) {</span>
<span class="nc" id="L499">            realtime.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L501">        ViewGroup statusLayout = (ViewGroup) getView().findViewById(R.id.status_layout);</span>
<span class="nc" id="L502">        ViewGroup occupancyView = getView().findViewById(R.id.occupancy);</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3314)) {</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">            if (status == null) {</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3311)) {</span>
                    // Show schedule info only
<span class="nc" id="L507">                    vehicleView.setText(null);</span>
                }
<span class="nc bnc" id="L509" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3312)) {</span>
<span class="nc" id="L510">                    vehicleView.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L512" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3313)) {</span>
<span class="nc" id="L513">                    vehicleDeviation.setText(context.getString(R.string.trip_details_scheduled_data));</span>
                }
<span class="nc" id="L515">                return;</span>
            }
        }
<span class="nc bnc" id="L518" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3318)) {</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">            if (!TextUtils.isEmpty(status.getVehicleId())) {</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3316)) {</span>
                    // Show vehicle info
<span class="nc" id="L522">                    vehicleView.setText(context.getString(R.string.trip_details_vehicle, status.getVehicleId()));</span>
                }
<span class="nc bnc" id="L524" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3317)) {</span>
<span class="nc" id="L525">                    vehicleView.setVisibility(View.VISIBLE);</span>
                }
            } else {
<span class="nc bnc" id="L528" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3315)) {</span>
<span class="nc" id="L529">                    vehicleView.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3319)) {</span>
            // Set status color in header
<span class="nc" id="L535">            statusLayout.setBackgroundResource(R.drawable.round_corners_style_b_header_status);</span>
        }
<span class="nc" id="L537">        GradientDrawable d = (GradientDrawable) statusLayout.getBackground();</span>
        int statusColor;
<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (!status.isPredicted()) {</span>
            // We have only schedule info, but the bus position can still be interpolated
<span class="nc" id="L541">            statusColor = R.color.stop_info_scheduled_time;</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3320)) {</span>
<span class="nc" id="L543">                d.setColor(getResources().getColor(statusColor));</span>
            }
<span class="nc bnc" id="L545" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3323)) {</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">                if (Status.CANCELED.equals(status.getStatus())) {</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3322)) {</span>
                        // Canceled trip
<span class="nc" id="L549">                        vehicleDeviation.setText(context.getString(R.string.stop_info_canceled));</span>
                    }
                } else {
<span class="nc bnc" id="L552" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3321)) {</span>
                        // Scheduled trip
<span class="nc" id="L554">                        vehicleDeviation.setText(context.getString(R.string.trip_details_scheduled_data));</span>
                    }
                }
            }
<span class="nc" id="L558">            return;</span>
        }
<span class="nc bnc" id="L560" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3324)) {</span>
            /**
             * We have real-time info
             */
<span class="nc" id="L564">            realtime.setVisibility(View.VISIBLE);</span>
        }
<span class="nc" id="L566">        long deviation = status.getScheduleDeviation();</span>
<span class="nc" id="L567">        long deviationMin = TimeUnit.SECONDS.toMinutes(status.getScheduleDeviation());</span>
<span class="nc bnc" id="L568" title="All 8 branches missed.">        long minutes = (ListenerUtil.mutListener.listen(3328) ? (Math.abs(deviation) % 60) : (ListenerUtil.mutListener.listen(3327) ? (Math.abs(deviation) * 60) : (ListenerUtil.mutListener.listen(3326) ? (Math.abs(deviation) - 60) : (ListenerUtil.mutListener.listen(3325) ? (Math.abs(deviation) + 60) : (Math.abs(deviation) / 60)))));</span>
<span class="nc bnc" id="L569" title="All 8 branches missed.">        long seconds = (ListenerUtil.mutListener.listen(3332) ? (Math.abs(deviation) / 60) : (ListenerUtil.mutListener.listen(3331) ? (Math.abs(deviation) * 60) : (ListenerUtil.mutListener.listen(3330) ? (Math.abs(deviation) - 60) : (ListenerUtil.mutListener.listen(3329) ? (Math.abs(deviation) + 60) : (Math.abs(deviation) % 60)))));</span>
<span class="nc" id="L570">        String lastUpdate = DateUtils.formatDateTime(getActivity(), status.getLastUpdateTime(), DateUtils.FORMAT_SHOW_TIME | DateUtils.FORMAT_NO_NOON | DateUtils.FORMAT_NO_MIDNIGHT);</span>
<span class="nc" id="L571">        statusColor = ArrivalInfoUtils.computeColorFromDeviation(deviationMin);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3335)) {</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">            if (statusColor != R.color.stop_info_ontime) {</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3334)) {</span>
                    // Show early/late/scheduled color
<span class="nc" id="L576">                    d.setColor(getResources().getColor(statusColor));</span>
                }
            } else {
<span class="nc bnc" id="L579" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3333)) {</span>
                    // For on-time, use header default color
<span class="nc" id="L581">                    d.setColor(getResources().getColor(R.color.theme_primary));</span>
                }
            }
        }
<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3357)) {</span>
<span class="nc bnc" id="L586" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(3340) ? (deviation &lt;= 0) : (ListenerUtil.mutListener.listen(3339) ? (deviation &gt; 0) : (ListenerUtil.mutListener.listen(3338) ? (deviation &lt; 0) : (ListenerUtil.mutListener.listen(3337) ? (deviation != 0) : (ListenerUtil.mutListener.listen(3336) ? (deviation == 0) : (deviation &gt;= 0))))))) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3356)) {</span>
<span class="nc bnc" id="L588" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(3353) ? (deviation &gt;= 60) : (ListenerUtil.mutListener.listen(3352) ? (deviation &lt;= 60) : (ListenerUtil.mutListener.listen(3351) ? (deviation &gt; 60) : (ListenerUtil.mutListener.listen(3350) ? (deviation != 60) : (ListenerUtil.mutListener.listen(3349) ? (deviation == 60) : (deviation &lt; 60))))))) {</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3355)) {</span>
<span class="nc" id="L590">                            vehicleDeviation.setText(context.getString(R.string.trip_details_real_time_sec_late, seconds, lastUpdate));</span>
                        }
                    } else {
<span class="nc bnc" id="L593" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3354)) {</span>
<span class="nc" id="L594">                            vehicleDeviation.setText(context.getString(R.string.trip_details_real_time_min_sec_late, minutes, seconds, lastUpdate));</span>
                        }
                    }
                }
            } else {
<span class="nc bnc" id="L599" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3348)) {</span>
<span class="nc bnc" id="L600" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(3345) ? (deviation &gt;= -60) : (ListenerUtil.mutListener.listen(3344) ? (deviation &lt;= -60) : (ListenerUtil.mutListener.listen(3343) ? (deviation &lt; -60) : (ListenerUtil.mutListener.listen(3342) ? (deviation != -60) : (ListenerUtil.mutListener.listen(3341) ? (deviation == -60) : (deviation &gt; -60))))))) {</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3347)) {</span>
<span class="nc" id="L602">                            vehicleDeviation.setText(context.getString(R.string.trip_details_real_time_sec_early, seconds, lastUpdate));</span>
                        }
                    } else {
<span class="nc bnc" id="L605" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3346)) {</span>
<span class="nc" id="L606">                            vehicleDeviation.setText(context.getString(R.string.trip_details_real_time_min_sec_early, minutes, seconds, lastUpdate));</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3362)) {</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">            if (status.getOccupancyStatus() != null) {</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3360)) {</span>
                    // Real-time occupancy data
<span class="nc" id="L616">                    UIUtils.setOccupancyVisibilityAndColor(occupancyView, status.getOccupancyStatus(), OccupancyState.REALTIME);</span>
                }
<span class="nc bnc" id="L618" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3361)) {</span>
<span class="nc" id="L619">                    UIUtils.setOccupancyContentDescription(occupancyView, status.getOccupancyStatus(), OccupancyState.REALTIME);</span>
                }
            } else {
<span class="nc bnc" id="L622" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3358)) {</span>
                    // Hide occupancy by setting null value
<span class="nc" id="L624">                    UIUtils.setOccupancyVisibilityAndColor(occupancyView, null, OccupancyState.REALTIME);</span>
                }
<span class="nc bnc" id="L626" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3359)) {</span>
<span class="nc" id="L627">                    UIUtils.setOccupancyContentDescription(occupancyView, null, OccupancyState.REALTIME);</span>
                }
            }
        }
<span class="nc" id="L631">    }</span>

    private Integer findIndexForStop(ObaTripSchedule.StopTime[] stopTimes, String stopId) {
<span class="nc bnc" id="L634" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3363)) {</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">            if (stopId == null) {</span>
<span class="nc" id="L636">                return null;</span>
            }
        }
<span class="nc bnc" id="L639" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3370)) {</span>
            {
<span class="nc" id="L641">                long _loopCounter29 = 0;</span>
<span class="nc bnc" id="L642" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(3369) ? (i &gt;= stopTimes.length) : (ListenerUtil.mutListener.listen(3368) ? (i &lt;= stopTimes.length) : (ListenerUtil.mutListener.listen(3367) ? (i &gt; stopTimes.length) : (ListenerUtil.mutListener.listen(3366) ? (i != stopTimes.length) : (ListenerUtil.mutListener.listen(3365) ? (i == stopTimes.length) : (i &lt; stopTimes.length)))))); i++) {</span>
<span class="nc" id="L643">                    ListenerUtil.loopListener.listen(&quot;_loopCounter29&quot;, ++_loopCounter29);</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3364)) {</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">                        if (stopId.equals(stopTimes[i].getStopId())) {</span>
<span class="nc" id="L646">                            return i;</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L652">        return null;</span>
    }

    private void showArrivals(String stopId, String stopName, String stopDirection) {
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3371)) {</span>
<span class="nc" id="L657">            new ArrivalsListActivity.Builder(getActivity(), stopId).setUpMode(NavHelp.UP_MODE_BACK).setStopName(stopName).setStopDirection(stopDirection).start();</span>
        }
<span class="nc" id="L659">    }</span>

<span class="nc" id="L661">    private final AdapterView.OnItemClickListener mClickListener = new AdapterView.OnItemClickListener() {</span>

        @Override
        public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
<span class="nc bnc" id="L665" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3373)) {</span>
<span class="nc bnc" id="L666" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(3372) ? (mTripInfo == null &amp;&amp; mTripInfo.getSchedule() == null) : (mTripInfo == null || mTripInfo.getSchedule() == null))) {</span>
<span class="nc" id="L667">                    return;</span>
                }
            }
<span class="nc" id="L670">            ObaTripSchedule.StopTime time = mTripInfo.getSchedule().getStopTimes()[position];</span>
<span class="nc" id="L671">            ObaReferences refs = mTripInfo.getRefs();</span>
<span class="nc" id="L672">            String stopId = time.getStopId();</span>
<span class="nc" id="L673">            ObaStop stop = refs.getStop(stopId);</span>
<span class="nc bnc" id="L674" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3374)) {</span>
<span class="nc" id="L675">                showArrivals(stopId, stop.getName(), stop.getDirection());</span>
            }
<span class="nc" id="L677">        }</span>
    };

<span class="nc" id="L680">    private final AdapterView.OnItemLongClickListener mLongClickListener = new AdapterView.OnItemLongClickListener() {</span>

        @Override
        public boolean onItemLongClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
<span class="nc bnc" id="L684" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3396)) {</span>
<span class="nc bnc" id="L685" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(3379) ? (position &gt;= 1) : (ListenerUtil.mutListener.listen(3378) ? (position &lt;= 1) : (ListenerUtil.mutListener.listen(3377) ? (position &lt; 1) : (ListenerUtil.mutListener.listen(3376) ? (position != 1) : (ListenerUtil.mutListener.listen(3375) ? (position == 1) : (position &gt; 1))))))) {</span>
                    // Build AlertDialog
<span class="nc" id="L687">                    AlertDialog.Builder bldr = new AlertDialog.Builder(getActivity());</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3380)) {</span>
<span class="nc" id="L689">                        bldr.setMessage(R.string.destination_reminder_dialog_msg).setTitle(R.string.destination_reminder_dialog_title);</span>
                    }
<span class="nc bnc" id="L691" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3392)) {</span>
                        // Confirmation button
<span class="nc" id="L693">                        bldr.setPositiveButton(R.string.destination_reminder_confirm, new DialogInterface.OnClickListener() {</span>

                            @Override
                            public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L697" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3382)) {</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">                                    if (!LocationUtils.isLocationEnabled(getContext())) {</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3381)) {</span>
<span class="nc" id="L700">                                            askUserToTurnLocationOn();</span>
                                        }
<span class="nc" id="L702">                                        return;</span>
                                    }
                                }
<span class="nc" id="L705">                                int locMode = LocationUtils.getLocationMode(getContext());</span>
                                // If the user hasn't opted out of &quot;Change Location Mode&quot; dialog, show it to them
<span class="nc" id="L707">                                SharedPreferences prefs = Application.getPrefs();</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3385)) {</span>
<span class="nc bnc" id="L709" title="All 10 branches missed.">                                    if ((ListenerUtil.mutListener.listen(3383) ? (!(prefs.getBoolean(getString(R.string.preference_key_never_show_change_location_mode_dialog), false)) || locMode != Settings.Secure.LOCATION_MODE_HIGH_ACCURACY) : (!(prefs.getBoolean(getString(R.string.preference_key_never_show_change_location_mode_dialog), false)) &amp;&amp; locMode != Settings.Secure.LOCATION_MODE_HIGH_ACCURACY))) {</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3384)) {</span>
<span class="nc" id="L711">                                            getDialogForLocationModeChanges().show();</span>
                                        }
                                    }
                                }
<span class="nc bnc" id="L715" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3387)) {</span>
                                    // Warn users that destination reminders are in beta
<span class="nc bnc" id="L717" title="All 2 branches missed.">                                    if (!(prefs.getBoolean(getString(R.string.preference_key_never_show_destination_reminder_beta_dialog), false))) {</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3386)) {</span>
<span class="nc" id="L719">                                            createDestinationReminderBetaDialog().show();</span>
                                        }
                                    }
                                }
<span class="nc bnc" id="L723" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3388)) {</span>
<span class="nc" id="L724">                                    ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_destination_reminder), getString(R.string.analytics_label_destination_reminder_variant_started));</span>
                                }
<span class="nc bnc" id="L726" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3389)) {</span>
<span class="nc" id="L727">                                    startNavigationService(setUpNavigationService(position));</span>
                                }
<span class="nc bnc" id="L729" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3390)) {</span>
<span class="nc" id="L730">                                    Toast.makeText(Application.get(), Application.get().getString(R.string.destination_reminder_title), Toast.LENGTH_LONG).show();</span>
                                }
<span class="nc bnc" id="L732" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3391)) {</span>
<span class="nc" id="L733">                                    TravelBehaviorManager.saveDestinationReminders(mStopId, mDestinationId, mTripId, mRouteId, mTripInfo.getCurrentTime());</span>
                                }
<span class="nc" id="L735">                            }</span>
                        });
                    }
<span class="nc bnc" id="L738" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3393)) {</span>
                        // Cancellation Button
<span class="nc" id="L740">                        bldr.setNegativeButton(R.string.destination_reminder_cancel, (dialog, which) -&gt; {</span>
<span class="nc" id="L741">                        });</span>
                    }
                    // Display
<span class="nc" id="L744">                    AlertDialog dialog = bldr.create();</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3394)) {</span>
<span class="nc" id="L746">                        dialog.setOwnerActivity(getActivity());</span>
                    }
<span class="nc bnc" id="L748" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3395)) {</span>
<span class="nc" id="L749">                        dialog.show();</span>
                    }
                }
            }
<span class="nc" id="L753">            return true;</span>
        }

        /**
         * @param pId Position of a stop for which we started Destination alert
         * @return Intent object to be used for starting navigation service
         */
        private Intent setUpNavigationService(int pId) {
<span class="nc bnc" id="L761" title="All 8 branches missed.">            ObaTripSchedule.StopTime timeLast = mTripInfo.getSchedule().getStopTimes()[(ListenerUtil.mutListener.listen(3400) ? (pId % 1) : (ListenerUtil.mutListener.listen(3399) ? (pId / 1) : (ListenerUtil.mutListener.listen(3398) ? (pId * 1) : (ListenerUtil.mutListener.listen(3397) ? (pId + 1) : (pId - 1)))))];</span>
<span class="nc" id="L762">            ObaTripSchedule.StopTime timeDest = mTripInfo.getSchedule().getStopTimes()[pId];</span>
<span class="nc" id="L763">            ObaReferences refs = mTripInfo.getRefs();</span>
<span class="nc" id="L764">            String destStopId = timeDest.getStopId();</span>
<span class="nc" id="L765">            String lastStopId = timeLast.getStopId();</span>
<span class="nc" id="L766">            ObaStop destStop = refs.getStop(destStopId);</span>
<span class="nc" id="L767">            ObaStop lastStop = refs.getStop(lastStopId);</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3401)) {</span>
<span class="nc" id="L769">                DBUtil.addToDB(lastStop);</span>
            }
<span class="nc bnc" id="L771" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3402)) {</span>
<span class="nc" id="L772">                DBUtil.addToDB(destStop);</span>
            }
<span class="nc" id="L774">            Intent serviceIntent = new Intent(getContext(), NavigationService.class);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3403)) {</span>
<span class="nc" id="L776">                mDestinationId = destStop.getId();</span>
            }
<span class="nc bnc" id="L778" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3404)) {</span>
<span class="nc" id="L779">                serviceIntent.putExtra(NavigationService.DESTINATION_ID, mDestinationId);</span>
            }
<span class="nc bnc" id="L781" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3405)) {</span>
<span class="nc" id="L782">                serviceIntent.putExtra(NavigationService.BEFORE_STOP_ID, lastStop.getId());</span>
            }
<span class="nc bnc" id="L784" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3406)) {</span>
<span class="nc" id="L785">                serviceIntent.putExtra(NavigationService.TRIP_ID, mTripId);</span>
            }
<span class="nc bnc" id="L787" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3408)) {</span>
                // update UI
<span class="nc bnc" id="L789" title="All 2 branches missed.">                if (mDestinationId != null) {</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3407)) {</span>
<span class="nc" id="L791">                        mDestinationIndex = findIndexForStop(mTripInfo.getSchedule().getStopTimes(), mDestinationId);</span>
                    }
                }
            }
<span class="nc bnc" id="L795" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3409)) {</span>
<span class="nc" id="L796">                mAdapter.notifyDataSetChanged();</span>
            }
<span class="nc bnc" id="L798" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3410)) {</span>
                // Save Intent so that we can call up startNavigationService() from onActivityResult() later
<span class="nc" id="L800">                getActivity().setIntent(serviceIntent);</span>
            }
<span class="nc" id="L802">            return serviceIntent;</span>
        }

        /**
         * This will allow user to turn on location within application context
         */
        private void askUserToTurnLocationOn() {
<span class="nc bnc" id="L809" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3411)) {</span>
<span class="nc" id="L810">                mLocationRequest = LocationRequest.create();</span>
            }
<span class="nc bnc" id="L812" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3412)) {</span>
<span class="nc" id="L813">                mLocationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY);</span>
            }
            // Specifies the types of location services the client is interested in using.
<span class="nc" id="L816">            LocationSettingsRequest.Builder builder = new LocationSettingsRequest.Builder();</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3413)) {</span>
<span class="nc" id="L818">                builder.addLocationRequest(mLocationRequest);</span>
            }
<span class="nc bnc" id="L820" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3414)) {</span>
<span class="nc" id="L821">                mResult = LocationServices.getSettingsClient(getActivity()).checkLocationSettings(builder.build());</span>
            }
<span class="nc bnc" id="L823" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3419)) {</span>
                // by looking at the status code from the LocationSettingsResponse object.
<span class="nc" id="L825">                mResult.addOnCompleteListener(new OnCompleteListener&lt;LocationSettingsResponse&gt;() {</span>

                    @Override
                    public void onComplete(Task&lt;LocationSettingsResponse&gt; task) {
                        try {
<span class="nc" id="L830">                            LocationSettingsResponse response = task.getResult(ApiException.class);</span>
<span class="nc" id="L831">                        } catch (ApiException APIexc) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3418)) {</span>
<span class="nc bnc" id="L833" title="All 3 branches missed.">                                switch(APIexc.getStatusCode()) {</span>
                                    case LocationSettingsStatusCodes.RESOLUTION_REQUIRED:
                                        // user a dialog.
                                        try {
<span class="nc" id="L837">                                            ResolvableApiException resolvable = (ResolvableApiException) APIexc;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3415)) {</span>
                                                // and check the result in onActivityResult()
<span class="nc" id="L840">                                                Log.d(TAG, &quot;Showing dialog to user for desired location settings...&quot;);</span>
                                            }
<span class="nc bnc" id="L842" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3416)) {</span>
<span class="nc" id="L843">                                                resolvable.startResolutionForResult(getActivity(), REQUEST_ENABLE_LOCATION);</span>
                                            }
<span class="nc" id="L845">                                        } catch (IntentSender.SendIntentException sendIntExc) {</span>
<span class="nc" id="L846">                                        } catch (ClassCastException classCastExc) {</span>
<span class="nc" id="L847">                                        }</span>
<span class="nc" id="L848">                                        break;</span>
                                    case LocationSettingsStatusCodes.SETTINGS_CHANGE_UNAVAILABLE:
<span class="nc bnc" id="L850" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3417)) {</span>
                                            // settings so we won't show the dialog.
<span class="nc" id="L852">                                            Log.d(TAG, &quot;Location settings are inadequate, and cannot be fixed here. Dialog not created.&quot;);</span>
                                        }
                                        break;
                                }
                            }
<span class="nc" id="L857">                        }</span>
<span class="nc" id="L858">                    }</span>
                });
            }
<span class="nc" id="L861">        }</span>

        /**
         * Create &quot;High Accuracy GPS needed alert&quot; dialog
         *
         * @return dialog for &quot;High Accuracy GPS needed alert&quot;
         */
        private Dialog getDialogForLocationModeChanges() {
<span class="nc" id="L869">            View view = getActivity().getLayoutInflater().inflate(R.layout.change_locationmode_dialog, null);</span>
<span class="nc" id="L870">            CheckBox neverShowDialog = view.findViewById(R.id.change_locationmode_never_ask_again);</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3420)) {</span>
<span class="nc" id="L872">                neverShowDialog.setOnCheckedChangeListener((compoundButton, isChecked) -&gt; {</span>
                    // Save the preference
<span class="nc" id="L874">                    PreferenceUtils.saveBoolean(getString(R.string.preference_key_never_show_change_location_mode_dialog), isChecked);</span>
<span class="nc" id="L875">                });</span>
            }
<span class="nc" id="L877">            Drawable icon = getResources().getDrawable(android.R.drawable.ic_dialog_map);</span>
<span class="nc bnc" id="L878" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3421)) {</span>
<span class="nc" id="L879">                DrawableCompat.setTint(icon, getResources().getColor(R.color.theme_primary));</span>
            }
<span class="nc" id="L881">            AlertDialog.Builder builder = new AlertDialog.Builder(getActivity()).setTitle(R.string.main_changelocationmode_title).setIcon(icon).setCancelable(false).setView(view).setPositiveButton(R.string.rt_yes, (dialog, which) -&gt; startActivity(new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS))).setNegativeButton(R.string.rt_no, (dialog, which) -&gt; {</span>
<span class="nc" id="L882">            });</span>
<span class="nc" id="L883">            return builder.create();</span>
        }
    };

    /**
     * Create dialog reminding user that destination reminders are in beta
     *
     * @return dialog reminding user that destination reminders are in beta
     */
    private Dialog createDestinationReminderBetaDialog() {
<span class="nc" id="L893">        View view = getActivity().getLayoutInflater().inflate(R.layout.destination_reminder_beta_dialog, null);</span>
<span class="nc" id="L894">        CheckBox neverShowDialog = view.findViewById(R.id.destination_reminder_beta_never_show_again);</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3422)) {</span>
<span class="nc" id="L896">            neverShowDialog.setOnCheckedChangeListener((compoundButton, isChecked) -&gt; {</span>
                // Save the preference
<span class="nc" id="L898">                PreferenceUtils.saveBoolean(getString(R.string.preference_key_never_show_destination_reminder_beta_dialog), isChecked);</span>
<span class="nc" id="L899">            });</span>
        }
<span class="nc" id="L901">        Drawable icon = getResources().getDrawable(android.R.drawable.ic_dialog_alert);</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3423)) {</span>
<span class="nc" id="L903">            DrawableCompat.setTint(icon, getResources().getColor(R.color.theme_primary));</span>
        }
<span class="nc" id="L905">        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity()).setTitle(R.string.destination_reminder_beta_title).setIcon(icon).setCancelable(false).setView(view).setPositiveButton(R.string.ok, (dialogInterface, i) -&gt; {</span>
<span class="nc" id="L906">        });</span>
<span class="nc" id="L907">        return builder.create();</span>
    }

<span class="nc" id="L910">    private final Handler mRefreshHandler = new Handler();</span>

<span class="nc" id="L912">    private final Runnable mRefresh = new Runnable() {</span>

        public void run() {
<span class="nc bnc" id="L915" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3424)) {</span>
<span class="nc" id="L916">                refresh();</span>
            }
<span class="nc" id="L918">        }</span>
    };

    private TripDetailsLoader getTripDetailsLoader() {
<span class="nc bnc" id="L922" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3425)) {</span>
            // If the Fragment hasn't been attached to an Activity yet, return null
<span class="nc bnc" id="L924" title="All 2 branches missed.">            if (!isAdded()) {</span>
<span class="nc" id="L925">                return null;</span>
            }
        }
<span class="nc" id="L928">        Loader&lt;ObaTripDetailsResponse&gt; l = getLoaderManager().getLoader(TRIP_DETAILS_LOADER);</span>
<span class="nc" id="L929">        return (TripDetailsLoader) l;</span>
    }

    private void refresh() {
<span class="nc bnc" id="L933" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3428)) {</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">            if (isAdded()) {</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3426)) {</span>
<span class="nc" id="L936">                    UIUtils.showProgress(this, true);</span>
                }
<span class="nc bnc" id="L938" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3427)) {</span>
<span class="nc" id="L939">                    getTripDetailsLoader().onContentChanged();</span>
                }
            }
        }
<span class="nc" id="L943">    }</span>

<span class="nc" id="L945">    private final class TripDetailsLoaderCallback implements LoaderManager.LoaderCallbacks&lt;ObaTripDetailsResponse&gt; {</span>

        @Override
        public Loader&lt;ObaTripDetailsResponse&gt; onCreateLoader(int id, Bundle args) {
<span class="nc" id="L949">            return new TripDetailsLoader(getActivity(), mTripId);</span>
        }

        @Override
        public void onLoadFinished(Loader&lt;ObaTripDetailsResponse&gt; loader, ObaTripDetailsResponse data) {
<span class="nc bnc" id="L954" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3429)) {</span>
<span class="nc" id="L955">                setTripDetails(data);</span>
            }
<span class="nc bnc" id="L957" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3432)) {</span>
                // The list should now be shown.
<span class="nc bnc" id="L959" title="All 2 branches missed.">                if (isResumed()) {</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3431)) {</span>
<span class="nc" id="L961">                        setListShown(true);</span>
                    }
                } else {
<span class="nc bnc" id="L964" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3430)) {</span>
<span class="nc" id="L965">                        setListShownNoAnimation(true);</span>
                    }
                }
            }
<span class="nc bnc" id="L969" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3433)) {</span>
                // Clear any pending refreshes
<span class="nc" id="L971">                mRefreshHandler.removeCallbacks(mRefresh);</span>
            }
<span class="nc bnc" id="L973" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3434)) {</span>
                // Post an update
<span class="nc" id="L975">                mRefreshHandler.postDelayed(mRefresh, REFRESH_PERIOD);</span>
            }
<span class="nc" id="L977">        }</span>

        @Override
        public void onLoaderReset(Loader&lt;ObaTripDetailsResponse&gt; loader) {
<span class="nc" id="L981">        }</span>
    }

    private static final class TripDetailsLoader extends AsyncTaskLoader&lt;ObaTripDetailsResponse&gt; {

        private final String mTripId;

        private ObaTripDetailsResponse mLastGoodResponse;

<span class="nc" id="L990">        private long mLastResponseTime = 0;</span>

<span class="nc" id="L992">        private long mLastGoodResponseTime = 0;</span>

        TripDetailsLoader(Context context, String tripId) {
<span class="nc" id="L995">            super(context);</span>
<span class="nc" id="L996">            mTripId = tripId;</span>
<span class="nc" id="L997">        }</span>

        @Override
        public ObaTripDetailsResponse loadInBackground() {
<span class="nc" id="L1001">            return ObaTripDetailsRequest.newRequest(getContext(), mTripId).call();</span>
        }

        @Override
        public void deliverResult(ObaTripDetailsResponse data) {
<span class="nc bnc" id="L1006" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3435)) {</span>
<span class="nc" id="L1007">                mLastResponseTime = System.currentTimeMillis();</span>
            }
<span class="nc bnc" id="L1009" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3438)) {</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">                if (data.getCode() == ObaApi.OBA_OK) {</span>
<span class="nc bnc" id="L1011" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3436)) {</span>
<span class="nc" id="L1012">                        mLastGoodResponse = data;</span>
                    }
<span class="nc bnc" id="L1014" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3437)) {</span>
<span class="nc" id="L1015">                        mLastGoodResponseTime = mLastResponseTime;</span>
                    }
                }
            }
<span class="nc bnc" id="L1019" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3439)) {</span>
<span class="nc" id="L1020">                super.deliverResult(data);</span>
            }
<span class="nc" id="L1022">        }</span>

        public long getLastResponseTime() {
<span class="nc" id="L1025">            return mLastResponseTime;</span>
        }

        public ObaTripDetailsResponse getLastGoodResponse() {
<span class="nc" id="L1029">            return mLastGoodResponse;</span>
        }

        public long getLastGoodResponseTime() {
<span class="nc" id="L1033">            return mLastGoodResponseTime;</span>
        }
    }

    private final class TripDetailsAdapter extends BaseAdapter {

        LayoutInflater mInflater;

        ObaTripSchedule mSchedule;

        ObaReferences mRefs;

        ObaTripStatus mStatus;

        Integer mNextStopIndex;

<span class="nc" id="L1049">        public TripDetailsAdapter() {</span>
<span class="nc bnc" id="L1050" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3440)) {</span>
<span class="nc" id="L1051">                this.mInflater = LayoutInflater.from(TripDetailsListFragment.this.getActivity());</span>
            }
<span class="nc bnc" id="L1053" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3441)) {</span>
<span class="nc" id="L1054">                updateData();</span>
            }
<span class="nc" id="L1056">        }</span>

        private void updateData() {
<span class="nc bnc" id="L1059" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3442)) {</span>
<span class="nc" id="L1060">                this.mSchedule = mTripInfo.getSchedule();</span>
            }
<span class="nc bnc" id="L1062" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3443)) {</span>
<span class="nc" id="L1063">                this.mRefs = mTripInfo.getRefs();</span>
            }
<span class="nc bnc" id="L1065" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3444)) {</span>
<span class="nc" id="L1066">                this.mStatus = mTripInfo.getStatus();</span>
            }
<span class="nc bnc" id="L1068" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3445)) {</span>
<span class="nc" id="L1069">                mNextStopIndex = null;</span>
            }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3446)) {</span>
<span class="nc bnc" id="L1072" title="All 2 branches missed.">                if (mStatus == null) {</span>
                    // We don't have real-time data - clear next stop index
<span class="nc" id="L1074">                    return;</span>
                }
            }
            // Based on real-time data, set the index for the next stop
<span class="nc" id="L1078">            String stopId = mStatus.getNextStop();</span>
            int i;
<span class="nc bnc" id="L1080" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3454)) {</span>
                {
<span class="nc" id="L1082">                    long _loopCounter30 = 0;</span>
<span class="nc bnc" id="L1083" title="All 22 branches missed.">                    for (i = 0; (ListenerUtil.mutListener.listen(3453) ? (i &gt;= mSchedule.getStopTimes().length) : (ListenerUtil.mutListener.listen(3452) ? (i &lt;= mSchedule.getStopTimes().length) : (ListenerUtil.mutListener.listen(3451) ? (i &gt; mSchedule.getStopTimes().length) : (ListenerUtil.mutListener.listen(3450) ? (i != mSchedule.getStopTimes().length) : (ListenerUtil.mutListener.listen(3449) ? (i == mSchedule.getStopTimes().length) : (i &lt; mSchedule.getStopTimes().length)))))); i++) {</span>
<span class="nc" id="L1084">                        ListenerUtil.loopListener.listen(&quot;_loopCounter30&quot;, ++_loopCounter30);</span>
<span class="nc" id="L1085">                        ObaTripSchedule.StopTime time = mSchedule.getStopTimes()[i];</span>
<span class="nc bnc" id="L1086" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3448)) {</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                            if (time.getStopId().equals(stopId)) {</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3447)) {</span>
<span class="nc" id="L1089">                                    mNextStopIndex = i;</span>
                                }
                                break;
                            }
                        }
                    }
                }
            }
<span class="nc" id="L1097">        }</span>

        @Override
        public void notifyDataSetChanged() {
<span class="nc bnc" id="L1101" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3455)) {</span>
<span class="nc" id="L1102">                updateData();</span>
            }
<span class="nc bnc" id="L1104" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3456)) {</span>
<span class="nc" id="L1105">                super.notifyDataSetChanged();</span>
            }
<span class="nc" id="L1107">        }</span>

        @Override
        public int getCount() {
<span class="nc" id="L1111">            return mSchedule.getStopTimes().length;</span>
        }

        @Override
        public Object getItem(int position) {
<span class="nc" id="L1116">            return mSchedule.getStopTimes()[position];</span>
        }

        @Override
        public long getItemId(int position) {
<span class="nc" id="L1121">            return position;</span>
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
<span class="nc bnc" id="L1126" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3458)) {</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">                if (convertView == null) {</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3457)) {</span>
<span class="nc" id="L1129">                        convertView = mInflater.inflate(R.layout.trip_details_listitem, parent, false);</span>
                    }
                }
            }
<span class="nc" id="L1133">            ObaTripSchedule.StopTime stopTime = mSchedule.getStopTimes()[position];</span>
<span class="nc" id="L1134">            ObaStop stop = mRefs.getStop(stopTime.getStopId());</span>
<span class="nc" id="L1135">            ObaTrip trip = mRefs.getTrip(mTripId);</span>
<span class="nc" id="L1136">            ObaRoute route = mRefs.getRoute(trip.getRouteId());</span>
<span class="nc" id="L1137">            TextView stopName = (TextView) convertView.findViewById(R.id.stop_name);</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3459)) {</span>
<span class="nc" id="L1139">                stopName.setText(UIUtils.formatDisplayText(stop.getName()));</span>
            }
<span class="nc" id="L1141">            TextView time = (TextView) convertView.findViewById(R.id.time);</span>
<span class="nc" id="L1142">            ViewGroup realtime = (ViewGroup) convertView.findViewById(R.id.eta_realtime_indicator);</span>
<span class="nc bnc" id="L1143" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3460)) {</span>
<span class="nc" id="L1144">                realtime.setVisibility(View.GONE);</span>
            }
<span class="nc" id="L1146">            ViewGroup occupancyView = convertView.findViewById(R.id.occupancy);</span>
            long date;
<span class="nc" id="L1148">            long deviation = 0;</span>
            int statusColor;
<span class="nc bnc" id="L1150" title="All 2 branches missed.">            if (mStatus != null) {</span>
                // If we have real-time info, use that
<span class="nc" id="L1152">                date = mStatus.getServiceDate();</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3465)) {</span>
<span class="nc" id="L1154">                    deviation = mStatus.getScheduleDeviation();</span>
                }
<span class="nc" id="L1156">                long deviationMin = TimeUnit.SECONDS.toMinutes(mStatus.getScheduleDeviation());</span>
<span class="nc bnc" id="L1157" title="All 2 branches missed.">                if (mStatus.isPredicted()) {</span>
<span class="nc" id="L1158">                    statusColor = ArrivalInfoUtils.computeColorFromDeviation(deviationMin);</span>
                } else {
<span class="nc" id="L1160">                    statusColor = R.color.stop_info_scheduled_time;</span>
                }
<span class="nc" id="L1162">            } else {</span>
                // Use current date - its only to offset time correctly from midnight
<span class="nc" id="L1164">                Calendar cal = new GregorianCalendar();</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3461)) {</span>
                    // Reset to midnight of today
<span class="nc" id="L1167">                    cal.set(Calendar.HOUR_OF_DAY, 0);</span>
                }
<span class="nc bnc" id="L1169" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3462)) {</span>
<span class="nc" id="L1170">                    cal.set(Calendar.MINUTE, 0);</span>
                }
<span class="nc bnc" id="L1172" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3463)) {</span>
<span class="nc" id="L1173">                    cal.set(Calendar.SECOND, 0);</span>
                }
<span class="nc bnc" id="L1175" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3464)) {</span>
<span class="nc" id="L1176">                    cal.set(Calendar.MILLISECOND, 0);</span>
                }
<span class="nc" id="L1178">                date = cal.getTime().getTime();</span>
<span class="nc" id="L1179">                statusColor = R.color.stop_info_scheduled_time;</span>
            }
<span class="nc bnc" id="L1181" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3474)) {</span>
<span class="nc bnc" id="L1182" title="All 16 branches missed.">                time.setText(DateUtils.formatDateTime(getActivity(), date + (ListenerUtil.mutListener.listen(3469) ? (stopTime.getArrivalTime() % 1000) : (ListenerUtil.mutListener.listen(3468) ? (stopTime.getArrivalTime() / 1000) : (ListenerUtil.mutListener.listen(3467) ? (stopTime.getArrivalTime() - 1000) : (ListenerUtil.mutListener.listen(3466) ? (stopTime.getArrivalTime() + 1000) : (stopTime.getArrivalTime() * 1000))))) + (ListenerUtil.mutListener.listen(3473) ? (deviation % 1000) : (ListenerUtil.mutListener.listen(3472) ? (deviation / 1000) : (ListenerUtil.mutListener.listen(3471) ? (deviation - 1000) : (ListenerUtil.mutListener.listen(3470) ? (deviation + 1000) : (deviation * 1000))))), DateUtils.FORMAT_SHOW_TIME | DateUtils.FORMAT_NO_NOON | DateUtils.FORMAT_NO_MIDNIGHT));</span>
            }
<span class="nc bnc" id="L1184" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3478)) {</span>
<span class="nc bnc" id="L1185" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(3475) ? (mStatus != null || Status.CANCELED.equals(mStatus.getStatus())) : (mStatus != null &amp;&amp; Status.CANCELED.equals(mStatus.getStatus())))) {</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3476)) {</span>
                        // CANCELED trip - Strike through the text fields
<span class="nc" id="L1188">                        stopName.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
                    }
<span class="nc bnc" id="L1190" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3477)) {</span>
<span class="nc" id="L1191">                        time.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
                    }
                }
            }
<span class="nc bnc" id="L1195" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3483)) {</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">                if (stopTime.getPredictedOccupancy() != null) {</span>
<span class="nc bnc" id="L1197" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3481)) {</span>
                        // Predicted occupancy data
<span class="nc" id="L1199">                        UIUtils.setOccupancyVisibilityAndColor(occupancyView, stopTime.getPredictedOccupancy(), OccupancyState.PREDICTED);</span>
                    }
<span class="nc bnc" id="L1201" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3482)) {</span>
<span class="nc" id="L1202">                        UIUtils.setOccupancyContentDescription(occupancyView, stopTime.getPredictedOccupancy(), OccupancyState.PREDICTED);</span>
                    }
                } else {
<span class="nc bnc" id="L1205" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3479)) {</span>
                        // Historical occupancy data
<span class="nc" id="L1207">                        UIUtils.setOccupancyVisibilityAndColor(occupancyView, stopTime.getHistoricalOccupancy(), OccupancyState.HISTORICAL);</span>
                    }
<span class="nc bnc" id="L1209" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3480)) {</span>
<span class="nc" id="L1210">                        UIUtils.setOccupancyContentDescription(occupancyView, stopTime.getHistoricalOccupancy(), OccupancyState.HISTORICAL);</span>
                    }
                }
            }
<span class="nc" id="L1214">            ImageView bus = (ImageView) convertView.findViewById(R.id.bus_icon);</span>
<span class="nc" id="L1215">            ImageView stopIcon = (ImageView) convertView.findViewById(R.id.stop_icon);</span>
<span class="nc" id="L1216">            ImageView flagIcon = (ImageView) convertView.findViewById(R.id.destination_icon);</span>
<span class="nc" id="L1217">            ImageView topLine = (ImageView) convertView.findViewById(R.id.top_line);</span>
<span class="nc" id="L1218">            ImageView bottomLine = (ImageView) convertView.findViewById(R.id.bottom_line);</span>
<span class="nc" id="L1219">            ImageView transitStop = (ImageView) convertView.findViewById(R.id.transit_stop);</span>
            // Set bus and realtime indicator to match status color
            int id;
<span class="nc bnc" id="L1222" title="All 7 branches missed.">            switch(route.getType()) {</span>
                case ObaRoute.TYPE_FERRY:
<span class="nc" id="L1224">                    id = R.drawable.ic_ferry;</span>
<span class="nc" id="L1225">                    break;</span>
                case ObaRoute.TYPE_SUBWAY:
<span class="nc" id="L1227">                    id = R.drawable.ic_subway;</span>
<span class="nc" id="L1228">                    break;</span>
                case ObaRoute.TYPE_CABLECAR:
<span class="nc" id="L1230">                    id = R.drawable.ic_tram;</span>
<span class="nc" id="L1231">                    break;</span>
                case ObaRoute.TYPE_TRAM:
<span class="nc" id="L1233">                    id = R.drawable.ic_tram;</span>
<span class="nc" id="L1234">                    break;</span>
                case ObaRoute.TYPE_RAIL:
<span class="nc" id="L1236">                    id = R.drawable.ic_train;</span>
<span class="nc" id="L1237">                    break;</span>
                case ObaRoute.TYPE_BUS:
<span class="nc" id="L1239">                    id = R.drawable.ic_bus;</span>
<span class="nc" id="L1240">                    break;</span>
                default:
<span class="nc" id="L1242">                    id = R.drawable.ic_bus;</span>
                    break;
            }
<span class="nc bnc" id="L1245" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3484)) {</span>
<span class="nc" id="L1246">                bus.setImageDrawable(getResources().getDrawable(id));</span>
            }
<span class="nc bnc" id="L1248" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3485)) {</span>
                // Make the icon itself white
<span class="nc" id="L1250">                bus.setColorFilter(Color.WHITE, PorterDuff.Mode.SRC_IN);</span>
            }
<span class="nc bnc" id="L1252" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3492)) {</span>
<span class="nc bnc" id="L1253" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(3490) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.LOLLIPOP) : (ListenerUtil.mutListener.listen(3489) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.LOLLIPOP) : (ListenerUtil.mutListener.listen(3488) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) : (ListenerUtil.mutListener.listen(3487) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.LOLLIPOP) : (ListenerUtil.mutListener.listen(3486) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP))))))) {</span>
<span class="nc bnc" id="L1254" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3491)) {</span>
                        // Change the circle's color
<span class="nc" id="L1256">                        bus.setBackgroundTintList(ColorStateList.valueOf(getResources().getColor(statusColor)));</span>
                    }
                }
            }
<span class="nc bnc" id="L1260" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3493)) {</span>
<span class="nc" id="L1261">                UIUtils.setRealtimeIndicatorColor(realtime, getResources().getColor(statusColor), android.R.color.transparent);</span>
            }
            int routeColor;
            // If a route color (other than the default white) is included in the API response, then use it
<span class="nc bnc" id="L1265" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3494) ? (route.getColor() != null || route.getColor() != android.R.color.white) : (route.getColor() != null &amp;&amp; route.getColor() != android.R.color.white))) {</span>
<span class="nc" id="L1266">                routeColor = route.getColor();</span>
            } else {
                // Use the theme color
<span class="nc" id="L1269">                routeColor = getResources().getColor(R.color.theme_primary);</span>
            }
<span class="nc bnc" id="L1271" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3495)) {</span>
<span class="nc" id="L1272">                stopIcon.setColorFilter(routeColor);</span>
            }
<span class="nc bnc" id="L1274" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3496)) {</span>
<span class="nc" id="L1275">                topLine.setColorFilter(routeColor);</span>
            }
<span class="nc bnc" id="L1277" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3497)) {</span>
<span class="nc" id="L1278">                bottomLine.setColorFilter(routeColor);</span>
            }
<span class="nc bnc" id="L1280" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3498)) {</span>
<span class="nc" id="L1281">                transitStop.setColorFilter(routeColor);</span>
            }
<span class="nc bnc" id="L1283" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3499)) {</span>
<span class="nc" id="L1284">                flagIcon.setColorFilter(routeColor);</span>
            }
<span class="nc bnc" id="L1286" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3515)) {</span>
<span class="nc bnc" id="L1287" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(3504) ? (position &gt;= 0) : (ListenerUtil.mutListener.listen(3503) ? (position &lt;= 0) : (ListenerUtil.mutListener.listen(3502) ? (position &gt; 0) : (ListenerUtil.mutListener.listen(3501) ? (position &lt; 0) : (ListenerUtil.mutListener.listen(3500) ? (position != 0) : (position == 0))))))) {</span>
<span class="nc bnc" id="L1288" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3513)) {</span>
                        // First stop in trip - hide the top half of the transit line
<span class="nc" id="L1290">                        topLine.setVisibility(View.INVISIBLE);</span>
                    }
<span class="nc bnc" id="L1292" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3514)) {</span>
<span class="nc" id="L1293">                        bottomLine.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L1295" title="All 10 branches missed.">                } else if (position == (ListenerUtil.mutListener.listen(3508) ? (mSchedule.getStopTimes().length % 1) : (ListenerUtil.mutListener.listen(3507) ? (mSchedule.getStopTimes().length / 1) : (ListenerUtil.mutListener.listen(3506) ? (mSchedule.getStopTimes().length * 1) : (ListenerUtil.mutListener.listen(3505) ? (mSchedule.getStopTimes().length + 1) : (mSchedule.getStopTimes().length - 1)))))) {</span>
<span class="nc bnc" id="L1296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3511)) {</span>
                        // Last stop in trip - hide the bottom half of the transit line
<span class="nc" id="L1298">                        topLine.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L1300" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3512)) {</span>
<span class="nc" id="L1301">                        bottomLine.setVisibility(View.INVISIBLE);</span>
                    }
                } else {
<span class="nc bnc" id="L1304" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3509)) {</span>
                        // Middle of trip - show top and bottom transit lines
<span class="nc" id="L1306">                        topLine.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L1308" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3510)) {</span>
<span class="nc" id="L1309">                        bottomLine.setVisibility(View.VISIBLE);</span>
                    }
                }
            }
<span class="nc bnc" id="L1313" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3534)) {</span>
<span class="nc bnc" id="L1314" title="All 50 branches missed.">                if ((ListenerUtil.mutListener.listen(3521) ? (mDestinationIndex != null || (ListenerUtil.mutListener.listen(3520) ? (mDestinationIndex &gt;= position) : (ListenerUtil.mutListener.listen(3519) ? (mDestinationIndex &lt;= position) : (ListenerUtil.mutListener.listen(3518) ? (mDestinationIndex &gt; position) : (ListenerUtil.mutListener.listen(3517) ? (mDestinationIndex &lt; position) : (ListenerUtil.mutListener.listen(3516) ? (mDestinationIndex != position) : (mDestinationIndex == position))))))) : (mDestinationIndex != null &amp;&amp; (ListenerUtil.mutListener.listen(3520) ? (mDestinationIndex &gt;= position) : (ListenerUtil.mutListener.listen(3519) ? (mDestinationIndex &lt;= position) : (ListenerUtil.mutListener.listen(3518) ? (mDestinationIndex &gt; position) : (ListenerUtil.mutListener.listen(3517) ? (mDestinationIndex &lt; position) : (ListenerUtil.mutListener.listen(3516) ? (mDestinationIndex != position) : (mDestinationIndex == position))))))))) {</span>
<span class="nc bnc" id="L1315" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3532)) {</span>
<span class="nc" id="L1316">                        stopIcon.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3533)) {</span>
<span class="nc" id="L1319">                        flagIcon.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L1321" title="All 50 branches missed.">                } else if ((ListenerUtil.mutListener.listen(3527) ? (mStopIndex != null || (ListenerUtil.mutListener.listen(3526) ? (mStopIndex &gt;= position) : (ListenerUtil.mutListener.listen(3525) ? (mStopIndex &lt;= position) : (ListenerUtil.mutListener.listen(3524) ? (mStopIndex &gt; position) : (ListenerUtil.mutListener.listen(3523) ? (mStopIndex &lt; position) : (ListenerUtil.mutListener.listen(3522) ? (mStopIndex != position) : (mStopIndex == position))))))) : (mStopIndex != null &amp;&amp; (ListenerUtil.mutListener.listen(3526) ? (mStopIndex &gt;= position) : (ListenerUtil.mutListener.listen(3525) ? (mStopIndex &lt;= position) : (ListenerUtil.mutListener.listen(3524) ? (mStopIndex &gt; position) : (ListenerUtil.mutListener.listen(3523) ? (mStopIndex &lt; position) : (ListenerUtil.mutListener.listen(3522) ? (mStopIndex != position) : (mStopIndex == position))))))))) {</span>
<span class="nc bnc" id="L1322" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3530)) {</span>
<span class="nc" id="L1323">                        stopIcon.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc bnc" id="L1325" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3531)) {</span>
<span class="nc" id="L1326">                        flagIcon.setVisibility(View.GONE);</span>
                    }
                } else {
<span class="nc bnc" id="L1329" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3528)) {</span>
<span class="nc" id="L1330">                        flagIcon.setVisibility(View.GONE);</span>
                    }
<span class="nc bnc" id="L1332" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3529)) {</span>
<span class="nc" id="L1333">                        stopIcon.setVisibility(View.GONE);</span>
                    }
                }
            }
<span class="nc bnc" id="L1337" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3576)) {</span>
<span class="nc bnc" id="L1338" title="All 2 branches missed.">                if (mNextStopIndex != null) {</span>
<span class="nc bnc" id="L1339" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3552)) {</span>
<span class="nc bnc" id="L1340" title="All 70 branches missed.">                        if ((ListenerUtil.mutListener.listen(3546) ? (position &gt;= (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))) : (ListenerUtil.mutListener.listen(3545) ? (position &lt;= (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))) : (ListenerUtil.mutListener.listen(3544) ? (position &gt; (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))) : (ListenerUtil.mutListener.listen(3543) ? (position &lt; (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))) : (ListenerUtil.mutListener.listen(3542) ? (position != (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))) : (position == (ListenerUtil.mutListener.listen(3541) ? (mNextStopIndex % 1) : (ListenerUtil.mutListener.listen(3540) ? (mNextStopIndex / 1) : (ListenerUtil.mutListener.listen(3539) ? (mNextStopIndex * 1) : (ListenerUtil.mutListener.listen(3538) ? (mNextStopIndex + 1) : (mNextStopIndex - 1)))))))))))) {</span>
<span class="nc bnc" id="L1341" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3548)) {</span>
                                // The bus just passed this stop - show the bus icon here
<span class="nc" id="L1343">                                bus.setVisibility(View.VISIBLE);</span>
                            }
<span class="nc bnc" id="L1345" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3551)) {</span>
<span class="nc bnc" id="L1346" title="All 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(3549) ? (mStatus != null || mStatus.isPredicted()) : (mStatus != null &amp;&amp; mStatus.isPredicted()))) {</span>
<span class="nc bnc" id="L1347" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(3550)) {</span>
                                        // Show realtime indicator
<span class="nc" id="L1349">                                        realtime.setVisibility(View.VISIBLE);</span>
                                    }
                                }
                            }
                        } else {
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3547)) {</span>
<span class="nc" id="L1355">                                bus.setVisibility(View.INVISIBLE);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L1359" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3575)) {</span>
<span class="nc bnc" id="L1360" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(3557) ? (position &gt;= mNextStopIndex) : (ListenerUtil.mutListener.listen(3556) ? (position &lt;= mNextStopIndex) : (ListenerUtil.mutListener.listen(3555) ? (position &gt; mNextStopIndex) : (ListenerUtil.mutListener.listen(3554) ? (position != mNextStopIndex) : (ListenerUtil.mutListener.listen(3553) ? (position == mNextStopIndex) : (position &lt; mNextStopIndex))))))) {</span>
<span class="nc bnc" id="L1361" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3560)) {</span>
                                // Bus passed stop - fade out views for these stops
<span class="nc" id="L1363">                                stopName.setTextColor(getResources().getColor(R.color.trip_details_passed));</span>
                            }
<span class="nc bnc" id="L1365" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3561)) {</span>
<span class="nc" id="L1366">                                time.setTextColor(getResources().getColor(R.color.trip_details_passed));</span>
                            }
                            // X percent transparency
<span class="nc bnc" id="L1369" title="All 8 branches missed.">                            int alpha = (int) ((ListenerUtil.mutListener.listen(3565) ? (.35f % 255) : (ListenerUtil.mutListener.listen(3564) ? (.35f / 255) : (ListenerUtil.mutListener.listen(3563) ? (.35f - 255) : (ListenerUtil.mutListener.listen(3562) ? (.35f + 255) : (.35f * 255))))));</span>
<span class="nc bnc" id="L1370" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3566)) {</span>
<span class="nc" id="L1371">                                occupancyView.setBackgroundResource(R.drawable.occupancy_background);</span>
                            }
<span class="nc" id="L1373">                            GradientDrawable d = (GradientDrawable) occupancyView.getBackground();</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3567)) {</span>
<span class="nc" id="L1375">                                d.setAlpha(alpha);</span>
                            }
<span class="nc bnc" id="L1377" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3574)) {</span>
                                {
<span class="nc" id="L1379">                                    long _loopCounter31 = 0;</span>
                                    // Set alpha for occupancy person icons
<span class="nc bnc" id="L1381" title="All 22 branches missed.">                                    for (int index = 0; (ListenerUtil.mutListener.listen(3573) ? (index &gt;= occupancyView.getChildCount()) : (ListenerUtil.mutListener.listen(3572) ? (index &lt;= occupancyView.getChildCount()) : (ListenerUtil.mutListener.listen(3571) ? (index &gt; occupancyView.getChildCount()) : (ListenerUtil.mutListener.listen(3570) ? (index != occupancyView.getChildCount()) : (ListenerUtil.mutListener.listen(3569) ? (index == occupancyView.getChildCount()) : (index &lt; occupancyView.getChildCount())))))); ++index) {</span>
<span class="nc" id="L1382">                                        ListenerUtil.loopListener.listen(&quot;_loopCounter31&quot;, ++_loopCounter31);</span>
<span class="nc bnc" id="L1383" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3568)) {</span>
<span class="nc" id="L1384">                                            ((ImageView) occupancyView.getChildAt(index)).setAlpha(alpha);</span>
                                        }
                                    }
                                }
                            }
<span class="nc" id="L1389">                        } else {</span>
<span class="nc bnc" id="L1390" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3558)) {</span>
                                // Bus hasn't yet passed this stop - leave full color
<span class="nc" id="L1392">                                stopName.setTextColor(getResources().getColor(R.color.trip_details_not_passed));</span>
                            }
<span class="nc bnc" id="L1394" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3559)) {</span>
<span class="nc" id="L1395">                                time.setTextColor(getResources().getColor(R.color.trip_details_not_passed));</span>
                            }
                        }
                    }
                } else {
<span class="nc bnc" id="L1400" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3535)) {</span>
                        // No &quot;next stop&quot; info - hide the bus icon
<span class="nc" id="L1402">                        bus.setVisibility(View.INVISIBLE);</span>
                    }
<span class="nc bnc" id="L1404" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3536)) {</span>
                        // Bus hasn't passed this stop - leave full color
<span class="nc" id="L1406">                        stopName.setTextColor(getResources().getColor(R.color.trip_details_not_passed));</span>
                    }
<span class="nc bnc" id="L1408" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3537)) {</span>
<span class="nc" id="L1409">                        time.setTextColor(getResources().getColor(R.color.trip_details_not_passed));</span>
                    }
                }
            }
<span class="nc" id="L1413">            return convertView;</span>
        }

        /**
         * Returns the next stop index based on real-time info, or null no estimated next stop
         * exists
         *
         * @return the next stop index based on real-time info, or null no estimated next stop
         * exists
         */
        public Integer getNextStopIndex() {
<span class="nc" id="L1424">            return mNextStopIndex;</span>
        }
    }

    private void setScroller(final ListView listView) {
<span class="nc bnc" id="L1429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3577)) {</span>
<span class="nc bnc" id="L1430" title="All 2 branches missed.">            if (mScrollMode == null) {</span>
                // Don't automatically scroll to stop or vehicle icon
<span class="nc" id="L1432">                return;</span>
            }
        }
<span class="nc bnc" id="L1435" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3601)) {</span>
<span class="nc bnc" id="L1436" title="All 3 branches missed.">            switch(mScrollMode) {</span>
                case SCROLL_MODE_VEHICLE:
                    {
                        // Scroll to bus marker if scroll mode is set to vehicle &amp; we have index.
<span class="nc" id="L1440">                        final Integer nextStop = mAdapter.getNextStopIndex();</span>
<span class="nc bnc" id="L1441" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3588)) {</span>
<span class="nc bnc" id="L1442" title="All 2 branches missed.">                            if (nextStop != null) {</span>
<span class="nc bnc" id="L1443" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3587)) {</span>
<span class="nc" id="L1444">                                    listView.post(new Runnable() {</span>

                                        @Override
                                        public void run() {
<span class="nc bnc" id="L1448" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(3586)) {</span>
<span class="nc bnc" id="L1449" title="All 8 branches missed.">                                                listView.setSelection((ListenerUtil.mutListener.listen(3585) ? (nextStop % 1) : (ListenerUtil.mutListener.listen(3584) ? (nextStop / 1) : (ListenerUtil.mutListener.listen(3583) ? (nextStop * 1) : (ListenerUtil.mutListener.listen(3582) ? (nextStop + 1) : (nextStop - 1))))));</span>
                                            }
<span class="nc" id="L1451">                                        }</span>
                                    });
                                }
                            } else {
<span class="nc bnc" id="L1455" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3578)) {</span>
                                    // If we couldn't get the bus marker, fall back to stop.
<span class="nc" id="L1457">                                    mStopIndex = findIndexForStop(mTripInfo.getSchedule().getStopTimes(), mStopId);</span>
                                }
<span class="nc bnc" id="L1459" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3581)) {</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">                                    if (mStopIndex != null) {</span>
<span class="nc bnc" id="L1461" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3580)) {</span>
<span class="nc" id="L1462">                                            listView.post(new Runnable() {</span>

                                                @Override
                                                public void run() {
<span class="nc bnc" id="L1466" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(3579)) {</span>
<span class="nc" id="L1467">                                                        listView.setSelection(mStopIndex);</span>
                                                    }
<span class="nc" id="L1469">                                                }</span>
                                            });
                                        }
                                    }
                                }
                            }
                        }
                        break;
                    }
                case SCROLL_MODE_STOP:
                    {
<span class="nc bnc" id="L1480" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3600)) {</span>
                            // Scroll to stop if we have the stopId available
<span class="nc bnc" id="L1482" title="All 2 branches missed.">                            if (mStopId != null) {</span>
<span class="nc bnc" id="L1483" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3596)) {</span>
<span class="nc" id="L1484">                                    mStopIndex = findIndexForStop(mTripInfo.getSchedule().getStopTimes(), mStopId);</span>
                                }
<span class="nc bnc" id="L1486" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3599)) {</span>
<span class="nc bnc" id="L1487" title="All 2 branches missed.">                                    if (mStopIndex != null) {</span>
<span class="nc bnc" id="L1488" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3598)) {</span>
<span class="nc" id="L1489">                                            listView.post(new Runnable() {</span>

                                                @Override
                                                public void run() {
<span class="nc bnc" id="L1493" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(3597)) {</span>
<span class="nc" id="L1494">                                                        listView.setSelection(mStopIndex);</span>
                                                    }
<span class="nc" id="L1496">                                                }</span>
                                            });
                                        }
                                    }
                                }
                            } else {
                                // If we don't have a stop, then scroll to the current position of the bus
<span class="nc" id="L1503">                                final Integer nextStop = mAdapter.getNextStopIndex();</span>
<span class="nc bnc" id="L1504" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(3595)) {</span>
<span class="nc bnc" id="L1505" title="All 2 branches missed.">                                    if (nextStop != null) {</span>
<span class="nc bnc" id="L1506" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(3594)) {</span>
<span class="nc" id="L1507">                                            listView.post(new Runnable() {</span>

                                                @Override
                                                public void run() {
<span class="nc bnc" id="L1511" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(3593)) {</span>
<span class="nc bnc" id="L1512" title="All 8 branches missed.">                                                        listView.setSelection((ListenerUtil.mutListener.listen(3592) ? (nextStop % 1) : (ListenerUtil.mutListener.listen(3591) ? (nextStop / 1) : (ListenerUtil.mutListener.listen(3590) ? (nextStop * 1) : (ListenerUtil.mutListener.listen(3589) ? (nextStop + 1) : (nextStop - 1))))));</span>
                                                    }
<span class="nc" id="L1514">                                                }</span>
                                            });
                                        }
                                    }
                                }
                            }
                        }
                        break;
                    }
            }
        }
<span class="nc bnc" id="L1525" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3602)) {</span>
<span class="nc" id="L1526">            mAdapter.notifyDataSetChanged();</span>
        }
<span class="nc" id="L1528">    }</span>

    @Override
    public void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc bnc" id="L1532" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3612)) {</span>
<span class="nc bnc" id="L1533" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(3607) ? (requestCode &gt;= REQUEST_ENABLE_LOCATION) : (ListenerUtil.mutListener.listen(3606) ? (requestCode &lt;= REQUEST_ENABLE_LOCATION) : (ListenerUtil.mutListener.listen(3605) ? (requestCode &gt; REQUEST_ENABLE_LOCATION) : (ListenerUtil.mutListener.listen(3604) ? (requestCode &lt; REQUEST_ENABLE_LOCATION) : (ListenerUtil.mutListener.listen(3603) ? (requestCode != REQUEST_ENABLE_LOCATION) : (requestCode == REQUEST_ENABLE_LOCATION))))))) {</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3611)) {</span>
<span class="nc bnc" id="L1535" title="All 3 branches missed.">                    switch(resultCode) {</span>
                        case Activity.RESULT_OK:
<span class="nc bnc" id="L1537" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3608)) {</span>
                                // All required changes were successfully made
<span class="nc" id="L1539">                                Log.d(TAG, &quot;Location enabled&quot;);</span>
                            }
<span class="nc bnc" id="L1541" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3609)) {</span>
<span class="nc" id="L1542">                                startNavigationService(getActivity().getIntent());</span>
                            }
                            break;
                        case Activity.RESULT_CANCELED:
<span class="nc bnc" id="L1546" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(3610)) {</span>
                                // The user was asked to change settings but chose not to
<span class="nc" id="L1548">                                Log.d(TAG, &quot;Location not enabled&quot;);</span>
                            }
                            break;
                        default:
                            break;
                    }
                }
            }
        }
<span class="nc" id="L1557">    }</span>

    /**
     * Starts the navigation service for destination reminders
     * @param serviceIntent
     */
    private void startNavigationService(Intent serviceIntent) {
<span class="nc bnc" id="L1564" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3620)) {</span>
<span class="nc bnc" id="L1565" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(3617) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(3616) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(3615) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(3614) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(3613) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O))))))) {</span>
<span class="nc bnc" id="L1566" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3619)) {</span>
<span class="nc" id="L1567">                    Application.get().getApplicationContext().startForegroundService(serviceIntent);</span>
                }
            } else {
<span class="nc bnc" id="L1570" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3618)) {</span>
<span class="nc" id="L1571">                    Application.get().getApplicationContext().startService(serviceIntent);</span>
                }
            }
        }
<span class="nc bnc" id="L1575" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3621)) {</span>
            // Register receiver
<span class="nc" id="L1577">            registerReceiver();</span>
        }
<span class="nc" id="L1579">    }</span>

    /**
     * Register receiver so that when trip is cancelled by user then flag will be removed from screen
     */
    private void registerReceiver() {
        // filter specifies which event Receiver should listen to
<span class="nc" id="L1586">        IntentFilter filter = new IntentFilter();</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3622)) {</span>
<span class="nc" id="L1588">            filter.addAction(ACTION_SERVICE_DESTROYED);</span>
        }
<span class="nc bnc" id="L1590" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3623)) {</span>
<span class="nc" id="L1591">            getActivity().registerReceiver(new TripEndReceiver(), filter);</span>
        }
<span class="nc" id="L1593">    }</span>

    /**
     * When user cancels trip from &quot;Notification menu&quot; then destination flag in trip details screen
     * should be removed.
     *
     * From {@link NavigationService 's} onDestroy(), we send broadcast action
     */
<span class="nc" id="L1601">    class TripEndReceiver extends BroadcastReceiver {</span>

        private static final String TAG = &quot;TripEndReceiver&quot;;

        @Override
        public void onReceive(Context context, Intent intent) {
<span class="nc bnc" id="L1607" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3629)) {</span>
<span class="nc bnc" id="L1608" title="All 2 branches missed.">                if (intent.getAction().equals(ACTION_SERVICE_DESTROYED)) {</span>
<span class="nc bnc" id="L1609" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3624)) {</span>
<span class="nc" id="L1610">                        Log.d(TAG, &quot;Action received in BroadcastReceiver, trip is destroyed&quot;);</span>
                    }
<span class="nc bnc" id="L1612" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3625)) {</span>
                        // This is used to set flagIcon on trip details screen so setting it to null
<span class="nc" id="L1614">                        mDestinationId = null;</span>
                    }
<span class="nc bnc" id="L1616" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3626)) {</span>
<span class="nc" id="L1617">                        mDestinationIndex = null;</span>
                    }
<span class="nc bnc" id="L1619" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3627)) {</span>
                        // It will call up getView() so that flag icon gets unset
<span class="nc" id="L1621">                        mAdapter.notifyDataSetChanged();</span>
                    }
<span class="nc bnc" id="L1623" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3628)) {</span>
                        // Unregister this receiver now
<span class="nc" id="L1625">                        getActivity().unregisterReceiver(this);</span>
                    }
                }
            }
<span class="nc" id="L1629">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>