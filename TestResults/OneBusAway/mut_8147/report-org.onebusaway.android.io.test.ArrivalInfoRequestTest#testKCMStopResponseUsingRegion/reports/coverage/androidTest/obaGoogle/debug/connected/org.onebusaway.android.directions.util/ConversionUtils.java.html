<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConversionUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.directions.util</a> &gt; <span class="el_source">ConversionUtils.java</span></div><h1>ConversionUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2012 University of South Florida
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *        http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and 
 * limitations under the License.
 */

package org.onebusaway.android.directions.util;

import android.content.Context;
import android.preference.PreferenceManager;
import android.text.SpannableString;
import android.text.TextUtils;
import android.text.style.ForegroundColorSpan;
import android.text.style.StrikethroughSpan;
import android.util.Log;

import org.onebusaway.android.R;
import org.onebusaway.android.util.ArrivalInfoUtils;
import org.onebusaway.android.util.PreferenceUtils;
import org.opentripplanner.api.model.Itinerary;
import org.opentripplanner.api.model.Leg;
import org.opentripplanner.routing.core.TraverseMode;

import java.text.DateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.TimeZone;


/**
 * @author Khoa Tran
 * @author Simon Jacobs - conversion for OBA. Added Imperial measurements
 */

<span class="nc" id="L49">public class ConversionUtils {</span>

    private static final String TAG = &quot;ConversionUtils&quot;;

    private static final double FEET_PER_METER = 3.281;

    /**
     * Given a date string from an OTP server, parse it into a java Date.
     *
     * @param text string from OTP
     * @return parsed date object, or null if there is an error with parsing.
     */
    public static Date parseOtpDate(String text) {
        try {
<span class="nc" id="L63">            long ms = Long.parseLong(text);</span>
<span class="nc" id="L64">            return new Date(ms);</span>
<span class="nc" id="L65">        } catch (NumberFormatException ex) {</span>
<span class="nc" id="L66">            Log.e(TAG, &quot;Error processing OTP response time text: &quot; + text);</span>
<span class="nc" id="L67">            return null;</span>
        }
    }

    /**
     * Given start time and end time strings, compute the delta between them.
     * Strings should be in the OTP server return format, specified in OTPConstants
     *
     * @param startTimeText start time
     * @param endTimeText end time
     * @param applicationContext context to look up resources
     * @return duration
     */
    public static double getDuration(String startTimeText, String endTimeText,
                                     Context applicationContext) {
<span class="nc" id="L82">        double duration = 0;</span>

<span class="nc" id="L84">        Date startTime = parseOtpDate(startTimeText);</span>
<span class="nc" id="L85">        Date endTime = parseOtpDate(endTimeText);</span>

<span class="nc bnc" id="L87" title="All 4 branches missed.">        if (startTime != null &amp;&amp; endTime != null) {</span>
<span class="nc" id="L88">            if (PreferenceManager.getDefaultSharedPreferences(applicationContext)</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">                    .getInt(OTPConstants.PREFERENCE_KEY_API_VERSION, OTPConstants.API_VERSION_V1)</span>
                    == OTPConstants.API_VERSION_V1){
<span class="nc" id="L91">                duration = (endTime.getTime() - startTime.getTime());</span>
            } else {
<span class="nc" id="L93">                duration = (endTime.getTime() - startTime.getTime()) / 1000;</span>
            }
        }
<span class="nc" id="L96">        return duration;</span>
    }

    /**
     * Return a formatted String for a distance. Should be in proper units according to
     * preferences (either metric or imperial).
     *
     * @param meters distance in meters
     * @param applicationContext context to look up resources
     * @return formatted string of distance
     */
    public static String getFormattedDistance(Double meters, Context applicationContext) {
<span class="nc" id="L108">        String text = &quot;&quot;;</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (PreferenceUtils.getUnitsAreMetricFromPreferences(applicationContext)) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            if (meters &lt; 1000) {</span>
<span class="nc" id="L112">                text += String.format(OTPConstants.FORMAT_DISTANCE_METERS, meters) + &quot; &quot; + applicationContext</span>
<span class="nc" id="L113">                        .getResources().getString(R.string.meters_abbreviation);</span>
            } else {
<span class="nc" id="L115">                meters = meters / 1000;</span>
<span class="nc" id="L116">                text += String.format(OTPConstants.FORMAT_DISTANCE_KILOMETERS, meters) + &quot; &quot;</span>
<span class="nc" id="L117">                        + applicationContext.getResources().getString(R.string.kilometers_abbreviation);</span>
            }
        } else {
<span class="nc" id="L120">            double feet = meters * 3.281;</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">            if (feet &lt; 1000) {</span>
<span class="nc" id="L122">                text += String.format(OTPConstants.FORMAT_DISTANCE_METERS, feet) + &quot; &quot; + applicationContext</span>
<span class="nc" id="L123">                        .getResources().getString(R.string.feet_abbreviation);</span>
            } else {
<span class="nc" id="L125">                feet = feet / 5280;</span>
<span class="nc" id="L126">                text += String.format(OTPConstants.FORMAT_DISTANCE_KILOMETERS, feet) + &quot; &quot;</span>
<span class="nc" id="L127">                        + applicationContext.getResources().getString(R.string.miles_abbreviation);</span>
            }
        }
<span class="nc" id="L130">        return text;</span>
    }

    /**
     * Get a formatted string for a duration.
     *
     * @param sec duration in seconds
     * @param applicationContext context to look up resources
     * @return formatted duration string
     */
    public static String getFormattedDurationText(long sec, Context applicationContext) {
<span class="nc" id="L141">        String text = &quot;&quot;;</span>
<span class="nc" id="L142">        long h = sec / 3600;</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (h &gt;= 24) {</span>
<span class="nc" id="L144">            return null;</span>
        }
<span class="nc" id="L146">        long m = (sec % 3600) / 60;</span>
<span class="nc" id="L147">        long s = (sec % 3600) % 60;</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (h &gt; 0) {</span>
<span class="nc" id="L149">            text += Long.toString(h) + applicationContext.getResources()</span>
<span class="nc" id="L150">                    .getString(R.string.hours_abbreviation);</span>
        }
<span class="nc" id="L152">        text += Long.toString(m) + applicationContext.getResources()</span>
<span class="nc" id="L153">                .getString(R.string.minutes_abbreviation);</span>
<span class="nc" id="L154">        text += Long.toString(s) + applicationContext.getResources()</span>
<span class="nc" id="L155">                .getString(R.string.seconds_abbrevation);</span>
<span class="nc" id="L156">        return text;</span>
    }

    /**
     * Get duration text but disallow &quot;seconds&quot; units.
     *
     * @param sec duration in seconds
     * @param longFormat true for long units (&quot;minutes&quot;), false for short units (&quot;min&quot;)
     * @param applicationContext context to look up resources
     * @return formatted duration text
     */
    public static String getFormattedDurationTextNoSeconds(long sec, boolean longFormat, Context applicationContext) {
<span class="nc" id="L168">        String text = &quot;&quot;;</span>
<span class="nc" id="L169">        long h = sec / 3600;</span>
<span class="nc" id="L170">        long m = (sec % 3600) / 60;</span>
<span class="nc" id="L171">        String longMinutes = applicationContext.getResources()</span>
<span class="nc" id="L172">                .getString(R.string.minutes_full);</span>
<span class="nc" id="L173">        String longMinutesSingular = applicationContext.getResources()</span>
<span class="nc" id="L174">                .getString(R.string.minutes_abbreviation);</span>
<span class="nc" id="L175">        String shortMinutes = applicationContext.getResources()</span>
<span class="nc" id="L176">                .getString(R.string.minutes_abbreviation);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (longFormat) {</span>
<span class="nc" id="L178">            longMinutes = applicationContext.getResources()</span>
<span class="nc" id="L179">                    .getString(R.string.minutes_full);</span>
<span class="nc" id="L180">            longMinutesSingular = applicationContext.getResources()</span>
<span class="nc" id="L181">                    .getString(R.string.minute_singular);</span>
        }
<span class="nc" id="L183">        String shortHours = applicationContext.getResources()</span>
<span class="nc" id="L184">                .getString(R.string.hours_abbreviation);</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (h &gt; 0) {</span>
<span class="nc" id="L186">            text += Long.toString(h) + shortHours;</span>
<span class="nc" id="L187">            text += &quot; &quot; + Long.toString(m) + shortMinutes;</span>
        } else {
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (m == 0) {</span>
<span class="nc" id="L190">                text += &quot;&lt; 1 &quot; + longMinutes;</span>
<span class="nc bnc" id="L191" title="All 4 branches missed.">            } else if (m == 1 || m == -1) {</span>
<span class="nc" id="L192">                text += Long.toString(m) + &quot; &quot; + longMinutesSingular;</span>
            } else {
<span class="nc" id="L194">                text += Long.toString(m) + &quot; &quot; + longMinutes;</span>
            }
        }
<span class="nc" id="L197">        return text;</span>
    }

    public static List&lt;Itinerary&gt; fixTimezoneOffsets(List&lt;Itinerary&gt; itineraries,
                                                     boolean useDeviceTimezone) {
<span class="nc" id="L202">        int agencyTimeZoneOffset = 0;</span>
<span class="nc" id="L203">        boolean containsTransitLegs = false;</span>

<span class="nc bnc" id="L205" title="All 4 branches missed.">        if ((itineraries != null) &amp;&amp; !itineraries.isEmpty()) {</span>
<span class="nc" id="L206">            ArrayList&lt;Itinerary&gt; itinerariesFixed = new ArrayList&lt;Itinerary&gt;(itineraries);</span>

<span class="nc bnc" id="L208" title="All 2 branches missed.">            for (Itinerary it : itinerariesFixed) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                for (Leg leg : it.legs) {</span>
<span class="nc bnc" id="L210" title="All 4 branches missed.">                    if ((TraverseMode.valueOf((String) leg.mode)).isTransit()</span>
                            &amp;&amp; !containsTransitLegs) {
<span class="nc" id="L212">                        containsTransitLegs = true;</span>
                    }
<span class="nc bnc" id="L214" title="All 2 branches missed.">                    if (leg.agencyTimeZoneOffset != 0) {</span>
<span class="nc" id="L215">                        agencyTimeZoneOffset = leg.agencyTimeZoneOffset;</span>
                        //If agencyTimeZoneOffset is different from 0, route contains transit legs
<span class="nc" id="L217">                        containsTransitLegs = true;</span>
<span class="nc" id="L218">                        break;</span>
                    }
<span class="nc" id="L220">                }</span>
<span class="nc" id="L221">            }</span>

<span class="nc bnc" id="L223" title="All 4 branches missed.">            if (useDeviceTimezone || !containsTransitLegs) {</span>
<span class="nc" id="L224">                agencyTimeZoneOffset = TimeZone.getDefault()</span>
<span class="nc" id="L225">                        .getOffset(Long.parseLong(itinerariesFixed.get(0).startTime));</span>
            }

<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (agencyTimeZoneOffset != 0) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                for (Itinerary it : itinerariesFixed) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                    for (Leg leg : it.legs) {</span>
<span class="nc" id="L231">                        leg.agencyTimeZoneOffset = agencyTimeZoneOffset;</span>
<span class="nc" id="L232">                    }</span>
<span class="nc" id="L233">                }</span>
            }

<span class="nc" id="L236">            return itinerariesFixed;</span>
        } else {
<span class="nc" id="L238">            return itineraries;</span>
        }
    }

    public static CharSequence getTimeWithContext(Context applicationContext, int offsetGMT, long time,
                                                  boolean inLine) {
<span class="nc" id="L244">        return getTimeWithContext(applicationContext, offsetGMT, time, inLine, -1);</span>
    }

    public static CharSequence getTimeWithContext(Context applicationContext, int offsetGMT, long time,
                                                  boolean inLine, int color) {
<span class="nc" id="L249">        Calendar cal = Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L250">        DateFormat timeFormat = android.text.format.DateFormat.getTimeFormat(applicationContext);</span>
<span class="nc" id="L251">        DateFormat dateFormat = android.text.format.DateFormat.getDateFormat(applicationContext);</span>
<span class="nc" id="L252">        timeFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L253">        dateFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>

<span class="nc" id="L255">        cal.setTimeInMillis(time);</span>

<span class="nc" id="L257">        String noDeviceTimezoneNote = &quot;&quot;;</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (offsetGMT != TimeZone.getDefault().getOffset(time)) {</span>
<span class="nc" id="L259">            noDeviceTimezoneNote = &quot;GMT&quot;;</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (offsetGMT != 0) {</span>
<span class="nc" id="L261">                noDeviceTimezoneNote += offsetGMT / 3600000;</span>
            }
        }

<span class="nc" id="L265">        cal.add(Calendar.MILLISECOND, offsetGMT);</span>

<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (cal.get(Calendar.SECOND) &gt;= 30) {</span>
<span class="nc" id="L268">            cal.add(Calendar.MINUTE, 1);</span>
        }

<span class="nc" id="L271">        SpannableString spannableTime = new SpannableString(timeFormat.format(cal.getTime()));</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (color != -1) {</span>
<span class="nc" id="L273">            spannableTime.setSpan(new ForegroundColorSpan(color), 0,</span>
<span class="nc" id="L274">                    spannableTime.length(), 0);</span>
        }

<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (inLine) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">            if (ConversionUtils.isToday(cal)) {</span>
<span class="nc" id="L279">                return TextUtils.concat(&quot; &quot;,</span>
                        applicationContext
<span class="nc" id="L281">                                .getResources()</span>
<span class="nc" id="L282">                                .getString(R.string.time_connector_before_time), &quot; &quot;, spannableTime,</span>
                        &quot; &quot;, noDeviceTimezoneNote);
<span class="nc bnc" id="L284" title="All 2 branches missed.">            } else if (ConversionUtils.isTomorrow(cal)) {</span>
<span class="nc" id="L285">                return TextUtils.concat(&quot; &quot;,</span>
                        applicationContext
<span class="nc" id="L287">                                .getResources()</span>
<span class="nc" id="L288">                                .getString(R.string.time_connector_next_day), &quot; &quot;,</span>
<span class="nc" id="L289">                        applicationContext.getResources()</span>
<span class="nc" id="L290">                                .getString(R.string.time_connector_before_time), &quot; &quot;, spannableTime,</span>
                        &quot; &quot;, noDeviceTimezoneNote);
            } else {
<span class="nc" id="L293">                return TextUtils.concat(&quot; &quot;, applicationContext</span>
<span class="nc" id="L294">                                .getResources()</span>
<span class="nc" id="L295">                                .getString(R.string.time_connector_before_date), &quot; &quot;,</span>
<span class="nc" id="L296">                        dateFormat.format(cal.getTime()), &quot; &quot;,</span>
<span class="nc" id="L297">                        applicationContext.getResources()</span>
<span class="nc" id="L298">                                .getString(R.string.time_connector_before_time), &quot; &quot;, spannableTime,</span>
                        &quot; &quot;, noDeviceTimezoneNote);
            }
        } else {
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (ConversionUtils.isToday(cal)) {</span>
<span class="nc" id="L303">                return TextUtils.concat(spannableTime, &quot; &quot;, noDeviceTimezoneNote);</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">            } else if (ConversionUtils.isTomorrow(cal)) {</span>
<span class="nc" id="L305">                return TextUtils.concat(&quot; &quot;, spannableTime, &quot;, &quot;,</span>
                        applicationContext
<span class="nc" id="L307">                                .getResources()</span>
<span class="nc" id="L308">                                .getString(R.string.time_connector_next_day), &quot; &quot;,</span>
                        noDeviceTimezoneNote);
            } else {
<span class="nc" id="L311">                return TextUtils.concat(spannableTime, &quot;, &quot;, dateFormat.format(cal.getTime()), &quot; &quot;,</span>
                        noDeviceTimezoneNote);
            }
        }
    }

    public static CharSequence getTimeUpdated(Context applicationContext, int offsetGMT, long oldTime,
                                              long newTime) {
<span class="nc" id="L319">        Calendar calOldTime = Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L320">        Calendar calNewTime = Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L321">        DateFormat timeFormat = android.text.format.DateFormat.getTimeFormat(applicationContext);</span>
<span class="nc" id="L322">        DateFormat dateFormat = android.text.format.DateFormat.getDateFormat(applicationContext);</span>
<span class="nc" id="L323">        timeFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L324">        dateFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
        CharSequence timeUpdatedString;
<span class="nc" id="L326">        CharSequence beforeDateString = &quot;&quot;, beforeTimeString = &quot;&quot;, newDateString = &quot;&quot;, timezone = &quot;&quot;;</span>
        SpannableString oldTimeString, oldDateString, newTimeString;
<span class="nc" id="L328">        calOldTime.setTimeInMillis(oldTime);</span>
<span class="nc" id="L329">        calNewTime.setTimeInMillis(newTime);</span>

<span class="nc" id="L331">        String noDeviceTimezoneNote = &quot;&quot;;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">        if (offsetGMT != TimeZone.getDefault().getOffset(oldTime)) {</span>
<span class="nc" id="L333">            noDeviceTimezoneNote = &quot;GMT&quot;;</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">            if (offsetGMT != 0) {</span>
<span class="nc" id="L335">                noDeviceTimezoneNote += offsetGMT / 3600000;</span>
            }
        }

<span class="nc" id="L339">        calOldTime.add(Calendar.MILLISECOND, offsetGMT);</span>
<span class="nc" id="L340">        calNewTime.add(Calendar.MILLISECOND, offsetGMT);</span>

<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (ConversionUtils.isTomorrow(calNewTime)) {</span>
<span class="nc" id="L343">            oldDateString = new SpannableString(applicationContext.getResources()</span>
<span class="nc" id="L344">                    .getString(R.string.time_connector_next_day) + &quot; &quot;);</span>
        } else {
<span class="nc" id="L346">            beforeDateString = applicationContext.getResources()</span>
<span class="nc" id="L347">                    .getString(R.string.time_connector_before_date) + &quot; &quot;;</span>
<span class="nc" id="L348">            oldDateString = new SpannableString(dateFormat.format(calNewTime.getTime()) + &quot; &quot;);</span>
        }

<span class="nc bnc" id="L351" title="All 2 branches missed.">        if (calNewTime.get(Calendar.DAY_OF_MONTH) != calOldTime.get(Calendar.DAY_OF_MONTH)) {</span>
<span class="nc" id="L352">            beforeDateString = applicationContext.getResources()</span>
<span class="nc" id="L353">                    .getString(R.string.time_connector_before_date) + &quot; &quot;;</span>
<span class="nc" id="L354">            newDateString = dateFormat.format(calNewTime.getTime()) + &quot; &quot;;</span>
<span class="nc" id="L355">            oldDateString.setSpan(new StrikethroughSpan(), 0, oldDateString.length() - 1, 0);</span>
        }

<span class="nc" id="L358">        beforeTimeString = applicationContext.getResources()</span>
<span class="nc" id="L359">                .getString(R.string.time_connector_before_time) + &quot; &quot;;</span>
<span class="nc" id="L360">        timezone = noDeviceTimezoneNote;</span>

<span class="nc" id="L362">        int color = applicationContext.getResources().getColor(</span>
<span class="nc" id="L363">                ArrivalInfoUtils.computeColorFromDeviation(</span>
<span class="nc" id="L364">                        calNewTime.getTimeInMillis() - calOldTime.getTimeInMillis()));</span>

<span class="nc" id="L366">        newTimeString = new SpannableString(timeFormat.format(calNewTime.getTime()) + &quot; &quot;);</span>
<span class="nc" id="L367">        newTimeString.setSpan(new ForegroundColorSpan(color), 0, newTimeString.length(), 0);</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (calOldTime.get(Calendar.HOUR_OF_DAY) != calNewTime.get(Calendar.HOUR_OF_DAY)</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                || calOldTime.get(Calendar.MINUTE) != calNewTime.get(Calendar.MINUTE)) {</span>
<span class="nc" id="L370">            oldTimeString = new SpannableString(timeFormat.format(calOldTime.getTime()) + &quot; &quot;);</span>
<span class="nc" id="L371">            oldTimeString.setSpan(new StrikethroughSpan(), 0, oldTimeString.length() - 1, 0);</span>
        } else {
<span class="nc" id="L373">            oldTimeString = new SpannableString(&quot; &quot;);</span>
        }
<span class="nc" id="L375">        timeUpdatedString = TextUtils.concat(beforeDateString, newDateString, oldDateString,</span>
                beforeTimeString, oldTimeString, newTimeString, timezone);
<span class="nc" id="L377">        return timeUpdatedString;</span>
    }

    public static boolean isToday(Calendar cal) {
<span class="nc" id="L381">        Calendar actualTime = Calendar.getInstance();</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">        return (actualTime.get(Calendar.ERA) == cal.get(Calendar.ERA) &amp;&amp;</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">                actualTime.get(Calendar.YEAR) == cal.get(Calendar.YEAR) &amp;&amp;</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                actualTime.get(Calendar.DAY_OF_YEAR) == cal.get(Calendar.DAY_OF_YEAR));</span>
    }

    public static boolean isTomorrow(Calendar cal) {
<span class="nc" id="L388">        Calendar tomorrowTime = Calendar.getInstance();</span>
<span class="nc" id="L389">        tomorrowTime.add(Calendar.DAY_OF_YEAR, 1);</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">        return (tomorrowTime.get(Calendar.ERA) == cal.get(Calendar.ERA) &amp;&amp;</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                tomorrowTime.get(Calendar.YEAR) == cal.get(Calendar.YEAR) &amp;&amp;</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">                tomorrowTime.get(Calendar.DAY_OF_YEAR) == cal.get(Calendar.DAY_OF_YEAR));</span>
    }

    /**
     * Shows only the last n words of a sentence, being n the number of words to make the longer
     * sentence that still is smaller than maxLength.
     *
     * @param sentence  phrase to shrink
     * @param maxLength max length of the new sentence
     * @return the reduced sentence
     */
    public static String tailAndTruncateSentence(String sentence, int maxLength) {
<span class="nc" id="L404">        String[] words = sentence.split(&quot; &quot;);</span>
<span class="nc" id="L405">        List&lt;String&gt; list = Arrays.asList(words);</span>
<span class="nc" id="L406">        Collections.reverse(list);</span>
<span class="nc" id="L407">        String[] reversedWords = (String[]) list.toArray();</span>

<span class="nc" id="L409">        String modifiedSentence = &quot;&quot;;</span>

<span class="nc bnc" id="L411" title="All 2 branches missed.">        for (String word : reversedWords) {</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">            if (modifiedSentence.length() &gt;= maxLength) {</span>
<span class="nc" id="L413">                return modifiedSentence;</span>
            }
<span class="nc" id="L415">            modifiedSentence = word + &quot; &quot; + modifiedSentence;</span>
        }
<span class="nc" id="L417">        return modifiedSentence;</span>
    }

    /**
     * Always creates a correct value for the short name of the route. Using the routeShortName,
     * processing the long name if the short is null or returning an empty string if both names are
     * null.
     *
     * Route short name will be preceded by adequate connector.
     *
     * @param routeLongName  to convert it to a route short name if necessary
     * @param routeShortName to be returned if is not null
     * @return a valid route short name
     */
    public static String getRouteShortNameSafe(String routeShortName, String routeLongName, Context context) {
<span class="nc" id="L432">        String routeName = &quot;&quot;;</span>

<span class="nc bnc" id="L434" title="All 4 branches missed.">        if (routeShortName != null || routeLongName != null) {</span>
<span class="nc" id="L435">            routeName += context.getResources()</span>
<span class="nc" id="L436">                    .getString(R.string.connector_before_route);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">            if (routeShortName != null) {</span>
<span class="nc" id="L438">                routeName += &quot; &quot; + routeShortName;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">            } else if (routeLongName != null) {</span>
<span class="nc" id="L440">                routeName += &quot; &quot; + tailAndTruncateSentence(routeLongName, OTPConstants.ROUTE_SHORT_NAME_MAX_SIZE);</span>
            }
        }
<span class="nc" id="L443">        return routeName;</span>
    }

    /**
     * Always creates a correct value for the long name of the route. Using the routeLongName,
     * returning the short name if the long is null or returning an empty string if both names are
     * null.
     *
     * @param routeLongName  to be returned if is not null
     * @param routeShortName to use if necessary
     * @return a valid route long name
     */
    public static String getRouteLongNameSafe(String routeLongName, String routeShortName,
                                              boolean includeShortName) {
<span class="nc" id="L457">        String routeName = &quot;&quot;;</span>

<span class="nc bnc" id="L459" title="All 4 branches missed.">        if (routeShortName != null || routeLongName != null) {</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">            if (routeLongName != null) {</span>
<span class="nc bnc" id="L461" title="All 4 branches missed.">                if (includeShortName &amp;&amp; routeShortName != null) {</span>
<span class="nc" id="L462">                    routeName = routeShortName + &quot; &quot; + &quot;(&quot; + routeLongName + &quot;)&quot;;</span>
                } else {
<span class="nc" id="L464">                    routeName += routeLongName;</span>
                }
<span class="nc bnc" id="L466" title="All 2 branches missed.">            } else if (routeShortName != null) {</span>
<span class="nc" id="L467">                routeName += routeShortName;</span>
            }
        }
<span class="nc" id="L470">        return routeName;</span>
    }

    /**
     * Convert meters to feet.
     *
     * @param meters
     * @return feet
     */
    public static double metersToFeet(double meters) {
<span class="nc" id="L480">        return meters * FEET_PER_METER;</span>
    }

    /**
     * Convert feet to meters.
     *
     * @param feet
     * @return meters
     */
    public static double feetToMeters(double feet) {
<span class="nc" id="L490">        return feet / FEET_PER_METER;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>