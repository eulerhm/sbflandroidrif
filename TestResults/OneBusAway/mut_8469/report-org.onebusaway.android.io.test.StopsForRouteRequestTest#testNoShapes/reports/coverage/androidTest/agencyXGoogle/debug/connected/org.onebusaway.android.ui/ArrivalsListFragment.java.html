<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArrivalsListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">ArrivalsListFragment.java</span></div><h1>ArrivalsListFragment.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012-2017 Paul Watts (paulcwatts@gmail.com),
 * University of South Florida,
 * Benjamin Du (bendu@me.com),
 * Microsoft Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.Dialog;
import android.content.ContentQueryMap;
import android.content.ContentResolver;
import android.content.ContentValues;
import android.content.Context;
import android.content.DialogInterface;
import android.content.DialogInterface.OnMultiChoiceClickListener;
import android.content.Intent;
import android.database.Cursor;
import android.location.Location;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.text.TextUtils;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ListAdapter;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.util.Pair;
import androidx.fragment.app.DialogFragment;
import androidx.loader.app.LoaderManager;
import androidx.loader.content.CursorLoader;
import androidx.loader.content.Loader;
import com.google.firebase.analytics.FirebaseAnalytics;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.io.ObaApi;
import org.onebusaway.android.io.elements.ObaArrivalInfo;
import org.onebusaway.android.io.elements.ObaReferences;
import org.onebusaway.android.io.elements.ObaRoute;
import org.onebusaway.android.io.elements.ObaSituation;
import org.onebusaway.android.io.elements.ObaStop;
import org.onebusaway.android.io.elements.ObaTrip;
import org.onebusaway.android.io.elements.Occupancy;
import org.onebusaway.android.io.elements.OccupancyState;
import org.onebusaway.android.io.request.ObaArrivalInfoResponse;
import org.onebusaway.android.map.MapParams;
import org.onebusaway.android.provider.ObaContract;
import org.onebusaway.android.report.ui.InfrastructureIssueActivity;
import org.onebusaway.android.travelbehavior.TravelBehaviorManager;
import org.onebusaway.android.util.ArrayAdapterWithIcon;
import org.onebusaway.android.util.ArrivalInfoUtils;
import org.onebusaway.android.util.BuildFlavorUtils;
import org.onebusaway.android.util.DBUtil;
import org.onebusaway.android.util.FragmentUtils;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.PreferenceUtils;
import org.onebusaway.android.util.ShowcaseViewUtils;
import org.onebusaway.android.util.UIUtils;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

// 
<span class="nc" id="L91">public class ArrivalsListFragment extends ListFragment implements LoaderManager.LoaderCallbacks&lt;ObaArrivalInfoResponse&gt;, ArrivalsListHeader.Controller {</span>

    private static final String TAG = &quot;ArrivalsListFragment&quot;;

    public static final String STOP_NAME = &quot;.StopName&quot;;

    public static final String STOP_CODE = &quot;.StopCode&quot;;

    public static final String STOP_DIRECTION = &quot;.StopDir&quot;;

    /**
     * Comma-delimited set of routes that serve this stop
     * See {@link UIUtils#serializeRouteDisplayNames(ObaStop,
     * HashMap)}
     */
    public static final String STOP_ROUTES = &quot;.StopRoutes&quot;;

    public static final String STOP_LAT = &quot;.StopLatitude&quot;;

    public static final String STOP_LON = &quot;.StopLongitude&quot;;

    /**
     * If set to true, the fragment is using a header external to this layout, and shouldn't
     * instantiate its own header view
     */
    public static final String EXTERNAL_HEADER = &quot;.ExternalHeader&quot;;

    private static final long RefreshPeriod = 60 * 1000;

<span class="nc" id="L120">    private static int TRIPS_FOR_STOP_LOADER = 1;</span>

<span class="nc" id="L122">    private static int ARRIVALS_LIST_LOADER = 2;</span>

    private ArrivalsListAdapterBase mAdapter;

    private ArrivalsListHeader mHeader;

    private View mHeaderView;

    private View mFooter;

    private View mEmptyList;

    private AlertList mAlertList;

    private ObaStop mStop;

    private String mStopId;

    private Uri mStopUri;

    private ObaReferences mObaReferences;

    // The list of route_ids that should have their arrival info and alerts displayed. (All if empty or null)
    private ArrayList&lt;String&gt; mRoutesFilter;

    // Keep copy locally, since loader overwrites
<span class="nc" id="L148">    private int mLastResponseLength = -1;</span>

    // encapsulated info before onLoadFinished() is called
<span class="nc" id="L151">    private boolean mLoadedMoreArrivals = false;</span>

<span class="nc" id="L153">    private boolean mFavorite = false;</span>

    private String mStopUserName;

    private TripsForStopCallback mTripsForStopCallback;

    // The list of situation alerts
    private ArrayList&lt;SituationAlert&gt; mSituationAlerts;

    // Set to true if we're using an external header not in this layout (e.g., if this fragment is in a sliding panel)
<span class="nc" id="L163">    private boolean mExternalHeader = false;</span>

    private Listener mListener;

    ObaArrivalInfo[] mArrivalInfo;

    private FirebaseAnalytics mFirebaseAnalytics;

    public interface Listener {

        /**
         * Called when the ListView has been created
         *
         * @param listView the ListView that was just created
         */
        void onListViewCreated(ListView listView);

        /**
         * Called when new arrival times have been retrieved
         *
         * @param response new arrival information
         */
        void onArrivalTimesUpdated(final ObaArrivalInfoResponse response);

        /**
         * Called when the user selects the &quot;Show route on map&quot; for a particular route/trip
         *
         * @param arrivalInfo The arrival information for the route/trip that the user selected
         * @return true if the listener has consumed the event, false otherwise
         */
        boolean onShowRouteOnMapSelected(ArrivalInfo arrivalInfo);

        /**
         * Called when the user selects the &quot;Sort by&quot; option
         */
        void onSortBySelected();
    }

    /**
     * Builds an intent used to set the stop for the ArrivalListFragment directly
     * (i.e., when ArrivalsListActivity is not used)
     */
    public static class IntentBuilder {

        private Intent mIntent;

<span class="nc" id="L209">        public IntentBuilder(Context context, String stopId) {</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(191)) {</span>
<span class="nc" id="L211">                mIntent = new Intent(context, ArrivalsListFragment.class);</span>
            }
<span class="nc bnc" id="L213" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(192)) {</span>
<span class="nc" id="L214">                mIntent.setData(Uri.withAppendedPath(ObaContract.Stops.CONTENT_URI, stopId));</span>
            }
<span class="nc" id="L216">        }</span>

        /**
         * @param stop   ObaStop to be set
         * @param routes a HashMap of all route display names that may serve this stop - key is
         *               routeId
         */
<span class="nc" id="L223">        public IntentBuilder(Context context, ObaStop stop, HashMap&lt;String, ObaRoute&gt; routes) {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(193)) {</span>
<span class="nc" id="L225">                mIntent = new Intent(context, ArrivalsListFragment.class);</span>
            }
<span class="nc bnc" id="L227" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(194)) {</span>
<span class="nc" id="L228">                mIntent.setData(Uri.withAppendedPath(ObaContract.Stops.CONTENT_URI, stop.getId()));</span>
            }
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(195)) {</span>
<span class="nc" id="L231">                setStopName(stop.getName());</span>
            }
<span class="nc bnc" id="L233" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(196)) {</span>
<span class="nc" id="L234">                setStopCode(stop.getStopCode());</span>
            }
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(197)) {</span>
<span class="nc" id="L237">                setStopDirection(stop.getDirection());</span>
            }
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(198)) {</span>
<span class="nc" id="L240">                setStopRoutes(UIUtils.serializeRouteDisplayNames(stop, routes));</span>
            }
<span class="nc bnc" id="L242" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(199)) {</span>
<span class="nc" id="L243">                setStopLocation(stop.getLocation());</span>
            }
<span class="nc" id="L245">        }</span>

        public IntentBuilder setStopName(String stopName) {
<span class="nc bnc" id="L248" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(200)) {</span>
<span class="nc" id="L249">                mIntent.putExtra(ArrivalsListFragment.STOP_NAME, stopName);</span>
            }
<span class="nc" id="L251">            return this;</span>
        }

        public IntentBuilder setStopCode(String stopCode) {
<span class="nc bnc" id="L255" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(201)) {</span>
<span class="nc" id="L256">                mIntent.putExtra(ArrivalsListFragment.STOP_CODE, stopCode);</span>
            }
<span class="nc" id="L258">            return this;</span>
        }

        public IntentBuilder setStopDirection(String stopDir) {
<span class="nc bnc" id="L262" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(202)) {</span>
<span class="nc" id="L263">                mIntent.putExtra(ArrivalsListFragment.STOP_DIRECTION, stopDir);</span>
            }
<span class="nc" id="L265">            return this;</span>
        }

        public IntentBuilder setStopLocation(Location stopLocation) {
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(203)) {</span>
<span class="nc" id="L270">                mIntent.putExtra(ArrivalsListFragment.STOP_LAT, stopLocation.getLatitude());</span>
            }
<span class="nc bnc" id="L272" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(204)) {</span>
<span class="nc" id="L273">                mIntent.putExtra(ArrivalsListFragment.STOP_LON, stopLocation.getLongitude());</span>
            }
<span class="nc" id="L275">            return this;</span>
        }

        /**
         * Sets the routes that serve this stop via a comma-delimited set of route display names
         * &lt;p/&gt;
         * See {@link UIUtils#serializeRouteDisplayNames(ObaStop,
         * HashMap)}
         *
         * @param routes comma-delimited list of route display names that serve this stop
         */
        public IntentBuilder setStopRoutes(String routes) {
<span class="nc bnc" id="L287" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(205)) {</span>
<span class="nc" id="L288">                mIntent.putExtra(ArrivalsListFragment.STOP_ROUTES, routes);</span>
            }
<span class="nc" id="L290">            return this;</span>
        }

        public Intent build() {
<span class="nc" id="L294">            return mIntent;</span>
        }
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup root, Bundle savedInstanceState) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(206)) {</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">            if (root == null) {</span>
                // reason to create our view.
<span class="nc" id="L303">                return null;</span>
            }
        }
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(207)) {</span>
<span class="nc" id="L307">            mFirebaseAnalytics = FirebaseAnalytics.getInstance(getContext());</span>
        }
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(208)) {</span>
<span class="nc" id="L310">            initArrivalInfoViews(inflater);</span>
        }
<span class="nc" id="L312">        return inflater.inflate(R.layout.fragment_arrivals_list, null);</span>
    }

    @Override
    public void onViewStateRestored(@Nullable Bundle savedInstanceState) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(209)) {</span>
<span class="nc" id="L318">            super.onViewStateRestored(savedInstanceState);</span>
        }
        // their phone while setting a route favorite - see #480
<span class="nc" id="L321">        RouteFavoriteDialogFragment dialogFragment = (RouteFavoriteDialogFragment) getFragmentManager().findFragmentByTag(RouteFavoriteDialogFragment.TAG);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(211)) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">            if (dialogFragment != null) {</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(210)) {</span>
<span class="nc" id="L325">                    setCallbackToDialogFragment(dialogFragment);</span>
                }
            }
        }
<span class="nc" id="L329">    }</span>

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(212)) {</span>
<span class="nc" id="L334">            super.onActivityCreated(savedInstanceState);</span>
        }
<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(213)) {</span>
            // Set the list view properties for Style B
<span class="nc" id="L338">            setListViewProperties(BuildFlavorUtils.getArrivalInfoStyleFromPreferences());</span>
        }
<span class="nc bnc" id="L340" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(214)) {</span>
            // We have a menu item to show in action bar.
<span class="nc" id="L342">            setHasOptionsMenu(true);</span>
        }
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(215)) {</span>
<span class="nc" id="L345">            mAlertList = new AlertList(getActivity());</span>
        }
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(216)) {</span>
<span class="nc" id="L348">            mAlertList.initView(getView().findViewById(R.id.arrivals_alert_list));</span>
        }
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(217)) {</span>
<span class="nc" id="L351">            setupHeader(savedInstanceState);</span>
        }
<span class="nc bnc" id="L353" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(218)) {</span>
<span class="nc" id="L354">            setupFooter();</span>
        }
<span class="nc bnc" id="L356" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(219)) {</span>
<span class="nc" id="L357">            setupEmptyList(null);</span>
        }
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(220)) {</span>
            // This sets the stopId and uri
<span class="nc" id="L361">            setStopId();</span>
        }
<span class="nc bnc" id="L363" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(221)) {</span>
<span class="nc" id="L364">            setUserInfo();</span>
        }
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(222)) {</span>
            // Create an empty adapter we will use to display the loaded data
<span class="nc" id="L368">            instantiateAdapter(BuildFlavorUtils.getArrivalInfoStyleFromPreferences());</span>
        }
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(223)) {</span>
            // Start out with a progress indicator.
<span class="nc" id="L372">            setListShown(false);</span>
        }
<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(224)) {</span>
<span class="nc" id="L375">            mRoutesFilter = ObaContract.StopRouteFilters.get(getActivity(), mStopId);</span>
        }
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(225)) {</span>
<span class="nc" id="L378">            mTripsForStopCallback = new TripsForStopCallback();</span>
        }
        // LoaderManager.enableDebugLogging(true);
<span class="nc" id="L381">        LoaderManager mgr = getLoaderManager();</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(226)) {</span>
<span class="nc" id="L383">            mgr.initLoader(TRIPS_FOR_STOP_LOADER, null, mTripsForStopCallback);</span>
        }
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(227)) {</span>
<span class="nc" id="L386">            mgr.initLoader(ARRIVALS_LIST_LOADER, getArguments(), this);</span>
        }
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(228)) {</span>
            // Set initial minutesAfter value in the empty list view
<span class="nc" id="L390">            setEmptyText(UIUtils.getNoArrivalsMessage(getActivity(), getArrivalsLoader().getMinutesAfter(), false, false));</span>
        }
<span class="nc" id="L392">    }</span>

    @Override
    public void onSaveInstanceState(Bundle outState) {
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(229)) {</span>
<span class="nc" id="L397">            super.onSaveInstanceState(outState);</span>
        }
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(230)) {</span>
<span class="nc" id="L400">            outState.putBoolean(EXTERNAL_HEADER, mExternalHeader);</span>
        }
<span class="nc" id="L402">    }</span>

    @Override
    public void onPause() {
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(231)) {</span>
<span class="nc" id="L407">            mRefreshHandler.removeCallbacks(mRefresh);</span>
        }
<span class="nc bnc" id="L409" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(233)) {</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(232)) {</span>
<span class="nc" id="L412">                    mHeader.onPause();</span>
                }
            }
        }
<span class="nc bnc" id="L416" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(234)) {</span>
<span class="nc" id="L417">            super.onPause();</span>
        }
<span class="nc" id="L419">    }</span>

    @Override
    public void onResume() {
<span class="nc bnc" id="L423" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(235)) {</span>
            // after the Fragment was initialized
<span class="nc" id="L425">            checkAdapterStylePreference();</span>
        }
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(237)) {</span>
            // Notify listener that ListView is now created
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(236)) {</span>
<span class="nc" id="L431">                    mListener.onListViewCreated(getListView());</span>
                }
            }
        }
        // Try to show any old data just in case we're coming out of sleep
<span class="nc" id="L436">        ArrivalsListLoader loader = getArrivalsLoader();</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(240)) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            if (loader != null) {</span>
<span class="nc" id="L439">                ObaArrivalInfoResponse lastGood = loader.getLastGoodResponse();</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(239)) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                    if (lastGood != null) {</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(238)) {</span>
<span class="nc" id="L443">                            setResponseData(lastGood.getArrivalInfo(), UIUtils.getAllSituations(lastGood, mRoutesFilter), lastGood.getRefs());</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L449" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(241)) {</span>
<span class="nc" id="L450">            getLoaderManager().restartLoader(TRIPS_FOR_STOP_LOADER, null, mTripsForStopCallback);</span>
        }
        // If our timer would have gone off, then refresh.
<span class="nc" id="L453">        long lastResponseTime = getArrivalsLoader().getLastResponseTime();</span>
<span class="nc bnc" id="L454" title="All 48 branches missed.">        long newPeriod = Math.min(RefreshPeriod, (ListenerUtil.mutListener.listen(249) ? (((ListenerUtil.mutListener.listen(245) ? (lastResponseTime % RefreshPeriod) : (ListenerUtil.mutListener.listen(244) ? (lastResponseTime / RefreshPeriod) : (ListenerUtil.mutListener.listen(243) ? (lastResponseTime * RefreshPeriod) : (ListenerUtil.mutListener.listen(242) ? (lastResponseTime - RefreshPeriod) : (lastResponseTime + RefreshPeriod)))))) % System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(248) ? (((ListenerUtil.mutListener.listen(245) ? (lastResponseTime % RefreshPeriod) : (ListenerUtil.mutListener.listen(244) ? (lastResponseTime / RefreshPeriod) : (ListenerUtil.mutListener.listen(243) ? (lastResponseTime * RefreshPeriod) : (ListenerUtil.mutListener.listen(242) ? (lastResponseTime - RefreshPeriod) : (lastResponseTime + RefreshPeriod)))))) / System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(247) ? (((ListenerUtil.mutListener.listen(245) ? (lastResponseTime % RefreshPeriod) : (ListenerUtil.mutListener.listen(244) ? (lastResponseTime / RefreshPeriod) : (ListenerUtil.mutListener.listen(243) ? (lastResponseTime * RefreshPeriod) : (ListenerUtil.mutListener.listen(242) ? (lastResponseTime - RefreshPeriod) : (lastResponseTime + RefreshPeriod)))))) * System.currentTimeMillis()) : (ListenerUtil.mutListener.listen(246) ? (((ListenerUtil.mutListener.listen(245) ? (lastResponseTime % RefreshPeriod) : (ListenerUtil.mutListener.listen(244) ? (lastResponseTime / RefreshPeriod) : (ListenerUtil.mutListener.listen(243) ? (lastResponseTime * RefreshPeriod) : (ListenerUtil.mutListener.listen(242) ? (lastResponseTime - RefreshPeriod) : (lastResponseTime + RefreshPeriod)))))) + System.currentTimeMillis()) : (((ListenerUtil.mutListener.listen(245) ? (lastResponseTime % RefreshPeriod) : (ListenerUtil.mutListener.listen(244) ? (lastResponseTime / RefreshPeriod) : (ListenerUtil.mutListener.listen(243) ? (lastResponseTime * RefreshPeriod) : (ListenerUtil.mutListener.listen(242) ? (lastResponseTime - RefreshPeriod) : (lastResponseTime + RefreshPeriod)))))) - System.currentTimeMillis()))))));</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(257)) {</span>
            // Log.d(TAG, &quot;Refresh period:&quot; + newPeriod);
<span class="nc bnc" id="L457" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(254) ? (newPeriod &gt;= 0) : (ListenerUtil.mutListener.listen(253) ? (newPeriod &gt; 0) : (ListenerUtil.mutListener.listen(252) ? (newPeriod &lt; 0) : (ListenerUtil.mutListener.listen(251) ? (newPeriod != 0) : (ListenerUtil.mutListener.listen(250) ? (newPeriod == 0) : (newPeriod &lt;= 0))))))) {</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(256)) {</span>
<span class="nc" id="L459">                    refresh();</span>
                }
            } else {
<span class="nc bnc" id="L462" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(255)) {</span>
<span class="nc" id="L463">                    mRefreshHandler.postDelayed(mRefresh, newPeriod);</span>
                }
            }
        }
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(258)) {</span>
            // Refresh the favorite status and stop name, in case we're returning from another view
<span class="nc" id="L469">            setUserInfo();</span>
        }
<span class="nc bnc" id="L471" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(260)) {</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(259)) {</span>
<span class="nc" id="L474">                    mHeader.refresh();</span>
                }
            }
        }
<span class="nc bnc" id="L478" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(261)) {</span>
<span class="nc" id="L479">            super.onResume();</span>
        }
<span class="nc" id="L481">    }</span>

    @Override
    public Loader&lt;ObaArrivalInfoResponse&gt; onCreateLoader(int id, Bundle args) {
<span class="nc" id="L485">        return new ArrivalsListLoader(getActivity(), mStopId);</span>
    }

    // 
    @Override
    public void onLoadFinished(Loader&lt;ObaArrivalInfoResponse&gt; loader, final ObaArrivalInfoResponse result) {
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(262)) {</span>
<span class="nc" id="L492">            showProgress(false);</span>
        }
<span class="nc" id="L494">        ObaArrivalInfo[] info = null;</span>
<span class="nc" id="L495">        List&lt;ObaSituation&gt; situations = null;</span>
<span class="nc" id="L496">        ObaReferences refs = null;</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(276)) {</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">            if (result.getCode() == ObaApi.OBA_OK) {</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(270)) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">                    if (mStop == null) {</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(268)) {</span>
<span class="nc" id="L502">                            mStop = result.getStop();</span>
                        }
<span class="nc bnc" id="L504" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(269)) {</span>
<span class="nc" id="L505">                            DBUtil.addToDB(mStop);</span>
                        }
                    }
                }
<span class="nc bnc" id="L509" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(271)) {</span>
<span class="nc" id="L510">                    info = result.getArrivalInfo();</span>
                }
<span class="nc bnc" id="L512" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(272)) {</span>
<span class="nc" id="L513">                    situations = UIUtils.getAllSituations(result, mRoutesFilter);</span>
                }
<span class="nc bnc" id="L515" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(273)) {</span>
<span class="nc" id="L516">                    refs = result.getRefs();</span>
                }
<span class="nc bnc" id="L518" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(274)) {</span>
<span class="nc" id="L519">                    TravelBehaviorManager.saveArrivalInfo(info, result.getUrl(), result.getCurrentTime(), mStopId);</span>
                }
                // Report Stop distance metric
<span class="nc" id="L522">                Location stopLocation = mStop.getLocation();</span>
<span class="nc" id="L523">                Location myLocation = Application.getLastKnownLocation(getActivity(), null);</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(275)) {</span>
<span class="nc" id="L525">                    ObaAnalytics.reportViewStopEvent(mFirebaseAnalytics, mStop.getId(), mStop.getName(), myLocation, stopLocation);</span>
                }
<span class="nc" id="L527">            } else {</span>
                // page load and we want to display the error in the empty text.
<span class="nc" id="L529">                ObaArrivalInfoResponse lastGood = getArrivalsLoader().getLastGoodResponse();</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(267)) {</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">                    if (lastGood != null) {</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(264)) {</span>
                            // Refresh error
<span class="nc" id="L534">                            Toast.makeText(getActivity(), R.string.generic_comm_error_toast, Toast.LENGTH_LONG).show();</span>
                        }
<span class="nc bnc" id="L536" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(265)) {</span>
<span class="nc" id="L537">                            info = lastGood.getArrivalInfo();</span>
                        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(266)) {</span>
<span class="nc" id="L540">                            situations = UIUtils.getAllSituations(lastGood, mRoutesFilter);</span>
                        }
                    } else {
<span class="nc bnc" id="L543" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(263)) {</span>
<span class="nc" id="L544">                            setEmptyText(UIUtils.getStopErrorString(getActivity(), result.getCode()));</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L550" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(277)) {</span>
<span class="nc" id="L551">            setResponseData(info, situations, refs);</span>
        }
<span class="nc bnc" id="L553" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(281)) {</span>
            // The list should now be shown.
<span class="nc bnc" id="L555" title="All 2 branches missed.">            if (isResumed()) {</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(280)) {</span>
<span class="nc" id="L557">                    setListShown(true);</span>
                }
            } else {
<span class="nc bnc" id="L560" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(279)) {</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                    if (isAdded()) {</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(278)) {</span>
<span class="nc" id="L563">                            setListShownNoAnimation(true);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L569" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(282)) {</span>
            // Clear any pending refreshes
<span class="nc" id="L571">            mRefreshHandler.removeCallbacks(mRefresh);</span>
        }
<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(283)) {</span>
            // Post an update
<span class="nc" id="L575">            mRefreshHandler.postDelayed(mRefresh, RefreshPeriod);</span>
        }
<span class="nc bnc" id="L577" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(290)) {</span>
            // should show a Toast in the case where no additional arrivals were loaded
<span class="nc bnc" id="L579" title="All 2 branches missed.">            if (mLoadedMoreArrivals) {</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(289)) {</span>
<span class="nc bnc" id="L581" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(285) ? ((ListenerUtil.mutListener.listen(284) ? (info == null &amp;&amp; info.length == 0) : (info == null || info.length == 0)) &amp;&amp; mLastResponseLength != info.length) : ((ListenerUtil.mutListener.listen(284) ? (info == null &amp;&amp; info.length == 0) : (info == null || info.length == 0)) || mLastResponseLength != info.length))) {</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(288)) {</span>
                            /*
                Don't show the toast, since:
                 1) an error occurred (and user has already seen the error message),
                 2) no records were returned (and empty list message is already shown), or
                 3) more arrivals were actually loaded
                */
<span class="nc" id="L589">                            mLoadedMoreArrivals = false;</span>
                        }
<span class="nc bnc" id="L591" title="All 2 branches missed.">                    } else if (mLastResponseLength == info.length) {</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(286)) {</span>
                            // No additional arrivals were included in the response, show a toast
<span class="nc" id="L594">                            Toast.makeText(getActivity(), UIUtils.getNoArrivalsMessage(getActivity(), getArrivalsLoader().getMinutesAfter(), true, false), Toast.LENGTH_LONG).show();</span>
                        }
<span class="nc bnc" id="L596" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(287)) {</span>
                            // Only show the toast once
<span class="nc" id="L598">                            mLoadedMoreArrivals = false;</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L604" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(291)) {</span>
<span class="nc" id="L605">            ShowcaseViewUtils.showTutorial(ShowcaseViewUtils.TUTORIAL_ARRIVAL_SORT, (AppCompatActivity) getActivity(), null, false);</span>
        }
<span class="nc bnc" id="L607" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(293)) {</span>
            // Notify listener that we have new arrival info
<span class="nc bnc" id="L609" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(292)) {</span>
<span class="nc" id="L611">                    mListener.onArrivalTimesUpdated(result);</span>
                }
            }
        }
<span class="nc" id="L615">    }</span>

    @Override
    protected void showProgress(boolean visibility) {
<span class="nc bnc" id="L619" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(294)) {</span>
<span class="nc" id="L620">            super.showProgress(visibility);</span>
        }
<span class="nc bnc" id="L622" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(296)) {</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(295)) {</span>
<span class="nc" id="L625">                    mHeader.showProgress(visibility);</span>
                }
            }
        }
<span class="nc" id="L629">    }</span>

    /**
     * Sets the header for this list to be instantiated in another layout, but still controlled by
     * this fragment
     *
     * @param header     header that will be controlled by this fragment
     * @param headerView View that contains this header
     */
    public void setHeader(ArrivalsListHeader header, View headerView) {
<span class="nc bnc" id="L639" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(297)) {</span>
<span class="nc" id="L640">            mHeader = header;</span>
        }
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(298)) {</span>
<span class="nc" id="L643">            mHeaderView = headerView;</span>
        }
<span class="nc bnc" id="L645" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(300)) {</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">            if (header != null) {</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(299)) {</span>
<span class="nc" id="L648">                    mHeader.initView(mHeaderView);</span>
                }
            }
        }
<span class="nc bnc" id="L652" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(301)) {</span>
<span class="nc" id="L653">            mExternalHeader = true;</span>
        }
<span class="nc" id="L655">    }</span>

    private void setResponseData(ObaArrivalInfo[] info, List&lt;ObaSituation&gt; situations, ObaReferences refs) {
<span class="nc bnc" id="L658" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(302)) {</span>
<span class="nc" id="L659">            mArrivalInfo = info;</span>
        }
<span class="nc bnc" id="L661" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(303)) {</span>
<span class="nc" id="L662">            mObaReferences = refs;</span>
        }
<span class="nc bnc" id="L664" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(306)) {</span>
            // Convert any stop situations into a list of alerts
<span class="nc bnc" id="L666" title="All 2 branches missed.">            if (situations != null) {</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(305)) {</span>
<span class="nc" id="L668">                    refreshSituations(situations);</span>
                }
            } else {
<span class="nc bnc" id="L671" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(304)) {</span>
<span class="nc" id="L672">                    refreshSituations(new ArrayList&lt;&gt;());</span>
                }
            }
        }
<span class="nc bnc" id="L676" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(309)) {</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">            if (info != null) {</span>
<span class="nc" id="L678">                ArrivalsListLoader loader = getArrivalsLoader();</span>
                int minutesAfter;
<span class="nc bnc" id="L680" title="All 2 branches missed.">                if (loader != null) {</span>
<span class="nc" id="L681">                    minutesAfter = loader.getMinutesAfter();</span>
                } else {
<span class="nc" id="L683">                    minutesAfter = ArrivalsListLoader.DEFAULT_MINUTES_AFTER;</span>
                }
<span class="nc bnc" id="L685" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(307)) {</span>
                    // Reset the empty text just in case there is no data.
<span class="nc" id="L687">                    setEmptyText(UIUtils.getNoArrivalsMessage(Application.get().getApplicationContext(), minutesAfter, false, false));</span>
                }
<span class="nc bnc" id="L689" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(308)) {</span>
<span class="nc" id="L690">                    mAdapter.setData(info, mRoutesFilter, System.currentTimeMillis());</span>
                }
            }
        }
<span class="nc bnc" id="L694" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(311)) {</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(310)) {</span>
<span class="nc" id="L697">                    mHeader.refresh();</span>
                }
            }
        }
<span class="nc" id="L701">    }</span>

    @Override
    public void onLoaderReset(Loader&lt;ObaArrivalInfoResponse&gt; loader) {
<span class="nc bnc" id="L705" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(312)) {</span>
<span class="nc" id="L706">            showProgress(false);</span>
        }
<span class="nc bnc" id="L708" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(313)) {</span>
<span class="nc" id="L709">            mAdapter.setData(null, mRoutesFilter, System.currentTimeMillis());</span>
        }
<span class="nc bnc" id="L711" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(314)) {</span>
<span class="nc" id="L712">            mArrivalInfo = null;</span>
        }
<span class="nc bnc" id="L714" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(316)) {</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(315)) {</span>
<span class="nc" id="L717">                    mHeader.refresh();</span>
                }
            }
        }
<span class="nc" id="L721">    }</span>

    // 
    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
<span class="nc bnc" id="L726" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(317)) {</span>
<span class="nc" id="L727">            inflater.inflate(R.menu.arrivals_list, menu);</span>
        }
<span class="nc" id="L729">    }</span>

    @Override
    public void onPrepareOptionsMenu(Menu menu) {
<span class="nc bnc" id="L733" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(318)) {</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">            if (!isAdded()) {</span>
                // not attached to an activity (possibly due to screen rotation)
<span class="nc" id="L736">                return;</span>
            }
        }
<span class="nc bnc" id="L739" title="All 2 branches missed.">        String title = mFavorite ? getString(R.string.stop_info_option_removestar) : getString(R.string.stop_info_option_addstar);</span>
<span class="nc bnc" id="L740" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(319)) {</span>
<span class="nc" id="L741">            menu.findItem(R.id.toggle_favorite).setTitle(title).setTitleCondensed(title);</span>
        }
<span class="nc" id="L743">        MenuItem menuItemHeaderArrivals = menu.findItem(R.id.show_header_arrivals);</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(323)) {</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(320)) {</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">                    title = mHeader.isShowingArrivals() ? getString(R.string.stop_info_option_hide_header_arrivals) : getString(R.string.stop_info_option_show_header_arrivals);</span>
                }
<span class="nc bnc" id="L749" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(321)) {</span>
<span class="nc" id="L750">                    menuItemHeaderArrivals.setTitle(title);</span>
                }
<span class="nc bnc" id="L752" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(322)) {</span>
<span class="nc" id="L753">                    menuItemHeaderArrivals.setTitleCondensed(title);</span>
                }
            }
        }
<span class="nc bnc" id="L757" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(326)) {</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">            if (mExternalHeader) {</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(324)) {</span>
                    // So, we can remove the &quot;Show Map&quot; option
<span class="nc" id="L761">                    menu.findItem(R.id.show_on_map).setVisible(false);</span>
                }
<span class="nc bnc" id="L763" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(325)) {</span>
                    // We want to hide the &quot;show/hide arrivals in header&quot; setting if we are in the sliding panel
<span class="nc" id="L765">                    menuItemHeaderArrivals.setVisible(false);</span>
                }
            }
        }
<span class="nc" id="L769">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L773">        final int id = item.getItemId();</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(349)) {</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">            if (id == R.id.show_on_map) {</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(348)) {</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">                    if (mStop != null) {</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(347)) {</span>
<span class="nc" id="L779">                            HomeActivity.start(getActivity(), mStop);</span>
                        }
                    }
                }
<span class="nc" id="L783">                return true;</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">            } else if (id == R.id.refresh) {</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(346)) {</span>
<span class="nc" id="L786">                    refresh();</span>
                }
<span class="nc" id="L788">                return true;</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">            } else if (id == R.id.sort_arrivals) {</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(344)) {</span>
<span class="nc" id="L791">                    ShowcaseViewUtils.doNotShowTutorial(ShowcaseViewUtils.TUTORIAL_ARRIVAL_SORT);</span>
                }
<span class="nc bnc" id="L793" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(345)) {</span>
<span class="nc" id="L794">                    showSortByDialog();</span>
                }
<span class="nc bnc" id="L796" title="All 2 branches missed.">            } else if (id == R.id.filter) {</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(343)) {</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">                    if (mStop != null) {</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(342)) {</span>
<span class="nc" id="L800">                            showRoutesFilterDialog();</span>
                        }
                    }
                }
<span class="nc bnc" id="L804" title="All 2 branches missed.">            } else if (id == R.id.show_header_arrivals) {</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(341)) {</span>
<span class="nc" id="L806">                    doShowHideHeaderArrivals();</span>
                }
<span class="nc bnc" id="L808" title="All 2 branches missed.">            } else if (id == R.id.edit_name) {</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(340)) {</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">                    if (mHeader != null) {</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(339)) {</span>
<span class="nc" id="L812">                            mHeader.beginNameEdit(null);</span>
                        }
                    }
                }
<span class="nc bnc" id="L816" title="All 2 branches missed.">            } else if (id == R.id.toggle_favorite) {</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(336)) {</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">                    setFavoriteStop(!mFavorite);</span>
                }
<span class="nc bnc" id="L820" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(338)) {</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">                    if (mHeader != null) {</span>
<span class="nc bnc" id="L822" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(337)) {</span>
<span class="nc" id="L823">                            mHeader.refresh();</span>
                        }
                    }
                }
<span class="nc bnc" id="L827" title="All 2 branches missed.">            } else if (id == R.id.show_stop_details) {</span>
<span class="nc bnc" id="L828" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(335)) {</span>
<span class="nc" id="L829">                    showStopDetailsDialog();</span>
                }
<span class="nc bnc" id="L831" title="All 2 branches missed.">            } else if (id == R.id.report_stop_problem) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(334)) {</span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">                    if (mStop != null) {</span>
<span class="nc" id="L834">                        Intent intent = makeIntent(getActivity(), mStop.getId(), mStop.getName(), mStop.getStopCode(), mStop.getLatitude(), mStop.getLongitude());</span>
<span class="nc bnc" id="L835" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(333)) {</span>
<span class="nc" id="L836">                            InfrastructureIssueActivity.startWithService(getActivity(), intent, getString(R.string.ri_selected_service_stop));</span>
                        }
<span class="nc" id="L838">                    }</span>
                }
<span class="nc bnc" id="L840" title="All 2 branches missed.">            } else if (id == R.id.night_light) {</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(332)) {</span>
<span class="nc" id="L842">                    NightLightActivity.start(getActivity());</span>
                }
<span class="nc bnc" id="L844" title="All 2 branches missed.">            } else if (id == R.id.hide_alerts) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(328)) {</span>
<span class="nc bnc" id="L846" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(327) ? (mSituationAlerts == null &amp;&amp; mSituationAlerts.isEmpty()) : (mSituationAlerts == null || mSituationAlerts.isEmpty()))) {</span>
<span class="nc" id="L847">                        return false;</span>
                    }
                }
<span class="nc bnc" id="L850" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(330)) {</span>
                    {
<span class="nc" id="L852">                        long _loopCounter2 = 0;</span>
                        // Update the database to hide all currently active alerts at this stop
<span class="nc bnc" id="L854" title="All 2 branches missed.">                        for (SituationAlert alert : mSituationAlerts) {</span>
<span class="nc" id="L855">                            ListenerUtil.loopListener.listen(&quot;_loopCounter2&quot;, ++_loopCounter2);</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(329)) {</span>
<span class="nc" id="L857">                                ObaContract.ServiceAlerts.insertOrUpdate(alert.getId(), new ContentValues(), false, true);</span>
                            }
<span class="nc" id="L859">                        }</span>
                    }
                }
<span class="nc bnc" id="L862" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(331)) {</span>
<span class="nc" id="L863">                    refresh();</span>
                }
            }
        }
<span class="nc" id="L867">        return false;</span>
    }

    public static Intent makeIntent(Context context, String focusId, String stopName, String stopCode, double lat, double lon) {
<span class="nc" id="L871">        Intent myIntent = new Intent(context, HomeActivity.class);</span>
<span class="nc bnc" id="L872" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(350)) {</span>
<span class="nc" id="L873">            myIntent.putExtra(MapParams.STOP_ID, focusId);</span>
        }
<span class="nc bnc" id="L875" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(351)) {</span>
<span class="nc" id="L876">            myIntent.putExtra(MapParams.STOP_NAME, stopName);</span>
        }
<span class="nc bnc" id="L878" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(352)) {</span>
<span class="nc" id="L879">            myIntent.putExtra(MapParams.STOP_CODE, stopCode);</span>
        }
<span class="nc bnc" id="L881" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(353)) {</span>
<span class="nc" id="L882">            myIntent.putExtra(MapParams.CENTER_LAT, lat);</span>
        }
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(354)) {</span>
<span class="nc" id="L885">            myIntent.putExtra(MapParams.CENTER_LON, lon);</span>
        }
<span class="nc" id="L887">        return myIntent;</span>
    }

    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
<span class="nc" id="L892">        final ArrivalInfo stop = (ArrivalInfo) getListView().getItemAtPosition(position);</span>
<span class="nc bnc" id="L893" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(355)) {</span>
<span class="nc" id="L894">            showListItemMenu(v, stop);</span>
        }
<span class="nc" id="L896">    }</span>

    public void showListItemMenu(View v, final ArrivalInfo arrivalInfo) {
<span class="nc bnc" id="L899" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(356)) {</span>
<span class="nc bnc" id="L900" title="All 2 branches missed.">            if (arrivalInfo == null) {</span>
<span class="nc" id="L901">                return;</span>
            }
        }
<span class="nc bnc" id="L904" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(357)) {</span>
<span class="nc" id="L905">            Log.d(TAG, &quot;Tapped on route=&quot; + arrivalInfo.getInfo().getShortName() + &quot;, tripId=&quot; + arrivalInfo.getInfo().getTripId() + &quot;, vehicleId=&quot; + arrivalInfo.getInfo().getVehicleId());</span>
        }
<span class="nc" id="L907">        ArrivalsListLoader loader = getArrivalsLoader();</span>
<span class="nc bnc" id="L908" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(358)) {</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">            if (loader == null) {</span>
<span class="nc" id="L910">                return;</span>
            }
        }
<span class="nc" id="L913">        final ObaArrivalInfoResponse response = loader.getLastGoodResponse();</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(359)) {</span>
<span class="nc bnc" id="L915" title="All 2 branches missed.">            if (response == null) {</span>
<span class="nc" id="L916">                return;</span>
            }
        }
<span class="nc" id="L919">        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(360)) {</span>
<span class="nc" id="L921">            builder.setTitle(R.string.stop_info_item_options_title);</span>
        }
<span class="nc" id="L923">        final String routeId = arrivalInfo.getInfo().getRouteId();</span>
<span class="nc" id="L924">        final ObaRoute route = response.getRoute(routeId);</span>
<span class="nc bnc" id="L925" title="All 2 branches missed.">        final String url = route != null ? route.getUrl() : null;</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">        final boolean hasUrl = !TextUtils.isEmpty(url);</span>
        // (we don't have any other state, so this is good enough)
<span class="nc" id="L928">        View tripView = v.findViewById(R.id.reminder);</span>
<span class="nc bnc" id="L929" title="All 10 branches missed.">        boolean isReminderVisible = (ListenerUtil.mutListener.listen(361) ? (tripView != null || tripView.getVisibility() != View.GONE) : (tripView != null &amp;&amp; tripView.getVisibility() != View.GONE));</span>
        // Check route favorite, for whether we show &quot;Add star&quot; or &quot;Remove star&quot;
<span class="nc" id="L931">        final boolean isRouteFavorite = ObaContract.RouteHeadsignFavorites.isFavorite(routeId, arrivalInfo.getInfo().getHeadsign(), arrivalInfo.getInfo().getStopId());</span>
        // Check to see if there is a route filter, for whether we show &quot;Show all routes&quot; or &quot;Show only this route&quot;
<span class="nc bnc" id="L933" title="All 2 branches missed.">        boolean hasRouteFilter = !mRoutesFilter.isEmpty();</span>
        final Occupancy occupancy;
        final OccupancyState occupancyState;
<span class="nc bnc" id="L936" title="All 2 branches missed.">        if (arrivalInfo.getPredictedOccupancy() != null) {</span>
<span class="nc" id="L937">            occupancy = arrivalInfo.getPredictedOccupancy();</span>
<span class="nc" id="L938">            occupancyState = OccupancyState.PREDICTED;</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">        } else if (arrivalInfo.getHistoricalOccupancy() != null) {</span>
<span class="nc" id="L940">            occupancy = arrivalInfo.getHistoricalOccupancy();</span>
<span class="nc" id="L941">            occupancyState = OccupancyState.HISTORICAL;</span>
        } else {
<span class="nc" id="L943">            occupancy = null;</span>
<span class="nc" id="L944">            occupancyState = null;</span>
        }
<span class="nc" id="L946">        List&lt;String&gt; items = UIUtils.buildTripOptions(getActivity(), isRouteFavorite, hasUrl, isReminderVisible, hasRouteFilter, occupancy, occupancyState);</span>
<span class="nc" id="L947">        List&lt;Integer&gt; icons = UIUtils.buildTripOptionsIcons(isRouteFavorite, hasUrl, occupancy);</span>
<span class="nc" id="L948">        ListAdapter adapter = new ArrayAdapterWithIcon(getActivity(), items, icons);</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(445)) {</span>
<span class="nc" id="L950">            builder.setAdapter(adapter, new DialogInterface.OnClickListener() {</span>

                public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L953" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(444)) {</span>
<span class="nc bnc" id="L954" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(366) ? (which &gt;= 0) : (ListenerUtil.mutListener.listen(365) ? (which &lt;= 0) : (ListenerUtil.mutListener.listen(364) ? (which &gt; 0) : (ListenerUtil.mutListener.listen(363) ? (which &lt; 0) : (ListenerUtil.mutListener.listen(362) ? (which != 0) : (which == 0))))))) {</span>
                            // Show dialog for setting route favorite
<span class="nc bnc" id="L956" title="All 2 branches missed.">                            RouteFavoriteDialogFragment routeDialog = new RouteFavoriteDialogFragment.Builder(route.getId(), arrivalInfo.getInfo().getHeadsign()).setRouteShortName(route.getShortName()).setRouteLongName(arrivalInfo.getInfo().getRouteLongName()).setRouteUrl(route.getUrl()).setStopId(arrivalInfo.getInfo().getStopId()).setFavorite(!isRouteFavorite).build();</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(442)) {</span>
<span class="nc" id="L958">                                setCallbackToDialogFragment(routeDialog);</span>
                            }
<span class="nc bnc" id="L960" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(443)) {</span>
<span class="nc" id="L961">                                routeDialog.show(getFragmentManager(), RouteFavoriteDialogFragment.TAG);</span>
                            }
<span class="nc bnc" id="L963" title="All 22 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(371) ? (which &gt;= 1) : (ListenerUtil.mutListener.listen(370) ? (which &lt;= 1) : (ListenerUtil.mutListener.listen(369) ? (which &gt; 1) : (ListenerUtil.mutListener.listen(368) ? (which &lt; 1) : (ListenerUtil.mutListener.listen(367) ? (which != 1) : (which == 1))))))) {</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(441)) {</span>
<span class="nc" id="L965">                                showRouteOnMap(arrivalInfo);</span>
                            }
<span class="nc bnc" id="L967" title="All 22 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(376) ? (which &gt;= 2) : (ListenerUtil.mutListener.listen(375) ? (which &lt;= 2) : (ListenerUtil.mutListener.listen(374) ? (which &gt; 2) : (ListenerUtil.mutListener.listen(373) ? (which &lt; 2) : (ListenerUtil.mutListener.listen(372) ? (which != 2) : (which == 2))))))) {</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(440)) {</span>
<span class="nc" id="L969">                                goToTripDetails(arrivalInfo);</span>
                            }
<span class="nc bnc" id="L971" title="All 22 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(381) ? (which &gt;= 3) : (ListenerUtil.mutListener.listen(380) ? (which &lt;= 3) : (ListenerUtil.mutListener.listen(379) ? (which &gt; 3) : (ListenerUtil.mutListener.listen(378) ? (which &lt; 3) : (ListenerUtil.mutListener.listen(377) ? (which != 3) : (which == 3))))))) {</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(439)) {</span>
<span class="nc" id="L973">                                goToTrip(arrivalInfo);</span>
                            }
<span class="nc bnc" id="L975" title="All 22 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(386) ? (which &gt;= 4) : (ListenerUtil.mutListener.listen(385) ? (which &lt;= 4) : (ListenerUtil.mutListener.listen(384) ? (which &gt; 4) : (ListenerUtil.mutListener.listen(383) ? (which &lt; 4) : (ListenerUtil.mutListener.listen(382) ? (which != 4) : (which == 4))))))) {</span>
<span class="nc" id="L976">                            ArrayList&lt;String&gt; routes = new ArrayList&lt;String&gt;(1);</span>
<span class="nc bnc" id="L977" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(427)) {</span>
<span class="nc" id="L978">                                routes.add(arrivalInfo.getInfo().getRouteId());</span>
                            }
<span class="nc bnc" id="L980" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(435)) {</span>
                                // toggle route filter - if user selection equals existing route filter, clear it
<span class="nc bnc" id="L982" title="All 50 branches missed.">                                if ((ListenerUtil.mutListener.listen(433) ? (routes.equals(mRoutesFilter) &amp;&amp; (ListenerUtil.mutListener.listen(432) ? (mRoutesFilter.size() &gt;= routes.size()) : (ListenerUtil.mutListener.listen(431) ? (mRoutesFilter.size() &lt;= routes.size()) : (ListenerUtil.mutListener.listen(430) ? (mRoutesFilter.size() &lt; routes.size()) : (ListenerUtil.mutListener.listen(429) ? (mRoutesFilter.size() != routes.size()) : (ListenerUtil.mutListener.listen(428) ? (mRoutesFilter.size() == routes.size()) : (mRoutesFilter.size() &gt; routes.size()))))))) : (routes.equals(mRoutesFilter) || (ListenerUtil.mutListener.listen(432) ? (mRoutesFilter.size() &gt;= routes.size()) : (ListenerUtil.mutListener.listen(431) ? (mRoutesFilter.size() &lt;= routes.size()) : (ListenerUtil.mutListener.listen(430) ? (mRoutesFilter.size() &lt; routes.size()) : (ListenerUtil.mutListener.listen(429) ? (mRoutesFilter.size() != routes.size()) : (ListenerUtil.mutListener.listen(428) ? (mRoutesFilter.size() == routes.size()) : (mRoutesFilter.size() &gt; routes.size()))))))))) {</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(434)) {</span>
<span class="nc" id="L984">                                        routes.clear();</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L988" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(436)) {</span>
<span class="nc" id="L989">                                setRoutesFilter(routes);</span>
                            }
<span class="nc bnc" id="L991" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(438)) {</span>
<span class="nc bnc" id="L992" title="All 2 branches missed.">                                if (mHeader != null) {</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(437)) {</span>
<span class="nc" id="L994">                                        mHeader.refresh();</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L998" title="All 50 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(392) ? (hasUrl || (ListenerUtil.mutListener.listen(391) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(390) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(389) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(388) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(387) ? (which != 5) : (which == 5))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(391) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(390) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(389) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(388) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(387) ? (which != 5) : (which == 5))))))))) {</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(426)) {</span>
<span class="nc" id="L1000">                                UIUtils.goToUrl(getActivity(), url);</span>
                            }
<span class="nc bnc" id="L1002" title="All 202 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(405) ? (((ListenerUtil.mutListener.listen(398) ? (!hasUrl || (ListenerUtil.mutListener.listen(397) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(396) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(395) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(394) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(393) ? (which != 5) : (which == 5))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(397) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(396) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(395) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(394) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(393) ? (which != 5) : (which == 5))))))))) &amp;&amp; ((ListenerUtil.mutListener.listen(404) ? (hasUrl || (ListenerUtil.mutListener.listen(403) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(402) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(401) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(400) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(399) ? (which != 6) : (which == 6))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(403) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(402) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(401) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(400) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(399) ? (which != 6) : (which == 6)))))))))) : (((ListenerUtil.mutListener.listen(398) ? (!hasUrl || (ListenerUtil.mutListener.listen(397) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(396) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(395) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(394) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(393) ? (which != 5) : (which == 5))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(397) ? (which &gt;= 5) : (ListenerUtil.mutListener.listen(396) ? (which &lt;= 5) : (ListenerUtil.mutListener.listen(395) ? (which &gt; 5) : (ListenerUtil.mutListener.listen(394) ? (which &lt; 5) : (ListenerUtil.mutListener.listen(393) ? (which != 5) : (which == 5))))))))) || ((ListenerUtil.mutListener.listen(404) ? (hasUrl || (ListenerUtil.mutListener.listen(403) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(402) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(401) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(400) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(399) ? (which != 6) : (which == 6))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(403) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(402) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(401) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(400) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(399) ? (which != 6) : (which == 6)))))))))))) {</span>
                            // Find agency name
<span class="nc" id="L1004">                            String routeId = arrivalInfo.getInfo().getRouteId();</span>
<span class="nc" id="L1005">                            String agencyName = null;</span>
<span class="nc" id="L1006">                            String blockId = null;</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(424)) {</span>
<span class="nc bnc" id="L1008" title="All 2 branches missed.">                                if (mObaReferences != null) {</span>
<span class="nc" id="L1009">                                    String agencyId = mObaReferences.getRoute(routeId).getAgencyId();</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(422)) {</span>
<span class="nc" id="L1011">                                        agencyName = mObaReferences.getAgency(agencyId).getName();</span>
                                    }
<span class="nc" id="L1013">                                    ObaTrip trip = mObaReferences.getTrip(arrivalInfo.getInfo().getTripId());</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(423)) {</span>
<span class="nc" id="L1015">                                        blockId = trip.getBlockId();</span>
                                    }
                                }
                            }
<span class="nc" id="L1019">                            Intent intent = makeIntent(getActivity(), mStop.getId(), mStop.getName(), mStop.getStopCode(), mStop.getLatitude(), mStop.getLongitude());</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(425)) {</span>
<span class="nc" id="L1021">                                InfrastructureIssueActivity.startWithService(getActivity(), intent, getString(R.string.ri_selected_service_trip), arrivalInfo.getInfo(), agencyName, blockId);</span>
                            }
<span class="nc bnc" id="L1023" title="All 410 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(419) ? (occupancy != null || ((ListenerUtil.mutListener.listen(418) ? (((ListenerUtil.mutListener.listen(411) ? (!hasUrl || (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))))) &amp;&amp; ((ListenerUtil.mutListener.listen(417) ? (hasUrl || (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7)))))))))) : (((ListenerUtil.mutListener.listen(411) ? (!hasUrl || (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))))) || ((ListenerUtil.mutListener.listen(417) ? (hasUrl || (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))))))))) : (occupancy != null &amp;&amp; ((ListenerUtil.mutListener.listen(418) ? (((ListenerUtil.mutListener.listen(411) ? (!hasUrl || (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))))) &amp;&amp; ((ListenerUtil.mutListener.listen(417) ? (hasUrl || (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7)))))))))) : (((ListenerUtil.mutListener.listen(411) ? (!hasUrl || (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))) : (!hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(410) ? (which &gt;= 6) : (ListenerUtil.mutListener.listen(409) ? (which &lt;= 6) : (ListenerUtil.mutListener.listen(408) ? (which &gt; 6) : (ListenerUtil.mutListener.listen(407) ? (which &lt; 6) : (ListenerUtil.mutListener.listen(406) ? (which != 6) : (which == 6))))))))) || ((ListenerUtil.mutListener.listen(417) ? (hasUrl || (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))) : (hasUrl &amp;&amp; (ListenerUtil.mutListener.listen(416) ? (which &gt;= 7) : (ListenerUtil.mutListener.listen(415) ? (which &lt;= 7) : (ListenerUtil.mutListener.listen(414) ? (which &gt; 7) : (ListenerUtil.mutListener.listen(413) ? (which &lt; 7) : (ListenerUtil.mutListener.listen(412) ? (which != 7) : (which == 7))))))))))))))) {</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(420)) {</span>
<span class="nc" id="L1025">                                ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getActivity().getString(R.string.analytics_label_button_press_about_occupancy), null);</span>
                            }
<span class="nc bnc" id="L1027" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(421)) {</span>
<span class="nc" id="L1028">                                createOccupancyDialog().show();</span>
                            }
                        }
                    }
<span class="nc" id="L1032">                }</span>
            });
        }
<span class="nc" id="L1035">        AlertDialog dialog = builder.create();</span>
<span class="nc bnc" id="L1036" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(446)) {</span>
<span class="nc" id="L1037">            dialog.setOwnerActivity(getActivity());</span>
        }
<span class="nc bnc" id="L1039" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(447)) {</span>
<span class="nc" id="L1040">            dialog.show();</span>
        }
<span class="nc" id="L1042">    }</span>

    private void setCallbackToDialogFragment(RouteFavoriteDialogFragment routeDialog) {
<span class="nc bnc" id="L1045" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(450)) {</span>
<span class="nc" id="L1046">            routeDialog.setCallback(new RouteFavoriteDialogFragment.Callback() {</span>

                @Override
                public void onSelectionComplete(boolean savedFavorite) {
<span class="nc bnc" id="L1050" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(449)) {</span>
<span class="nc bnc" id="L1051" title="All 2 branches missed.">                        if (savedFavorite) {</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(448)) {</span>
<span class="nc" id="L1053">                                refreshLocal();</span>
                            }
                        }
                    }
<span class="nc" id="L1057">                }</span>
            });
        }
<span class="nc" id="L1060">    }</span>

    public void showRouteOnMap(ArrivalInfo arrivalInfo) {
<span class="nc" id="L1063">        boolean handled = false;</span>
<span class="nc bnc" id="L1064" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(452)) {</span>
<span class="nc bnc" id="L1065" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(451)) {</span>
<span class="nc" id="L1067">                    handled = mListener.onShowRouteOnMapSelected(arrivalInfo);</span>
                }
            }
        }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(454)) {</span>
            // If the event hasn't been handled by the listener, start a new activity
<span class="nc bnc" id="L1073" title="All 2 branches missed.">            if (!handled) {</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(453)) {</span>
<span class="nc" id="L1075">                    HomeActivity.start(getActivity(), arrivalInfo.getInfo().getRouteId());</span>
                }
            }
        }
<span class="nc" id="L1079">    }</span>

    // 
    @Override
    public String getStopId() {
<span class="nc" id="L1084">        return mStopId;</span>
    }

    @Override
    public Location getStopLocation() {
<span class="nc" id="L1089">        Location location = null;</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(469)) {</span>
<span class="nc bnc" id="L1091" title="All 2 branches missed.">            if (mStop != null) {</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(468)) {</span>
<span class="nc" id="L1093">                    location = mStop.getLocation();</span>
                }
            } else {
                // Check the arguments
<span class="nc" id="L1097">                Bundle args = getArguments();</span>
<span class="nc" id="L1098">                double latitude = args.getDouble(STOP_LAT);</span>
<span class="nc" id="L1099">                double longitude = args.getDouble(STOP_LON);</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(467)) {</span>
<span class="nc bnc" id="L1101" title="All 90 branches missed.">                    if ((ListenerUtil.mutListener.listen(465) ? ((ListenerUtil.mutListener.listen(459) ? (latitude &gt;= 0) : (ListenerUtil.mutListener.listen(458) ? (latitude &lt;= 0) : (ListenerUtil.mutListener.listen(457) ? (latitude &gt; 0) : (ListenerUtil.mutListener.listen(456) ? (latitude &lt; 0) : (ListenerUtil.mutListener.listen(455) ? (latitude == 0) : (latitude != 0)))))) || (ListenerUtil.mutListener.listen(464) ? (longitude &gt;= 0) : (ListenerUtil.mutListener.listen(463) ? (longitude &lt;= 0) : (ListenerUtil.mutListener.listen(462) ? (longitude &gt; 0) : (ListenerUtil.mutListener.listen(461) ? (longitude &lt; 0) : (ListenerUtil.mutListener.listen(460) ? (longitude == 0) : (longitude != 0))))))) : ((ListenerUtil.mutListener.listen(459) ? (latitude &gt;= 0) : (ListenerUtil.mutListener.listen(458) ? (latitude &lt;= 0) : (ListenerUtil.mutListener.listen(457) ? (latitude &gt; 0) : (ListenerUtil.mutListener.listen(456) ? (latitude &lt; 0) : (ListenerUtil.mutListener.listen(455) ? (latitude == 0) : (latitude != 0)))))) &amp;&amp; (ListenerUtil.mutListener.listen(464) ? (longitude &gt;= 0) : (ListenerUtil.mutListener.listen(463) ? (longitude &lt;= 0) : (ListenerUtil.mutListener.listen(462) ? (longitude &gt; 0) : (ListenerUtil.mutListener.listen(461) ? (longitude &lt; 0) : (ListenerUtil.mutListener.listen(460) ? (longitude == 0) : (longitude != 0))))))))) {</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(466)) {</span>
<span class="nc" id="L1103">                            location = LocationUtils.makeLocation(latitude, longitude);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1109">        return location;</span>
    }

    @Override
    public String getStopName() {
        String name;
<span class="nc bnc" id="L1115" title="All 2 branches missed.">        if (mStop != null) {</span>
<span class="nc" id="L1116">            name = mStop.getName();</span>
        } else {
            // Check the arguments
<span class="nc" id="L1119">            Bundle args = getArguments();</span>
<span class="nc" id="L1120">            name = args.getString(STOP_NAME);</span>
        }
<span class="nc" id="L1122">        return UIUtils.formatDisplayText(name);</span>
    }

    @Override
    public String getStopDirection() {
<span class="nc bnc" id="L1127" title="All 2 branches missed.">        if (mStop != null) {</span>
<span class="nc" id="L1128">            return mStop.getDirection();</span>
        } else {
            // Check the arguments
<span class="nc" id="L1131">            Bundle args = getArguments();</span>
<span class="nc" id="L1132">            return args.getString(STOP_DIRECTION);</span>
        }
    }

    /**
     * Returns a sorted list (by ETA) of arrival times for the current stop
     *
     * @return a sorted list (by ETA) of arrival times for the current stop
     */
    @Override
    public ArrayList&lt;ArrivalInfo&gt; getArrivalInfo() {
<span class="nc" id="L1143">        ArrayList&lt;ArrivalInfo&gt; list = null;</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(471)) {</span>
<span class="nc bnc" id="L1145" title="All 2 branches missed.">            if (mArrivalInfo != null) {</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(470)) {</span>
<span class="nc" id="L1147">                    list = ArrivalInfoUtils.convertObaArrivalInfo(getActivity(), mArrivalInfo, mRoutesFilter, System.currentTimeMillis(), true);</span>
                }
            }
        }
<span class="nc" id="L1151">        return list;</span>
    }

    /**
     * Returns the range of arrival times (i.e., for the next &quot;minutesAfter&quot; minutes), or -1 if
     * this information isn't available
     *
     * @return the range of arrival times (i.e., for the next &quot;minutesAfter&quot; minutes), or -1 if
     * this information isn't available
     */
    @Override
    public int getMinutesAfter() {
<span class="nc" id="L1163">        ArrivalsListLoader loader = getArrivalsLoader();</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">        if (loader != null) {</span>
<span class="nc" id="L1165">            return loader.getMinutesAfter();</span>
        } else {
<span class="nc" id="L1167">            return -1;</span>
        }
    }

    @Override
    public String getUserStopName() {
<span class="nc" id="L1173">        return mStopUserName;</span>
    }

    @Override
    public void setUserStopName(String name) {
<span class="nc" id="L1178">        ContentResolver cr = getActivity().getContentResolver();</span>
<span class="nc" id="L1179">        ContentValues values = new ContentValues();</span>
<span class="nc bnc" id="L1180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(476)) {</span>
<span class="nc bnc" id="L1181" title="All 2 branches missed.">            if (TextUtils.isEmpty(name)) {</span>
<span class="nc bnc" id="L1182" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(474)) {</span>
<span class="nc" id="L1183">                    values.putNull(ObaContract.Stops.USER_NAME);</span>
                }
<span class="nc bnc" id="L1185" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(475)) {</span>
<span class="nc" id="L1186">                    mStopUserName = null;</span>
                }
            } else {
<span class="nc bnc" id="L1189" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(472)) {</span>
<span class="nc" id="L1190">                    values.put(ObaContract.Stops.USER_NAME, name);</span>
                }
<span class="nc bnc" id="L1192" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(473)) {</span>
<span class="nc" id="L1193">                    mStopUserName = name;</span>
                }
            }
        }
<span class="nc bnc" id="L1197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(477)) {</span>
<span class="nc" id="L1198">            cr.update(mStopUri, values, null, null);</span>
        }
<span class="nc" id="L1200">    }</span>

    @Override
    public ArrayList&lt;String&gt; getRoutesFilter() {
        // a route filter at all.
<span class="nc bnc" id="L1205" title="All 2 branches missed.">        if (mStop != null) {</span>
<span class="nc" id="L1206">            return mRoutesFilter;</span>
        } else {
<span class="nc" id="L1208">            return null;</span>
        }
    }

    @Override
    public void setRoutesFilter(ArrayList&lt;String&gt; routes) {
<span class="nc bnc" id="L1214" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(478)) {</span>
<span class="nc" id="L1215">            mRoutesFilter = routes;</span>
        }
<span class="nc bnc" id="L1217" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(479)) {</span>
<span class="nc" id="L1218">            ObaContract.StopRouteFilters.set(getActivity(), mStopId, mRoutesFilter);</span>
        }
<span class="nc bnc" id="L1220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(480)) {</span>
<span class="nc" id="L1221">            refreshSituations(UIUtils.getAllSituations(getArrivalsLoader().getLastGoodResponse(), mRoutesFilter));</span>
        }
<span class="nc bnc" id="L1223" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(481)) {</span>
<span class="nc" id="L1224">            refreshLocal();</span>
        }
<span class="nc" id="L1226">    }</span>

    @Override
    public long getLastGoodResponseTime() {
<span class="nc" id="L1230">        ArrivalsListLoader loader = getArrivalsLoader();</span>
<span class="nc bnc" id="L1231" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(482)) {</span>
<span class="nc bnc" id="L1232" title="All 2 branches missed.">            if (loader == null) {</span>
<span class="nc" id="L1233">                return 0;</span>
            }
        }
<span class="nc" id="L1236">        return loader.getLastGoodResponseTime();</span>
    }

    @Override
    public List&lt;String&gt; getRouteDisplayNames() {
<span class="nc bnc" id="L1241" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(487)) {</span>
<span class="nc bnc" id="L1242" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(483) ? (mStop != null || getArrivalsLoader() != null) : (mStop != null &amp;&amp; getArrivalsLoader() != null))) {</span>
<span class="nc" id="L1243">                ObaArrivalInfoResponse response = getArrivalsLoader().getLastGoodResponse();</span>
<span class="nc" id="L1244">                List&lt;ObaRoute&gt; routes = response.getRoutes(mStop.getRouteIds());</span>
<span class="nc" id="L1245">                ArrayList&lt;String&gt; displayNames = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(486)) {</span>
                    {
<span class="nc" id="L1248">                        long _loopCounter3 = 0;</span>
<span class="nc bnc" id="L1249" title="All 2 branches missed.">                        for (ObaRoute r : routes) {</span>
<span class="nc" id="L1250">                            ListenerUtil.loopListener.listen(&quot;_loopCounter3&quot;, ++_loopCounter3);</span>
<span class="nc bnc" id="L1251" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(485)) {</span>
<span class="nc" id="L1252">                                displayNames.add(UIUtils.getRouteDisplayName(r));</span>
                            }
<span class="nc" id="L1254">                        }</span>
                    }
                }
<span class="nc" id="L1257">                return displayNames;</span>
            } else {
                // Check the arguments
<span class="nc" id="L1260">                Bundle args = getArguments();</span>
<span class="nc" id="L1261">                String serializedRoutes = args.getString(STOP_ROUTES);</span>
<span class="nc bnc" id="L1262" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(484)) {</span>
<span class="nc bnc" id="L1263" title="All 2 branches missed.">                    if (serializedRoutes != null) {</span>
<span class="nc" id="L1264">                        return UIUtils.deserializeRouteDisplayNames(serializedRoutes);</span>
                    }
                }
            }
        }
        // If we've gotten this far, we don't have any routeIds to share
<span class="nc" id="L1270">        return null;</span>
    }

    @Override
    public int getNumRoutes() {
<span class="nc bnc" id="L1275" title="All 2 branches missed.">        if (mStop != null) {</span>
<span class="nc" id="L1276">            return mStop.getRouteIds().length;</span>
        } else {
<span class="nc" id="L1278">            return 0;</span>
        }
    }

    @Override
    public boolean isFavoriteStop() {
<span class="nc" id="L1284">        return mFavorite;</span>
    }

    @Override
    public boolean setFavoriteStop(boolean favorite) {
<span class="nc bnc" id="L1289" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(489)) {</span>
<span class="nc bnc" id="L1290" title="All 2 branches missed.">            if (ObaContract.Stops.markAsFavorite(getActivity(), mStopUri, favorite)) {</span>
<span class="nc bnc" id="L1291" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(488)) {</span>
<span class="nc" id="L1292">                    mFavorite = favorite;</span>
                }
            }
        }
<span class="nc bnc" id="L1296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(490)) {</span>
            // menus like we did before...
<span class="nc" id="L1298">            getActivity().supportInvalidateOptionsMenu();</span>
        }
<span class="nc bnc" id="L1300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(491)) {</span>
<span class="nc" id="L1301">            ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_edit_field_bookmark), null);</span>
        }
<span class="nc" id="L1303">        return mFavorite;</span>
    }

    @Override
    public AlertList getAlertList() {
<span class="nc" id="L1308">        return mAlertList;</span>
    }

    /**
     * Checks to see if the user has changed the arrival info style preference after this Fragment
     * was initialized
     */
    private void checkAdapterStylePreference() {
<span class="nc" id="L1316">        int currentArrivalInfoStyle = BuildFlavorUtils.getArrivalInfoStyleFromPreferences();</span>
<span class="nc bnc" id="L1317" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(496)) {</span>
<span class="nc bnc" id="L1318" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(492) ? (currentArrivalInfoStyle == BuildFlavorUtils.ARRIVAL_INFO_STYLE_A || !(mAdapter instanceof ArrivalsListAdapterStyleA)) : (currentArrivalInfoStyle == BuildFlavorUtils.ARRIVAL_INFO_STYLE_A &amp;&amp; !(mAdapter instanceof ArrivalsListAdapterStyleA)))) {</span>
<span class="nc bnc" id="L1319" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(495)) {</span>
                    // Change to Style A adapter
<span class="nc" id="L1321">                    reinitAdapterStyleOnPreferenceChange(BuildFlavorUtils.ARRIVAL_INFO_STYLE_A);</span>
                }
<span class="nc bnc" id="L1323" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(493) ? (currentArrivalInfoStyle == BuildFlavorUtils.ARRIVAL_INFO_STYLE_B || !(mAdapter instanceof ArrivalsListAdapterStyleB)) : (currentArrivalInfoStyle == BuildFlavorUtils.ARRIVAL_INFO_STYLE_B &amp;&amp; !(mAdapter instanceof ArrivalsListAdapterStyleB)))) {</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(494)) {</span>
                    // Change to Style B adapter
<span class="nc" id="L1326">                    reinitAdapterStyleOnPreferenceChange(BuildFlavorUtils.ARRIVAL_INFO_STYLE_B);</span>
                }
            }
        }
<span class="nc" id="L1330">    }</span>

    /**
     * Reinitializes the adapter style after there has been a preference changed
     *
     * @param arrivalInfoStyle the adapter style to change to - should be one of the
     *                         BuildFlavorUtil.ARRIVAL_INFO_STYLE_* contants
     */
    private void reinitAdapterStyleOnPreferenceChange(int arrivalInfoStyle) {
<span class="nc" id="L1339">        LayoutInflater inflater = LayoutInflater.from(getActivity());</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(498)) {</span>
            // Remove any existing footer view
<span class="nc bnc" id="L1342" title="All 2 branches missed.">            if (mFooter != null) {</span>
<span class="nc bnc" id="L1343" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(497)) {</span>
<span class="nc" id="L1344">                    getListView().removeFooterView(mFooter);</span>
                }
            }
        }
<span class="nc" id="L1348">        CharSequence emptyText = null;</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(502)) {</span>
            // Remove any existing empty list view
<span class="nc bnc" id="L1351" title="All 2 branches missed.">            if (mEmptyList != null) {</span>
<span class="nc" id="L1352">                TextView noArrivals = (TextView) mEmptyList.findViewById(R.id.noArrivals);</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(500)) {</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                    if (noArrivals != null) {</span>
<span class="nc bnc" id="L1355" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(499)) {</span>
<span class="nc" id="L1356">                            emptyText = noArrivals.getText();</span>
                        }
                    }
                }
<span class="nc bnc" id="L1360" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(501)) {</span>
<span class="nc" id="L1361">                    ((ViewGroup) getListView().getParent()).removeView(mEmptyList);</span>
                }
            }
        }
<span class="nc bnc" id="L1365" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(503)) {</span>
<span class="nc" id="L1366">            initArrivalInfoViews(inflater);</span>
        }
<span class="nc bnc" id="L1368" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(504)) {</span>
<span class="nc" id="L1369">            setupFooter();</span>
        }
<span class="nc bnc" id="L1371" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(505)) {</span>
<span class="nc" id="L1372">            setupEmptyList(emptyText);</span>
        }
<span class="nc bnc" id="L1374" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(506)) {</span>
<span class="nc" id="L1375">            setListViewProperties(arrivalInfoStyle);</span>
        }
<span class="nc bnc" id="L1377" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(507)) {</span>
<span class="nc" id="L1378">            instantiateAdapter(arrivalInfoStyle);</span>
        }
<span class="nc" id="L1380">    }</span>

    /**
     * Initializes the adapter views
     *
     * @param inflater         inflater to use
     */
    private void initArrivalInfoViews(LayoutInflater inflater) {
<span class="nc bnc" id="L1388" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(508)) {</span>
            // Use a card-styled footer
<span class="nc" id="L1390">            mFooter = inflater.inflate(R.layout.arrivals_list_footer_style, null);</span>
        }
<span class="nc bnc" id="L1392" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(509)) {</span>
<span class="nc" id="L1393">            mEmptyList = inflater.inflate(R.layout.arrivals_list_empty_style, null);</span>
        }
<span class="nc" id="L1395">    }</span>

    /**
     * Sets up the footer with the load more arrivals button
     */
    private void setupFooter() {
        // Setup list footer button to load more arrivals (when arrivals are shown)
<span class="nc" id="L1402">        Button loadMoreArrivals = (Button) mFooter.findViewById(R.id.load_more_arrivals);</span>
<span class="nc bnc" id="L1403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(511)) {</span>
<span class="nc" id="L1404">            loadMoreArrivals.setOnClickListener(new View.OnClickListener() {</span>

                @Override
                public void onClick(View v) {
<span class="nc bnc" id="L1408" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(510)) {</span>
<span class="nc" id="L1409">                        loadMoreArrivals();</span>
                    }
<span class="nc" id="L1411">                }</span>
            });
        }
<span class="nc bnc" id="L1414" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(512)) {</span>
<span class="nc" id="L1415">            getListView().addFooterView(mFooter);</span>
        }
<span class="nc bnc" id="L1417" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(513)) {</span>
<span class="nc" id="L1418">            mFooter.requestLayout();</span>
        }
<span class="nc" id="L1420">    }</span>

    /**
     * Sets up the load more arrivals button in the empty list view
     *
     * @param currentText the text that should populate the empty list entry, or null if no text
     *                    should be set at this point
     */
    private void setupEmptyList(CharSequence currentText) {
<span class="nc" id="L1429">        Button loadMoreArrivalsEmptyList = (Button) mEmptyList.findViewById(R.id.load_more_arrivals);</span>
<span class="nc bnc" id="L1430" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(515)) {</span>
<span class="nc" id="L1431">            loadMoreArrivalsEmptyList.setOnClickListener(new View.OnClickListener() {</span>

                @Override
                public void onClick(View v) {
<span class="nc bnc" id="L1435" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(514)) {</span>
<span class="nc" id="L1436">                        loadMoreArrivals();</span>
                    }
<span class="nc" id="L1438">                }</span>
            });
        }
<span class="nc bnc" id="L1441" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(516)) {</span>
            // Set and add the view that is shown if no arrival information is returned by the REST API
<span class="nc" id="L1443">            getListView().setEmptyView(mEmptyList);</span>
        }
<span class="nc bnc" id="L1445" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(517)) {</span>
<span class="nc" id="L1446">            ((ViewGroup) getListView().getParent()).addView(mEmptyList);</span>
        }
<span class="nc bnc" id="L1448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(519)) {</span>
<span class="nc bnc" id="L1449" title="All 2 branches missed.">            if (currentText != null) {</span>
<span class="nc bnc" id="L1450" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(518)) {</span>
<span class="nc" id="L1451">                    setEmptyText(currentText);</span>
                }
            }
        }
<span class="nc" id="L1455">    }</span>

    /**
     * Initializes the list view properties
     *
     * @param arrivalInfoStyle the adapter style to use - should be one of the
     *                         BuildFlavorUtil.ARRIVAL_INFO_STYLE_* contants
     */
    private void setListViewProperties(int arrivalInfoStyle) {
<span class="nc" id="L1464">        ListView.MarginLayoutParams listParam = (ListView.MarginLayoutParams) getListView().getLayoutParams();</span>
<span class="nc bnc" id="L1465" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(520)) {</span>
            // Set margins for the CardViews
<span class="nc" id="L1467">            listParam.bottomMargin = UIUtils.dpToPixels(getActivity(), 2);</span>
        }
<span class="nc bnc" id="L1469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(521)) {</span>
<span class="nc" id="L1470">            listParam.topMargin = UIUtils.dpToPixels(getActivity(), 3);</span>
        }
<span class="nc bnc" id="L1472" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(522)) {</span>
<span class="nc" id="L1473">            listParam.leftMargin = UIUtils.dpToPixels(getActivity(), 5);</span>
        }
<span class="nc bnc" id="L1475" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(523)) {</span>
<span class="nc" id="L1476">            listParam.rightMargin = UIUtils.dpToPixels(getActivity(), 5);</span>
        }
<span class="nc bnc" id="L1478" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(524)) {</span>
            // Set the listview background to give the cards more contrast
<span class="nc" id="L1480">            getListView().getRootView().setBackgroundColor(getResources().getColor(R.color.stop_info_arrival_list_background));</span>
        }
<span class="nc bnc" id="L1482" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(525)) {</span>
            // Update the layout parameters
<span class="nc" id="L1484">            getListView().setLayoutParams(listParam);</span>
        }
<span class="nc" id="L1486">    }</span>

    /**
     * Instantiates the adapter based on the style to be used
     *
     * @param arrivalInfoStyle the adapter style to use - should be one of the
     *                         BuildFlavorUtil.ARRIVAL_INFO_STYLE_* contants
     */
    private void instantiateAdapter(int arrivalInfoStyle) {
<span class="nc bnc" id="L1495" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(531)) {</span>
<span class="nc bnc" id="L1496" title="All 2 branches missed.">            if (UIUtils.canSupportArrivalInfoStyleB()) {</span>
<span class="nc bnc" id="L1497" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(530)) {</span>
<span class="nc bnc" id="L1498" title="All 3 branches missed.">                    switch(arrivalInfoStyle) {</span>
                        case BuildFlavorUtils.ARRIVAL_INFO_STYLE_A:
<span class="nc bnc" id="L1500" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(527)) {</span>
<span class="nc" id="L1501">                                mAdapter = new ArrivalsListAdapterStyleA(getActivity());</span>
                            }
                            break;
                        case BuildFlavorUtils.ARRIVAL_INFO_STYLE_B:
<span class="nc bnc" id="L1505" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(528)) {</span>
<span class="nc" id="L1506">                                mAdapter = new ArrivalsListAdapterStyleB(getActivity());</span>
                            }
<span class="nc bnc" id="L1508" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(529)) {</span>
<span class="nc" id="L1509">                                ((ArrivalsListAdapterStyleB) mAdapter).setFragment(this);</span>
                            }
<span class="nc" id="L1511">                            break;</span>
                    }
                }
            } else {
<span class="nc bnc" id="L1515" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(526)) {</span>
                    // Always use Style A on Gingerbread
<span class="nc" id="L1517">                    mAdapter = new ArrivalsListAdapterStyleA(getActivity());</span>
                }
            }
        }
<span class="nc bnc" id="L1521" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(532)) {</span>
            // We present arrivals as cards, so hide the divider in the listview
<span class="nc" id="L1523">            getListView().setDivider(null);</span>
        }
<span class="nc bnc" id="L1525" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(533)) {</span>
<span class="nc" id="L1526">            setListAdapter(mAdapter);</span>
        }
<span class="nc" id="L1528">    }</span>

    private void showSortByDialog() {
<span class="nc bnc" id="L1531" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(535)) {</span>
            // Do callback when user taps on button, so they can see result of dialog selection
<span class="nc bnc" id="L1533" title="All 2 branches missed.">            if (mListener != null) {</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(534)) {</span>
<span class="nc" id="L1535">                    mListener.onSortBySelected();</span>
                }
            }
        }
<span class="nc" id="L1539">        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());</span>
<span class="nc bnc" id="L1540" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(536)) {</span>
<span class="nc" id="L1541">            builder.setTitle(R.string.menu_option_sort_by);</span>
        }
<span class="nc" id="L1543">        int currentArrivalInfoStyle = BuildFlavorUtils.getArrivalInfoStyleFromPreferences();</span>
<span class="nc bnc" id="L1544" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(557)) {</span>
<span class="nc" id="L1545">            builder.setSingleChoiceItems(R.array.sort_arrivals, currentArrivalInfoStyle, new DialogInterface.OnClickListener() {</span>

                public void onClick(DialogInterface dialog, int index) {
<span class="nc bnc" id="L1548" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(551)) {</span>
<span class="nc bnc" id="L1549" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(541) ? (index &gt;= 0) : (ListenerUtil.mutListener.listen(540) ? (index &lt;= 0) : (ListenerUtil.mutListener.listen(539) ? (index &gt; 0) : (ListenerUtil.mutListener.listen(538) ? (index &lt; 0) : (ListenerUtil.mutListener.listen(537) ? (index != 0) : (index == 0))))))) {</span>
<span class="nc bnc" id="L1550" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(549)) {</span>
                                // Sort by eta
<span class="nc" id="L1552">                                Log.d(TAG, &quot;Sort by ETA&quot;);</span>
                            }
<span class="nc bnc" id="L1554" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(550)) {</span>
<span class="nc" id="L1555">                                ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_sort_by_eta_arrival), null);</span>
                            }
<span class="nc bnc" id="L1557" title="All 22 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(546) ? (index &gt;= 1) : (ListenerUtil.mutListener.listen(545) ? (index &lt;= 1) : (ListenerUtil.mutListener.listen(544) ? (index &gt; 1) : (ListenerUtil.mutListener.listen(543) ? (index &lt; 1) : (ListenerUtil.mutListener.listen(542) ? (index != 1) : (index == 1))))))) {</span>
<span class="nc bnc" id="L1558" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(547)) {</span>
                                // Sort by route
<span class="nc" id="L1560">                                Log.d(TAG, &quot;Sort by route&quot;);</span>
                            }
<span class="nc bnc" id="L1562" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(548)) {</span>
<span class="nc" id="L1563">                                ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_sort_by_route_arrival), null);</span>
                            }
                        }
                    }
<span class="nc" id="L1567">                    String[] styles = getResources().getStringArray(R.array.arrival_info_style_options);</span>
<span class="nc bnc" id="L1568" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(552)) {</span>
<span class="nc" id="L1569">                        PreferenceUtils.saveString(getResources().getString(R.string.preference_key_arrival_info_style), styles[index]);</span>
                    }
<span class="nc bnc" id="L1571" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(553)) {</span>
<span class="nc" id="L1572">                        checkAdapterStylePreference();</span>
                    }
<span class="nc bnc" id="L1574" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(554)) {</span>
<span class="nc" id="L1575">                        refreshLocal();</span>
                    }
<span class="nc bnc" id="L1577" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(555)) {</span>
<span class="nc" id="L1578">                        getLoaderManager().restartLoader(TRIPS_FOR_STOP_LOADER, null, mTripsForStopCallback);</span>
                    }
<span class="nc bnc" id="L1580" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(556)) {</span>
<span class="nc" id="L1581">                        dialog.dismiss();</span>
                    }
<span class="nc" id="L1583">                }</span>
            });
        }
<span class="nc" id="L1586">        AlertDialog dialog = builder.create();</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(558)) {</span>
<span class="nc" id="L1588">            dialog.setOwnerActivity(getActivity());</span>
        }
<span class="nc bnc" id="L1590" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(559)) {</span>
<span class="nc" id="L1591">            dialog.show();</span>
        }
<span class="nc" id="L1593">    }</span>

    /**
     * Toggle the visibility of arrivals in the header
     */
    private void doShowHideHeaderArrivals() {
<span class="nc bnc" id="L1599" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(560)) {</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">            if (mHeader == null) {</span>
<span class="nc" id="L1601">                return;</span>
            }
        }
<span class="nc" id="L1604">        boolean showArrivals = Application.getPrefs().getBoolean(getString(R.string.preference_key_show_header_arrivals), false);</span>
<span class="nc bnc" id="L1605" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(565)) {</span>
<span class="nc bnc" id="L1606" title="All 2 branches missed.">            if (showArrivals) {</span>
<span class="nc bnc" id="L1607" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(563)) {</span>
                    // Currently we're showing arrivals in header - we need to remove them
<span class="nc" id="L1609">                    mHeader.showArrivals(false);</span>
                }
<span class="nc bnc" id="L1611" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(564)) {</span>
<span class="nc" id="L1612">                    ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_hide_arrivals_in_header), null);</span>
                }
            } else {
<span class="nc bnc" id="L1615" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(561)) {</span>
                    // Currently we're hiding arrivals - we need to show them
<span class="nc" id="L1617">                    mHeader.showArrivals(true);</span>
                }
<span class="nc bnc" id="L1619" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(562)) {</span>
<span class="nc" id="L1620">                    ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_label_show_arrivals_in_header), null);</span>
                }
            }
        }
<span class="nc bnc" id="L1624" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(566)) {</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">            PreferenceUtils.saveBoolean(getResources().getString(R.string.preference_key_show_header_arrivals), !showArrivals);</span>
        }
<span class="nc bnc" id="L1627" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(567)) {</span>
<span class="nc" id="L1628">            mHeader.refresh();</span>
        }
<span class="nc" id="L1630">    }</span>

    private void showRoutesFilterDialog() {
<span class="nc" id="L1633">        ObaArrivalInfoResponse response = getArrivalsLoader().getLastGoodResponse();</span>
<span class="nc" id="L1634">        final List&lt;ObaRoute&gt; routes = response.getRoutes(mStop.getRouteIds());</span>
<span class="nc" id="L1635">        final int len = routes.size();</span>
<span class="nc" id="L1636">        final ArrayList&lt;String&gt; filter = mRoutesFilter;</span>
        // mRouteIds = new ArrayList&lt;String&gt;(len);
<span class="nc" id="L1638">        String[] items = new String[len];</span>
<span class="nc" id="L1639">        boolean[] checks = new boolean[len];</span>
<span class="nc bnc" id="L1640" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(576)) {</span>
            {
<span class="nc" id="L1642">                long _loopCounter4 = 0;</span>
                // For each stop, if it is in the enabled list, mark it as checked.
<span class="nc bnc" id="L1644" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(575) ? (i &gt;= len) : (ListenerUtil.mutListener.listen(574) ? (i &lt;= len) : (ListenerUtil.mutListener.listen(573) ? (i &gt; len) : (ListenerUtil.mutListener.listen(572) ? (i != len) : (ListenerUtil.mutListener.listen(571) ? (i == len) : (i &lt; len)))))); ++i) {</span>
<span class="nc" id="L1645">                    ListenerUtil.loopListener.listen(&quot;_loopCounter4&quot;, ++_loopCounter4);</span>
<span class="nc" id="L1646">                    final ObaRoute route = routes.get(i);</span>
<span class="nc bnc" id="L1647" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(568)) {</span>
                        // mRouteIds.add(i, id);
<span class="nc" id="L1649">                        items[i] = UIUtils.getRouteDisplayName(route);</span>
                    }
<span class="nc bnc" id="L1651" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(570)) {</span>
<span class="nc bnc" id="L1652" title="All 2 branches missed.">                        if (filter.contains(route.getId())) {</span>
<span class="nc bnc" id="L1653" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(569)) {</span>
<span class="nc" id="L1654">                                checks[i] = true;</span>
                            }
                        }
                    }
                }
            }
        }
        // Arguments
<span class="nc" id="L1662">        Bundle args = new Bundle();</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(577)) {</span>
<span class="nc" id="L1664">            args.putStringArray(RoutesFilterDialog.ITEMS, items);</span>
        }
<span class="nc bnc" id="L1666" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(578)) {</span>
<span class="nc" id="L1667">            args.putBooleanArray(RoutesFilterDialog.CHECKS, checks);</span>
        }
<span class="nc" id="L1669">        RoutesFilterDialog frag = new RoutesFilterDialog();</span>
<span class="nc bnc" id="L1670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(579)) {</span>
<span class="nc" id="L1671">            frag.setArguments(args);</span>
        }
<span class="nc bnc" id="L1673" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(580)) {</span>
<span class="nc" id="L1674">            frag.show(getActivity().getSupportFragmentManager(), &quot;.RoutesFilterDialog&quot;);</span>
        }
<span class="nc" id="L1676">    }</span>

    private void showStopDetailsDialog() {
        // Create dialog contents
<span class="nc" id="L1680">        String stopCode = null;</span>
<span class="nc bnc" id="L1681" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(582)) {</span>
<span class="nc bnc" id="L1682" title="All 2 branches missed.">            if (mStop != null) {</span>
<span class="nc bnc" id="L1683" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(581)) {</span>
<span class="nc" id="L1684">                    stopCode = mStop.getStopCode();</span>
                }
            }
        }
<span class="nc" id="L1688">        Pair stopDetails = UIUtils.createStopDetailsDialogText(getContext(), getStopName(), getUserStopName(), stopCode, getStopDirection(), getRouteDisplayNames());</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(583)) {</span>
<span class="nc" id="L1690">            UIUtils.buildAlertDialog(getContext(), (String) stopDetails.first, (String) stopDetails.second).show();</span>
        }
<span class="nc bnc" id="L1692" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(584)) {</span>
<span class="nc" id="L1693">            ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getActivity().getString(R.string.analytics_label_button_press_stop_details), null);</span>
        }
<span class="nc" id="L1695">    }</span>

    /**
     * Sets the listener
     *
     * @param listener the listener
     */
    public void setListener(Listener listener) {
<span class="nc bnc" id="L1703" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(585)) {</span>
<span class="nc" id="L1704">            this.mListener = listener;</span>
        }
<span class="nc" id="L1706">    }</span>

    private void setupHeader(Bundle bundle) {
<span class="nc bnc" id="L1709" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(587)) {</span>
<span class="nc bnc" id="L1710" title="All 2 branches missed.">            if (bundle != null) {</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(586)) {</span>
<span class="nc" id="L1712">                    mExternalHeader = bundle.getBoolean(EXTERNAL_HEADER);</span>
                }
            }
        }
<span class="nc bnc" id="L1716" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(596)) {</span>
<span class="nc bnc" id="L1717" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(588) ? (mHeader == null || !mExternalHeader) : (mHeader == null &amp;&amp; !mExternalHeader))) {</span>
<span class="nc bnc" id="L1718" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(590)) {</span>
                    // by the Activity via setHeader()
<span class="nc" id="L1720">                    mHeader = new ArrivalsListHeader(getActivity(), this, getFragmentManager());</span>
                }
<span class="nc bnc" id="L1722" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(591)) {</span>
<span class="nc" id="L1723">                    mHeaderView = getView().findViewById(R.id.arrivals_list_header);</span>
                }
<span class="nc bnc" id="L1725" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(592)) {</span>
<span class="nc" id="L1726">                    mHeader.initView(mHeaderView);</span>
                }
<span class="nc bnc" id="L1728" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(593)) {</span>
<span class="nc" id="L1729">                    mHeader.showExpandCollapseIndicator(false);</span>
                }
<span class="nc bnc" id="L1731" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(594)) {</span>
                    // Header is not in a sliding panel, so set collapsed state to false
<span class="nc" id="L1733">                    mHeader.setSlidingPanelCollapsed(false);</span>
                }
                // Show or hide the header arrivals based on user preference
<span class="nc" id="L1736">                boolean showArrivals = Application.getPrefs().getBoolean(getString(R.string.preference_key_show_header_arrivals), false);</span>
<span class="nc bnc" id="L1737" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(595)) {</span>
<span class="nc" id="L1738">                    mHeader.showArrivals(showArrivals);</span>
                }
<span class="nc" id="L1740">            } else {</span>
<span class="nc bnc" id="L1741" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(589)) {</span>
                    // The header is in another layout (e.g., sliding panel), so we need to remove the header in this layout
<span class="nc" id="L1743">                    getView().findViewById(R.id.arrivals_list_header).setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L1747" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(598)) {</span>
<span class="nc bnc" id="L1748" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L1749" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(597)) {</span>
<span class="nc" id="L1750">                    mHeader.refresh();</span>
                }
            }
        }
<span class="nc" id="L1754">    }</span>

<span class="nc" id="L1756">    public static class RoutesFilterDialog extends DialogFragment implements OnMultiChoiceClickListener, DialogInterface.OnClickListener {</span>

        static final String ITEMS = &quot;.items&quot;;

        static final String CHECKS = &quot;.checks&quot;;

        private boolean[] mChecks;

        @Override
        public Dialog onCreateDialog(Bundle savedInstanceState) {
<span class="nc" id="L1766">            Bundle args = getArguments();</span>
<span class="nc" id="L1767">            String[] items = args.getStringArray(ITEMS);</span>
<span class="nc bnc" id="L1768" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(599)) {</span>
<span class="nc" id="L1769">                mChecks = args.getBooleanArray(CHECKS);</span>
            }
<span class="nc bnc" id="L1771" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(601)) {</span>
<span class="nc bnc" id="L1772" title="All 2 branches missed.">                if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L1773" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(600)) {</span>
<span class="nc" id="L1774">                        mChecks = args.getBooleanArray(CHECKS);</span>
                    }
                }
            }
<span class="nc" id="L1778">            AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());</span>
<span class="nc" id="L1779">            return builder.setTitle(R.string.stop_info_filter_title).setMultiChoiceItems(items, mChecks, this).setPositiveButton(R.string.stop_info_save, this).setNegativeButton(R.string.stop_info_cancel, null).create();</span>
        }

        @Override
        public void onSaveInstanceState(Bundle outState) {
<span class="nc bnc" id="L1784" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(602)) {</span>
<span class="nc" id="L1785">                outState.putBooleanArray(CHECKS, mChecks);</span>
            }
<span class="nc" id="L1787">        }</span>

        @Override
        public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L1791">            Activity act = getActivity();</span>
<span class="nc" id="L1792">            ArrivalsListFragment frag = null;</span>
<span class="nc bnc" id="L1793" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(605)) {</span>
                // Get the fragment we want...
<span class="nc bnc" id="L1795" title="All 2 branches missed.">                if (act instanceof ArrivalsListActivity) {</span>
<span class="nc bnc" id="L1796" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(604)) {</span>
<span class="nc" id="L1797">                        frag = ((ArrivalsListActivity) act).getArrivalsListFragment();</span>
                    }
<span class="nc bnc" id="L1799" title="All 2 branches missed.">                } else if (act instanceof HomeActivity) {</span>
<span class="nc bnc" id="L1800" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(603)) {</span>
<span class="nc" id="L1801">                        frag = ((HomeActivity) act).getArrivalsListFragment();</span>
                    }
                }
            }
<span class="nc bnc" id="L1805" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(606)) {</span>
<span class="nc" id="L1806">                frag.setRoutesFilter(mChecks);</span>
            }
<span class="nc bnc" id="L1808" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(607)) {</span>
<span class="nc" id="L1809">                dialog.dismiss();</span>
            }
<span class="nc" id="L1811">        }</span>

        @Override
        public void onClick(DialogInterface arg0, int which, boolean isChecked) {
<span class="nc bnc" id="L1815" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(608)) {</span>
<span class="nc" id="L1816">                mChecks[which] = isChecked;</span>
            }
<span class="nc" id="L1818">        }</span>
    }

    private void setRoutesFilter(boolean[] checks) {
<span class="nc" id="L1822">        final int len = checks.length;</span>
<span class="nc" id="L1823">        final ArrayList&lt;String&gt; newFilter = new ArrayList&lt;String&gt;(len);</span>
<span class="nc" id="L1824">        ObaArrivalInfoResponse response = getArrivalsLoader().getLastGoodResponse();</span>
<span class="nc" id="L1825">        final List&lt;ObaRoute&gt; routes = response.getRoutes(mStop.getRouteIds());</span>
<span class="nc bnc" id="L1826" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(609)) {</span>
<span class="nc bnc" id="L1827" title="All 2 branches missed.">            if (routes.size() != len) {</span>
<span class="nc" id="L1828">                throw new IllegalArgumentException(&quot;checks.length must be equal to routes.size()&quot;);</span>
            }
        }
<span class="nc bnc" id="L1831" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(617)) {</span>
            {
<span class="nc" id="L1833">                long _loopCounter5 = 0;</span>
<span class="nc bnc" id="L1834" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(616) ? (i &gt;= len) : (ListenerUtil.mutListener.listen(615) ? (i &lt;= len) : (ListenerUtil.mutListener.listen(614) ? (i &gt; len) : (ListenerUtil.mutListener.listen(613) ? (i != len) : (ListenerUtil.mutListener.listen(612) ? (i == len) : (i &lt; len)))))); ++i) {</span>
<span class="nc" id="L1835">                    ListenerUtil.loopListener.listen(&quot;_loopCounter5&quot;, ++_loopCounter5);</span>
<span class="nc" id="L1836">                    final ObaRoute route = routes.get(i);</span>
<span class="nc bnc" id="L1837" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(611)) {</span>
<span class="nc bnc" id="L1838" title="All 2 branches missed.">                        if (checks[i]) {</span>
<span class="nc bnc" id="L1839" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(610)) {</span>
<span class="nc" id="L1840">                                newFilter.add(route.getId());</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1847" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(624)) {</span>
            // don't select any.
<span class="nc bnc" id="L1849" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(622) ? (newFilter.size() &gt;= len) : (ListenerUtil.mutListener.listen(621) ? (newFilter.size() &lt;= len) : (ListenerUtil.mutListener.listen(620) ? (newFilter.size() &gt; len) : (ListenerUtil.mutListener.listen(619) ? (newFilter.size() &lt; len) : (ListenerUtil.mutListener.listen(618) ? (newFilter.size() != len) : (newFilter.size() == len))))))) {</span>
<span class="nc bnc" id="L1850" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(623)) {</span>
<span class="nc" id="L1851">                    newFilter.clear();</span>
                }
            }
        }
<span class="nc bnc" id="L1855" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(625)) {</span>
<span class="nc" id="L1856">            setRoutesFilter(newFilter);</span>
        }
<span class="nc" id="L1858">    }</span>

    // 
    private void goToTrip(ArrivalInfo stop) {
<span class="nc" id="L1862">        ObaArrivalInfo stopInfo = stop.getInfo();</span>
<span class="nc bnc" id="L1863" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(626)) {</span>
<span class="nc" id="L1864">            TripInfoActivity.start(getActivity(), stopInfo.getTripId(), mStopId, stopInfo.getRouteId(), stopInfo.getShortName(), mStop.getName(), stopInfo.getScheduledDepartureTime(), stopInfo.getHeadsign());</span>
        }
<span class="nc" id="L1866">    }</span>

    private void goToTripDetails(ArrivalInfo stop) {
<span class="nc bnc" id="L1869" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(627)) {</span>
<span class="nc" id="L1870">            TripDetailsActivity.start(getActivity(), stop.getInfo().getTripId(), stop.getInfo().getStopId(), TripDetailsListFragment.SCROLL_MODE_STOP);</span>
        }
<span class="nc" id="L1872">    }</span>

    private void goToRoute(ArrivalInfo stop) {
<span class="nc bnc" id="L1875" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(628)) {</span>
<span class="nc" id="L1876">            RouteInfoActivity.start(getActivity(), stop.getInfo().getRouteId());</span>
        }
<span class="nc" id="L1878">    }</span>

    // 
    private ArrivalsListLoader getArrivalsLoader() {
<span class="nc bnc" id="L1882" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(629)) {</span>
            // If the Fragment hasn't been attached to an Activity yet, return null
<span class="nc bnc" id="L1884" title="All 2 branches missed.">            if (!isAdded()) {</span>
<span class="nc" id="L1885">                return null;</span>
            }
        }
<span class="nc" id="L1888">        Loader&lt;ObaArrivalInfoResponse&gt; l = getLoaderManager().getLoader(ARRIVALS_LIST_LOADER);</span>
<span class="nc" id="L1889">        return (ArrivalsListLoader) l;</span>
    }

    @Override
    public void setEmptyText(CharSequence text) {
<span class="nc" id="L1894">        TextView noArrivals = (TextView) mEmptyList.findViewById(R.id.noArrivals);</span>
<span class="nc bnc" id="L1895" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(630)) {</span>
<span class="nc" id="L1896">            noArrivals.setText(text);</span>
        }
<span class="nc" id="L1898">    }</span>

    private void loadMoreArrivals() {
<span class="nc bnc" id="L1901" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(631)) {</span>
<span class="nc" id="L1902">            getArrivalsLoader().incrementMinutesAfter();</span>
        }
<span class="nc bnc" id="L1904" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(632)) {</span>
<span class="nc" id="L1905">            mLoadedMoreArrivals = true;</span>
        }
<span class="nc bnc" id="L1907" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(633)) {</span>
<span class="nc" id="L1908">            refresh();</span>
        }
<span class="nc bnc" id="L1910" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(634)) {</span>
<span class="nc" id="L1911">            ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getActivity().getString(R.string.analytics_label_load_more_arrivals), null);</span>
        }
<span class="nc" id="L1913">    }</span>

    /**
     * Full refresh of data from the OBA server
     */
    public void refresh() {
<span class="nc bnc" id="L1919" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(639)) {</span>
<span class="nc bnc" id="L1920" title="All 2 branches missed.">            if (isAdded()) {</span>
<span class="nc bnc" id="L1921" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(635)) {</span>
<span class="nc" id="L1922">                    showProgress(true);</span>
                }
                // ArrivalsListLoader before onLoadFinished() is called
<span class="nc" id="L1925">                ObaArrivalInfoResponse lastGood = getArrivalsLoader().getLastGoodResponse();</span>
<span class="nc bnc" id="L1926" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(637)) {</span>
<span class="nc bnc" id="L1927" title="All 2 branches missed.">                    if (lastGood != null) {</span>
<span class="nc bnc" id="L1928" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(636)) {</span>
<span class="nc" id="L1929">                            mLastResponseLength = lastGood.getArrivalInfo().length;</span>
                        }
                    }
                }
<span class="nc bnc" id="L1933" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(638)) {</span>
<span class="nc" id="L1934">                    getArrivalsLoader().onContentChanged();</span>
                }
            }
        }
<span class="nc" id="L1938">    }</span>

    /**
     * Refreshes ListFragment content using the most recent server response.  Does not trigger
     * another call to the OBA server.
     */
    public void refreshLocal() {
<span class="nc" id="L1945">        ArrivalsListLoader loader = getArrivalsLoader();</span>
<span class="nc bnc" id="L1946" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(642)) {</span>
<span class="nc bnc" id="L1947" title="All 2 branches missed.">            if (loader != null) {</span>
<span class="nc" id="L1948">                ObaArrivalInfoResponse response = loader.getLastGoodResponse();</span>
<span class="nc bnc" id="L1949" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(640)) {</span>
<span class="nc bnc" id="L1950" title="All 2 branches missed.">                    if (response == null) {</span>
                        // Nothing to refresh yet
<span class="nc" id="L1952">                        return;</span>
                    }
                }
<span class="nc bnc" id="L1955" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(641)) {</span>
<span class="nc" id="L1956">                    mAdapter.setData(response.getArrivalInfo(), mRoutesFilter, System.currentTimeMillis());</span>
                }
            }
        }
<span class="nc bnc" id="L1960" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(644)) {</span>
<span class="nc bnc" id="L1961" title="All 2 branches missed.">            if (mHeader != null) {</span>
<span class="nc bnc" id="L1962" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(643)) {</span>
<span class="nc" id="L1963">                    mHeader.refresh();</span>
                }
            }
        }
<span class="nc" id="L1967">    }</span>

<span class="nc" id="L1969">    private final Handler mRefreshHandler = new Handler();</span>

<span class="nc" id="L1971">    private final Runnable mRefresh = new Runnable() {</span>

        public void run() {
<span class="nc bnc" id="L1974" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(645)) {</span>
<span class="nc" id="L1975">                refresh();</span>
            }
<span class="nc" id="L1977">        }</span>
    };

    private void setStopId() {
<span class="nc" id="L1981">        Uri uri = (Uri) getArguments().getParcelable(FragmentUtils.URI);</span>
<span class="nc bnc" id="L1982" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(647)) {</span>
<span class="nc bnc" id="L1983" title="All 2 branches missed.">            if (uri == null) {</span>
<span class="nc bnc" id="L1984" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(646)) {</span>
<span class="nc" id="L1985">                    Log.e(TAG, &quot;No URI in arguments&quot;);</span>
                }
<span class="nc" id="L1987">                return;</span>
            }
        }
<span class="nc bnc" id="L1990" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(648)) {</span>
<span class="nc" id="L1991">            mStopId = uri.getLastPathSegment();</span>
        }
<span class="nc bnc" id="L1993" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(649)) {</span>
<span class="nc" id="L1994">            mStopUri = uri;</span>
        }
<span class="nc" id="L1996">    }</span>

<span class="nc" id="L1998">    private static final String[] USER_PROJECTION = { ObaContract.Stops.FAVORITE, ObaContract.Stops.USER_NAME };</span>

    private void setUserInfo() {
<span class="nc" id="L2001">        ContentResolver cr = getActivity().getContentResolver();</span>
<span class="nc" id="L2002">        Cursor c = cr.query(mStopUri, USER_PROJECTION, null, null, null);</span>
<span class="nc bnc" id="L2003" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(654)) {</span>
<span class="nc bnc" id="L2004" title="All 2 branches missed.">            if (c != null) {</span>
                try {
<span class="nc bnc" id="L2006" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(653)) {</span>
<span class="nc bnc" id="L2007" title="All 2 branches missed.">                        if (c.moveToNext()) {</span>
<span class="nc bnc" id="L2008" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(651)) {</span>
<span class="nc bnc" id="L2009" title="All 2 branches missed.">                                mFavorite = (c.getInt(0) == 1);</span>
                            }
<span class="nc bnc" id="L2011" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(652)) {</span>
<span class="nc" id="L2012">                                mStopUserName = c.getString(1);</span>
                            }
                        }
                    }
                } finally {
<span class="nc bnc" id="L2017" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(650)) {</span>
<span class="nc" id="L2018">                        c.close();</span>
                    }
                }
            }
        }
<span class="nc" id="L2023">    }</span>

<span class="nc" id="L2025">    private static final String[] TRIPS_PROJECTION = { ObaContract.Trips._ID, ObaContract.Trips.NAME };</span>

    // 
<span class="nc" id="L2028">    private class TripsForStopCallback implements LoaderManager.LoaderCallbacks&lt;Cursor&gt; {</span>

        @Override
        public Loader&lt;Cursor&gt; onCreateLoader(int id, Bundle args) {
<span class="nc" id="L2032">            return new CursorLoader(getActivity(), ObaContract.Trips.CONTENT_URI, TRIPS_PROJECTION, ObaContract.Trips.STOP_ID + &quot;=?&quot;, new String[] { mStopId }, null);</span>
        }

        @Override
        public void onLoadFinished(Loader&lt;Cursor&gt; loader, Cursor c) {
<span class="nc" id="L2037">            ContentQueryMap map = new ContentQueryMap(c, ObaContract.Trips._ID, true, null);</span>
<span class="nc bnc" id="L2038" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(655)) {</span>
                // Call back into the adapter and header and say we've finished this.
<span class="nc" id="L2040">                mAdapter.setTripsForStop(map);</span>
            }
<span class="nc bnc" id="L2042" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(657)) {</span>
<span class="nc bnc" id="L2043" title="All 2 branches missed.">                if (mHeader != null) {</span>
<span class="nc bnc" id="L2044" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(656)) {</span>
<span class="nc" id="L2045">                        mHeader.setTripsForStop(map);</span>
                    }
                }
            }
<span class="nc" id="L2049">        }</span>

        @Override
        public void onLoaderReset(Loader&lt;Cursor&gt; loader) {
<span class="nc" id="L2053">        }</span>
    }

    // 
    private class SituationAlert implements AlertList.Alert {

        private final ObaSituation mSituation;

<span class="nc" id="L2061">        SituationAlert(ObaSituation situation) {</span>
<span class="nc" id="L2062">            mSituation = situation;</span>
<span class="nc" id="L2063">        }</span>

        @Override
        public String getId() {
<span class="nc" id="L2067">            return mSituation.getId();</span>
        }

        @Override
        public int getType() {
<span class="nc bnc" id="L2072" title="All 2 branches missed.">            if (ObaSituation.SEVERITY_NO_IMPACT.equals(mSituation.getSeverity())) {</span>
<span class="nc" id="L2073">                return TYPE_INFO;</span>
<span class="nc bnc" id="L2074" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(658) ? (ObaSituation.SEVERITY_SEVERE.equals(mSituation.getSeverity()) &amp;&amp; ObaSituation.SEVERITY_VERY_SEVERE.equals(mSituation.getSeverity())) : (ObaSituation.SEVERITY_SEVERE.equals(mSituation.getSeverity()) || ObaSituation.SEVERITY_VERY_SEVERE.equals(mSituation.getSeverity())))) {</span>
<span class="nc" id="L2075">                return TYPE_ERROR;</span>
            } else {
                // Treat all other ObaSituation.SEVERITY_* types as a warning
<span class="nc" id="L2078">                return TYPE_WARNING;</span>
            }
        }

        @Override
        public int getFlags() {
<span class="nc" id="L2084">            return FLAG_HASMORE;</span>
        }

        @Override
        public CharSequence getString() {
<span class="nc" id="L2089">            return mSituation.getSummary();</span>
        }

        @Override
        public void onClick() {
<span class="nc" id="L2094">            SituationDialogFragment dialog = SituationDialogFragment.newInstance(mSituation);</span>
<span class="nc bnc" id="L2095" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(662)) {</span>
<span class="nc" id="L2096">                dialog.setListener(new SituationDialogFragment.Listener() {</span>

                    @Override
                    public void onDismiss(boolean isAlertHidden) {
<span class="nc bnc" id="L2100" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(660)) {</span>
<span class="nc bnc" id="L2101" title="All 2 branches missed.">                            if (isAlertHidden) {</span>
<span class="nc bnc" id="L2102" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(659)) {</span>
                                    // TODO - refreshLocal() should support refreshing local situations
<span class="nc" id="L2104">                                    refresh();</span>
                                }
                            }
                        }
<span class="nc" id="L2108">                    }</span>

                    @Override
                    public void onUndo() {
<span class="nc bnc" id="L2112" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(661)) {</span>
                            // TODO - refreshLocal() should support refreshing local situations
<span class="nc" id="L2114">                            refresh();</span>
                        }
<span class="nc" id="L2116">                    }</span>
                });
            }
<span class="nc bnc" id="L2119" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(663)) {</span>
<span class="nc" id="L2120">                dialog.show(getFragmentManager(), SituationDialogFragment.TAG);</span>
            }
<span class="nc bnc" id="L2122" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(664)) {</span>
<span class="nc" id="L2123">                reportAnalytics(mSituation);</span>
            }
<span class="nc" id="L2125">        }</span>

        @Override
        public int hashCode() {
<span class="nc" id="L2129">            return getId().hashCode();</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L2134" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(665)) {</span>
<span class="nc bnc" id="L2135" title="All 2 branches missed.">                if (this == obj) {</span>
<span class="nc" id="L2136">                    return true;</span>
                }
            }
<span class="nc bnc" id="L2139" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(666)) {</span>
<span class="nc bnc" id="L2140" title="All 2 branches missed.">                if (obj == null) {</span>
<span class="nc" id="L2141">                    return false;</span>
                }
            }
<span class="nc bnc" id="L2144" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(667)) {</span>
<span class="nc bnc" id="L2145" title="All 2 branches missed.">                if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L2146">                    return false;</span>
                }
            }
<span class="nc" id="L2149">            SituationAlert other = (SituationAlert) obj;</span>
<span class="nc bnc" id="L2150" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(668)) {</span>
<span class="nc bnc" id="L2151" title="All 2 branches missed.">                if (!getId().equals(other.getId())) {</span>
<span class="nc" id="L2152">                    return false;</span>
                }
            }
<span class="nc" id="L2155">            return true;</span>
        }
    }

    private void reportAnalytics(ObaSituation situation) {
<span class="nc" id="L2160">        ObaSituation.AllAffects[] allAffects = situation.getAllAffects();</span>
<span class="nc" id="L2161">        Set&lt;String&gt; agencyIds = new HashSet&lt;&gt;();</span>
<span class="nc bnc" id="L2162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(675)) {</span>
            {
<span class="nc" id="L2164">                long _loopCounter6 = 0;</span>
<span class="nc bnc" id="L2165" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(674) ? (i &gt;= allAffects.length) : (ListenerUtil.mutListener.listen(673) ? (i &lt;= allAffects.length) : (ListenerUtil.mutListener.listen(672) ? (i &gt; allAffects.length) : (ListenerUtil.mutListener.listen(671) ? (i != allAffects.length) : (ListenerUtil.mutListener.listen(670) ? (i == allAffects.length) : (i &lt; allAffects.length)))))); i++) {</span>
<span class="nc" id="L2166">                    ListenerUtil.loopListener.listen(&quot;_loopCounter6&quot;, ++_loopCounter6);</span>
<span class="nc bnc" id="L2167" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(669)) {</span>
<span class="nc" id="L2168">                        agencyIds.add(allAffects[i].getAgencyId());</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L2173" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(677)) {</span>
            {
<span class="nc" id="L2175">                long _loopCounter7 = 0;</span>
<span class="nc bnc" id="L2176" title="All 2 branches missed.">                for (String agencyId : agencyIds) {</span>
<span class="nc" id="L2177">                    ListenerUtil.loopListener.listen(&quot;_loopCounter7&quot;, ++_loopCounter7);</span>
<span class="nc bnc" id="L2178" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(676)) {</span>
<span class="nc" id="L2179">                        ObaAnalytics.reportUiEvent(mFirebaseAnalytics, getString(R.string.analytics_service_alerts), getString(R.string.analytics_label_service_alerts) + agencyId);</span>
                    }
<span class="nc" id="L2181">                }</span>
            }
        }
<span class="nc" id="L2184">    }</span>

    private void refreshSituations(List&lt;ObaSituation&gt; situations) {
<span class="nc bnc" id="L2187" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(680)) {</span>
            // First, remove any existing situations
<span class="nc bnc" id="L2189" title="All 2 branches missed.">            if (mSituationAlerts != null) {</span>
<span class="nc bnc" id="L2190" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(679)) {</span>
                    {
<span class="nc" id="L2192">                        long _loopCounter8 = 0;</span>
<span class="nc bnc" id="L2193" title="All 2 branches missed.">                        for (SituationAlert alert : mSituationAlerts) {</span>
<span class="nc" id="L2194">                            ListenerUtil.loopListener.listen(&quot;_loopCounter8&quot;, ++_loopCounter8);</span>
<span class="nc bnc" id="L2195" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(678)) {</span>
<span class="nc" id="L2196">                                mAlertList.remove(alert);</span>
                            }
<span class="nc" id="L2198">                        }</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L2203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(681)) {</span>
<span class="nc" id="L2204">            mAlertList.setAlertHidden(false);</span>
        }
<span class="nc bnc" id="L2206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(682)) {</span>
<span class="nc" id="L2207">            mSituationAlerts = null;</span>
        }
<span class="nc bnc" id="L2209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(683)) {</span>
<span class="nc bnc" id="L2210" title="All 2 branches missed.">            if (situations.isEmpty()) {</span>
                // The normal scenario
<span class="nc" id="L2212">                return;</span>
            }
        }
<span class="nc bnc" id="L2215" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(684)) {</span>
<span class="nc" id="L2216">            mSituationAlerts = new ArrayList&lt;&gt;();</span>
        }
<span class="nc" id="L2218">        ContentValues values = new ContentValues();</span>
<span class="nc" id="L2219">        int hiddenCount = 0;</span>
<span class="nc bnc" id="L2220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(693)) {</span>
            {
<span class="nc" id="L2222">                long _loopCounter9 = 0;</span>
<span class="nc bnc" id="L2223" title="All 2 branches missed.">                for (ObaSituation situation : situations) {</span>
<span class="nc" id="L2224">                    ListenerUtil.loopListener.listen(&quot;_loopCounter9&quot;, ++_loopCounter9);</span>
<span class="nc bnc" id="L2225" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(685)) {</span>
<span class="nc" id="L2226">                        values.clear();</span>
                    }
<span class="nc bnc" id="L2228" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(686)) {</span>
                        // Make sure this situation is added to the database
<span class="nc" id="L2230">                        ObaContract.ServiceAlerts.insertOrUpdate(situation.getId(), values, false, null);</span>
                    }
<span class="nc" id="L2232">                    boolean isActive = UIUtils.isActiveWindowForSituation(situation, System.currentTimeMillis());</span>
<span class="nc" id="L2233">                    boolean isHidden = ObaContract.ServiceAlerts.isHidden(situation.getId());</span>
<span class="nc bnc" id="L2234" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(689)) {</span>
<span class="nc bnc" id="L2235" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(687) ? (isActive || !isHidden) : (isActive &amp;&amp; !isHidden))) {</span>
<span class="nc" id="L2236">                            SituationAlert alert = new SituationAlert(situation);</span>
<span class="nc bnc" id="L2237" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(688)) {</span>
<span class="nc" id="L2238">                                mSituationAlerts.add(alert);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2242" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(692)) {</span>
<span class="nc bnc" id="L2243" title="All 2 branches missed.">                        if (isHidden) {</span>
<span class="nc bnc" id="L2244" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(690)) {</span>
<span class="nc" id="L2245">                                mAlertList.setAlertHidden(true);</span>
                            }
<span class="nc bnc" id="L2247" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(691)) {</span>
<span class="nc" id="L2248">                                hiddenCount++;</span>
                            }
                        }
                    }
<span class="nc" id="L2252">                }</span>
            }
        }
<span class="nc bnc" id="L2255" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(694)) {</span>
<span class="nc" id="L2256">            mAlertList.setHiddenAlertCount(hiddenCount);</span>
        }
<span class="nc bnc" id="L2258" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(695)) {</span>
<span class="nc" id="L2259">            mAlertList.addAll(mSituationAlerts);</span>
        }
<span class="nc" id="L2261">    }</span>

    /**
     * Creates the dialog that will be shown to the user to explain the occupancy feature
     *
     * @return the dialog that will be shown to the user to explain the occupancy feature
     */
    private Dialog createOccupancyDialog() {
<span class="nc" id="L2269">        androidx.appcompat.app.AlertDialog.Builder builder = new androidx.appcompat.app.AlertDialog.Builder(getContext());</span>
<span class="nc bnc" id="L2270" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(696)) {</span>
<span class="nc" id="L2271">            builder.setTitle(R.string.menu_title_about_occupancy);</span>
        }
<span class="nc" id="L2273">        LayoutInflater inflater = LayoutInflater.from(getContext());</span>
<span class="nc" id="L2274">        View occupancyDialogView = inflater.inflate(R.layout.occupancy_dialog, null);</span>
<span class="nc bnc" id="L2275" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(697)) {</span>
<span class="nc" id="L2276">            builder.setView(occupancyDialogView);</span>
        }
<span class="nc" id="L2278">        ViewGroup realtimeOccupancy = occupancyDialogView.findViewById(R.id.realtime_occupancy);</span>
<span class="nc" id="L2279">        ViewGroup historicalOccupancy = occupancyDialogView.findViewById(R.id.historical_occupancy);</span>
<span class="nc bnc" id="L2280" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(698)) {</span>
<span class="nc" id="L2281">            UIUtils.setOccupancyVisibilityAndColor(realtimeOccupancy, Occupancy.FULL, OccupancyState.REALTIME);</span>
        }
<span class="nc bnc" id="L2283" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(699)) {</span>
<span class="nc" id="L2284">            UIUtils.setOccupancyVisibilityAndColor(historicalOccupancy, Occupancy.FULL, OccupancyState.HISTORICAL);</span>
        }
<span class="nc bnc" id="L2286" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(700)) {</span>
<span class="nc" id="L2287">            builder.setNeutralButton(R.string.main_help_close, (dialogInterface, i) -&gt; dialogInterface.dismiss());</span>
        }
<span class="nc" id="L2289">        return builder.create();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>