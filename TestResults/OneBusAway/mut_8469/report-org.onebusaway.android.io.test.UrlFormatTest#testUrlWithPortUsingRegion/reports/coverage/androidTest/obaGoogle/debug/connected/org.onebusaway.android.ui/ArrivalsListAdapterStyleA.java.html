<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArrivalsListAdapterStyleA.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">ArrivalsListAdapterStyleA.java</span></div><h1>ArrivalsListAdapterStyleA.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012 Paul Watts (paulcwatts@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.content.ContentValues;
import android.content.Context;
import android.graphics.Paint;
import android.graphics.drawable.Drawable;
import android.graphics.drawable.GradientDrawable;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.core.graphics.drawable.DrawableCompat;

import org.onebusaway.android.R;
import org.onebusaway.android.io.elements.ObaArrivalInfo;
import org.onebusaway.android.io.elements.OccupancyState;
import org.onebusaway.android.io.elements.Status;
import org.onebusaway.android.provider.ObaContract;
import org.onebusaway.android.util.ArrivalInfoUtils;
import org.onebusaway.android.util.UIUtils;

import java.util.ArrayList;

/**
 * Original style of arrivals for OBA Android
 */
public class ArrivalsListAdapterStyleA extends ArrivalsListAdapterBase&lt;ArrivalInfo&gt; {

    public ArrivalsListAdapterStyleA(Context context) {
<span class="fc" id="L46">        super(context, R.layout.arrivals_list_item);</span>
<span class="fc" id="L47">    }</span>

    /**
     * Sets the data to be used with the adapter
     *
     * @param routesFilter routeIds to filter for
     * @param currentTime  current time in milliseconds
     */
    public void setData(ObaArrivalInfo[] arrivals, ArrayList&lt;String&gt; routesFilter,
            long currentTime) {
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">        if (arrivals != null) {</span>
<span class="fc" id="L58">            ArrayList&lt;ArrivalInfo&gt; list =</span>
<span class="fc" id="L59">                    ArrivalInfoUtils.convertObaArrivalInfo(getContext(),</span>
                            arrivals, routesFilter, currentTime, false);
<span class="fc" id="L61">            setData(list);</span>
<span class="fc" id="L62">        } else {</span>
<span class="nc" id="L63">            setData(null);</span>
        }
<span class="fc" id="L65">    }</span>

    @Override
    protected void initView(View view, ArrivalInfo stopInfo) {
<span class="fc" id="L69">        final Context context = getContext();</span>
<span class="fc" id="L70">        final ObaArrivalInfo arrivalInfo = stopInfo.getInfo();</span>

<span class="fc" id="L72">        TextView route = (TextView) view.findViewById(R.id.route);</span>
<span class="fc" id="L73">        TextView destination = (TextView) view.findViewById(R.id.destination);</span>
<span class="fc" id="L74">        TextView time = (TextView) view.findViewById(R.id.time);</span>
<span class="fc" id="L75">        TextView status = (TextView) view.findViewById(R.id.status);</span>
<span class="fc" id="L76">        TextView etaView = (TextView) view.findViewById(R.id.eta);</span>
<span class="fc" id="L77">        TextView minView = (TextView) view.findViewById(R.id.eta_min);</span>
<span class="fc" id="L78">        ViewGroup realtimeView = (ViewGroup) view.findViewById(R.id.eta_realtime_indicator);</span>
<span class="fc" id="L79">        ViewGroup occupancyView = view.findViewById(R.id.occupancy);</span>
<span class="fc" id="L80">        ImageView moreView = (ImageView) view.findViewById(R.id.more_horizontal);</span>
<span class="fc" id="L81">        moreView.setColorFilter(</span>
<span class="fc" id="L82">                context.getResources().getColor(R.color.switch_thumb_normal_material_dark));</span>
<span class="fc" id="L83">        ImageView starView = (ImageView) view.findViewById(R.id.route_favorite);</span>
<span class="fc" id="L84">        starView.setColorFilter(context.getResources().getColor(R.color.navdrawer_icon_tint));</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">        starView.setImageResource(stopInfo.isRouteAndHeadsignFavorite() ?</span>
<span class="nc" id="L86">                R.drawable.focus_star_on :</span>
<span class="fc" id="L87">                R.drawable.focus_star_off);</span>

        // CANCELED trips
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">        if (Status.CANCELED.equals(stopInfo.getStatus())) {</span>
            // Strike through the text fields
<span class="nc" id="L92">            route.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
<span class="nc" id="L93">            destination.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
<span class="nc" id="L94">            time.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
<span class="nc" id="L95">            etaView.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
<span class="nc" id="L96">            minView.setPaintFlags(Paint.STRIKE_THRU_TEXT_FLAG);</span>
        }

<span class="fc" id="L99">        String shortName = arrivalInfo.getShortName();</span>
<span class="fc" id="L100">        route.setText(shortName.trim());</span>
<span class="fc" id="L101">        UIUtils.maybeShrinkRouteName(getContext(), route, shortName.trim());</span>

<span class="fc" id="L103">        destination.setText(UIUtils.formatDisplayText(arrivalInfo.getHeadsign()));</span>
<span class="fc" id="L104">        status.setText(stopInfo.getStatusText());</span>

<span class="fc" id="L106">        long eta = stopInfo.getEta();</span>
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        if (eta == 0) {</span>
<span class="nc" id="L108">            etaView.setText(R.string.stop_info_eta_now);</span>
<span class="nc" id="L109">            minView.setVisibility(View.GONE);</span>
        } else {
<span class="fc" id="L111">            etaView.setText(String.valueOf(eta));</span>
<span class="fc" id="L112">            minView.setVisibility(View.VISIBLE);</span>
        }

<span class="fc" id="L115">        status.setBackgroundResource(R.drawable.round_corners_style_b_status);</span>
<span class="fc" id="L116">        GradientDrawable d = (GradientDrawable) status.getBackground();</span>

<span class="fc" id="L118">        Integer colorCode = stopInfo.getColor();</span>
<span class="fc" id="L119">        int color = context.getResources().getColor(colorCode);</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">        if (stopInfo.getPredicted()) {</span>
            // Show real-time indicator
<span class="fc" id="L122">            UIUtils.setRealtimeIndicatorColorByResourceCode(realtimeView, colorCode,</span>
<span class="fc" id="L123">                    android.R.color.transparent);</span>
<span class="fc" id="L124">            realtimeView.setVisibility(View.VISIBLE);</span>
        } else {
<span class="nc" id="L126">            realtimeView.setVisibility(View.INVISIBLE);</span>
        }

<span class="fc" id="L129">        etaView.setTextColor(color);</span>
<span class="fc" id="L130">        minView.setTextColor(color);</span>
<span class="fc" id="L131">        d.setColor(color);</span>

        // Set padding on status view
<span class="fc" id="L134">        int pSides = UIUtils.dpToPixels(context, 5);</span>
<span class="fc" id="L135">        int pTopBottom = UIUtils.dpToPixels(context, 2);</span>
<span class="fc" id="L136">        status.setPadding(pSides, pTopBottom, pSides, pTopBottom);</span>

<span class="fc" id="L138">        time.setText(stopInfo.getTimeText());</span>

        // Occupancy
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">        if (stopInfo.getPredictedOccupancy() != null) {</span>
            // Predicted occupancy data
<span class="nc" id="L143">            UIUtils.setOccupancyVisibilityAndColor(occupancyView, stopInfo.getPredictedOccupancy(), OccupancyState.PREDICTED);</span>
<span class="nc" id="L144">            UIUtils.setOccupancyContentDescription(occupancyView, stopInfo.getPredictedOccupancy(), OccupancyState.PREDICTED);</span>
        } else {
            // Historical occupancy data
<span class="fc" id="L147">            UIUtils.setOccupancyVisibilityAndColor(occupancyView, stopInfo.getHistoricalOccupancy(), OccupancyState.HISTORICAL);</span>
<span class="fc" id="L148">            UIUtils.setOccupancyContentDescription(occupancyView, stopInfo.getHistoricalOccupancy(), OccupancyState.HISTORICAL);</span>
        }

<span class="fc" id="L151">        ContentValues values = null;</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        if (mTripsForStop != null) {</span>
<span class="nc" id="L153">            values = mTripsForStop.getValues(arrivalInfo.getTripId());</span>
        }
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">        if (values != null) {</span>
<span class="nc" id="L156">            String reminderName = values.getAsString(ObaContract.Trips.NAME);</span>

<span class="nc" id="L158">            TextView reminder = (TextView) view.findViewById(R.id.reminder);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">            if (reminderName.length() == 0) {</span>
<span class="nc" id="L160">                reminderName = context.getString(R.string.trip_info_noname);</span>
            }
<span class="nc" id="L162">            reminder.setText(reminderName);</span>
<span class="nc" id="L163">            Drawable d2 = reminder.getCompoundDrawables()[0];</span>
<span class="nc" id="L164">            d2 = DrawableCompat.wrap(d2);</span>
<span class="nc" id="L165">            DrawableCompat.setTint(d2.mutate(),</span>
<span class="nc" id="L166">                    view.getResources().getColor(R.color.button_material_dark));</span>
<span class="nc" id="L167">            reminder.setCompoundDrawables(d2, null, null, null);</span>
<span class="nc" id="L168">            reminder.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L169">        } else {</span>
            // Explicitly set this to invisible because we might be reusing
            // this view.
<span class="fc" id="L172">            View reminder = view.findViewById(R.id.reminder);</span>
<span class="fc" id="L173">            reminder.setVisibility(View.GONE);</span>
        }
<span class="fc" id="L175">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>