<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShowcaseViewUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.util</a> &gt; <span class="el_source">ShowcaseViewUtils.java</span></div><h1>ShowcaseViewUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015-2017 University of South Florida (sjbarbeau@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.util;

import android.content.Context;
import android.content.DialogInterface;
import android.content.SharedPreferences;
import android.content.res.Resources;
import android.graphics.PorterDuff;
import android.graphics.drawable.Drawable;
import android.text.Spannable;
import android.text.SpannableString;
import android.text.style.ImageSpan;
import android.view.MotionEvent;
import android.view.ViewGroup;
import android.widget.RelativeLayout;
import androidx.annotation.DrawableRes;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.content.res.ResourcesCompat;
import com.github.amlcurran.showcaseview.OnShowcaseEventListener;
import com.github.amlcurran.showcaseview.ShowcaseView;
import com.github.amlcurran.showcaseview.targets.Target;
import com.github.amlcurran.showcaseview.targets.ViewTarget;
import org.onebusaway.android.BuildConfig;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.io.request.ObaArrivalInfoResponse;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * A class containing utility methods related to showing a tutorial to users for how to use various
 * OBA features, using the ShowcaseView library (https://github.com/amlcurran/ShowcaseView).
 */
<span class="nc" id="L48">public class ShowcaseViewUtils {</span>

    public static final String TUTORIAL_WELCOME = &quot;.tutorial_welcome&quot;;

    public static final String TUTORIAL_OPT_OUT_DIALOG = &quot;.tutorial_opt_out_dialog&quot;;

    public static final String TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO = &quot;.tutorial_arrival_header_arrival_info&quot;;

    public static final String TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL = &quot;.tutorial_arrival_header_sliding_panel&quot;;

    public static final String TUTORIAL_ARRIVAL_SORT = &quot;.tutorial_arrival_sort&quot;;

    public static final String TUTORIAL_ARRIVAL_HEADER_STAR_ROUTE = &quot;.tutorial_arrival_header_star_route&quot;;

    public static final String TUTORIAL_RECENT_STOPS_ROUTES = &quot;.tutorial_recent_stops_routes&quot;;

    public static final String TUTORIAL_STARRED_STOPS_SORT = &quot;.tutorial_starred_stops_sort&quot;;

    public static final String TUTORIAL_STARRED_STOPS_SHORTCUT = &quot;.tutorial_starred stops_shortcut&quot;;

    public static final String TUTORIAL_SEND_FEEDBACK_OPEN311_CATEGORIES = &quot;.tutorial_send_feedback_open311_categories&quot;;

    public static final String TUTORIAL_TRIP_PLAN_GEOCODER = &quot;.tutorial_trip_plan_geocoder&quot;;

    private static ShowcaseView mShowcaseView;

    /**
     * Shows the tutorial for the specified tutorialType.  This method handles checking to see if
     * other ShowcaseViews are already being shown, as well as if this tutorial has already been
     * shown - if either of these cases are true, this method is a no-op.
     *
     * @param tutorialType type of tutorial to show, defined by the TUTORIAL_* constants in
     *                     ShowcaseViewUtils
     * @param activity     activity used to show the tutorial
     * @param response     The response that contains arrival info, or null if this is not available.
     *                     Some tutorials require that arrival info is showing - these tutorials
     *                     will only be displayed if arrival info is provided in this parameter.
     * @param alwaysShow   true if the tutorial should be shown to the user even if they chose to
     *                     turn off tutorials, false if we should follow the user preference
     */
    public static synchronized void showTutorial(String tutorialType, final AppCompatActivity activity, final ObaArrivalInfoResponse response, boolean alwaysShow) {
<span class="nc bnc" id="L89" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7988)) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">            if (activity == null) {</span>
<span class="nc" id="L91">                return;</span>
            }
        }
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7990)) {</span>
<span class="nc bnc" id="L95" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7989) ? (isShowcaseViewShowing() || !tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL)) : (isShowcaseViewShowing() &amp;&amp; !tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL)))) {</span>
                // closes) should pass this point - otherwise, return
<span class="nc" id="L97">                return;</span>
            }
        }
<span class="nc" id="L100">        SharedPreferences settings = Application.getPrefs();</span>
        // If user has opted out of tutorials, do nothing
<span class="nc" id="L102">        boolean showTutorials = settings.getBoolean(activity.getString(R.string.preference_key_show_tutorial_screens), true);</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7992)) {</span>
<span class="nc bnc" id="L104" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7991) ? (!showTutorials || !alwaysShow) : (!showTutorials &amp;&amp; !alwaysShow))) {</span>
<span class="nc" id="L105">                return;</span>
            }
        }
        // If we've already shown this tutorial to the user, do nothing
<span class="nc" id="L109">        boolean showedThisTutorial = settings.getBoolean(tutorialType, false);</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7993)) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            if (showedThisTutorial) {</span>
<span class="nc" id="L112">                return;</span>
            }
        }
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7994)) {</span>
            // Make sure we're not spamming the user with tutorials
<span class="nc bnc" id="L117" title="All 2 branches missed.">            if (giveUserTutorialBreak(activity, tutorialType)) {</span>
<span class="nc" id="L118">                return;</span>
            }
        }
<span class="nc" id="L121">        Resources r = activity.getResources();</span>
<span class="nc" id="L122">        OnShowcaseEventListener listener = null;</span>
<span class="nc" id="L123">        boolean moveButtonLeft = false;</span>
        String title;
        SpannableString text;
<span class="nc" id="L126">        Target target = Target.NONE;</span>
<span class="nc bnc" id="L127" title="All 11 branches missed.">        switch(tutorialType) {</span>
            case TUTORIAL_WELCOME:
<span class="nc" id="L129">                title = r.getString(R.string.tutorial_welcome_title);</span>
<span class="nc" id="L130">                text = new SpannableString(r.getString(R.string.tutorial_welcome_text));</span>
<span class="nc" id="L131">                break;</span>
            case TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO:
<span class="nc bnc" id="L133" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7995)) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                    if (response == null) {</span>
<span class="nc" id="L135">                        throw new IllegalArgumentException(&quot;ObaArrivalInfoResponse must be provided for the '&quot; + tutorialType + &quot;' tutorial type.&quot;);</span>
                    }
                }
<span class="nc bnc" id="L138" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8001)) {</span>
<span class="nc bnc" id="L139" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(8000) ? (response.getArrivalInfo().length &gt;= 1) : (ListenerUtil.mutListener.listen(7999) ? (response.getArrivalInfo().length &lt;= 1) : (ListenerUtil.mutListener.listen(7998) ? (response.getArrivalInfo().length &gt; 1) : (ListenerUtil.mutListener.listen(7997) ? (response.getArrivalInfo().length != 1) : (ListenerUtil.mutListener.listen(7996) ? (response.getArrivalInfo().length == 1) : (response.getArrivalInfo().length &lt; 1))))))) {</span>
                        // We need at least one arrival time
<span class="nc" id="L141">                        return;</span>
                    }
                }
<span class="nc" id="L144">                title = r.getString(R.string.tutorial_arrival_header_arrival_info_title);</span>
<span class="nc" id="L145">                text = new SpannableString(r.getString(R.string.tutorial_arrival_header_arrival_info_text));</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8002)) {</span>
<span class="nc" id="L147">                    target = new ViewTarget(R.id.eta_and_min, activity);</span>
                }
<span class="nc bnc" id="L149" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8003)) {</span>
<span class="nc" id="L150">                    moveButtonLeft = true;</span>
                }
<span class="nc bnc" id="L152" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8005)) {</span>
<span class="nc" id="L153">                    listener = new OnShowcaseEventListener() {</span>

                        @Override
                        public void onShowcaseViewHide(ShowcaseView showcaseView) {
<span class="nc bnc" id="L157" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8004)) {</span>
<span class="nc" id="L158">                                showTutorial(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL, activity, response, false);</span>
                            }
<span class="nc" id="L160">                        }</span>

                        @Override
                        public void onShowcaseViewDidHide(ShowcaseView showcaseView) {
<span class="nc" id="L164">                        }</span>

                        @Override
                        public void onShowcaseViewShow(ShowcaseView showcaseView) {
<span class="nc" id="L168">                        }</span>

                        @Override
                        public void onShowcaseViewTouchBlocked(MotionEvent motionEvent) {
<span class="nc" id="L172">                        }</span>
                    };
                }
                break;
            case TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL:
<span class="nc" id="L177">                title = r.getString(R.string.tutorial_arrival_header_sliding_panel_title);</span>
<span class="nc" id="L178">                text = new SpannableString(r.getString(R.string.tutorial_arrival_header_sliding_panel_text));</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8006)) {</span>
<span class="nc" id="L180">                    target = new ViewTarget(R.id.expand_collapse, activity);</span>
                }
<span class="nc bnc" id="L182" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8007)) {</span>
<span class="nc" id="L183">                    moveButtonLeft = true;</span>
                }
                break;
            case TUTORIAL_ARRIVAL_SORT:
<span class="nc" id="L187">                title = r.getString(R.string.tutorial_arrival_sort_title);</span>
<span class="nc" id="L188">                text = new SpannableString(r.getString(R.string.tutorial_arrival_sort_text));</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8008)) {</span>
<span class="nc" id="L190">                    addIcon(activity, text, R.drawable.ic_action_content_sort);</span>
                }
                break;
            case TUTORIAL_ARRIVAL_HEADER_STAR_ROUTE:
<span class="nc bnc" id="L194" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8009)) {</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">                    if (response == null) {</span>
<span class="nc" id="L196">                        throw new IllegalArgumentException(&quot;ObaArrivalInfoResponse must be provided for the '&quot; + tutorialType + &quot;' tutorial type.&quot;);</span>
                    }
                }
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8015)) {</span>
<span class="nc bnc" id="L200" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(8014) ? (response.getArrivalInfo().length &gt;= 1) : (ListenerUtil.mutListener.listen(8013) ? (response.getArrivalInfo().length &lt;= 1) : (ListenerUtil.mutListener.listen(8012) ? (response.getArrivalInfo().length &gt; 1) : (ListenerUtil.mutListener.listen(8011) ? (response.getArrivalInfo().length != 1) : (ListenerUtil.mutListener.listen(8010) ? (response.getArrivalInfo().length == 1) : (response.getArrivalInfo().length &lt; 1))))))) {</span>
                        // We need at least one arrival time
<span class="nc" id="L202">                        return;</span>
                    }
                }
<span class="nc" id="L205">                title = r.getString(R.string.tutorial_arrival_header_star_route_title);</span>
<span class="nc" id="L206">                text = new SpannableString(r.getString(R.string.tutorial_arrival_header_star_route_text));</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8016)) {</span>
<span class="nc" id="L208">                    target = new ViewTarget(R.id.eta_route_favorite, activity);</span>
                }
                break;
            case TUTORIAL_RECENT_STOPS_ROUTES:
<span class="nc" id="L212">                title = r.getString(R.string.tutorial_recent_stops_routes_title);</span>
<span class="nc" id="L213">                text = new SpannableString(r.getString(R.string.tutorial_recent_stops_routes_text));</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8017)) {</span>
<span class="nc" id="L215">                    addIcon(activity, text, R.drawable.ic_navigation_more_vert);</span>
                }
                break;
            case TUTORIAL_STARRED_STOPS_SORT:
<span class="nc" id="L219">                title = r.getString(R.string.tutorial_starred_stops_sort_title);</span>
<span class="nc" id="L220">                text = new SpannableString(r.getString(R.string.tutorial_starred_stops_sort_text));</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8018)) {</span>
<span class="nc" id="L222">                    addIcon(activity, text, R.drawable.ic_action_content_sort);</span>
                }
                break;
            case TUTORIAL_STARRED_STOPS_SHORTCUT:
<span class="nc" id="L226">                title = r.getString(R.string.tutorial_starred_stops_shortcut_title);</span>
<span class="nc" id="L227">                text = new SpannableString(r.getString(R.string.tutorial_starred_stops_shortcut_text));</span>
<span class="nc" id="L228">                break;</span>
            case TUTORIAL_SEND_FEEDBACK_OPEN311_CATEGORIES:
<span class="nc" id="L230">                title = r.getString(R.string.tutorial_send_feedback_transit_service_title);</span>
<span class="nc" id="L231">                text = new SpannableString(r.getString(R.string.tutorial_send_feedback_transit_service_text));</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8019)) {</span>
<span class="nc" id="L233">                    target = new ViewTarget(R.id.ri_spinnerServices, activity);</span>
                }
                break;
            case TUTORIAL_TRIP_PLAN_GEOCODER:
<span class="nc" id="L237">                title = r.getString(R.string.tutorial_trip_plan_geocoder_title);</span>
<span class="nc" id="L238">                text = new SpannableString(r.getString(R.string.tutorial_trip_plan_geocoder_text));</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8020)) {</span>
<span class="nc" id="L240">                    target = new ViewTarget(R.id.toAddressTextArea, activity);</span>
                }
                break;
            default:
<span class="nc" id="L244">                throw new IllegalArgumentException(&quot;tutorialType must be one of the TUTORIAL_* constants in ShowcaseViewUtils&quot;);</span>
        }
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8021)) {</span>
<span class="nc" id="L247">            mShowcaseView = new ShowcaseView.Builder(activity).setTarget(target).setStyle(R.style.CustomShowcaseTheme).setContentTitle(title).setContentText(text).build();</span>
        }
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8023)) {</span>
            // If button should be positioned to the left, then set the parameters
<span class="nc bnc" id="L251" title="All 2 branches missed.">            if (moveButtonLeft) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8022)) {</span>
<span class="nc" id="L253">                    moveButtonLeft(activity, mShowcaseView);</span>
                }
            }
        }
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8025)) {</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">            if (listener != null) {</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8024)) {</span>
<span class="nc" id="L260">                    mShowcaseView.setOnShowcaseEventListener(listener);</span>
                }
            }
        }
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8026)) {</span>
            // Set the preference for this tutorial type so it doesn't show again
<span class="nc" id="L266">            doNotShowTutorial(tutorialType);</span>
        }
<span class="nc" id="L268">    }</span>

    /**
     * Returns true if the ShowcaseView is currently showing, false if it is not
     *
     * @return true if the ShowcaseView is currently showing, false if it is not
     */
    public static boolean isShowcaseViewShowing() {
<span class="nc bnc" id="L276" title="All 10 branches missed.">        return (ListenerUtil.mutListener.listen(8027) ? (mShowcaseView != null || mShowcaseView.isShowing()) : (mShowcaseView != null &amp;&amp; mShowcaseView.isShowing()));</span>
    }

    /**
     * Hides a currently showing ShowcaseView
     */
    public static void hideShowcaseView() {
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8029)) {</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">            if (mShowcaseView != null) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8028)) {</span>
<span class="nc" id="L286">                    mShowcaseView.hide();</span>
                }
            }
        }
<span class="nc" id="L290">    }</span>

    /**
     * Give the user a break from tutorials - only show every 10th time, unless its the beginning
     * three important screens or the intro to the new trip planning geocoder
     *
     * @param tutorialType type of tutorial to show, defined by the TUTORIAL_* constants in
     *                     ShowcaseViewUtils
     * @return true if we should give the user a break and not show a tutorial, false if it's ok
     * to show them one
     */
    private static boolean giveUserTutorialBreak(Context context, String tutorialType) {
<span class="nc" id="L302">        final String TUTORIAL_COUNTER = context.getString(R.string.preference_key_tutorial_counter);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8045)) {</span>
<span class="nc bnc" id="L304" title="All 58 branches missed.">            if (!((ListenerUtil.mutListener.listen(8032) ? ((ListenerUtil.mutListener.listen(8031) ? ((ListenerUtil.mutListener.listen(8030) ? (tutorialType.equals(TUTORIAL_WELCOME) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO)) : (tutorialType.equals(TUTORIAL_WELCOME) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO))) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL)) : ((ListenerUtil.mutListener.listen(8030) ? (tutorialType.equals(TUTORIAL_WELCOME) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO)) : (tutorialType.equals(TUTORIAL_WELCOME) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO))) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL))) &amp;&amp; tutorialType.equals(TUTORIAL_TRIP_PLAN_GEOCODER)) : ((ListenerUtil.mutListener.listen(8031) ? ((ListenerUtil.mutListener.listen(8030) ? (tutorialType.equals(TUTORIAL_WELCOME) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO)) : (tutorialType.equals(TUTORIAL_WELCOME) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO))) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL)) : ((ListenerUtil.mutListener.listen(8030) ? (tutorialType.equals(TUTORIAL_WELCOME) &amp;&amp; tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO)) : (tutorialType.equals(TUTORIAL_WELCOME) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO))) || tutorialType.equals(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL))) || tutorialType.equals(TUTORIAL_TRIP_PLAN_GEOCODER))))) {</span>
<span class="nc" id="L305">                int counter = Application.getPrefs().getInt(TUTORIAL_COUNTER, 0);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8033)) {</span>
<span class="nc" id="L307">                    counter++;</span>
                }
<span class="nc bnc" id="L309" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8034)) {</span>
<span class="nc" id="L310">                    PreferenceUtils.saveInt(TUTORIAL_COUNTER, counter);</span>
                }
<span class="nc bnc" id="L312" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8044)) {</span>
<span class="nc bnc" id="L313" title="All 70 branches missed.">                    if (!((ListenerUtil.mutListener.listen(8043) ? ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) &gt;= 0) : (ListenerUtil.mutListener.listen(8042) ? ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) &lt;= 0) : (ListenerUtil.mutListener.listen(8041) ? ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) &gt; 0) : (ListenerUtil.mutListener.listen(8040) ? ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) &lt; 0) : (ListenerUtil.mutListener.listen(8039) ? ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) != 0) : ((ListenerUtil.mutListener.listen(8038) ? (counter / 10) : (ListenerUtil.mutListener.listen(8037) ? (counter * 10) : (ListenerUtil.mutListener.listen(8036) ? (counter - 10) : (ListenerUtil.mutListener.listen(8035) ? (counter + 10) : (counter % 10))))) == 0)))))))) {</span>
                        // Wait longer to show the next tutorial
<span class="nc" id="L315">                        return true;</span>
                    }
                }
            }
        }
<span class="nc" id="L320">        return false;</span>
    }

    /**
     * Creates a dialog that prompts the user if they want to see tutorial popups
     *
     * @return a dialog that prompts the user if they want to see tutorial popups
     */
    public static void showOptOutDialog(final AppCompatActivity activity) {
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8046)) {</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">            if (!UIUtils.canManageDialog(activity)) {</span>
<span class="nc" id="L331">                return;</span>
            }
        }
<span class="nc" id="L334">        final String showTutorialsKey = activity.getString(R.string.preference_key_show_tutorial_screens);</span>
<span class="nc" id="L335">        AlertDialog.Builder builder = new AlertDialog.Builder(activity);</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8050)) {</span>
<span class="nc" id="L337">            builder.setTitle(R.string.tutorial_opt_out_dialog_title).setMessage(R.string.tutorial_opt_out_dialog_text).setPositiveButton(R.string.rt_yes, new DialogInterface.OnClickListener() {</span>

                @Override
                public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L341" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8048)) {</span>
                        // Make sure tutorials are enabled - they will show on their own
<span class="nc" id="L343">                        PreferenceUtils.saveBoolean(showTutorialsKey, true);</span>
                    }
<span class="nc bnc" id="L345" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8049)) {</span>
                        // Show the welcome tutorial
<span class="nc" id="L347">                        showTutorial(ShowcaseViewUtils.TUTORIAL_WELCOME, activity, null, false);</span>
                    }
<span class="nc" id="L349">                }</span>
<span class="nc" id="L350">            }).setNegativeButton(R.string.rt_no, new DialogInterface.OnClickListener() {</span>

                @Override
                public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L354" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8047)) {</span>
                        // Turn off all tutorials
<span class="nc" id="L356">                        PreferenceUtils.saveBoolean(showTutorialsKey, false);</span>
                    }
<span class="nc" id="L358">                }</span>
            });
        }
<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8051)) {</span>
<span class="nc" id="L362">            builder.create().show();</span>
        }
<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8052)) {</span>
            // Don't show this dialog again
<span class="nc" id="L366">            PreferenceUtils.saveBoolean(TUTORIAL_OPT_OUT_DIALOG, false);</span>
        }
<span class="nc" id="L368">    }</span>

    /**
     * Adds the provided icon to the right side of the provided SpannableString
     *
     * @param text             SpannableString to add sort icon to
     * @param drawableResource ID of the drawable resource to add to the right side of the
     *                         SpannableString
     */
    private static void addIcon(Context context, SpannableString text, @DrawableRes int drawableResource) {
<span class="nc" id="L378">        Drawable d = ResourcesCompat.getDrawable(context.getResources(), drawableResource, context.getTheme());</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8053)) {</span>
<span class="nc" id="L380">            d.setBounds(0, 0, d.getIntrinsicWidth(), d.getIntrinsicHeight());</span>
        }
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8054)) {</span>
<span class="nc" id="L383">            d.setColorFilter(context.getResources().getColor(R.color.header_text_color), PorterDuff.Mode.SRC_IN);</span>
        }
<span class="nc" id="L385">        ImageSpan imageSpan = new ImageSpan(d, ImageSpan.ALIGN_BOTTOM);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8059)) {</span>
<span class="nc bnc" id="L387" title="All 8 branches missed.">            text.setSpan(imageSpan, (ListenerUtil.mutListener.listen(8058) ? (text.length() % 1) : (ListenerUtil.mutListener.listen(8057) ? (text.length() / 1) : (ListenerUtil.mutListener.listen(8056) ? (text.length() * 1) : (ListenerUtil.mutListener.listen(8055) ? (text.length() + 1) : (text.length() - 1))))), text.length(), Spannable.SPAN_INCLUSIVE_INCLUSIVE);</span>
        }
<span class="nc" id="L389">    }</span>

    /**
     * Moves the button to acknowledge the ShowcaseView to be left aligned
     *
     * @param v ShowcaseView for which the button should be left aligned
     */
    private static void moveButtonLeft(Context context, ShowcaseView v) {
<span class="nc" id="L397">        RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8060)) {</span>
<span class="nc" id="L399">            lp.addRule(RelativeLayout.ALIGN_PARENT_LEFT);</span>
        }
<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8061)) {</span>
<span class="nc" id="L402">            lp.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM);</span>
        }
<span class="nc" id="L404">        int p = UIUtils.dpToPixels(context, 12);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8062)) {</span>
<span class="nc" id="L406">            lp.setMargins(p, p, p, p);</span>
        }
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8063)) {</span>
<span class="nc" id="L409">            v.setButtonPosition(lp);</span>
        }
<span class="nc" id="L411">    }</span>

    /**
     * Sets a particular tutorial to the &quot;viewed&quot; state, so a user won't ever see it again.
     *
     * This is also useful in the case where a user has already found a particular feature but we
     * haven't yet shown them the tutorial for that feature.  In this case, they don't need to see
     * the tutorial for that feature, so we can avoid annoying them with another popup for something
     * they already know.
     *
     * @param tutorialType type of tutorial to not show, defined by the TUTORIAL_* constants in
     *                     ShowcaseViewUtils
     */
    public static void doNotShowTutorial(String tutorialType) {
<span class="nc bnc" id="L425" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8064)) {</span>
<span class="nc" id="L426">            PreferenceUtils.saveBoolean(tutorialType, true);</span>
        }
<span class="nc" id="L428">    }</span>

    /**
     * Resets all tutorials so they are shown to the user again.  If any ShowcaseView is showing,
     * it will be hidden.
     */
    public static void resetAllTutorials(Context context) {
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8066)) {</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">            if (mShowcaseView != null) {</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8065)) {</span>
<span class="nc" id="L438">                    mShowcaseView.hide();</span>
                }
            }
        }
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8067)) {</span>
<span class="nc" id="L443">            PreferenceUtils.saveBoolean(context.getString(R.string.preference_key_show_tutorial_screens), true);</span>
        }
<span class="nc bnc" id="L445" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8068)) {</span>
<span class="nc" id="L446">            PreferenceUtils.saveBoolean(TUTORIAL_WELCOME, false);</span>
        }
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8069)) {</span>
<span class="nc" id="L449">            PreferenceUtils.saveBoolean(TUTORIAL_ARRIVAL_HEADER_ARRIVAL_INFO, false);</span>
        }
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8070)) {</span>
<span class="nc" id="L452">            PreferenceUtils.saveBoolean(TUTORIAL_ARRIVAL_HEADER_SLIDING_PANEL, false);</span>
        }
<span class="nc bnc" id="L454" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8071)) {</span>
<span class="nc" id="L455">            PreferenceUtils.saveBoolean(TUTORIAL_ARRIVAL_SORT, false);</span>
        }
<span class="nc bnc" id="L457" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8072)) {</span>
<span class="nc" id="L458">            PreferenceUtils.saveBoolean(TUTORIAL_ARRIVAL_HEADER_STAR_ROUTE, false);</span>
        }
<span class="nc bnc" id="L460" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8073)) {</span>
<span class="nc" id="L461">            PreferenceUtils.saveBoolean(TUTORIAL_RECENT_STOPS_ROUTES, false);</span>
        }
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8074)) {</span>
<span class="nc" id="L464">            PreferenceUtils.saveBoolean(TUTORIAL_STARRED_STOPS_SORT, false);</span>
        }
<span class="nc bnc" id="L466" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8075)) {</span>
<span class="nc" id="L467">            PreferenceUtils.saveBoolean(TUTORIAL_STARRED_STOPS_SHORTCUT, false);</span>
        }
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8076)) {</span>
<span class="nc" id="L470">            PreferenceUtils.saveBoolean(TUTORIAL_SEND_FEEDBACK_OPEN311_CATEGORIES, false);</span>
        }
<span class="nc" id="L472">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>