<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DirectionExpandableListAdapter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.directions.util</a> &gt; <span class="el_source">DirectionExpandableListAdapter.java</span></div><h1>DirectionExpandableListAdapter.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2012 University of South Florida
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *        http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and 
 * limitations under the License.
 */

package org.onebusaway.android.directions.util;

import org.onebusaway.android.R;
import org.onebusaway.android.directions.model.Direction;

import android.app.Activity;
import android.content.Context;
import android.graphics.Color;
import android.graphics.Typeface;
import android.text.SpannableString;
import android.text.TextUtils;
import android.text.style.StyleSpan;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseExpandableListAdapter;
import android.widget.ImageView;
import android.widget.TextView;

import java.util.ArrayList;


/**
 * @author Khoa Tran
 */

public class DirectionExpandableListAdapter extends BaseExpandableListAdapter {

    Context mContext;

    int mDirectionLayoutResourceId;

    int mSubDirectionLayoutResourceId;

<span class="nc" id="L51">    Direction mData[] = null;</span>

    public DirectionExpandableListAdapter(Context context, int directionLayoutResourceId,
<span class="nc" id="L54">                                          int subDirectionLayoutResourceId, Direction[] data) {</span>
<span class="nc" id="L55">        mDirectionLayoutResourceId = directionLayoutResourceId;</span>
<span class="nc" id="L56">        mSubDirectionLayoutResourceId = subDirectionLayoutResourceId;</span>
<span class="nc" id="L57">        mContext = context;</span>
<span class="nc" id="L58">        mData = data;</span>
<span class="nc" id="L59">    }</span>

    @Override
    public Object getChild(int groupPosition, int childPosition) {
<span class="nc" id="L63">        ArrayList&lt;Direction&gt; subDirections = mData[groupPosition].getSubDirections();</span>

<span class="nc bnc" id="L65" title="All 4 branches missed.">        if (subDirections != null &amp;&amp; !subDirections.isEmpty()) {</span>
<span class="nc" id="L66">            return subDirections.get(childPosition);</span>
        }

<span class="nc" id="L69">        return null;</span>
    }

    @Override
    public long getChildId(int groupPosition, int childPosition) {
<span class="nc" id="L74">        return childPosition;</span>
    }

    @Override
    public int getChildrenCount(int groupPosition) {
<span class="nc" id="L79">        ArrayList&lt;Direction&gt; subDirections = mData[groupPosition].getSubDirections();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (subDirections != null) {</span>
<span class="nc" id="L81">            return subDirections.size();</span>
        }
<span class="nc" id="L83">        return 0;</span>
    }

    @Override
    public View getChildView(int groupPosition, int childPosition, boolean isLastChild,
                             View convertView, ViewGroup parent) {

<span class="nc" id="L90">        View row = convertView;</span>
<span class="nc" id="L91">        DirectionHolder holder = null;</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (row == null) {</span>
<span class="nc" id="L94">            LayoutInflater inflater = ((Activity) mContext).getLayoutInflater();</span>
<span class="nc" id="L95">            row = inflater.inflate(mSubDirectionLayoutResourceId, parent, false);</span>

<span class="nc" id="L97">            holder = new DirectionHolder();</span>
<span class="nc" id="L98">            holder.imgIcon = (ImageView) row.findViewById(R.id.imgIcon);</span>
<span class="nc" id="L99">            holder.txtDirection = (TextView) row.findViewById(R.id.directionText);</span>

<span class="nc" id="L101">            row.setTag(holder);</span>
<span class="nc" id="L102">        } else {</span>
<span class="nc" id="L103">            holder = (DirectionHolder) row.getTag();</span>
        }

<span class="nc" id="L106">        Direction subDirection = (Direction) getChild(groupPosition, childPosition);</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">        CharSequence text = subDirection == null ? &quot;null here&quot; : subDirection.getDirectionText();</span>
<span class="nc" id="L108">        holder.txtDirection.setText(text);</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (subDirection.getIcon() != -1) {</span>
<span class="nc" id="L111">            holder.imgIcon.setImageResource(subDirection.getIcon());</span>
<span class="nc" id="L112">            holder.imgIcon.setColorFilter(Color.GRAY);</span>
        }
        else {
<span class="nc" id="L115">            holder.imgIcon.setVisibility(View.INVISIBLE);</span>
        }
<span class="nc" id="L117">        return row;</span>
    }

    @Override
    public Object getGroup(int groupPosition) {
<span class="nc" id="L122">        return mData[groupPosition];</span>
    }

    @Override
    public int getGroupCount() {
<span class="nc" id="L127">        return mData.length;</span>
    }

    @Override
    public long getGroupId(int groupPosition) {
<span class="nc" id="L132">        return groupPosition;</span>
    }

    @Override
    public View getGroupView(int groupPosition, boolean isExpanded, View convertView,
                             ViewGroup parent) {
<span class="nc" id="L138">        View row = convertView;</span>
<span class="nc" id="L139">        DirectionHolder holder = null;</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (row == null) {</span>
<span class="nc" id="L142">            LayoutInflater inflater = ((Activity) mContext).getLayoutInflater();</span>
<span class="nc" id="L143">            row = inflater.inflate(mDirectionLayoutResourceId, parent, false);</span>

<span class="nc" id="L145">            holder = new DirectionHolder();</span>
<span class="nc" id="L146">            holder.imgIcon = (ImageView) row.findViewById(R.id.imgIcon);</span>
<span class="nc" id="L147">            holder.noIconText = (TextView) row.findViewById(R.id.noIconText);</span>
<span class="nc" id="L148">            holder.txtDirection = (TextView) row.findViewById(R.id.directionText);</span>

<span class="nc" id="L150">            row.setTag(holder);</span>
<span class="nc" id="L151">        } else {</span>
<span class="nc" id="L152">            holder = (DirectionHolder) row.getTag();</span>
        }

<span class="nc" id="L155">        Direction dir = mData[groupPosition];</span>

<span class="nc bnc" id="L157" title="All 2 branches missed.">        if (!dir.isTransit()) {</span>
<span class="nc" id="L158">            holder.txtDirection.setText(dir.getDirectionIndex() + &quot;. &quot; + dir.getDirectionText());</span>
<span class="nc" id="L159">            holder.imgIcon.setVisibility(View.VISIBLE);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">            if (dir.getIcon() != -1) {</span>
<span class="nc" id="L161">                holder.imgIcon.setImageResource(dir.getIcon());</span>
<span class="nc" id="L162">                holder.imgIcon.setColorFilter(Color.GRAY);</span>
            }
            else {
<span class="nc" id="L165">                holder.imgIcon.setVisibility(View.INVISIBLE);</span>
            }
        } else {
<span class="nc" id="L168">            CharSequence textBeforeTime = dir.getDirectionIndex() + &quot;. &quot; + dir.getService();</span>
            CharSequence text;
<span class="nc" id="L170">            CharSequence time = dir.getOldTime();</span>
<span class="nc" id="L171">            text = new SpannableString(textBeforeTime);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (dir.isRealTimeInfo()) {</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">                if (dir.getNewTime() != null) {</span>
<span class="nc" id="L174">                    time = dir.getNewTime();</span>
                }
            }
<span class="nc" id="L177">            text = TextUtils.concat(text, &quot; &quot;, time, &quot;\n&quot;, dir.getPlaceAndHeadsign());</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">            if (!TextUtils.isEmpty(dir.getAgency())) {</span>
<span class="nc" id="L180">                text = TextUtils.concat(text, &quot;\n&quot;, dir.getAgency());</span>
            }
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (!TextUtils.isEmpty(dir.getExtra())) {</span>
<span class="nc" id="L183">                SpannableString extraSpannableString = new SpannableString(dir.getExtra());</span>
<span class="nc" id="L184">                extraSpannableString.setSpan(new StyleSpan(Typeface.ITALIC), 0,</span>
<span class="nc" id="L185">                        extraSpannableString.length(), 0);</span>
<span class="nc" id="L186">                text = TextUtils.concat(text, &quot;\n&quot;, extraSpannableString);</span>
            }

<span class="nc" id="L189">            holder.txtDirection.setText(text);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (dir.getIcon() == -1) {</span>
<span class="nc" id="L191">                holder.imgIcon.setVisibility(View.INVISIBLE);</span>
<span class="nc" id="L192">                holder.noIconText.setVisibility(View.VISIBLE);</span>
            } else {
<span class="nc" id="L194">                holder.imgIcon.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L195">                holder.imgIcon.setImageResource(dir.getIcon());</span>
<span class="nc" id="L196">                holder.imgIcon.setColorFilter(Color.GRAY);</span>
<span class="nc" id="L197">                holder.noIconText.setVisibility(View.INVISIBLE);</span>
            }
        }
<span class="nc" id="L200">        return row;</span>
    }

    @Override
    public boolean isChildSelectable(int groupPosition, int childPosition) {
<span class="nc" id="L205">        return true;</span>
    }

    @Override
    public boolean hasStableIds() {
<span class="nc" id="L210">        return true;</span>
    }

<span class="nc" id="L213">    static class DirectionHolder {</span>
        ImageView imgIcon;
        TextView noIconText;
        TextView txtDirection;
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>