<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MySearchFragmentBase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agencyXGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">MySearchFragmentBase.java</span></div><h1>MySearchFragmentBase.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2010 Paul Watts (paulcwatts@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.app.Activity;
import android.location.Location;
import android.os.Bundle;
import android.os.Handler;
import android.text.method.LinkMovementMethod;
import android.view.View;
import android.view.View.OnFocusChangeListener;
import android.view.WindowManager;
import android.widget.TextView;
import android.widget.TextView.BufferType;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.GoogleApiAvailability;
import com.google.android.gms.common.api.GoogleApiClient;
import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.UIUtils;
import org.onebusaway.android.view.SearchViewV1;
import java.util.Timer;
import java.util.TimerTask;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L40">abstract class MySearchFragmentBase extends ListFragment implements SearchViewV1.OnQueryTextListener, MyListConstants {</span>

    private Timer mSearchTimer;

    private SearchViewV1 mSearchViewV1;

    private static final int DELAYED_SEARCH_TIMEOUT = 1000;

    /**
     * GoogleApiClient being used for Location Services
     */
    GoogleApiClient mGoogleApiClient;

    @Override
    public void onAttach(Activity activity) {
<span class="nc bnc" id="L55" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3705)) {</span>
<span class="nc" id="L56">            super.onAttach(activity);</span>
        }
        // Init Google Play Services as early as possible in the Fragment lifecycle to give it time
<span class="nc" id="L59">        GoogleApiAvailability api = GoogleApiAvailability.getInstance();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3708)) {</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">            if (api.isGooglePlayServicesAvailable(getActivity()) == ConnectionResult.SUCCESS) {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3706)) {</span>
<span class="nc" id="L63">                    mGoogleApiClient = LocationUtils.getGoogleApiClientWithCallbacks(getActivity());</span>
                }
<span class="nc bnc" id="L65" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3707)) {</span>
<span class="nc" id="L66">                    mGoogleApiClient.connect();</span>
                }
            }
        }
<span class="nc" id="L70">    }</span>

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
<span class="nc bnc" id="L74" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3709)) {</span>
<span class="nc" id="L75">            super.onActivityCreated(savedInstanceState);</span>
        }
<span class="nc bnc" id="L77" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3710)) {</span>
<span class="nc" id="L78">            registerForContextMenu(getListView());</span>
        }
<span class="nc" id="L80">        TextView empty = (TextView) getView().findViewById(android.R.id.empty);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3711)) {</span>
<span class="nc" id="L82">            empty.setMovementMethod(LinkMovementMethod.getInstance());</span>
        }
<span class="nc bnc" id="L84" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3712)) {</span>
            // Set empty text
<span class="nc" id="L86">            setEmptyText(getHintText());</span>
        }
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3713)) {</span>
<span class="nc" id="L89">            mSearchViewV1.setQueryHint(getString(getEditBoxHintText()));</span>
        }
<span class="nc bnc" id="L91" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3714)) {</span>
<span class="nc" id="L92">            mSearchViewV1.setOnQueryTextListener(this);</span>
        }
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3715)) {</span>
<span class="nc" id="L95">            mSearchViewV1.setOnQueryTextFocusChangeListener(mOnQueryTextFocusChangeListener);</span>
        }
<span class="nc" id="L97">    }</span>

    @Override
    public void onViewCreated(View view, Bundle savedInstanceState) {
<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3716)) {</span>
<span class="nc" id="L102">            super.onViewCreated(view, savedInstanceState);</span>
        }
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3717)) {</span>
<span class="nc" id="L105">            mSearchViewV1 = (SearchViewV1) getView().findViewById(R.id.search);</span>
        }
<span class="nc" id="L107">    }</span>

    @Override
    public void onStart() {
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3718)) {</span>
<span class="nc" id="L112">            super.onStart();</span>
        }
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3721)) {</span>
            // Make sure GoogleApiClient is connected, if available
<span class="nc bnc" id="L116" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3719) ? (mGoogleApiClient != null || !mGoogleApiClient.isConnected()) : (mGoogleApiClient != null &amp;&amp; !mGoogleApiClient.isConnected()))) {</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3720)) {</span>
<span class="nc" id="L118">                    mGoogleApiClient.connect();</span>
                }
            }
        }
<span class="nc" id="L122">    }</span>

    @Override
    public void onStop() {
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3724)) {</span>
            // Tear down GoogleApiClient
<span class="nc bnc" id="L128" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(3722) ? (mGoogleApiClient != null || mGoogleApiClient.isConnected()) : (mGoogleApiClient != null &amp;&amp; mGoogleApiClient.isConnected()))) {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3723)) {</span>
<span class="nc" id="L130">                    mGoogleApiClient.disconnect();</span>
                }
            }
        }
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3725)) {</span>
<span class="nc" id="L135">            UIUtils.closeKeyboard(getActivity(), mSearchViewV1);</span>
        }
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3726)) {</span>
<span class="nc" id="L138">            super.onStop();</span>
        }
<span class="nc" id="L140">    }</span>

    @Override
    public void onDestroy() {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3727)) {</span>
<span class="nc" id="L145">            cancelDelayedSearch();</span>
        }
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3728)) {</span>
<span class="nc" id="L148">            super.onDestroy();</span>
        }
<span class="nc" id="L150">    }</span>

    @Override
    public void setEmptyText(CharSequence seq) {
<span class="nc" id="L154">        TextView empty = (TextView) getView().findViewById(R.id.internalEmpty);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3730)) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            if (empty != null) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3729)) {</span>
<span class="nc" id="L158">                    empty.setText(seq, BufferType.SPANNABLE);</span>
                }
            }
        }
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3731)) {</span>
<span class="nc" id="L163">            empty = (TextView) getView().findViewById(android.R.id.empty);</span>
        }
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3733)) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">            if (empty != null) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3732)) {</span>
<span class="nc" id="L168">                    empty.setText(seq, BufferType.SPANNABLE);</span>
                }
            }
        }
<span class="nc" id="L172">    }</span>

    @Override
    public boolean onQueryTextChange(String newText) {
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3734)) {</span>
            // Log.d(TAG, &quot;new text: &quot; + newText);
<span class="nc" id="L178">            cancelDelayedSearch();</span>
        }
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3740)) {</span>
<span class="nc bnc" id="L181" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(3739) ? (newText.length() &gt;= 0) : (ListenerUtil.mutListener.listen(3738) ? (newText.length() &lt;= 0) : (ListenerUtil.mutListener.listen(3737) ? (newText.length() &gt; 0) : (ListenerUtil.mutListener.listen(3736) ? (newText.length() &lt; 0) : (ListenerUtil.mutListener.listen(3735) ? (newText.length() != 0) : (newText.length() == 0))))))) {</span>
                // Set hint text, etc.
<span class="nc" id="L183">                return true;</span>
            }
        }
<span class="nc" id="L186">        final String query = newText;</span>
<span class="nc" id="L187">        final Runnable doSearch = new Runnable() {</span>

            public void run() {
<span class="nc bnc" id="L190" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3741)) {</span>
<span class="nc" id="L191">                    doSearch(query);</span>
                }
<span class="nc" id="L193">            }</span>
        };
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3742)) {</span>
<span class="nc" id="L196">            mSearchTimer = new Timer();</span>
        }
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3744)) {</span>
<span class="nc" id="L199">            mSearchTimer.schedule(new TimerTask() {</span>

                @Override
                public void run() {
<span class="nc bnc" id="L203" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3743)) {</span>
<span class="nc" id="L204">                        mSearchHandler.post(doSearch);</span>
                    }
<span class="nc" id="L206">                }</span>
            }, DELAYED_SEARCH_TIMEOUT);
        }
<span class="nc" id="L209">        return true;</span>
    }

<span class="nc" id="L212">    final Handler mSearchHandler = new Handler();</span>

    @Override
    public boolean onQueryTextSubmit(String query) {
        // Log.d(TAG, &quot;text submit: &quot; + query);
<span class="nc" id="L217">        return true;</span>
    }

    protected void cancelDelayedSearch() {
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3747)) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">            if (mSearchTimer != null) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3745)) {</span>
<span class="nc" id="L224">                    mSearchTimer.cancel();</span>
                }
<span class="nc bnc" id="L226" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3746)) {</span>
<span class="nc" id="L227">                    mSearchTimer = null;</span>
                }
            }
        }
<span class="nc" id="L231">    }</span>

    protected SearchViewV1 getSearchViewV1() {
<span class="nc" id="L234">        return mSearchViewV1;</span>
    }

    protected boolean isShortcutMode() {
<span class="nc" id="L238">        Activity act = getActivity();</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3748)) {</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">            if (act instanceof MyTabActivityBase) {</span>
<span class="nc" id="L241">                MyTabActivityBase base = (MyTabActivityBase) act;</span>
<span class="nc" id="L242">                return base.isShortcutMode();</span>
            }
        }
<span class="nc" id="L245">        return false;</span>
    }

    protected final Location getSearchCenter() {
<span class="nc" id="L249">        Activity act = getActivity();</span>
<span class="nc" id="L250">        Location location = Application.getLastKnownLocation(act, mGoogleApiClient);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3750)) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">            if (location == null) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3749)) {</span>
<span class="nc" id="L254">                    location = LocationUtils.getDefaultSearchCenter();</span>
                }
            }
        }
<span class="nc" id="L258">        return location;</span>
    }

<span class="nc" id="L261">    private final OnFocusChangeListener mOnQueryTextFocusChangeListener = new OnFocusChangeListener() {</span>

        @Override
        public void onFocusChange(View view, boolean hasFocus) {
<span class="nc bnc" id="L265" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(3752)) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                if (hasFocus) {</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(3751)) {</span>
<span class="nc" id="L268">                        getActivity().getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_ALWAYS_VISIBLE);</span>
                    }
                }
            }
<span class="nc" id="L272">        }</span>
    };

    /**
     * Tells the subclass to start a search
     */
    protected abstract void doSearch(String text);

    /**
     * @return The hint text for the search box.
     */
    protected abstract int getEditBoxHintText();

    /**
     * @return The minimum number of characters that need to be in the find
     * search box before an automatic search is performed.
     */
    protected abstract int getMinSearchLength();

    /**
     * This is called to set the hint text in the R.id.empty view.
     */
    protected abstract CharSequence getHintText();
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>