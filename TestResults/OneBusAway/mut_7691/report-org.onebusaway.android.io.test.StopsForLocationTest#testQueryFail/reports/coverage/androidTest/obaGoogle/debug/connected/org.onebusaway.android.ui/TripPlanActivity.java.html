<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TripPlanActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">TripPlanActivity.java</span></div><h1>TripPlanActivity.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2016-2017 Cambridge Systematics, Inc.,
 * University of South Florida (sjbarbeau@gmail.com),
 * Microsoft Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.onebusaway.android.ui;

import android.app.AlertDialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.location.Location;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.ViewTreeObserver;
import android.widget.ListView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;

import com.google.firebase.analytics.FirebaseAnalytics;
import com.sothree.slidinguppanel.ScrollableViewHelper;
import com.sothree.slidinguppanel.SlidingUpPanelLayout;

import org.onebusaway.android.R;
import org.onebusaway.android.app.Application;
import org.onebusaway.android.directions.tasks.TripRequest;
import org.onebusaway.android.directions.util.OTPConstants;
import org.onebusaway.android.directions.util.TripRequestBuilder;
import org.onebusaway.android.io.ObaAnalytics;
import org.onebusaway.android.travelbehavior.TravelBehaviorManager;
import org.onebusaway.android.util.LocationUtils;
import org.onebusaway.android.util.UIUtils;
import org.opentripplanner.api.model.Itinerary;
import org.opentripplanner.api.model.TripPlan;
import org.opentripplanner.api.ws.Message;

import java.util.ArrayList;


<span class="nc" id="L57">public class TripPlanActivity extends AppCompatActivity implements TripRequest.Callback,</span>
        TripResultsFragment.Listener, TripPlanFragment.Listener {

    private static final String TAG = &quot;TripPlanActivity&quot;;

    TripRequestBuilder mBuilder;

<span class="nc" id="L64">    TripRequest mTripRequest = null;</span>

    SlidingUpPanelLayout mPanel;

    AlertDialog mFeedbackDialog;

    private static final String PLAN_ERROR_CODE = &quot;org.onebusaway.android.PLAN_ERROR_CODE&quot;;

    private static final String PLAN_ERROR_URL = &quot;org.onebusaway.android.PLAN_ERROR_URL&quot;;

    private static final String PLAN_REQUEST_URL = &quot;org.onebusaway.android.PLAN_REQUEST_URL&quot;;

    private static final String PANEL_STATE_EXPANDED = &quot;org.onebusaway.android.PANEL_STATE_EXPANDED&quot;;

    private static final String SHOW_ERROR_DIALOG = &quot;org.onebusaway.android.SHOW_ERROR_DIALOG&quot;;

    private static final String REQUEST_LOADING = &quot;org.onebusaway.android.REQUEST_LOADING&quot;;

    TripResultsFragment mResultsFragment;

    private ProgressDialog mProgressDialog;

<span class="nc" id="L86">    boolean mRequestLoading = false;</span>

    private FirebaseAnalytics mFirebaseAnalytics;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L92">        super.onCreate(savedInstanceState);</span>

<span class="nc" id="L94">        setContentView(R.layout.activity_trip_plan);</span>

<span class="nc" id="L96">        UIUtils.setupActionBar(this);</span>

<span class="nc" id="L98">        mFirebaseAnalytics = FirebaseAnalytics.getInstance(this);</span>

<span class="nc bnc" id="L100" title="All 2 branches missed.">        Bundle bundle = (savedInstanceState == null) ? new Bundle() : savedInstanceState;</span>
<span class="nc" id="L101">        mBuilder = new TripRequestBuilder(bundle);</span>
<span class="nc" id="L102">    }</span>

    @Override
    protected void onResume() {
<span class="nc" id="L106">        super.onResume();</span>

<span class="nc" id="L108">        Bundle bundle = mBuilder.getBundle();</span>
<span class="nc" id="L109">        boolean newItineraries = false;</span>

        // see if there is data from intent
<span class="nc" id="L112">        Intent intent = getIntent();</span>

<span class="nc bnc" id="L114" title="All 4 branches missed.">        if (intent != null &amp;&amp; intent.getExtras() != null) {</span>

<span class="nc" id="L116">            OTPConstants.Source source = (OTPConstants.Source) intent</span>
<span class="nc" id="L117">                    .getSerializableExtra(OTPConstants.INTENT_SOURCE);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">            if (source != null) {</span>

                // Copy planning params - necessary if this intent came from a notification.
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if (source == OTPConstants.Source.NOTIFICATION) {</span>
<span class="nc" id="L122">                    new TripRequestBuilder(intent.getExtras()).copyIntoBundle(bundle);</span>
                }

<span class="nc" id="L125">                ArrayList&lt;Itinerary&gt; itineraries = (ArrayList&lt;Itinerary&gt;)</span>
<span class="nc" id="L126">                        intent.getExtras().getSerializable(OTPConstants.ITINERARIES);</span>

<span class="nc bnc" id="L128" title="All 2 branches missed.">                if (itineraries != null) {</span>
<span class="nc" id="L129">                    bundle.putSerializable(OTPConstants.ITINERARIES, itineraries);</span>
<span class="nc" id="L130">                    newItineraries = true;</span>
                }

<span class="nc bnc" id="L133" title="All 2 branches missed.">                if (intent.getIntExtra(PLAN_ERROR_CODE, -1) != -1) {</span>
<span class="nc" id="L134">                    bundle.putSerializable(SHOW_ERROR_DIALOG, true);</span>
<span class="nc" id="L135">                    bundle.putInt(PLAN_ERROR_CODE, intent.getIntExtra(PLAN_ERROR_CODE, 0));</span>
<span class="nc" id="L136">                    bundle.putString(PLAN_ERROR_URL, intent.getStringExtra(PLAN_ERROR_URL));</span>
                }

<span class="nc" id="L139">                setIntent(null);</span>
<span class="nc" id="L140">                bundle.putBoolean(REQUEST_LOADING, false);</span>
<span class="nc" id="L141">                mRequestLoading = false;</span>

            }
        }

<span class="nc bnc" id="L146" title="All 4 branches missed.">        if (mRequestLoading || bundle.getBoolean(REQUEST_LOADING)) {</span>
<span class="nc" id="L147">            showProgressDialog();</span>
        }

        // Check which fragment to create
<span class="nc bnc" id="L151" title="All 2 branches missed.">        boolean haveTripPlan = bundle.getSerializable(OTPConstants.ITINERARIES) != null;</span>

<span class="nc" id="L153">        TripPlanFragment fragment = (TripPlanFragment) getSupportFragmentManager()</span>
<span class="nc" id="L154">                .findFragmentById(R.id.trip_plan_fragment_container);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (fragment == null) {</span>
<span class="nc" id="L156">            fragment = new TripPlanFragment();</span>
<span class="nc" id="L157">            fragment.setArguments(bundle);</span>
<span class="nc" id="L158">            fragment.setListener(this);</span>
<span class="nc" id="L159">            getSupportFragmentManager().beginTransaction()</span>
<span class="nc" id="L160">                    .add(R.id.trip_plan_fragment_container, fragment, TripPlanFragment.TAG).commit();</span>
        }

<span class="nc" id="L163">        mPanel = (SlidingUpPanelLayout) findViewById(R.id.trip_plan_sliding_layout);</span>

<span class="nc" id="L165">        mPanel.setEnabled(haveTripPlan);</span>

<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (haveTripPlan) {</span>
<span class="nc" id="L168">            initResultsFragment();</span>
<span class="nc bnc" id="L169" title="All 4 branches missed.">            if (bundle.getBoolean(PANEL_STATE_EXPANDED) || newItineraries) {</span>
<span class="nc" id="L170">                mPanel.setPanelState(SlidingUpPanelLayout.PanelState.EXPANDED);</span>
            }
        }

        // show error dialog if necessary
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (bundle.getBoolean(SHOW_ERROR_DIALOG)) {</span>
<span class="nc" id="L176">            int planErrorCode = 0;</span>
<span class="nc" id="L177">            String planErrorUrl = null;</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (intent != null) {</span>
<span class="nc" id="L179">                planErrorCode = intent.getIntExtra(PLAN_ERROR_CODE, 0);</span>
<span class="nc" id="L180">                planErrorUrl = intent.getStringExtra(PLAN_ERROR_URL);</span>
            }
<span class="nc" id="L182">            showFeedbackDialog(planErrorCode, planErrorUrl);</span>
        }

<span class="nc bnc" id="L185" title="All 4 branches missed.">        if (fragment != null &amp;&amp; intent != null) {</span>
<span class="nc" id="L186">            fragment.setPlanErrorUrl(intent.getStringExtra(PLAN_ERROR_URL));</span>
<span class="nc" id="L187">            fragment.setPlanRequestUrl(intent.getStringExtra(PLAN_REQUEST_URL));</span>
        }

        // Set the height of the panel after drawing occurs.
<span class="nc" id="L191">        final ViewGroup layout = (ViewGroup) findViewById(R.id.trip_plan_fragment_container);</span>
<span class="nc" id="L192">        ViewTreeObserver vto = layout.getViewTreeObserver();</span>
<span class="nc" id="L193">        vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {</span>
            @Override
            public void onGlobalLayout() {
<span class="nc" id="L196">                layout.getViewTreeObserver().removeGlobalOnLayoutListener(this);</span>
<span class="nc" id="L197">                int viewHeight = mPanel.getHeight();</span>
<span class="nc" id="L198">                int height = layout.getMeasuredHeight();</span>
<span class="nc" id="L199">                mPanel.setPanelHeight(viewHeight - height);</span>
<span class="nc" id="L200">            }</span>
        });
<span class="nc" id="L202">    }</span>

    @Override
    public void onNewIntent(Intent intent) {
<span class="nc" id="L206">        setIntent(intent);</span>
<span class="nc" id="L207">    }</span>

    @Override
    public void onSaveInstanceState(Bundle bundle) {
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (mBuilder != null) {</span>
<span class="nc" id="L212">            mBuilder.copyIntoBundle(bundle);</span>

            // We also saved the itineraries and the results state in this bundle
<span class="nc" id="L215">            Bundle source = mBuilder.getBundle();</span>

<span class="nc" id="L217">            ArrayList&lt;Itinerary&gt; itineraries = (ArrayList&lt;Itinerary&gt;) source</span>
<span class="nc" id="L218">                    .getSerializable(OTPConstants.ITINERARIES);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">            if (itineraries != null) {</span>
<span class="nc" id="L220">                bundle.putSerializable(OTPConstants.ITINERARIES, itineraries);</span>
            }

<span class="nc" id="L223">            int rank = source.getInt(OTPConstants.SELECTED_ITINERARY);</span>
<span class="nc" id="L224">            bundle.putInt(OTPConstants.SELECTED_ITINERARY, rank);</span>

<span class="nc" id="L226">            boolean showMap = source.getBoolean(OTPConstants.SHOW_MAP);</span>
<span class="nc" id="L227">            bundle.putBoolean(OTPConstants.SHOW_MAP, showMap);</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">            boolean panelStateExpanded = (mPanel.getPanelState() == SlidingUpPanelLayout.PanelState.EXPANDED);</span>
<span class="nc" id="L230">            bundle.putBoolean(PANEL_STATE_EXPANDED, panelStateExpanded);</span>

<span class="nc" id="L232">            boolean showError = source.getBoolean(SHOW_ERROR_DIALOG);</span>
<span class="nc" id="L233">            bundle.putBoolean(SHOW_ERROR_DIALOG, showError);</span>
<span class="nc" id="L234">            bundle.putBoolean(REQUEST_LOADING, mRequestLoading);</span>
        }
<span class="nc" id="L236">        super.onSaveInstanceState(bundle);</span>
<span class="nc" id="L237">    }</span>

    @Override
    public void onPause() {
<span class="nc" id="L241">        super.onPause();</span>

        // Close possible progress dialog.
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (mProgressDialog != null) {</span>
<span class="nc" id="L245">            mProgressDialog.dismiss();</span>
        }

<span class="nc bnc" id="L248" title="All 2 branches missed.">        if (mFeedbackDialog != null) {</span>
<span class="nc" id="L249">            mFeedbackDialog.dismiss();</span>
        }
<span class="nc" id="L251">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L255" title="All 4 branches missed.">        if (mPanel != null &amp;&amp; mPanel.getPanelState() == SlidingUpPanelLayout.PanelState.EXPANDED) {</span>
<span class="nc" id="L256">            mPanel.setPanelState(SlidingUpPanelLayout.PanelState.COLLAPSED);</span>
        } else {
<span class="nc" id="L258">            super.onBackPressed();</span>
        }
<span class="nc" id="L260">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (item.getItemId() == android.R.id.home) {</span>
            // Ensure the software and hardware back buttons have the same behavior
<span class="nc" id="L266">            onBackPressed();</span>
<span class="nc" id="L267">            return true;</span>
        }
<span class="nc" id="L269">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    public void onTripRequestReady() {

        // Remove results fragment if it exists
<span class="nc" id="L276">        Fragment fragment = getSupportFragmentManager().findFragmentById(R.id.trip_results_fragment_container);</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (fragment != null) {</span>
<span class="nc" id="L278">            getSupportFragmentManager().beginTransaction().remove(fragment).commit();</span>
        }

<span class="nc" id="L281">        mTripRequest = mBuilder.setListener(this).execute(this);</span>

        // clear out selected itinerary from bundle
<span class="nc" id="L284">        Bundle bundle = mBuilder.getBundle();</span>
<span class="nc" id="L285">        bundle.remove(OTPConstants.ITINERARIES);</span>
<span class="nc" id="L286">        bundle.remove(OTPConstants.SELECTED_ITINERARY);</span>

<span class="nc" id="L288">        ObaAnalytics.reportUiEvent(mFirebaseAnalytics,</span>
<span class="nc" id="L289">                getString(R.string.analytics_label_trip_plan),</span>
                null);

<span class="nc" id="L292">        showProgressDialog();</span>
<span class="nc" id="L293">    }</span>

    private void initResultsFragment() {

<span class="nc" id="L297">        mResultsFragment = (TripResultsFragment) getSupportFragmentManager().findFragmentById(R.id.trip_results_fragment_container);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (mResultsFragment != null) {</span>
            // bundle arguments already set
<span class="nc" id="L300">            mResultsFragment.displayNewResults();</span>
<span class="nc" id="L301">            return;</span>
        }

<span class="nc" id="L304">        mResultsFragment = new TripResultsFragment();</span>
<span class="nc" id="L305">        mResultsFragment.setListener(this);</span>
<span class="nc" id="L306">        mResultsFragment.setArguments(mBuilder.getBundle());</span>
<span class="nc" id="L307">        getSupportFragmentManager().beginTransaction()</span>
<span class="nc" id="L308">                .add(R.id.trip_results_fragment_container, mResultsFragment).commit();</span>

<span class="nc" id="L310">        getSupportFragmentManager().executePendingTransactions();</span>
<span class="nc" id="L311">    }</span>

    @Override
    public void onTripRequestComplete(TripPlan tripPlan, String url) {
<span class="nc" id="L315">        TravelBehaviorManager.saveTripPlan(tripPlan, url, getApplicationContext());</span>
        // Send intent to ourselves...
<span class="nc" id="L317">        Intent intent = new Intent(this, TripPlanActivity.class)</span>
<span class="nc" id="L318">                .setAction(Intent.ACTION_MAIN)</span>
<span class="nc" id="L319">                .addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)</span>
<span class="nc" id="L320">                .putExtra(OTPConstants.ITINERARIES, (ArrayList&lt;Itinerary&gt;) tripPlan.getItinerary())</span>
<span class="nc" id="L321">                .putExtra(OTPConstants.INTENT_SOURCE, OTPConstants.Source.ACTIVITY)</span>
<span class="nc" id="L322">                .putExtra(PLAN_REQUEST_URL, url);</span>
<span class="nc" id="L323">        startActivity(intent);</span>
<span class="nc" id="L324">    }</span>

    @Override
    public void onTripRequestFailure(int errorCode, String url) {
<span class="nc" id="L328">        Intent intent = new Intent(this, TripPlanActivity.class)</span>
<span class="nc" id="L329">                .setAction(Intent.ACTION_MAIN)</span>
<span class="nc" id="L330">                .addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)</span>
<span class="nc" id="L331">                .putExtra(PLAN_ERROR_CODE, errorCode)</span>
<span class="nc" id="L332">                .putExtra(PLAN_ERROR_URL, url)</span>
<span class="nc" id="L333">                .putExtra(OTPConstants.INTENT_SOURCE, OTPConstants.Source.ACTIVITY);</span>
<span class="nc" id="L334">        startActivity(intent);</span>
<span class="nc" id="L335">    }</span>

    private void showFeedbackDialog(int errorCode, final String url) {
<span class="nc" id="L338">        String msg = getString(R.string.tripplanner_error_not_defined);</span>
<span class="nc bnc" id="L339" title="All 4 branches missed.">        if (errorCode &gt; 0 &amp;&amp; errorCode != Message.PLAN_OK.getId()) {</span>
<span class="nc" id="L340">            msg = getErrorMessage(errorCode);</span>
        }

<span class="nc" id="L343">        final Bundle bundle = mBuilder.getBundle();</span>
<span class="nc" id="L344">        AlertDialog.Builder feedback = new AlertDialog.Builder(this)</span>
<span class="nc" id="L345">                .setTitle(R.string.tripplanner_error_dialog_title)</span>
<span class="nc" id="L346">                .setMessage(msg);</span>
<span class="nc" id="L347">        feedback.setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L350">                bundle.putBoolean(SHOW_ERROR_DIALOG, false);</span>
<span class="nc" id="L351">                clearBundleErrors();</span>
<span class="nc" id="L352">            }</span>
        });
<span class="nc bnc" id="L354" title="All 2 branches missed.">        if (errorCode != Message.SYSTEM_ERROR.getId() &amp;&amp; errorCode != Message.REQUEST_TIMEOUT</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">                .getId()) {</span>
            // Only add the report button if we get a server response (see #747)
<span class="nc" id="L357">            feedback.setNegativeButton(R.string.report_problem_report,</span>
<span class="nc" id="L358">                    new DialogInterface.OnClickListener() {</span>
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L361">                            String email = Application.get().getCurrentRegion()</span>
<span class="nc" id="L362">                                    .getOtpContactEmail();</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">                            if (!TextUtils.isEmpty(email)) {</span>
<span class="nc" id="L364">                                Location loc = Application</span>
<span class="nc" id="L365">                                        .getLastKnownLocation(getApplicationContext(), null);</span>
<span class="nc" id="L366">                                String locString = null;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                                if (loc != null) {</span>
<span class="nc" id="L368">                                    locString = LocationUtils.printLocationDetails(loc);</span>
                                }
<span class="nc" id="L370">                                UIUtils.sendEmail(TripPlanActivity.this, email, locString, url,</span>
                                        true);
<span class="nc" id="L372">                                ObaAnalytics.reportUiEvent(mFirebaseAnalytics,</span>
<span class="nc" id="L373">                                        getString(R.string.analytics_label_app_feedback_otp),</span>
                                        null);
<span class="nc" id="L375">                            } else {</span>
<span class="nc" id="L376">                                Toast.makeText(TripPlanActivity.this,</span>
<span class="nc" id="L377">                                        getString(R.string.tripplanner_no_contact),</span>
<span class="nc" id="L378">                                        Toast.LENGTH_SHORT).show();</span>
                            }
<span class="nc" id="L380">                            bundle.putBoolean(SHOW_ERROR_DIALOG, false);</span>
<span class="nc" id="L381">                            clearBundleErrors();</span>
<span class="nc" id="L382">                        }</span>
                    });
        }

<span class="nc" id="L386">        mFeedbackDialog = feedback.create();</span>
<span class="nc" id="L387">        mFeedbackDialog.show();</span>
<span class="nc" id="L388">    }</span>

    private void showProgressDialog() {
<span class="nc" id="L391">        mRequestLoading = true;</span>
<span class="nc bnc" id="L392" title="All 4 branches missed.">        if (mProgressDialog == null || !mProgressDialog.isShowing()) {</span>
<span class="nc" id="L393">            mProgressDialog = ProgressDialog.show(this, &quot;&quot;,</span>
<span class="nc" id="L394">                    getResources().getText(R.string.task_progress_tripplanner_progress), true);</span>
        }
<span class="nc" id="L396">    }</span>

    private String getErrorMessage(int errorCode) {
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (errorCode == Message.SYSTEM_ERROR.getId()) {</span>
<span class="nc" id="L400">            return (getString(R.string.tripplanner_error_system));</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">        } else if (errorCode == Message.OUTSIDE_BOUNDS.getId()) {</span>
<span class="nc" id="L402">            return (getString(R.string.tripplanner_error_outside_bounds));</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">        } else if (errorCode == Message.PATH_NOT_FOUND.getId()) {</span>
<span class="nc" id="L404">            return (getString(R.string.tripplanner_error_path_not_found));</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">        } else if (errorCode == Message.NO_TRANSIT_TIMES.getId()) {</span>
<span class="nc" id="L406">            return (getString(R.string.tripplanner_error_no_transit_times));</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">        } else if (errorCode == Message.REQUEST_TIMEOUT.getId()) {</span>
<span class="nc" id="L408">            return (getString(R.string.tripplanner_error_request_timeout));</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">        } else if (errorCode == Message.BOGUS_PARAMETER.getId()) {</span>
<span class="nc" id="L410">            return (getString(R.string.tripplanner_error_bogus_parameter));</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_NOT_FOUND.getId()) {</span>
<span class="nc" id="L412">            return (getString(R.string.tripplanner_error_geocode_from_not_found));</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_TO_NOT_FOUND.getId()) {</span>
<span class="nc" id="L414">            return (getString(R.string.tripplanner_error_geocode_to_not_found));</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_TO_NOT_FOUND.getId()) {</span>
<span class="nc" id="L416">            return (getString(R.string.tripplanner_error_geocode_from_to_not_found));</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">        } else if (errorCode == Message.TOO_CLOSE.getId()) {</span>
<span class="nc" id="L418">            return (getString(R.string.tripplanner_error_too_close));</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">        } else if (errorCode == Message.LOCATION_NOT_ACCESSIBLE.getId()) {</span>
<span class="nc" id="L420">            return (getString(R.string.tripplanner_error_location_not_accessible));</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L422">            return (getString(R.string.tripplanner_error_geocode_from_ambiguous));</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_TO_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L424">            return (getString(R.string.tripplanner_error_geocode_to_ambiguous));</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">        } else if (errorCode == Message.GEOCODE_FROM_TO_AMBIGUOUS.getId()) {</span>
<span class="nc" id="L426">            return (getString(R.string.tripplanner_error_geocode_from_to_ambiguous));</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">        } else if (errorCode == Message.UNDERSPECIFIED_TRIANGLE.getId()</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                || errorCode == Message.TRIANGLE_NOT_AFFINE.getId()</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">                || errorCode == Message.TRIANGLE_OPTIMIZE_TYPE_NOT_SET.getId()</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">                || errorCode == Message.TRIANGLE_VALUES_NOT_SET.getId()) {</span>
<span class="nc" id="L431">            return (getString(R.string.tripplanner_error_triangle));</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">        } else if (errorCode == TripRequest.NO_SERVER_SELECTED) {</span>
<span class="nc" id="L433">            return getString(R.string.tripplanner_no_server_selected_error);</span>
        } else {
<span class="nc" id="L435">            return null;</span>
        }
    }

    private void clearBundleErrors() {
<span class="nc" id="L440">        mBuilder.getBundle().remove(PLAN_ERROR_CODE);</span>
<span class="nc" id="L441">        mBuilder.getBundle().remove(PLAN_ERROR_URL);</span>
<span class="nc" id="L442">    }</span>

    // Handle the sliding panel's interactions with the list view and the map view.
    @Override
    public void onResultViewCreated(View container, final ListView listView, View mapView) {
<span class="nc bnc" id="L447" title="All 2 branches missed.">        if (mPanel != null) {</span>
<span class="nc" id="L448">            mPanel.setScrollableViewHelper(new ScrollableViewHelper() {</span>
                @Override
                public int getScrollableViewScrollPosition(View scrollableView, boolean isSlidingUp) {
<span class="nc bnc" id="L451" title="All 2 branches missed.">                    if (mResultsFragment.isMapShowing()) {</span>
<span class="nc" id="L452">                        return 1; // Map can scroll infinitely, so return a positive value</span>
                    } else {
<span class="nc" id="L454">                        return super.getScrollableViewScrollPosition(listView, isSlidingUp);</span>
                    }
                }
            });
<span class="nc" id="L458">            mPanel.setScrollableView(container);</span>
        }
<span class="nc" id="L460">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>