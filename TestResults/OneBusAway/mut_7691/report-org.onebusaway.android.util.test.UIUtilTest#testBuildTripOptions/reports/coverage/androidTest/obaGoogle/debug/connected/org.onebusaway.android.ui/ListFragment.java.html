<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ListFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.ui</a> &gt; <span class="el_source">ListFragment.java</span></div><h1>ListFragment.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2011-2016 The Android Open Source Project, University of South Florida
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.onebusaway.android.ui;

import org.onebusaway.android.R;

import android.content.Context;
import android.os.Bundle;
import android.os.Handler;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.AnimationUtils;
import android.widget.AdapterView;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import android.widget.ListAdapter;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.TextView;

import androidx.fragment.app.Fragment;

/**
 * This is copied from the support package that allows us to use our own IDs,
 * because being able to specify our own custom view and still use all of this
 * good switching code is helpful.
 */
public class ListFragment extends Fragment {

<span class="nc" id="L46">    final private Handler mHandler = new Handler();</span>

<span class="nc" id="L48">    final private Runnable mRequestFocus = new Runnable() {</span>
        public void run() {
<span class="nc" id="L50">            mList.focusableViewAvailable(mList);</span>
<span class="nc" id="L51">        }</span>
    };

<span class="nc" id="L54">    final private AdapterView.OnItemClickListener mOnClickListener</span>
<span class="nc" id="L55">            = new AdapterView.OnItemClickListener() {</span>
        public void onItemClick(AdapterView&lt;?&gt; parent, View v, int position, long id) {
<span class="nc" id="L57">            onListItemClick((ListView) parent, v, position, id);</span>
<span class="nc" id="L58">        }</span>
    };

    ListAdapter mAdapter;

    ListView mList;

    View mEmptyView;

    TextView mStandardEmptyView;

    View mProgressContainer;

    View mRefreshProgressContainer;

    View mListContainer;

    CharSequence mEmptyText;

    boolean mListShown;

<span class="nc" id="L79">    public ListFragment() {</span>
<span class="nc" id="L80">    }</span>

    /**
     * Provide default implementation to return a simple list view.  Subclasses
     * can override to replace with their own layout.  If doing so, the
     * returned view hierarchy &lt;em&gt;must&lt;/em&gt; have a ListView whose id
     * is {@link android.R.id#list android.R.id.list} and can optionally
     * have a sibling view id {@link android.R.id#empty android.R.id.empty}
     * that is to be shown when the list is empty.
     *
     * &lt;p&gt;If you are overriding this method with your own custom content,
     * consider including the standard layout {@link android.R.layout#list_content}
     * in your layout file, so that you continue to retain all of the standard
     * behavior of ListFragment.  In particular, this is currently the only
     * way to have the built-in indeterminant progress state be shown.
     */
    @Override
    @SuppressWarnings(&quot;deprecation&quot;)
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
<span class="nc" id="L100">        final Context context = getActivity();</span>

<span class="nc" id="L102">        FrameLayout root = new FrameLayout(context);</span>

        // ------------------------------------------------------------------

<span class="nc" id="L106">        LinearLayout pframe = new LinearLayout(context);</span>
<span class="nc" id="L107">        pframe.setId(R.id.loading);</span>
<span class="nc" id="L108">        pframe.setOrientation(LinearLayout.VERTICAL);</span>
<span class="nc" id="L109">        pframe.setVisibility(View.GONE);</span>
<span class="nc" id="L110">        pframe.setGravity(Gravity.CENTER);</span>

<span class="nc" id="L112">        ProgressBar progress = new ProgressBar(context, null,</span>
                android.R.attr.progressBarStyleLarge);
<span class="nc" id="L114">        pframe.addView(progress, new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT));

<span class="nc" id="L117">        root.addView(pframe, new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));

        // ------------------------------------------------------------------

<span class="nc" id="L122">        FrameLayout lframe = new FrameLayout(context);</span>
<span class="nc" id="L123">        lframe.setId(R.id.listContainer);</span>

<span class="nc" id="L125">        TextView tv = new TextView(getActivity());</span>
<span class="nc" id="L126">        tv.setId(R.id.internalEmpty);</span>
<span class="nc" id="L127">        tv.setGravity(Gravity.CENTER);</span>
<span class="nc" id="L128">        lframe.addView(tv, new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));

<span class="nc" id="L131">        ListView lv = new ListView(getActivity());</span>
<span class="nc" id="L132">        lv.setId(android.R.id.list);</span>
<span class="nc" id="L133">        lv.setDrawSelectorOnTop(false);</span>
<span class="nc" id="L134">        lframe.addView(lv, new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));

<span class="nc" id="L137">        root.addView(lframe, new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));

        // ------------------------------------------------------------------

<span class="nc" id="L142">        root.setLayoutParams(new FrameLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));

<span class="nc" id="L145">        return root;</span>
    }

    /**
     * Attach to list view once the view hierarchy has been created.
     */
    @Override
    public void onViewCreated(View view, Bundle savedInstanceState) {
<span class="nc" id="L153">        super.onViewCreated(view, savedInstanceState);</span>
<span class="nc" id="L154">        ensureList();</span>
<span class="nc" id="L155">    }</span>

    /**
     * Detach from list view.
     */
    @Override
    public void onDestroyView() {
<span class="nc" id="L162">        mHandler.removeCallbacks(mRequestFocus);</span>
<span class="nc" id="L163">        mList = null;</span>
<span class="nc" id="L164">        mListShown = false;</span>
<span class="nc" id="L165">        mEmptyView = mProgressContainer = mRefreshProgressContainer = mListContainer = null;</span>
<span class="nc" id="L166">        mStandardEmptyView = null;</span>
<span class="nc" id="L167">        super.onDestroyView();</span>
<span class="nc" id="L168">    }</span>

    /**
     * This method will be called when an item in the list is selected.
     * Subclasses should override. Subclasses can call
     * getListView().getItemAtPosition(position) if they need to access the
     * data associated with the selected item.
     *
     * @param l        The ListView where the click happened
     * @param v        The view that was clicked within the ListView
     * @param position The position of the view in the list
     * @param id       The row id of the item that was clicked
     */
    public void onListItemClick(ListView l, View v, int position, long id) {
<span class="nc" id="L182">    }</span>

    /**
     * Provide the cursor for the list view.
     */
    public void setListAdapter(ListAdapter adapter) {
<span class="nc bnc" id="L188" title="All 2 branches missed.">        boolean hadAdapter = mAdapter != null;</span>
<span class="nc" id="L189">        mAdapter = adapter;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (mList != null) {</span>
<span class="nc" id="L191">            mList.setAdapter(adapter);</span>
<span class="nc bnc" id="L192" title="All 4 branches missed.">            if (!mListShown &amp;&amp; !hadAdapter) {</span>
                // The list was hidden, and previously didn't have an
                // adapter.  It is now time to show it.
<span class="nc bnc" id="L195" title="All 2 branches missed.">                setListShown(true, getView().getWindowToken() != null);</span>
            }
        }
<span class="nc" id="L198">    }</span>

    /**
     * Set the currently selected list item to the specified
     * position with the adapter's data
     */
    public void setSelection(int position) {
<span class="nc" id="L205">        ensureList();</span>
<span class="nc" id="L206">        mList.setSelection(position);</span>
<span class="nc" id="L207">    }</span>

    /**
     * Get the position of the currently selected list item.
     */
    public int getSelectedItemPosition() {
<span class="nc" id="L213">        ensureList();</span>
<span class="nc" id="L214">        return mList.getSelectedItemPosition();</span>
    }

    /**
     * Get the cursor row ID of the currently selected list item.
     */
    public long getSelectedItemId() {
<span class="nc" id="L221">        ensureList();</span>
<span class="nc" id="L222">        return mList.getSelectedItemId();</span>
    }

    /**
     * Get the activity's list view widget.
     */
    public ListView getListView() {
<span class="nc" id="L229">        ensureList();</span>
<span class="nc" id="L230">        return mList;</span>
    }

    /**
     * The default content for a ListFragment has a TextView that can
     * be shown when the list is empty.  If you would like to have it
     * shown, call this method to supply the text it should use.
     */
    public void setEmptyText(CharSequence text) {
<span class="nc" id="L239">        ensureList();</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (mStandardEmptyView == null) {</span>
<span class="nc" id="L241">            throw new IllegalStateException(&quot;Can't be used with a custom content view&quot;);</span>
        }
<span class="nc" id="L243">        mStandardEmptyView.setText(text);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (mEmptyText == null) {</span>
<span class="nc" id="L245">            mList.setEmptyView(mStandardEmptyView);</span>
        }
<span class="nc" id="L247">        mEmptyText = text;</span>
<span class="nc" id="L248">    }</span>

    /**
     * Control whether the list is being displayed.  You can make it not
     * displayed if you are waiting for the initial data to show in it.  During
     * this time an indeterminant progress indicator will be shown instead.
     *
     * &lt;p&gt;Applications do not normally need to use this themselves.  The default
     * behavior of ListFragment is to start with the list not being shown, only
     * showing it once an adapter is given with {@link #setListAdapter(ListAdapter)}.
     * If the list at that point had not been shown, when it does get shown
     * it will be do without the user ever seeing the hidden state.
     *
     * @param shown If true, the list view is shown; if false, the progress
     *              indicator.  The initial value is true.
     */
    public void setListShown(boolean shown) {
<span class="nc" id="L265">        setListShown(shown, true);</span>
<span class="nc" id="L266">    }</span>

    /**
     * Like {@link #setListShown(boolean)}, but no animation is used when
     * transitioning from the previous state.
     */
    public void setListShownNoAnimation(boolean shown) {
<span class="nc" id="L273">        setListShown(shown, false);</span>
<span class="nc" id="L274">    }</span>

    /**
     * Control whether the list is being displayed.  You can make it not
     * displayed if you are waiting for the initial data to show in it.  During
     * this time an indeterminant progress indicator will be shown instead.
     *
     * @param shown   If true, the list view is shown; if false, the progress
     *                indicator.  The initial value is true.
     * @param animate If true, an animation will be used to transition to the
     *                new state.
     */
    private void setListShown(boolean shown, boolean animate) {
<span class="nc" id="L287">        ensureList();</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">        if (mProgressContainer == null) {</span>
<span class="nc" id="L289">            throw new IllegalStateException(&quot;Can't be used with a custom content view&quot;);</span>
        }
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (mListShown == shown) {</span>
<span class="nc" id="L292">            return;</span>
        }
<span class="nc" id="L294">        mListShown = shown;</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (shown) {</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">            if (animate) {</span>
<span class="nc" id="L297">                mProgressContainer.startAnimation(AnimationUtils.loadAnimation(</span>
<span class="nc" id="L298">                        getActivity(), android.R.anim.fade_out));</span>
<span class="nc" id="L299">                mListContainer.startAnimation(AnimationUtils.loadAnimation(</span>
<span class="nc" id="L300">                        getActivity(), android.R.anim.fade_in));</span>
            } else {
<span class="nc" id="L302">                mProgressContainer.clearAnimation();</span>
<span class="nc" id="L303">                mListContainer.clearAnimation();</span>
            }
<span class="nc" id="L305">            mProgressContainer.setVisibility(View.GONE);</span>
<span class="nc" id="L306">            mListContainer.setVisibility(View.VISIBLE);</span>
        } else {
<span class="nc bnc" id="L308" title="All 2 branches missed.">            if (animate) {</span>
<span class="nc" id="L309">                mProgressContainer.startAnimation(AnimationUtils.loadAnimation(</span>
<span class="nc" id="L310">                        getActivity(), android.R.anim.fade_in));</span>
<span class="nc" id="L311">                mListContainer.startAnimation(AnimationUtils.loadAnimation(</span>
<span class="nc" id="L312">                        getActivity(), android.R.anim.fade_out));</span>
            } else {
<span class="nc" id="L314">                mProgressContainer.clearAnimation();</span>
<span class="nc" id="L315">                mListContainer.clearAnimation();</span>
            }
<span class="nc" id="L317">            mProgressContainer.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L318">            mListContainer.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L320">    }</span>

    /**
     * Get the ListAdapter associated with this activity's ListView.
     */
    public ListAdapter getListAdapter() {
<span class="nc" id="L326">        return mAdapter;</span>
    }

    private void ensureList() {
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if (mList != null) {</span>
<span class="nc" id="L331">            return;</span>
        }
<span class="nc" id="L333">        View root = getView();</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (root == null) {</span>
<span class="nc" id="L335">            throw new IllegalStateException(&quot;Content view not yet created&quot;);</span>
        }
<span class="nc bnc" id="L337" title="All 2 branches missed.">        if (root instanceof ListView) {</span>
<span class="nc" id="L338">            mList = (ListView) root;</span>
        } else {
<span class="nc" id="L340">            mStandardEmptyView = (TextView) root.findViewById(R.id.internalEmpty);</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">            if (mStandardEmptyView == null) {</span>
<span class="nc" id="L342">                mEmptyView = root.findViewById(android.R.id.empty);</span>
            } else {
<span class="nc" id="L344">                mStandardEmptyView.setVisibility(View.GONE);</span>
            }
<span class="nc" id="L346">            mProgressContainer = root.findViewById(R.id.loading);</span>
<span class="nc" id="L347">            mRefreshProgressContainer = root.findViewById(R.id.refresh_loading);</span>
            // Set %50 transparency to progress bar
<span class="nc" id="L349">            ProgressBar progressBar = (ProgressBar) root.findViewById(R.id.refresh_progress_small);</span>
<span class="nc bnc" id="L350" title="All 4 branches missed.">            if (progressBar != null &amp;&amp; progressBar.getIndeterminateDrawable() != null) {</span>
<span class="nc" id="L351">                progressBar.getIndeterminateDrawable().setAlpha(128);</span>
            }

<span class="nc" id="L354">            mListContainer = root.findViewById(R.id.listContainer);</span>
<span class="nc" id="L355">            View rawListView = root.findViewById(android.R.id.list);</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">            if (!(rawListView instanceof ListView)) {</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                if (rawListView == null) {</span>
<span class="nc" id="L358">                    throw new RuntimeException(</span>
                            &quot;Your content must have a ListView whose id attribute is &quot; +
                                    &quot;'android.R.id.list'&quot;);
                }
<span class="nc" id="L362">                throw new RuntimeException(</span>
                        &quot;Content has view with id attribute 'android.R.id.list' &quot;
                                + &quot;that is not a ListView class&quot;);
            }
<span class="nc" id="L366">            mList = (ListView) rawListView;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (mEmptyView != null) {</span>
<span class="nc" id="L368">                mList.setEmptyView(mEmptyView);</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">            } else if (mEmptyText != null) {</span>
<span class="nc" id="L370">                mStandardEmptyView.setText(mEmptyText);</span>
<span class="nc" id="L371">                mList.setEmptyView(mStandardEmptyView);</span>
            }
        }
<span class="nc" id="L374">        mListShown = true;</span>
<span class="nc" id="L375">        mList.setOnItemClickListener(mOnClickListener);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (mAdapter != null) {</span>
<span class="nc" id="L377">            ListAdapter adapter = mAdapter;</span>
<span class="nc" id="L378">            mAdapter = null;</span>
<span class="nc" id="L379">            setListAdapter(adapter);</span>
<span class="nc" id="L380">        } else {</span>
            // We are starting without an adapter, so assume we won't
            // have our data right away and start with the progress indicator.
<span class="nc bnc" id="L383" title="All 2 branches missed.">            if (mProgressContainer != null) {</span>
<span class="nc" id="L384">                setListShown(false, false);</span>
            }
        }
<span class="nc" id="L387">        mHandler.post(mRequestFocus);</span>
<span class="nc" id="L388">    }</span>

    protected void showProgress(boolean visibility) {
<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (mRefreshProgressContainer == null)</span>
<span class="nc" id="L392">            return;</span>

<span class="nc bnc" id="L394" title="All 2 branches missed.">        if (visibility) {</span>
<span class="nc" id="L395">            mRefreshProgressContainer.setVisibility(View.VISIBLE);</span>
        } else {
<span class="nc" id="L397">            mRefreshProgressContainer.setVisibility(View.GONE);</span>
        }
<span class="nc" id="L399">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>