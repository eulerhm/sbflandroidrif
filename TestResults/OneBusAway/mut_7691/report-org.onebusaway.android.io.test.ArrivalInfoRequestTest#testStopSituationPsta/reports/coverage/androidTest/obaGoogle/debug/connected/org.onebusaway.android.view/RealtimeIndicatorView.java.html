<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RealtimeIndicatorView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">obaGoogleDebug</a> &gt; <a href="index.source.html" class="el_package">org.onebusaway.android.view</a> &gt; <span class="el_source">RealtimeIndicatorView.java</span></div><h1>RealtimeIndicatorView.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 University of South Florida (sjbarbeau@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.onebusaway.android.view;

import org.onebusaway.android.R;

import android.annotation.TargetApi;
import android.content.Context;
import android.content.res.TypedArray;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.os.Build;
import android.util.AttributeSet;
import android.view.View;
import android.view.ViewTreeObserver;
import android.view.animation.Animation;
import android.view.animation.Transformation;

import androidx.interpolator.view.animation.FastOutLinearInInterpolator;

/**
 * View that animates a circle expanding and contracting to indicate real-time information
 */
public class RealtimeIndicatorView extends View {

    private Paint mFillPaint;

    private Paint mLinePaint;

    private Animation mAnimation1;

    private float mNewRadius;

    /**
     * Percentage of total view size that the circle should be drawn
     */
    private final static float SCALE = 0.45f;

    /**
     * Default fill color
     */
<span class="fc" id="L56">    public int mFillColor = 0xbbFFFFFF;</span>

    /**
     * Default line color
     */
<span class="fc" id="L61">    public int mLineColor = 0xFFFFFFFF;</span>

    /**
     * Default duration
     */
<span class="fc" id="L66">    private int mDuration = 1000;  // ms</span>

    /**
     * Set to true after the animation has been initialized
     */
<span class="fc" id="L71">    private boolean mInitComplete = false;</span>

    public RealtimeIndicatorView(Context context, AttributeSet attrs) {
<span class="fc" id="L74">        super(context, attrs);</span>

        // Get the custom attributes defined in XML
<span class="fc" id="L77">        TypedArray a = context</span>
<span class="fc" id="L78">                .obtainStyledAttributes(attrs, R.styleable.RealtimeIndicatorView, 0, 0);</span>
<span class="fc" id="L79">        mFillColor = a.getColor(R.styleable.RealtimeIndicatorView_fillColor, mFillColor);</span>
<span class="fc" id="L80">        mLineColor = a.getColor(R.styleable.RealtimeIndicatorView_lineColor, mLineColor);</span>
<span class="fc" id="L81">        mDuration = a.getInteger(R.styleable.RealtimeIndicatorView_duration, mDuration);</span>
<span class="fc" id="L82">        a.recycle();</span>

<span class="fc" id="L84">        mFillPaint = new Paint();</span>
<span class="fc" id="L85">        mFillPaint.setColor(mFillColor);</span>
<span class="fc" id="L86">        mFillPaint.setStyle(Paint.Style.FILL);</span>
<span class="fc" id="L87">        mFillPaint.setAntiAlias(true);</span>

<span class="fc" id="L89">        mLinePaint = new Paint();</span>
<span class="fc" id="L90">        mLinePaint.setStrokeWidth(3);</span>
<span class="fc" id="L91">        mLinePaint.setColor(mLineColor);</span>
<span class="fc" id="L92">        mLinePaint.setStyle(Paint.Style.STROKE);</span>
<span class="fc" id="L93">        mLinePaint.setAntiAlias(true);</span>

<span class="fc" id="L95">        setOnMeasureCallback();</span>
<span class="fc" id="L96">        ensureInit();</span>
<span class="fc" id="L97">    }</span>

    private void setOnMeasureCallback() {
<span class="fc" id="L100">        getViewTreeObserver().addOnGlobalLayoutListener(</span>
<span class="fc" id="L101">                new ViewTreeObserver.OnGlobalLayoutListener() {</span>
                    @Override
                    public void onGlobalLayout() {
<span class="nc" id="L104">                        removeOnGlobalLayoutListener(this);</span>
<span class="nc" id="L105">                        initAnimation();</span>
<span class="nc" id="L106">                    }</span>
                });
<span class="fc" id="L108">    }</span>

    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
    private void removeOnGlobalLayoutListener(ViewTreeObserver.OnGlobalLayoutListener listener) {
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (Build.VERSION.SDK_INT &lt; 16) {</span>
<span class="nc" id="L113">            getViewTreeObserver().removeGlobalOnLayoutListener(listener);</span>
        } else {
<span class="nc" id="L115">            getViewTreeObserver().removeOnGlobalLayoutListener(listener);</span>
        }
<span class="nc" id="L117">    }</span>

    /**
     * Makes sure the animation has been initialized.  This is a workaround to make sure
     * the animation is shown when this view is used within a list with an adapter.
     */
    private synchronized void ensureInit() {
<span class="fc" id="L124">        initAnimation();</span>
<span class="fc" id="L125">        this.postDelayed(new Runnable() {</span>
            @Override
            public void run() {
<span class="nc bnc" id="L128" title="All 2 branches missed.">                if (!mInitComplete) {</span>
<span class="nc" id="L129">                    initAnimation();</span>
                }
<span class="nc" id="L131">            }</span>
        }, 500);
<span class="fc" id="L133">    }</span>

    /**
     * Setup the animation
     */
    private synchronized void initAnimation() {
        // Animate circle expand/contract
<span class="fc" id="L140">        mAnimation1 = new Animation() {</span>
            @Override
            protected void applyTransformation(float interpolatedTime, Transformation t) {
<span class="nc" id="L143">                int height = getHeight();</span>
<span class="nc" id="L144">                mNewRadius = height * interpolatedTime;</span>
<span class="nc" id="L145">                invalidate();</span>
<span class="nc" id="L146">            }</span>
        };

<span class="fc" id="L149">        mAnimation1.setDuration(mDuration);</span>
<span class="fc" id="L150">        mAnimation1.setRepeatMode(Animation.REVERSE);</span>
<span class="fc" id="L151">        mAnimation1.setInterpolator(new FastOutLinearInInterpolator());</span>
<span class="fc" id="L152">        mAnimation1.setRepeatCount(Animation.INFINITE);</span>
<span class="fc" id="L153">        startAnimation(mAnimation1);</span>
<span class="fc" id="L154">        mInitComplete = true;</span>
<span class="fc" id="L155">    }</span>

    @Override
    protected void onDraw(Canvas canvas) {
<span class="nc" id="L159">        super.onDraw(canvas);</span>
<span class="nc" id="L160">        int height = getHeight();</span>
<span class="nc" id="L161">        int width = getWidth();</span>

<span class="nc" id="L163">        float x = width / 2.0f;</span>
<span class="nc" id="L164">        float y = height / 2.0f;</span>

<span class="nc" id="L166">        canvas.drawCircle(x, y, mNewRadius * SCALE, mFillPaint);</span>
<span class="nc" id="L167">        canvas.drawCircle(x, y, mNewRadius * SCALE, mLinePaint);</span>
<span class="nc" id="L168">    }</span>

    /**
     * Set the fill color to be used when drawing the expanding/contracting circle, in the format
     * 0xbbFFFFFF.
     *
     * @param color the fill color to be used when drawing the expanding/contracting circle, in the
     *              format
     *              0xbbFFFFFF.
     */
    public void setFillColor(int color) {
<span class="fc" id="L179">        mFillColor = color;</span>
<span class="fc" id="L180">        mFillPaint.setColor(color);</span>
<span class="fc" id="L181">    }</span>

    /**
     * Set the line (i.e., stroke) color to be used when drawing the expanding/contracting circle,
     * in the format
     * 0xbbFFFFFF.
     *
     * @param color the line (i.e., stroke) to be used when drawing the expanding/contracting
     *              circle, in the format
     *              0xbbFFFFFF.
     */
    public void setLineColor(int color) {
<span class="fc" id="L193">        mLineColor = color;</span>
<span class="fc" id="L194">        mLinePaint.setColor(color);</span>
<span class="fc" id="L195">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.0</div></body></html>