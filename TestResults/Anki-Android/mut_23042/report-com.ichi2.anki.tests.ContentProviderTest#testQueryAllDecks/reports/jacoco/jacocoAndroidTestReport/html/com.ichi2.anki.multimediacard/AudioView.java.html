<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AudioView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki.multimediacard</a> &gt; <span class="el_source">AudioView.java</span></div><h1>AudioView.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2013 Bibek Shrestha &lt;bibekshrestha@gmail.com&gt;                          *
 *  Copyright (c) 2013 Zaur Molotnikov &lt;qutorial@gmail.com&gt;                              *
 *  Copyright (c) 2013 Nicolas Raoul &lt;nicolas.raoul@gmail.com&gt;                           *
 *  Copyright (c) 2013 Flavio Lerda &lt;flerda@gmail.com&gt;                                   *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki.multimediacard;

import android.annotation.SuppressLint;
import android.content.Context;
import android.media.MediaPlayer;
import android.media.MediaRecorder;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.widget.AppCompatImageButton;
import android.view.Gravity;
import android.view.View;
import android.widget.LinearLayout;
import com.ichi2.anki.AnkiDroidApp;
import com.ichi2.anki.R;
import com.ichi2.anki.UIUtils;
import java.io.File;
import java.io.IOException;
import com.ichi2.utils.Permissions;
import timber.log.Timber;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

// Not designed for visual editing
@SuppressLint(&quot;ViewConstructor&quot;)
public class AudioView extends LinearLayout {

    protected final String mAudioPath;

<span class="nc" id="L48">    protected PlayPauseButton mPlayPause = null;</span>

<span class="nc" id="L50">    protected StopButton mStop = null;</span>

<span class="nc" id="L52">    protected RecordButton mRecord = null;</span>

<span class="nc" id="L54">    private MediaRecorder mRecorder = null;</span>

<span class="nc" id="L56">    private MediaPlayer mPlayer = null;</span>

<span class="nc" id="L58">    private OnRecordingFinishEventListener mOnRecordingFinishEventListener = null;</span>

<span class="nc" id="L60">    private Status mStatus = Status.IDLE;</span>

    private final int mResPlayImage;

    private final int mResPauseImage;

    private final int mResStopImage;

    private int mResRecordImage;

    private int mResRecordStopImage;

    private final Context mContext;

<span class="nc" id="L74">    enum Status {</span>

        // Default initial state
<span class="nc" id="L77">        IDLE,</span>
        // When datasource has been set
<span class="nc" id="L79">        INITIALIZED,</span>
        // The different possible states once playing
<span class="nc" id="L81">        PLAYING,</span>
        // The different possible states once playing
<span class="nc" id="L83">        PAUSED,</span>
        // The different possible states once playing
<span class="nc" id="L85">        STOPPED,</span>
        // The recorder being played status
<span class="nc" id="L87">        RECORDING</span>
    }

    public static AudioView createRecorderInstance(Context context, int resPlay, int resPause, int resStop, int resRecord, int resRecordStop, String audioPath) {
        try {
<span class="nc" id="L92">            return new AudioView(context, resPlay, resPause, resStop, resRecord, resRecordStop, audioPath);</span>
<span class="nc" id="L93">        } catch (Exception e) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2061)) {</span>
<span class="nc" id="L95">                Timber.e(e);</span>
            }
<span class="nc bnc" id="L97" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2062)) {</span>
<span class="nc" id="L98">                AnkiDroidApp.sendExceptionReport(e, &quot;Unable to create recorder tool bar&quot;);</span>
            }
<span class="nc bnc" id="L100" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2063)) {</span>
<span class="nc" id="L101">                UIUtils.showThemedToast(context, context.getText(R.string.multimedia_editor_audio_view_create_failed).toString(), true);</span>
            }
<span class="nc" id="L103">            return null;</span>
        }
    }

    @Nullable
    public static String generateTempAudioFile(@NonNull Context context) {
        String tempAudioPath;
        try {
<span class="nc" id="L111">            File storingDirectory = context.getCacheDir();</span>
<span class="nc" id="L112">            tempAudioPath = File.createTempFile(&quot;ankidroid_audiorec&quot;, &quot;.3gp&quot;, storingDirectory).getAbsolutePath();</span>
<span class="nc" id="L113">        } catch (IOException e) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2064)) {</span>
<span class="nc" id="L115">                Timber.e(e, &quot;Could not create temporary audio file.&quot;);</span>
            }
<span class="nc" id="L117">            tempAudioPath = null;</span>
<span class="nc" id="L118">        }</span>
<span class="nc" id="L119">        return tempAudioPath;</span>
    }

    private AudioView(Context context, int resPlay, int resPause, int resStop, String audioPath) {
<span class="nc" id="L123">        super(context);</span>
<span class="nc" id="L124">        mContext = context;</span>
<span class="nc" id="L125">        mResPlayImage = resPlay;</span>
<span class="nc" id="L126">        mResPauseImage = resPause;</span>
<span class="nc" id="L127">        mResStopImage = resStop;</span>
<span class="nc" id="L128">        mAudioPath = audioPath;</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2065)) {</span>
<span class="nc" id="L130">            this.setOrientation(HORIZONTAL);</span>
        }
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2066)) {</span>
<span class="nc" id="L133">            mPlayPause = new PlayPauseButton(context);</span>
        }
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2067)) {</span>
<span class="nc" id="L136">            addView(mPlayPause, new LinearLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));</span>
        }
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2068)) {</span>
<span class="nc" id="L139">            mStop = new StopButton(context);</span>
        }
<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2069)) {</span>
<span class="nc" id="L142">            addView(mStop, new LinearLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));</span>
        }
<span class="nc" id="L144">    }</span>

    private String gtxt(int id) {
<span class="nc" id="L147">        return mContext.getText(id).toString();</span>
    }

    private AudioView(Context context, int resPlay, int resPause, int resStop, int resRecord, int resRecordStop, String audioPath) {
<span class="nc" id="L151">        this(context, resPlay, resPause, resStop, audioPath);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2070)) {</span>
<span class="nc" id="L153">            mResRecordImage = resRecord;</span>
        }
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2071)) {</span>
<span class="nc" id="L156">            mResRecordStopImage = resRecordStop;</span>
        }
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2072)) {</span>
<span class="nc" id="L159">            this.setOrientation(HORIZONTAL);</span>
        }
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2073)) {</span>
<span class="nc" id="L162">            this.setGravity(Gravity.CENTER);</span>
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2074)) {</span>
<span class="nc" id="L165">            mRecord = new RecordButton(context);</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2075)) {</span>
<span class="nc" id="L168">            addView(mRecord, new LinearLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));</span>
        }
<span class="nc" id="L170">    }</span>

    public String getAudioPath() {
<span class="nc" id="L173">        return mAudioPath;</span>
    }

    public void setOnRecordingFinishEventListener(OnRecordingFinishEventListener listener) {
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2076)) {</span>
<span class="nc" id="L178">            mOnRecordingFinishEventListener = listener;</span>
        }
<span class="nc" id="L180">    }</span>

    public void notifyPlay() {
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2077)) {</span>
<span class="nc" id="L184">            mPlayPause.update();</span>
        }
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2078)) {</span>
<span class="nc" id="L187">            mStop.update();</span>
        }
<span class="nc bnc" id="L189" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2080)) {</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2079)) {</span>
<span class="nc" id="L192">                    mRecord.update();</span>
                }
            }
        }
<span class="nc" id="L196">    }</span>

    public void notifyStop() {
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2081)) {</span>
            // Send state change signal to all buttons
<span class="nc" id="L201">            mPlayPause.update();</span>
        }
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2082)) {</span>
<span class="nc" id="L204">            mStop.update();</span>
        }
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2084)) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2083)) {</span>
<span class="nc" id="L209">                    mRecord.update();</span>
                }
            }
        }
<span class="nc" id="L213">    }</span>

    public void notifyPause() {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2085)) {</span>
<span class="nc" id="L217">            mPlayPause.update();</span>
        }
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2086)) {</span>
<span class="nc" id="L220">            mStop.update();</span>
        }
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2088)) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2087)) {</span>
<span class="nc" id="L225">                    mRecord.update();</span>
                }
            }
        }
<span class="nc" id="L229">    }</span>

    public void notifyRecord() {
<span class="nc bnc" id="L232" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2089)) {</span>
<span class="nc" id="L233">            mPlayPause.update();</span>
        }
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2090)) {</span>
<span class="nc" id="L236">            mStop.update();</span>
        }
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2092)) {</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2091)) {</span>
<span class="nc" id="L241">                    mRecord.update();</span>
                }
            }
        }
<span class="nc" id="L245">    }</span>

    public void notifyStopRecord() {
<span class="nc bnc" id="L248" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2100)) {</span>
<span class="nc bnc" id="L249" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(2093) ? (mRecorder != null || mStatus == Status.RECORDING) : (mRecorder != null &amp;&amp; mStatus == Status.RECORDING))) {</span>
                try {
<span class="nc bnc" id="L251" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2096)) {</span>
<span class="nc" id="L252">                        mRecorder.stop();</span>
                    }
<span class="nc" id="L254">                } catch (RuntimeException e) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2094)) {</span>
<span class="nc" id="L256">                        Timber.i(e, &quot;Recording stop failed, this happens if stop was hit immediately after start&quot;);</span>
                    }
<span class="nc bnc" id="L258" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(2095)) {</span>
<span class="nc" id="L259">                        UIUtils.showThemedToast(mContext, gtxt(R.string.multimedia_editor_audio_view_recording_failed), true);</span>
                    }
<span class="nc" id="L261">                }</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2097)) {</span>
<span class="nc" id="L263">                    mStatus = Status.IDLE;</span>
                }
<span class="nc bnc" id="L265" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2099)) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                    if (mOnRecordingFinishEventListener != null) {</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2098)) {</span>
<span class="nc" id="L268">                            mOnRecordingFinishEventListener.onRecordingFinish(AudioView.this);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L274" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2101)) {</span>
<span class="nc" id="L275">            mPlayPause.update();</span>
        }
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2102)) {</span>
<span class="nc" id="L278">            mStop.update();</span>
        }
<span class="nc bnc" id="L280" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2104)) {</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2103)) {</span>
<span class="nc" id="L283">                    mRecord.update();</span>
                }
            }
        }
<span class="nc" id="L287">    }</span>

    public void notifyReleaseRecorder() {
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2106)) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">            if (mRecorder != null) {</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2105)) {</span>
<span class="nc" id="L293">                    mRecorder.release();</span>
                }
            }
        }
<span class="nc" id="L297">    }</span>

    public void toggleRecord() {
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2108)) {</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">            if (mRecord != null) {</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2107)) {</span>
<span class="nc" id="L303">                    mRecord.callOnClick();</span>
                }
            }
        }
<span class="nc" id="L307">    }</span>

    public void togglePlay() {
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(2110)) {</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">            if (mPlayPause != null) {</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2109)) {</span>
<span class="nc" id="L313">                    mPlayPause.callOnClick();</span>
                }
            }
        }
<span class="nc" id="L317">    }</span>

    protected class PlayPauseButton extends AppCompatImageButton {

<span class="nc" id="L321">        private final OnClickListener onClickListener = new View.OnClickListener() {</span>

            @Override
            public void onClick(View v) {
<span class="nc bnc" id="L325" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2111)) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                    if (mAudioPath == null) {</span>
<span class="nc" id="L327">                        return;</span>
                    }
                }
<span class="nc bnc" id="L330" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2138)) {</span>
<span class="nc bnc" id="L331" title="All 6 branches missed.">                    switch(mStatus) {</span>
                        case IDLE:
                            try {
<span class="nc bnc" id="L334" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2115)) {</span>
<span class="nc" id="L335">                                    mPlayer = new MediaPlayer();</span>
                                }
<span class="nc bnc" id="L337" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2116)) {</span>
<span class="nc" id="L338">                                    mPlayer.setDataSource(getAudioPath());</span>
                                }
<span class="nc bnc" id="L340" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2117)) {</span>
<span class="nc" id="L341">                                    mPlayer.setOnCompletionListener(mp -&gt; {</span>
<span class="nc" id="L342">                                        mStatus = Status.STOPPED;</span>
<span class="nc" id="L343">                                        mPlayer.stop();</span>
<span class="nc" id="L344">                                        notifyStop();</span>
<span class="nc" id="L345">                                    });</span>
                                }
<span class="nc bnc" id="L347" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2118)) {</span>
<span class="nc" id="L348">                                    mPlayer.prepare();</span>
                                }
<span class="nc bnc" id="L350" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2119)) {</span>
<span class="nc" id="L351">                                    mPlayer.start();</span>
                                }
<span class="nc bnc" id="L353" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2120)) {</span>
<span class="nc" id="L354">                                    setImageResource(mResPauseImage);</span>
                                }
<span class="nc bnc" id="L356" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2121)) {</span>
<span class="nc" id="L357">                                    mStatus = Status.PLAYING;</span>
                                }
<span class="nc bnc" id="L359" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2122)) {</span>
<span class="nc" id="L360">                                    notifyPlay();</span>
                                }
<span class="nc" id="L362">                            } catch (Exception e) {</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2112)) {</span>
<span class="nc" id="L364">                                    Timber.e(e);</span>
                                }
<span class="nc bnc" id="L366" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2113)) {</span>
<span class="nc" id="L367">                                    UIUtils.showThemedToast(mContext, gtxt(R.string.multimedia_editor_audio_view_playing_failed), true);</span>
                                }
<span class="nc bnc" id="L369" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2114)) {</span>
<span class="nc" id="L370">                                    mStatus = Status.IDLE;</span>
                                }
<span class="nc" id="L372">                            }</span>
<span class="nc" id="L373">                            break;</span>
                        case PAUSED:
<span class="nc bnc" id="L375" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2123)) {</span>
                                // -&gt; Play, continue playing
<span class="nc" id="L377">                                mStatus = Status.PLAYING;</span>
                            }
<span class="nc bnc" id="L379" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2124)) {</span>
<span class="nc" id="L380">                                setImageResource(mResPauseImage);</span>
                            }
<span class="nc bnc" id="L382" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2125)) {</span>
<span class="nc" id="L383">                                mPlayer.start();</span>
                            }
<span class="nc bnc" id="L385" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2126)) {</span>
<span class="nc" id="L386">                                notifyPlay();</span>
                            }
                            break;
                        case STOPPED:
<span class="nc bnc" id="L390" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2127)) {</span>
                                // -&gt; Play, start from beginning
<span class="nc" id="L392">                                mStatus = Status.PLAYING;</span>
                            }
<span class="nc bnc" id="L394" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2128)) {</span>
<span class="nc" id="L395">                                setImageResource(mResPauseImage);</span>
                            }
                            try {
<span class="nc bnc" id="L398" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2130)) {</span>
<span class="nc" id="L399">                                    mPlayer.prepare();</span>
                                }
<span class="nc bnc" id="L401" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2131)) {</span>
<span class="nc" id="L402">                                    mPlayer.seekTo(0);</span>
                                }
<span class="nc" id="L404">                            } catch (Exception e) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2129)) {</span>
<span class="nc" id="L406">                                    Timber.e(e);</span>
                                }
<span class="nc" id="L408">                            }</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2132)) {</span>
<span class="nc" id="L410">                                mPlayer.start();</span>
                            }
<span class="nc bnc" id="L412" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2133)) {</span>
<span class="nc" id="L413">                                notifyPlay();</span>
                            }
                            break;
                        case PLAYING:
<span class="nc bnc" id="L417" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2134)) {</span>
<span class="nc" id="L418">                                setImageResource(mResPlayImage);</span>
                            }
<span class="nc bnc" id="L420" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2135)) {</span>
<span class="nc" id="L421">                                mPlayer.pause();</span>
                            }
<span class="nc bnc" id="L423" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2136)) {</span>
<span class="nc" id="L424">                                mStatus = Status.PAUSED;</span>
                            }
<span class="nc bnc" id="L426" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2137)) {</span>
<span class="nc" id="L427">                                notifyPause();</span>
                            }
                            break;
                        case RECORDING:
                            // this button should be disabled
<span class="nc" id="L432">                            break;</span>
                        default:
                            break;
                    }
                }
<span class="nc" id="L437">            }</span>
        };

<span class="nc" id="L440">        public PlayPauseButton(Context context) {</span>
<span class="nc" id="L441">            super(context);</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2139)) {</span>
<span class="nc" id="L443">                setImageResource(mResPlayImage);</span>
            }
<span class="nc bnc" id="L445" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2140)) {</span>
<span class="nc" id="L446">                setOnClickListener(onClickListener);</span>
            }
<span class="nc" id="L448">        }</span>

        public void update() {
<span class="nc bnc" id="L451" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2145)) {</span>
<span class="nc bnc" id="L452" title="All 3 branches missed.">                switch(mStatus) {</span>
                    case IDLE:
                    case STOPPED:
<span class="nc bnc" id="L455" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2141)) {</span>
<span class="nc" id="L456">                            setImageResource(mResPlayImage);</span>
                        }
<span class="nc bnc" id="L458" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2142)) {</span>
<span class="nc" id="L459">                            setEnabled(true);</span>
                        }
                        break;
                    case RECORDING:
<span class="nc bnc" id="L463" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2143)) {</span>
<span class="nc" id="L464">                            setEnabled(false);</span>
                        }
                        break;
                    default:
<span class="nc bnc" id="L468" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2144)) {</span>
<span class="nc" id="L469">                            setEnabled(true);</span>
                        }
                        break;
                }
            }
<span class="nc" id="L474">        }</span>
    }

    protected class StopButton extends AppCompatImageButton {

<span class="nc" id="L479">        private final OnClickListener onClickListener = v -&gt; {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            switch(mStatus) {</span>
                case PAUSED:
                case PLAYING:
<span class="nc" id="L483">                    mPlayer.stop();</span>
<span class="nc" id="L484">                    mStatus = Status.STOPPED;</span>
<span class="nc" id="L485">                    notifyStop();</span>
<span class="nc" id="L486">                    break;</span>
                case IDLE:
                case STOPPED:
                case RECORDING:
                case INITIALIZED:
                default:
                    break;
            }
<span class="nc" id="L494">        };</span>

<span class="nc" id="L496">        public StopButton(Context context) {</span>
<span class="nc" id="L497">            super(context);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2146)) {</span>
<span class="nc" id="L499">                setImageResource(mResStopImage);</span>
            }
<span class="nc bnc" id="L501" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2147)) {</span>
<span class="nc" id="L502">                setOnClickListener(onClickListener);</span>
            }
<span class="nc" id="L504">        }</span>

        public void update() {
<span class="nc bnc" id="L507" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2148)) {</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">                setEnabled(mStatus != Status.RECORDING);</span>
            }
<span class="nc" id="L510">        }</span>
    }

    protected class RecordButton extends AppCompatImageButton {

<span class="nc" id="L515">        private final OnClickListener onClickListener = new View.OnClickListener() {</span>

            @Override
            public void onClick(View v) {
<span class="nc bnc" id="L519" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2149)) {</span>
                    // Since mAudioPath is not compulsory, we check if it exists
<span class="nc bnc" id="L521" title="All 2 branches missed.">                    if (mAudioPath == null) {</span>
<span class="nc" id="L522">                        return;</span>
                    }
                }
<span class="nc bnc" id="L525" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2152)) {</span>
                    // We can get to this screen without permissions through the &quot;Pronunciation&quot; feature.
<span class="nc bnc" id="L527" title="All 2 branches missed.">                    if (!Permissions.canRecordAudio(mContext)) {</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2150)) {</span>
<span class="nc" id="L529">                            Timber.w(&quot;Audio recording permission denied.&quot;);</span>
                        }
<span class="nc bnc" id="L531" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2151)) {</span>
<span class="nc" id="L532">                            UIUtils.showThemedToast(mContext, getResources().getString(R.string.multimedia_editor_audio_permission_denied), true);</span>
                        }
<span class="nc" id="L534">                        return;</span>
                    }
                }
<span class="nc bnc" id="L537" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2174)) {</span>
<span class="nc bnc" id="L538" title="All 3 branches missed.">                    switch(mStatus) {</span>
                        // If not already recorded or not already played
                        case IDLE:
                        case // if already recorded or played
                        STOPPED:
<span class="nc" id="L543">                            boolean highSampling = false;</span>
                            try {
<span class="nc bnc" id="L545" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2153)) {</span>
                                    // can throw IllegalArgumentException if codec isn't supported
<span class="nc" id="L547">                                    mRecorder = initMediaRecorder();</span>
                                }
<span class="nc bnc" id="L549" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2154)) {</span>
<span class="nc" id="L550">                                    mRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);</span>
                                }
<span class="nc bnc" id="L552" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2155)) {</span>
<span class="nc" id="L553">                                    mRecorder.setAudioChannels(2);</span>
                                }
<span class="nc bnc" id="L555" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2156)) {</span>
<span class="nc" id="L556">                                    mRecorder.setAudioSamplingRate(44100);</span>
                                }
<span class="nc bnc" id="L558" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2157)) {</span>
<span class="nc" id="L559">                                    mRecorder.setAudioEncodingBitRate(192000);</span>
                                }
<span class="nc bnc" id="L561" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2158)) {</span>
                                    // this can also throw IOException if output path is invalid
<span class="nc" id="L563">                                    mRecorder.prepare();</span>
                                }
<span class="nc bnc" id="L565" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2159)) {</span>
<span class="nc" id="L566">                                    mRecorder.start();</span>
                                }
<span class="nc bnc" id="L568" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(2160)) {</span>
<span class="nc" id="L569">                                    highSampling = true;</span>
                                }
<span class="nc" id="L571">                            } catch (Exception e) {</span>
<span class="nc" id="L572">                            }</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2168)) {</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                                if (!highSampling) {</span>
                                    // fall back on default
                                    try {
<span class="nc bnc" id="L577" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2164)) {</span>
<span class="nc" id="L578">                                            mRecorder = initMediaRecorder();</span>
                                        }
<span class="nc bnc" id="L580" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2165)) {</span>
<span class="nc" id="L581">                                            mRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB);</span>
                                        }
<span class="nc bnc" id="L583" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2166)) {</span>
<span class="nc" id="L584">                                            mRecorder.prepare();</span>
                                        }
<span class="nc bnc" id="L586" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2167)) {</span>
<span class="nc" id="L587">                                            mRecorder.start();</span>
                                        }
<span class="nc" id="L589">                                    } catch (Exception e) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2161)) {</span>
                                            // either output file failed or codec didn't work, in any case fail out
<span class="nc" id="L592">                                            Timber.e(&quot;RecordButton.onClick() :: error recording to %s\n%s&quot;, mAudioPath, e.getMessage());</span>
                                        }
<span class="nc bnc" id="L594" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2162)) {</span>
<span class="nc" id="L595">                                            UIUtils.showThemedToast(mContext, gtxt(R.string.multimedia_editor_audio_view_recording_failed), true);</span>
                                        }
<span class="nc bnc" id="L597" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(2163)) {</span>
<span class="nc" id="L598">                                            mStatus = Status.STOPPED;</span>
                                        }
<span class="nc" id="L600">                                        break;</span>
<span class="nc" id="L601">                                    }</span>
                                }
                            }
<span class="nc bnc" id="L604" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2169)) {</span>
<span class="nc" id="L605">                                mStatus = Status.RECORDING;</span>
                            }
<span class="nc bnc" id="L607" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2170)) {</span>
<span class="nc" id="L608">                                setImageResource(mResRecordImage);</span>
                            }
<span class="nc bnc" id="L610" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2171)) {</span>
<span class="nc" id="L611">                                notifyRecord();</span>
                            }
                            break;
                        case RECORDING:
<span class="nc bnc" id="L615" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2172)) {</span>
<span class="nc" id="L616">                                setImageResource(mResRecordStopImage);</span>
                            }
<span class="nc bnc" id="L618" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(2173)) {</span>
<span class="nc" id="L619">                                notifyStopRecord();</span>
                            }
                            break;
                        default:
                            break;
                    }
                }
<span class="nc" id="L626">            }</span>

            private MediaRecorder initMediaRecorder() {
<span class="nc" id="L629">                MediaRecorder mr = new MediaRecorder();</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2175)) {</span>
<span class="nc" id="L631">                    mr.setAudioSource(MediaRecorder.AudioSource.MIC);</span>
                }
<span class="nc bnc" id="L633" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2176)) {</span>
<span class="nc" id="L634">                    mr.setOutputFormat(MediaRecorder.OutputFormat.THREE_GPP);</span>
                }
<span class="nc bnc" id="L636" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2177)) {</span>
<span class="nc" id="L637">                    mStatus = Status.INITIALIZED;</span>
                }
<span class="nc bnc" id="L639" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(2178)) {</span>
                    // audioPath
<span class="nc" id="L641">                    mr.setOutputFile(mAudioPath);</span>
                }
                // change
<span class="nc" id="L644">                return mr;</span>
            }
        };

<span class="nc" id="L648">        public RecordButton(Context context) {</span>
<span class="nc" id="L649">            super(context);</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2179)) {</span>
<span class="nc" id="L651">                setImageResource(mResRecordStopImage);</span>
            }
<span class="nc bnc" id="L653" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2180)) {</span>
<span class="nc" id="L654">                setOnClickListener(onClickListener);</span>
            }
<span class="nc" id="L656">        }</span>

        public void update() {
<span class="nc bnc" id="L659" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(2183)) {</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                switch(mStatus) {</span>
                    case PLAYING:
                    case PAUSED:
<span class="nc bnc" id="L663" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2181)) {</span>
<span class="nc" id="L664">                            setEnabled(false);</span>
                        }
                        break;
                    default:
<span class="nc bnc" id="L668" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(2182)) {</span>
<span class="nc" id="L669">                            setEnabled(true);</span>
                        }
                        break;
                }
            }
<span class="nc" id="L674">        }</span>
    }

    public interface OnRecordingFinishEventListener {

        void onRecordingFinish(View v);
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>