<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeckOptions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">DeckOptions.java</span></div><h1>DeckOptions.java</h1><pre class="source lang-java linenums">package com.ichi2.anki;

import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.ContentValues;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
import android.content.res.Resources;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.KeyEvent;
import android.view.MenuItem;
import com.afollestad.materialdialogs.MaterialDialog;
import com.ichi2.anim.ActivityTransitionAnimation;
import com.ichi2.anki.exception.ConfirmModSchemaException;
import com.ichi2.anki.receiver.SdCardReceiver;
import com.ichi2.anki.services.ReminderService;
import com.ichi2.async.CollectionTask;
import com.ichi2.async.TaskListenerWithContext;
import com.ichi2.async.TaskManager;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Consts;
import com.ichi2.libanki.DeckConfig;
import com.ichi2.libanki.Deck;
import com.ichi2.libanki.utils.Time;
import com.ichi2.preferences.NumberRangePreference;
import com.ichi2.preferences.StepsPreference;
import com.ichi2.preferences.TimePreference;
import com.ichi2.themes.StyledProgressDialog;
import com.ichi2.themes.Themes;
import com.ichi2.ui.AppCompatPreferenceActivity;
import com.ichi2.utils.JSONArray;
import com.ichi2.utils.JSONException;
import com.ichi2.utils.JSONObject;
import com.ichi2.utils.NamedJSONComparator;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collections;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.TreeMap;
import androidx.annotation.NonNull;
import timber.log.Timber;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.FADE;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * Preferences for the current deck.
 */
<span class="nc" id="L59">public class DeckOptions extends AppCompatPreferenceActivity implements OnSharedPreferenceChangeListener {</span>

    private DeckConfig mOptions;

    private Deck mDeck;

    private Collection mCol;

<span class="nc" id="L67">    private boolean mPreferenceChanged = false;</span>

<span class="nc" id="L69">    private BroadcastReceiver mUnmountReceiver = null;</span>

    private DeckPreferenceHack mPref;

    public class DeckPreferenceHack implements SharedPreferences {

        // At most as many as in cacheValues
<span class="nc" id="L76">        private final Map&lt;String, String&gt; mValues = new HashMap&lt;&gt;(30);</span>

<span class="nc" id="L78">        private final Map&lt;String, String&gt; mSummaries = new HashMap&lt;&gt;();</span>

        private MaterialDialog mProgressDialog;

<span class="nc" id="L82">        private final List&lt;OnSharedPreferenceChangeListener&gt; listeners = new LinkedList&lt;&gt;();</span>

<span class="nc" id="L84">        private DeckPreferenceHack() {</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6813)) {</span>
<span class="nc" id="L86">                this.cacheValues();</span>
            }
<span class="nc" id="L88">        }</span>

        public DeckOptions getDeckOptions() {
<span class="nc" id="L91">            return DeckOptions.this;</span>
        }

        private void cacheValues() {
<span class="nc bnc" id="L95" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6814)) {</span>
<span class="nc" id="L96">                Timber.i(&quot;DeckOptions - CacheValues&quot;);</span>
            }
            try {
<span class="nc bnc" id="L99" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6819)) {</span>
<span class="nc" id="L100">                    mOptions = mCol.getDecks().confForDid(mDeck.getLong(&quot;id&quot;));</span>
                }
<span class="nc bnc" id="L102" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6820)) {</span>
<span class="nc" id="L103">                    mValues.put(&quot;name&quot;, mDeck.getString(&quot;name&quot;));</span>
                }
<span class="nc bnc" id="L105" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6821)) {</span>
<span class="nc" id="L106">                    mValues.put(&quot;desc&quot;, mDeck.getString(&quot;desc&quot;));</span>
                }
<span class="nc bnc" id="L108" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6822)) {</span>
<span class="nc" id="L109">                    mValues.put(&quot;deckConf&quot;, mDeck.getString(&quot;conf&quot;));</span>
                }
<span class="nc bnc" id="L111" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6823)) {</span>
                    // general
<span class="nc" id="L113">                    mValues.put(&quot;maxAnswerTime&quot;, mOptions.getString(&quot;maxTaken&quot;));</span>
                }
<span class="nc bnc" id="L115" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6824)) {</span>
<span class="nc" id="L116">                    mValues.put(&quot;showAnswerTimer&quot;, Boolean.toString(parseTimerValue(mOptions)));</span>
                }
<span class="nc bnc" id="L118" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6825)) {</span>
<span class="nc" id="L119">                    mValues.put(&quot;autoPlayAudio&quot;, Boolean.toString(mOptions.getBoolean(&quot;autoplay&quot;)));</span>
                }
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6826)) {</span>
<span class="nc" id="L122">                    mValues.put(&quot;replayQuestion&quot;, Boolean.toString(mOptions.optBoolean(&quot;replayq&quot;, true)));</span>
                }
                // new
<span class="nc" id="L125">                JSONObject newOptions = mOptions.getJSONObject(&quot;new&quot;);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6827)) {</span>
<span class="nc" id="L127">                    mValues.put(&quot;newSteps&quot;, StepsPreference.convertFromJSON(newOptions.getJSONArray(&quot;delays&quot;)));</span>
                }
<span class="nc bnc" id="L129" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6828)) {</span>
<span class="nc" id="L130">                    mValues.put(&quot;newGradIvl&quot;, newOptions.getJSONArray(&quot;ints&quot;).getString(0));</span>
                }
<span class="nc bnc" id="L132" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6829)) {</span>
<span class="nc" id="L133">                    mValues.put(&quot;newEasy&quot;, newOptions.getJSONArray(&quot;ints&quot;).getString(1));</span>
                }
<span class="nc bnc" id="L135" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6834)) {</span>
<span class="nc bnc" id="L136" title="All 8 branches missed.">                    mValues.put(&quot;newFactor&quot;, Integer.toString((ListenerUtil.mutListener.listen(6833) ? (newOptions.getInt(&quot;initialFactor&quot;) % 10) : (ListenerUtil.mutListener.listen(6832) ? (newOptions.getInt(&quot;initialFactor&quot;) * 10) : (ListenerUtil.mutListener.listen(6831) ? (newOptions.getInt(&quot;initialFactor&quot;) - 10) : (ListenerUtil.mutListener.listen(6830) ? (newOptions.getInt(&quot;initialFactor&quot;) + 10) : (newOptions.getInt(&quot;initialFactor&quot;) / 10)))))));</span>
                }
<span class="nc bnc" id="L138" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6835)) {</span>
<span class="nc" id="L139">                    mValues.put(&quot;newOrder&quot;, newOptions.getString(&quot;order&quot;));</span>
                }
<span class="nc bnc" id="L141" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6836)) {</span>
<span class="nc" id="L142">                    mValues.put(&quot;newPerDay&quot;, newOptions.getString(&quot;perDay&quot;));</span>
                }
<span class="nc bnc" id="L144" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6837)) {</span>
<span class="nc" id="L145">                    mValues.put(&quot;newBury&quot;, Boolean.toString(newOptions.optBoolean(&quot;bury&quot;, true)));</span>
                }
                // rev
<span class="nc" id="L148">                JSONObject revOptions = mOptions.getJSONObject(&quot;rev&quot;);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6838)) {</span>
<span class="nc" id="L150">                    mValues.put(&quot;revPerDay&quot;, revOptions.getString(&quot;perDay&quot;));</span>
                }
<span class="nc bnc" id="L152" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6843)) {</span>
<span class="nc bnc" id="L153" title="All 8 branches missed.">                    mValues.put(&quot;easyBonus&quot;, String.format(Locale.ROOT, &quot;%.0f&quot;, (ListenerUtil.mutListener.listen(6842) ? (revOptions.getDouble(&quot;ease4&quot;) % 100) : (ListenerUtil.mutListener.listen(6841) ? (revOptions.getDouble(&quot;ease4&quot;) / 100) : (ListenerUtil.mutListener.listen(6840) ? (revOptions.getDouble(&quot;ease4&quot;) - 100) : (ListenerUtil.mutListener.listen(6839) ? (revOptions.getDouble(&quot;ease4&quot;) + 100) : (revOptions.getDouble(&quot;ease4&quot;) * 100)))))));</span>
                }
<span class="nc bnc" id="L155" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6848)) {</span>
<span class="nc bnc" id="L156" title="All 8 branches missed.">                    mValues.put(&quot;hardFactor&quot;, String.format(Locale.ROOT, &quot;%.0f&quot;, (ListenerUtil.mutListener.listen(6847) ? (revOptions.optDouble(&quot;hardFactor&quot;, 1.2) % 100) : (ListenerUtil.mutListener.listen(6846) ? (revOptions.optDouble(&quot;hardFactor&quot;, 1.2) / 100) : (ListenerUtil.mutListener.listen(6845) ? (revOptions.optDouble(&quot;hardFactor&quot;, 1.2) - 100) : (ListenerUtil.mutListener.listen(6844) ? (revOptions.optDouble(&quot;hardFactor&quot;, 1.2) + 100) : (revOptions.optDouble(&quot;hardFactor&quot;, 1.2) * 100)))))));</span>
                }
<span class="nc bnc" id="L158" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6853)) {</span>
<span class="nc bnc" id="L159" title="All 8 branches missed.">                    mValues.put(&quot;revIvlFct&quot;, String.format(Locale.ROOT, &quot;%.0f&quot;, (ListenerUtil.mutListener.listen(6852) ? (revOptions.getDouble(&quot;ivlFct&quot;) % 100) : (ListenerUtil.mutListener.listen(6851) ? (revOptions.getDouble(&quot;ivlFct&quot;) / 100) : (ListenerUtil.mutListener.listen(6850) ? (revOptions.getDouble(&quot;ivlFct&quot;) - 100) : (ListenerUtil.mutListener.listen(6849) ? (revOptions.getDouble(&quot;ivlFct&quot;) + 100) : (revOptions.getDouble(&quot;ivlFct&quot;) * 100)))))));</span>
                }
<span class="nc bnc" id="L161" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6854)) {</span>
<span class="nc" id="L162">                    mValues.put(&quot;revMaxIvl&quot;, revOptions.getString(&quot;maxIvl&quot;));</span>
                }
<span class="nc bnc" id="L164" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6855)) {</span>
<span class="nc" id="L165">                    mValues.put(&quot;revBury&quot;, Boolean.toString(revOptions.optBoolean(&quot;bury&quot;, true)));</span>
                }
<span class="nc bnc" id="L167" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6856)) {</span>
<span class="nc" id="L168">                    mValues.put(&quot;revUseGeneralTimeoutSettings&quot;, Boolean.toString(revOptions.optBoolean(&quot;useGeneralTimeoutSettings&quot;, true)));</span>
                }
<span class="nc bnc" id="L170" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6857)) {</span>
<span class="nc" id="L171">                    mValues.put(&quot;revTimeoutAnswer&quot;, Boolean.toString(revOptions.optBoolean(&quot;timeoutAnswer&quot;, false)));</span>
                }
<span class="nc bnc" id="L173" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6858)) {</span>
<span class="nc" id="L174">                    mValues.put(&quot;revTimeoutAnswerSeconds&quot;, Integer.toString(revOptions.optInt(&quot;timeoutAnswerSeconds&quot;, 6)));</span>
                }
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6859)) {</span>
<span class="nc" id="L177">                    mValues.put(&quot;revTimeoutQuestionSeconds&quot;, Integer.toString(revOptions.optInt(&quot;timeoutQuestionSeconds&quot;, 60)));</span>
                }
                // lapse
<span class="nc" id="L180">                JSONObject lapOptions = mOptions.getJSONObject(&quot;lapse&quot;);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6860)) {</span>
<span class="nc" id="L182">                    mValues.put(&quot;lapSteps&quot;, StepsPreference.convertFromJSON(lapOptions.getJSONArray(&quot;delays&quot;)));</span>
                }
<span class="nc bnc" id="L184" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6865)) {</span>
<span class="nc bnc" id="L185" title="All 8 branches missed.">                    mValues.put(&quot;lapNewIvl&quot;, String.format(Locale.ROOT, &quot;%.0f&quot;, (ListenerUtil.mutListener.listen(6864) ? (lapOptions.getDouble(&quot;mult&quot;) % 100) : (ListenerUtil.mutListener.listen(6863) ? (lapOptions.getDouble(&quot;mult&quot;) / 100) : (ListenerUtil.mutListener.listen(6862) ? (lapOptions.getDouble(&quot;mult&quot;) - 100) : (ListenerUtil.mutListener.listen(6861) ? (lapOptions.getDouble(&quot;mult&quot;) + 100) : (lapOptions.getDouble(&quot;mult&quot;) * 100)))))));</span>
                }
<span class="nc bnc" id="L187" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6866)) {</span>
<span class="nc" id="L188">                    mValues.put(&quot;lapMinIvl&quot;, lapOptions.getString(&quot;minInt&quot;));</span>
                }
<span class="nc bnc" id="L190" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6867)) {</span>
<span class="nc" id="L191">                    mValues.put(&quot;lapLeechThres&quot;, lapOptions.getString(&quot;leechFails&quot;));</span>
                }
<span class="nc bnc" id="L193" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6868)) {</span>
<span class="nc" id="L194">                    mValues.put(&quot;lapLeechAct&quot;, lapOptions.getString(&quot;leechAction&quot;));</span>
                }
<span class="nc bnc" id="L196" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6869)) {</span>
                    // options group management
<span class="nc" id="L198">                    mValues.put(&quot;currentConf&quot;, mCol.getDecks().getConf(mDeck.getLong(&quot;conf&quot;)).getString(&quot;name&quot;));</span>
                }
<span class="nc bnc" id="L200" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6874)) {</span>
                    // reminders
<span class="nc bnc" id="L202" title="All 2 branches missed.">                    if (mOptions.has(&quot;reminder&quot;)) {</span>
<span class="nc" id="L203">                        final JSONObject reminder = mOptions.getJSONObject(&quot;reminder&quot;);</span>
<span class="nc" id="L204">                        final JSONArray reminderTime = reminder.getJSONArray(&quot;time&quot;);</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6872)) {</span>
<span class="nc" id="L206">                            mValues.put(&quot;reminderEnabled&quot;, Boolean.toString(reminder.getBoolean(&quot;enabled&quot;)));</span>
                        }
<span class="nc bnc" id="L208" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6873)) {</span>
<span class="nc" id="L209">                            mValues.put(&quot;reminderTime&quot;, String.format(&quot;%1$02d:%2$02d&quot;, reminderTime.getLong(0), reminderTime.getLong(1)));</span>
                        }
<span class="nc" id="L211">                    } else {</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6870)) {</span>
<span class="nc" id="L213">                            mValues.put(&quot;reminderEnabled&quot;, &quot;false&quot;);</span>
                        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(6871)) {</span>
<span class="nc" id="L216">                            mValues.put(&quot;reminderTime&quot;, TimePreference.DEFAULT_VALUE);</span>
                        }
                    }
                }
<span class="nc" id="L220">            } catch (JSONException e) {</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6815)) {</span>
<span class="nc" id="L222">                    Timber.e(e, &quot;DeckOptions - cacheValues&quot;);</span>
                }
<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6816)) {</span>
<span class="nc" id="L225">                    AnkiDroidApp.sendExceptionReport(e, &quot;DeckOptions: cacheValues&quot;);</span>
                }
<span class="nc" id="L227">                Resources r = DeckOptions.this.getResources();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6817)) {</span>
<span class="nc" id="L229">                    UIUtils.showThemedToast(DeckOptions.this, r.getString(R.string.deck_options_corrupt, e.getLocalizedMessage()), false);</span>
                }
<span class="nc bnc" id="L231" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6818)) {</span>
<span class="nc" id="L232">                    finish();</span>
                }
<span class="nc" id="L234">            }</span>
<span class="nc" id="L235">        }</span>

        private boolean parseTimerValue(DeckConfig options) {
<span class="nc" id="L238">            return DeckConfig.parseTimerOpt(options, true);</span>
        }

<span class="nc" id="L241">        public class Editor implements SharedPreferences.Editor {</span>

<span class="nc" id="L243">            private ContentValues mUpdate = new ContentValues();</span>

            @Override
            public SharedPreferences.Editor clear() {
<span class="nc bnc" id="L247" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6875)) {</span>
<span class="nc" id="L248">                    Timber.d(&quot;clear()&quot;);</span>
                }
<span class="nc bnc" id="L250" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6876)) {</span>
<span class="nc" id="L251">                    mUpdate = new ContentValues();</span>
                }
<span class="nc" id="L253">                return this;</span>
            }

            @Override
            public boolean commit() {
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6877)) {</span>
<span class="nc" id="L259">                    Timber.d(&quot;DeckOptions - commit() changes back to database&quot;);</span>
                }
                try {
<span class="nc bnc" id="L262" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6969)) {</span>
                        {
<span class="nc" id="L264">                            long _loopCounter124 = 0;</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                            for (Entry&lt;String, Object&gt; entry : mUpdate.valueSet()) {</span>
<span class="nc" id="L266">                                ListenerUtil.loopListener.listen(&quot;_loopCounter124&quot;, ++_loopCounter124);</span>
<span class="nc" id="L267">                                String key = entry.getKey();</span>
<span class="nc" id="L268">                                Object value = entry.getValue();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6878)) {</span>
<span class="nc" id="L270">                                    Timber.i(&quot;Change value for key '%s': %s&quot;, key, value);</span>
                                }
<span class="nc bnc" id="L272" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(6968)) {</span>
<span class="nc bnc" id="L273" title="All 36 branches missed.">                                    switch(key) {</span>
                                        case &quot;maxAnswerTime&quot;:
<span class="nc bnc" id="L275" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6879)) {</span>
<span class="nc" id="L276">                                                mOptions.put(&quot;maxTaken&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;newFactor&quot;:
<span class="nc bnc" id="L280" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6884)) {</span>
<span class="nc bnc" id="L281" title="All 8 branches missed.">                                                mOptions.getJSONObject(&quot;new&quot;).put(&quot;initialFactor&quot;, (ListenerUtil.mutListener.listen(6883) ? ((Integer) value % 10) : (ListenerUtil.mutListener.listen(6882) ? ((Integer) value / 10) : (ListenerUtil.mutListener.listen(6881) ? ((Integer) value - 10) : (ListenerUtil.mutListener.listen(6880) ? ((Integer) value + 10) : ((Integer) value * 10))))));</span>
                                            }
                                            break;
                                        case &quot;newOrder&quot;:
                                            {
<span class="nc" id="L286">                                                int newValue = Integer.parseInt((String) value);</span>
                                                // Sorting is slow, so only do it if we change order
<span class="nc" id="L288">                                                int oldValue = mOptions.getJSONObject(&quot;new&quot;).getInt(&quot;order&quot;);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6892)) {</span>
<span class="nc bnc" id="L290" title="All 22 branches missed.">                                                    if ((ListenerUtil.mutListener.listen(6889) ? (oldValue &gt;= newValue) : (ListenerUtil.mutListener.listen(6888) ? (oldValue &lt;= newValue) : (ListenerUtil.mutListener.listen(6887) ? (oldValue &gt; newValue) : (ListenerUtil.mutListener.listen(6886) ? (oldValue &lt; newValue) : (ListenerUtil.mutListener.listen(6885) ? (oldValue == newValue) : (oldValue != newValue))))))) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6890)) {</span>
<span class="nc" id="L292">                                                            mOptions.getJSONObject(&quot;new&quot;).put(&quot;order&quot;, newValue);</span>
                                                        }
<span class="nc bnc" id="L294" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6891)) {</span>
<span class="nc" id="L295">                                                            TaskManager.launchCollectionTask(new CollectionTask.Reorder(mOptions), confChangeHandler());</span>
                                                        }
                                                    }
                                                }
<span class="nc bnc" id="L299" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6893)) {</span>
<span class="nc" id="L300">                                                    mOptions.getJSONObject(&quot;new&quot;).put(&quot;order&quot;, Integer.parseInt((String) value));</span>
                                                }
                                                break;
                                            }
                                        case &quot;newPerDay&quot;:
<span class="nc bnc" id="L305" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6894)) {</span>
<span class="nc" id="L306">                                                mOptions.getJSONObject(&quot;new&quot;).put(&quot;perDay&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;newGradIvl&quot;:
                                            {
                                                // [graduating, easy]
<span class="nc" id="L312">                                                JSONArray newInts = new JSONArray();</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6895)) {</span>
<span class="nc" id="L314">                                                    newInts.put(value);</span>
                                                }
<span class="nc bnc" id="L316" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6896)) {</span>
<span class="nc" id="L317">                                                    newInts.put(mOptions.getJSONObject(&quot;new&quot;).getJSONArray(&quot;ints&quot;).getInt(1));</span>
                                                }
<span class="nc bnc" id="L319" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6897)) {</span>
<span class="nc" id="L320">                                                    mOptions.getJSONObject(&quot;new&quot;).put(&quot;ints&quot;, newInts);</span>
                                                }
                                                break;
                                            }
                                        case &quot;newEasy&quot;:
                                            {
                                                // [graduating, easy]
<span class="nc" id="L327">                                                JSONArray newInts = new JSONArray();</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6898)) {</span>
<span class="nc" id="L329">                                                    newInts.put(mOptions.getJSONObject(&quot;new&quot;).getJSONArray(&quot;ints&quot;).getInt(0));</span>
                                                }
<span class="nc bnc" id="L331" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6899)) {</span>
<span class="nc" id="L332">                                                    newInts.put(value);</span>
                                                }
<span class="nc bnc" id="L334" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6900)) {</span>
<span class="nc" id="L335">                                                    mOptions.getJSONObject(&quot;new&quot;).put(&quot;ints&quot;, newInts);</span>
                                                }
                                                break;
                                            }
                                        case &quot;newBury&quot;:
<span class="nc bnc" id="L340" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6901)) {</span>
<span class="nc" id="L341">                                                mOptions.getJSONObject(&quot;new&quot;).put(&quot;bury&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revPerDay&quot;:
<span class="nc bnc" id="L345" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6902)) {</span>
<span class="nc" id="L346">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;perDay&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;easyBonus&quot;:
<span class="nc bnc" id="L350" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6907)) {</span>
<span class="nc bnc" id="L351" title="All 8 branches missed.">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;ease4&quot;, (ListenerUtil.mutListener.listen(6906) ? ((Integer) value % 100.0f) : (ListenerUtil.mutListener.listen(6905) ? ((Integer) value * 100.0f) : (ListenerUtil.mutListener.listen(6904) ? ((Integer) value - 100.0f) : (ListenerUtil.mutListener.listen(6903) ? ((Integer) value + 100.0f) : ((Integer) value / 100.0f))))));</span>
                                            }
                                            break;
                                        case &quot;hardFactor&quot;:
<span class="nc bnc" id="L355" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6912)) {</span>
<span class="nc bnc" id="L356" title="All 8 branches missed.">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;hardFactor&quot;, (ListenerUtil.mutListener.listen(6911) ? ((Integer) value % 100.0f) : (ListenerUtil.mutListener.listen(6910) ? ((Integer) value * 100.0f) : (ListenerUtil.mutListener.listen(6909) ? ((Integer) value - 100.0f) : (ListenerUtil.mutListener.listen(6908) ? ((Integer) value + 100.0f) : ((Integer) value / 100.0f))))));</span>
                                            }
                                            break;
                                        case &quot;revIvlFct&quot;:
<span class="nc bnc" id="L360" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6917)) {</span>
<span class="nc bnc" id="L361" title="All 8 branches missed.">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;ivlFct&quot;, (ListenerUtil.mutListener.listen(6916) ? ((Integer) value % 100.0f) : (ListenerUtil.mutListener.listen(6915) ? ((Integer) value * 100.0f) : (ListenerUtil.mutListener.listen(6914) ? ((Integer) value - 100.0f) : (ListenerUtil.mutListener.listen(6913) ? ((Integer) value + 100.0f) : ((Integer) value / 100.0f))))));</span>
                                            }
                                            break;
                                        case &quot;revMaxIvl&quot;:
<span class="nc bnc" id="L365" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6918)) {</span>
<span class="nc" id="L366">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;maxIvl&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revBury&quot;:
<span class="nc bnc" id="L370" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6919)) {</span>
<span class="nc" id="L371">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;bury&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revUseGeneralTimeoutSettings&quot;:
<span class="nc bnc" id="L375" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6920)) {</span>
<span class="nc" id="L376">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;useGeneralTimeoutSettings&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revTimeoutAnswer&quot;:
<span class="nc bnc" id="L380" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6921)) {</span>
<span class="nc" id="L381">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;timeoutAnswer&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revTimeoutAnswerSeconds&quot;:
<span class="nc bnc" id="L385" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6922)) {</span>
<span class="nc" id="L386">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;timeoutAnswerSeconds&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;revTimeoutQuestionSeconds&quot;:
<span class="nc bnc" id="L390" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6923)) {</span>
<span class="nc" id="L391">                                                mOptions.getJSONObject(&quot;rev&quot;).put(&quot;timeoutQuestionSeconds&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;lapMinIvl&quot;:
<span class="nc bnc" id="L395" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6924)) {</span>
<span class="nc" id="L396">                                                mOptions.getJSONObject(&quot;lapse&quot;).put(&quot;minInt&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;lapLeechThres&quot;:
<span class="nc bnc" id="L400" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6925)) {</span>
<span class="nc" id="L401">                                                mOptions.getJSONObject(&quot;lapse&quot;).put(&quot;leechFails&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;lapLeechAct&quot;:
<span class="nc bnc" id="L405" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6926)) {</span>
<span class="nc" id="L406">                                                mOptions.getJSONObject(&quot;lapse&quot;).put(&quot;leechAction&quot;, Integer.parseInt((String) value));</span>
                                            }
                                            break;
                                        case &quot;lapNewIvl&quot;:
<span class="nc bnc" id="L410" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6931)) {</span>
<span class="nc bnc" id="L411" title="All 8 branches missed.">                                                mOptions.getJSONObject(&quot;lapse&quot;).put(&quot;mult&quot;, (ListenerUtil.mutListener.listen(6930) ? ((Integer) value % 100.0f) : (ListenerUtil.mutListener.listen(6929) ? ((Integer) value * 100.0f) : (ListenerUtil.mutListener.listen(6928) ? ((Integer) value - 100.0f) : (ListenerUtil.mutListener.listen(6927) ? ((Integer) value + 100.0f) : ((Integer) value / 100.0f))))));</span>
                                            }
                                            break;
                                        case &quot;showAnswerTimer&quot;:
<span class="nc bnc" id="L415" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6932)) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">                                                mOptions.put(&quot;timer&quot;, (Boolean) value ? 1 : 0);</span>
                                            }
                                            break;
                                        case &quot;autoPlayAudio&quot;:
<span class="nc bnc" id="L420" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6933)) {</span>
<span class="nc" id="L421">                                                mOptions.put(&quot;autoplay&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;replayQuestion&quot;:
<span class="nc bnc" id="L425" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6934)) {</span>
<span class="nc" id="L426">                                                mOptions.put(&quot;replayq&quot;, value);</span>
                                            }
                                            break;
                                        case &quot;desc&quot;:
<span class="nc bnc" id="L430" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6935)) {</span>
<span class="nc" id="L431">                                                mDeck.put(&quot;desc&quot;, value);</span>
                                            }
<span class="nc bnc" id="L433" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6936)) {</span>
<span class="nc" id="L434">                                                mCol.getDecks().save(mDeck);</span>
                                            }
                                            break;
                                        case &quot;newSteps&quot;:
<span class="nc bnc" id="L438" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6937)) {</span>
<span class="nc" id="L439">                                                mOptions.getJSONObject(&quot;new&quot;).put(&quot;delays&quot;, StepsPreference.convertToJSON((String) value));</span>
                                            }
                                            break;
                                        case &quot;lapSteps&quot;:
<span class="nc bnc" id="L443" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6938)) {</span>
<span class="nc" id="L444">                                                mOptions.getJSONObject(&quot;lapse&quot;).put(&quot;delays&quot;, StepsPreference.convertToJSON((String) value));</span>
                                            }
                                            break;
                                        case &quot;deckConf&quot;:
                                            {
<span class="nc" id="L449">                                                long newConfId = Long.parseLong((String) value);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6939)) {</span>
<span class="nc" id="L451">                                                    mOptions = mCol.getDecks().getConf(newConfId);</span>
                                                }
<span class="nc bnc" id="L453" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6940)) {</span>
<span class="nc" id="L454">                                                    TaskManager.launchCollectionTask(new CollectionTask.ConfChange(mDeck, mOptions), confChangeHandler());</span>
                                                }
                                                break;
                                            }
                                        case &quot;confRename&quot;:
                                            {
<span class="nc" id="L460">                                                String newName = (String) value;</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6942)) {</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">                                                    if (!TextUtils.isEmpty(newName)) {</span>
<span class="nc bnc" id="L463" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6941)) {</span>
<span class="nc" id="L464">                                                            mOptions.put(&quot;name&quot;, newName);</span>
                                                        }
                                                    }
                                                }
                                                break;
                                            }
                                        case &quot;confReset&quot;:
<span class="nc bnc" id="L471" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6944)) {</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">                                                if ((Boolean) value) {</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(6943)) {</span>
<span class="nc" id="L474">                                                        TaskManager.launchCollectionTask(new CollectionTask.ConfReset(mOptions), confChangeHandler());</span>
                                                    }
                                                }
                                            }
                                            break;
                                        case &quot;confAdd&quot;:
                                            {
<span class="nc" id="L481">                                                String newName = (String) value;</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6947)) {</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">                                                    if (!TextUtils.isEmpty(newName)) {</span>
                                                        // New config clones current config
<span class="nc" id="L485">                                                        long id = mCol.getDecks().confId(newName, mOptions.toString());</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6945)) {</span>
<span class="nc" id="L487">                                                            mDeck.put(&quot;conf&quot;, id);</span>
                                                        }
<span class="nc bnc" id="L489" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6946)) {</span>
<span class="nc" id="L490">                                                            mCol.getDecks().save(mDeck);</span>
                                                        }
<span class="nc" id="L492">                                                    }</span>
                                                }
                                                break;
                                            }
                                        case &quot;confRemove&quot;:
<span class="nc bnc" id="L497" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6951)) {</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">                                                if (mOptions.getLong(&quot;id&quot;) == 1) {</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(6950)) {</span>
                                                        // Don't remove the options group if it's the default group
<span class="nc" id="L501">                                                        UIUtils.showThemedToast(DeckOptions.this, getResources().getString(R.string.default_conf_delete_error), false);</span>
                                                    }
                                                } else {
                                                    // Remove options group, handling the case where the user needs to confirm full sync
                                                    try {
<span class="nc bnc" id="L506" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6949)) {</span>
<span class="nc" id="L507">                                                            remConf();</span>
                                                        }
<span class="nc" id="L509">                                                    } catch (ConfirmModSchemaException e) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6948)) {</span>
                                                            // TODO : Use ConfirmationDialog DialogFragment -- not compatible with PreferenceActivity
<span class="nc" id="L512">                                                            new MaterialDialog.Builder(DeckOptions.this).content(R.string.full_sync_confirmation).positiveText(R.string.dialog_ok).negativeText(R.string.dialog_cancel).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L513">                                                                mCol.modSchemaNoCheck();</span>
                                                                try {
<span class="nc" id="L515">                                                                    remConf();</span>
<span class="nc" id="L516">                                                                } catch (ConfirmModSchemaException cmse) {</span>
                                                                    // This should never be reached as we just forced modSchema
<span class="nc" id="L518">                                                                    throw new RuntimeException(cmse);</span>
<span class="nc" id="L519">                                                                }</span>
<span class="nc" id="L520">                                                            }).build().show();</span>
                                                        }
<span class="nc" id="L522">                                                    }</span>
                                                }
                                            }
                                            break;
                                        case &quot;confSetSubdecks&quot;:
<span class="nc bnc" id="L527" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6953)) {</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">                                                if ((Boolean) value) {</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">                                                    if (!ListenerUtil.mutListener.listen(6952)) {</span>
<span class="nc" id="L530">                                                        TaskManager.launchCollectionTask(new CollectionTask.ConfSetSubdecks(mDeck, mOptions), confChangeHandler());</span>
                                                    }
                                                }
                                            }
                                            break;
                                        case &quot;reminderEnabled&quot;:
                                            {
<span class="nc" id="L537">                                                final JSONObject reminder = new JSONObject();</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6954)) {</span>
<span class="nc" id="L539">                                                    reminder.put(&quot;enabled&quot;, value);</span>
                                                }
<span class="nc bnc" id="L541" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6957)) {</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">                                                    if (mOptions.has(&quot;reminder&quot;)) {</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6956)) {</span>
<span class="nc" id="L544">                                                            reminder.put(&quot;time&quot;, mOptions.getJSONObject(&quot;reminder&quot;).getJSONArray(&quot;time&quot;));</span>
                                                        }
                                                    } else {
<span class="nc bnc" id="L547" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6955)) {</span>
<span class="nc" id="L548">                                                            reminder.put(&quot;time&quot;, new JSONArray().put(TimePreference.parseHours(TimePreference.DEFAULT_VALUE)).put(TimePreference.parseMinutes(TimePreference.DEFAULT_VALUE)));</span>
                                                        }
                                                    }
                                                }
<span class="nc bnc" id="L552" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6958)) {</span>
<span class="nc" id="L553">                                                    mOptions.put(&quot;reminder&quot;, reminder);</span>
                                                }
<span class="nc" id="L555">                                                final AlarmManager alarmManager = (AlarmManager) getSystemService(ALARM_SERVICE);</span>
<span class="nc" id="L556">                                                final PendingIntent reminderIntent = PendingIntent.getBroadcast(getApplicationContext(), (int) mOptions.getLong(&quot;id&quot;), new Intent(getApplicationContext(), ReminderService.class).putExtra(ReminderService.EXTRA_DECK_OPTION_ID, mOptions.getLong(&quot;id&quot;)), 0);</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6959)) {</span>
<span class="nc" id="L558">                                                    alarmManager.cancel(reminderIntent);</span>
                                                }
<span class="nc bnc" id="L560" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6961)) {</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                                                    if ((Boolean) value) {</span>
<span class="nc" id="L562">                                                        final Calendar calendar = reminderToCalendar(mCol.getTime(), reminder);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(6960)) {</span>
<span class="nc" id="L564">                                                            alarmManager.setRepeating(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), AlarmManager.INTERVAL_DAY, reminderIntent);</span>
                                                        }
<span class="nc" id="L566">                                                    }</span>
                                                }
                                                break;
                                            }
                                        case &quot;reminderTime&quot;:
                                            {
<span class="nc" id="L572">                                                final JSONObject reminder = new JSONObject();</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6962)) {</span>
<span class="nc" id="L574">                                                    reminder.put(&quot;enabled&quot;, true);</span>
                                                }
<span class="nc bnc" id="L576" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6963)) {</span>
<span class="nc" id="L577">                                                    reminder.put(&quot;time&quot;, new JSONArray().put(TimePreference.parseHours((String) value)).put(TimePreference.parseMinutes((String) value)));</span>
                                                }
<span class="nc bnc" id="L579" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6964)) {</span>
<span class="nc" id="L580">                                                    mOptions.put(&quot;reminder&quot;, reminder);</span>
                                                }
<span class="nc" id="L582">                                                final AlarmManager alarmManager = (AlarmManager) getSystemService(ALARM_SERVICE);</span>
<span class="nc" id="L583">                                                final PendingIntent reminderIntent = PendingIntent.getBroadcast(getApplicationContext(), (int) mOptions.getLong(&quot;id&quot;), new Intent(getApplicationContext(), ReminderService.class).putExtra(ReminderService.EXTRA_DECK_OPTION_ID, mOptions.getLong(&quot;id&quot;)), 0);</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6965)) {</span>
<span class="nc" id="L585">                                                    alarmManager.cancel(reminderIntent);</span>
                                                }
<span class="nc" id="L587">                                                final Calendar calendar = reminderToCalendar(mCol.getTime(), reminder);</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(6966)) {</span>
<span class="nc" id="L589">                                                    alarmManager.setRepeating(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), AlarmManager.INTERVAL_DAY, reminderIntent);</span>
                                                }
                                                break;
                                            }
                                        default:
<span class="nc bnc" id="L594" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(6967)) {</span>
<span class="nc" id="L595">                                                Timber.w(&quot;Unknown key type: %s&quot;, key);</span>
                                            }
                                            break;
                                    }
                                }
<span class="nc" id="L600">                            }</span>
                        }
                    }
<span class="nc" id="L603">                } catch (JSONException e) {</span>
<span class="nc" id="L604">                    throw new RuntimeException(e);</span>
<span class="nc" id="L605">                }</span>
                // save conf
                try {
<span class="nc bnc" id="L608" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6974)) {</span>
<span class="nc" id="L609">                        mCol.getDecks().save(mOptions);</span>
                    }
<span class="nc" id="L611">                } catch (RuntimeException e) {</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6970)) {</span>
<span class="nc" id="L613">                        Timber.e(e, &quot;DeckOptions - RuntimeException on saving conf&quot;);</span>
                    }
<span class="nc bnc" id="L615" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6971)) {</span>
<span class="nc" id="L616">                        AnkiDroidApp.sendExceptionReport(e, &quot;DeckOptionsSaveConf&quot;);</span>
                    }
<span class="nc bnc" id="L618" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6972)) {</span>
<span class="nc" id="L619">                        setResult(DeckPicker.RESULT_DB_ERROR);</span>
                    }
<span class="nc bnc" id="L621" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(6973)) {</span>
<span class="nc" id="L622">                        finish();</span>
                    }
<span class="nc" id="L624">                }</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6975)) {</span>
                    // make sure we refresh the parent cached values
<span class="nc" id="L627">                    cacheValues();</span>
                }
<span class="nc bnc" id="L629" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6976)) {</span>
<span class="nc" id="L630">                    buildLists();</span>
                }
<span class="nc bnc" id="L632" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6977)) {</span>
<span class="nc" id="L633">                    updateSummaries();</span>
                }
<span class="nc bnc" id="L635" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6979)) {</span>
                    {
<span class="nc" id="L637">                        long _loopCounter125 = 0;</span>
                        // and update any listeners
<span class="nc bnc" id="L639" title="All 2 branches missed.">                        for (OnSharedPreferenceChangeListener listener : listeners) {</span>
<span class="nc" id="L640">                            ListenerUtil.loopListener.listen(&quot;_loopCounter125&quot;, ++_loopCounter125);</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(6978)) {</span>
<span class="nc" id="L642">                                listener.onSharedPreferenceChanged(DeckPreferenceHack.this, null);</span>
                            }
<span class="nc" id="L644">                        }</span>
                    }
                }
<span class="nc" id="L647">                return true;</span>
            }

            @Override
            public SharedPreferences.Editor putBoolean(String key, boolean value) {
<span class="nc bnc" id="L652" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6980)) {</span>
<span class="nc" id="L653">                    mUpdate.put(key, value);</span>
                }
<span class="nc" id="L655">                return this;</span>
            }

            @Override
            public SharedPreferences.Editor putFloat(String key, float value) {
<span class="nc bnc" id="L660" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6981)) {</span>
<span class="nc" id="L661">                    mUpdate.put(key, value);</span>
                }
<span class="nc" id="L663">                return this;</span>
            }

            @Override
            public SharedPreferences.Editor putInt(String key, int value) {
<span class="nc bnc" id="L668" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6982)) {</span>
<span class="nc" id="L669">                    mUpdate.put(key, value);</span>
                }
<span class="nc" id="L671">                return this;</span>
            }

            @Override
            public SharedPreferences.Editor putLong(String key, long value) {
<span class="nc bnc" id="L676" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6983)) {</span>
<span class="nc" id="L677">                    mUpdate.put(key, value);</span>
                }
<span class="nc" id="L679">                return this;</span>
            }

            @Override
            public SharedPreferences.Editor putString(String key, String value) {
<span class="nc bnc" id="L684" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6984)) {</span>
<span class="nc" id="L685">                    mUpdate.put(key, value);</span>
                }
<span class="nc" id="L687">                return this;</span>
            }

            @Override
            public SharedPreferences.Editor remove(String key) {
<span class="nc bnc" id="L692" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6985)) {</span>
<span class="nc" id="L693">                    Timber.d(&quot;Editor.remove(key=%s)&quot;, key);</span>
                }
<span class="nc bnc" id="L695" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6986)) {</span>
<span class="nc" id="L696">                    mUpdate.remove(key);</span>
                }
<span class="nc" id="L698">                return this;</span>
            }

            public void apply() {
<span class="nc bnc" id="L702" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6987)) {</span>
<span class="nc" id="L703">                    commit();</span>
                }
<span class="nc" id="L705">            }</span>

            // @Override On Android 1.5 this is not Override
            public android.content.SharedPreferences.Editor putStringSet(String arg0, Set&lt;String&gt; arg1) {
                // TODO Auto-generated method stub
<span class="nc" id="L710">                return null;</span>
            }

            public DeckPreferenceHack getDeckPreferenceHack() {
<span class="nc" id="L714">                return DeckPreferenceHack.this;</span>
            }

            public ConfChangeHandler confChangeHandler() {
<span class="nc" id="L718">                return new ConfChangeHandler(DeckPreferenceHack.this);</span>
            }

            /**
             * Remove the currently selected options group
             */
            private void remConf() throws ConfirmModSchemaException {
<span class="nc bnc" id="L725" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6988)) {</span>
                    // Remove options group, asking user to confirm full sync if necessary
<span class="nc" id="L727">                    mCol.getDecks().remConf(mOptions.getLong(&quot;id&quot;));</span>
                }
<span class="nc bnc" id="L729" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6989)) {</span>
                    // Run the CPU intensive re-sort operation in a background thread
<span class="nc" id="L731">                    TaskManager.launchCollectionTask(new CollectionTask.ConfRemove(mOptions), confChangeHandler());</span>
                }
<span class="nc bnc" id="L733" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(6990)) {</span>
<span class="nc" id="L734">                    mDeck.put(&quot;conf&quot;, 1);</span>
                }
<span class="nc" id="L736">            }</span>
        }

        @Override
        public boolean contains(String key) {
<span class="nc" id="L741">            return mValues.containsKey(key);</span>
        }

        @Override
        public Editor edit() {
<span class="nc" id="L746">            return new Editor();</span>
        }

        @Override
        public Map&lt;String, ?&gt; getAll() {
<span class="nc" id="L751">            return mValues;</span>
        }

        @Override
        public boolean getBoolean(String key, boolean defValue) {
<span class="nc" id="L756">            return Boolean.parseBoolean(this.getString(key, Boolean.toString(defValue)));</span>
        }

        @Override
        public float getFloat(String key, float defValue) {
<span class="nc" id="L761">            return Float.parseFloat(this.getString(key, Float.toString(defValue)));</span>
        }

        @Override
        public int getInt(String key, int defValue) {
<span class="nc" id="L766">            return Integer.parseInt(this.getString(key, Integer.toString(defValue)));</span>
        }

        @Override
        public long getLong(String key, long defValue) {
<span class="nc" id="L771">            return Long.parseLong(this.getString(key, Long.toString(defValue)));</span>
        }

        @Override
        public String getString(String key, String defValue) {
<span class="nc bnc" id="L776" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6991)) {</span>
<span class="nc" id="L777">                Timber.d(&quot;getString(key=%s, defValue=%s)&quot;, key, defValue);</span>
            }
<span class="nc bnc" id="L779" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6992)) {</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">                if (!mValues.containsKey(key)) {</span>
<span class="nc" id="L781">                    return defValue;</span>
                }
            }
<span class="nc" id="L784">            return mValues.get(key);</span>
        }

        @Override
        public void registerOnSharedPreferenceChangeListener(OnSharedPreferenceChangeListener listener) {
<span class="nc bnc" id="L789" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6993)) {</span>
<span class="nc" id="L790">                listeners.add(listener);</span>
            }
<span class="nc" id="L792">        }</span>

        @Override
        public void unregisterOnSharedPreferenceChangeListener(OnSharedPreferenceChangeListener listener) {
<span class="nc bnc" id="L796" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6994)) {</span>
<span class="nc" id="L797">                listeners.remove(listener);</span>
            }
<span class="nc" id="L799">        }</span>

        // @Override On Android 1.5 this is not Override
        public Set&lt;String&gt; getStringSet(String arg0, Set&lt;String&gt; arg1) {
            // TODO Auto-generated method stub
<span class="nc" id="L804">            return null;</span>
        }
    }

    private static class ConfChangeHandler extends TaskListenerWithContext&lt;DeckPreferenceHack, Void, Boolean&gt; {

        public ConfChangeHandler(DeckPreferenceHack deckPreferenceHack) {
<span class="nc" id="L811">            super(deckPreferenceHack);</span>
<span class="nc" id="L812">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPreferenceHack deckPreferenceHack) {
<span class="nc" id="L816">            Resources res = deckPreferenceHack.getDeckOptions().getResources();</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6995)) {</span>
<span class="nc" id="L818">                deckPreferenceHack.mProgressDialog = StyledProgressDialog.show(deckPreferenceHack.getDeckOptions(), &quot;&quot;, res.getString(R.string.reordering_cards), false);</span>
            }
<span class="nc" id="L820">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPreferenceHack deckPreferenceHack, Boolean result) {
<span class="nc bnc" id="L824" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6996)) {</span>
<span class="nc" id="L825">                deckPreferenceHack.cacheValues();</span>
            }
<span class="nc bnc" id="L827" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6997)) {</span>
<span class="nc" id="L828">                deckPreferenceHack.getDeckOptions().buildLists();</span>
            }
<span class="nc bnc" id="L830" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6998)) {</span>
<span class="nc" id="L831">                deckPreferenceHack.getDeckOptions().updateSummaries();</span>
            }
<span class="nc bnc" id="L833" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(6999)) {</span>
<span class="nc" id="L834">                deckPreferenceHack.mProgressDialog.dismiss();</span>
            }
<span class="nc bnc" id="L836" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7000)) {</span>
                // Restart to reflect the new preference values
<span class="nc" id="L838">                deckPreferenceHack.getDeckOptions().restartActivity();</span>
            }
<span class="nc" id="L840">        }</span>
    }

    @Override
    public SharedPreferences getSharedPreferences(String name, int mode) {
<span class="nc bnc" id="L845" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7001)) {</span>
<span class="nc" id="L846">            Timber.d(&quot;getSharedPreferences(name=%s)&quot;, name);</span>
        }
<span class="nc" id="L848">        return mPref;</span>
    }

    @Override
    // conversion to fragments tracked as #5019 in github
    @SuppressWarnings(&quot;deprecation&quot;)
    protected void onCreate(Bundle icicle) {
<span class="nc bnc" id="L855" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7002)) {</span>
<span class="nc" id="L856">            Themes.setThemeLegacy(this);</span>
        }
<span class="nc bnc" id="L858" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7003)) {</span>
<span class="nc" id="L859">            super.onCreate(icicle);</span>
        }
<span class="nc bnc" id="L861" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7004)) {</span>
<span class="nc" id="L862">            mCol = CollectionHelper.getInstance().getCol(this);</span>
        }
<span class="nc bnc" id="L864" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7006)) {</span>
<span class="nc bnc" id="L865" title="All 2 branches missed.">            if (mCol == null) {</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7005)) {</span>
<span class="nc" id="L867">                    finish();</span>
                }
<span class="nc" id="L869">                return;</span>
            }
        }
<span class="nc" id="L872">        Bundle extras = getIntent().getExtras();</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7010)) {</span>
<span class="nc bnc" id="L874" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7007) ? (extras != null || extras.containsKey(&quot;did&quot;)) : (extras != null &amp;&amp; extras.containsKey(&quot;did&quot;)))) {</span>
<span class="nc bnc" id="L875" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7009)) {</span>
<span class="nc" id="L876">                    mDeck = mCol.getDecks().get(extras.getLong(&quot;did&quot;));</span>
                }
            } else {
<span class="nc bnc" id="L879" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7008)) {</span>
<span class="nc" id="L880">                    mDeck = mCol.getDecks().current();</span>
                }
            }
        }
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7011)) {</span>
<span class="nc" id="L885">            registerExternalStorageListener();</span>
        }
<span class="nc bnc" id="L887" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7026)) {</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">            if (mCol == null) {</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7024)) {</span>
<span class="nc" id="L890">                    Timber.w(&quot;DeckOptions - No Collection loaded&quot;);</span>
                }
<span class="nc bnc" id="L892" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7025)) {</span>
<span class="nc" id="L893">                    finish();</span>
                }
            } else {
<span class="nc bnc" id="L896" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7012)) {</span>
<span class="nc" id="L897">                    mPref = new DeckPreferenceHack();</span>
                }
<span class="nc bnc" id="L899" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7013)) {</span>
                    // #6068 - constructor can call finish()
<span class="nc bnc" id="L901" title="All 2 branches missed.">                    if (this.isFinishing()) {</span>
<span class="nc" id="L902">                        return;</span>
                    }
                }
<span class="nc bnc" id="L905" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7014)) {</span>
<span class="nc" id="L906">                    mPref.registerOnSharedPreferenceChangeListener(this);</span>
                }
<span class="nc bnc" id="L908" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7015)) {</span>
<span class="nc" id="L909">                    this.addPreferencesFromResource(R.xml.deck_options);</span>
                }
<span class="nc bnc" id="L911" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7017)) {</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">                    if (this.isSchedV2()) {</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7016)) {</span>
<span class="nc" id="L914">                            this.enableSchedV2Preferences();</span>
                        }
                    }
                }
<span class="nc bnc" id="L918" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7018)) {</span>
<span class="nc" id="L919">                    this.buildLists();</span>
                }
<span class="nc bnc" id="L921" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7019)) {</span>
<span class="nc" id="L922">                    this.updateSummaries();</span>
                }
                // Set the activity title to include the name of the deck
<span class="nc" id="L925">                String title = getResources().getString(R.string.deckpreferences_title);</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7022)) {</span>
<span class="nc bnc" id="L927" title="All 2 branches missed.">                    if (title.contains(&quot;XXX&quot;)) {</span>
                        try {
<span class="nc bnc" id="L929" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7021)) {</span>
<span class="nc" id="L930">                                title = title.replace(&quot;XXX&quot;, mDeck.getString(&quot;name&quot;));</span>
                            }
<span class="nc" id="L932">                        } catch (JSONException e) {</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7020)) {</span>
<span class="nc" id="L934">                                title = title.replace(&quot;XXX&quot;, &quot;???&quot;);</span>
                            }
<span class="nc" id="L936">                        }</span>
                    }
                }
<span class="nc bnc" id="L939" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7023)) {</span>
<span class="nc" id="L940">                    this.setTitle(title);</span>
                }
            }
        }
<span class="nc bnc" id="L944" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7027)) {</span>
            // Add a home button to the actionbar
<span class="nc" id="L946">            getSupportActionBar().setHomeButtonEnabled(true);</span>
        }
<span class="nc bnc" id="L948" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7028)) {</span>
<span class="nc" id="L949">            getSupportActionBar().setDisplayHomeAsUpEnabled(true);</span>
        }
<span class="nc" id="L951">    }</span>

    @Override
    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5019
    @SuppressWarnings(&quot;deprecation&quot;)
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L957" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7030)) {</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">            if (item.getItemId() == android.R.id.home) {</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7029)) {</span>
<span class="nc" id="L960">                    closeWithResult();</span>
                }
<span class="nc" id="L962">                return true;</span>
            }
        }
<span class="nc" id="L965">        return false;</span>
    }

    @Override
    public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
<span class="nc bnc" id="L970" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7031)) {</span>
            // update values on changed preference
<span class="nc" id="L972">            mPreferenceChanged = true;</span>
        }
<span class="nc bnc" id="L974" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7032)) {</span>
<span class="nc" id="L975">            this.updateSummaries();</span>
        }
<span class="nc" id="L977">    }</span>

    // Workaround for bug 4611: http://code.google.com/p/android/issues/detail?id=4611
    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5019
    @SuppressWarnings(&quot;deprecation&quot;)
    @Override
    public boolean onPreferenceTreeClick(android.preference.PreferenceScreen preferenceScreen, android.preference.Preference preference) {
<span class="nc bnc" id="L984" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7033)) {</span>
<span class="nc" id="L985">            super.onPreferenceTreeClick(preferenceScreen, preference);</span>
        }
<span class="nc bnc" id="L987" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7036)) {</span>
<span class="nc bnc" id="L988" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7034) ? (preference instanceof android.preference.PreferenceScreen || ((android.preference.PreferenceScreen) preference).getDialog() != null) : (preference instanceof android.preference.PreferenceScreen &amp;&amp; ((android.preference.PreferenceScreen) preference).getDialog() != null))) {</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7035)) {</span>
<span class="nc" id="L990">                    ((android.preference.PreferenceScreen) preference).getDialog().getWindow().getDecorView().setBackgroundDrawable(this.getWindow().getDecorView().getBackground().getConstantState().newDrawable());</span>
                }
            }
        }
<span class="nc" id="L994">        return false;</span>
    }

    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L999" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7040)) {</span>
<span class="nc bnc" id="L1000" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7037) ? (keyCode == KeyEvent.KEYCODE_BACK || event.getRepeatCount() == 0) : (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == 0))) {</span>
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7038)) {</span>
<span class="nc" id="L1002">                    Timber.i(&quot;DeckOptions - onBackPressed()&quot;);</span>
                }
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7039)) {</span>
<span class="nc" id="L1005">                    closeWithResult();</span>
                }
<span class="nc" id="L1007">                return true;</span>
            }
        }
<span class="nc" id="L1010">        return super.onKeyDown(keyCode, event);</span>
    }

    private void closeWithResult() {
<span class="nc bnc" id="L1014" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7043)) {</span>
<span class="nc bnc" id="L1015" title="All 2 branches missed.">            if (mPreferenceChanged) {</span>
<span class="nc bnc" id="L1016" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7042)) {</span>
<span class="nc" id="L1017">                    setResult(RESULT_OK);</span>
                }
            } else {
<span class="nc bnc" id="L1020" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7041)) {</span>
<span class="nc" id="L1021">                    setResult(RESULT_CANCELED);</span>
                }
            }
        }
<span class="nc bnc" id="L1025" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7044)) {</span>
<span class="nc" id="L1026">            finish();</span>
        }
<span class="nc bnc" id="L1028" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7045)) {</span>
<span class="nc" id="L1029">            ActivityTransitionAnimation.slide(this, FADE);</span>
        }
<span class="nc" id="L1031">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L1035" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7046)) {</span>
<span class="nc" id="L1036">            super.onDestroy();</span>
        }
<span class="nc bnc" id="L1038" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7048)) {</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">            if (mUnmountReceiver != null) {</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7047)) {</span>
<span class="nc" id="L1041">                    unregisterReceiver(mUnmountReceiver);</span>
                }
            }
        }
<span class="nc" id="L1045">    }</span>

    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5019
    @SuppressWarnings(&quot;deprecation&quot;)
    protected void updateSummaries() {
<span class="nc" id="L1050">        Resources res = getResources();</span>
<span class="nc bnc" id="L1051" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7061)) {</span>
            {
<span class="nc" id="L1053">                long _loopCounter126 = 0;</span>
                // for all text preferences, set summary as current database value
<span class="nc bnc" id="L1055" title="All 2 branches missed.">                for (String key : mPref.mValues.keySet()) {</span>
<span class="nc" id="L1056">                    ListenerUtil.loopListener.listen(&quot;_loopCounter126&quot;, ++_loopCounter126);</span>
<span class="nc" id="L1057">                    android.preference.Preference pref = this.findPreference(key);</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7051)) {</span>
<span class="nc bnc" id="L1059" title="All 2 branches missed.">                        if (&quot;deckConf&quot;.equals(key)) {</span>
<span class="nc" id="L1060">                            String groupName = getOptionsGroupName();</span>
<span class="nc" id="L1061">                            int count = getOptionsGroupCount();</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7049)) {</span>
                                // Escape &quot;%&quot; in groupName as it's treated as a token
<span class="nc" id="L1064">                                groupName = groupName.replaceAll(&quot;%&quot;, &quot;%%&quot;);</span>
                            }
<span class="nc bnc" id="L1066" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7050)) {</span>
<span class="nc" id="L1067">                                pref.setSummary(res.getQuantityString(R.plurals.deck_conf_group_summ, count, groupName, count));</span>
                            }
                            continue;
                        }
                    }
<span class="nc" id="L1072">                    String value = null;</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7054)) {</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                        if (pref == null) {</span>
<span class="nc" id="L1075">                            continue;</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">                        } else if (pref instanceof android.preference.CheckBoxPreference) {</span>
<span class="nc" id="L1077">                            continue;</span>
<span class="nc bnc" id="L1078" title="All 2 branches missed.">                        } else if (pref instanceof android.preference.ListPreference) {</span>
<span class="nc" id="L1079">                            android.preference.ListPreference lp = (android.preference.ListPreference) pref;</span>
<span class="nc bnc" id="L1080" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7053)) {</span>
<span class="nc bnc" id="L1081" title="All 2 branches missed.">                                value = lp.getEntry() != null ? lp.getEntry().toString() : &quot;&quot;;</span>
                            }
<span class="nc" id="L1083">                        } else {</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7052)) {</span>
<span class="nc" id="L1085">                                value = this.mPref.getString(key, &quot;&quot;);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L1089" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7056)) {</span>
                        // update summary
<span class="nc bnc" id="L1091" title="All 2 branches missed.">                        if (!mPref.mSummaries.containsKey(key)) {</span>
<span class="nc" id="L1092">                            CharSequence s = pref.getSummary();</span>
<span class="nc bnc" id="L1093" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7055)) {</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">                                mPref.mSummaries.put(key, s != null ? pref.getSummary().toString() : null);</span>
                            }
                        }
                    }
<span class="nc" id="L1098">                    String summ = mPref.mSummaries.get(key);</span>
<span class="nc bnc" id="L1099" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7060)) {</span>
<span class="nc bnc" id="L1100" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(7057) ? (summ != null || summ.contains(&quot;XXX&quot;)) : (summ != null &amp;&amp; summ.contains(&quot;XXX&quot;)))) {</span>
<span class="nc bnc" id="L1101" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7059)) {</span>
<span class="nc" id="L1102">                                pref.setSummary(summ.replace(&quot;XXX&quot;, value));</span>
                            }
                        } else {
<span class="nc bnc" id="L1105" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7058)) {</span>
<span class="nc" id="L1106">                                pref.setSummary(value);</span>
                            }
                        }
                    }
<span class="nc" id="L1110">                }</span>
            }
        }
        // Update summaries of preference items that don't have values (aren't in mValues)
<span class="nc" id="L1114">        int subDeckCount = getSubdeckCount();</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7062)) {</span>
<span class="nc" id="L1116">            this.findPreference(&quot;confSetSubdecks&quot;).setSummary(res.getQuantityString(R.plurals.deck_conf_set_subdecks_summ, subDeckCount, subDeckCount));</span>
        }
<span class="nc" id="L1118">    }</span>

    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5019
    @SuppressWarnings(&quot;deprecation&quot;)
    protected void buildLists() {
<span class="nc" id="L1123">        android.preference.ListPreference deckConfPref = (android.preference.ListPreference) findPreference(&quot;deckConf&quot;);</span>
<span class="nc" id="L1124">        ArrayList&lt;DeckConfig&gt; confs = mCol.getDecks().allConf();</span>
<span class="nc bnc" id="L1125" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7063)) {</span>
<span class="nc" id="L1126">            Collections.sort(confs, NamedJSONComparator.instance);</span>
        }
<span class="nc" id="L1128">        String[] confValues = new String[confs.size()];</span>
<span class="nc" id="L1129">        String[] confLabels = new String[confs.size()];</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7071)) {</span>
            {
<span class="nc" id="L1132">                long _loopCounter127 = 0;</span>
<span class="nc bnc" id="L1133" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(7070) ? (i &gt;= confs.size()) : (ListenerUtil.mutListener.listen(7069) ? (i &lt;= confs.size()) : (ListenerUtil.mutListener.listen(7068) ? (i &gt; confs.size()) : (ListenerUtil.mutListener.listen(7067) ? (i != confs.size()) : (ListenerUtil.mutListener.listen(7066) ? (i == confs.size()) : (i &lt; confs.size())))))); i++) {</span>
<span class="nc" id="L1134">                    ListenerUtil.loopListener.listen(&quot;_loopCounter127&quot;, ++_loopCounter127);</span>
<span class="nc" id="L1135">                    DeckConfig o = confs.get(i);</span>
<span class="nc bnc" id="L1136" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7064)) {</span>
<span class="nc" id="L1137">                        confValues[i] = o.getString(&quot;id&quot;);</span>
                    }
<span class="nc bnc" id="L1139" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7065)) {</span>
<span class="nc" id="L1140">                        confLabels[i] = o.getString(&quot;name&quot;);</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L1145" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7072)) {</span>
<span class="nc" id="L1146">            deckConfPref.setEntries(confLabels);</span>
        }
<span class="nc bnc" id="L1148" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7073)) {</span>
<span class="nc" id="L1149">            deckConfPref.setEntryValues(confValues);</span>
        }
<span class="nc bnc" id="L1151" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7074)) {</span>
<span class="nc" id="L1152">            deckConfPref.setValue(mPref.getString(&quot;deckConf&quot;, &quot;0&quot;));</span>
        }
<span class="nc" id="L1154">        android.preference.ListPreference newOrderPref = (android.preference.ListPreference) findPreference(&quot;newOrder&quot;);</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7075)) {</span>
<span class="nc" id="L1156">            newOrderPref.setEntries(R.array.new_order_labels);</span>
        }
<span class="nc bnc" id="L1158" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7076)) {</span>
<span class="nc" id="L1159">            newOrderPref.setEntryValues(R.array.new_order_values);</span>
        }
<span class="nc bnc" id="L1161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7077)) {</span>
<span class="nc" id="L1162">            newOrderPref.setValue(mPref.getString(&quot;newOrder&quot;, &quot;0&quot;));</span>
        }
<span class="nc" id="L1164">        android.preference.ListPreference leechActPref = (android.preference.ListPreference) findPreference(&quot;lapLeechAct&quot;);</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7078)) {</span>
<span class="nc" id="L1166">            leechActPref.setEntries(R.array.leech_action_labels);</span>
        }
<span class="nc bnc" id="L1168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7079)) {</span>
<span class="nc" id="L1169">            leechActPref.setEntryValues(R.array.leech_action_values);</span>
        }
<span class="nc bnc" id="L1171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7080)) {</span>
<span class="nc" id="L1172">            leechActPref.setValue(mPref.getString(&quot;lapLeechAct&quot;, Integer.toString(Consts.LEECH_SUSPEND)));</span>
        }
<span class="nc" id="L1174">    }</span>

    private boolean isSchedV2() {
<span class="nc bnc" id="L1177" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(7085) ? (mCol.schedVer() &gt;= 2) : (ListenerUtil.mutListener.listen(7084) ? (mCol.schedVer() &lt;= 2) : (ListenerUtil.mutListener.listen(7083) ? (mCol.schedVer() &gt; 2) : (ListenerUtil.mutListener.listen(7082) ? (mCol.schedVer() &lt; 2) : (ListenerUtil.mutListener.listen(7081) ? (mCol.schedVer() != 2) : (mCol.schedVer() == 2))))));</span>
    }

    /**
     * Enable deck preferences that are only available with Scheduler V2.
     */
    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5019
    @SuppressWarnings(&quot;deprecation&quot;)
    protected void enableSchedV2Preferences() {
<span class="nc" id="L1186">        NumberRangePreference hardFactorPreference = (NumberRangePreference) findPreference(&quot;hardFactor&quot;);</span>
<span class="nc bnc" id="L1187" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7086)) {</span>
<span class="nc" id="L1188">            hardFactorPreference.setEnabled(true);</span>
        }
<span class="nc" id="L1190">    }</span>

    /**
     * Returns the number of decks using the options group of the current deck.
     */
    private int getOptionsGroupCount() {
<span class="nc" id="L1196">        int count = 0;</span>
<span class="nc" id="L1197">        long conf = mDeck.getLong(&quot;conf&quot;);</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7090)) {</span>
            {
<span class="nc" id="L1200">                long _loopCounter128 = 0;</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">                for (Deck deck : mCol.getDecks().all()) {</span>
<span class="nc" id="L1202">                    ListenerUtil.loopListener.listen(&quot;_loopCounter128&quot;, ++_loopCounter128);</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7087)) {</span>
<span class="nc bnc" id="L1204" title="All 2 branches missed.">                        if (deck.isDyn()) {</span>
<span class="nc" id="L1205">                            continue;</span>
                        }
                    }
<span class="nc bnc" id="L1208" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7089)) {</span>
<span class="nc bnc" id="L1209" title="All 2 branches missed.">                        if (deck.getLong(&quot;conf&quot;) == conf) {</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7088)) {</span>
<span class="nc" id="L1211">                                count++;</span>
                            }
                        }
                    }
<span class="nc" id="L1215">                }</span>
            }
        }
<span class="nc" id="L1218">        return count;</span>
    }

    /**
     * Get the name of the currently set options group
     */
    private String getOptionsGroupName() {
<span class="nc" id="L1225">        long confId = mPref.getLong(&quot;deckConf&quot;, 0);</span>
<span class="nc" id="L1226">        return mCol.getDecks().getConf(confId).getString(&quot;name&quot;);</span>
    }

    /**
     * Get the number of (non-dynamic) subdecks for the current deck
     */
    private int getSubdeckCount() {
<span class="nc" id="L1233">        int count = 0;</span>
<span class="nc" id="L1234">        long did = mDeck.getLong(&quot;id&quot;);</span>
<span class="nc" id="L1235">        TreeMap&lt;String, Long&gt; children = mCol.getDecks().children(did);</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7093)) {</span>
            {
<span class="nc" id="L1238">                long _loopCounter129 = 0;</span>
<span class="nc bnc" id="L1239" title="All 2 branches missed.">                for (long childDid : children.values()) {</span>
<span class="nc" id="L1240">                    ListenerUtil.loopListener.listen(&quot;_loopCounter129&quot;, ++_loopCounter129);</span>
<span class="nc" id="L1241">                    Deck child = mCol.getDecks().get(childDid);</span>
<span class="nc bnc" id="L1242" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7091)) {</span>
<span class="nc bnc" id="L1243" title="All 2 branches missed.">                        if (child.isDyn()) {</span>
<span class="nc" id="L1244">                            continue;</span>
                        }
                    }
<span class="nc bnc" id="L1247" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7092)) {</span>
<span class="nc" id="L1248">                        count++;</span>
                    }
<span class="nc" id="L1250">                }</span>
            }
        }
<span class="nc" id="L1253">        return count;</span>
    }

    /**
     * finish when sd card is ejected
     */
    private void registerExternalStorageListener() {
<span class="nc bnc" id="L1260" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7099)) {</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">            if (mUnmountReceiver == null) {</span>
<span class="nc bnc" id="L1262" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7096)) {</span>
<span class="nc" id="L1263">                    mUnmountReceiver = new BroadcastReceiver() {</span>

                        @Override
                        public void onReceive(Context context, Intent intent) {
<span class="nc bnc" id="L1267" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7095)) {</span>
<span class="nc bnc" id="L1268" title="All 2 branches missed.">                                if (SdCardReceiver.MEDIA_EJECT.equals(intent.getAction())) {</span>
<span class="nc bnc" id="L1269" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7094)) {</span>
<span class="nc" id="L1270">                                        finish();</span>
                                    }
                                }
                            }
<span class="nc" id="L1274">                        }</span>
                    };
                }
<span class="nc" id="L1277">                IntentFilter iFilter = new IntentFilter();</span>
<span class="nc bnc" id="L1278" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7097)) {</span>
<span class="nc" id="L1279">                    iFilter.addAction(SdCardReceiver.MEDIA_EJECT);</span>
                }
<span class="nc bnc" id="L1281" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7098)) {</span>
<span class="nc" id="L1282">                    registerReceiver(mUnmountReceiver, iFilter);</span>
                }
            }
        }
<span class="nc" id="L1286">    }</span>

    private void restartActivity() {
<span class="nc bnc" id="L1289" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7100)) {</span>
<span class="nc" id="L1290">            recreate();</span>
        }
<span class="nc" id="L1292">    }</span>

    public static Calendar reminderToCalendar(Time time, JSONObject reminder) {
<span class="nc" id="L1295">        final Calendar calendar = time.calendar();</span>
<span class="nc bnc" id="L1296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7101)) {</span>
<span class="nc" id="L1297">            calendar.set(Calendar.HOUR_OF_DAY, reminder.getJSONArray(&quot;time&quot;).getInt(0));</span>
        }
<span class="nc bnc" id="L1299" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7102)) {</span>
<span class="nc" id="L1300">            calendar.set(Calendar.MINUTE, reminder.getJSONArray(&quot;time&quot;).getInt(1));</span>
        }
<span class="nc bnc" id="L1302" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7103)) {</span>
<span class="nc" id="L1303">            calendar.set(Calendar.SECOND, 0);</span>
        }
<span class="nc" id="L1305">        return calendar;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>