<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NoteEditor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">NoteEditor.java</span></div><h1>NoteEditor.java</h1><pre class="source lang-java linenums">/**
 * ************************************************************************************
 *                                                                                       *
 *  Copyright (c) 2012 Norbert Nagold &lt;norbert.nagold@gmail.com&gt;                         *
 *  Copyright (c) 2014 Timothy Rae &lt;perceptualchaos2@gmail.com&gt;                          *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki;

import android.annotation.SuppressLint;
import android.annotation.TargetApi;
import android.content.BroadcastReceiver;
import android.content.ClipboardManager;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.res.Resources;
import android.graphics.Typeface;
import android.graphics.drawable.Drawable;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import androidx.annotation.CheckResult;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.RequiresApi;
import androidx.annotation.StringRes;
import androidx.annotation.VisibleForTesting;
import androidx.appcompat.widget.PopupMenu;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Pair;
import android.view.ActionMode;
import android.view.KeyEvent;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup.MarginLayoutParams;
import android.view.WindowManager;
import android.view.inputmethod.InputMethodManager;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemSelectedListener;
import android.widget.ArrayAdapter;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.LinearLayout;
import android.widget.Spinner;
import android.widget.TextView;
import com.afollestad.materialdialogs.MaterialDialog;
import com.ichi2.anki.dialogs.ConfirmationDialog;
import com.ichi2.anki.dialogs.DiscardChangesDialog;
import com.ichi2.anki.dialogs.IntegerDialog;
import com.ichi2.anki.dialogs.LocaleSelectionDialog;
import com.ichi2.anki.dialogs.TagsDialog;
import com.ichi2.anki.exception.ConfirmModSchemaException;
import com.ichi2.anki.multimediacard.IMultimediaEditableNote;
import com.ichi2.anki.multimediacard.activity.MultimediaEditFieldActivity;
import com.ichi2.anki.multimediacard.fields.AudioClipField;
import com.ichi2.anki.multimediacard.fields.AudioRecordingField;
import com.ichi2.anki.multimediacard.fields.EFieldType;
import com.ichi2.anki.multimediacard.fields.IField;
import com.ichi2.anki.multimediacard.fields.ImageField;
import com.ichi2.anki.multimediacard.fields.TextField;
import com.ichi2.anki.multimediacard.impl.MultimediaEditableNote;
import com.ichi2.anki.noteeditor.FieldState;
import com.ichi2.anki.noteeditor.FieldState.FieldChangeType;
import com.ichi2.anki.noteeditor.CustomToolbarButton;
import com.ichi2.anki.noteeditor.Toolbar;
import com.ichi2.anki.receiver.SdCardReceiver;
import com.ichi2.anki.servicelayer.NoteService;
import com.ichi2.async.CollectionTask;
import com.ichi2.async.TaskListenerWithContext;
import com.ichi2.async.TaskManager;
import com.ichi2.compat.CompatHelper;
import com.ichi2.libanki.Card;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Consts;
import com.ichi2.libanki.Models;
import com.ichi2.libanki.Model;
import com.ichi2.libanki.Note;
import com.ichi2.libanki.Note.ClozeUtils;
import com.ichi2.libanki.Utils;
import com.ichi2.libanki.Deck;
import com.ichi2.themes.StyledProgressDialog;
import com.ichi2.themes.Themes;
import com.ichi2.anki.widgets.PopupMenuWithIcons;
import com.ichi2.utils.AdaptionUtil;
import com.ichi2.utils.ContentResolverUtil;
import com.ichi2.utils.DeckComparator;
import com.ichi2.utils.FileUtil;
import com.ichi2.utils.FunctionalInterfaces.Consumer;
import com.ichi2.utils.KeyUtils;
import com.ichi2.utils.MapUtil;
import com.ichi2.utils.NamedJSONComparator;
import com.ichi2.utils.NoteFieldDecorator;
import com.ichi2.utils.TextViewUtil;
import com.ichi2.widget.WidgetStatus;
import com.ichi2.utils.JSONArray;
import com.ichi2.utils.JSONObject;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import androidx.core.content.ContextCompat;
import androidx.core.text.HtmlCompat;
import androidx.fragment.app.DialogFragment;
import timber.log.Timber;
import static com.ichi2.compat.Compat.ACTION_PROCESS_TEXT;
import static com.ichi2.compat.Compat.EXTRA_PROCESS_TEXT;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.*;
import static com.ichi2.libanki.Models.NOT_FOUND_NOTE_TYPE;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * Allows the user to edit a note, for instance if there is a typo. A card is a presentation of a note, and has two
 * sides: a question and an answer. Any number of fields can appear on each side. When you add a note to Anki, cards
 * which show that note are generated. Some models generate one card, others generate more than one.
 *
 * @see &lt;a href=&quot;http://ankisrs.net/docs/manual.html#cards&quot;&gt;the Anki Desktop manual&lt;/a&gt;
 */
<span class="nc" id="L145">public class NoteEditor extends AnkiActivity {</span>

    // public static final String TARGET_LANGUAGE = &quot;TARGET_LANGUAGE&quot;;
    public static final String SOURCE_TEXT = &quot;SOURCE_TEXT&quot;;

    public static final String TARGET_TEXT = &quot;TARGET_TEXT&quot;;

    public static final String EXTRA_CALLER = &quot;CALLER&quot;;

    public static final String EXTRA_CARD_ID = &quot;CARD_ID&quot;;

    public static final String EXTRA_CONTENTS = &quot;CONTENTS&quot;;

    public static final String EXTRA_TAGS = &quot;TAGS&quot;;

    public static final String EXTRA_ID = &quot;ID&quot;;

    public static final String EXTRA_DID = &quot;DECK_ID&quot;;

    private static final String ACTION_CREATE_FLASHCARD = &quot;org.openintents.action.CREATE_FLASHCARD&quot;;

    private static final String ACTION_CREATE_FLASHCARD_SEND = &quot;android.intent.action.SEND&quot;;

    // calling activity
    public static final int CALLER_NOCALLER = 0;

    public static final int CALLER_REVIEWER = 1;

    public static final int CALLER_STUDYOPTIONS = 2;

    public static final int CALLER_DECKPICKER = 3;

    public static final int CALLER_REVIEWER_ADD = 11;

    public static final int CALLER_CARDBROWSER_EDIT = 6;

    public static final int CALLER_CARDBROWSER_ADD = 7;

    public static final int CALLER_CARDEDITOR = 8;

    public static final int CALLER_CARDEDITOR_INTENT_ADD = 10;

    public static final int REQUEST_ADD = 0;

    public static final int REQUEST_MULTIMEDIA_EDIT = 2;

    public static final int REQUEST_TEMPLATE_EDIT = 3;

    public static final int REQUEST_PREVIEW = 4;

    /**
     * Whether any change are saved. E.g. multimedia, new card added, field changed and saved.
     */
<span class="nc" id="L198">    private boolean mChanged = false;</span>

<span class="nc" id="L200">    private boolean mTagsEdited = false;</span>

<span class="nc" id="L202">    private boolean mFieldEdited = false;</span>

    /**
     * Flag which forces the calling activity to rebuild it's definition of current card from scratch
     */
<span class="nc" id="L207">    private boolean mReloadRequired = false;</span>

    /**
     * Broadcast that informs us when the sd card is about to be unmounted
     */
<span class="nc" id="L212">    private BroadcastReceiver mUnmountReceiver = null;</span>

    private LinearLayout mFieldsLayoutContainer;

    private TextView mTagsButton;

    private TextView mCardsButton;

    private Spinner mNoteTypeSpinner;

    private Spinner mNoteDeckSpinner;

    private Note mEditorNote;

    @Nullable
    private Card /* Null if adding a new card. Presently NonNull if editing an existing note - but this is subject to change */
    mCurrentEditedCard;

    private ArrayList&lt;String&gt; mSelectedTags;

    private long mCurrentDid;

    private ArrayList&lt;Long&gt; mAllDeckIds;

    private ArrayList&lt;Long&gt; mAllModelIds;

    private Map&lt;Integer, Integer&gt; mModelChangeFieldMap;

    private HashMap&lt;Integer, Integer&gt; mModelChangeCardMap;

<span class="nc" id="L242">    private ArrayList&lt;Integer&gt; mCustomViewIds = new ArrayList&lt;&gt;();</span>

    /* indicates if a new note is added or a card is edited */
    private boolean mAddNote;

    private boolean mAedictIntent;

    /* indicates which activity called Note Editor */
    private int mCaller;

    private LinkedList&lt;FieldEditText&gt; mEditFields;

    private MaterialDialog mProgressDialog;

    private String[] mSourceText;

<span class="nc" id="L258">    private FieldState mFieldState = FieldState.fromEditor(this);</span>

    private Toolbar mToolbar;

    // Use the same HTML if the same image is pasted multiple times.
<span class="nc" id="L263">    private HashMap&lt;String, String&gt; mPastedImageCache = new HashMap&lt;&gt;();</span>

    private SaveNoteHandler saveNoteHandler() {
<span class="nc" id="L266">        return new SaveNoteHandler(this);</span>
    }

<span class="nc" id="L269">    private enum AddClozeType {</span>

<span class="nc" id="L271">        SAME_NUMBER, INCREMENT_NUMBER</span>
    }

    private static class SaveNoteHandler extends TaskListenerWithContext&lt;NoteEditor, Integer, Boolean&gt; {

<span class="nc" id="L276">        private boolean mCloseAfter = false;</span>

        private Intent mIntent;

        private SaveNoteHandler(NoteEditor noteEditor) {
<span class="nc" id="L281">            super(noteEditor);</span>
<span class="nc" id="L282">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull NoteEditor noteEditor) {
<span class="nc" id="L286">            Resources res = noteEditor.getResources();</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9337)) {</span>
<span class="nc" id="L288">                noteEditor.mProgressDialog = StyledProgressDialog.show(noteEditor, &quot;&quot;, res.getString(R.string.saving_facts), false);</span>
            }
<span class="nc" id="L290">        }</span>

        @Override
        public void actualOnProgressUpdate(@NonNull NoteEditor noteEditor, Integer count) {
<span class="nc bnc" id="L294" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9348)) {</span>
<span class="nc bnc" id="L295" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(9342) ? (count &gt;= 0) : (ListenerUtil.mutListener.listen(9341) ? (count &lt;= 0) : (ListenerUtil.mutListener.listen(9340) ? (count &lt; 0) : (ListenerUtil.mutListener.listen(9339) ? (count != 0) : (ListenerUtil.mutListener.listen(9338) ? (count == 0) : (count &gt; 0))))))) {</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9344)) {</span>
<span class="nc" id="L297">                        noteEditor.mChanged = true;</span>
                    }
<span class="nc bnc" id="L299" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9345)) {</span>
<span class="nc" id="L300">                        noteEditor.mSourceText = null;</span>
                    }
<span class="nc bnc" id="L302" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9346)) {</span>
<span class="nc" id="L303">                        noteEditor.refreshNoteData(FieldChangeType.refreshWithStickyFields(shouldReplaceNewlines()));</span>
                    }
<span class="nc bnc" id="L305" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9347)) {</span>
<span class="nc" id="L306">                        UIUtils.showThemedToast(noteEditor, noteEditor.getResources().getQuantityString(R.plurals.factadder_cards_added, count, count), true);</span>
                    }
                } else {
<span class="nc bnc" id="L309" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9343)) {</span>
<span class="nc" id="L310">                        noteEditor.displayErrorSavingNote();</span>
                    }
                }
            }
<span class="nc bnc" id="L314" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9374)) {</span>
<span class="nc bnc" id="L315" title="All 106 branches missed.">                if ((ListenerUtil.mutListener.listen(9355) ? ((ListenerUtil.mutListener.listen(9354) ? (!noteEditor.mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(9353) ? (noteEditor.mCaller &gt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9352) ? (noteEditor.mCaller &lt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9351) ? (noteEditor.mCaller &gt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9350) ? (noteEditor.mCaller &lt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9349) ? (noteEditor.mCaller != CALLER_CARDEDITOR) : (noteEditor.mCaller == CALLER_CARDEDITOR))))))) : (!noteEditor.mAddNote || (ListenerUtil.mutListener.listen(9353) ? (noteEditor.mCaller &gt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9352) ? (noteEditor.mCaller &lt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9351) ? (noteEditor.mCaller &gt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9350) ? (noteEditor.mCaller &lt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9349) ? (noteEditor.mCaller != CALLER_CARDEDITOR) : (noteEditor.mCaller == CALLER_CARDEDITOR)))))))) &amp;&amp; noteEditor.mAedictIntent) : ((ListenerUtil.mutListener.listen(9354) ? (!noteEditor.mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(9353) ? (noteEditor.mCaller &gt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9352) ? (noteEditor.mCaller &lt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9351) ? (noteEditor.mCaller &gt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9350) ? (noteEditor.mCaller &lt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9349) ? (noteEditor.mCaller != CALLER_CARDEDITOR) : (noteEditor.mCaller == CALLER_CARDEDITOR))))))) : (!noteEditor.mAddNote || (ListenerUtil.mutListener.listen(9353) ? (noteEditor.mCaller &gt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9352) ? (noteEditor.mCaller &lt;= CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9351) ? (noteEditor.mCaller &gt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9350) ? (noteEditor.mCaller &lt; CALLER_CARDEDITOR) : (ListenerUtil.mutListener.listen(9349) ? (noteEditor.mCaller != CALLER_CARDEDITOR) : (noteEditor.mCaller == CALLER_CARDEDITOR)))))))) || noteEditor.mAedictIntent))) {</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9372)) {</span>
<span class="nc" id="L317">                        noteEditor.mChanged = true;</span>
                    }
<span class="nc bnc" id="L319" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9373)) {</span>
<span class="nc" id="L320">                        mCloseAfter = true;</span>
                    }
<span class="nc bnc" id="L322" title="All 22 branches missed.">                } else if ((ListenerUtil.mutListener.listen(9360) ? (noteEditor.mCaller &gt;= CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9359) ? (noteEditor.mCaller &lt;= CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9358) ? (noteEditor.mCaller &gt; CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9357) ? (noteEditor.mCaller &lt; CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9356) ? (noteEditor.mCaller != CALLER_CARDEDITOR_INTENT_ADD) : (noteEditor.mCaller == CALLER_CARDEDITOR_INTENT_ADD))))))) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9368)) {</span>
<span class="nc bnc" id="L324" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(9366) ? (count &gt;= 0) : (ListenerUtil.mutListener.listen(9365) ? (count &lt;= 0) : (ListenerUtil.mutListener.listen(9364) ? (count &lt; 0) : (ListenerUtil.mutListener.listen(9363) ? (count != 0) : (ListenerUtil.mutListener.listen(9362) ? (count == 0) : (count &gt; 0))))))) {</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9367)) {</span>
<span class="nc" id="L326">                                noteEditor.mChanged = true;</span>
                            }
                        }
                    }
<span class="nc bnc" id="L330" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9369)) {</span>
<span class="nc" id="L331">                        mCloseAfter = true;</span>
                    }
<span class="nc bnc" id="L333" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9370)) {</span>
<span class="nc" id="L334">                        mIntent = new Intent();</span>
                    }
<span class="nc bnc" id="L336" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9371)) {</span>
<span class="nc" id="L337">                        mIntent.putExtra(EXTRA_ID, noteEditor.getIntent().getStringExtra(EXTRA_ID));</span>
                    }
<span class="nc bnc" id="L339" title="All 2 branches missed.">                } else if (!noteEditor.mEditFields.isEmpty()) {</span>
<span class="nc" id="L340">                    FieldEditText firstEditField = noteEditor.mEditFields.getFirst();</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9361)) {</span>
                        // Required on my Android 9 Phone to show keyboard: https://stackoverflow.com/a/7784904
<span class="nc" id="L343">                        firstEditField.postDelayed(() -&gt; {</span>
<span class="nc" id="L344">                            firstEditField.requestFocus();</span>
<span class="nc" id="L345">                            InputMethodManager imm = (InputMethodManager) noteEditor.getSystemService(Context.INPUT_METHOD_SERVICE);</span>
<span class="nc" id="L346">                            imm.showSoftInput(firstEditField, InputMethodManager.SHOW_IMPLICIT);</span>
<span class="nc" id="L347">                        }, 200);</span>
                    }
                }
            }
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9379)) {</span>
<span class="nc bnc" id="L352" title="All 26 branches missed.">                if ((ListenerUtil.mutListener.listen(9376) ? ((ListenerUtil.mutListener.listen(9375) ? (!mCloseAfter || (noteEditor.mProgressDialog != null)) : (!mCloseAfter &amp;&amp; (noteEditor.mProgressDialog != null))) || noteEditor.mProgressDialog.isShowing()) : ((ListenerUtil.mutListener.listen(9375) ? (!mCloseAfter || (noteEditor.mProgressDialog != null)) : (!mCloseAfter &amp;&amp; (noteEditor.mProgressDialog != null))) &amp;&amp; noteEditor.mProgressDialog.isShowing()))) {</span>
                    try {
<span class="nc bnc" id="L354" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9378)) {</span>
<span class="nc" id="L355">                            noteEditor.mProgressDialog.dismiss();</span>
                        }
<span class="nc" id="L357">                    } catch (IllegalArgumentException e) {</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9377)) {</span>
<span class="nc" id="L359">                            Timber.e(e, &quot;Note Editor: Error on dismissing progress dialog&quot;);</span>
                        }
<span class="nc" id="L361">                    }</span>
                }
            }
<span class="nc" id="L364">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull NoteEditor noteEditor, Boolean noException) {
<span class="nc bnc" id="L368" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9391)) {</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                if (noException) {</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9384)) {</span>
<span class="nc bnc" id="L371" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9381) ? (noteEditor.mProgressDialog != null || noteEditor.mProgressDialog.isShowing()) : (noteEditor.mProgressDialog != null &amp;&amp; noteEditor.mProgressDialog.isShowing()))) {</span>
                            try {
<span class="nc bnc" id="L373" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9383)) {</span>
<span class="nc" id="L374">                                    noteEditor.mProgressDialog.dismiss();</span>
                                }
<span class="nc" id="L376">                            } catch (IllegalArgumentException e) {</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9382)) {</span>
<span class="nc" id="L378">                                    Timber.e(e, &quot;Note Editor: Error on dismissing progress dialog&quot;);</span>
                                }
<span class="nc" id="L380">                            }</span>
                        }
                    }
<span class="nc bnc" id="L383" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9390)) {</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                        if (mCloseAfter) {</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9389)) {</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">                                if (mIntent != null) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9388)) {</span>
<span class="nc" id="L388">                                        noteEditor.closeNoteEditor(mIntent);</span>
                                    }
                                } else {
<span class="nc bnc" id="L391" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9387)) {</span>
<span class="nc" id="L392">                                        noteEditor.closeNoteEditor();</span>
                                    }
                                }
                            }
                        } else {
<span class="nc bnc" id="L397" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9385)) {</span>
                                // Reset check for changes to fields
<span class="nc" id="L399">                                noteEditor.mFieldEdited = false;</span>
                            }
<span class="nc bnc" id="L401" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9386)) {</span>
<span class="nc" id="L402">                                noteEditor.mTagsEdited = false;</span>
                            }
                        }
                    }
                } else {
<span class="nc bnc" id="L407" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9380)) {</span>
                        // RuntimeException occurred on adding note
<span class="nc" id="L409">                        noteEditor.closeNoteEditor(DeckPicker.RESULT_DB_ERROR, null);</span>
                    }
                }
            }
<span class="nc" id="L413">        }</span>
    }

    private void displayErrorSavingNote() {
<span class="nc" id="L417">        int errorMessageId = getAddNoteErrorResource();</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9392)) {</span>
<span class="nc" id="L419">            UIUtils.showThemedToast(this, getResources().getString(errorMessageId), false);</span>
        }
<span class="nc" id="L421">    }</span>

    @StringRes
    protected int getAddNoteErrorResource() {
<span class="nc bnc" id="L425" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9393)) {</span>
            // COULD_BE_BETTER: We currently don't perform edits inside this class (wat), so we only handle adds.
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (this.isClozeType()) {</span>
<span class="nc" id="L428">                return R.string.note_editor_no_cloze_delations;</span>
            }
        }
<span class="nc bnc" id="L431" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9394)) {</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">            if (TextUtils.isEmpty(getCurrentFieldText(0))) {</span>
<span class="nc" id="L433">                return R.string.note_editor_no_first_field;</span>
            }
        }
<span class="nc bnc" id="L436" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9395)) {</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">            if (allFieldsHaveContent()) {</span>
<span class="nc" id="L438">                return R.string.note_editor_no_cards_created_all_fields;</span>
            }
        }
        // Otherwise, display &quot;no cards created&quot;.
<span class="nc" id="L442">        return R.string.note_editor_no_cards_created;</span>
    }

    private boolean allFieldsHaveContent() {
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9397)) {</span>
            {
<span class="nc" id="L448">                long _loopCounter148 = 0;</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">                for (String s : this.getCurrentFieldStrings()) {</span>
<span class="nc" id="L450">                    ListenerUtil.loopListener.listen(&quot;_loopCounter148&quot;, ++_loopCounter148);</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9396)) {</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                        if (TextUtils.isEmpty(s)) {</span>
<span class="nc" id="L453">                            return false;</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L459">        return true;</span>
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9398)) {</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if (showedActivityFailedScreen(savedInstanceState)) {</span>
<span class="nc" id="L466">                return;</span>
            }
        }
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9399)) {</span>
<span class="nc" id="L470">            Timber.d(&quot;onCreate()&quot;);</span>
        }
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9400)) {</span>
<span class="nc" id="L473">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L475" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9401)) {</span>
<span class="nc" id="L476">            mFieldState.setInstanceState(savedInstanceState);</span>
        }
<span class="nc bnc" id="L478" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9402)) {</span>
<span class="nc" id="L479">            setContentView(R.layout.note_editor);</span>
        }
<span class="nc" id="L481">        Intent intent = getIntent();</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9421)) {</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">            if (savedInstanceState != null) {</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9414)) {</span>
<span class="nc" id="L485">                    mCaller = savedInstanceState.getInt(&quot;caller&quot;);</span>
                }
<span class="nc bnc" id="L487" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9415)) {</span>
<span class="nc" id="L488">                    mAddNote = savedInstanceState.getBoolean(&quot;addNote&quot;);</span>
                }
<span class="nc bnc" id="L490" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9416)) {</span>
<span class="nc" id="L491">                    mCurrentDid = savedInstanceState.getLong(&quot;did&quot;);</span>
                }
<span class="nc bnc" id="L493" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9417)) {</span>
<span class="nc" id="L494">                    mSelectedTags = savedInstanceState.getStringArrayList(&quot;tags&quot;);</span>
                }
<span class="nc bnc" id="L496" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9418)) {</span>
<span class="nc" id="L497">                    mReloadRequired = savedInstanceState.getBoolean(&quot;reloadRequired&quot;);</span>
                }
<span class="nc bnc" id="L499" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9419)) {</span>
<span class="nc" id="L500">                    mPastedImageCache = (HashMap&lt;String, String&gt;) savedInstanceState.getSerializable(&quot;imageCache&quot;);</span>
                }
<span class="nc bnc" id="L502" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9420)) {</span>
<span class="nc" id="L503">                    mChanged = savedInstanceState.getBoolean(&quot;changed&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L506" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9403)) {</span>
<span class="nc" id="L507">                    mCaller = intent.getIntExtra(EXTRA_CALLER, CALLER_NOCALLER);</span>
                }
<span class="nc bnc" id="L509" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9413)) {</span>
<span class="nc bnc" id="L510" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(9408) ? (mCaller &gt;= CALLER_NOCALLER) : (ListenerUtil.mutListener.listen(9407) ? (mCaller &lt;= CALLER_NOCALLER) : (ListenerUtil.mutListener.listen(9406) ? (mCaller &gt; CALLER_NOCALLER) : (ListenerUtil.mutListener.listen(9405) ? (mCaller &lt; CALLER_NOCALLER) : (ListenerUtil.mutListener.listen(9404) ? (mCaller != CALLER_NOCALLER) : (mCaller == CALLER_NOCALLER))))))) {</span>
<span class="nc" id="L511">                        String action = intent.getAction();</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9412)) {</span>
<span class="nc bnc" id="L513" title="All 26 branches missed.">                            if (((ListenerUtil.mutListener.listen(9410) ? ((ListenerUtil.mutListener.listen(9409) ? (ACTION_CREATE_FLASHCARD.equals(action) &amp;&amp; ACTION_CREATE_FLASHCARD_SEND.equals(action)) : (ACTION_CREATE_FLASHCARD.equals(action) || ACTION_CREATE_FLASHCARD_SEND.equals(action))) &amp;&amp; ACTION_PROCESS_TEXT.equals(action)) : ((ListenerUtil.mutListener.listen(9409) ? (ACTION_CREATE_FLASHCARD.equals(action) &amp;&amp; ACTION_CREATE_FLASHCARD_SEND.equals(action)) : (ACTION_CREATE_FLASHCARD.equals(action) || ACTION_CREATE_FLASHCARD_SEND.equals(action))) || ACTION_PROCESS_TEXT.equals(action))))) {</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9411)) {</span>
<span class="nc" id="L515">                                    mCaller = CALLER_CARDEDITOR_INTENT_ADD;</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9422)) {</span>
<span class="nc" id="L524">            startLoadingCollection();</span>
        }
<span class="nc" id="L526">    }</span>

    @Override
    protected void onSaveInstanceState(@NonNull Bundle savedInstanceState) {
<span class="nc bnc" id="L530" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9423)) {</span>
<span class="nc" id="L531">            addInstanceStateToBundle(savedInstanceState);</span>
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9424)) {</span>
<span class="nc" id="L534">            super.onSaveInstanceState(savedInstanceState);</span>
        }
<span class="nc" id="L536">    }</span>

    private void addInstanceStateToBundle(@NonNull Bundle savedInstanceState) {
<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9425)) {</span>
<span class="nc" id="L540">            Timber.i(&quot;Saving instance&quot;);</span>
        }
<span class="nc bnc" id="L542" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9426)) {</span>
<span class="nc" id="L543">            savedInstanceState.putInt(&quot;caller&quot;, mCaller);</span>
        }
<span class="nc bnc" id="L545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9427)) {</span>
<span class="nc" id="L546">            savedInstanceState.putBoolean(&quot;addNote&quot;, mAddNote);</span>
        }
<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9428)) {</span>
<span class="nc" id="L549">            savedInstanceState.putLong(&quot;did&quot;, mCurrentDid);</span>
        }
<span class="nc bnc" id="L551" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9429)) {</span>
<span class="nc" id="L552">            savedInstanceState.putBoolean(&quot;changed&quot;, mChanged);</span>
        }
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9430)) {</span>
<span class="nc" id="L555">            savedInstanceState.putBoolean(&quot;reloadRequired&quot;, mReloadRequired);</span>
        }
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9431)) {</span>
<span class="nc" id="L558">            savedInstanceState.putIntegerArrayList(&quot;customViewIds&quot;, mCustomViewIds);</span>
        }
<span class="nc bnc" id="L560" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9432)) {</span>
<span class="nc" id="L561">            savedInstanceState.putSerializable(&quot;imageCache&quot;, mPastedImageCache);</span>
        }
<span class="nc bnc" id="L563" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9434)) {</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">            if (mSelectedTags == null) {</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9433)) {</span>
<span class="nc" id="L566">                    mSelectedTags = new ArrayList&lt;&gt;(0);</span>
                }
            }
        }
<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9435)) {</span>
<span class="nc" id="L571">            savedInstanceState.putStringArrayList(&quot;tags&quot;, mSelectedTags);</span>
        }
<span class="nc" id="L573">    }</span>

    /**
     * Converts field values should to HTML linebreaks
     */
    private Bundle getFieldsAsBundleForPreview() {
<span class="nc" id="L579">        Bundle fields = new Bundle();</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9437)) {</span>
            // easily map the fields correctly later.
<span class="nc bnc" id="L582" title="All 2 branches missed.">            if (mEditFields == null) {</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9436)) {</span>
                    // DA - I don't believe that this is required. Needs testing
<span class="nc" id="L585">                    mEditFields = new LinkedList&lt;&gt;();</span>
                }
            }
        }
<span class="nc bnc" id="L589" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9441)) {</span>
            {
<span class="nc" id="L591">                long _loopCounter149 = 0;</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">                for (FieldEditText e : mEditFields) {</span>
<span class="nc" id="L593">                    ListenerUtil.loopListener.listen(&quot;_loopCounter149&quot;, ++_loopCounter149);</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9439)) {</span>
<span class="nc bnc" id="L595" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9438) ? (e == null &amp;&amp; e.getText() == null) : (e == null || e.getText() == null))) {</span>
<span class="nc" id="L596">                            continue;</span>
                        }
                    }
<span class="nc" id="L599">                    String fieldValue = convertToHtmlNewline(e.getText().toString());</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9440)) {</span>
<span class="nc" id="L601">                        fields.putString(Integer.toString(e.getOrd()), fieldValue);</span>
                    }
<span class="nc" id="L603">                }</span>
            }
        }
<span class="nc" id="L606">        return fields;</span>
    }

    // Finish initializing the activity after the collection has been correctly loaded
    @Override
    protected void onCollectionLoaded(Collection col) {
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9442)) {</span>
<span class="nc" id="L613">            super.onCollectionLoaded(col);</span>
        }
<span class="nc" id="L615">        Intent intent = getIntent();</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9443)) {</span>
<span class="nc" id="L617">            Timber.d(&quot;NoteEditor() onCollectionLoaded: caller: %d&quot;, mCaller);</span>
        }
<span class="nc bnc" id="L619" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9444)) {</span>
<span class="nc" id="L620">            registerExternalStorageListener();</span>
        }
<span class="nc" id="L622">        View mainView = findViewById(android.R.id.content);</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9445)) {</span>
<span class="nc" id="L624">            mToolbar = findViewById(R.id.editor_toolbar);</span>
        }
<span class="nc bnc" id="L626" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9446)) {</span>
<span class="nc" id="L627">            mToolbar.setFormatListener(formatter -&gt; {</span>
<span class="nc" id="L628">                View currentFocus = getCurrentFocus();</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">                if (!(currentFocus instanceof FieldEditText)) {</span>
<span class="nc" id="L630">                    return;</span>
                }
<span class="nc" id="L632">                modifyCurrentSelection(formatter, (FieldEditText) currentFocus);</span>
<span class="nc" id="L633">            });</span>
        }
<span class="nc bnc" id="L635" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9447)) {</span>
<span class="nc" id="L636">            enableToolbar(mainView);</span>
        }
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9448)) {</span>
<span class="nc" id="L639">            mFieldsLayoutContainer = findViewById(R.id.CardEditorEditFieldsLayout);</span>
        }
<span class="nc bnc" id="L641" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9449)) {</span>
<span class="nc" id="L642">            mTagsButton = findViewById(R.id.CardEditorTagText);</span>
        }
<span class="nc bnc" id="L644" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9450)) {</span>
<span class="nc" id="L645">            mCardsButton = findViewById(R.id.CardEditorCardsText);</span>
        }
<span class="nc bnc" id="L647" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9451)) {</span>
<span class="nc" id="L648">            mCardsButton.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L649">                Timber.i(&quot;NoteEditor:: Cards button pressed. Opening template editor&quot;);</span>
<span class="nc" id="L650">                showCardTemplateEditor();</span>
<span class="nc" id="L651">            });</span>
        }
<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9452)) {</span>
<span class="nc" id="L654">            mAedictIntent = false;</span>
        }
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9453)) {</span>
<span class="nc" id="L657">            mCurrentEditedCard = null;</span>
        }
<span class="nc bnc" id="L659" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9474)) {</span>
<span class="nc bnc" id="L660" title="All 6 branches missed.">            switch(mCaller) {</span>
                case CALLER_NOCALLER:
<span class="nc bnc" id="L662" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9454)) {</span>
<span class="nc" id="L663">                        Timber.e(&quot;no caller could be identified, closing&quot;);</span>
                    }
<span class="nc bnc" id="L665" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9455)) {</span>
<span class="nc" id="L666">                        finishWithoutAnimation();</span>
                    }
<span class="nc" id="L668">                    return;</span>
                case CALLER_REVIEWER:
<span class="nc bnc" id="L670" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9456)) {</span>
<span class="nc" id="L671">                        mCurrentEditedCard = AbstractFlashcardViewer.getEditorCard();</span>
                    }
<span class="nc bnc" id="L673" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9458)) {</span>
<span class="nc bnc" id="L674" title="All 2 branches missed.">                        if (mCurrentEditedCard == null) {</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9457)) {</span>
<span class="nc" id="L676">                                finishWithoutAnimation();</span>
                            }
<span class="nc" id="L678">                            return;</span>
                        }
                    }
<span class="nc bnc" id="L681" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9459)) {</span>
<span class="nc" id="L682">                        mEditorNote = mCurrentEditedCard.note();</span>
                    }
<span class="nc bnc" id="L684" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9460)) {</span>
<span class="nc" id="L685">                        mAddNote = false;</span>
                    }
                    break;
                case CALLER_STUDYOPTIONS:
                case CALLER_DECKPICKER:
                case CALLER_REVIEWER_ADD:
                case CALLER_CARDBROWSER_ADD:
                case CALLER_CARDEDITOR:
<span class="nc bnc" id="L693" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9461)) {</span>
<span class="nc" id="L694">                        mAddNote = true;</span>
                    }
                    break;
                case CALLER_CARDBROWSER_EDIT:
<span class="nc bnc" id="L698" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9462)) {</span>
<span class="nc" id="L699">                        mCurrentEditedCard = CardBrowser.sCardBrowserCard;</span>
                    }
<span class="nc bnc" id="L701" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9464)) {</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">                        if (mCurrentEditedCard == null) {</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9463)) {</span>
<span class="nc" id="L704">                                finishWithoutAnimation();</span>
                            }
<span class="nc" id="L706">                            return;</span>
                        }
                    }
<span class="nc bnc" id="L709" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9465)) {</span>
<span class="nc" id="L710">                        mEditorNote = mCurrentEditedCard.note();</span>
                    }
<span class="nc bnc" id="L712" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9466)) {</span>
<span class="nc" id="L713">                        mAddNote = false;</span>
                    }
                    break;
                case CALLER_CARDEDITOR_INTENT_ADD:
                    {
<span class="nc bnc" id="L718" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9467)) {</span>
<span class="nc" id="L719">                            fetchIntentInformation(intent);</span>
                        }
<span class="nc bnc" id="L721" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9469)) {</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">                            if (mSourceText == null) {</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9468)) {</span>
<span class="nc" id="L724">                                    finishWithoutAnimation();</span>
                                }
<span class="nc" id="L726">                                return;</span>
                            }
                        }
<span class="nc bnc" id="L729" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9472)) {</span>
<span class="nc bnc" id="L730" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(9470) ? (&quot;Aedict Notepad&quot;.equals(mSourceText[0]) || addFromAedict(mSourceText[1])) : (&quot;Aedict Notepad&quot;.equals(mSourceText[0]) &amp;&amp; addFromAedict(mSourceText[1])))) {</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9471)) {</span>
<span class="nc" id="L732">                                    finishWithoutAnimation();</span>
                                }
<span class="nc" id="L734">                                return;</span>
                            }
                        }
<span class="nc bnc" id="L737" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9473)) {</span>
<span class="nc" id="L738">                            mAddNote = true;</span>
                        }
                        break;
                    }
                default:
                    break;
            }
        }
<span class="nc bnc" id="L746" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9475)) {</span>
            // Note type Selector
<span class="nc" id="L748">            mNoteTypeSpinner = findViewById(R.id.note_type_spinner);</span>
        }
<span class="nc" id="L750">        ArrayList&lt;Model&gt; models = getCol().getModels().all();</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9476)) {</span>
<span class="nc" id="L752">            Collections.sort(models, NamedJSONComparator.instance);</span>
        }
<span class="nc" id="L754">        final ArrayList&lt;String&gt; modelNames = new ArrayList&lt;&gt;(models.size());</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9477)) {</span>
<span class="nc" id="L756">            mAllModelIds = new ArrayList&lt;&gt;(models.size());</span>
        }
<span class="nc bnc" id="L758" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9480)) {</span>
            {
<span class="nc" id="L760">                long _loopCounter150 = 0;</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">                for (JSONObject m : models) {</span>
<span class="nc" id="L762">                    ListenerUtil.loopListener.listen(&quot;_loopCounter150&quot;, ++_loopCounter150);</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9478)) {</span>
<span class="nc" id="L764">                        modelNames.add(m.getString(&quot;name&quot;));</span>
                    }
<span class="nc bnc" id="L766" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9479)) {</span>
<span class="nc" id="L767">                        mAllModelIds.add(m.getLong(&quot;id&quot;));</span>
                    }
<span class="nc" id="L769">                }</span>
            }
        }
<span class="nc" id="L772">        ArrayAdapter&lt;String&gt; noteTypeAdapter = new ArrayAdapter&lt;&gt;(this, android.R.layout.simple_spinner_item, modelNames);</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9481)) {</span>
<span class="nc" id="L774">            mNoteTypeSpinner.setAdapter(noteTypeAdapter);</span>
        }
<span class="nc bnc" id="L776" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9482)) {</span>
<span class="nc" id="L777">            noteTypeAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
        }
        // Deck Selector
<span class="nc" id="L780">        TextView deckTextView = findViewById(R.id.CardEditorDeckText);</span>
<span class="nc bnc" id="L781" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9490)) {</span>
            // If edit mode and more than one card template distinguish between &quot;Deck&quot; and &quot;Card deck&quot;
<span class="nc bnc" id="L783" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(9488) ? (!mAddNote || (ListenerUtil.mutListener.listen(9487) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &gt;= 1) : (ListenerUtil.mutListener.listen(9486) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &lt;= 1) : (ListenerUtil.mutListener.listen(9485) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &lt; 1) : (ListenerUtil.mutListener.listen(9484) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() != 1) : (ListenerUtil.mutListener.listen(9483) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() == 1) : (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(9487) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &gt;= 1) : (ListenerUtil.mutListener.listen(9486) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &lt;= 1) : (ListenerUtil.mutListener.listen(9485) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &lt; 1) : (ListenerUtil.mutListener.listen(9484) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() != 1) : (ListenerUtil.mutListener.listen(9483) ? (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() == 1) : (mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length() &gt; 1))))))))) {</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9489)) {</span>
<span class="nc" id="L785">                    deckTextView.setText(R.string.CardEditorCardDeck);</span>
                }
            }
        }
<span class="nc bnc" id="L789" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9491)) {</span>
<span class="nc" id="L790">            mNoteDeckSpinner = findViewById(R.id.note_deck_spinner);</span>
        }
<span class="nc" id="L792">        ArrayList&lt;Deck&gt; decks = getCol().getDecks().all();</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9492)) {</span>
<span class="nc" id="L794">            Collections.sort(decks, DeckComparator.instance);</span>
        }
<span class="nc" id="L796">        final ArrayList&lt;String&gt; deckNames = new ArrayList&lt;&gt;(decks.size());</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9493)) {</span>
<span class="nc" id="L798">            mAllDeckIds = new ArrayList&lt;&gt;(decks.size());</span>
        }
<span class="nc bnc" id="L800" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9506)) {</span>
            {
<span class="nc" id="L802">                long _loopCounter151 = 0;</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">                for (Deck d : decks) {</span>
<span class="nc" id="L804">                    ListenerUtil.loopListener.listen(&quot;_loopCounter151&quot;, ++_loopCounter151);</span>
                    // add current deck and all other non-filtered decks to deck list
<span class="nc" id="L806">                    long thisDid = d.getLong(&quot;id&quot;);</span>
<span class="nc" id="L807">                    String currentName = d.getString(&quot;name&quot;);</span>
<span class="nc" id="L808">                    String lineContent = null;</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9503)) {</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">                        if (d.isStd()) {</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9502)) {</span>
<span class="nc" id="L812">                                lineContent = currentName;</span>
                            }
<span class="nc bnc" id="L814" title="All 66 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(9500) ? ((ListenerUtil.mutListener.listen(9494) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null)) || (ListenerUtil.mutListener.listen(9499) ? (mCurrentEditedCard.getDid() &gt;= thisDid) : (ListenerUtil.mutListener.listen(9498) ? (mCurrentEditedCard.getDid() &lt;= thisDid) : (ListenerUtil.mutListener.listen(9497) ? (mCurrentEditedCard.getDid() &gt; thisDid) : (ListenerUtil.mutListener.listen(9496) ? (mCurrentEditedCard.getDid() &lt; thisDid) : (ListenerUtil.mutListener.listen(9495) ? (mCurrentEditedCard.getDid() != thisDid) : (mCurrentEditedCard.getDid() == thisDid))))))) : ((ListenerUtil.mutListener.listen(9494) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null)) &amp;&amp; (ListenerUtil.mutListener.listen(9499) ? (mCurrentEditedCard.getDid() &gt;= thisDid) : (ListenerUtil.mutListener.listen(9498) ? (mCurrentEditedCard.getDid() &lt;= thisDid) : (ListenerUtil.mutListener.listen(9497) ? (mCurrentEditedCard.getDid() &gt; thisDid) : (ListenerUtil.mutListener.listen(9496) ? (mCurrentEditedCard.getDid() &lt; thisDid) : (ListenerUtil.mutListener.listen(9495) ? (mCurrentEditedCard.getDid() != thisDid) : (mCurrentEditedCard.getDid() == thisDid))))))))) {</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9501)) {</span>
<span class="nc" id="L816">                                lineContent = getApplicationContext().getString(R.string.current_and_default_deck, currentName, col.getDecks().name(mCurrentEditedCard.getODid()));</span>
                            }
                        } else {
                            continue;
                        }
                    }
<span class="nc bnc" id="L822" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9504)) {</span>
<span class="nc" id="L823">                        deckNames.add(lineContent);</span>
                    }
<span class="nc bnc" id="L825" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9505)) {</span>
<span class="nc" id="L826">                        mAllDeckIds.add(thisDid);</span>
                    }
<span class="nc" id="L828">                }</span>
            }
        }
<span class="nc" id="L831">        ArrayAdapter&lt;String&gt; noteDeckAdapter = new ArrayAdapter&lt;&gt;(this, android.R.layout.simple_spinner_item, deckNames);</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9507)) {</span>
<span class="nc" id="L833">            mNoteDeckSpinner.setAdapter(noteDeckAdapter);</span>
        }
<span class="nc bnc" id="L835" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9508)) {</span>
<span class="nc" id="L836">            noteDeckAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
        }
<span class="nc bnc" id="L838" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9510)) {</span>
<span class="nc" id="L839">            mNoteDeckSpinner.setOnItemSelectedListener(new OnItemSelectedListener() {</span>

                @Override
                public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int pos, long id) {
<span class="nc bnc" id="L843" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9509)) {</span>
                        // Timber.i(&quot;NoteEditor:: onItemSelected() fired on mNoteDeckSpinner with pos = %d&quot;, pos);
<span class="nc" id="L845">                        mCurrentDid = mAllDeckIds.get(pos);</span>
                    }
<span class="nc" id="L847">                }</span>

                @Override
                public void onNothingSelected(AdapterView&lt;?&gt; parent) {
<span class="nc" id="L851">                }</span>
            });
        }
<span class="nc bnc" id="L854" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9511)) {</span>
<span class="nc" id="L855">            mCurrentDid = intent.getLongExtra(EXTRA_DID, mCurrentDid);</span>
        }
<span class="nc bnc" id="L857" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9512)) {</span>
<span class="nc" id="L858">            setDid(mEditorNote);</span>
        }
<span class="nc bnc" id="L860" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9513)) {</span>
<span class="nc" id="L861">            setNote(mEditorNote, FieldChangeType.onActivityCreation(shouldReplaceNewlines()));</span>
        }
<span class="nc bnc" id="L863" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9551)) {</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">            if (mAddNote) {</span>
<span class="nc bnc" id="L865" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9516)) {</span>
<span class="nc" id="L866">                    mNoteTypeSpinner.setOnItemSelectedListener(new SetNoteTypeListener());</span>
                }
<span class="nc bnc" id="L868" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9517)) {</span>
<span class="nc" id="L869">                    setTitle(R.string.menu_add_note);</span>
                }
                // set information transferred by intent
<span class="nc" id="L872">                String contents = null;</span>
<span class="nc" id="L873">                String[] tags = intent.getStringArrayExtra(EXTRA_TAGS);</span>
<span class="nc bnc" id="L874" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9546)) {</span>
<span class="nc bnc" id="L875" title="All 2 branches missed.">                    if (mSourceText != null) {</span>
<span class="nc bnc" id="L876" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9545)) {</span>
<span class="nc bnc" id="L877" title="All 106 branches missed.">                            if ((ListenerUtil.mutListener.listen(9525) ? ((ListenerUtil.mutListener.listen(9524) ? (mAedictIntent || ((ListenerUtil.mutListener.listen(9523) ? (mEditFields.size() &gt;= 3) : (ListenerUtil.mutListener.listen(9522) ? (mEditFields.size() &lt;= 3) : (ListenerUtil.mutListener.listen(9521) ? (mEditFields.size() &gt; 3) : (ListenerUtil.mutListener.listen(9520) ? (mEditFields.size() &lt; 3) : (ListenerUtil.mutListener.listen(9519) ? (mEditFields.size() != 3) : (mEditFields.size() == 3)))))))) : (mAedictIntent &amp;&amp; ((ListenerUtil.mutListener.listen(9523) ? (mEditFields.size() &gt;= 3) : (ListenerUtil.mutListener.listen(9522) ? (mEditFields.size() &lt;= 3) : (ListenerUtil.mutListener.listen(9521) ? (mEditFields.size() &gt; 3) : (ListenerUtil.mutListener.listen(9520) ? (mEditFields.size() &lt; 3) : (ListenerUtil.mutListener.listen(9519) ? (mEditFields.size() != 3) : (mEditFields.size() == 3))))))))) || mSourceText[1].contains(&quot;[&quot;)) : ((ListenerUtil.mutListener.listen(9524) ? (mAedictIntent || ((ListenerUtil.mutListener.listen(9523) ? (mEditFields.size() &gt;= 3) : (ListenerUtil.mutListener.listen(9522) ? (mEditFields.size() &lt;= 3) : (ListenerUtil.mutListener.listen(9521) ? (mEditFields.size() &gt; 3) : (ListenerUtil.mutListener.listen(9520) ? (mEditFields.size() &lt; 3) : (ListenerUtil.mutListener.listen(9519) ? (mEditFields.size() != 3) : (mEditFields.size() == 3)))))))) : (mAedictIntent &amp;&amp; ((ListenerUtil.mutListener.listen(9523) ? (mEditFields.size() &gt;= 3) : (ListenerUtil.mutListener.listen(9522) ? (mEditFields.size() &lt;= 3) : (ListenerUtil.mutListener.listen(9521) ? (mEditFields.size() &gt; 3) : (ListenerUtil.mutListener.listen(9520) ? (mEditFields.size() &lt; 3) : (ListenerUtil.mutListener.listen(9519) ? (mEditFields.size() != 3) : (mEditFields.size() == 3))))))))) &amp;&amp; mSourceText[1].contains(&quot;[&quot;)))) {</span>
<span class="nc bnc" id="L878" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9539)) {</span>
<span class="nc" id="L879">                                    contents = mSourceText[1].replaceFirst(&quot;\\[&quot;, &quot;\u001f&quot; + mSourceText[0] + &quot;\u001f&quot;);</span>
                                }
<span class="nc bnc" id="L881" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9544)) {</span>
<span class="nc bnc" id="L882" title="All 8 branches missed.">                                    contents = contents.substring(0, (ListenerUtil.mutListener.listen(9543) ? (contents.length() % 1) : (ListenerUtil.mutListener.listen(9542) ? (contents.length() / 1) : (ListenerUtil.mutListener.listen(9541) ? (contents.length() * 1) : (ListenerUtil.mutListener.listen(9540) ? (contents.length() + 1) : (contents.length() - 1))))));</span>
                                }
<span class="nc bnc" id="L884" title="All 22 branches missed.">                            } else if ((ListenerUtil.mutListener.listen(9530) ? (mEditFields.size() &gt;= 0) : (ListenerUtil.mutListener.listen(9529) ? (mEditFields.size() &lt;= 0) : (ListenerUtil.mutListener.listen(9528) ? (mEditFields.size() &lt; 0) : (ListenerUtil.mutListener.listen(9527) ? (mEditFields.size() != 0) : (ListenerUtil.mutListener.listen(9526) ? (mEditFields.size() == 0) : (mEditFields.size() &gt; 0))))))) {</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9531)) {</span>
<span class="nc" id="L886">                                    mEditFields.get(0).setText(mSourceText[0]);</span>
                                }
<span class="nc bnc" id="L888" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9538)) {</span>
<span class="nc bnc" id="L889" title="All 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(9536) ? (mEditFields.size() &gt;= 1) : (ListenerUtil.mutListener.listen(9535) ? (mEditFields.size() &lt;= 1) : (ListenerUtil.mutListener.listen(9534) ? (mEditFields.size() &lt; 1) : (ListenerUtil.mutListener.listen(9533) ? (mEditFields.size() != 1) : (ListenerUtil.mutListener.listen(9532) ? (mEditFields.size() == 1) : (mEditFields.size() &gt; 1))))))) {</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9537)) {</span>
<span class="nc" id="L891">                                            mEditFields.get(1).setText(mSourceText[1]);</span>
                                        }
                                    }
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L898" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9518)) {</span>
<span class="nc" id="L899">                            contents = intent.getStringExtra(EXTRA_CONTENTS);</span>
                        }
                    }
                }
<span class="nc bnc" id="L903" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9548)) {</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">                    if (contents != null) {</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9547)) {</span>
<span class="nc" id="L906">                            setEditFieldTexts(contents);</span>
                        }
                    }
                }
<span class="nc bnc" id="L910" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9550)) {</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">                    if (tags != null) {</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9549)) {</span>
<span class="nc" id="L913">                            setTags(tags);</span>
                        }
                    }
                }
<span class="nc" id="L917">            } else {</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9514)) {</span>
<span class="nc" id="L919">                    mNoteTypeSpinner.setOnItemSelectedListener(new EditNoteTypeListener());</span>
                }
<span class="nc bnc" id="L921" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9515)) {</span>
<span class="nc" id="L922">                    setTitle(R.string.cardeditor_title_edit_card);</span>
                }
            }
        }
<span class="nc bnc" id="L926" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9552)) {</span>
<span class="nc" id="L927">            findViewById(R.id.CardEditorTagButton).setOnClickListener(v -&gt; {</span>
<span class="nc" id="L928">                Timber.i(&quot;NoteEditor:: Tags button pressed... opening tags editor&quot;);</span>
<span class="nc" id="L929">                showTagsDialog();</span>
<span class="nc" id="L930">            });</span>
        }
<span class="nc bnc" id="L932" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9555)) {</span>
<span class="nc bnc" id="L933" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9553) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null))) {</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9554)) {</span>
<span class="nc" id="L935">                    Timber.i(&quot;onCollectionLoaded() Edit note activity successfully started with card id %d&quot;, mCurrentEditedCard.getId());</span>
                }
            }
        }
<span class="nc bnc" id="L939" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9557)) {</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">            if (mAddNote) {</span>
<span class="nc bnc" id="L941" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9556)) {</span>
<span class="nc" id="L942">                    Timber.i(&quot;onCollectionLoaded() Edit note activity successfully started in add card mode with node id %d&quot;, mEditorNote.getId());</span>
                }
            }
        }
<span class="nc bnc" id="L946" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9559)) {</span>
            // don't open keyboard if not adding note
<span class="nc bnc" id="L948" title="All 2 branches missed.">            if (!mAddNote) {</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9558)) {</span>
<span class="nc" id="L950">                    this.getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_ALWAYS_HIDDEN);</span>
                }
            }
        }
<span class="nc bnc" id="L954" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9562)) {</span>
            // set focus to FieldEditText 'first' on startup like Anki desktop
<span class="nc bnc" id="L956" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9560) ? (mEditFields != null || !mEditFields.isEmpty()) : (mEditFields != null &amp;&amp; !mEditFields.isEmpty()))) {</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9561)) {</span>
<span class="nc" id="L958">                    mEditFields.getFirst().requestFocus();</span>
                }
            }
        }
<span class="nc" id="L962">    }</span>

    private void modifyCurrentSelection(Toolbar.TextFormatter formatter, FieldEditText textBox) {
        // get the current text and selection locations
<span class="nc" id="L966">        int selectionStart = textBox.getSelectionStart();</span>
<span class="nc" id="L967">        int selectionEnd = textBox.getSelectionEnd();</span>
        // #6762 values are reversed if using a keyboard and pressing Ctrl+Shift+LeftArrow
<span class="nc" id="L969">        int start = Math.min(selectionStart, selectionEnd);</span>
<span class="nc" id="L970">        int end = Math.max(selectionStart, selectionEnd);</span>
<span class="nc" id="L971">        String text = &quot;&quot;;</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9564)) {</span>
<span class="nc bnc" id="L973" title="All 2 branches missed.">            if (textBox.getText() != null) {</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9563)) {</span>
<span class="nc" id="L975">                    text = textBox.getText().toString();</span>
                }
            }
        }
        // Split the text in the places where the formatting will take place
<span class="nc" id="L980">        String beforeText = text.substring(0, start);</span>
<span class="nc" id="L981">        String selectedText = text.substring(start, end);</span>
<span class="nc" id="L982">        String afterText = text.substring(end);</span>
<span class="nc" id="L983">        Toolbar.TextWrapper.StringFormat formatResult = formatter.format(selectedText);</span>
<span class="nc" id="L984">        String newText = formatResult.result;</span>
        // Update text field with updated text and selection
<span class="nc bnc" id="L986" title="All 48 branches missed.">        int length = (ListenerUtil.mutListener.listen(9572) ? ((ListenerUtil.mutListener.listen(9568) ? (beforeText.length() % newText.length()) : (ListenerUtil.mutListener.listen(9567) ? (beforeText.length() / newText.length()) : (ListenerUtil.mutListener.listen(9566) ? (beforeText.length() * newText.length()) : (ListenerUtil.mutListener.listen(9565) ? (beforeText.length() - newText.length()) : (beforeText.length() + newText.length()))))) % afterText.length()) : (ListenerUtil.mutListener.listen(9571) ? ((ListenerUtil.mutListener.listen(9568) ? (beforeText.length() % newText.length()) : (ListenerUtil.mutListener.listen(9567) ? (beforeText.length() / newText.length()) : (ListenerUtil.mutListener.listen(9566) ? (beforeText.length() * newText.length()) : (ListenerUtil.mutListener.listen(9565) ? (beforeText.length() - newText.length()) : (beforeText.length() + newText.length()))))) / afterText.length()) : (ListenerUtil.mutListener.listen(9570) ? ((ListenerUtil.mutListener.listen(9568) ? (beforeText.length() % newText.length()) : (ListenerUtil.mutListener.listen(9567) ? (beforeText.length() / newText.length()) : (ListenerUtil.mutListener.listen(9566) ? (beforeText.length() * newText.length()) : (ListenerUtil.mutListener.listen(9565) ? (beforeText.length() - newText.length()) : (beforeText.length() + newText.length()))))) * afterText.length()) : (ListenerUtil.mutListener.listen(9569) ? ((ListenerUtil.mutListener.listen(9568) ? (beforeText.length() % newText.length()) : (ListenerUtil.mutListener.listen(9567) ? (beforeText.length() / newText.length()) : (ListenerUtil.mutListener.listen(9566) ? (beforeText.length() * newText.length()) : (ListenerUtil.mutListener.listen(9565) ? (beforeText.length() - newText.length()) : (beforeText.length() + newText.length()))))) - afterText.length()) : ((ListenerUtil.mutListener.listen(9568) ? (beforeText.length() % newText.length()) : (ListenerUtil.mutListener.listen(9567) ? (beforeText.length() / newText.length()) : (ListenerUtil.mutListener.listen(9566) ? (beforeText.length() * newText.length()) : (ListenerUtil.mutListener.listen(9565) ? (beforeText.length() - newText.length()) : (beforeText.length() + newText.length()))))) + afterText.length())))));</span>
<span class="nc" id="L987">        StringBuilder newValue = new StringBuilder(length).append(beforeText).append(newText).append(afterText);</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9573)) {</span>
<span class="nc" id="L989">            textBox.setText(newValue);</span>
        }
<span class="nc" id="L991">        int newStart = formatResult.start;</span>
<span class="nc" id="L992">        int newEnd = formatResult.end;</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9582)) {</span>
<span class="nc bnc" id="L994" title="All 16 branches missed.">            textBox.setSelection((ListenerUtil.mutListener.listen(9577) ? (start % newStart) : (ListenerUtil.mutListener.listen(9576) ? (start / newStart) : (ListenerUtil.mutListener.listen(9575) ? (start * newStart) : (ListenerUtil.mutListener.listen(9574) ? (start - newStart) : (start + newStart))))), (ListenerUtil.mutListener.listen(9581) ? (start % newEnd) : (ListenerUtil.mutListener.listen(9580) ? (start / newEnd) : (ListenerUtil.mutListener.listen(9579) ? (start * newEnd) : (ListenerUtil.mutListener.listen(9578) ? (start - newEnd) : (start + newEnd))))));</span>
        }
<span class="nc" id="L996">    }</span>

    @Override
    protected void onStop() {
<span class="nc bnc" id="L1000" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9583)) {</span>
<span class="nc" id="L1001">            super.onStop();</span>
        }
<span class="nc bnc" id="L1003" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9586)) {</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">            if (!isFinishing()) {</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9584)) {</span>
<span class="nc" id="L1006">                    WidgetStatus.update(this);</span>
                }
<span class="nc bnc" id="L1008" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9585)) {</span>
<span class="nc" id="L1009">                    UIUtils.saveCollectionInBackground();</span>
                }
            }
        }
<span class="nc" id="L1013">    }</span>

    @Override
    public boolean onKeyUp(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L1017" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9588)) {</span>
<span class="nc bnc" id="L1018" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9587) ? (mToolbar != null || mToolbar.onKeyUp(keyCode, event)) : (mToolbar != null &amp;&amp; mToolbar.onKeyUp(keyCode, event)))) {</span>
<span class="nc" id="L1019">                return true;</span>
            }
        }
<span class="nc bnc" id="L1022" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9610)) {</span>
<span class="nc bnc" id="L1023" title="All 8 branches missed.">            switch(keyCode) {</span>
                // both need to be captured for desktop keyboards
                case KeyEvent.KEYCODE_NUMPAD_ENTER:
                case KeyEvent.KEYCODE_ENTER:
<span class="nc bnc" id="L1027" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9590)) {</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">                        if (event.isCtrlPressed()) {</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9589)) {</span>
<span class="nc" id="L1030">                                saveNote();</span>
                            }
                        }
                    }
                    break;
                case KeyEvent.KEYCODE_D:
<span class="nc bnc" id="L1036" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9593)) {</span>
                        // null check in case Spinner is moved into options menu in the future
<span class="nc bnc" id="L1038" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9591) ? (event.isCtrlPressed() || (mNoteDeckSpinner != null)) : (event.isCtrlPressed() &amp;&amp; (mNoteDeckSpinner != null)))) {</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9592)) {</span>
<span class="nc" id="L1040">                                mNoteDeckSpinner.performClick();</span>
                            }
                        }
                    }
                    break;
                case KeyEvent.KEYCODE_L:
<span class="nc bnc" id="L1046" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9595)) {</span>
<span class="nc bnc" id="L1047" title="All 2 branches missed.">                        if (event.isCtrlPressed()) {</span>
<span class="nc bnc" id="L1048" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9594)) {</span>
<span class="nc" id="L1049">                                showCardTemplateEditor();</span>
                            }
                        }
                    }
                    break;
                case KeyEvent.KEYCODE_N:
<span class="nc bnc" id="L1055" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9598)) {</span>
<span class="nc bnc" id="L1056" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9596) ? (event.isCtrlPressed() || (mNoteTypeSpinner != null)) : (event.isCtrlPressed() &amp;&amp; (mNoteTypeSpinner != null)))) {</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9597)) {</span>
<span class="nc" id="L1058">                                mNoteTypeSpinner.performClick();</span>
                            }
                        }
                    }
                    break;
                case KeyEvent.KEYCODE_T:
<span class="nc bnc" id="L1064" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9601)) {</span>
<span class="nc bnc" id="L1065" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9599) ? (event.isCtrlPressed() || event.isShiftPressed()) : (event.isCtrlPressed() &amp;&amp; event.isShiftPressed()))) {</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9600)) {</span>
<span class="nc" id="L1067">                                showTagsDialog();</span>
                            }
                        }
                    }
                    break;
                case KeyEvent.KEYCODE_C:
                    {
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9606)) {</span>
<span class="nc bnc" id="L1075" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(9602) ? (event.isCtrlPressed() || event.isShiftPressed()) : (event.isCtrlPressed() &amp;&amp; event.isShiftPressed()))) {</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9603)) {</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">                                    insertCloze(event.isAltPressed() ? AddClozeType.SAME_NUMBER : AddClozeType.INCREMENT_NUMBER);</span>
                                }
<span class="nc bnc" id="L1079" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9605)) {</span>
                                    // Anki Desktop warns, but still inserts the cloze
<span class="nc bnc" id="L1081" title="All 2 branches missed.">                                    if (!isClozeType()) {</span>
<span class="nc bnc" id="L1082" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9604)) {</span>
<span class="nc" id="L1083">                                            UIUtils.showSimpleSnackbar(this, R.string.note_editor_insert_cloze_no_cloze_note_type, false);</span>
                                        }
                                    }
                                }
                            }
                        }
                        break;
                    }
                case KeyEvent.KEYCODE_P:
                    {
<span class="nc bnc" id="L1093" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9609)) {</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">                            if (event.isCtrlPressed()) {</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9607)) {</span>
<span class="nc" id="L1096">                                    Timber.i(&quot;Ctrl+P: Preview Pressed&quot;);</span>
                                }
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9608)) {</span>
<span class="nc" id="L1099">                                    performPreview();</span>
                                }
                            }
                        }
                        break;
                    }
                default:
                    break;
            }
        }
<span class="nc bnc" id="L1109" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9630)) {</span>
            // 7573: Ctrl+Shift+[Num] to select a field
<span class="nc bnc" id="L1111" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(9612) ? ((ListenerUtil.mutListener.listen(9611) ? (event.isCtrlPressed() || event.isShiftPressed()) : (event.isCtrlPressed() &amp;&amp; event.isShiftPressed())) || KeyUtils.isDigit(event)) : ((ListenerUtil.mutListener.listen(9611) ? (event.isCtrlPressed() || event.isShiftPressed()) : (event.isCtrlPressed() &amp;&amp; event.isShiftPressed())) &amp;&amp; KeyUtils.isDigit(event)))) {</span>
<span class="nc" id="L1112">                int digit = KeyUtils.getDigit(event);</span>
                // map: '0' -&gt; 9; '1' to 0
<span class="nc bnc" id="L1114" title="All 1248 branches missed.">                int indexBase10 = (ListenerUtil.mutListener.listen(9628) ? (((ListenerUtil.mutListener.listen(9624) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) % 10) : (ListenerUtil.mutListener.listen(9623) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) / 10) : (ListenerUtil.mutListener.listen(9622) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) * 10) : (ListenerUtil.mutListener.listen(9621) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) - 10) : ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) + 10)))))) / 10) : (ListenerUtil.mutListener.listen(9627) ? (((ListenerUtil.mutListener.listen(9624) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) % 10) : (ListenerUtil.mutListener.listen(9623) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) / 10) : (ListenerUtil.mutListener.listen(9622) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) * 10) : (ListenerUtil.mutListener.listen(9621) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) - 10) : ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) + 10)))))) * 10) : (ListenerUtil.mutListener.listen(9626) ? (((ListenerUtil.mutListener.listen(9624) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) % 10) : (ListenerUtil.mutListener.listen(9623) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) / 10) : (ListenerUtil.mutListener.listen(9622) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) * 10) : (ListenerUtil.mutListener.listen(9621) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) - 10) : ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) + 10)))))) - 10) : (ListenerUtil.mutListener.listen(9625) ? (((ListenerUtil.mutListener.listen(9624) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) % 10) : (ListenerUtil.mutListener.listen(9623) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) / 10) : (ListenerUtil.mutListener.listen(9622) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) * 10) : (ListenerUtil.mutListener.listen(9621) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) - 10) : ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) + 10)))))) + 10) : (((ListenerUtil.mutListener.listen(9624) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) % 10) : (ListenerUtil.mutListener.listen(9623) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) / 10) : (ListenerUtil.mutListener.listen(9622) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) * 10) : (ListenerUtil.mutListener.listen(9621) ? ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) - 10) : ((ListenerUtil.mutListener.listen(9620) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) / 10) : (ListenerUtil.mutListener.listen(9619) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) * 10) : (ListenerUtil.mutListener.listen(9618) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) - 10) : (ListenerUtil.mutListener.listen(9617) ? (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) + 10) : (((ListenerUtil.mutListener.listen(9616) ? (digit % 1) : (ListenerUtil.mutListener.listen(9615) ? (digit / 1) : (ListenerUtil.mutListener.listen(9614) ? (digit * 1) : (ListenerUtil.mutListener.listen(9613) ? (digit + 1) : (digit - 1)))))) % 10))))) + 10)))))) % 10)))));</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9629)) {</span>
<span class="nc" id="L1116">                    selectFieldIndex(indexBase10);</span>
                }
            }
        }
<span class="nc" id="L1120">        return super.onKeyUp(keyCode, event);</span>
    }

    private void selectFieldIndex(int index) {
<span class="nc bnc" id="L1124" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9631)) {</span>
<span class="nc" id="L1125">            Timber.i(&quot;Selecting field index %d&quot;, index);</span>
        }
<span class="nc bnc" id="L1127" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9644)) {</span>
<span class="nc bnc" id="L1128" title="All 90 branches missed.">            if ((ListenerUtil.mutListener.listen(9642) ? ((ListenerUtil.mutListener.listen(9636) ? (mEditFields.size() &gt;= index) : (ListenerUtil.mutListener.listen(9635) ? (mEditFields.size() &gt; index) : (ListenerUtil.mutListener.listen(9634) ? (mEditFields.size() &lt; index) : (ListenerUtil.mutListener.listen(9633) ? (mEditFields.size() != index) : (ListenerUtil.mutListener.listen(9632) ? (mEditFields.size() == index) : (mEditFields.size() &lt;= index)))))) &amp;&amp; (ListenerUtil.mutListener.listen(9641) ? (index &gt;= 0) : (ListenerUtil.mutListener.listen(9640) ? (index &lt;= 0) : (ListenerUtil.mutListener.listen(9639) ? (index &gt; 0) : (ListenerUtil.mutListener.listen(9638) ? (index != 0) : (ListenerUtil.mutListener.listen(9637) ? (index == 0) : (index &lt; 0))))))) : ((ListenerUtil.mutListener.listen(9636) ? (mEditFields.size() &gt;= index) : (ListenerUtil.mutListener.listen(9635) ? (mEditFields.size() &gt; index) : (ListenerUtil.mutListener.listen(9634) ? (mEditFields.size() &lt; index) : (ListenerUtil.mutListener.listen(9633) ? (mEditFields.size() != index) : (ListenerUtil.mutListener.listen(9632) ? (mEditFields.size() == index) : (mEditFields.size() &lt;= index)))))) || (ListenerUtil.mutListener.listen(9641) ? (index &gt;= 0) : (ListenerUtil.mutListener.listen(9640) ? (index &lt;= 0) : (ListenerUtil.mutListener.listen(9639) ? (index &gt; 0) : (ListenerUtil.mutListener.listen(9638) ? (index != 0) : (ListenerUtil.mutListener.listen(9637) ? (index == 0) : (index &lt; 0))))))))) {</span>
<span class="nc bnc" id="L1129" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9643)) {</span>
<span class="nc" id="L1130">                    Timber.i(&quot;Index out of range: %d&quot;, index);</span>
                }
<span class="nc" id="L1132">                return;</span>
            }
        }
        FieldEditText field;
        try {
<span class="nc" id="L1137">            field = mEditFields.get(index);</span>
<span class="nc" id="L1138">        } catch (IndexOutOfBoundsException e) {</span>
<span class="nc bnc" id="L1139" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9645)) {</span>
<span class="nc" id="L1140">                Timber.w(e, &quot;Error selecting index %d&quot;, index);</span>
            }
<span class="nc" id="L1142">            return;</span>
<span class="nc" id="L1143">        }</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9646)) {</span>
<span class="nc" id="L1145">            field.requestFocus();</span>
        }
<span class="nc bnc" id="L1147" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9647)) {</span>
<span class="nc" id="L1148">            Timber.d(&quot;Selected field&quot;);</span>
        }
<span class="nc" id="L1150">    }</span>

    private void insertCloze(AddClozeType addClozeType) {
<span class="nc" id="L1153">        View v = getCurrentFocus();</span>
<span class="nc bnc" id="L1154" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9648)) {</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">            if (!(v instanceof FieldEditText)) {</span>
<span class="nc" id="L1156">                return;</span>
            }
        }
<span class="nc" id="L1159">        FieldEditText editText = (FieldEditText) v;</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9649)) {</span>
<span class="nc" id="L1161">            convertSelectedTextToCloze(editText, addClozeType);</span>
        }
<span class="nc" id="L1163">    }</span>

    private void fetchIntentInformation(Intent intent) {
<span class="nc" id="L1166">        Bundle extras = intent.getExtras();</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9650)) {</span>
<span class="nc bnc" id="L1168" title="All 2 branches missed.">            if (extras == null) {</span>
<span class="nc" id="L1169">                return;</span>
            }
        }
<span class="nc bnc" id="L1172" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9651)) {</span>
<span class="nc" id="L1173">            mSourceText = new String[2];</span>
        }
<span class="nc bnc" id="L1175" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9659)) {</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">            if (ACTION_PROCESS_TEXT.equals(intent.getAction())) {</span>
<span class="nc" id="L1177">                String stringExtra = intent.getStringExtra(EXTRA_PROCESS_TEXT);</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9656)) {</span>
<span class="nc" id="L1179">                    Timber.d(&quot;Obtained %s from intent: %s&quot;, stringExtra, EXTRA_PROCESS_TEXT);</span>
                }
<span class="nc bnc" id="L1181" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9657)) {</span>
<span class="nc bnc" id="L1182" title="All 2 branches missed.">                    mSourceText[0] = stringExtra != null ? stringExtra : &quot;&quot;;</span>
                }
<span class="nc bnc" id="L1184" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9658)) {</span>
<span class="nc" id="L1185">                    mSourceText[1] = &quot;&quot;;</span>
                }
<span class="nc bnc" id="L1187" title="All 2 branches missed.">            } else if (ACTION_CREATE_FLASHCARD.equals(intent.getAction())) {</span>
<span class="nc bnc" id="L1188" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9654)) {</span>
                    // mTargetLanguage = extras.getString(TARGET_LANGUAGE);
<span class="nc" id="L1190">                    mSourceText[0] = extras.getString(SOURCE_TEXT);</span>
                }
<span class="nc bnc" id="L1192" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9655)) {</span>
<span class="nc" id="L1193">                    mSourceText[1] = extras.getString(TARGET_TEXT);</span>
                }
            } else {
                String first;
                String second;
<span class="nc bnc" id="L1198" title="All 2 branches missed.">                if (extras.getString(Intent.EXTRA_SUBJECT) != null) {</span>
<span class="nc" id="L1199">                    first = extras.getString(Intent.EXTRA_SUBJECT);</span>
                } else {
<span class="nc" id="L1201">                    first = &quot;&quot;;</span>
                }
<span class="nc bnc" id="L1203" title="All 2 branches missed.">                if (extras.getString(Intent.EXTRA_TEXT) != null) {</span>
<span class="nc" id="L1204">                    second = extras.getString(Intent.EXTRA_TEXT);</span>
                } else {
<span class="nc" id="L1206">                    second = &quot;&quot;;</span>
                }
                // Some users add cards via SEND intent from clipboard. In this case SUBJECT is empty
<span class="nc bnc" id="L1209" title="All 2 branches missed.">                if (&quot;&quot;.equals(first)) {</span>
                    // Assume that if only one field was sent then it should be the front
<span class="nc" id="L1211">                    first = second;</span>
<span class="nc" id="L1212">                    second = &quot;&quot;;</span>
                }
<span class="nc" id="L1214">                Pair&lt;String, String&gt; messages = new Pair&lt;&gt;(first, second);</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9652)) {</span>
<span class="nc" id="L1216">                    mSourceText[0] = messages.first;</span>
                }
<span class="nc bnc" id="L1218" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9653)) {</span>
<span class="nc" id="L1219">                    mSourceText[1] = messages.second;</span>
                }
            }
        }
<span class="nc" id="L1223">    }</span>

    private boolean addFromAedict(String extra_text) {
        String category;
<span class="nc" id="L1227">        String[] notepad_lines = extra_text.split(&quot;\n&quot;);</span>
        {
<span class="nc" id="L1229">            long _loopCounter152 = 0;</span>
<span class="nc bnc" id="L1230" title="All 22 branches missed.">            for (int i = 0; (ListenerUtil.mutListener.listen(9694) ? (i &gt;= notepad_lines.length) : (ListenerUtil.mutListener.listen(9693) ? (i &lt;= notepad_lines.length) : (ListenerUtil.mutListener.listen(9692) ? (i &gt; notepad_lines.length) : (ListenerUtil.mutListener.listen(9691) ? (i != notepad_lines.length) : (ListenerUtil.mutListener.listen(9690) ? (i == notepad_lines.length) : (i &lt; notepad_lines.length)))))); i++) {</span>
<span class="nc" id="L1231">                ListenerUtil.loopListener.listen(&quot;_loopCounter152&quot;, ++_loopCounter152);</span>
<span class="nc bnc" id="L1232" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(9660) ? (notepad_lines[i].startsWith(&quot;[&quot;) || notepad_lines[i].endsWith(&quot;]&quot;)) : (notepad_lines[i].startsWith(&quot;[&quot;) &amp;&amp; notepad_lines[i].endsWith(&quot;]&quot;)))) {</span>
<span class="nc bnc" id="L1233" title="All 8 branches missed.">                    category = notepad_lines[i].substring(1, (ListenerUtil.mutListener.listen(9664) ? (notepad_lines[i].length() % 1) : (ListenerUtil.mutListener.listen(9663) ? (notepad_lines[i].length() / 1) : (ListenerUtil.mutListener.listen(9662) ? (notepad_lines[i].length() * 1) : (ListenerUtil.mutListener.listen(9661) ? (notepad_lines[i].length() + 1) : (notepad_lines[i].length() - 1))))));</span>
<span class="nc bnc" id="L1234" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9689)) {</span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">                        if (&quot;default&quot;.equals(category)) {</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9687)) {</span>
<span class="nc bnc" id="L1237" title="All 70 branches missed.">                                if ((ListenerUtil.mutListener.listen(9673) ? (notepad_lines.length &gt;= (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))) : (ListenerUtil.mutListener.listen(9672) ? (notepad_lines.length &lt;= (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))) : (ListenerUtil.mutListener.listen(9671) ? (notepad_lines.length &lt; (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))) : (ListenerUtil.mutListener.listen(9670) ? (notepad_lines.length != (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))) : (ListenerUtil.mutListener.listen(9669) ? (notepad_lines.length == (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))) : (notepad_lines.length &gt; (ListenerUtil.mutListener.listen(9668) ? (i % 1) : (ListenerUtil.mutListener.listen(9667) ? (i / 1) : (ListenerUtil.mutListener.listen(9666) ? (i * 1) : (ListenerUtil.mutListener.listen(9665) ? (i - 1) : (i + 1)))))))))))) {</span>
<span class="nc bnc" id="L1238" title="All 8 branches missed.">                                    String[] entry_lines = notepad_lines[(ListenerUtil.mutListener.listen(9677) ? (i % 1) : (ListenerUtil.mutListener.listen(9676) ? (i / 1) : (ListenerUtil.mutListener.listen(9675) ? (i * 1) : (ListenerUtil.mutListener.listen(9674) ? (i - 1) : (i + 1)))))].split(&quot;:&quot;);</span>
<span class="nc bnc" id="L1239" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9686)) {</span>
<span class="nc bnc" id="L1240" title="All 22 branches missed.">                                        if ((ListenerUtil.mutListener.listen(9682) ? (entry_lines.length &gt;= 1) : (ListenerUtil.mutListener.listen(9681) ? (entry_lines.length &lt;= 1) : (ListenerUtil.mutListener.listen(9680) ? (entry_lines.length &lt; 1) : (ListenerUtil.mutListener.listen(9679) ? (entry_lines.length != 1) : (ListenerUtil.mutListener.listen(9678) ? (entry_lines.length == 1) : (entry_lines.length &gt; 1))))))) {</span>
<span class="nc bnc" id="L1241" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9683)) {</span>
<span class="nc" id="L1242">                                                mSourceText[0] = entry_lines[1];</span>
                                            }
<span class="nc bnc" id="L1244" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9684)) {</span>
<span class="nc" id="L1245">                                                mSourceText[1] = entry_lines[0];</span>
                                            }
<span class="nc bnc" id="L1247" title="All 2 branches missed.">                                            if (!ListenerUtil.mutListener.listen(9685)) {</span>
<span class="nc" id="L1248">                                                mAedictIntent = true;</span>
                                            }
<span class="nc" id="L1250">                                            return false;</span>
                                        }
                                    }
                                }
                            }
<span class="nc bnc" id="L1255" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9688)) {</span>
<span class="nc" id="L1256">                                UIUtils.showThemedToast(NoteEditor.this, getResources().getString(R.string.intent_aedict_empty), false);</span>
                            }
<span class="nc" id="L1258">                            return true;</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1264" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9695)) {</span>
<span class="nc" id="L1265">            UIUtils.showThemedToast(NoteEditor.this, getResources().getString(R.string.intent_aedict_category), false);</span>
        }
<span class="nc" id="L1267">        return true;</span>
    }

    private boolean hasUnsavedChanges() {
<span class="nc bnc" id="L1271" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9696)) {</span>
<span class="nc bnc" id="L1272" title="All 2 branches missed.">            if (!collectionHasLoaded()) {</span>
<span class="nc" id="L1273">                return false;</span>
            }
        }
<span class="nc bnc" id="L1276" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9699)) {</span>
            // changed note type?
<span class="nc bnc" id="L1278" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9697) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null))) {</span>
<span class="nc" id="L1279">                final JSONObject newModel = getCurrentlySelectedModel();</span>
<span class="nc" id="L1280">                final JSONObject oldModel = mCurrentEditedCard.model();</span>
<span class="nc bnc" id="L1281" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9698)) {</span>
<span class="nc bnc" id="L1282" title="All 2 branches missed.">                    if (!newModel.equals(oldModel)) {</span>
<span class="nc" id="L1283">                        return true;</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L1288" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9707)) {</span>
            // changed deck?
<span class="nc bnc" id="L1290" title="All 66 branches missed.">            if ((ListenerUtil.mutListener.listen(9706) ? ((ListenerUtil.mutListener.listen(9700) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null)) || (ListenerUtil.mutListener.listen(9705) ? (mCurrentEditedCard.getDid() &gt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9704) ? (mCurrentEditedCard.getDid() &lt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9703) ? (mCurrentEditedCard.getDid() &gt; mCurrentDid) : (ListenerUtil.mutListener.listen(9702) ? (mCurrentEditedCard.getDid() &lt; mCurrentDid) : (ListenerUtil.mutListener.listen(9701) ? (mCurrentEditedCard.getDid() == mCurrentDid) : (mCurrentEditedCard.getDid() != mCurrentDid))))))) : ((ListenerUtil.mutListener.listen(9700) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null)) &amp;&amp; (ListenerUtil.mutListener.listen(9705) ? (mCurrentEditedCard.getDid() &gt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9704) ? (mCurrentEditedCard.getDid() &lt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9703) ? (mCurrentEditedCard.getDid() &gt; mCurrentDid) : (ListenerUtil.mutListener.listen(9702) ? (mCurrentEditedCard.getDid() &lt; mCurrentDid) : (ListenerUtil.mutListener.listen(9701) ? (mCurrentEditedCard.getDid() == mCurrentDid) : (mCurrentEditedCard.getDid() != mCurrentDid))))))))) {</span>
<span class="nc" id="L1291">                return true;</span>
            }
        }
<span class="nc bnc" id="L1294" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9708)) {</span>
            // changed fields?
<span class="nc bnc" id="L1296" title="All 2 branches missed.">            if (mFieldEdited) {</span>
<span class="nc" id="L1297">                return true;</span>
            }
        }
        // changed tags?
<span class="nc" id="L1301">        return mTagsEdited;</span>
    }

    private boolean collectionHasLoaded() {
<span class="nc bnc" id="L1305" title="All 2 branches missed.">        return mAllModelIds != null;</span>
    }

    @VisibleForTesting
    void saveNote() {
<span class="nc" id="L1310">        final Resources res = getResources();</span>
<span class="nc bnc" id="L1311" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9710)) {</span>
<span class="nc bnc" id="L1312" title="All 2 branches missed.">            if (mSelectedTags == null) {</span>
<span class="nc bnc" id="L1313" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9709)) {</span>
<span class="nc" id="L1314">                    mSelectedTags = new ArrayList&lt;&gt;(0);</span>
                }
            }
        }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9766)) {</span>
            // treat add new note and edit existing note independently
<span class="nc bnc" id="L1320" title="All 2 branches missed.">            if (mAddNote) {</span>
<span class="nc bnc" id="L1321" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9755)) {</span>
                    // DEFECT: This does not block addition if cloze transpositions are in non-cloze fields.
<span class="nc bnc" id="L1323" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(9753) ? (isClozeType() || !hasClozeDeletions()) : (isClozeType() &amp;&amp; !hasClozeDeletions()))) {</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9754)) {</span>
<span class="nc" id="L1325">                            displayErrorSavingNote();</span>
                        }
<span class="nc" id="L1327">                        return;</span>
                    }
                }
<span class="nc bnc" id="L1330" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9757)) {</span>
                    {
<span class="nc" id="L1332">                        long _loopCounter155 = 0;</span>
                        // load all of the fields into the note
<span class="nc bnc" id="L1334" title="All 2 branches missed.">                        for (FieldEditText f : mEditFields) {</span>
<span class="nc" id="L1335">                            ListenerUtil.loopListener.listen(&quot;_loopCounter155&quot;, ++_loopCounter155);</span>
<span class="nc bnc" id="L1336" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9756)) {</span>
<span class="nc" id="L1337">                                updateField(f);</span>
                            }
<span class="nc" id="L1339">                        }</span>
                    }
                }
<span class="nc bnc" id="L1342" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9758)) {</span>
                    // Save deck to model
<span class="nc" id="L1344">                    mEditorNote.model().put(&quot;did&quot;, mCurrentDid);</span>
                }
<span class="nc bnc" id="L1346" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9759)) {</span>
                    // Save tags to model
<span class="nc" id="L1348">                    mEditorNote.setTagsFromStr(tagsAsString(mSelectedTags));</span>
                }
<span class="nc" id="L1350">                JSONArray tags = new JSONArray();</span>
<span class="nc bnc" id="L1351" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9761)) {</span>
                    {
<span class="nc" id="L1353">                        long _loopCounter156 = 0;</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                        for (String t : mSelectedTags) {</span>
<span class="nc" id="L1355">                            ListenerUtil.loopListener.listen(&quot;_loopCounter156&quot;, ++_loopCounter156);</span>
<span class="nc bnc" id="L1356" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9760)) {</span>
<span class="nc" id="L1357">                                tags.put(t);</span>
                            }
<span class="nc" id="L1359">                        }</span>
                    }
                }
<span class="nc bnc" id="L1362" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9762)) {</span>
<span class="nc" id="L1363">                    getCol().getModels().current().put(&quot;tags&quot;, tags);</span>
                }
<span class="nc bnc" id="L1365" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9763)) {</span>
<span class="nc" id="L1366">                    getCol().getModels().setChanged();</span>
                }
<span class="nc bnc" id="L1368" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9764)) {</span>
<span class="nc" id="L1369">                    mReloadRequired = true;</span>
                }
<span class="nc bnc" id="L1371" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9765)) {</span>
<span class="nc" id="L1372">                    TaskManager.launchCollectionTask(new CollectionTask.AddNote(mEditorNote), saveNoteHandler());</span>
                }
<span class="nc" id="L1374">            } else {</span>
                // Check whether note type has been changed
<span class="nc" id="L1376">                final Model newModel = getCurrentlySelectedModel();</span>
<span class="nc bnc" id="L1377" title="All 2 branches missed.">                final Model oldModel = (mCurrentEditedCard == null) ? null : mCurrentEditedCard.model();</span>
<span class="nc bnc" id="L1378" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9723)) {</span>
<span class="nc bnc" id="L1379" title="All 2 branches missed.">                    if (!newModel.equals(oldModel)) {</span>
<span class="nc bnc" id="L1380" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9711)) {</span>
<span class="nc" id="L1381">                            mReloadRequired = true;</span>
                        }
<span class="nc bnc" id="L1383" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9722)) {</span>
<span class="nc bnc" id="L1384" title="All 50 branches missed.">                            if ((ListenerUtil.mutListener.listen(9717) ? ((ListenerUtil.mutListener.listen(9716) ? (mModelChangeCardMap.size() &gt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9715) ? (mModelChangeCardMap.size() &lt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9714) ? (mModelChangeCardMap.size() &gt; mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9713) ? (mModelChangeCardMap.size() != mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9712) ? (mModelChangeCardMap.size() == mEditorNote.numberOfCards()) : (mModelChangeCardMap.size() &lt; mEditorNote.numberOfCards())))))) &amp;&amp; mModelChangeCardMap.containsValue(null)) : ((ListenerUtil.mutListener.listen(9716) ? (mModelChangeCardMap.size() &gt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9715) ? (mModelChangeCardMap.size() &lt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9714) ? (mModelChangeCardMap.size() &gt; mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9713) ? (mModelChangeCardMap.size() != mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(9712) ? (mModelChangeCardMap.size() == mEditorNote.numberOfCards()) : (mModelChangeCardMap.size() &lt; mEditorNote.numberOfCards())))))) || mModelChangeCardMap.containsValue(null)))) {</span>
                                // If cards will be lost via the new mapping then show a confirmation dialog before proceeding with the change
<span class="nc" id="L1386">                                ConfirmationDialog dialog = new ConfirmationDialog();</span>
<span class="nc bnc" id="L1387" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9719)) {</span>
<span class="nc" id="L1388">                                    dialog.setArgs(res.getString(R.string.confirm_map_cards_to_nothing));</span>
                                }
<span class="nc" id="L1390">                                Runnable confirm = () -&gt; {</span>
                                    // Bypass the check once the user confirms
<span class="nc" id="L1392">                                    changeNoteTypeWithErrorHandling(oldModel, newModel);</span>
<span class="nc" id="L1393">                                };</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9720)) {</span>
<span class="nc" id="L1395">                                    dialog.setConfirm(confirm);</span>
                                }
<span class="nc bnc" id="L1397" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9721)) {</span>
<span class="nc" id="L1398">                                    showDialogFragment(dialog);</span>
                                }
<span class="nc" id="L1400">                            } else {</span>
<span class="nc bnc" id="L1401" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9718)) {</span>
                                    // Otherwise go straight to changing note type
<span class="nc" id="L1403">                                    changeNoteTypeWithErrorHandling(oldModel, newModel);</span>
                                }
                            }
                        }
<span class="nc" id="L1407">                        return;</span>
                    }
                }
                // Regular changes in note content
<span class="nc" id="L1411">                boolean modified = false;</span>
<span class="nc bnc" id="L1412" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9736)) {</span>
                    // changed did? this has to be done first as remFromDyn() involves a direct write to the database
<span class="nc bnc" id="L1414" title="All 50 branches missed.">                    if ((ListenerUtil.mutListener.listen(9729) ? (mCurrentEditedCard != null || (ListenerUtil.mutListener.listen(9728) ? (mCurrentEditedCard.getDid() &gt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9727) ? (mCurrentEditedCard.getDid() &lt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9726) ? (mCurrentEditedCard.getDid() &gt; mCurrentDid) : (ListenerUtil.mutListener.listen(9725) ? (mCurrentEditedCard.getDid() &lt; mCurrentDid) : (ListenerUtil.mutListener.listen(9724) ? (mCurrentEditedCard.getDid() == mCurrentDid) : (mCurrentEditedCard.getDid() != mCurrentDid))))))) : (mCurrentEditedCard != null &amp;&amp; (ListenerUtil.mutListener.listen(9728) ? (mCurrentEditedCard.getDid() &gt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9727) ? (mCurrentEditedCard.getDid() &lt;= mCurrentDid) : (ListenerUtil.mutListener.listen(9726) ? (mCurrentEditedCard.getDid() &gt; mCurrentDid) : (ListenerUtil.mutListener.listen(9725) ? (mCurrentEditedCard.getDid() &lt; mCurrentDid) : (ListenerUtil.mutListener.listen(9724) ? (mCurrentEditedCard.getDid() == mCurrentDid) : (mCurrentEditedCard.getDid() != mCurrentDid))))))))) {</span>
<span class="nc bnc" id="L1415" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9730)) {</span>
<span class="nc" id="L1416">                            mReloadRequired = true;</span>
                        }
<span class="nc bnc" id="L1418" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9731)) {</span>
                            // remove card from filtered deck first (if relevant)
<span class="nc" id="L1420">                            getCol().getSched().remFromDyn(new long[] { mCurrentEditedCard.getId() });</span>
                        }
<span class="nc bnc" id="L1422" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9732)) {</span>
                            // refresh the card object to reflect the database changes in remFromDyn()
<span class="nc" id="L1424">                            mCurrentEditedCard.load();</span>
                        }
<span class="nc bnc" id="L1426" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9733)) {</span>
                            // also reload the note object
<span class="nc" id="L1428">                            mEditorNote = mCurrentEditedCard.note();</span>
                        }
<span class="nc bnc" id="L1430" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9734)) {</span>
                            // then set the card ID to the new deck
<span class="nc" id="L1432">                            mCurrentEditedCard.setDid(mCurrentDid);</span>
                        }
<span class="nc bnc" id="L1434" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9735)) {</span>
<span class="nc" id="L1435">                            modified = true;</span>
                        }
                    }
                }
<span class="nc bnc" id="L1439" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9738)) {</span>
                    {
<span class="nc" id="L1441">                        long _loopCounter153 = 0;</span>
                        // now load any changes to the fields from the form
<span class="nc bnc" id="L1443" title="All 2 branches missed.">                        for (FieldEditText f : mEditFields) {</span>
<span class="nc" id="L1444">                            ListenerUtil.loopListener.listen(&quot;_loopCounter153&quot;, ++_loopCounter153);</span>
<span class="nc bnc" id="L1445" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9737)) {</span>
<span class="nc" id="L1446">                                modified = modified | updateField(f);</span>
                            }
<span class="nc" id="L1448">                        }</span>
                    }
                }
<span class="nc bnc" id="L1451" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9741)) {</span>
                    {
<span class="nc" id="L1453">                        long _loopCounter154 = 0;</span>
                        // added tag?
<span class="nc bnc" id="L1455" title="All 2 branches missed.">                        for (String t : mSelectedTags) {</span>
<span class="nc" id="L1456">                            ListenerUtil.loopListener.listen(&quot;_loopCounter154&quot;, ++_loopCounter154);</span>
<span class="nc bnc" id="L1457" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9740)) {</span>
<span class="nc bnc" id="L1458" title="All 10 branches missed.">                                modified = (ListenerUtil.mutListener.listen(9739) ? (modified &amp;&amp; !mEditorNote.hasTag(t)) : (modified || !mEditorNote.hasTag(t)));</span>
                            }
<span class="nc" id="L1460">                        }</span>
                    }
                }
<span class="nc bnc" id="L1463" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9748)) {</span>
                    // removed tag?
<span class="nc bnc" id="L1465" title="All 50 branches missed.">                    modified = (ListenerUtil.mutListener.listen(9747) ? (modified &amp;&amp; (ListenerUtil.mutListener.listen(9746) ? (mEditorNote.getTags().size() &gt;= mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9745) ? (mEditorNote.getTags().size() &lt;= mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9744) ? (mEditorNote.getTags().size() &lt; mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9743) ? (mEditorNote.getTags().size() != mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9742) ? (mEditorNote.getTags().size() == mSelectedTags.size()) : (mEditorNote.getTags().size() &gt; mSelectedTags.size()))))))) : (modified || (ListenerUtil.mutListener.listen(9746) ? (mEditorNote.getTags().size() &gt;= mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9745) ? (mEditorNote.getTags().size() &lt;= mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9744) ? (mEditorNote.getTags().size() &lt; mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9743) ? (mEditorNote.getTags().size() != mSelectedTags.size()) : (ListenerUtil.mutListener.listen(9742) ? (mEditorNote.getTags().size() == mSelectedTags.size()) : (mEditorNote.getTags().size() &gt; mSelectedTags.size()))))))));</span>
                }
<span class="nc bnc" id="L1467" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9751)) {</span>
<span class="nc bnc" id="L1468" title="All 2 branches missed.">                    if (modified) {</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9749)) {</span>
<span class="nc" id="L1470">                            mEditorNote.setTagsFromStr(tagsAsString(mSelectedTags));</span>
                        }
<span class="nc bnc" id="L1472" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9750)) {</span>
<span class="nc" id="L1473">                            mChanged = true;</span>
                        }
                    }
                }
<span class="nc bnc" id="L1477" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9752)) {</span>
<span class="nc" id="L1478">                    closeNoteEditor();</span>
                }
            }
        }
<span class="nc" id="L1482">    }</span>

    /**
     * Change the note type from oldModel to newModel, handling the case where a full sync will be required
     */
    private void changeNoteTypeWithErrorHandling(final Model oldModel, final Model newModel) {
<span class="nc" id="L1488">        Resources res = getResources();</span>
        try {
<span class="nc bnc" id="L1490" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9770)) {</span>
<span class="nc" id="L1491">                changeNoteType(oldModel, newModel);</span>
            }
<span class="nc" id="L1493">        } catch (ConfirmModSchemaException e) {</span>
            // Libanki has determined we should ask the user to confirm first
<span class="nc" id="L1495">            ConfirmationDialog dialog = new ConfirmationDialog();</span>
<span class="nc bnc" id="L1496" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9767)) {</span>
<span class="nc" id="L1497">                dialog.setArgs(res.getString(R.string.full_sync_confirmation));</span>
            }
<span class="nc" id="L1499">            Runnable confirm = () -&gt; {</span>
                // Bypass the check once the user confirms
<span class="nc" id="L1501">                getCol().modSchemaNoCheck();</span>
                try {
<span class="nc" id="L1503">                    changeNoteType(oldModel, newModel);</span>
<span class="nc" id="L1504">                } catch (ConfirmModSchemaException e2) {</span>
                    // This should never be reached as we explicitly called modSchemaNoCheck()
<span class="nc" id="L1506">                    throw new RuntimeException(e2);</span>
<span class="nc" id="L1507">                }</span>
<span class="nc" id="L1508">            };</span>
<span class="nc bnc" id="L1509" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9768)) {</span>
<span class="nc" id="L1510">                dialog.setConfirm(confirm);</span>
            }
<span class="nc bnc" id="L1512" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(9769)) {</span>
<span class="nc" id="L1513">                showDialogFragment(dialog);</span>
            }
<span class="nc" id="L1515">        }</span>
<span class="nc" id="L1516">    }</span>

    /**
     * Change the note type from oldModel to newModel
     * @throws ConfirmModSchemaException If a full sync will be required
     */
    private void changeNoteType(Model oldModel, Model newModel) throws ConfirmModSchemaException {
<span class="nc" id="L1523">        final long noteId = mEditorNote.getId();</span>
<span class="nc bnc" id="L1524" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9771)) {</span>
<span class="nc" id="L1525">            getCol().getModels().change(oldModel, noteId, newModel, mModelChangeFieldMap, mModelChangeCardMap);</span>
        }
<span class="nc bnc" id="L1527" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9772)) {</span>
            // refresh the note object to reflect the database changes
<span class="nc" id="L1529">            mEditorNote.load();</span>
        }
<span class="nc bnc" id="L1531" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9773)) {</span>
            // close note editor
<span class="nc" id="L1533">            closeNoteEditor();</span>
        }
<span class="nc" id="L1535">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L1539" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9774)) {</span>
<span class="nc" id="L1540">            Timber.i(&quot;NoteEditor:: onBackPressed()&quot;);</span>
        }
<span class="nc bnc" id="L1542" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9775)) {</span>
<span class="nc" id="L1543">            closeCardEditorWithCheck();</span>
        }
<span class="nc" id="L1545">    }</span>

    @Override
    protected void onPause() {
<span class="nc bnc" id="L1549" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9776)) {</span>
            // remove the &quot;field language&quot; as it can't be reshown without a field reference
<span class="nc" id="L1551">            dismissAllDialogFragments();</span>
        }
<span class="nc bnc" id="L1553" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9777)) {</span>
<span class="nc" id="L1554">            super.onPause();</span>
        }
<span class="nc" id="L1556">    }</span>

    @Override
    protected void onResume() {
<span class="nc bnc" id="L1560" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9778)) {</span>
            // dismiss &quot;tags&quot; as it may have been attached after onPause is called
<span class="nc" id="L1562">            dismissAllDialogFragments();</span>
        }
<span class="nc bnc" id="L1564" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9779)) {</span>
<span class="nc" id="L1565">            super.onResume();</span>
        }
<span class="nc" id="L1567">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L1571" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9780)) {</span>
<span class="nc" id="L1572">            super.onDestroy();</span>
        }
<span class="nc bnc" id="L1574" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9782)) {</span>
<span class="nc bnc" id="L1575" title="All 2 branches missed.">            if (mUnmountReceiver != null) {</span>
<span class="nc bnc" id="L1576" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9781)) {</span>
<span class="nc" id="L1577">                    unregisterReceiver(mUnmountReceiver);</span>
                }
            }
        }
<span class="nc" id="L1581">    }</span>

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc bnc" id="L1585" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9783)) {</span>
<span class="nc" id="L1586">            getMenuInflater().inflate(R.menu.note_editor, menu);</span>
        }
<span class="nc bnc" id="L1588" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9786)) {</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">            if (mAddNote) {</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9785)) {</span>
<span class="nc" id="L1591">                    menu.findItem(R.id.action_copy_note).setVisible(false);</span>
                }
            } else {
<span class="nc bnc" id="L1594" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9784)) {</span>
<span class="nc" id="L1595">                    menu.findItem(R.id.action_add_note_from_note_editor).setVisible(true);</span>
                }
            }
        }
<span class="nc bnc" id="L1599" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9811)) {</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">            if (mEditFields != null) {</span>
<span class="nc bnc" id="L1601" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9810)) {</span>
                    {
<span class="nc" id="L1603">                        long _loopCounter157 = 0;</span>
<span class="nc bnc" id="L1604" title="All 22 branches missed.">                        for (int i = 0; (ListenerUtil.mutListener.listen(9809) ? (i &gt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(9808) ? (i &lt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(9807) ? (i &gt; mEditFields.size()) : (ListenerUtil.mutListener.listen(9806) ? (i != mEditFields.size()) : (ListenerUtil.mutListener.listen(9805) ? (i == mEditFields.size()) : (i &lt; mEditFields.size())))))); i++) {</span>
<span class="nc" id="L1605">                            ListenerUtil.loopListener.listen(&quot;_loopCounter157&quot;, ++_loopCounter157);</span>
<span class="nc" id="L1606">                            Editable fieldText = mEditFields.get(i).getText();</span>
<span class="nc bnc" id="L1607" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9804)) {</span>
<span class="nc bnc" id="L1608" title="All 50 branches missed.">                                if ((ListenerUtil.mutListener.listen(9792) ? (fieldText != null || (ListenerUtil.mutListener.listen(9791) ? (fieldText.length() &gt;= 0) : (ListenerUtil.mutListener.listen(9790) ? (fieldText.length() &lt;= 0) : (ListenerUtil.mutListener.listen(9789) ? (fieldText.length() &lt; 0) : (ListenerUtil.mutListener.listen(9788) ? (fieldText.length() != 0) : (ListenerUtil.mutListener.listen(9787) ? (fieldText.length() == 0) : (fieldText.length() &gt; 0))))))) : (fieldText != null &amp;&amp; (ListenerUtil.mutListener.listen(9791) ? (fieldText.length() &gt;= 0) : (ListenerUtil.mutListener.listen(9790) ? (fieldText.length() &lt;= 0) : (ListenerUtil.mutListener.listen(9789) ? (fieldText.length() &lt; 0) : (ListenerUtil.mutListener.listen(9788) ? (fieldText.length() != 0) : (ListenerUtil.mutListener.listen(9787) ? (fieldText.length() == 0) : (fieldText.length() &gt; 0))))))))) {</span>
<span class="nc bnc" id="L1609" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9803)) {</span>
<span class="nc" id="L1610">                                        menu.findItem(R.id.action_copy_note).setEnabled(true);</span>
                                    }
                                    break;
<span class="nc bnc" id="L1613" title="All 70 branches missed.">                                } else if ((ListenerUtil.mutListener.listen(9801) ? (i &gt;= (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))) : (ListenerUtil.mutListener.listen(9800) ? (i &lt;= (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))) : (ListenerUtil.mutListener.listen(9799) ? (i &gt; (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))) : (ListenerUtil.mutListener.listen(9798) ? (i &lt; (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))) : (ListenerUtil.mutListener.listen(9797) ? (i != (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))) : (i == (ListenerUtil.mutListener.listen(9796) ? (mEditFields.size() % 1) : (ListenerUtil.mutListener.listen(9795) ? (mEditFields.size() / 1) : (ListenerUtil.mutListener.listen(9794) ? (mEditFields.size() * 1) : (ListenerUtil.mutListener.listen(9793) ? (mEditFields.size() + 1) : (mEditFields.size() - 1)))))))))))) {</span>
<span class="nc bnc" id="L1614" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9802)) {</span>
<span class="nc" id="L1615">                                        menu.findItem(R.id.action_copy_note).setEnabled(false);</span>
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1624" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9812)) {</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">            menu.findItem(R.id.action_show_toolbar).setChecked(!shouldHideToolbar());</span>
        }
<span class="nc bnc" id="L1627" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9813)) {</span>
<span class="nc" id="L1628">            menu.findItem(R.id.action_capitalize).setChecked(AnkiDroidApp.getSharedPrefs(this).getBoolean(&quot;note_editor_capitalize&quot;, true));</span>
        }
<span class="nc" id="L1630">        return super.onCreateOptionsMenu(menu);</span>
    }

    protected static boolean shouldReplaceNewlines() {
<span class="nc" id="L1634">        return AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance()).getBoolean(&quot;noteEditorNewlineReplace&quot;, true);</span>
    }

    protected static boolean shouldHideToolbar() {
<span class="nc bnc" id="L1638" title="All 2 branches missed.">        return !AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance()).getBoolean(&quot;noteEditorShowToolbar&quot;, true);</span>
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L1643">        int itemId = item.getItemId();</span>
<span class="nc bnc" id="L1644" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9834)) {</span>
<span class="nc bnc" id="L1645" title="All 2 branches missed.">            if (itemId == android.R.id.home) {</span>
<span class="nc bnc" id="L1646" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9832)) {</span>
<span class="nc" id="L1647">                    Timber.i(&quot;NoteEditor:: Home button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1649" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9833)) {</span>
<span class="nc" id="L1650">                    closeCardEditorWithCheck();</span>
                }
<span class="nc" id="L1652">                return true;</span>
<span class="nc bnc" id="L1653" title="All 2 branches missed.">            } else if (itemId == R.id.action_preview) {</span>
<span class="nc bnc" id="L1654" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9830)) {</span>
<span class="nc" id="L1655">                    Timber.i(&quot;NoteEditor:: Preview button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1657" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9831)) {</span>
<span class="nc" id="L1658">                    performPreview();</span>
                }
<span class="nc" id="L1660">                return true;</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">            } else if (itemId == R.id.action_save) {</span>
<span class="nc bnc" id="L1662" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9828)) {</span>
<span class="nc" id="L1663">                    Timber.i(&quot;NoteEditor:: Save note button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1665" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9829)) {</span>
<span class="nc" id="L1666">                    saveNote();</span>
                }
<span class="nc" id="L1668">                return true;</span>
<span class="nc bnc" id="L1669" title="All 2 branches missed.">            } else if (itemId == R.id.action_add_note_from_note_editor) {</span>
<span class="nc bnc" id="L1670" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9826)) {</span>
<span class="nc" id="L1671">                    Timber.i(&quot;NoteEditor:: Add Note button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1673" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9827)) {</span>
<span class="nc" id="L1674">                    addNewNote();</span>
                }
<span class="nc" id="L1676">                return true;</span>
<span class="nc bnc" id="L1677" title="All 2 branches missed.">            } else if (itemId == R.id.action_copy_note) {</span>
<span class="nc bnc" id="L1678" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9824)) {</span>
<span class="nc" id="L1679">                    Timber.i(&quot;NoteEditor:: Copy Note button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1681" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9825)) {</span>
<span class="nc" id="L1682">                    copyNote();</span>
                }
<span class="nc" id="L1684">                return true;</span>
<span class="nc bnc" id="L1685" title="All 2 branches missed.">            } else if (itemId == R.id.action_font_size) {</span>
<span class="nc bnc" id="L1686" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9820)) {</span>
<span class="nc" id="L1687">                    Timber.i(&quot;NoteEditor:: Font Size button pressed&quot;);</span>
                }
<span class="nc" id="L1689">                IntegerDialog repositionDialog = new IntegerDialog();</span>
<span class="nc bnc" id="L1690" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9821)) {</span>
<span class="nc" id="L1691">                    repositionDialog.setArgs(getString(R.string.menu_font_size), getEditTextFontSize(), 2);</span>
                }
<span class="nc bnc" id="L1693" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9822)) {</span>
<span class="nc" id="L1694">                    repositionDialog.setCallbackRunnable(this::setFontSize);</span>
                }
<span class="nc bnc" id="L1696" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9823)) {</span>
<span class="nc" id="L1697">                    showDialogFragment(repositionDialog);</span>
                }
<span class="nc" id="L1699">                return true;</span>
<span class="nc bnc" id="L1700" title="All 2 branches missed.">            } else if (itemId == R.id.action_show_toolbar) {</span>
<span class="nc bnc" id="L1701" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9817)) {</span>
<span class="nc bnc" id="L1702" title="All 2 branches missed.">                    item.setChecked(!item.isChecked());</span>
                }
<span class="nc bnc" id="L1704" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9818)) {</span>
<span class="nc" id="L1705">                    AnkiDroidApp.getSharedPrefs(this).edit().putBoolean(&quot;noteEditorShowToolbar&quot;, item.isChecked()).apply();</span>
                }
<span class="nc bnc" id="L1707" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9819)) {</span>
<span class="nc" id="L1708">                    updateToolbar();</span>
                }
<span class="nc bnc" id="L1710" title="All 2 branches missed.">            } else if (itemId == R.id.action_capitalize) {</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9814)) {</span>
<span class="nc bnc" id="L1712" title="All 2 branches missed.">                    Timber.i(&quot;NoteEditor:: Capitalize button pressed. New State: %b&quot;, !item.isChecked());</span>
                }
<span class="nc bnc" id="L1714" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9815)) {</span>
                    // Needed for Android 9
<span class="nc bnc" id="L1716" title="All 2 branches missed.">                    item.setChecked(!item.isChecked());</span>
                }
<span class="nc bnc" id="L1718" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9816)) {</span>
<span class="nc" id="L1719">                    toggleCapitalize(item.isChecked());</span>
                }
<span class="nc" id="L1721">                return true;</span>
            }
        }
<span class="nc" id="L1724">        return super.onOptionsItemSelected(item);</span>
    }

    private void toggleCapitalize(boolean value) {
<span class="nc bnc" id="L1728" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9835)) {</span>
<span class="nc" id="L1729">            AnkiDroidApp.getSharedPrefs(this).edit().putBoolean(&quot;note_editor_capitalize&quot;, value).apply();</span>
        }
<span class="nc bnc" id="L1731" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9837)) {</span>
            {
<span class="nc" id="L1733">                long _loopCounter158 = 0;</span>
<span class="nc bnc" id="L1734" title="All 2 branches missed.">                for (FieldEditText f : mEditFields) {</span>
<span class="nc" id="L1735">                    ListenerUtil.loopListener.listen(&quot;_loopCounter158&quot;, ++_loopCounter158);</span>
<span class="nc bnc" id="L1736" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9836)) {</span>
<span class="nc" id="L1737">                        f.setCapitalize(value);</span>
                    }
<span class="nc" id="L1739">                }</span>
            }
        }
<span class="nc" id="L1742">    }</span>

    private void setFontSize(Integer fontSizeSp) {
<span class="nc bnc" id="L1745" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9844)) {</span>
<span class="nc bnc" id="L1746" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(9843) ? (fontSizeSp == null &amp;&amp; (ListenerUtil.mutListener.listen(9842) ? (fontSizeSp &gt;= 0) : (ListenerUtil.mutListener.listen(9841) ? (fontSizeSp &gt; 0) : (ListenerUtil.mutListener.listen(9840) ? (fontSizeSp &lt; 0) : (ListenerUtil.mutListener.listen(9839) ? (fontSizeSp != 0) : (ListenerUtil.mutListener.listen(9838) ? (fontSizeSp == 0) : (fontSizeSp &lt;= 0))))))) : (fontSizeSp == null || (ListenerUtil.mutListener.listen(9842) ? (fontSizeSp &gt;= 0) : (ListenerUtil.mutListener.listen(9841) ? (fontSizeSp &gt; 0) : (ListenerUtil.mutListener.listen(9840) ? (fontSizeSp &lt; 0) : (ListenerUtil.mutListener.listen(9839) ? (fontSizeSp != 0) : (ListenerUtil.mutListener.listen(9838) ? (fontSizeSp == 0) : (fontSizeSp &lt;= 0))))))))) {</span>
<span class="nc" id="L1747">                return;</span>
            }
        }
<span class="nc bnc" id="L1750" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9845)) {</span>
<span class="nc" id="L1751">            Timber.i(&quot;Setting font size to %d&quot;, fontSizeSp);</span>
        }
<span class="nc bnc" id="L1753" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9846)) {</span>
<span class="nc" id="L1754">            AnkiDroidApp.getSharedPrefs(this).edit().putInt(&quot;note_editor_font_size&quot;, fontSizeSp).apply();</span>
        }
<span class="nc bnc" id="L1756" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9848)) {</span>
            {
<span class="nc" id="L1758">                long _loopCounter159 = 0;</span>
<span class="nc bnc" id="L1759" title="All 2 branches missed.">                for (FieldEditText f : mEditFields) {</span>
<span class="nc" id="L1760">                    ListenerUtil.loopListener.listen(&quot;_loopCounter159&quot;, ++_loopCounter159);</span>
<span class="nc bnc" id="L1761" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9847)) {</span>
<span class="nc" id="L1762">                        f.setTextSize(fontSizeSp);</span>
                    }
<span class="nc" id="L1764">                }</span>
            }
        }
<span class="nc" id="L1767">    }</span>

    private String getEditTextFontSize() {
        // Values are setFontSize are whole when returned.
<span class="nc" id="L1771">        float sp = TextViewUtil.getTextSizeSp(mEditFields.getFirst());</span>
<span class="nc" id="L1772">        return Integer.toString(Math.round(sp));</span>
    }

    public void addNewNote() {
<span class="nc bnc" id="L1776" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9849)) {</span>
<span class="nc" id="L1777">            openNewNoteEditor(intent -&gt; {</span>
<span class="nc" id="L1778">            });</span>
        }
<span class="nc" id="L1780">    }</span>

    public void copyNote() {
<span class="nc bnc" id="L1783" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9850)) {</span>
<span class="nc" id="L1784">            openNewNoteEditor(intent -&gt; {</span>
<span class="nc" id="L1785">                intent.putExtra(EXTRA_CONTENTS, getFieldsText());</span>
<span class="nc bnc" id="L1786" title="All 2 branches missed.">                if (mSelectedTags != null) {</span>
<span class="nc" id="L1787">                    intent.putExtra(EXTRA_TAGS, mSelectedTags.toArray(new String[0]));</span>
                }
<span class="nc" id="L1789">            });</span>
        }
<span class="nc" id="L1791">    }</span>

    private void openNewNoteEditor(Consumer&lt;Intent&gt; intentEnricher) {
<span class="nc" id="L1794">        Intent intent = new Intent(NoteEditor.this, NoteEditor.class);</span>
<span class="nc bnc" id="L1795" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9851)) {</span>
<span class="nc" id="L1796">            intent.putExtra(EXTRA_CALLER, CALLER_CARDEDITOR);</span>
        }
<span class="nc bnc" id="L1798" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9852)) {</span>
<span class="nc" id="L1799">            intent.putExtra(EXTRA_DID, mCurrentDid);</span>
        }
<span class="nc bnc" id="L1801" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9853)) {</span>
            // mutate event with additional properties
<span class="nc" id="L1803">            intentEnricher.consume(intent);</span>
        }
<span class="nc bnc" id="L1805" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9854)) {</span>
<span class="nc" id="L1806">            startActivityForResultWithAnimation(intent, REQUEST_ADD, LEFT);</span>
        }
<span class="nc" id="L1808">    }</span>

    @VisibleForTesting
    void performPreview() {
<span class="nc" id="L1812">        Intent previewer = new Intent(NoteEditor.this, CardTemplatePreviewer.class);</span>
<span class="nc bnc" id="L1813" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9856)) {</span>
<span class="nc bnc" id="L1814" title="All 2 branches missed.">            if (mCurrentEditedCard != null) {</span>
<span class="nc bnc" id="L1815" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9855)) {</span>
<span class="nc" id="L1816">                    previewer.putExtra(&quot;ordinal&quot;, mCurrentEditedCard.getOrd());</span>
                }
            }
        }
<span class="nc bnc" id="L1820" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9857)) {</span>
<span class="nc" id="L1821">            previewer.putExtra(TemporaryModel.INTENT_MODEL_FILENAME, TemporaryModel.saveTempModel(this, mEditorNote.model()));</span>
        }
        // Send the previewer all our current editing information
<span class="nc" id="L1824">        Bundle noteEditorBundle = new Bundle();</span>
<span class="nc bnc" id="L1825" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9858)) {</span>
<span class="nc" id="L1826">            addInstanceStateToBundle(noteEditorBundle);</span>
        }
<span class="nc bnc" id="L1828" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9859)) {</span>
<span class="nc" id="L1829">            noteEditorBundle.putBundle(&quot;editFields&quot;, getFieldsAsBundleForPreview());</span>
        }
<span class="nc bnc" id="L1831" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9860)) {</span>
<span class="nc" id="L1832">            previewer.putExtra(&quot;noteEditorBundle&quot;, noteEditorBundle);</span>
        }
<span class="nc bnc" id="L1834" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9861)) {</span>
<span class="nc" id="L1835">            startActivityForResultWithoutAnimation(previewer, REQUEST_PREVIEW);</span>
        }
<span class="nc" id="L1837">    }</span>

    /**
     * finish when sd card is ejected
     */
    private void registerExternalStorageListener() {
<span class="nc bnc" id="L1843" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9868)) {</span>
<span class="nc bnc" id="L1844" title="All 2 branches missed.">            if (mUnmountReceiver == null) {</span>
<span class="nc bnc" id="L1845" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9865)) {</span>
<span class="nc" id="L1846">                    mUnmountReceiver = new BroadcastReceiver() {</span>

                        @Override
                        public void onReceive(Context context, Intent intent) {
<span class="nc bnc" id="L1850" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9864)) {</span>
<span class="nc bnc" id="L1851" title="All 10 branches missed.">                                if ((ListenerUtil.mutListener.listen(9862) ? (intent.getAction() != null || intent.getAction().equals(SdCardReceiver.MEDIA_EJECT)) : (intent.getAction() != null &amp;&amp; intent.getAction().equals(SdCardReceiver.MEDIA_EJECT)))) {</span>
<span class="nc bnc" id="L1852" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9863)) {</span>
<span class="nc" id="L1853">                                        finishWithoutAnimation();</span>
                                    }
                                }
                            }
<span class="nc" id="L1857">                        }</span>
                    };
                }
<span class="nc" id="L1860">                IntentFilter iFilter = new IntentFilter();</span>
<span class="nc bnc" id="L1861" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9866)) {</span>
<span class="nc" id="L1862">                    iFilter.addAction(SdCardReceiver.MEDIA_EJECT);</span>
                }
<span class="nc bnc" id="L1864" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9867)) {</span>
<span class="nc" id="L1865">                    registerReceiver(mUnmountReceiver, iFilter);</span>
                }
            }
        }
<span class="nc" id="L1869">    }</span>

    private void setTags(@NonNull String[] tags) {
<span class="nc bnc" id="L1872" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9869)) {</span>
<span class="nc" id="L1873">            mSelectedTags = new ArrayList&lt;&gt;(Arrays.asList(tags));</span>
        }
<span class="nc bnc" id="L1875" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9870)) {</span>
<span class="nc" id="L1876">            updateTags();</span>
        }
<span class="nc" id="L1878">    }</span>

    private void closeCardEditorWithCheck() {
<span class="nc bnc" id="L1881" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9873)) {</span>
<span class="nc bnc" id="L1882" title="All 2 branches missed.">            if (hasUnsavedChanges()) {</span>
<span class="nc bnc" id="L1883" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9872)) {</span>
<span class="nc" id="L1884">                    showDiscardChangesDialog();</span>
                }
            } else {
<span class="nc bnc" id="L1887" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9871)) {</span>
<span class="nc" id="L1888">                    closeNoteEditor();</span>
                }
            }
        }
<span class="nc" id="L1892">    }</span>

    private void showDiscardChangesDialog() {
<span class="nc bnc" id="L1895" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9874)) {</span>
<span class="nc" id="L1896">            DiscardChangesDialog.getDefault(this).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L1897">                Timber.i(&quot;NoteEditor:: OK button pressed to confirm discard changes&quot;);</span>
<span class="nc" id="L1898">                closeNoteEditor();</span>
<span class="nc" id="L1899">            }).build().show();</span>
        }
<span class="nc" id="L1901">    }</span>

    private void closeNoteEditor() {
<span class="nc bnc" id="L1904" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9875)) {</span>
<span class="nc" id="L1905">            closeNoteEditor(null);</span>
        }
<span class="nc" id="L1907">    }</span>

    private void closeNoteEditor(Intent intent) {
        int result;
<span class="nc bnc" id="L1911" title="All 2 branches missed.">        if (mChanged) {</span>
<span class="nc" id="L1912">            result = RESULT_OK;</span>
        } else {
<span class="nc" id="L1914">            result = RESULT_CANCELED;</span>
        }
<span class="nc bnc" id="L1916" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9877)) {</span>
<span class="nc bnc" id="L1917" title="All 2 branches missed.">            if (intent == null) {</span>
<span class="nc bnc" id="L1918" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9876)) {</span>
<span class="nc" id="L1919">                    intent = new Intent();</span>
                }
            }
        }
<span class="nc bnc" id="L1923" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9879)) {</span>
<span class="nc bnc" id="L1924" title="All 2 branches missed.">            if (mReloadRequired) {</span>
<span class="nc bnc" id="L1925" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9878)) {</span>
<span class="nc" id="L1926">                    intent.putExtra(&quot;reloadRequired&quot;, true);</span>
                }
            }
        }
<span class="nc bnc" id="L1930" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9881)) {</span>
<span class="nc bnc" id="L1931" title="All 2 branches missed.">            if (mChanged) {</span>
<span class="nc bnc" id="L1932" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9880)) {</span>
<span class="nc" id="L1933">                    intent.putExtra(&quot;noteChanged&quot;, true);</span>
                }
            }
        }
<span class="nc bnc" id="L1937" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9882)) {</span>
<span class="nc" id="L1938">            closeNoteEditor(result, intent);</span>
        }
<span class="nc" id="L1940">    }</span>

    private void closeNoteEditor(int result, @Nullable Intent intent) {
<span class="nc bnc" id="L1943" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9885)) {</span>
<span class="nc bnc" id="L1944" title="All 2 branches missed.">            if (intent != null) {</span>
<span class="nc bnc" id="L1945" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9884)) {</span>
<span class="nc" id="L1946">                    setResult(result, intent);</span>
                }
            } else {
<span class="nc bnc" id="L1949" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9883)) {</span>
<span class="nc" id="L1950">                    setResult(result);</span>
                }
            }
        }
<span class="nc bnc" id="L1954" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9886)) {</span>
            // ensure there are no orphans from possible edit previews
<span class="nc" id="L1956">            TemporaryModel.clearTempModelFiles();</span>
        }
<span class="nc bnc" id="L1958" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9894)) {</span>
<span class="nc bnc" id="L1959" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9891) ? (mCaller &gt;= CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9890) ? (mCaller &lt;= CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9889) ? (mCaller &gt; CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9888) ? (mCaller &lt; CALLER_CARDEDITOR_INTENT_ADD) : (ListenerUtil.mutListener.listen(9887) ? (mCaller != CALLER_CARDEDITOR_INTENT_ADD) : (mCaller == CALLER_CARDEDITOR_INTENT_ADD))))))) {</span>
<span class="nc bnc" id="L1960" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9893)) {</span>
<span class="nc" id="L1961">                    finishWithAnimation(NONE);</span>
                }
            } else {
<span class="nc bnc" id="L1964" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9892)) {</span>
<span class="nc" id="L1965">                    finishWithAnimation(RIGHT);</span>
                }
            }
        }
<span class="nc" id="L1969">    }</span>

    private void showTagsDialog() {
<span class="nc bnc" id="L1972" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9896)) {</span>
<span class="nc bnc" id="L1973" title="All 2 branches missed.">            if (mSelectedTags == null) {</span>
<span class="nc bnc" id="L1974" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9895)) {</span>
<span class="nc" id="L1975">                    mSelectedTags = new ArrayList&lt;&gt;(0);</span>
                }
            }
        }
<span class="nc" id="L1979">        ArrayList&lt;String&gt; tags = new ArrayList&lt;&gt;(getCol().getTags().all());</span>
<span class="nc" id="L1980">        ArrayList&lt;String&gt; selTags = new ArrayList&lt;&gt;(mSelectedTags);</span>
<span class="nc" id="L1981">        TagsDialog.TagsDialogListener tagsDialogListener = (selectedTags, option) -&gt; {</span>
<span class="nc bnc" id="L1982" title="All 2 branches missed.">            if (!mSelectedTags.equals(selectedTags)) {</span>
<span class="nc" id="L1983">                mTagsEdited = true;</span>
            }
<span class="nc" id="L1985">            mSelectedTags = selectedTags;</span>
<span class="nc" id="L1986">            updateTags();</span>
<span class="nc" id="L1987">        };</span>
<span class="nc" id="L1988">        TagsDialog dialog = TagsDialog.newInstance(TagsDialog.TYPE_ADD_TAG, selTags, tags);</span>
<span class="nc bnc" id="L1989" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9897)) {</span>
<span class="nc" id="L1990">            dialog.setTagsDialogListener(tagsDialogListener);</span>
        }
<span class="nc bnc" id="L1992" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9898)) {</span>
<span class="nc" id="L1993">            showDialogFragment(dialog);</span>
        }
<span class="nc" id="L1995">    }</span>

    private void showCardTemplateEditor() {
<span class="nc" id="L1998">        Intent intent = new Intent(this, CardTemplateEditor.class);</span>
<span class="nc bnc" id="L1999" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9899)) {</span>
            // Pass the model ID
<span class="nc" id="L2001">            intent.putExtra(&quot;modelId&quot;, getCurrentlySelectedModel().getLong(&quot;id&quot;));</span>
        }
<span class="nc bnc" id="L2003" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9900)) {</span>
<span class="nc" id="L2004">            Timber.d(&quot;showCardTemplateEditor() for model %s&quot;, intent.getLongExtra(&quot;modelId&quot;, NOT_FOUND_NOTE_TYPE));</span>
        }
<span class="nc bnc" id="L2006" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9906)) {</span>
            // Also pass the note id and ord if not adding new note
<span class="nc bnc" id="L2008" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(9901) ? (!mAddNote || mCurrentEditedCard != null) : (!mAddNote &amp;&amp; mCurrentEditedCard != null))) {</span>
<span class="nc bnc" id="L2009" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9902)) {</span>
<span class="nc" id="L2010">                    intent.putExtra(&quot;noteId&quot;, mCurrentEditedCard.note().getId());</span>
                }
<span class="nc bnc" id="L2012" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9903)) {</span>
<span class="nc" id="L2013">                    Timber.d(&quot;showCardTemplateEditor() with note %s&quot;, mCurrentEditedCard.note().getId());</span>
                }
<span class="nc bnc" id="L2015" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9904)) {</span>
<span class="nc" id="L2016">                    intent.putExtra(&quot;ordId&quot;, mCurrentEditedCard.getOrd());</span>
                }
<span class="nc bnc" id="L2018" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9905)) {</span>
<span class="nc" id="L2019">                    Timber.d(&quot;showCardTemplateEditor() with ord %s&quot;, mCurrentEditedCard.getOrd());</span>
                }
            }
        }
<span class="nc bnc" id="L2023" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9907)) {</span>
<span class="nc" id="L2024">            startActivityForResultWithAnimation(intent, REQUEST_TEMPLATE_EDIT, LEFT);</span>
        }
<span class="nc" id="L2026">    }</span>

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc bnc" id="L2030" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9908)) {</span>
<span class="nc" id="L2031">            Timber.d(&quot;onActivityResult() with request/result: %s/%s&quot;, requestCode, resultCode);</span>
        }
<span class="nc bnc" id="L2033" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9909)) {</span>
<span class="nc" id="L2034">            super.onActivityResult(requestCode, resultCode, data);</span>
        }
<span class="nc bnc" id="L2036" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9916)) {</span>
<span class="nc bnc" id="L2037" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9914) ? (resultCode &gt;= DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(9913) ? (resultCode &lt;= DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(9912) ? (resultCode &gt; DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(9911) ? (resultCode &lt; DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(9910) ? (resultCode != DeckPicker.RESULT_DB_ERROR) : (resultCode == DeckPicker.RESULT_DB_ERROR))))))) {</span>
<span class="nc bnc" id="L2038" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9915)) {</span>
<span class="nc" id="L2039">                    closeNoteEditor(DeckPicker.RESULT_DB_ERROR, null);</span>
                }
            }
        }
<span class="nc bnc" id="L2043" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9940)) {</span>
<span class="nc bnc" id="L2044" title="All 4 branches missed.">            switch(requestCode) {</span>
                case REQUEST_ADD:
                    {
<span class="nc bnc" id="L2047" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9918)) {</span>
<span class="nc bnc" id="L2048" title="All 2 branches missed.">                            if (resultCode != RESULT_CANCELED) {</span>
<span class="nc bnc" id="L2049" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9917)) {</span>
<span class="nc" id="L2050">                                    mChanged = true;</span>
                                }
                            }
                        }
                        break;
                    }
                case REQUEST_MULTIMEDIA_EDIT:
                    {
<span class="nc bnc" id="L2058" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9927)) {</span>
<span class="nc bnc" id="L2059" title="All 2 branches missed.">                            if (resultCode != RESULT_CANCELED) {</span>
<span class="nc" id="L2060">                                Collection col = getCol();</span>
<span class="nc" id="L2061">                                Bundle extras = data.getExtras();</span>
<span class="nc bnc" id="L2062" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9919)) {</span>
<span class="nc bnc" id="L2063" title="All 2 branches missed.">                                    if (extras == null) {</span>
<span class="nc" id="L2064">                                        break;</span>
                                    }
                                }
<span class="nc" id="L2067">                                int index = extras.getInt(MultimediaEditFieldActivity.EXTRA_RESULT_FIELD_INDEX);</span>
<span class="nc" id="L2068">                                IField field = (IField) extras.get(MultimediaEditFieldActivity.EXTRA_RESULT_FIELD);</span>
<span class="nc bnc" id="L2069" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9920)) {</span>
<span class="nc bnc" id="L2070" title="All 2 branches missed.">                                    if (field == null) {</span>
<span class="nc" id="L2071">                                        break;</span>
                                    }
                                }
<span class="nc" id="L2074">                                MultimediaEditableNote mNote = getCurrentMultimediaEditableNote(col);</span>
<span class="nc bnc" id="L2075" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9921)) {</span>
<span class="nc" id="L2076">                                    mNote.setField(index, field);</span>
                                }
<span class="nc" id="L2078">                                FieldEditText fieldEditText = mEditFields.get(index);</span>
                                // Completely replace text for text fields (because current text was passed in)
<span class="nc" id="L2080">                                String formattedValue = field.getFormattedValue();</span>
<span class="nc bnc" id="L2081" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9924)) {</span>
<span class="nc bnc" id="L2082" title="All 2 branches missed.">                                    if (field.getType() == EFieldType.TEXT) {</span>
<span class="nc bnc" id="L2083" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9923)) {</span>
<span class="nc" id="L2084">                                            fieldEditText.setText(formattedValue);</span>
                                        }
                                    } else // Insert text at cursor position if the field has focus
<span class="nc bnc" id="L2087" title="All 2 branches missed.">                                    if (fieldEditText.getText() != null) {</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9922)) {</span>
<span class="nc" id="L2089">                                            insertStringInField(fieldEditText, formattedValue);</span>
                                        }
                                    }
                                }
<span class="nc bnc" id="L2093" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9925)) {</span>
                                    // DA - I think we only want to save the field here, not the note.
<span class="nc" id="L2095">                                    NoteService.saveMedia(col, mNote);</span>
                                }
<span class="nc bnc" id="L2097" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9926)) {</span>
<span class="nc" id="L2098">                                    mChanged = true;</span>
                                }
<span class="nc" id="L2100">                            }</span>
                        }
                        break;
                    }
                case REQUEST_TEMPLATE_EDIT:
                    {
<span class="nc bnc" id="L2106" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9928)) {</span>
                            // Model can change regardless of exit type - update ourselves and CardBrowser
<span class="nc" id="L2108">                            mReloadRequired = true;</span>
                        }
<span class="nc bnc" id="L2110" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9929)) {</span>
<span class="nc" id="L2111">                            mEditorNote.reloadModel();</span>
                        }
<span class="nc bnc" id="L2113" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9939)) {</span>
<span class="nc bnc" id="L2114" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(9930) ? (mCurrentEditedCard == null &amp;&amp; !mEditorNote.cids().contains(mCurrentEditedCard.getId())) : (mCurrentEditedCard == null || !mEditorNote.cids().contains(mCurrentEditedCard.getId())))) {</span>
<span class="nc bnc" id="L2115" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9938)) {</span>
<span class="nc bnc" id="L2116" title="All 2 branches missed.">                                    if (!mAddNote) {</span>
<span class="nc bnc" id="L2117" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9935)) {</span>
                                            /* This can occur, for example, if the
                             * card type was deleted or if the note
                             * type was changed without moving this
                             * card to another type. */
<span class="nc" id="L2122">                                            Timber.d(&quot;onActivityResult() template edit return - current card is gone, close note editor&quot;);</span>
                                        }
<span class="nc bnc" id="L2124" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9936)) {</span>
<span class="nc" id="L2125">                                            UIUtils.showThemedToast(this, getString(R.string.template_for_current_card_deleted), false);</span>
                                        }
<span class="nc bnc" id="L2127" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9937)) {</span>
<span class="nc" id="L2128">                                            closeNoteEditor();</span>
                                        }
                                    } else {
<span class="nc bnc" id="L2131" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(9934)) {</span>
<span class="nc" id="L2132">                                            Timber.d(&quot;onActivityResult() template edit return, in add mode, just re-display&quot;);</span>
                                        }
                                    }
                                }
                            } else {
<span class="nc bnc" id="L2137" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9931)) {</span>
<span class="nc" id="L2138">                                    Timber.d(&quot;onActivityResult() template edit return - current card exists&quot;);</span>
                                }
<span class="nc bnc" id="L2140" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9932)) {</span>
                                    // reload current card - the template ordinals are possibly different post-edit
<span class="nc" id="L2142">                                    mCurrentEditedCard = getCol().getCard(mCurrentEditedCard.getId());</span>
                                }
<span class="nc bnc" id="L2144" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9933)) {</span>
<span class="nc" id="L2145">                                    updateCards(mEditorNote.model());</span>
                                }
                            }
                        }
                        break;
                    }
            }
        }
<span class="nc" id="L2153">    }</span>

    /**
     * Appends a string at the selection point, or appends to the end if not in focus
     */
    @VisibleForTesting
    void insertStringInField(EditText fieldEditText, String formattedValue) {
<span class="nc bnc" id="L2160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9943)) {</span>
<span class="nc bnc" id="L2161" title="All 2 branches missed.">            if (fieldEditText.hasFocus()) {</span>
                // Crashes if start &gt; end, although this is fine for a selection via keyboard.
<span class="nc" id="L2163">                int start = fieldEditText.getSelectionStart();</span>
<span class="nc" id="L2164">                int end = fieldEditText.getSelectionEnd();</span>
<span class="nc bnc" id="L2165" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9942)) {</span>
<span class="nc" id="L2166">                    fieldEditText.getText().replace(Math.min(start, end), Math.max(start, end), formattedValue);</span>
                }
<span class="nc" id="L2168">            } else // Append text if the field doesn't have focus</span>
            {
<span class="nc bnc" id="L2170" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9941)) {</span>
<span class="nc" id="L2171">                    fieldEditText.getText().append(formattedValue);</span>
                }
            }
        }
<span class="nc" id="L2175">    }</span>

    /**
     * @param col Readonly variable to get cache dir
     */
    private MultimediaEditableNote getCurrentMultimediaEditableNote(Collection col) {
<span class="nc" id="L2181">        MultimediaEditableNote mNote = NoteService.createEmptyNote(mEditorNote.model());</span>
<span class="nc" id="L2182">        String[] fields = getCurrentFieldStrings();</span>
<span class="nc bnc" id="L2183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9944)) {</span>
<span class="nc" id="L2184">            NoteService.updateMultimediaNoteFromFields(col, fields, mEditorNote.getMid(), mNote);</span>
        }
<span class="nc" id="L2186">        return mNote;</span>
    }

    public JSONArray getCurrentFields() {
<span class="nc" id="L2190">        return mEditorNote.model().getJSONArray(&quot;flds&quot;);</span>
    }

    @CheckResult
    public String[] getCurrentFieldStrings() {
<span class="nc bnc" id="L2195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9945)) {</span>
<span class="nc bnc" id="L2196" title="All 2 branches missed.">            if (mEditFields == null) {</span>
<span class="nc" id="L2197">                return new String[0];</span>
            }
        }
<span class="nc" id="L2200">        String[] ret = new String[mEditFields.size()];</span>
<span class="nc bnc" id="L2201" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9952)) {</span>
            {
<span class="nc" id="L2203">                long _loopCounter160 = 0;</span>
<span class="nc bnc" id="L2204" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(9951) ? (i &gt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(9950) ? (i &lt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(9949) ? (i &gt; mEditFields.size()) : (ListenerUtil.mutListener.listen(9948) ? (i != mEditFields.size()) : (ListenerUtil.mutListener.listen(9947) ? (i == mEditFields.size()) : (i &lt; mEditFields.size())))))); i++) {</span>
<span class="nc" id="L2205">                    ListenerUtil.loopListener.listen(&quot;_loopCounter160&quot;, ++_loopCounter160);</span>
<span class="nc bnc" id="L2206" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9946)) {</span>
<span class="nc" id="L2207">                        ret[i] = getCurrentFieldText(i);</span>
                    }
                }
            }
        }
<span class="nc" id="L2212">        return ret;</span>
    }

    private void populateEditFields(FieldChangeType type, boolean editModelMode) {
<span class="nc" id="L2216">        List&lt;FieldEditLine&gt; editLines = mFieldState.loadFieldEditLines(type);</span>
<span class="nc bnc" id="L2217" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9953)) {</span>
<span class="nc" id="L2218">            mFieldsLayoutContainer.removeAllViews();</span>
        }
<span class="nc bnc" id="L2220" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9954)) {</span>
<span class="nc" id="L2221">            mCustomViewIds.clear();</span>
        }
<span class="nc bnc" id="L2223" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9955)) {</span>
<span class="nc" id="L2224">            mEditFields = new LinkedList&lt;&gt;();</span>
        }
        // Use custom font if selected from preferences
<span class="nc" id="L2227">        Typeface mCustomTypeface = null;</span>
<span class="nc" id="L2228">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc" id="L2229">        String customFont = preferences.getString(&quot;browserEditorFont&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L2230" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9957)) {</span>
<span class="nc bnc" id="L2231" title="All 2 branches missed.">            if (!&quot;&quot;.equals(customFont)) {</span>
<span class="nc bnc" id="L2232" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9956)) {</span>
<span class="nc" id="L2233">                    mCustomTypeface = AnkiFont.getTypeface(this, customFont);</span>
                }
            }
        }
<span class="nc" id="L2237">        ClipboardManager clipboard = ContextCompat.getSystemService(this, ClipboardManager.class);</span>
<span class="nc" id="L2238">        FieldEditLine previous = null;</span>
<span class="nc bnc" id="L2239" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9958)) {</span>
<span class="nc" id="L2240">            mCustomViewIds.ensureCapacity(editLines.size());</span>
        }
<span class="nc bnc" id="L2242" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10020)) {</span>
            {
<span class="nc" id="L2244">                long _loopCounter161 = 0;</span>
<span class="nc bnc" id="L2245" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(10019) ? (i &gt;= editLines.size()) : (ListenerUtil.mutListener.listen(10018) ? (i &lt;= editLines.size()) : (ListenerUtil.mutListener.listen(10017) ? (i &gt; editLines.size()) : (ListenerUtil.mutListener.listen(10016) ? (i != editLines.size()) : (ListenerUtil.mutListener.listen(10015) ? (i == editLines.size()) : (i &lt; editLines.size())))))); i++) {</span>
<span class="nc" id="L2246">                    ListenerUtil.loopListener.listen(&quot;_loopCounter161&quot;, ++_loopCounter161);</span>
<span class="nc" id="L2247">                    FieldEditLine edit_line_view = editLines.get(i);</span>
<span class="nc bnc" id="L2248" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9959)) {</span>
<span class="nc" id="L2249">                        mCustomViewIds.add(edit_line_view.getId());</span>
                    }
<span class="nc" id="L2251">                    FieldEditText newTextbox = edit_line_view.getEditText();</span>
<span class="nc bnc" id="L2252" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9960)) {</span>
<span class="nc" id="L2253">                        newTextbox.setImagePasteListener(this::onImagePaste);</span>
                    }
<span class="nc bnc" id="L2255" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9975)) {</span>
<span class="nc bnc" id="L2256" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(9965) ? (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(9964) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(9963) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(9962) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(9961) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O))))))) {</span>
<span class="nc bnc" id="L2257" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9972)) {</span>
<span class="nc bnc" id="L2258" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(9970) ? (i &gt;= 0) : (ListenerUtil.mutListener.listen(9969) ? (i &lt;= 0) : (ListenerUtil.mutListener.listen(9968) ? (i &gt; 0) : (ListenerUtil.mutListener.listen(9967) ? (i &lt; 0) : (ListenerUtil.mutListener.listen(9966) ? (i != 0) : (i == 0))))))) {</span>
<span class="nc bnc" id="L2259" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9971)) {</span>
<span class="nc" id="L2260">                                        findViewById(R.id.note_deck_spinner).setNextFocusForwardId(newTextbox.getId());</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L2264" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9974)) {</span>
<span class="nc bnc" id="L2265" title="All 2 branches missed.">                                if (previous != null) {</span>
<span class="nc bnc" id="L2266" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(9973)) {</span>
<span class="nc" id="L2267">                                        previous.getLastViewInTabOrder().setNextFocusForwardId(newTextbox.getId());</span>
                                    }
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L2273" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9976)) {</span>
<span class="nc" id="L2274">                        previous = edit_line_view;</span>
                    }
<span class="nc bnc" id="L2276" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9977)) {</span>
<span class="nc" id="L2277">                        edit_line_view.setEnableAnimation(animationEnabled());</span>
                    }
<span class="nc bnc" id="L2279" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9984)) {</span>
                        // TODO: Remove the &gt;= M check - one callback works on API 11.
<span class="nc bnc" id="L2281" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(9982) ? (CompatHelper.getSdkVersion() &lt;= Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(9981) ? (CompatHelper.getSdkVersion() &gt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(9980) ? (CompatHelper.getSdkVersion() &lt; Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(9979) ? (CompatHelper.getSdkVersion() != Build.VERSION_CODES.M) : (ListenerUtil.mutListener.listen(9978) ? (CompatHelper.getSdkVersion() == Build.VERSION_CODES.M) : (CompatHelper.getSdkVersion() &gt;= Build.VERSION_CODES.M))))))) {</span>
                            // Use custom implementation of ActionMode.Callback customize selection and insert menus
<span class="nc" id="L2283">                            Field f = new Field(getFieldByIndex(i), getCol());</span>
<span class="nc" id="L2284">                            ActionModeCallback actionModeCallback = new ActionModeCallback(newTextbox, f);</span>
<span class="nc bnc" id="L2285" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9983)) {</span>
<span class="nc" id="L2286">                                edit_line_view.setActionModeCallbacks(actionModeCallback);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2290" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9985)) {</span>
<span class="nc" id="L2291">                        edit_line_view.setTypeface(mCustomTypeface);</span>
                    }
<span class="nc bnc" id="L2293" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9986)) {</span>
<span class="nc" id="L2294">                        edit_line_view.setHintLocale(getHintLocaleForField(edit_line_view.getName()));</span>
                    }
<span class="nc bnc" id="L2296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9987)) {</span>
<span class="nc bnc" id="L2297" title="All 2 branches missed.">                        initFieldEditText(newTextbox, i, !editModelMode);</span>
                    }
<span class="nc bnc" id="L2299" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9988)) {</span>
<span class="nc" id="L2300">                        mEditFields.add(newTextbox);</span>
                    }
<span class="nc" id="L2302">                    SharedPreferences prefs = AnkiDroidApp.getSharedPrefs(this);</span>
<span class="nc bnc" id="L2303" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9995)) {</span>
<span class="nc bnc" id="L2304" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(9993) ? (prefs.getInt(&quot;note_editor_font_size&quot;, -1) &gt;= 0) : (ListenerUtil.mutListener.listen(9992) ? (prefs.getInt(&quot;note_editor_font_size&quot;, -1) &lt;= 0) : (ListenerUtil.mutListener.listen(9991) ? (prefs.getInt(&quot;note_editor_font_size&quot;, -1) &lt; 0) : (ListenerUtil.mutListener.listen(9990) ? (prefs.getInt(&quot;note_editor_font_size&quot;, -1) != 0) : (ListenerUtil.mutListener.listen(9989) ? (prefs.getInt(&quot;note_editor_font_size&quot;, -1) == 0) : (prefs.getInt(&quot;note_editor_font_size&quot;, -1) &gt; 0))))))) {</span>
<span class="nc bnc" id="L2305" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9994)) {</span>
<span class="nc" id="L2306">                                newTextbox.setTextSize(prefs.getInt(&quot;note_editor_font_size&quot;, -1));</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2310" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9996)) {</span>
<span class="nc" id="L2311">                        newTextbox.setCapitalize(prefs.getBoolean(&quot;note_editor_capitalize&quot;, true));</span>
                    }
<span class="nc" id="L2313">                    ImageButton mediaButton = edit_line_view.getMediaButton();</span>
                    // Load icons from attributes
<span class="nc" id="L2315">                    int[] icons = Themes.getResFromAttr(this, new int[] { R.attr.attachFileImage, R.attr.upDownImage });</span>
<span class="nc bnc" id="L2316" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10004)) {</span>
                        // Make the icon change between media icon and switch field icon depending on whether editing note type
<span class="nc bnc" id="L2318" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(9997) ? (editModelMode || allowFieldRemapping()) : (editModelMode &amp;&amp; allowFieldRemapping()))) {</span>
<span class="nc bnc" id="L2319" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10002)) {</span>
                                // Allow remapping if originally more than two fields
<span class="nc" id="L2321">                                mediaButton.setBackgroundResource(icons[1]);</span>
                            }
<span class="nc bnc" id="L2323" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10003)) {</span>
<span class="nc" id="L2324">                                setRemapButtonListener(mediaButton, i);</span>
                            }
<span class="nc bnc" id="L2326" title="All 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(9998) ? (editModelMode || !allowFieldRemapping()) : (editModelMode &amp;&amp; !allowFieldRemapping()))) {</span>
<span class="nc bnc" id="L2327" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10001)) {</span>
<span class="nc" id="L2328">                                mediaButton.setBackgroundResource(0);</span>
                            }
                        } else {
<span class="nc bnc" id="L2331" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9999)) {</span>
                                // Use media editor button if not changing note type
<span class="nc" id="L2333">                                mediaButton.setBackgroundResource(icons[0]);</span>
                            }
<span class="nc bnc" id="L2335" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10000)) {</span>
<span class="nc" id="L2336">                                setMMButtonListener(mediaButton, i);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2340" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10012)) {</span>
<span class="nc bnc" id="L2341" title="All 50 branches missed.">                        if ((ListenerUtil.mutListener.listen(10010) ? ((ListenerUtil.mutListener.listen(10009) ? (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10008) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10007) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10006) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10005) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O)))))) || previous != null) : ((ListenerUtil.mutListener.listen(10009) ? (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10008) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10007) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10006) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(10005) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O)))))) &amp;&amp; previous != null))) {</span>
<span class="nc bnc" id="L2342" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10011)) {</span>
<span class="nc" id="L2343">                                previous.getLastViewInTabOrder().setNextFocusForwardId(R.id.CardEditorTagButton);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2347" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10013)) {</span>
<span class="nc" id="L2348">                        mediaButton.setContentDescription(getString(R.string.multimedia_editor_attach_mm_content, edit_line_view.getName()));</span>
                    }
<span class="nc bnc" id="L2350" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10014)) {</span>
<span class="nc" id="L2351">                        mFieldsLayoutContainer.addView(edit_line_view);</span>
                    }
                }
            }
        }
<span class="nc" id="L2356">    }</span>

    private boolean onImagePaste(EditText editText, Uri uri) {
        try {
<span class="nc bnc" id="L2360" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10026)) {</span>
<span class="nc bnc" id="L2361" title="All 2 branches missed.">                if (!mPastedImageCache.containsKey(uri.toString())) {</span>
<span class="nc bnc" id="L2362" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10025)) {</span>
<span class="nc" id="L2363">                        mPastedImageCache.put(uri.toString(), loadImageIntoCollection(uri));</span>
                    }
                }
            }
<span class="nc" id="L2367">            String imageTag = mPastedImageCache.get(uri.toString());</span>
<span class="nc bnc" id="L2368" title="All 2 branches missed.">            if (imageTag == null) {</span>
<span class="nc" id="L2369">                return false;</span>
            }
<span class="nc bnc" id="L2371" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10027)) {</span>
<span class="nc" id="L2372">                insertStringInField(editText, imageTag);</span>
            }
<span class="nc" id="L2374">            return true;</span>
<span class="nc" id="L2375">        } catch (SecurityException ex) {</span>
<span class="nc bnc" id="L2376" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10021)) {</span>
                // (pid=11262, uid=10455) that is not exported from UID 10057
<span class="nc" id="L2378">                Timber.w(ex, &quot;Failed to paste image&quot;);</span>
            }
<span class="nc" id="L2380">            return false;</span>
<span class="nc" id="L2381">        } catch (Exception e) {</span>
<span class="nc bnc" id="L2382" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10022)) {</span>
                // NOTE: This is happy path coding which works on Android 9.
<span class="nc" id="L2384">                AnkiDroidApp.sendExceptionReport(e, &quot;NoteEditor:onImagePaste&quot;);</span>
            }
<span class="nc bnc" id="L2386" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10023)) {</span>
<span class="nc" id="L2387">                Timber.w(e, &quot;Failed to paste image&quot;);</span>
            }
<span class="nc bnc" id="L2389" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10024)) {</span>
<span class="nc" id="L2390">                UIUtils.showThemedToast(this, getString(R.string.multimedia_editor_something_wrong), false);</span>
            }
<span class="nc" id="L2392">            return false;</span>
        }
    }

    /**
     * Loads an image into the collection.media folder and returns a HTML reference
     * @param uri The uri of the image to load
     * @return HTML referring to the loaded image
     */
    @Nullable
    private String loadImageIntoCollection(Uri uri) throws IOException {
        // noinspection PointlessArithmeticExpression
<span class="nc bnc" id="L2404" title="All 48 branches missed.">        final int oneMegabyte = (ListenerUtil.mutListener.listen(10035) ? ((ListenerUtil.mutListener.listen(10031) ? (1 % 1000) : (ListenerUtil.mutListener.listen(10030) ? (1 / 1000) : (ListenerUtil.mutListener.listen(10029) ? (1 - 1000) : (ListenerUtil.mutListener.listen(10028) ? (1 + 1000) : (1 * 1000))))) % 1000) : (ListenerUtil.mutListener.listen(10034) ? ((ListenerUtil.mutListener.listen(10031) ? (1 % 1000) : (ListenerUtil.mutListener.listen(10030) ? (1 / 1000) : (ListenerUtil.mutListener.listen(10029) ? (1 - 1000) : (ListenerUtil.mutListener.listen(10028) ? (1 + 1000) : (1 * 1000))))) / 1000) : (ListenerUtil.mutListener.listen(10033) ? ((ListenerUtil.mutListener.listen(10031) ? (1 % 1000) : (ListenerUtil.mutListener.listen(10030) ? (1 / 1000) : (ListenerUtil.mutListener.listen(10029) ? (1 - 1000) : (ListenerUtil.mutListener.listen(10028) ? (1 + 1000) : (1 * 1000))))) - 1000) : (ListenerUtil.mutListener.listen(10032) ? ((ListenerUtil.mutListener.listen(10031) ? (1 % 1000) : (ListenerUtil.mutListener.listen(10030) ? (1 / 1000) : (ListenerUtil.mutListener.listen(10029) ? (1 - 1000) : (ListenerUtil.mutListener.listen(10028) ? (1 + 1000) : (1 * 1000))))) + 1000) : ((ListenerUtil.mutListener.listen(10031) ? (1 % 1000) : (ListenerUtil.mutListener.listen(10030) ? (1 / 1000) : (ListenerUtil.mutListener.listen(10029) ? (1 - 1000) : (ListenerUtil.mutListener.listen(10028) ? (1 + 1000) : (1 * 1000))))) * 1000)))));</span>
<span class="nc" id="L2405">        String filename = ContentResolverUtil.getFileName(getContentResolver(), uri);</span>
<span class="nc" id="L2406">        InputStream fd = getContentResolver().openInputStream(uri);</span>
<span class="nc" id="L2407">        Map.Entry&lt;String, String&gt; fileNameAndExtension = FileUtil.getFileNameAndExtension(filename);</span>
<span class="nc" id="L2408">        File clipCopy = File.createTempFile(fileNameAndExtension.getKey(), fileNameAndExtension.getValue());</span>
<span class="nc" id="L2409">        String tempFilePath = clipCopy.getAbsolutePath();</span>
<span class="nc" id="L2410">        long bytesWritten = CompatHelper.getCompat().copyFile(fd, tempFilePath);</span>
<span class="nc bnc" id="L2411" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10036)) {</span>
<span class="nc" id="L2412">            Timber.d(&quot;File was %d bytes&quot;, bytesWritten);</span>
        }
<span class="nc bnc" id="L2414" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10045)) {</span>
<span class="nc bnc" id="L2415" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10041) ? (bytesWritten &gt;= oneMegabyte) : (ListenerUtil.mutListener.listen(10040) ? (bytesWritten &lt;= oneMegabyte) : (ListenerUtil.mutListener.listen(10039) ? (bytesWritten &lt; oneMegabyte) : (ListenerUtil.mutListener.listen(10038) ? (bytesWritten != oneMegabyte) : (ListenerUtil.mutListener.listen(10037) ? (bytesWritten == oneMegabyte) : (bytesWritten &gt; oneMegabyte))))))) {</span>
<span class="nc bnc" id="L2416" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10042)) {</span>
<span class="nc" id="L2417">                    Timber.w(&quot;File was too large: %d bytes&quot;, bytesWritten);</span>
                }
<span class="nc bnc" id="L2419" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10043)) {</span>
<span class="nc" id="L2420">                    UIUtils.showThemedToast(this, getString(R.string.note_editor_paste_too_large), false);</span>
                }
<span class="nc bnc" id="L2422" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10044)) {</span>
<span class="nc" id="L2423">                    new File(tempFilePath).delete();</span>
                }
<span class="nc" id="L2425">                return null;</span>
            }
        }
<span class="nc" id="L2428">        MultimediaEditableNote noteNew = new MultimediaEditableNote();</span>
<span class="nc bnc" id="L2429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10046)) {</span>
<span class="nc" id="L2430">            noteNew.setNumFields(1);</span>
        }
<span class="nc" id="L2432">        ImageField field = new ImageField();</span>
<span class="nc bnc" id="L2433" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10047)) {</span>
<span class="nc" id="L2434">            field.setHasTemporaryMedia(true);</span>
        }
<span class="nc bnc" id="L2436" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10048)) {</span>
<span class="nc" id="L2437">            field.setImagePath(tempFilePath);</span>
        }
<span class="nc bnc" id="L2439" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10049)) {</span>
<span class="nc" id="L2440">            noteNew.setField(0, field);</span>
        }
<span class="nc bnc" id="L2442" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10050)) {</span>
<span class="nc" id="L2443">            NoteService.saveMedia(getCol(), noteNew);</span>
        }
<span class="nc" id="L2445">        return field.getFormattedValue();</span>
    }

    private void setMMButtonListener(ImageButton mediaButton, final int index) {
<span class="nc bnc" id="L2449" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10051)) {</span>
<span class="nc" id="L2450">            mediaButton.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L2451">                Timber.i(&quot;NoteEditor:: Multimedia button pressed for field %d&quot;, index);</span>
<span class="nc bnc" id="L2452" title="All 2 branches missed.">                if (mEditorNote.items()[index][1].length() &gt; 0) {</span>
<span class="nc" id="L2453">                    final Collection col = CollectionHelper.getInstance().getCol(NoteEditor.this);</span>
                    // automatically
<span class="nc" id="L2455">                    IMultimediaEditableNote mNote = getCurrentMultimediaEditableNote(col);</span>
<span class="nc" id="L2456">                    startMultimediaFieldEditor(index, mNote);</span>
<span class="nc" id="L2457">                } else {</span>
                    // TODO: Update the icons for dark material theme, then can set 3rd argument to true
<span class="nc" id="L2459">                    PopupMenuWithIcons popup = new PopupMenuWithIcons(NoteEditor.this, v, false);</span>
<span class="nc" id="L2460">                    MenuInflater inflater = popup.getMenuInflater();</span>
<span class="nc" id="L2461">                    inflater.inflate(R.menu.popupmenu_multimedia_options, popup.getMenu());</span>
<span class="nc" id="L2462">                    popup.setOnMenuItemClickListener(item -&gt; {</span>
<span class="nc" id="L2463">                        int itemId = item.getItemId();</span>
<span class="nc bnc" id="L2464" title="All 2 branches missed.">                        if (itemId == R.id.menu_multimedia_audio) {</span>
<span class="nc" id="L2465">                            Timber.i(&quot;NoteEditor:: Record audio button pressed&quot;);</span>
<span class="nc" id="L2466">                            startMultimediaFieldEditorForField(index, new AudioRecordingField());</span>
<span class="nc" id="L2467">                            return true;</span>
<span class="nc bnc" id="L2468" title="All 2 branches missed.">                        } else if (itemId == R.id.menu_multimedia_audio_clip) {</span>
<span class="nc" id="L2469">                            Timber.i(&quot;NoteEditor:: Add audio clip button pressed&quot;);</span>
<span class="nc" id="L2470">                            startMultimediaFieldEditorForField(index, new AudioClipField());</span>
<span class="nc" id="L2471">                            return true;</span>
<span class="nc bnc" id="L2472" title="All 2 branches missed.">                        } else if (itemId == R.id.menu_multimedia_photo) {</span>
<span class="nc" id="L2473">                            Timber.i(&quot;NoteEditor:: Add image button pressed&quot;);</span>
<span class="nc" id="L2474">                            startMultimediaFieldEditorForField(index, new ImageField());</span>
<span class="nc" id="L2475">                            return true;</span>
<span class="nc bnc" id="L2476" title="All 2 branches missed.">                        } else if (itemId == R.id.menu_multimedia_text) {</span>
<span class="nc" id="L2477">                            Timber.i(&quot;NoteEditor:: Advanced editor button pressed&quot;);</span>
<span class="nc" id="L2478">                            startAdvancedTextEditor(index);</span>
<span class="nc" id="L2479">                            return true;</span>
<span class="nc bnc" id="L2480" title="All 2 branches missed.">                        } else if (itemId == R.id.menu_multimedia_clear_field) {</span>
<span class="nc" id="L2481">                            Timber.i(&quot;NoteEditor:: Clear field button pressed&quot;);</span>
<span class="nc" id="L2482">                            clearField(index);</span>
                        }
<span class="nc" id="L2484">                        return false;</span>
                    });
<span class="nc bnc" id="L2486" title="All 2 branches missed.">                    if (AdaptionUtil.isRestrictedLearningDevice()) {</span>
<span class="nc" id="L2487">                        popup.getMenu().findItem(R.id.menu_multimedia_photo).setVisible(false);</span>
<span class="nc" id="L2488">                        popup.getMenu().findItem(R.id.menu_multimedia_text).setVisible(false);</span>
                    }
<span class="nc" id="L2490">                    popup.show();</span>
                }
<span class="nc" id="L2492">            });</span>
        }
<span class="nc" id="L2494">    }</span>

    @VisibleForTesting
    void clearField(int index) {
<span class="nc bnc" id="L2498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10052)) {</span>
<span class="nc" id="L2499">            setFieldValueFromUi(index, &quot;&quot;);</span>
        }
<span class="nc" id="L2501">    }</span>

    private void startMultimediaFieldEditorForField(int index, IField field) {
<span class="nc" id="L2504">        Collection col = CollectionHelper.getInstance().getCol(NoteEditor.this);</span>
<span class="nc" id="L2505">        IMultimediaEditableNote mNote = getCurrentMultimediaEditableNote(col);</span>
<span class="nc bnc" id="L2506" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10053)) {</span>
<span class="nc" id="L2507">            mNote.setField(index, field);</span>
        }
<span class="nc bnc" id="L2509" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10054)) {</span>
<span class="nc" id="L2510">            startMultimediaFieldEditor(index, mNote);</span>
        }
<span class="nc" id="L2512">    }</span>

    private void setRemapButtonListener(ImageButton remapButton, final int newFieldIndex) {
<span class="nc bnc" id="L2515" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10055)) {</span>
<span class="nc" id="L2516">            remapButton.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L2517">                Timber.i(&quot;NoteEditor:: Remap button pressed for new field %d&quot;, newFieldIndex);</span>
                // Show list of fields from the original note which we can map to
<span class="nc" id="L2519">                PopupMenu popup = new PopupMenu(NoteEditor.this, v);</span>
<span class="nc" id="L2520">                final String[][] items = mEditorNote.items();</span>
                {
<span class="nc" id="L2522">                    long _loopCounter162 = 0;</span>
<span class="nc bnc" id="L2523" title="All 2 branches missed.">                    for (int i = 0; i &lt; items.length; i++) {</span>
<span class="nc" id="L2524">                        ListenerUtil.loopListener.listen(&quot;_loopCounter162&quot;, ++_loopCounter162);</span>
<span class="nc" id="L2525">                        popup.getMenu().add(Menu.NONE, i, Menu.NONE, items[i][0]);</span>
                    }
                }
                // Add &quot;nothing&quot; at the end of the list
<span class="nc" id="L2529">                popup.getMenu().add(Menu.NONE, items.length, Menu.NONE, R.string.nothing);</span>
<span class="nc" id="L2530">                popup.setOnMenuItemClickListener(item -&gt; {</span>
                    // Get menu item id
<span class="nc" id="L2532">                    int idx = item.getItemId();</span>
<span class="nc" id="L2533">                    Timber.i(&quot;NoteEditor:: User chose to remap to old field %d&quot;, idx);</span>
                    // Retrieve any existing mappings between newFieldIndex and idx
<span class="nc" id="L2535">                    Integer previousMapping = MapUtil.getKeyByValue(mModelChangeFieldMap, newFieldIndex);</span>
<span class="nc" id="L2536">                    Integer mappingConflict = mModelChangeFieldMap.get(idx);</span>
                    // Update the mapping depending on any conflicts
<span class="nc bnc" id="L2538" title="All 4 branches missed.">                    if (idx == items.length &amp;&amp; previousMapping != null) {</span>
                        // Remove the previous mapping if None selected
<span class="nc" id="L2540">                        mModelChangeFieldMap.remove(previousMapping);</span>
<span class="nc bnc" id="L2541" title="All 8 branches missed.">                    } else if (idx &lt; items.length &amp;&amp; mappingConflict != null &amp;&amp; previousMapping != null &amp;&amp; newFieldIndex != mappingConflict) {</span>
                        // Swap the two mappings if there was a conflict and previous mapping
<span class="nc" id="L2543">                        mModelChangeFieldMap.put(previousMapping, mappingConflict);</span>
<span class="nc" id="L2544">                        mModelChangeFieldMap.put(idx, newFieldIndex);</span>
<span class="nc bnc" id="L2545" title="All 4 branches missed.">                    } else if (idx &lt; items.length &amp;&amp; mappingConflict != null) {</span>
                        // Set the conflicting field to None if no previous mapping to swap into it
<span class="nc" id="L2547">                        mModelChangeFieldMap.remove(previousMapping);</span>
<span class="nc" id="L2548">                        mModelChangeFieldMap.put(idx, newFieldIndex);</span>
<span class="nc bnc" id="L2549" title="All 2 branches missed.">                    } else if (idx &lt; items.length) {</span>
                        // Can simply set the new mapping if no conflicts
<span class="nc" id="L2551">                        mModelChangeFieldMap.put(idx, newFieldIndex);</span>
                    }
                    // Reload the fields
<span class="nc" id="L2554">                    updateFieldsFromMap(getCurrentlySelectedModel());</span>
<span class="nc" id="L2555">                    return true;</span>
                });
<span class="nc" id="L2557">                popup.show();</span>
<span class="nc" id="L2558">            });</span>
        }
<span class="nc" id="L2560">    }</span>

    private void startMultimediaFieldEditor(final int index, IMultimediaEditableNote mNote) {
<span class="nc" id="L2563">        IField field = mNote.getField(index);</span>
<span class="nc" id="L2564">        Intent editCard = new Intent(NoteEditor.this, MultimediaEditFieldActivity.class);</span>
<span class="nc bnc" id="L2565" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10056)) {</span>
<span class="nc" id="L2566">            editCard.putExtra(MultimediaEditFieldActivity.EXTRA_FIELD_INDEX, index);</span>
        }
<span class="nc bnc" id="L2568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10057)) {</span>
<span class="nc" id="L2569">            editCard.putExtra(MultimediaEditFieldActivity.EXTRA_FIELD, field);</span>
        }
<span class="nc bnc" id="L2571" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10058)) {</span>
<span class="nc" id="L2572">            editCard.putExtra(MultimediaEditFieldActivity.EXTRA_WHOLE_NOTE, mNote);</span>
        }
<span class="nc bnc" id="L2574" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10059)) {</span>
<span class="nc" id="L2575">            startActivityForResultWithoutAnimation(editCard, REQUEST_MULTIMEDIA_EDIT);</span>
        }
<span class="nc" id="L2577">    }</span>

    private void initFieldEditText(FieldEditText editText, final int index, boolean enabled) {
<span class="nc bnc" id="L2580" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10060)) {</span>
            // Listen for changes in the first field so we can re-check duplicate status.
<span class="nc" id="L2582">            editText.addTextChangedListener(new EditFieldTextWatcher(index));</span>
        }
<span class="nc bnc" id="L2584" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10067)) {</span>
<span class="nc bnc" id="L2585" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10065) ? (index &gt;= 0) : (ListenerUtil.mutListener.listen(10064) ? (index &lt;= 0) : (ListenerUtil.mutListener.listen(10063) ? (index &gt; 0) : (ListenerUtil.mutListener.listen(10062) ? (index &lt; 0) : (ListenerUtil.mutListener.listen(10061) ? (index != 0) : (index == 0))))))) {</span>
<span class="nc bnc" id="L2586" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10066)) {</span>
<span class="nc" id="L2587">                    editText.setOnFocusChangeListener((v, hasFocus) -&gt; {</span>
                        try {
<span class="nc bnc" id="L2589" title="All 2 branches missed.">                            if (hasFocus) {</span>
                                // we only want to decorate when we lose focus
<span class="nc" id="L2591">                                return;</span>
                            }
<span class="nc" id="L2593">                            String[] currentFieldStrings = getCurrentFieldStrings();</span>
<span class="nc bnc" id="L2594" title="All 4 branches missed.">                            if (currentFieldStrings.length != 2 || currentFieldStrings[1].length() &gt; 0) {</span>
                                // we only decorate on 2-field cards while second field is still empty
<span class="nc" id="L2596">                                return;</span>
                            }
<span class="nc" id="L2598">                            String firstField = currentFieldStrings[0];</span>
<span class="nc" id="L2599">                            String decoratedText = NoteFieldDecorator.aplicaHuevo(firstField);</span>
<span class="nc bnc" id="L2600" title="All 2 branches missed.">                            if (!decoratedText.equals(firstField)) {</span>
                                // we only apply the decoration if it is actually different from the first field
<span class="nc" id="L2602">                                setFieldValueFromUi(1, decoratedText);</span>
                            }
<span class="nc" id="L2604">                        } catch (Exception e) {</span>
<span class="nc" id="L2605">                            Timber.w(e, &quot;Unable to decorate text field&quot;);</span>
<span class="nc" id="L2606">                        }</span>
<span class="nc" id="L2607">                    });</span>
                }
            }
        }
<span class="nc bnc" id="L2611" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10068)) {</span>
<span class="nc" id="L2612">            editText.setEnabled(enabled);</span>
        }
<span class="nc" id="L2614">    }</span>

    private Locale getHintLocaleForField(String name) {
<span class="nc" id="L2617">        JSONObject field = getFieldByName(name);</span>
<span class="nc bnc" id="L2618" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10069)) {</span>
<span class="nc bnc" id="L2619" title="All 2 branches missed.">            if (field == null) {</span>
<span class="nc" id="L2620">                return null;</span>
            }
        }
<span class="nc" id="L2623">        String languageTag = field.optString(&quot;ad-hint-locale&quot;, null);</span>
<span class="nc bnc" id="L2624" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10070)) {</span>
<span class="nc bnc" id="L2625" title="All 2 branches missed.">            if (languageTag == null) {</span>
<span class="nc" id="L2626">                return null;</span>
            }
        }
<span class="nc" id="L2629">        return Locale.forLanguageTag(languageTag);</span>
    }

    @NonNull
    private JSONObject getFieldByIndex(int index) {
<span class="nc" id="L2634">        return this.getCurrentlySelectedModel().getJSONArray(&quot;flds&quot;).getJSONObject(index);</span>
    }

    @Nullable
    private JSONObject getFieldByName(String name) {
        Pair&lt;Integer, JSONObject&gt; pair;
        try {
<span class="nc" id="L2641">            pair = Models.fieldMap(this.getCurrentlySelectedModel()).get(name);</span>
<span class="nc" id="L2642">        } catch (Exception e) {</span>
<span class="nc bnc" id="L2643" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10071)) {</span>
<span class="nc" id="L2644">                Timber.w(&quot;Failed to obtain field '%s'&quot;, name);</span>
            }
<span class="nc" id="L2646">            return null;</span>
<span class="nc" id="L2647">        }</span>
<span class="nc bnc" id="L2648" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10072)) {</span>
<span class="nc bnc" id="L2649" title="All 2 branches missed.">            if (pair == null) {</span>
<span class="nc" id="L2650">                return null;</span>
            }
        }
<span class="nc" id="L2653">        return pair.second;</span>
    }

    private void setEditFieldTexts(String contents) {
<span class="nc" id="L2657">        String[] fields = null;</span>
        int len;
<span class="nc bnc" id="L2659" title="All 2 branches missed.">        if (contents == null) {</span>
<span class="nc" id="L2660">            len = 0;</span>
        } else {
<span class="nc bnc" id="L2662" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10073)) {</span>
<span class="nc" id="L2663">                fields = Utils.splitFields(contents);</span>
            }
<span class="nc" id="L2665">            len = fields.length;</span>
        }
<span class="nc bnc" id="L2667" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10087)) {</span>
            {
<span class="nc" id="L2669">                long _loopCounter163 = 0;</span>
<span class="nc bnc" id="L2670" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(10086) ? (i &gt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(10085) ? (i &lt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(10084) ? (i &gt; mEditFields.size()) : (ListenerUtil.mutListener.listen(10083) ? (i != mEditFields.size()) : (ListenerUtil.mutListener.listen(10082) ? (i == mEditFields.size()) : (i &lt; mEditFields.size())))))); i++) {</span>
<span class="nc" id="L2671">                    ListenerUtil.loopListener.listen(&quot;_loopCounter163&quot;, ++_loopCounter163);</span>
<span class="nc bnc" id="L2672" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10081)) {</span>
<span class="nc bnc" id="L2673" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(10078) ? (i &gt;= len) : (ListenerUtil.mutListener.listen(10077) ? (i &lt;= len) : (ListenerUtil.mutListener.listen(10076) ? (i &gt; len) : (ListenerUtil.mutListener.listen(10075) ? (i != len) : (ListenerUtil.mutListener.listen(10074) ? (i == len) : (i &lt; len))))))) {</span>
<span class="nc bnc" id="L2674" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10080)) {</span>
<span class="nc" id="L2675">                                mEditFields.get(i).setText(fields[i]);</span>
                            }
                        } else {
<span class="nc bnc" id="L2678" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10079)) {</span>
<span class="nc" id="L2679">                                mEditFields.get(i).setText(&quot;&quot;);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L2686">    }</span>

    private void setDuplicateFieldStyles() {
<span class="nc" id="L2689">        FieldEditText field = mEditFields.get(0);</span>
        // Keep copy of current internal value for this field.
<span class="nc" id="L2691">        String oldValue = mEditorNote.getFields()[0];</span>
<span class="nc bnc" id="L2692" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10088)) {</span>
            // Update the field in the Note so we can run a dupe check on it.
<span class="nc" id="L2694">            updateField(field);</span>
        }
        // 1 is empty, 2 is dupe, null is neither.
<span class="nc" id="L2697">        Note.DupeOrEmpty dupeCode = mEditorNote.dupeOrEmpty();</span>
<span class="nc bnc" id="L2698" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10091)) {</span>
            // Change bottom line color of text field
<span class="nc bnc" id="L2700" title="All 2 branches missed.">            if (dupeCode == Note.DupeOrEmpty.DUPE) {</span>
<span class="nc bnc" id="L2701" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10090)) {</span>
<span class="nc" id="L2702">                    field.setDupeStyle();</span>
                }
            } else {
<span class="nc bnc" id="L2705" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10089)) {</span>
<span class="nc" id="L2706">                    field.setDefaultStyle();</span>
                }
            }
        }
<span class="nc bnc" id="L2710" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10092)) {</span>
            // Put back the old value so we don't interfere with modification detection
<span class="nc" id="L2712">            mEditorNote.values()[0] = oldValue;</span>
        }
<span class="nc" id="L2714">    }</span>

    private String getFieldsText() {
<span class="nc" id="L2717">        String[] fields = new String[mEditFields.size()];</span>
<span class="nc bnc" id="L2718" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10099)) {</span>
            {
<span class="nc" id="L2720">                long _loopCounter164 = 0;</span>
<span class="nc bnc" id="L2721" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(10098) ? (i &gt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(10097) ? (i &lt;= mEditFields.size()) : (ListenerUtil.mutListener.listen(10096) ? (i &gt; mEditFields.size()) : (ListenerUtil.mutListener.listen(10095) ? (i != mEditFields.size()) : (ListenerUtil.mutListener.listen(10094) ? (i == mEditFields.size()) : (i &lt; mEditFields.size())))))); i++) {</span>
<span class="nc" id="L2722">                    ListenerUtil.loopListener.listen(&quot;_loopCounter164&quot;, ++_loopCounter164);</span>
<span class="nc bnc" id="L2723" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10093)) {</span>
<span class="nc" id="L2724">                        fields[i] = getCurrentFieldText(i);</span>
                    }
                }
            }
        }
<span class="nc" id="L2729">        return Utils.joinFields(fields);</span>
    }

    /**
     * Returns the value of the field at the given index
     */
    private String getCurrentFieldText(int index) {
<span class="nc" id="L2736">        Editable fieldText = mEditFields.get(index).getText();</span>
<span class="nc bnc" id="L2737" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10100)) {</span>
<span class="nc bnc" id="L2738" title="All 2 branches missed.">            if (fieldText == null) {</span>
<span class="nc" id="L2739">                return &quot;&quot;;</span>
            }
        }
<span class="nc" id="L2742">        return fieldText.toString();</span>
    }

    private void setDid(Note note) {
<span class="nc bnc" id="L2746" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10106)) {</span>
            // where the target deck was already decided by the user.
<span class="nc bnc" id="L2748" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10105) ? (mCurrentDid &gt;= 0) : (ListenerUtil.mutListener.listen(10104) ? (mCurrentDid &lt;= 0) : (ListenerUtil.mutListener.listen(10103) ? (mCurrentDid &gt; 0) : (ListenerUtil.mutListener.listen(10102) ? (mCurrentDid &lt; 0) : (ListenerUtil.mutListener.listen(10101) ? (mCurrentDid == 0) : (mCurrentDid != 0))))))) {</span>
<span class="nc" id="L2749">                return;</span>
            }
        }
<span class="nc bnc" id="L2752" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10115)) {</span>
<span class="nc bnc" id="L2753" title="All 26 branches missed.">            if ((ListenerUtil.mutListener.listen(10108) ? ((ListenerUtil.mutListener.listen(10107) ? (note == null &amp;&amp; mAddNote) : (note == null || mAddNote)) &amp;&amp; mCurrentEditedCard == null) : ((ListenerUtil.mutListener.listen(10107) ? (note == null &amp;&amp; mAddNote) : (note == null || mAddNote)) || mCurrentEditedCard == null))) {</span>
<span class="nc" id="L2754">                JSONObject conf = getCol().getConf();</span>
<span class="nc" id="L2755">                JSONObject model = getCol().getModels().current();</span>
<span class="nc bnc" id="L2756" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10114)) {</span>
<span class="nc bnc" id="L2757" title="All 2 branches missed.">                    if (conf.optBoolean(&quot;addToCur&quot;, true)) {</span>
<span class="nc bnc" id="L2758" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(10111)) {</span>
<span class="nc" id="L2759">                            mCurrentDid = conf.getLong(&quot;curDeck&quot;);</span>
                        }
<span class="nc bnc" id="L2761" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(10113)) {</span>
<span class="nc bnc" id="L2762" title="All 2 branches missed.">                            if (getCol().getDecks().isDyn(mCurrentDid)) {</span>
<span class="nc bnc" id="L2763" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(10112)) {</span>
                                    /*
                     * If the deck in mCurrentDid is a filtered (dynamic) deck, then we can't create cards in it,
                     * and we set mCurrentDid to the Default deck. Otherwise, we keep the number that had been
                     * selected previously in the activity.
                     */
<span class="nc" id="L2769">                                    mCurrentDid = 1;</span>
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L2774" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(10110)) {</span>
<span class="nc" id="L2775">                            mCurrentDid = model.getLong(&quot;did&quot;);</span>
                        }
                    }
                }
<span class="nc" id="L2779">            } else {</span>
<span class="nc bnc" id="L2780" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10109)) {</span>
<span class="nc" id="L2781">                    mCurrentDid = mCurrentEditedCard.getDid();</span>
                }
            }
        }
<span class="nc" id="L2785">    }</span>

    /**
     * Refreshes the UI using the currently selected model as a template
     */
    private void refreshNoteData(@NonNull FieldChangeType changeType) {
<span class="nc bnc" id="L2791" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10116)) {</span>
<span class="nc" id="L2792">            setNote(null, changeType);</span>
        }
<span class="nc" id="L2794">    }</span>

    /**
     * Handles setting the current note (non-null afterwards) and rebuilding the UI based on this note
     */
    private void setNote(Note note, @NonNull FieldChangeType changeType) {
<span class="nc bnc" id="L2800" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10120)) {</span>
<span class="nc bnc" id="L2801" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(10117) ? (note == null &amp;&amp; mAddNote) : (note == null || mAddNote))) {</span>
<span class="nc" id="L2802">                Model model = getCol().getModels().current();</span>
<span class="nc bnc" id="L2803" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10119)) {</span>
<span class="nc" id="L2804">                    mEditorNote = new Note(getCol(), model);</span>
                }
<span class="nc" id="L2806">            } else {</span>
<span class="nc bnc" id="L2807" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10118)) {</span>
<span class="nc" id="L2808">                    mEditorNote = note;</span>
                }
            }
        }
<span class="nc bnc" id="L2812" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10122)) {</span>
<span class="nc bnc" id="L2813" title="All 2 branches missed.">            if (mSelectedTags == null) {</span>
<span class="nc bnc" id="L2814" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10121)) {</span>
<span class="nc" id="L2815">                    mSelectedTags = mEditorNote.getTags();</span>
                }
            }
        }
<span class="nc bnc" id="L2819" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10123)) {</span>
            // nb: setOnItemSelectedListener and populateEditFields need to occur after this
<span class="nc" id="L2821">            setNoteTypePosition();</span>
        }
<span class="nc bnc" id="L2823" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10124)) {</span>
<span class="nc" id="L2824">            updateDeckPosition();</span>
        }
<span class="nc bnc" id="L2826" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10125)) {</span>
<span class="nc" id="L2827">            updateTags();</span>
        }
<span class="nc bnc" id="L2829" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10126)) {</span>
<span class="nc" id="L2830">            updateCards(mEditorNote.model());</span>
        }
<span class="nc bnc" id="L2832" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10127)) {</span>
<span class="nc" id="L2833">            updateToolbar();</span>
        }
<span class="nc bnc" id="L2835" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10128)) {</span>
<span class="nc" id="L2836">            populateEditFields(changeType, false);</span>
        }
<span class="nc" id="L2838">    }</span>

    private void updateToolbar() {
<span class="nc bnc" id="L2841" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10129)) {</span>
<span class="nc bnc" id="L2842" title="All 2 branches missed.">            if (mToolbar == null) {</span>
<span class="nc" id="L2843">                return;</span>
            }
        }
<span class="nc" id="L2846">        View editorLayout = findViewById(R.id.note_editor_layout);</span>
<span class="nc bnc" id="L2847" title="All 2 branches missed.">        int bottomMargin = shouldHideToolbar() ? 0 : (int) getResources().getDimension(R.dimen.note_editor_toolbar_height);</span>
<span class="nc" id="L2848">        MarginLayoutParams params = (MarginLayoutParams) editorLayout.getLayoutParams();</span>
<span class="nc bnc" id="L2849" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10130)) {</span>
<span class="nc" id="L2850">            params.bottomMargin = bottomMargin;</span>
        }
<span class="nc bnc" id="L2852" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10131)) {</span>
<span class="nc" id="L2853">            editorLayout.setLayoutParams(params);</span>
        }
<span class="nc bnc" id="L2855" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10134)) {</span>
<span class="nc bnc" id="L2856" title="All 2 branches missed.">            if (shouldHideToolbar()) {</span>
<span class="nc bnc" id="L2857" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10133)) {</span>
<span class="nc" id="L2858">                    mToolbar.setVisibility(View.GONE);</span>
                }
<span class="nc" id="L2860">                return;</span>
            } else {
<span class="nc bnc" id="L2862" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10132)) {</span>
<span class="nc" id="L2863">                    mToolbar.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L2867" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10135)) {</span>
<span class="nc" id="L2868">            mToolbar.clearCustomItems();</span>
        }
<span class="nc" id="L2870">        View clozeIcon = mToolbar.getClozeIcon();</span>
<span class="nc bnc" id="L2871" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10139)) {</span>
<span class="nc bnc" id="L2872" title="All 2 branches missed.">            if (mEditorNote.model().isCloze()) {</span>
<span class="nc" id="L2873">                Toolbar.TextFormatter clozeFormatter = s -&gt; {</span>
<span class="nc" id="L2874">                    Toolbar.TextWrapper.StringFormat stringFormat = new Toolbar.TextWrapper.StringFormat();</span>
<span class="nc" id="L2875">                    String prefix = &quot;{{c&quot; + getNextClozeIndex() + &quot;::&quot;;</span>
<span class="nc" id="L2876">                    stringFormat.result = prefix + s + &quot;}}&quot;;</span>
<span class="nc bnc" id="L2877" title="All 2 branches missed.">                    if (s.length() == 0) {</span>
<span class="nc" id="L2878">                        stringFormat.start = prefix.length();</span>
<span class="nc" id="L2879">                        stringFormat.end = prefix.length();</span>
                    } else {
<span class="nc" id="L2881">                        stringFormat.start = 0;</span>
<span class="nc" id="L2882">                        stringFormat.end = stringFormat.result.length();</span>
                    }
<span class="nc" id="L2884">                    return stringFormat;</span>
                };
<span class="nc bnc" id="L2886" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10137)) {</span>
<span class="nc" id="L2887">                    clozeIcon.setOnClickListener(l -&gt; mToolbar.onFormat(clozeFormatter));</span>
                }
<span class="nc bnc" id="L2889" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10138)) {</span>
<span class="nc" id="L2890">                    clozeIcon.setVisibility(View.VISIBLE);</span>
                }
<span class="nc" id="L2892">            } else {</span>
<span class="nc bnc" id="L2893" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10136)) {</span>
<span class="nc" id="L2894">                    clozeIcon.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc" id="L2898">        ArrayList&lt;CustomToolbarButton&gt; buttons = getToolbarButtons();</span>
<span class="nc bnc" id="L2899" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10150)) {</span>
            {
<span class="nc" id="L2901">                long _loopCounter165 = 0;</span>
<span class="nc bnc" id="L2902" title="All 2 branches missed.">                for (CustomToolbarButton b : buttons) {</span>
<span class="nc" id="L2903">                    ListenerUtil.loopListener.listen(&quot;_loopCounter165&quot;, ++_loopCounter165);</span>
                    // 0th button shows as '1' and is Ctrl + 1
<span class="nc bnc" id="L2905" title="All 8 branches missed.">                    int visualIndex = (ListenerUtil.mutListener.listen(10143) ? (b.getIndex() % 1) : (ListenerUtil.mutListener.listen(10142) ? (b.getIndex() / 1) : (ListenerUtil.mutListener.listen(10141) ? (b.getIndex() * 1) : (ListenerUtil.mutListener.listen(10140) ? (b.getIndex() - 1) : (b.getIndex() + 1)))));</span>
<span class="nc" id="L2906">                    String text = Integer.toString(visualIndex);</span>
<span class="nc" id="L2907">                    Drawable bmp = mToolbar.createDrawableForString(text);</span>
<span class="nc" id="L2908">                    View v = mToolbar.insertItem(0, bmp, b.toFormatter());</span>
<span class="nc bnc" id="L2909" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10148)) {</span>
                        // Allow Ctrl + 1...Ctrl + 0 for item 10.
<span class="nc bnc" id="L2911" title="All 8 branches missed.">                        v.setTag(Integer.toString((ListenerUtil.mutListener.listen(10147) ? (visualIndex / 10) : (ListenerUtil.mutListener.listen(10146) ? (visualIndex * 10) : (ListenerUtil.mutListener.listen(10145) ? (visualIndex - 10) : (ListenerUtil.mutListener.listen(10144) ? (visualIndex + 10) : (visualIndex % 10)))))));</span>
                    }
<span class="nc bnc" id="L2913" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10149)) {</span>
<span class="nc" id="L2914">                        v.setOnLongClickListener(discard -&gt; {</span>
<span class="nc" id="L2915">                            suggestRemoveButton(b);</span>
<span class="nc" id="L2916">                            return true;</span>
                        });
                    }
<span class="nc" id="L2919">                }</span>
            }
        }
<span class="nc bnc" id="L2922" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10151)) {</span>
            // Let the user add more buttons (always at the end).
<span class="nc" id="L2924">            mToolbar.insertItem(0, R.drawable.ic_add_toolbar_icon, this::displayAddToolbarDialog);</span>
        }
<span class="nc" id="L2926">    }</span>

    @NonNull
    private ArrayList&lt;CustomToolbarButton&gt; getToolbarButtons() {
<span class="nc" id="L2930">        Set&lt;String&gt; set = AnkiDroidApp.getSharedPrefs(this).getStringSet(&quot;note_editor_custom_buttons&quot;, new HashSet&lt;&gt;(0));</span>
<span class="nc" id="L2931">        return CustomToolbarButton.fromStringSet(set);</span>
    }

    private void saveToolbarButtons(ArrayList&lt;CustomToolbarButton&gt; buttons) {
<span class="nc bnc" id="L2935" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10152)) {</span>
<span class="nc" id="L2936">            AnkiDroidApp.getSharedPrefs(this).edit().putStringSet(&quot;note_editor_custom_buttons&quot;, CustomToolbarButton.toStringSet(buttons)).apply();</span>
        }
<span class="nc" id="L2938">    }</span>

    private void addToolbarButton(String prefix, String suffix) {
<span class="nc bnc" id="L2941" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10154)) {</span>
<span class="nc bnc" id="L2942" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(10153) ? (TextUtils.isEmpty(prefix) || TextUtils.isEmpty(suffix)) : (TextUtils.isEmpty(prefix) &amp;&amp; TextUtils.isEmpty(suffix)))) {</span>
<span class="nc" id="L2943">                return;</span>
            }
        }
<span class="nc" id="L2946">        ArrayList&lt;CustomToolbarButton&gt; toolbarButtons = getToolbarButtons();</span>
<span class="nc bnc" id="L2947" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10155)) {</span>
<span class="nc" id="L2948">            toolbarButtons.add(new CustomToolbarButton(toolbarButtons.size(), prefix, suffix));</span>
        }
<span class="nc bnc" id="L2950" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10156)) {</span>
<span class="nc" id="L2951">            saveToolbarButtons(toolbarButtons);</span>
        }
<span class="nc bnc" id="L2953" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10157)) {</span>
<span class="nc" id="L2954">            updateToolbar();</span>
        }
<span class="nc" id="L2956">    }</span>

    private void suggestRemoveButton(CustomToolbarButton button) {
<span class="nc bnc" id="L2959" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10158)) {</span>
<span class="nc" id="L2960">            new MaterialDialog.Builder(this).title(R.string.remove_toolbar_item).positiveText(R.string.dialog_positive_delete).negativeText(R.string.dialog_cancel).onPositive((dialog, action) -&gt; removeButton(button)).show();</span>
        }
<span class="nc" id="L2962">    }</span>

    private void removeButton(CustomToolbarButton button) {
<span class="nc" id="L2965">        ArrayList&lt;CustomToolbarButton&gt; toolbarButtons = getToolbarButtons();</span>
<span class="nc bnc" id="L2966" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10159)) {</span>
<span class="nc" id="L2967">            toolbarButtons.remove(button.getIndex());</span>
        }
<span class="nc bnc" id="L2969" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10160)) {</span>
<span class="nc" id="L2970">            saveToolbarButtons(toolbarButtons);</span>
        }
<span class="nc bnc" id="L2972" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10161)) {</span>
<span class="nc" id="L2973">            updateToolbar();</span>
        }
<span class="nc" id="L2975">    }</span>

    private void displayAddToolbarDialog() {
<span class="nc bnc" id="L2978" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10162)) {</span>
<span class="nc" id="L2979">            new MaterialDialog.Builder(this).title(R.string.add_toolbar_item).customView(R.layout.note_editor_toolbar_add_custom_item, true).positiveText(R.string.dialog_positive_create).neutralText(R.string.help).negativeText(R.string.dialog_cancel).onNeutral((m, v) -&gt; openUrl(Uri.parse(getString(R.string.link_manual_note_format_toolbar)))).onPositive((m, v) -&gt; {</span>
<span class="nc" id="L2980">                View view = m.getView();</span>
<span class="nc" id="L2981">                EditText et = view.findViewById(R.id.note_editor_toolbar_before);</span>
<span class="nc" id="L2982">                EditText et2 = view.findViewById(R.id.note_editor_toolbar_after);</span>
<span class="nc" id="L2983">                addToolbarButton(et.getText().toString(), et2.getText().toString());</span>
<span class="nc" id="L2984">            }).show();</span>
        }
<span class="nc" id="L2986">    }</span>

    private void setNoteTypePosition() {
        // Set current note type and deck positions in spinners
<span class="nc" id="L2990">        int position = mAllModelIds.indexOf(mEditorNote.model().getLong(&quot;id&quot;));</span>
<span class="nc bnc" id="L2991" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10163)) {</span>
            // set selection without firing selectionChanged event
<span class="nc" id="L2993">            mNoteTypeSpinner.setSelection(position, false);</span>
        }
<span class="nc" id="L2995">    }</span>

    private void updateDeckPosition() {
<span class="nc" id="L2998">        int position = mAllDeckIds.indexOf(mCurrentDid);</span>
<span class="nc bnc" id="L2999" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10171)) {</span>
<span class="nc bnc" id="L3000" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10168) ? (position &gt;= -1) : (ListenerUtil.mutListener.listen(10167) ? (position &lt;= -1) : (ListenerUtil.mutListener.listen(10166) ? (position &gt; -1) : (ListenerUtil.mutListener.listen(10165) ? (position &lt; -1) : (ListenerUtil.mutListener.listen(10164) ? (position == -1) : (position != -1))))))) {</span>
<span class="nc bnc" id="L3001" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10170)) {</span>
<span class="nc" id="L3002">                    mNoteDeckSpinner.setSelection(position, false);</span>
                }
            } else {
<span class="nc bnc" id="L3005" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10169)) {</span>
<span class="nc" id="L3006">                    Timber.e(&quot;updateDeckPosition() error :: mCurrentDid=%d, position=%d&quot;, mCurrentDid, position);</span>
                }
            }
        }
<span class="nc" id="L3010">    }</span>

    private void updateTags() {
<span class="nc bnc" id="L3013" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10173)) {</span>
<span class="nc bnc" id="L3014" title="All 2 branches missed.">            if (mSelectedTags == null) {</span>
<span class="nc bnc" id="L3015" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10172)) {</span>
<span class="nc" id="L3016">                    mSelectedTags = new ArrayList&lt;&gt;(0);</span>
                }
            }
        }
<span class="nc bnc" id="L3020" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10174)) {</span>
<span class="nc" id="L3021">            mTagsButton.setText(getResources().getString(R.string.CardEditorTags, getCol().getTags().join(getCol().getTags().canonify(mSelectedTags)).trim().replace(&quot; &quot;, &quot;, &quot;)));</span>
        }
<span class="nc" id="L3023">    }</span>

    /**
     * Update the list of card templates for current note type
     */
    private void updateCards(JSONObject model) {
<span class="nc bnc" id="L3029" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10175)) {</span>
<span class="nc" id="L3030">            Timber.d(&quot;updateCards()&quot;);</span>
        }
<span class="nc" id="L3032">        JSONArray tmpls = model.getJSONArray(&quot;tmpls&quot;);</span>
<span class="nc" id="L3033">        StringBuilder cardsList = new StringBuilder();</span>
<span class="nc bnc" id="L3034" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10176)) {</span>
            // Build comma separated list of card names
<span class="nc" id="L3036">            Timber.d(&quot;updateCards() template count is %s&quot;, tmpls.length());</span>
        }
<span class="nc bnc" id="L3038" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10205)) {</span>
            {
<span class="nc" id="L3040">                long _loopCounter166 = 0;</span>
<span class="nc bnc" id="L3041" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(10204) ? (i &gt;= tmpls.length()) : (ListenerUtil.mutListener.listen(10203) ? (i &lt;= tmpls.length()) : (ListenerUtil.mutListener.listen(10202) ? (i &gt; tmpls.length()) : (ListenerUtil.mutListener.listen(10201) ? (i != tmpls.length()) : (ListenerUtil.mutListener.listen(10200) ? (i == tmpls.length()) : (i &lt; tmpls.length())))))); i++) {</span>
<span class="nc" id="L3042">                    ListenerUtil.loopListener.listen(&quot;_loopCounter166&quot;, ++_loopCounter166);</span>
<span class="nc" id="L3043">                    String name = tmpls.getJSONObject(i).optString(&quot;name&quot;);</span>
<span class="nc bnc" id="L3044" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10187)) {</span>
                        // If more than one card, and we have an existing card, underline existing card
<span class="nc bnc" id="L3046" title="All 442 branches missed.">                        if ((ListenerUtil.mutListener.listen(10185) ? ((ListenerUtil.mutListener.listen(10184) ? ((ListenerUtil.mutListener.listen(10183) ? ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) || model == mEditorNote.model()) : ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) &amp;&amp; model == mEditorNote.model())) || mCurrentEditedCard != null) : ((ListenerUtil.mutListener.listen(10183) ? ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) || model == mEditorNote.model()) : ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) &amp;&amp; model == mEditorNote.model())) &amp;&amp; mCurrentEditedCard != null)) || mCurrentEditedCard.template().optString(&quot;name&quot;).equals(name)) : ((ListenerUtil.mutListener.listen(10184) ? ((ListenerUtil.mutListener.listen(10183) ? ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) || model == mEditorNote.model()) : ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) &amp;&amp; model == mEditorNote.model())) || mCurrentEditedCard != null) : ((ListenerUtil.mutListener.listen(10183) ? ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) || model == mEditorNote.model()) : ((ListenerUtil.mutListener.listen(10182) ? (!mAddNote || (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10181) ? (tmpls.length() &gt;= 1) : (ListenerUtil.mutListener.listen(10180) ? (tmpls.length() &lt;= 1) : (ListenerUtil.mutListener.listen(10179) ? (tmpls.length() &lt; 1) : (ListenerUtil.mutListener.listen(10178) ? (tmpls.length() != 1) : (ListenerUtil.mutListener.listen(10177) ? (tmpls.length() == 1) : (tmpls.length() &gt; 1)))))))) &amp;&amp; model == mEditorNote.model())) &amp;&amp; mCurrentEditedCard != null)) &amp;&amp; mCurrentEditedCard.template().optString(&quot;name&quot;).equals(name)))) {</span>
<span class="nc bnc" id="L3047" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10186)) {</span>
<span class="nc" id="L3048">                                name = &quot;&lt;u&gt;&quot; + name + &quot;&lt;/u&gt;&quot;;</span>
                            }
                        }
                    }
<span class="nc bnc" id="L3052" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10188)) {</span>
<span class="nc" id="L3053">                        cardsList.append(name);</span>
                    }
<span class="nc bnc" id="L3055" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10199)) {</span>
<span class="nc bnc" id="L3056" title="All 70 branches missed.">                        if ((ListenerUtil.mutListener.listen(10197) ? (i &gt;= (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))) : (ListenerUtil.mutListener.listen(10196) ? (i &lt;= (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))) : (ListenerUtil.mutListener.listen(10195) ? (i &gt; (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))) : (ListenerUtil.mutListener.listen(10194) ? (i != (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))) : (ListenerUtil.mutListener.listen(10193) ? (i == (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))) : (i &lt; (ListenerUtil.mutListener.listen(10192) ? (tmpls.length() % 1) : (ListenerUtil.mutListener.listen(10191) ? (tmpls.length() / 1) : (ListenerUtil.mutListener.listen(10190) ? (tmpls.length() * 1) : (ListenerUtil.mutListener.listen(10189) ? (tmpls.length() + 1) : (tmpls.length() - 1)))))))))))) {</span>
<span class="nc bnc" id="L3057" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10198)) {</span>
<span class="nc" id="L3058">                                cardsList.append(&quot;, &quot;);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L3065" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10213)) {</span>
            // Make cards list red if the number of cards is being reduced
<span class="nc bnc" id="L3067" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(10211) ? (!mAddNote || (ListenerUtil.mutListener.listen(10210) ? (tmpls.length() &gt;= mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10209) ? (tmpls.length() &lt;= mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10208) ? (tmpls.length() &gt; mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10207) ? (tmpls.length() != mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10206) ? (tmpls.length() == mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (tmpls.length() &lt; mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()))))))) : (!mAddNote &amp;&amp; (ListenerUtil.mutListener.listen(10210) ? (tmpls.length() &gt;= mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10209) ? (tmpls.length() &lt;= mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10208) ? (tmpls.length() &gt; mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10207) ? (tmpls.length() != mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (ListenerUtil.mutListener.listen(10206) ? (tmpls.length() == mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()) : (tmpls.length() &lt; mEditorNote.model().getJSONArray(&quot;tmpls&quot;).length()))))))))) {</span>
<span class="nc bnc" id="L3068" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10212)) {</span>
<span class="nc" id="L3069">                    cardsList = new StringBuilder(&quot;&lt;font color='red'&gt;&quot; + cardsList + &quot;&lt;/font&gt;&quot;);</span>
                }
            }
        }
<span class="nc bnc" id="L3073" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10214)) {</span>
<span class="nc" id="L3074">            mCardsButton.setText(HtmlCompat.fromHtml(getResources().getString(R.string.CardEditorCards, cardsList.toString()), HtmlCompat.FROM_HTML_MODE_LEGACY));</span>
        }
<span class="nc" id="L3076">    }</span>

    private boolean updateField(FieldEditText field) {
<span class="nc" id="L3079">        String currentValue = &quot;&quot;;</span>
<span class="nc" id="L3080">        Editable fieldText = field.getText();</span>
<span class="nc bnc" id="L3081" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10216)) {</span>
<span class="nc bnc" id="L3082" title="All 2 branches missed.">            if (fieldText != null) {</span>
<span class="nc bnc" id="L3083" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10215)) {</span>
<span class="nc" id="L3084">                    currentValue = fieldText.toString();</span>
                }
            }
        }
<span class="nc" id="L3088">        String newValue = convertToHtmlNewline(currentValue);</span>
<span class="nc bnc" id="L3089" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10218)) {</span>
<span class="nc bnc" id="L3090" title="All 2 branches missed.">            if (!mEditorNote.values()[field.getOrd()].equals(newValue)) {</span>
<span class="nc bnc" id="L3091" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10217)) {</span>
<span class="nc" id="L3092">                    mEditorNote.values()[field.getOrd()] = newValue;</span>
                }
<span class="nc" id="L3094">                return true;</span>
            }
        }
<span class="nc" id="L3097">        return false;</span>
    }

    private String convertToHtmlNewline(@NonNull String fieldData) {
<span class="nc bnc" id="L3101" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10219)) {</span>
<span class="nc bnc" id="L3102" title="All 2 branches missed.">            if (!shouldReplaceNewlines()) {</span>
<span class="nc" id="L3103">                return fieldData;</span>
            }
        }
<span class="nc" id="L3106">        return fieldData.replace(FieldEditText.NEW_LINE, &quot;&lt;br&gt;&quot;);</span>
    }

    private String tagsAsString(List&lt;String&gt; tags) {
<span class="nc" id="L3110">        return TextUtils.join(&quot; &quot;, tags);</span>
    }

    private Model getCurrentlySelectedModel() {
<span class="nc" id="L3114">        return getCol().getModels().get(mAllModelIds.get(mNoteTypeSpinner.getSelectedItemPosition()));</span>
    }

    /**
     * Update all the field EditText views based on the currently selected note type and the mModelChangeFieldMap
     */
    private void updateFieldsFromMap(Model newModel) {
<span class="nc" id="L3121">        FieldChangeType type = FieldChangeType.refreshWithMap(newModel, mModelChangeFieldMap, shouldReplaceNewlines());</span>
<span class="nc bnc" id="L3122" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10220)) {</span>
<span class="nc" id="L3123">            populateEditFields(type, true);</span>
        }
<span class="nc bnc" id="L3125" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10221)) {</span>
<span class="nc" id="L3126">            updateCards(newModel);</span>
        }
<span class="nc" id="L3128">    }</span>

    /**
     * @return whether or not to allow remapping of fields for current model
     */
    private boolean allowFieldRemapping() {
        // Map&lt;String, Pair&lt;Integer, JSONObject&gt;&gt; fMapNew = getCol().getModels().fieldMap(getCurrentlySelectedModel())
<span class="nc bnc" id="L3135" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(10226) ? (mEditorNote.items().length &gt;= 2) : (ListenerUtil.mutListener.listen(10225) ? (mEditorNote.items().length &lt;= 2) : (ListenerUtil.mutListener.listen(10224) ? (mEditorNote.items().length &lt; 2) : (ListenerUtil.mutListener.listen(10223) ? (mEditorNote.items().length != 2) : (ListenerUtil.mutListener.listen(10222) ? (mEditorNote.items().length == 2) : (mEditorNote.items().length &gt; 2))))));</span>
    }

    public String[][] getFieldsFromSelectedNote() {
<span class="nc" id="L3139">        return mEditorNote.items();</span>
    }

<span class="nc" id="L3142">    private class SetNoteTypeListener implements OnItemSelectedListener {</span>

        @Override
        public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int pos, long id) {
            // Timber.i(&quot;NoteEditor:: onItemSelected() fired on mNoteTypeSpinner&quot;);
<span class="nc" id="L3147">            long oldModelId = getCol().getModels().current().getLong(&quot;id&quot;);</span>
            @NonNull
<span class="nc" id="L3149">            Long newId = mAllModelIds.get(pos);</span>
<span class="nc bnc" id="L3150" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10227)) {</span>
<span class="nc" id="L3151">                Timber.i(&quot;Changing note type to '%d&quot;, newId);</span>
            }
<span class="nc bnc" id="L3153" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10243)) {</span>
<span class="nc bnc" id="L3154" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(10232) ? (oldModelId &gt;= newId) : (ListenerUtil.mutListener.listen(10231) ? (oldModelId &lt;= newId) : (ListenerUtil.mutListener.listen(10230) ? (oldModelId &gt; newId) : (ListenerUtil.mutListener.listen(10229) ? (oldModelId &lt; newId) : (ListenerUtil.mutListener.listen(10228) ? (oldModelId == newId) : (oldModelId != newId))))))) {</span>
<span class="nc" id="L3155">                    Model model = getCol().getModels().get(newId);</span>
<span class="nc bnc" id="L3156" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10234)) {</span>
<span class="nc bnc" id="L3157" title="All 2 branches missed.">                        if (model == null) {</span>
<span class="nc bnc" id="L3158" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10233)) {</span>
<span class="nc" id="L3159">                                Timber.w(&quot;New model %s not found, not changing note type&quot;, newId);</span>
                            }
<span class="nc" id="L3161">                            return;</span>
                        }
                    }
<span class="nc bnc" id="L3164" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10235)) {</span>
<span class="nc" id="L3165">                        getCol().getModels().setCurrent(model);</span>
                    }
<span class="nc" id="L3167">                    Deck currentDeck = getCol().getDecks().current();</span>
<span class="nc bnc" id="L3168" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10236)) {</span>
<span class="nc" id="L3169">                        currentDeck.put(&quot;mid&quot;, newId);</span>
                    }
<span class="nc bnc" id="L3171" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10237)) {</span>
<span class="nc" id="L3172">                        getCol().getDecks().save(currentDeck);</span>
                    }
<span class="nc bnc" id="L3174" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10240)) {</span>
                        // Update deck
<span class="nc bnc" id="L3176" title="All 2 branches missed.">                        if (!getCol().getConf().optBoolean(&quot;addToCur&quot;, true)) {</span>
<span class="nc bnc" id="L3177" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10238)) {</span>
<span class="nc" id="L3178">                                mCurrentDid = model.getLong(&quot;did&quot;);</span>
                            }
<span class="nc bnc" id="L3180" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10239)) {</span>
<span class="nc" id="L3181">                                updateDeckPosition();</span>
                            }
                        }
                    }
<span class="nc bnc" id="L3185" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10241)) {</span>
<span class="nc" id="L3186">                        refreshNoteData(FieldChangeType.changeFieldCount(shouldReplaceNewlines()));</span>
                    }
<span class="nc bnc" id="L3188" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10242)) {</span>
<span class="nc" id="L3189">                        setDuplicateFieldStyles();</span>
                    }
                }
            }
<span class="nc" id="L3193">        }</span>

        @Override
        public void onNothingSelected(AdapterView&lt;?&gt; parent) {
<span class="nc" id="L3197">        }</span>
    }

    /* Uses only if mCurrentEditedCard is set, so from reviewer or card browser.*/
<span class="nc" id="L3201">    private class EditNoteTypeListener implements OnItemSelectedListener {</span>

        @Override
        public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int pos, long id) {
            // Get the current model
<span class="nc" id="L3206">            long noteModelId = mCurrentEditedCard.model().getLong(&quot;id&quot;);</span>
            // Get new model
<span class="nc" id="L3208">            Model newModel = getCol().getModels().get(mAllModelIds.get(pos));</span>
<span class="nc bnc" id="L3209" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10246)) {</span>
<span class="nc bnc" id="L3210" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(10244) ? (newModel == null &amp;&amp; newModel.getJSONArray(&quot;tmpls&quot;) == null) : (newModel == null || newModel.getJSONArray(&quot;tmpls&quot;) == null))) {</span>
<span class="nc bnc" id="L3211" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10245)) {</span>
<span class="nc" id="L3212">                        Timber.w(&quot;newModel %s not found&quot;, mAllModelIds.get(pos));</span>
                    }
<span class="nc" id="L3214">                    return;</span>
                }
            }
<span class="nc bnc" id="L3217" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10291)) {</span>
                // Configure the interface according to whether note type is getting changed or not
<span class="nc bnc" id="L3219" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(10251) ? (mAllModelIds.get(pos) &gt;= noteModelId) : (ListenerUtil.mutListener.listen(10250) ? (mAllModelIds.get(pos) &lt;= noteModelId) : (ListenerUtil.mutListener.listen(10249) ? (mAllModelIds.get(pos) &gt; noteModelId) : (ListenerUtil.mutListener.listen(10248) ? (mAllModelIds.get(pos) &lt; noteModelId) : (ListenerUtil.mutListener.listen(10247) ? (mAllModelIds.get(pos) == noteModelId) : (mAllModelIds.get(pos) != noteModelId))))))) {</span>
                    // Initialize mapping between fields of old model -&gt; new model
<span class="nc" id="L3221">                    int itemsLength = mEditorNote.items().length;</span>
<span class="nc bnc" id="L3222" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10256)) {</span>
<span class="nc" id="L3223">                        mModelChangeFieldMap = new HashMap&lt;&gt;(itemsLength);</span>
                    }
<span class="nc bnc" id="L3225" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10263)) {</span>
                        {
<span class="nc" id="L3227">                            long _loopCounter167 = 0;</span>
<span class="nc bnc" id="L3228" title="All 22 branches missed.">                            for (int i = 0; (ListenerUtil.mutListener.listen(10262) ? (i &gt;= itemsLength) : (ListenerUtil.mutListener.listen(10261) ? (i &lt;= itemsLength) : (ListenerUtil.mutListener.listen(10260) ? (i &gt; itemsLength) : (ListenerUtil.mutListener.listen(10259) ? (i != itemsLength) : (ListenerUtil.mutListener.listen(10258) ? (i == itemsLength) : (i &lt; itemsLength)))))); i++) {</span>
<span class="nc" id="L3229">                                ListenerUtil.loopListener.listen(&quot;_loopCounter167&quot;, ++_loopCounter167);</span>
<span class="nc bnc" id="L3230" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(10257)) {</span>
<span class="nc" id="L3231">                                    mModelChangeFieldMap.put(i, i);</span>
                                }
                            }
                        }
                    }
                    // Initialize mapping between cards new model -&gt; old model
<span class="nc" id="L3237">                    int templatesLength = newModel.getJSONArray(&quot;tmpls&quot;).length();</span>
<span class="nc bnc" id="L3238" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10264)) {</span>
<span class="nc" id="L3239">                        mModelChangeCardMap = new HashMap&lt;&gt;(templatesLength);</span>
                    }
<span class="nc bnc" id="L3241" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10278)) {</span>
                        {
<span class="nc" id="L3243">                            long _loopCounter168 = 0;</span>
<span class="nc bnc" id="L3244" title="All 22 branches missed.">                            for (int i = 0; (ListenerUtil.mutListener.listen(10277) ? (i &gt;= templatesLength) : (ListenerUtil.mutListener.listen(10276) ? (i &lt;= templatesLength) : (ListenerUtil.mutListener.listen(10275) ? (i &gt; templatesLength) : (ListenerUtil.mutListener.listen(10274) ? (i != templatesLength) : (ListenerUtil.mutListener.listen(10273) ? (i == templatesLength) : (i &lt; templatesLength)))))); i++) {</span>
<span class="nc" id="L3245">                                ListenerUtil.loopListener.listen(&quot;_loopCounter168&quot;, ++_loopCounter168);</span>
<span class="nc bnc" id="L3246" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(10272)) {</span>
<span class="nc bnc" id="L3247" title="All 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(10269) ? (i &gt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(10268) ? (i &lt;= mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(10267) ? (i &gt; mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(10266) ? (i != mEditorNote.numberOfCards()) : (ListenerUtil.mutListener.listen(10265) ? (i == mEditorNote.numberOfCards()) : (i &lt; mEditorNote.numberOfCards()))))))) {</span>
<span class="nc bnc" id="L3248" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(10271)) {</span>
<span class="nc" id="L3249">                                            mModelChangeCardMap.put(i, i);</span>
                                        }
                                    } else {
<span class="nc bnc" id="L3252" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(10270)) {</span>
<span class="nc" id="L3253">                                            mModelChangeCardMap.put(i, null);</span>
                                        }
                                    }
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L3260" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10279)) {</span>
                        // Update the field text edits based on the default mapping just assigned
<span class="nc" id="L3262">                        updateFieldsFromMap(newModel);</span>
                    }
<span class="nc bnc" id="L3264" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10280)) {</span>
                        // Don't let the user change any other values at the same time as changing note type
<span class="nc" id="L3266">                        mSelectedTags = mEditorNote.getTags();</span>
                    }
<span class="nc bnc" id="L3268" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10281)) {</span>
<span class="nc" id="L3269">                        updateTags();</span>
                    }
<span class="nc bnc" id="L3271" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10282)) {</span>
<span class="nc" id="L3272">                        findViewById(R.id.CardEditorTagButton).setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3274" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10283)) {</span>
                        // ((LinearLayout) findViewById(R.id.CardEditorCardsButton)).setEnabled(false);
<span class="nc" id="L3276">                        mNoteDeckSpinner.setEnabled(false);</span>
                    }
<span class="nc" id="L3278">                    int position = mAllDeckIds.indexOf(mCurrentEditedCard.getDid());</span>
<span class="nc bnc" id="L3279" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10290)) {</span>
<span class="nc bnc" id="L3280" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(10288) ? (position &gt;= -1) : (ListenerUtil.mutListener.listen(10287) ? (position &lt;= -1) : (ListenerUtil.mutListener.listen(10286) ? (position &gt; -1) : (ListenerUtil.mutListener.listen(10285) ? (position &lt; -1) : (ListenerUtil.mutListener.listen(10284) ? (position == -1) : (position != -1))))))) {</span>
<span class="nc bnc" id="L3281" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(10289)) {</span>
<span class="nc" id="L3282">                                mNoteDeckSpinner.setSelection(position, false);</span>
                            }
                        }
                    }
<span class="nc" id="L3286">                } else {</span>
<span class="nc bnc" id="L3287" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10252)) {</span>
<span class="nc" id="L3288">                        populateEditFields(FieldChangeType.refresh(shouldReplaceNewlines()), false);</span>
                    }
<span class="nc bnc" id="L3290" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10253)) {</span>
<span class="nc" id="L3291">                        updateCards(mCurrentEditedCard.model());</span>
                    }
<span class="nc bnc" id="L3293" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10254)) {</span>
<span class="nc" id="L3294">                        findViewById(R.id.CardEditorTagButton).setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10255)) {</span>
                        // ((LinearLayout) findViewById(R.id.CardEditorCardsButton)).setEnabled(false);
<span class="nc" id="L3298">                        mNoteDeckSpinner.setEnabled(true);</span>
                    }
                }
            }
<span class="nc" id="L3302">        }</span>

        @Override
        public void onNothingSelected(AdapterView&lt;?&gt; parent) {
<span class="nc" id="L3306">        }</span>
    }

    /**
     * Custom ActionMode.Callback implementation for adding and handling cloze deletion action
     * button in the text selection menu.
     */
    @TargetApi(23)
    private class ActionModeCallback implements ActionMode.Callback, LocaleSelectionDialog.LocaleSelectionDialogHandler {

        private final FieldEditText mTextBox;

        private final Field mField;

<span class="nc" id="L3320">        private final int mClozeMenuId = View.generateViewId();</span>

<span class="nc" id="L3322">        @RequiresApi(Build.VERSION_CODES.N)</span>
<span class="nc" id="L3323">        private final int mSetLanguageId = View.generateViewId();</span>

<span class="nc" id="L3325">        private ActionModeCallback(FieldEditText textBox, Field field) {</span>
<span class="nc" id="L3326">            super();</span>
<span class="nc" id="L3327">            mTextBox = textBox;</span>
<span class="nc" id="L3328">            mField = field;</span>
<span class="nc" id="L3329">        }</span>

        @Override
        public boolean onCreateActionMode(ActionMode mode, Menu menu) {
<span class="nc" id="L3333">            return true;</span>
        }

        @Override
        public boolean onPrepareActionMode(ActionMode mode, Menu menu) {
<span class="nc bnc" id="L3338" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10292)) {</span>
                // Adding the cloze deletion floating context menu item, but only once.
<span class="nc bnc" id="L3340" title="All 2 branches missed.">                if (menu.findItem(mClozeMenuId) != null) {</span>
<span class="nc" id="L3341">                    return false;</span>
                }
            }
<span class="nc bnc" id="L3344" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10299)) {</span>
<span class="nc bnc" id="L3345" title="All 50 branches missed.">                if ((ListenerUtil.mutListener.listen(10298) ? ((ListenerUtil.mutListener.listen(10297) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10296) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10295) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10294) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10293) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.N) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N)))))) || menu.findItem(mSetLanguageId) != null) : ((ListenerUtil.mutListener.listen(10297) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10296) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10295) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10294) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10293) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.N) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N)))))) &amp;&amp; menu.findItem(mSetLanguageId) != null))) {</span>
<span class="nc" id="L3346">                    return false;</span>
                }
            }
<span class="nc" id="L3349">            int initialSize = menu.size();</span>
<span class="nc bnc" id="L3350" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10301)) {</span>
<span class="nc bnc" id="L3351" title="All 2 branches missed.">                if (isClozeType()) {</span>
<span class="nc bnc" id="L3352" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10300)) {</span>
<span class="nc" id="L3353">                        menu.add(Menu.NONE, mClozeMenuId, 0, R.string.multimedia_editor_popup_cloze);</span>
                    }
                }
            }
<span class="nc bnc" id="L3357" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10308)) {</span>
<span class="nc bnc" id="L3358" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(10306) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10305) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10304) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10303) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10302) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.N) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N))))))) {</span>
<span class="nc bnc" id="L3359" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10307)) {</span>
                        // This should be after &quot;Paste as Plain Text&quot;
<span class="nc" id="L3361">                        menu.add(Menu.NONE, mSetLanguageId, 99, R.string.note_editor_set_field_language);</span>
                    }
                }
            }
<span class="nc bnc" id="L3365" title="All 2 branches missed.">            return initialSize != menu.size();</span>
        }

        @SuppressLint(&quot;SetTextI18n&quot;)
        @Override
        public boolean onActionItemClicked(ActionMode mode, MenuItem item) {
<span class="nc" id="L3371">            int itemId = item.getItemId();</span>
<span class="nc bnc" id="L3372" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(10313) ? (itemId &gt;= mClozeMenuId) : (ListenerUtil.mutListener.listen(10312) ? (itemId &lt;= mClozeMenuId) : (ListenerUtil.mutListener.listen(10311) ? (itemId &gt; mClozeMenuId) : (ListenerUtil.mutListener.listen(10310) ? (itemId &lt; mClozeMenuId) : (ListenerUtil.mutListener.listen(10309) ? (itemId != mClozeMenuId) : (itemId == mClozeMenuId))))))) {</span>
<span class="nc bnc" id="L3373" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10327)) {</span>
<span class="nc" id="L3374">                    convertSelectedTextToCloze(mTextBox, AddClozeType.INCREMENT_NUMBER);</span>
                }
<span class="nc bnc" id="L3376" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10328)) {</span>
<span class="nc" id="L3377">                    mode.finish();</span>
                }
<span class="nc" id="L3379">                return true;</span>
<span class="nc bnc" id="L3380" title="All 90 branches missed.">            } else if ((ListenerUtil.mutListener.listen(10324) ? ((ListenerUtil.mutListener.listen(10318) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10317) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10316) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10315) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10314) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.N) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N)))))) || (ListenerUtil.mutListener.listen(10323) ? (itemId &gt;= mSetLanguageId) : (ListenerUtil.mutListener.listen(10322) ? (itemId &lt;= mSetLanguageId) : (ListenerUtil.mutListener.listen(10321) ? (itemId &gt; mSetLanguageId) : (ListenerUtil.mutListener.listen(10320) ? (itemId &lt; mSetLanguageId) : (ListenerUtil.mutListener.listen(10319) ? (itemId != mSetLanguageId) : (itemId == mSetLanguageId))))))) : ((ListenerUtil.mutListener.listen(10318) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10317) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10316) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10315) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.N) : (ListenerUtil.mutListener.listen(10314) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.N) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N)))))) &amp;&amp; (ListenerUtil.mutListener.listen(10323) ? (itemId &gt;= mSetLanguageId) : (ListenerUtil.mutListener.listen(10322) ? (itemId &lt;= mSetLanguageId) : (ListenerUtil.mutListener.listen(10321) ? (itemId &gt; mSetLanguageId) : (ListenerUtil.mutListener.listen(10320) ? (itemId &lt; mSetLanguageId) : (ListenerUtil.mutListener.listen(10319) ? (itemId != mSetLanguageId) : (itemId == mSetLanguageId))))))))) {</span>
<span class="nc bnc" id="L3381" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10325)) {</span>
<span class="nc" id="L3382">                    displaySelectInputLanguage();</span>
                }
<span class="nc bnc" id="L3384" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10326)) {</span>
<span class="nc" id="L3385">                    mode.finish();</span>
                }
<span class="nc" id="L3387">                return true;</span>
            } else {
<span class="nc" id="L3389">                return false;</span>
            }
        }

        @RequiresApi(Build.VERSION_CODES.N)
        private void displaySelectInputLanguage() {
<span class="nc" id="L3395">            DialogFragment dialogFragment = LocaleSelectionDialog.newInstance(this);</span>
<span class="nc bnc" id="L3396" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10329)) {</span>
<span class="nc" id="L3397">                showDialogFragment(dialogFragment);</span>
            }
<span class="nc" id="L3399">        }</span>

        @Override
        public void onDestroyActionMode(ActionMode mode) {
<span class="nc" id="L3403">        }</span>

        @Override
        @RequiresApi(Build.VERSION_CODES.N)
        public void onSelectedLocale(@NonNull Locale selectedLocale) {
<span class="nc bnc" id="L3408" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10330)) {</span>
<span class="nc" id="L3409">                mField.setHintLocale(selectedLocale);</span>
            }
<span class="nc bnc" id="L3411" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10331)) {</span>
<span class="nc" id="L3412">                mTextBox.setHintLocale(selectedLocale);</span>
            }
<span class="nc bnc" id="L3414" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10332)) {</span>
<span class="nc" id="L3415">                dismissAllDialogFragments();</span>
            }
<span class="nc" id="L3417">        }</span>

        @Override
        @RequiresApi(Build.VERSION_CODES.N)
        public void onLocaleSelectionCancelled() {
<span class="nc bnc" id="L3422" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10333)) {</span>
<span class="nc" id="L3423">                dismissAllDialogFragments();</span>
            }
<span class="nc" id="L3425">        }</span>
    }

    private void convertSelectedTextToCloze(FieldEditText textBox, AddClozeType addClozeType) {
<span class="nc" id="L3429">        int nextClozeIndex = getNextClozeIndex();</span>
<span class="nc bnc" id="L3430" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10339)) {</span>
<span class="nc bnc" id="L3431" title="All 2 branches missed.">            if (addClozeType == AddClozeType.SAME_NUMBER) {</span>
<span class="nc bnc" id="L3432" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10338)) {</span>
<span class="nc bnc" id="L3433" title="All 8 branches missed.">                    nextClozeIndex = (ListenerUtil.mutListener.listen(10337) ? (nextClozeIndex % 1) : (ListenerUtil.mutListener.listen(10336) ? (nextClozeIndex / 1) : (ListenerUtil.mutListener.listen(10335) ? (nextClozeIndex * 1) : (ListenerUtil.mutListener.listen(10334) ? (nextClozeIndex + 1) : (nextClozeIndex - 1)))));</span>
                }
            }
        }
<span class="nc" id="L3437">        String prefix = &quot;{{c&quot; + Math.max(1, nextClozeIndex) + &quot;::&quot;;</span>
<span class="nc" id="L3438">        String suffix = &quot;}}&quot;;</span>
<span class="nc bnc" id="L3439" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10340)) {</span>
<span class="nc" id="L3440">            modifyCurrentSelection(new Toolbar.TextWrapper(prefix, suffix), textBox);</span>
        }
<span class="nc" id="L3442">    }</span>

    @NonNull
    private String previewNextClozeDeletion(int start, int end, CharSequence text) {
<span class="nc" id="L3446">        CharSequence selectedText = text.subSequence(start, end);</span>
<span class="nc" id="L3447">        int nextClozeIndex = getNextClozeIndex();</span>
<span class="nc bnc" id="L3448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10341)) {</span>
<span class="nc" id="L3449">            nextClozeIndex = Math.max(1, nextClozeIndex);</span>
        }
        // Update text field with updated text and selection
<span class="nc" id="L3452">        return String.format(&quot;{{c%s::%s}}&quot;, nextClozeIndex, selectedText);</span>
    }

    private boolean hasClozeDeletions() {
<span class="nc bnc" id="L3456" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(10346) ? (getNextClozeIndex() &gt;= 1) : (ListenerUtil.mutListener.listen(10345) ? (getNextClozeIndex() &lt;= 1) : (ListenerUtil.mutListener.listen(10344) ? (getNextClozeIndex() &lt; 1) : (ListenerUtil.mutListener.listen(10343) ? (getNextClozeIndex() != 1) : (ListenerUtil.mutListener.listen(10342) ? (getNextClozeIndex() == 1) : (getNextClozeIndex() &gt; 1))))));</span>
    }

    private int getNextClozeIndex() {
        // BUG: This assumes all fields are inserted as: {{cloze:Text}}
<span class="nc" id="L3461">        List&lt;String&gt; fieldValues = new ArrayList&lt;&gt;(mEditFields.size());</span>
<span class="nc bnc" id="L3462" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10348)) {</span>
            {
<span class="nc" id="L3464">                long _loopCounter169 = 0;</span>
<span class="nc bnc" id="L3465" title="All 2 branches missed.">                for (FieldEditText e : mEditFields) {</span>
<span class="nc" id="L3466">                    ListenerUtil.loopListener.listen(&quot;_loopCounter169&quot;, ++_loopCounter169);</span>
<span class="nc" id="L3467">                    Editable editable = e.getText();</span>
<span class="nc bnc" id="L3468" title="All 2 branches missed.">                    String fieldValue = editable == null ? &quot;&quot; : editable.toString();</span>
<span class="nc bnc" id="L3469" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10347)) {</span>
<span class="nc" id="L3470">                        fieldValues.add(fieldValue);</span>
                    }
<span class="nc" id="L3472">                }</span>
            }
        }
<span class="nc" id="L3475">        return ClozeUtils.getNextClozeIndex(fieldValues);</span>
    }

    private boolean isClozeType() {
<span class="nc" id="L3479">        return getCurrentlySelectedModel().isCloze();</span>
    }

    @VisibleForTesting
    void startAdvancedTextEditor(int index) {
<span class="nc" id="L3484">        TextField field = new TextField();</span>
<span class="nc bnc" id="L3485" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10349)) {</span>
<span class="nc" id="L3486">            field.setText(getCurrentFieldText(index));</span>
        }
<span class="nc bnc" id="L3488" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10350)) {</span>
<span class="nc" id="L3489">            startMultimediaFieldEditorForField(index, field);</span>
        }
<span class="nc" id="L3491">    }</span>

    @VisibleForTesting
    void setFieldValueFromUi(int i, String newText) {
<span class="nc" id="L3495">        FieldEditText editText = mEditFields.get(i);</span>
<span class="nc bnc" id="L3496" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10351)) {</span>
<span class="nc" id="L3497">            editText.setText(newText);</span>
        }
<span class="nc bnc" id="L3499" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(10352)) {</span>
<span class="nc" id="L3500">            new EditFieldTextWatcher(i).afterTextChanged(editText.getText());</span>
        }
<span class="nc" id="L3502">    }</span>

    @VisibleForTesting
    long getDeckId() {
<span class="nc" id="L3506">        return mCurrentDid;</span>
    }

    @SuppressWarnings(&quot;SameParameterValue&quot;)
    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
    FieldEditText getFieldForTest(int index) {
<span class="nc" id="L3512">        return mEditFields.get(index);</span>
    }

    private class EditFieldTextWatcher implements TextWatcher {

        private final int mIndex;

<span class="nc" id="L3519">        public EditFieldTextWatcher(int index) {</span>
<span class="nc" id="L3520">            this.mIndex = index;</span>
<span class="nc" id="L3521">        }</span>

        @Override
        public void afterTextChanged(Editable arg0) {
<span class="nc bnc" id="L3525" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10353)) {</span>
<span class="nc" id="L3526">                mFieldEdited = true;</span>
            }
<span class="nc bnc" id="L3528" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10360)) {</span>
<span class="nc bnc" id="L3529" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(10358) ? (mIndex &gt;= 0) : (ListenerUtil.mutListener.listen(10357) ? (mIndex &lt;= 0) : (ListenerUtil.mutListener.listen(10356) ? (mIndex &gt; 0) : (ListenerUtil.mutListener.listen(10355) ? (mIndex &lt; 0) : (ListenerUtil.mutListener.listen(10354) ? (mIndex != 0) : (mIndex == 0))))))) {</span>
<span class="nc bnc" id="L3530" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(10359)) {</span>
<span class="nc" id="L3531">                        setDuplicateFieldStyles();</span>
                    }
                }
            }
<span class="nc" id="L3535">        }</span>

        @Override
        public void beforeTextChanged(CharSequence arg0, int arg1, int arg2, int arg3) {
<span class="nc" id="L3539">        }</span>

        @Override
        public void onTextChanged(CharSequence arg0, int arg1, int arg2, int arg3) {
<span class="nc" id="L3543">        }</span>
    }

    private static class Field {

        private final JSONObject mField;

        private final Collection mCol;

<span class="nc" id="L3552">        public Field(JSONObject fieldObject, Collection collection) {</span>
<span class="nc" id="L3553">            this.mField = fieldObject;</span>
<span class="nc" id="L3554">            this.mCol = collection;</span>
<span class="nc" id="L3555">        }</span>

        @RequiresApi(api = Build.VERSION_CODES.N)
        public void setHintLocale(@NonNull Locale selectedLocale) {
<span class="nc" id="L3559">            String input = selectedLocale.toLanguageTag();</span>
<span class="nc bnc" id="L3560" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(10361)) {</span>
<span class="nc" id="L3561">                mField.put(&quot;ad-hint-locale&quot;, input);</span>
            }
            try {
<span class="nc bnc" id="L3564" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10363)) {</span>
<span class="nc" id="L3565">                    mCol.getModels().save();</span>
                }
<span class="nc" id="L3567">            } catch (Exception e) {</span>
<span class="nc bnc" id="L3568" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(10362)) {</span>
<span class="nc" id="L3569">                    Timber.w(e, &quot;Failed to save hint locale&quot;);</span>
                }
<span class="nc" id="L3571">            }</span>
<span class="nc" id="L3572">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>