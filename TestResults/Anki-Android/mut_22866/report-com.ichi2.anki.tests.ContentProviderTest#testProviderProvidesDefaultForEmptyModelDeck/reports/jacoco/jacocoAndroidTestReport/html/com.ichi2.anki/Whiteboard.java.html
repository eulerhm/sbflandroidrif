<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Whiteboard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">Whiteboard.java</span></div><h1>Whiteboard.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2009 Andrew &lt;andrewdubya@gmail.com&gt;
 * Copyright (c) 2009 Nicolas Raoul &lt;nicolas.raoul@gmail.com&gt;
 * Copyright (c) 2009 Edu Zamora &lt;edu.zasu@gmail.com&gt;
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 * PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package com.ichi2.anki;

import android.annotation.SuppressLint;
import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Path;
import android.graphics.PathMeasure;
import android.graphics.Point;
import androidx.annotation.CheckResult;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.VisibleForTesting;
import androidx.core.content.ContextCompat;
import timber.log.Timber;
import android.os.Environment;
import android.view.Display;
import android.view.MotionEvent;
import android.view.View;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.LinearLayout;
import com.ichi2.libanki.utils.Time;
import com.ichi2.libanki.utils.TimeUtils;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.lang.ref.WeakReference;
import java.util.Stack;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

/**
 * Whiteboard allowing the user to draw the card's answer on the touchscreen.
 */
@SuppressLint(&quot;ViewConstructor&quot;)
public class Whiteboard extends View {

    private static final float TOUCH_TOLERANCE = 4;

    private final Paint mPaint;

<span class="nc" id="L61">    private final UndoStack mUndo = new UndoStack();</span>

    private Bitmap mBitmap;

    private Canvas mCanvas;

    private final Path mPath;

    private final Paint mBitmapPaint;

    private final WeakReference&lt;AbstractFlashcardViewer&gt; mCardViewer;

    private float mX;

    private float mY;

    private float mSecondFingerX0;

    private float mSecondFingerY0;

    private float mSecondFingerX;

    private float mSecondFingerY;

    private int mSecondFingerPointerId;

    private boolean mSecondFingerWithinTapTolerance;

<span class="nc" id="L89">    private boolean mCurrentlyDrawing = false;</span>

<span class="nc" id="L91">    private boolean mUndoModeActive = false;</span>

    private final int foregroundColor;

    private final LinearLayout mColorPalette;

    @Nullable
    private OnPaintColorChangeListener mOnPaintColorChangeListener;

    public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted) {
<span class="nc" id="L101">        super(cardViewer, null);</span>
<span class="nc" id="L102">        mCardViewer = new WeakReference&lt;&gt;(cardViewer);</span>
<span class="nc" id="L103">        Button whitePenColorButton = cardViewer.findViewById(R.id.pen_color_white);</span>
<span class="nc" id="L104">        Button blackPenColorButton = cardViewer.findViewById(R.id.pen_color_black);</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (!inverted) {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12383)) {</span>
<span class="nc" id="L107">                whitePenColorButton.setVisibility(View.GONE);</span>
            }
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12384)) {</span>
<span class="nc" id="L110">                blackPenColorButton.setOnClickListener(this::onClick);</span>
            }
<span class="nc" id="L112">            foregroundColor = Color.BLACK;</span>
        } else {
<span class="nc bnc" id="L114" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12381)) {</span>
<span class="nc" id="L115">                blackPenColorButton.setVisibility(View.GONE);</span>
            }
<span class="nc bnc" id="L117" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12382)) {</span>
<span class="nc" id="L118">                whitePenColorButton.setOnClickListener(this::onClick);</span>
            }
<span class="nc" id="L120">            foregroundColor = Color.WHITE;</span>
        }
<span class="nc" id="L122">        mPaint = new Paint();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12385)) {</span>
<span class="nc" id="L124">            mPaint.setAntiAlias(true);</span>
        }
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12386)) {</span>
<span class="nc" id="L127">            mPaint.setDither(true);</span>
        }
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12387)) {</span>
<span class="nc" id="L130">            mPaint.setColor(foregroundColor);</span>
        }
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12388)) {</span>
<span class="nc" id="L133">            mPaint.setStyle(Paint.Style.STROKE);</span>
        }
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12389)) {</span>
<span class="nc" id="L136">            mPaint.setStrokeJoin(Paint.Join.ROUND);</span>
        }
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12390)) {</span>
<span class="nc" id="L139">            mPaint.setStrokeCap(Paint.Cap.ROUND);</span>
        }
<span class="nc" id="L141">        int wbStrokeWidth = AnkiDroidApp.getSharedPrefs(cardViewer).getInt(&quot;whiteBoardStrokeWidth&quot;, 6);</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12391)) {</span>
<span class="nc" id="L143">            mPaint.setStrokeWidth((float) wbStrokeWidth);</span>
        }
<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12392)) {</span>
<span class="nc" id="L146">            createBitmap();</span>
        }
<span class="nc" id="L148">        mPath = new Path();</span>
<span class="nc" id="L149">        mBitmapPaint = new Paint(Paint.DITHER_FLAG);</span>
        // selecting pen color to draw
<span class="nc" id="L151">        mColorPalette = cardViewer.findViewById(R.id.whiteboard_pen_color);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12393)) {</span>
<span class="nc" id="L153">            cardViewer.findViewById(R.id.pen_color_red).setOnClickListener(this::onClick);</span>
        }
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12394)) {</span>
<span class="nc" id="L156">            cardViewer.findViewById(R.id.pen_color_green).setOnClickListener(this::onClick);</span>
        }
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12395)) {</span>
<span class="nc" id="L159">            cardViewer.findViewById(R.id.pen_color_blue).setOnClickListener(this::onClick);</span>
        }
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12396)) {</span>
<span class="nc" id="L162">            cardViewer.findViewById(R.id.pen_color_yellow).setOnClickListener(this::onClick);</span>
        }
<span class="nc" id="L164">    }</span>

    @Override
    protected void onDraw(Canvas canvas) {
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12397)) {</span>
<span class="nc" id="L169">            super.onDraw(canvas);</span>
        }
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12398)) {</span>
<span class="nc" id="L172">            canvas.drawColor(0);</span>
        }
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12399)) {</span>
<span class="nc" id="L175">            canvas.drawBitmap(mBitmap, 0, 0, mBitmapPaint);</span>
        }
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12400)) {</span>
<span class="nc" id="L178">            canvas.drawPath(mPath, mPaint);</span>
        }
<span class="nc" id="L180">    }</span>

    /**
     * Handle motion events to draw using the touch screen or to interact with the flashcard behind
     * the whiteboard by using a second finger.
     *
     * @param event The motion event.
     * @return True if the event was handled, false otherwise
     */
    public boolean handleTouchEvent(MotionEvent event) {
<span class="nc bnc" id="L190" title="All 10 branches missed.">        return (ListenerUtil.mutListener.listen(12401) ? (handleDrawEvent(event) &amp;&amp; handleMultiTouchEvent(event)) : (handleDrawEvent(event) || handleMultiTouchEvent(event)));</span>
    }

    /**
     * Handle motion events to draw using the touch screen. Only simple touch events are processed,
     * a multitouch event aborts to current stroke.
     *
     * @param event The motion event.
     * @return True if the event was handled, false otherwise or when drawing was aborted due to
     *              detection of a multitouch event.
     */
    private boolean handleDrawEvent(MotionEvent event) {
<span class="nc" id="L202">        float x = event.getX();</span>
<span class="nc" id="L203">        float y = event.getY();</span>
<span class="nc bnc" id="L204" title="All 5 branches missed.">        switch(event.getActionMasked()) {</span>
            case MotionEvent.ACTION_DOWN:
<span class="nc bnc" id="L206" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12402)) {</span>
<span class="nc" id="L207">                    drawStart(x, y);</span>
                }
<span class="nc bnc" id="L209" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12403)) {</span>
<span class="nc" id="L210">                    invalidate();</span>
                }
<span class="nc" id="L212">                return true;</span>
            case MotionEvent.ACTION_MOVE:
<span class="nc bnc" id="L214" title="All 2 branches missed.">                if (mCurrentlyDrawing) {</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(12410)) {</span>
                        {
<span class="nc" id="L217">                            long _loopCounter202 = 0;</span>
<span class="nc bnc" id="L218" title="All 22 branches missed.">                            for (int i = 0; (ListenerUtil.mutListener.listen(12409) ? (i &gt;= event.getHistorySize()) : (ListenerUtil.mutListener.listen(12408) ? (i &lt;= event.getHistorySize()) : (ListenerUtil.mutListener.listen(12407) ? (i &gt; event.getHistorySize()) : (ListenerUtil.mutListener.listen(12406) ? (i != event.getHistorySize()) : (ListenerUtil.mutListener.listen(12405) ? (i == event.getHistorySize()) : (i &lt; event.getHistorySize())))))); i++) {</span>
<span class="nc" id="L219">                                ListenerUtil.loopListener.listen(&quot;_loopCounter202&quot;, ++_loopCounter202);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(12404)) {</span>
<span class="nc" id="L221">                                    drawAlong(event.getHistoricalX(i), event.getHistoricalY(i));</span>
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L226" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(12411)) {</span>
<span class="nc" id="L227">                        drawAlong(x, y);</span>
                    }
<span class="nc bnc" id="L229" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(12412)) {</span>
<span class="nc" id="L230">                        invalidate();</span>
                    }
<span class="nc" id="L232">                    return true;</span>
                }
<span class="nc" id="L234">                return false;</span>
            case MotionEvent.ACTION_UP:
<span class="nc bnc" id="L236" title="All 2 branches missed.">                if (mCurrentlyDrawing) {</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(12413)) {</span>
<span class="nc" id="L238">                        drawFinish();</span>
                    }
<span class="nc bnc" id="L240" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(12414)) {</span>
<span class="nc" id="L241">                        invalidate();</span>
                    }
<span class="nc" id="L243">                    return true;</span>
                }
<span class="nc" id="L245">                return false;</span>
            case MotionEvent.ACTION_POINTER_DOWN:
<span class="nc bnc" id="L247" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12416)) {</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">                    if (mCurrentlyDrawing) {</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12415)) {</span>
<span class="nc" id="L250">                            drawAbort();</span>
                        }
                    }
                }
<span class="nc" id="L254">                return false;</span>
            default:
<span class="nc" id="L256">                return false;</span>
        }
    }

    // Parse multitouch input to scroll the card behind the whiteboard or click on elements
    private boolean handleMultiTouchEvent(MotionEvent event) {
<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12419)) {</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if (event.getPointerCount() == 2) {</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12418)) {</span>
<span class="nc bnc" id="L265" title="All 4 branches missed.">                    switch(event.getActionMasked()) {</span>
                        case MotionEvent.ACTION_POINTER_DOWN:
<span class="nc bnc" id="L267" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(12417)) {</span>
<span class="nc" id="L268">                                reinitializeSecondFinger(event);</span>
                            }
<span class="nc" id="L270">                            return true;</span>
                        case MotionEvent.ACTION_MOVE:
<span class="nc" id="L272">                            return trySecondFingerScroll(event);</span>
                        case MotionEvent.ACTION_POINTER_UP:
<span class="nc" id="L274">                            return trySecondFingerClick(event);</span>
                        default:
<span class="nc" id="L276">                            return false;</span>
                    }
                }
            }
        }
<span class="nc" id="L281">        return false;</span>
    }

    /**
     * Clear the whiteboard.
     */
    public void clear() {
<span class="nc bnc" id="L288" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12420)) {</span>
<span class="nc" id="L289">            mUndoModeActive = false;</span>
        }
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12421)) {</span>
<span class="nc" id="L292">            mBitmap.eraseColor(0);</span>
        }
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12422)) {</span>
<span class="nc" id="L295">            mUndo.clear();</span>
        }
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12423)) {</span>
<span class="nc" id="L298">            invalidate();</span>
        }
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12425)) {</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">            if (mCardViewer.get() != null) {</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12424)) {</span>
<span class="nc" id="L303">                    mCardViewer.get().supportInvalidateOptionsMenu();</span>
                }
            }
        }
<span class="nc" id="L307">    }</span>

    /**
     * Undo the last stroke
     */
    public void undo() {
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12426)) {</span>
<span class="nc" id="L314">            mUndo.pop();</span>
        }
<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12427)) {</span>
<span class="nc" id="L317">            mUndo.apply();</span>
        }
<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12430)) {</span>
<span class="nc bnc" id="L320" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(12428) ? (undoEmpty() || mCardViewer.get() != null) : (undoEmpty() &amp;&amp; mCardViewer.get() != null))) {</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12429)) {</span>
<span class="nc" id="L322">                    mCardViewer.get().supportInvalidateOptionsMenu();</span>
                }
            }
        }
<span class="nc" id="L326">    }</span>

    /**
     * @return Whether there are strokes to undo
     */
    public boolean undoEmpty() {
<span class="nc" id="L332">        return mUndo.empty();</span>
    }

    /**
     * @return true if the undo queue has had any strokes added to it since the last clear
     */
    public boolean isUndoModeActive() {
<span class="nc" id="L339">        return mUndoModeActive;</span>
    }

    private void createBitmap(int w, int h) {
<span class="nc bnc" id="L343" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12431)) {</span>
<span class="nc" id="L344">            mBitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span>
        }
<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12432)) {</span>
<span class="nc" id="L347">            mCanvas = new Canvas(mBitmap);</span>
        }
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12433)) {</span>
<span class="nc" id="L350">            clear();</span>
        }
<span class="nc" id="L352">    }</span>

    private void createBitmap() {
        // To fix issue #1336, just make the whiteboard big and square.
<span class="nc" id="L356">        final Point p = getDisplayDimensions();</span>
<span class="nc" id="L357">        int bitmapSize = Math.max(p.x, p.y);</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12434)) {</span>
<span class="nc" id="L359">            createBitmap(bitmapSize, bitmapSize);</span>
        }
<span class="nc" id="L361">    }</span>

    private void drawStart(float x, float y) {
<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12435)) {</span>
<span class="nc" id="L365">            mCurrentlyDrawing = true;</span>
        }
<span class="nc bnc" id="L367" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12436)) {</span>
<span class="nc" id="L368">            mPath.reset();</span>
        }
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12437)) {</span>
<span class="nc" id="L371">            mPath.moveTo(x, y);</span>
        }
<span class="nc bnc" id="L373" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12438)) {</span>
<span class="nc" id="L374">            mX = x;</span>
        }
<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12439)) {</span>
<span class="nc" id="L377">            mY = y;</span>
        }
<span class="nc" id="L379">    }</span>

    private void drawAlong(float x, float y) {
<span class="nc bnc" id="L382" title="All 8 branches missed.">        float dx = Math.abs((ListenerUtil.mutListener.listen(12443) ? (x % mX) : (ListenerUtil.mutListener.listen(12442) ? (x / mX) : (ListenerUtil.mutListener.listen(12441) ? (x * mX) : (ListenerUtil.mutListener.listen(12440) ? (x + mX) : (x - mX))))));</span>
<span class="nc bnc" id="L383" title="All 8 branches missed.">        float dy = Math.abs((ListenerUtil.mutListener.listen(12447) ? (y % mY) : (ListenerUtil.mutListener.listen(12446) ? (y / mY) : (ListenerUtil.mutListener.listen(12445) ? (y * mY) : (ListenerUtil.mutListener.listen(12444) ? (y + mY) : (y - mY))))));</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12478)) {</span>
<span class="nc bnc" id="L385" title="All 90 branches missed.">            if ((ListenerUtil.mutListener.listen(12458) ? ((ListenerUtil.mutListener.listen(12452) ? (dx &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12451) ? (dx &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12450) ? (dx &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12449) ? (dx != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12448) ? (dx == TOUCH_TOLERANCE) : (dx &gt;= TOUCH_TOLERANCE)))))) &amp;&amp; (ListenerUtil.mutListener.listen(12457) ? (dy &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12456) ? (dy &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12455) ? (dy &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12454) ? (dy != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12453) ? (dy == TOUCH_TOLERANCE) : (dy &gt;= TOUCH_TOLERANCE))))))) : ((ListenerUtil.mutListener.listen(12452) ? (dx &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12451) ? (dx &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12450) ? (dx &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12449) ? (dx != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12448) ? (dx == TOUCH_TOLERANCE) : (dx &gt;= TOUCH_TOLERANCE)))))) || (ListenerUtil.mutListener.listen(12457) ? (dy &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12456) ? (dy &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12455) ? (dy &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12454) ? (dy != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12453) ? (dy == TOUCH_TOLERANCE) : (dy &gt;= TOUCH_TOLERANCE))))))))) {</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12475)) {</span>
<span class="nc bnc" id="L387" title="All 96 branches missed.">                    mPath.quadTo(mX, mY, (ListenerUtil.mutListener.listen(12466) ? (((ListenerUtil.mutListener.listen(12462) ? (x % mX) : (ListenerUtil.mutListener.listen(12461) ? (x / mX) : (ListenerUtil.mutListener.listen(12460) ? (x * mX) : (ListenerUtil.mutListener.listen(12459) ? (x - mX) : (x + mX)))))) % 2) : (ListenerUtil.mutListener.listen(12465) ? (((ListenerUtil.mutListener.listen(12462) ? (x % mX) : (ListenerUtil.mutListener.listen(12461) ? (x / mX) : (ListenerUtil.mutListener.listen(12460) ? (x * mX) : (ListenerUtil.mutListener.listen(12459) ? (x - mX) : (x + mX)))))) * 2) : (ListenerUtil.mutListener.listen(12464) ? (((ListenerUtil.mutListener.listen(12462) ? (x % mX) : (ListenerUtil.mutListener.listen(12461) ? (x / mX) : (ListenerUtil.mutListener.listen(12460) ? (x * mX) : (ListenerUtil.mutListener.listen(12459) ? (x - mX) : (x + mX)))))) - 2) : (ListenerUtil.mutListener.listen(12463) ? (((ListenerUtil.mutListener.listen(12462) ? (x % mX) : (ListenerUtil.mutListener.listen(12461) ? (x / mX) : (ListenerUtil.mutListener.listen(12460) ? (x * mX) : (ListenerUtil.mutListener.listen(12459) ? (x - mX) : (x + mX)))))) + 2) : (((ListenerUtil.mutListener.listen(12462) ? (x % mX) : (ListenerUtil.mutListener.listen(12461) ? (x / mX) : (ListenerUtil.mutListener.listen(12460) ? (x * mX) : (ListenerUtil.mutListener.listen(12459) ? (x - mX) : (x + mX)))))) / 2))))), (ListenerUtil.mutListener.listen(12474) ? (((ListenerUtil.mutListener.listen(12470) ? (y % mY) : (ListenerUtil.mutListener.listen(12469) ? (y / mY) : (ListenerUtil.mutListener.listen(12468) ? (y * mY) : (ListenerUtil.mutListener.listen(12467) ? (y - mY) : (y + mY)))))) % 2) : (ListenerUtil.mutListener.listen(12473) ? (((ListenerUtil.mutListener.listen(12470) ? (y % mY) : (ListenerUtil.mutListener.listen(12469) ? (y / mY) : (ListenerUtil.mutListener.listen(12468) ? (y * mY) : (ListenerUtil.mutListener.listen(12467) ? (y - mY) : (y + mY)))))) * 2) : (ListenerUtil.mutListener.listen(12472) ? (((ListenerUtil.mutListener.listen(12470) ? (y % mY) : (ListenerUtil.mutListener.listen(12469) ? (y / mY) : (ListenerUtil.mutListener.listen(12468) ? (y * mY) : (ListenerUtil.mutListener.listen(12467) ? (y - mY) : (y + mY)))))) - 2) : (ListenerUtil.mutListener.listen(12471) ? (((ListenerUtil.mutListener.listen(12470) ? (y % mY) : (ListenerUtil.mutListener.listen(12469) ? (y / mY) : (ListenerUtil.mutListener.listen(12468) ? (y * mY) : (ListenerUtil.mutListener.listen(12467) ? (y - mY) : (y + mY)))))) + 2) : (((ListenerUtil.mutListener.listen(12470) ? (y % mY) : (ListenerUtil.mutListener.listen(12469) ? (y / mY) : (ListenerUtil.mutListener.listen(12468) ? (y * mY) : (ListenerUtil.mutListener.listen(12467) ? (y - mY) : (y + mY)))))) / 2))))));</span>
                }
<span class="nc bnc" id="L389" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12476)) {</span>
<span class="nc" id="L390">                    mX = x;</span>
                }
<span class="nc bnc" id="L392" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12477)) {</span>
<span class="nc" id="L393">                    mY = y;</span>
                }
            }
        }
<span class="nc" id="L397">    }</span>

    private void drawFinish() {
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12479)) {</span>
<span class="nc" id="L401">            mCurrentlyDrawing = false;</span>
        }
<span class="nc" id="L403">        PathMeasure pm = new PathMeasure(mPath, false);</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12480)) {</span>
<span class="nc" id="L405">            mPath.lineTo(mX, mY);</span>
        }
<span class="nc" id="L407">        Paint paint = new Paint(mPaint);</span>
<span class="nc bnc" id="L408" title="All 22 branches missed.">        WhiteboardAction action = (ListenerUtil.mutListener.listen(12485) ? (pm.getLength() &gt;= 0) : (ListenerUtil.mutListener.listen(12484) ? (pm.getLength() &lt;= 0) : (ListenerUtil.mutListener.listen(12483) ? (pm.getLength() &lt; 0) : (ListenerUtil.mutListener.listen(12482) ? (pm.getLength() != 0) : (ListenerUtil.mutListener.listen(12481) ? (pm.getLength() == 0) : (pm.getLength() &gt; 0)))))) ? new DrawPath(new Path(mPath), paint) : new DrawPoint(mX, mY, paint);</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12486)) {</span>
<span class="nc" id="L410">            action.apply(mCanvas);</span>
        }
<span class="nc bnc" id="L412" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12487)) {</span>
<span class="nc" id="L413">            mUndo.add(action);</span>
        }
<span class="nc bnc" id="L415" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12488)) {</span>
<span class="nc" id="L416">            mUndoModeActive = true;</span>
        }
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12489)) {</span>
            // kill the path so we don't double draw
<span class="nc" id="L420">            mPath.reset();</span>
        }
<span class="nc bnc" id="L422" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12497)) {</span>
<span class="nc bnc" id="L423" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(12495) ? ((ListenerUtil.mutListener.listen(12494) ? (mUndo.size() &gt;= 1) : (ListenerUtil.mutListener.listen(12493) ? (mUndo.size() &lt;= 1) : (ListenerUtil.mutListener.listen(12492) ? (mUndo.size() &gt; 1) : (ListenerUtil.mutListener.listen(12491) ? (mUndo.size() &lt; 1) : (ListenerUtil.mutListener.listen(12490) ? (mUndo.size() != 1) : (mUndo.size() == 1)))))) || mCardViewer.get() != null) : ((ListenerUtil.mutListener.listen(12494) ? (mUndo.size() &gt;= 1) : (ListenerUtil.mutListener.listen(12493) ? (mUndo.size() &lt;= 1) : (ListenerUtil.mutListener.listen(12492) ? (mUndo.size() &gt; 1) : (ListenerUtil.mutListener.listen(12491) ? (mUndo.size() &lt; 1) : (ListenerUtil.mutListener.listen(12490) ? (mUndo.size() != 1) : (mUndo.size() == 1)))))) &amp;&amp; mCardViewer.get() != null))) {</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12496)) {</span>
<span class="nc" id="L425">                    mCardViewer.get().supportInvalidateOptionsMenu();</span>
                }
            }
        }
<span class="nc" id="L429">    }</span>

    private void drawAbort() {
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12498)) {</span>
<span class="nc" id="L433">            drawFinish();</span>
        }
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12499)) {</span>
<span class="nc" id="L436">            undo();</span>
        }
<span class="nc" id="L438">    }</span>

    // a second finger
    private void reinitializeSecondFinger(MotionEvent event) {
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12500)) {</span>
<span class="nc" id="L443">            mSecondFingerWithinTapTolerance = true;</span>
        }
<span class="nc bnc" id="L445" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12501)) {</span>
<span class="nc" id="L446">            mSecondFingerPointerId = event.getPointerId(event.getActionIndex());</span>
        }
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12502)) {</span>
<span class="nc" id="L449">            mSecondFingerX0 = event.getX(event.findPointerIndex(mSecondFingerPointerId));</span>
        }
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12503)) {</span>
<span class="nc" id="L452">            mSecondFingerY0 = event.getY(event.findPointerIndex(mSecondFingerPointerId));</span>
        }
<span class="nc" id="L454">    }</span>

    private boolean updateSecondFinger(MotionEvent event) {
<span class="nc" id="L457">        int pointerIndex = event.findPointerIndex(mSecondFingerPointerId);</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12532)) {</span>
<span class="nc bnc" id="L459" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(12508) ? (pointerIndex &gt;= -1) : (ListenerUtil.mutListener.listen(12507) ? (pointerIndex &lt;= -1) : (ListenerUtil.mutListener.listen(12506) ? (pointerIndex &lt; -1) : (ListenerUtil.mutListener.listen(12505) ? (pointerIndex != -1) : (ListenerUtil.mutListener.listen(12504) ? (pointerIndex == -1) : (pointerIndex &gt; -1))))))) {</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12509)) {</span>
<span class="nc" id="L461">                    mSecondFingerX = event.getX(pointerIndex);</span>
                }
<span class="nc bnc" id="L463" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12510)) {</span>
<span class="nc" id="L464">                    mSecondFingerY = event.getY(pointerIndex);</span>
                }
<span class="nc bnc" id="L466" title="All 8 branches missed.">                float dx = Math.abs((ListenerUtil.mutListener.listen(12514) ? (mSecondFingerX0 % mSecondFingerX) : (ListenerUtil.mutListener.listen(12513) ? (mSecondFingerX0 / mSecondFingerX) : (ListenerUtil.mutListener.listen(12512) ? (mSecondFingerX0 * mSecondFingerX) : (ListenerUtil.mutListener.listen(12511) ? (mSecondFingerX0 + mSecondFingerX) : (mSecondFingerX0 - mSecondFingerX))))));</span>
<span class="nc bnc" id="L467" title="All 8 branches missed.">                float dy = Math.abs((ListenerUtil.mutListener.listen(12518) ? (mSecondFingerY0 % mSecondFingerY) : (ListenerUtil.mutListener.listen(12517) ? (mSecondFingerY0 / mSecondFingerY) : (ListenerUtil.mutListener.listen(12516) ? (mSecondFingerY0 * mSecondFingerY) : (ListenerUtil.mutListener.listen(12515) ? (mSecondFingerY0 + mSecondFingerY) : (mSecondFingerY0 - mSecondFingerY))))));</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12531)) {</span>
<span class="nc bnc" id="L469" title="All 90 branches missed.">                    if ((ListenerUtil.mutListener.listen(12529) ? ((ListenerUtil.mutListener.listen(12523) ? (dx &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12522) ? (dx &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12521) ? (dx &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12520) ? (dx != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12519) ? (dx == TOUCH_TOLERANCE) : (dx &gt;= TOUCH_TOLERANCE)))))) &amp;&amp; (ListenerUtil.mutListener.listen(12528) ? (dy &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12527) ? (dy &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12526) ? (dy &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12525) ? (dy != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12524) ? (dy == TOUCH_TOLERANCE) : (dy &gt;= TOUCH_TOLERANCE))))))) : ((ListenerUtil.mutListener.listen(12523) ? (dx &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12522) ? (dx &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12521) ? (dx &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12520) ? (dx != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12519) ? (dx == TOUCH_TOLERANCE) : (dx &gt;= TOUCH_TOLERANCE)))))) || (ListenerUtil.mutListener.listen(12528) ? (dy &lt;= TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12527) ? (dy &gt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12526) ? (dy &lt; TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12525) ? (dy != TOUCH_TOLERANCE) : (ListenerUtil.mutListener.listen(12524) ? (dy == TOUCH_TOLERANCE) : (dy &gt;= TOUCH_TOLERANCE))))))))) {</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12530)) {</span>
<span class="nc" id="L471">                            mSecondFingerWithinTapTolerance = false;</span>
                        }
                    }
                }
<span class="nc" id="L475">                return true;</span>
            }
        }
<span class="nc" id="L478">        return false;</span>
    }

    // if so, forward a click action and return true
    private boolean trySecondFingerClick(MotionEvent event) {
<span class="nc bnc" id="L483" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12537)) {</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">            if (mSecondFingerPointerId == event.getPointerId(event.getActionIndex())) {</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12533)) {</span>
<span class="nc" id="L486">                    updateSecondFinger(event);</span>
                }
<span class="nc" id="L488">                AbstractFlashcardViewer cardViewer = mCardViewer.get();</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12536)) {</span>
<span class="nc bnc" id="L490" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(12534) ? (mSecondFingerWithinTapTolerance || cardViewer != null) : (mSecondFingerWithinTapTolerance &amp;&amp; cardViewer != null))) {</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12535)) {</span>
<span class="nc" id="L492">                            cardViewer.tapOnCurrentCard((int) mSecondFingerX, (int) mSecondFingerY);</span>
                        }
<span class="nc" id="L494">                        return true;</span>
                    }
                }
            }
        }
<span class="nc" id="L499">        return false;</span>
    }

    // in this case perform a scroll action
    private boolean trySecondFingerScroll(MotionEvent event) {
<span class="nc bnc" id="L504" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12553)) {</span>
<span class="nc bnc" id="L505" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(12538) ? (updateSecondFinger(event) || !mSecondFingerWithinTapTolerance) : (updateSecondFinger(event) &amp;&amp; !mSecondFingerWithinTapTolerance))) {</span>
<span class="nc bnc" id="L506" title="All 8 branches missed.">                int dy = (int) ((ListenerUtil.mutListener.listen(12542) ? (mSecondFingerY0 % mSecondFingerY) : (ListenerUtil.mutListener.listen(12541) ? (mSecondFingerY0 / mSecondFingerY) : (ListenerUtil.mutListener.listen(12540) ? (mSecondFingerY0 * mSecondFingerY) : (ListenerUtil.mutListener.listen(12539) ? (mSecondFingerY0 + mSecondFingerY) : (mSecondFingerY0 - mSecondFingerY))))));</span>
<span class="nc" id="L507">                AbstractFlashcardViewer cardViewer = mCardViewer.get();</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12552)) {</span>
<span class="nc bnc" id="L509" title="All 50 branches missed.">                    if ((ListenerUtil.mutListener.listen(12548) ? ((ListenerUtil.mutListener.listen(12547) ? (dy &gt;= 0) : (ListenerUtil.mutListener.listen(12546) ? (dy &lt;= 0) : (ListenerUtil.mutListener.listen(12545) ? (dy &gt; 0) : (ListenerUtil.mutListener.listen(12544) ? (dy &lt; 0) : (ListenerUtil.mutListener.listen(12543) ? (dy == 0) : (dy != 0)))))) || cardViewer != null) : ((ListenerUtil.mutListener.listen(12547) ? (dy &gt;= 0) : (ListenerUtil.mutListener.listen(12546) ? (dy &lt;= 0) : (ListenerUtil.mutListener.listen(12545) ? (dy &gt; 0) : (ListenerUtil.mutListener.listen(12544) ? (dy &lt; 0) : (ListenerUtil.mutListener.listen(12543) ? (dy == 0) : (dy != 0)))))) &amp;&amp; cardViewer != null))) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12549)) {</span>
<span class="nc" id="L511">                            cardViewer.scrollCurrentCardBy(dy);</span>
                        }
<span class="nc bnc" id="L513" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12550)) {</span>
<span class="nc" id="L514">                            mSecondFingerX0 = mSecondFingerX;</span>
                        }
<span class="nc bnc" id="L516" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12551)) {</span>
<span class="nc" id="L517">                            mSecondFingerY0 = mSecondFingerY;</span>
                        }
                    }
                }
<span class="nc" id="L521">                return true;</span>
            }
        }
<span class="nc" id="L524">        return false;</span>
    }

    private static Point getDisplayDimensions() {
<span class="nc" id="L528">        Display display = ((WindowManager) AnkiDroidApp.getInstance().getApplicationContext().getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();</span>
<span class="nc" id="L529">        Point point = new Point();</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12554)) {</span>
<span class="nc" id="L531">            display.getSize(point);</span>
        }
<span class="nc" id="L533">        return point;</span>
    }

    public void onClick(View view) {
<span class="nc" id="L537">        int id = view.getId();</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12561)) {</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">            if (id == R.id.pen_color_white) {</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12560)) {</span>
<span class="nc" id="L541">                    setPenColor(Color.WHITE);</span>
                }
<span class="nc bnc" id="L543" title="All 2 branches missed.">            } else if (id == R.id.pen_color_black) {</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12559)) {</span>
<span class="nc" id="L545">                    setPenColor(Color.BLACK);</span>
                }
<span class="nc bnc" id="L547" title="All 2 branches missed.">            } else if (id == R.id.pen_color_red) {</span>
<span class="nc" id="L548">                int redPenColor = ContextCompat.getColor(getContext(), R.color.material_red_500);</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12558)) {</span>
<span class="nc" id="L550">                    setPenColor(redPenColor);</span>
                }
<span class="nc bnc" id="L552" title="All 2 branches missed.">            } else if (id == R.id.pen_color_green) {</span>
<span class="nc" id="L553">                int greenPenColor = ContextCompat.getColor(getContext(), R.color.material_green_500);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12557)) {</span>
<span class="nc" id="L555">                    setPenColor(greenPenColor);</span>
                }
<span class="nc bnc" id="L557" title="All 2 branches missed.">            } else if (id == R.id.pen_color_blue) {</span>
<span class="nc" id="L558">                int bluePenColor = ContextCompat.getColor(getContext(), R.color.material_blue_500);</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12556)) {</span>
<span class="nc" id="L560">                    setPenColor(bluePenColor);</span>
                }
<span class="nc bnc" id="L562" title="All 2 branches missed.">            } else if (id == R.id.pen_color_yellow) {</span>
<span class="nc" id="L563">                int yellowPenColor = ContextCompat.getColor(getContext(), R.color.material_yellow_500);</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12555)) {</span>
<span class="nc" id="L565">                    setPenColor(yellowPenColor);</span>
                }
            }
        }
<span class="nc" id="L569">    }</span>

    public void setPenColor(int color) {
<span class="nc bnc" id="L572" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12562)) {</span>
<span class="nc" id="L573">            Timber.d(&quot;Setting pen color to %d&quot;, color);</span>
        }
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12563)) {</span>
<span class="nc" id="L576">            mPaint.setColor(color);</span>
        }
<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12564)) {</span>
<span class="nc" id="L579">            mColorPalette.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12566)) {</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">            if (mOnPaintColorChangeListener != null) {</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12565)) {</span>
<span class="nc" id="L584">                    mOnPaintColorChangeListener.onPaintColorChange(color);</span>
                }
            }
        }
<span class="nc" id="L588">    }</span>

    @VisibleForTesting
    public int getPenColor() {
<span class="nc" id="L592">        return mPaint.getColor();</span>
    }

    public void setOnPaintColorChangeListener(@Nullable OnPaintColorChangeListener mOnPaintColorChangeListener) {
<span class="nc bnc" id="L596" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12567)) {</span>
<span class="nc" id="L597">            this.mOnPaintColorChangeListener = mOnPaintColorChangeListener;</span>
        }
<span class="nc" id="L599">    }</span>

    /**
     * Keep a stack of all points and paths so that the last stroke can be undone
     * pop() removes the last stroke from the stack, and apply() redraws it to whiteboard.
     */
<span class="nc" id="L605">    private class UndoStack {</span>

<span class="nc" id="L607">        private final Stack&lt;WhiteboardAction&gt; mStack = new Stack&lt;&gt;();</span>

        public void add(WhiteboardAction action) {
<span class="nc bnc" id="L610" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12568)) {</span>
<span class="nc" id="L611">                mStack.add(action);</span>
            }
<span class="nc" id="L613">        }</span>

        public void clear() {
<span class="nc bnc" id="L616" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12569)) {</span>
<span class="nc" id="L617">                mStack.clear();</span>
            }
<span class="nc" id="L619">        }</span>

        public int size() {
<span class="nc" id="L622">            return mStack.size();</span>
        }

        public void pop() {
<span class="nc bnc" id="L626" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12570)) {</span>
<span class="nc" id="L627">                mStack.pop();</span>
            }
<span class="nc" id="L629">        }</span>

        public void apply() {
<span class="nc bnc" id="L632" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12571)) {</span>
<span class="nc" id="L633">                mBitmap.eraseColor(0);</span>
            }
<span class="nc bnc" id="L635" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12573)) {</span>
                {
<span class="nc" id="L637">                    long _loopCounter203 = 0;</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">                    for (WhiteboardAction action : mStack) {</span>
<span class="nc" id="L639">                        ListenerUtil.loopListener.listen(&quot;_loopCounter203&quot;, ++_loopCounter203);</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(12572)) {</span>
<span class="nc" id="L641">                            action.apply(mCanvas);</span>
                        }
<span class="nc" id="L643">                    }</span>
                }
            }
<span class="nc bnc" id="L646" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12574)) {</span>
<span class="nc" id="L647">                invalidate();</span>
            }
<span class="nc" id="L649">        }</span>

        public boolean empty() {
<span class="nc" id="L652">            return mStack.empty();</span>
        }
    }

    private interface WhiteboardAction {

        void apply(@NonNull Canvas canvas);
    }

    private static class DrawPoint implements WhiteboardAction {

        private final float mX;

        private final float mY;

        private final Paint mPaint;

<span class="nc" id="L669">        public DrawPoint(float x, float y, Paint paint) {</span>
<span class="nc" id="L670">            mX = x;</span>
<span class="nc" id="L671">            mY = y;</span>
<span class="nc" id="L672">            mPaint = paint;</span>
<span class="nc" id="L673">        }</span>

        @Override
        public void apply(@NonNull Canvas canvas) {
<span class="nc bnc" id="L677" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12575)) {</span>
<span class="nc" id="L678">                canvas.drawPoint(mX, mY, mPaint);</span>
            }
<span class="nc" id="L680">        }</span>
    }

    private static class DrawPath implements WhiteboardAction {

        private final Path mPath;

        private final Paint mPaint;

<span class="nc" id="L689">        public DrawPath(Path path, Paint paint) {</span>
<span class="nc" id="L690">            mPath = path;</span>
<span class="nc" id="L691">            mPaint = paint;</span>
<span class="nc" id="L692">        }</span>

        @Override
        public void apply(@NonNull Canvas canvas) {
<span class="nc bnc" id="L696" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(12576)) {</span>
<span class="nc" id="L697">                canvas.drawPath(mPath, mPaint);</span>
            }
<span class="nc" id="L699">        }</span>
    }

    public boolean isCurrentlyDrawing() {
<span class="nc" id="L703">        return mCurrentlyDrawing;</span>
    }

    // TODO Tracked in https://github.com/ankidroid/Anki-Android/issues/5304
    @SuppressWarnings({ &quot;deprecation&quot;, &quot;RedundantSuppression&quot; })
    protected String saveWhiteboard(Time time) throws FileNotFoundException {
<span class="nc" id="L709">        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);</span>
<span class="nc" id="L710">        Canvas canvas = new Canvas(bitmap);</span>
<span class="nc" id="L711">        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);</span>
<span class="nc" id="L712">        File ankiDroidFolder = new File(pictures, &quot;AnkiDroid&quot;);</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12578)) {</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">            if (!ankiDroidFolder.exists()) {</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12577)) {</span>
                    // noinspection ResultOfMethodCallIgnored
<span class="nc" id="L717">                    ankiDroidFolder.mkdirs();</span>
                }
            }
        }
<span class="nc" id="L721">        String baseFileName = &quot;Whiteboard&quot;;</span>
<span class="nc" id="L722">        String timeStamp = TimeUtils.getTimestamp(time);</span>
<span class="nc" id="L723">        String finalFileName = baseFileName + timeStamp + &quot;.png&quot;;</span>
<span class="nc" id="L724">        File saveWhiteboardImageFile = new File(ankiDroidFolder, finalFileName);</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12581)) {</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">            if (foregroundColor != Color.BLACK) {</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12580)) {</span>
<span class="nc" id="L728">                    canvas.drawColor(Color.BLACK);</span>
                }
            } else {
<span class="nc bnc" id="L731" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(12579)) {</span>
<span class="nc" id="L732">                    canvas.drawColor(Color.WHITE);</span>
                }
            }
        }
<span class="nc bnc" id="L736" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12582)) {</span>
<span class="nc" id="L737">            this.draw(canvas);</span>
        }
<span class="nc bnc" id="L739" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(12583)) {</span>
<span class="nc" id="L740">            bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveWhiteboardImageFile));</span>
        }
<span class="nc" id="L742">        return saveWhiteboardImageFile.getAbsolutePath();</span>
    }

    @VisibleForTesting
    @CheckResult
    protected int getForegroundColor() {
<span class="nc" id="L748">        return foregroundColor;</span>
    }

    public interface OnPaintColorChangeListener {

        void onPaintColorChange(@Nullable Integer color);
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>