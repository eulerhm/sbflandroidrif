<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CsvReaderIterator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.libanki.importer.python</a> &gt; <span class="el_source">CsvReaderIterator.java</span></div><h1>CsvReaderIterator.java</h1><pre class="source lang-java linenums">/*
 Copyright (c) 2020 David Allison &lt;davidallisongithub@gmail.com&gt;

 This program is free software; you can redistribute it and/or modify it under
 the terms of the GNU General Public License as published by the Free Software
 Foundation; either version 3 of the License, or (at your option) any later
 version.

 This program is distributed in the hope that it will be useful, but WITHOUT ANY
 WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 PARTICULAR PURPOSE. See the GNU General Public License for more details.

 You should have received a copy of the GNU General Public License along with
 this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

 This file incorporates work covered by the following copyright and permission notice.
 Please see the file LICENSE in this directory for full details

 Ported from https://github.com/python/cpython/blob/c88239f864a27f673c0f0a9e62d2488563f9d081/Modules/_csv.c
 */
package com.ichi2.libanki.importer.python;

import com.ichi2.libanki.importer.CsvException;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import timber.log.Timber;
import static com.ichi2.libanki.importer.python.CsvDialect.Quoting.*;
import static com.ichi2.libanki.importer.python.CsvReaderIterator.State.*;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class CsvReaderIterator implements Iterator&lt;List&lt;String&gt;&gt; {

    private final CsvReader reader;

    private int field_len;

    private State state;

    private int line_num;

    private List&lt;String&gt; fields;

    private int numeric_field;

    private static final int field_size = 5000;

    // These were modified from a bare array and size to a StringBuilder
<span class="fc" id="L51">    private final char[] field = new char[field_size];</span>

<span class="fc" id="L53">    public CsvReaderIterator(@NonNull CsvReader reader) {</span>
<span class="fc" id="L54">        this.reader = reader;</span>
<span class="fc" id="L55">    }</span>

    @Override
    public boolean hasNext() {
<span class="fc" id="L59">        return this.reader.input_iter.hasNext();</span>
    }

<span class="fc" id="L62">    enum State {</span>

<span class="fc" id="L64">        START_RECORD,</span>
<span class="fc" id="L65">        START_FIELD,</span>
<span class="fc" id="L66">        IN_QUOTED_FIELD,</span>
<span class="fc" id="L67">        EAT_CRNL,</span>
<span class="fc" id="L68">        AFTER_ESCAPED_CRNL,</span>
<span class="fc" id="L69">        ESCAPED_CHAR,</span>
<span class="fc" id="L70">        IN_FIELD,</span>
<span class="fc" id="L71">        ESCAPE_IN_QUOTED_FIELD,</span>
<span class="fc" id="L72">        QUOTE_IN_QUOTED_FIELD</span>
    }

    private int parse_save_field() {
        // ignored field.length
<span class="fc" id="L77">        String field = new String(this.field, 0, this.field_len);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13304)) {</span>
<span class="fc" id="L79">            this.field_len = 0;</span>
        }
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13311)) {</span>
<span class="pc bpc" id="L82" title="16 of 22 branches missed.">            if ((ListenerUtil.mutListener.listen(13309) ? (this.numeric_field &gt;= 0) : (ListenerUtil.mutListener.listen(13308) ? (this.numeric_field &lt;= 0) : (ListenerUtil.mutListener.listen(13307) ? (this.numeric_field &gt; 0) : (ListenerUtil.mutListener.listen(13306) ? (this.numeric_field &lt; 0) : (ListenerUtil.mutListener.listen(13305) ? (this.numeric_field == 0) : (this.numeric_field != 0))))))) {</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(13310)) {</span>
<span class="nc" id="L84">                    Timber.w(&quot;skipping numeric field&quot;);</span>
                }
            }
        }
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13312)) {</span>
<span class="fc" id="L89">            this.fields.add(field);</span>
        }
<span class="fc" id="L91">        return 0;</span>
    }

    private int parse_add_char(char c) {
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13318)) {</span>
            // }
<span class="pc bpc" id="L97" title="16 of 22 branches missed.">            if ((ListenerUtil.mutListener.listen(13317) ? (this.field_len &gt;= field_size) : (ListenerUtil.mutListener.listen(13316) ? (this.field_len &lt;= field_size) : (ListenerUtil.mutListener.listen(13315) ? (this.field_len &gt; field_size) : (ListenerUtil.mutListener.listen(13314) ? (this.field_len &lt; field_size) : (ListenerUtil.mutListener.listen(13313) ? (this.field_len != field_size) : (this.field_len == field_size)))))))</span>
<span class="nc" id="L98">                return -1;</span>
        }
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13319)) {</span>
<span class="fc" id="L101">            this.field[this.field_len++] = c;</span>
        }
<span class="fc" id="L103">        return 0;</span>
    }

    void parse_reset() {
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13320)) {</span>
<span class="fc" id="L108">            this.fields = new ArrayList&lt;&gt;();</span>
        }
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13321)) {</span>
<span class="fc" id="L111">            this.field_len = 0;</span>
        }
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13322)) {</span>
<span class="fc" id="L114">            this.state = START_RECORD;</span>
        }
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13323)) {</span>
<span class="fc" id="L117">            this.numeric_field = 0;</span>
        }
<span class="fc" id="L119">    }</span>

    // noinspection ControlFlowStatementWithoutBraces
    // Copied from C code
    @SuppressWarnings({ &quot;fallthrough&quot;, &quot;RedundantSuppression&quot; })
    private int parse_process_char(char c) {
<span class="fc" id="L125">        CsvDialect dialect = this.reader.dialect;</span>
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13458)) {</span>
<span class="pc bpc" id="L127" title="4 of 10 branches missed.">            switch(this.state) {</span>
                case START_RECORD:
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13326)) {</span>
                        /* start of record */
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">                        if (c == '\0')</span>
                            /* empty line - return [] */
<span class="nc" id="L133">                            break;</span>
<span class="pc bpc" id="L134" title="7 of 10 branches missed.">                        else if ((ListenerUtil.mutListener.listen(13324) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r'))) {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13325)) {</span>
<span class="nc" id="L136">                                this.state = EAT_CRNL;</span>
                            }
                            break;
                        }
                    }
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13327)) {</span>
                        /* normal character - handle as START_FIELD */
<span class="fc" id="L143">                        this.state = START_FIELD;</span>
                    }
                /* fallthru */
                case START_FIELD:
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13356)) {</span>
                        /* expecting field */
<span class="pc bpc" id="L149" title="21 of 26 branches missed.">                        if ((ListenerUtil.mutListener.listen(13329) ? ((ListenerUtil.mutListener.listen(13328) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) &amp;&amp; c == '\0') : ((ListenerUtil.mutListener.listen(13328) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) || c == '\0'))) {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13354)) {</span>
                                /* save empty field - return [fields] */
<span class="nc bnc" id="L152" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13353) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13352) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13351) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13350) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13349) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L153">                                    return -1;</span>
                            }
<span class="nc bnc" id="L155" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13355)) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">                                this.state = (c == '\0' ? START_RECORD : EAT_CRNL);</span>
                            }
<span class="pc bpc" id="L158" title="6 of 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(13330) ? (c == dialect.mQuotechar || dialect.mQuoting != QUOTE_NONE) : (c == dialect.mQuotechar &amp;&amp; dialect.mQuoting != QUOTE_NONE))) {</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13348)) {</span>
                                /* start quoted field */
<span class="fc" id="L161">                                this.state = IN_QUOTED_FIELD;</span>
                            }
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">                        } else if (c == dialect.mEscapechar) {</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13347)) {</span>
                                /* possible escaped character */
<span class="nc" id="L166">                                this.state = ESCAPED_CHAR;</span>
                            }
<span class="pc bpc" id="L168" title="6 of 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(13331) ? (c == ' ' || dialect.mSkipInitialSpace) : (c == ' ' &amp;&amp; dialect.mSkipInitialSpace)))</span>
                            /* ignore space at start of field */
<span class="fc" id="L170">                            ;</span>
<span class="pc bpc" id="L171" title="1 of 2 branches missed.">                        else if (c == dialect.mDelimiter) {</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13346)) {</span>
                                /* save empty field */
<span class="nc bnc" id="L174" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13345) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13344) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13343) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13342) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13341) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L175">                                    return -1;</span>
                            }
                        } else {
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13333)) {</span>
                                /* begin new unquoted field */
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">                                if (dialect.mQuoting == QUOTE_NONNUMERIC)</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(13332)) {</span>
<span class="nc" id="L182">                                        this.numeric_field = 1;</span>
                                    }
                            }
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13339)) {</span>
<span class="pc bpc" id="L186" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13338) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13337) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13336) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13335) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13334) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L187">                                    return -1;</span>
                            }
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13340)) {</span>
<span class="fc" id="L190">                                this.state = IN_FIELD;</span>
                            }
                        }
                    }
                    break;
                case ESCAPED_CHAR:
<span class="nc bnc" id="L196" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13365)) {</span>
<span class="nc bnc" id="L197" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(13357) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r'))) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13363)) {</span>
<span class="nc bnc" id="L199" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13362) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13361) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13360) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13359) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13358) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L200">                                    return -1;</span>
                            }
<span class="nc bnc" id="L202" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13364)) {</span>
<span class="nc" id="L203">                                this.state = AFTER_ESCAPED_CRNL;</span>
                            }
                            break;
                        }
                    }
<span class="nc bnc" id="L208" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13367)) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                        if (c == '\0')</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13366)) {</span>
<span class="nc" id="L211">                                c = '\n';</span>
                            }
                    }
<span class="nc bnc" id="L214" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13373)) {</span>
<span class="nc bnc" id="L215" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(13372) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13371) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13370) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13369) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13368) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L216">                            return -1;</span>
                    }
<span class="nc bnc" id="L218" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13374)) {</span>
<span class="nc" id="L219">                        this.state = IN_FIELD;</span>
                    }
                    break;
                case AFTER_ESCAPED_CRNL:
<span class="nc bnc" id="L223" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13375)) {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">                        if (c == '\0')</span>
<span class="nc" id="L225">                            break;</span>
                    }
                case IN_FIELD:
<span class="pc bpc" id="L228" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13399)) {</span>
                        /* in unquoted field */
<span class="pc bpc" id="L230" title="20 of 26 branches missed.">                        if ((ListenerUtil.mutListener.listen(13377) ? ((ListenerUtil.mutListener.listen(13376) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) &amp;&amp; c == '\0') : ((ListenerUtil.mutListener.listen(13376) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) || c == '\0'))) {</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13397)) {</span>
                                /* end of line - return [fields] */
<span class="pc bpc" id="L233" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13396) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13395) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13394) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13393) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13392) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L234">                                    return -1;</span>
                            }
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13398)) {</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">                                this.state = (c == '\0' ? START_RECORD : EAT_CRNL);</span>
                            }
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">                        } else if (c == dialect.mEscapechar) {</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13391)) {</span>
                                /* possible escaped character */
<span class="nc" id="L242">                                this.state = ESCAPED_CHAR;</span>
                            }
<span class="fc bfc" id="L244" title="All 2 branches covered.">                        } else if (c == dialect.mDelimiter) {</span>
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13389)) {</span>
                                /* save field - wait for new field */
<span class="pc bpc" id="L247" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13388) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13387) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13386) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13385) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13384) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L248">                                    return -1;</span>
                            }
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13390)) {</span>
<span class="fc" id="L251">                                this.state = START_FIELD;</span>
                            }
                        } else {
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13383)) {</span>
                                /* normal character - save in field */
<span class="pc bpc" id="L256" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13382) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13381) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13380) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13379) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13378) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L257">                                    return -1;</span>
                            }
                        }
                    }
                    break;
                case IN_QUOTED_FIELD:
<span class="pc bpc" id="L263" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13411)) {</span>
                        /* in quoted field */
<span class="fc bfc" id="L265" title="All 2 branches covered.">                        if (c == '\0')</span>
<span class="fc" id="L266">                            ;</span>
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">                        else if (c == dialect.mEscapechar) {</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13410)) {</span>
                                /* Possible escape character */
<span class="nc" id="L270">                                this.state = ESCAPE_IN_QUOTED_FIELD;</span>
                            }
<span class="pc bpc" id="L272" title="6 of 10 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(13400) ? (c == dialect.mQuotechar || dialect.mQuoting != QUOTE_NONE) : (c == dialect.mQuotechar &amp;&amp; dialect.mQuoting != QUOTE_NONE))) {</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13409)) {</span>
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">                                if (dialect.mDoublequote) {</span>
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(13408)) {</span>
                                        /* doublequote; &quot; represented by &quot;&quot; */
<span class="fc" id="L277">                                        this.state = QUOTE_IN_QUOTED_FIELD;</span>
                                    }
                                } else {
<span class="nc bnc" id="L280" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(13407)) {</span>
                                        /* end of quote part of field */
<span class="nc" id="L282">                                        this.state = IN_FIELD;</span>
                                    }
                                }
                            }
                        } else {
<span class="pc bpc" id="L287" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13406)) {</span>
                                /* normal character - save in field */
<span class="pc bpc" id="L289" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13405) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13404) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13403) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13402) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13401) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L290">                                    return -1;</span>
                            }
                        }
                    }
                    break;
                case ESCAPE_IN_QUOTED_FIELD:
<span class="nc bnc" id="L296" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13413)) {</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                        if (c == '\0')</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13412)) {</span>
<span class="nc" id="L299">                                c = '\n';</span>
                            }
                    }
<span class="nc bnc" id="L302" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13419)) {</span>
<span class="nc bnc" id="L303" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(13418) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13417) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13416) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13415) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13414) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L304">                            return -1;</span>
                    }
<span class="nc bnc" id="L306" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13420)) {</span>
<span class="nc" id="L307">                        this.state = IN_QUOTED_FIELD;</span>
                    }
                    break;
                case QUOTE_IN_QUOTED_FIELD:
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13453)) {</span>
                        /* doublequote - seen a quote in a quoted field */
<span class="pc bpc" id="L313" title="7 of 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(13421) ? (dialect.mQuoting != QUOTE_NONE || c == dialect.mQuotechar) : (dialect.mQuoting != QUOTE_NONE &amp;&amp; c == dialect.mQuotechar))) {</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13451)) {</span>
                                /* save &quot;&quot; as &quot; */
<span class="nc bnc" id="L316" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13450) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13449) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13448) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13447) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13446) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L317">                                    return -1;</span>
                            }
<span class="nc bnc" id="L319" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13452)) {</span>
<span class="nc" id="L320">                                this.state = IN_QUOTED_FIELD;</span>
                            }
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">                        } else if (c == dialect.mDelimiter) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13444)) {</span>
                                /* save field - wait for new field */
<span class="nc bnc" id="L325" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13443) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13442) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13441) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13440) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13439) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L326">                                    return -1;</span>
                            }
<span class="nc bnc" id="L328" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13445)) {</span>
<span class="nc" id="L329">                                this.state = START_FIELD;</span>
                            }
<span class="pc bpc" id="L331" title="23 of 26 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(13423) ? ((ListenerUtil.mutListener.listen(13422) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) &amp;&amp; c == '\0') : ((ListenerUtil.mutListener.listen(13422) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')) || c == '\0'))) {</span>
<span class="pc bpc" id="L332" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13437)) {</span>
                                /* end of line - return [fields] */
<span class="pc bpc" id="L334" title="16 of 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13436) ? (parse_save_field() &gt;= 0) : (ListenerUtil.mutListener.listen(13435) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13434) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13433) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13432) ? (parse_save_field() == 0) : (parse_save_field() &lt; 0)))))))</span>
<span class="nc" id="L335">                                    return -1;</span>
                            }
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13438)) {</span>
<span class="pc bpc" id="L338" title="1 of 2 branches missed.">                                this.state = (c == '\0' ? START_RECORD : EAT_CRNL);</span>
                            }
<span class="nc" id="L340">                        } else if (!dialect.mStrict) {</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13430)) {</span>
<span class="nc bnc" id="L342" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(13429) ? (parse_add_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13428) ? (parse_add_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13427) ? (parse_add_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13426) ? (parse_add_char(c) != 0) : (ListenerUtil.mutListener.listen(13425) ? (parse_add_char(c) == 0) : (parse_add_char(c) &lt; 0)))))))</span>
<span class="nc" id="L343">                                    return -1;</span>
                            }
<span class="nc bnc" id="L345" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13431)) {</span>
<span class="nc" id="L346">                                this.state = IN_FIELD;</span>
                            }
                        } else {
                            if (!ListenerUtil.mutListener.listen(13424)) {
                                /* illegal */
                                Timber.w(&quot;'%c' expected after '%c'&quot;, dialect.mDelimiter, dialect.mQuotechar);
                            }
                            return -1;
                        }
                    }
                    break;
                case EAT_CRNL:
<span class="pc bpc" id="L358" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13457)) {</span>
<span class="pc bpc" id="L359" title="7 of 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(13454) ? (c == '\n' &amp;&amp; c == '\r') : (c == '\n' || c == '\r')))</span>
<span class="nc" id="L360">                            ;</span>
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">                        else if (c == '\0') {</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13456)) {</span>
<span class="fc" id="L363">                                this.state = START_RECORD;</span>
                            }
                        } else {
<span class="nc bnc" id="L366" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13455)) {</span>
<span class="nc" id="L367">                                Timber.w(&quot;new-line character seen in unquoted field - do you need to open the file in universal-newline mode?&quot;);</span>
                            }
<span class="nc" id="L369">                            return -1;</span>
                        }
                    }
                    break;
            }
        }
<span class="fc" id="L375">        return 0;</span>
    }

    @Override
    @Nullable
    public List&lt;String&gt; next() {
<span class="pc bpc" id="L381" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13459)) {</span>
<span class="fc" id="L382">            parse_reset();</span>
        }
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13495)) {</span>
            {
<span class="fc" id="L386">                long _loopCounter240 = 0;</span>
                do {
<span class="fc" id="L388">                    ListenerUtil.loopListener.listen(&quot;_loopCounter240&quot;, ++_loopCounter240);</span>
<span class="pc bpc" id="L389" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13473)) {</span>
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">                        if (!reader.input_iter.hasNext()) {</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(13472)) {</span>
<span class="nc bnc" id="L392" title="All 50 branches missed.">                                if ((ListenerUtil.mutListener.listen(13465) ? ((ListenerUtil.mutListener.listen(13464) ? (this.field_len &gt;= 0) : (ListenerUtil.mutListener.listen(13463) ? (this.field_len &lt;= 0) : (ListenerUtil.mutListener.listen(13462) ? (this.field_len &gt; 0) : (ListenerUtil.mutListener.listen(13461) ? (this.field_len &lt; 0) : (ListenerUtil.mutListener.listen(13460) ? (this.field_len == 0) : (this.field_len != 0)))))) &amp;&amp; this.state == IN_QUOTED_FIELD) : ((ListenerUtil.mutListener.listen(13464) ? (this.field_len &gt;= 0) : (ListenerUtil.mutListener.listen(13463) ? (this.field_len &lt;= 0) : (ListenerUtil.mutListener.listen(13462) ? (this.field_len &gt; 0) : (ListenerUtil.mutListener.listen(13461) ? (this.field_len &lt; 0) : (ListenerUtil.mutListener.listen(13460) ? (this.field_len == 0) : (this.field_len != 0)))))) || this.state == IN_QUOTED_FIELD))) {</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(13471)) {</span>
<span class="nc" id="L394">                                        if (this.reader.dialect.mStrict) {</span>
                                            throw new CsvException(&quot;unexpected end of data&quot;);
<span class="nc bnc" id="L396" title="All 22 branches missed.">                                        } else if ((ListenerUtil.mutListener.listen(13470) ? (parse_save_field() &lt;= 0) : (ListenerUtil.mutListener.listen(13469) ? (parse_save_field() &gt; 0) : (ListenerUtil.mutListener.listen(13468) ? (parse_save_field() &lt; 0) : (ListenerUtil.mutListener.listen(13467) ? (parse_save_field() != 0) : (ListenerUtil.mutListener.listen(13466) ? (parse_save_field() == 0) : (parse_save_field() &gt;= 0))))))) {</span>
<span class="nc" id="L397">                                            break;</span>
                                        }
                                    }
                                }
                            }
                        }
                    }
<span class="fc" id="L404">                    String lineobj = this.reader.input_iter.next();</span>
<span class="pc bpc" id="L405" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13474)) {</span>
<span class="fc" id="L406">                        line_num++;</span>
                    }
<span class="fc" id="L408">                    int pos = 0;</span>
<span class="fc" id="L409">                    int linelen = lineobj.length();</span>
<span class="pc bpc" id="L410" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13488)) {</span>
                        {
<span class="fc" id="L412">                            long _loopCounter239 = 0;</span>
<span class="pc bpc" id="L413" title="15 of 22 branches missed.">                            while ((ListenerUtil.mutListener.listen(13487) ? (linelen-- &gt;= 0) : (ListenerUtil.mutListener.listen(13486) ? (linelen-- &lt;= 0) : (ListenerUtil.mutListener.listen(13485) ? (linelen-- &lt; 0) : (ListenerUtil.mutListener.listen(13484) ? (linelen-- != 0) : (ListenerUtil.mutListener.listen(13483) ? (linelen-- == 0) : (linelen-- &gt; 0))))))) {</span>
<span class="fc" id="L414">                                ListenerUtil.loopListener.listen(&quot;_loopCounter239&quot;, ++_loopCounter239);</span>
<span class="fc" id="L415">                                char c = lineobj.charAt(pos);</span>
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(13475)) {</span>
<span class="pc bpc" id="L417" title="1 of 2 branches missed.">                                    if (c == '\0') {</span>
<span class="nc" id="L418">                                        throw new CsvException(&quot;line contains NUL&quot;);</span>
                                    }
                                }
<span class="pc bpc" id="L421" title="1 of 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(13481)) {</span>
<span class="pc bpc" id="L422" title="16 of 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(13480) ? (parse_process_char(c) &gt;= 0) : (ListenerUtil.mutListener.listen(13479) ? (parse_process_char(c) &lt;= 0) : (ListenerUtil.mutListener.listen(13478) ? (parse_process_char(c) &gt; 0) : (ListenerUtil.mutListener.listen(13477) ? (parse_process_char(c) != 0) : (ListenerUtil.mutListener.listen(13476) ? (parse_process_char(c) == 0) : (parse_process_char(c) &lt; 0))))))) {</span>
                                        // error
<span class="nc" id="L424">                                        return null;</span>
                                    }
                                }
<span class="pc bpc" id="L427" title="1 of 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(13482)) {</span>
<span class="fc" id="L428">                                    pos++;</span>
                                }
<span class="fc" id="L430">                            }</span>
                        }
                    }
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(13494)) {</span>
<span class="pc bpc" id="L434" title="16 of 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(13493) ? (parse_process_char('\0') &gt;= 0) : (ListenerUtil.mutListener.listen(13492) ? (parse_process_char('\0') &lt;= 0) : (ListenerUtil.mutListener.listen(13491) ? (parse_process_char('\0') &gt; 0) : (ListenerUtil.mutListener.listen(13490) ? (parse_process_char('\0') != 0) : (ListenerUtil.mutListener.listen(13489) ? (parse_process_char('\0') == 0) : (parse_process_char('\0') &lt; 0))))))) {</span>
<span class="nc" id="L435">                            return null;</span>
                        }
                    }
<span class="fc bfc" id="L438" title="All 2 branches covered.">                } while (state != START_RECORD);</span>
            }
        }
<span class="fc" id="L441">        List&lt;String&gt; fields = this.fields;</span>
<span class="pc bpc" id="L442" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(13496)) {</span>
<span class="fc" id="L443">            this.fields = null;</span>
        }
<span class="fc" id="L445">        return fields;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>