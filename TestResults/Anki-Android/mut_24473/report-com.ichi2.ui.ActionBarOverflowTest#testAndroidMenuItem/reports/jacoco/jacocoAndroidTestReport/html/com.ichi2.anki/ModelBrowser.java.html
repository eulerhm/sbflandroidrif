<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ModelBrowser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">ModelBrowser.java</span></div><h1>ModelBrowser.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2015 Ryan Annis &lt;squeenix@live.ca&gt;                                     *
 *  Copyright (c) 2015 Timothy Rae &lt;perceptualchaos2@gmail.com&gt;                          *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.ActionBar;
import android.util.Pair;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;
import com.afollestad.materialdialogs.MaterialDialog;
import com.ichi2.anki.dialogs.ConfirmationDialog;
import com.ichi2.anki.dialogs.ModelBrowserContextMenu;
import com.ichi2.anki.exception.ConfirmModSchemaException;
import com.ichi2.async.CollectionTask;
import com.ichi2.async.TaskListenerWithContext;
import com.ichi2.async.TaskManager;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Model;
import com.ichi2.libanki.StdModels;
import com.ichi2.ui.FixedEditText;
import com.ichi2.utils.Triple;
import com.ichi2.widget.WidgetStatus;
import java.util.ArrayList;
import java.util.Random;
import timber.log.Timber;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.LEFT;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L58">public class ModelBrowser extends AnkiActivity {</span>

    public static final int REQUEST_TEMPLATE_EDIT = 3;

    DisplayPairAdapter mModelDisplayAdapter;

    private ListView mModelListView;

    // Of the currently selected model
    private long mCurrentID;

    private int mModelListPosition;

    // Used exclusively to display model name
    private ArrayList&lt;Model&gt; mModels;

    private ArrayList&lt;Integer&gt; mCardCounts;

    private ArrayList&lt;Long&gt; mModelIds;

    private ArrayList&lt;DisplayPair&gt; mModelDisplayList;

    private Collection col;

    private ActionBar mActionBar;

    // Dialogue used in renaming
    private EditText mModelNameInput;

    private ModelBrowserContextMenu mContextMenu;

    private ArrayList&lt;String&gt; mNewModelNames;

    /*
     * Displays the loading bar when loading the mModels and displaying them
     * loading bar is necessary because card count per model is not cached *
     */
    private LoadingModelsHandler loadingModelsHandler() {
<span class="nc" id="L96">        return new LoadingModelsHandler(this);</span>
    }

    private static class LoadingModelsHandler extends TaskListenerWithContext&lt;ModelBrowser, Void, Pair&lt;ArrayList&lt;Model&gt;, ArrayList&lt;Integer&gt;&gt;&gt; {

        public LoadingModelsHandler(ModelBrowser browser) {
<span class="nc" id="L102">            super(browser);</span>
<span class="nc" id="L103">        }</span>

        @Override
        public void actualOnCancelled(@NonNull ModelBrowser browser) {
<span class="nc bnc" id="L107" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8869)) {</span>
<span class="nc" id="L108">                browser.hideProgressBar();</span>
            }
<span class="nc" id="L110">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull ModelBrowser browser) {
<span class="nc bnc" id="L114" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8870)) {</span>
<span class="nc" id="L115">                browser.showProgressBar();</span>
            }
<span class="nc" id="L117">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull ModelBrowser browser, Pair&lt;ArrayList&lt;Model&gt;, ArrayList&lt;Integer&gt;&gt; result) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8871)) {</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                if (result == null) {</span>
<span class="nc" id="L123">                    throw new RuntimeException();</span>
                }
            }
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8872)) {</span>
<span class="nc" id="L127">                browser.hideProgressBar();</span>
            }
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8873)) {</span>
<span class="nc" id="L130">                browser.mModels = result.first;</span>
            }
<span class="nc bnc" id="L132" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8874)) {</span>
<span class="nc" id="L133">                browser.mCardCounts = result.second;</span>
            }
<span class="nc bnc" id="L135" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8875)) {</span>
<span class="nc" id="L136">                browser.fillModelList();</span>
            }
<span class="nc" id="L138">        }</span>
    }

    /*
     * Displays loading bar when deleting a model loading bar is needed
     * because deleting a model also deletes all of the associated cards/notes *
     */
    private DeleteModelHandler deleteModelHandler() {
<span class="nc" id="L146">        return new DeleteModelHandler(this);</span>
    }

    private static class DeleteModelHandler extends TaskListenerWithContext&lt;ModelBrowser, Void, Boolean&gt; {

        public DeleteModelHandler(ModelBrowser browser) {
<span class="nc" id="L152">            super(browser);</span>
<span class="nc" id="L153">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull ModelBrowser browser) {
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8876)) {</span>
<span class="nc" id="L158">                browser.showProgressBar();</span>
            }
<span class="nc" id="L160">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull ModelBrowser browser, Boolean result) {
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8877)) {</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                if (!result) {</span>
<span class="nc" id="L166">                    throw new RuntimeException();</span>
                }
            }
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8878)) {</span>
<span class="nc" id="L170">                browser.hideProgressBar();</span>
            }
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8879)) {</span>
<span class="nc" id="L173">                browser.refreshList();</span>
            }
<span class="nc" id="L175">        }</span>
    }

    /*
     * Listens to long hold context menu for main list items
     */
<span class="nc" id="L181">    private final MaterialDialog.ListCallback mContextMenuListener = (materialDialog, view, selection, charSequence) -&gt; {</span>
<span class="nc bnc" id="L182" title="All 4 branches missed.">        switch(selection) {</span>
            case ModelBrowserContextMenu.MODEL_DELETE:
<span class="nc" id="L184">                deleteModelDialog();</span>
<span class="nc" id="L185">                break;</span>
            case ModelBrowserContextMenu.MODEL_RENAME:
<span class="nc" id="L187">                renameModelDialog();</span>
<span class="nc" id="L188">                break;</span>
            case ModelBrowserContextMenu.MODEL_TEMPLATE:
<span class="nc" id="L190">                openTemplateEditor();</span>
                break;
        }
<span class="nc" id="L193">    };</span>

    // ----------------------------------------------------------------------------
    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8880)) {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (showedActivityFailedScreen(savedInstanceState)) {</span>
<span class="nc" id="L200">                return;</span>
            }
        }
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8881)) {</span>
<span class="nc" id="L204">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8882)) {</span>
<span class="nc" id="L207">            setContentView(R.layout.model_browser);</span>
        }
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8883)) {</span>
<span class="nc" id="L210">            mModelListView = findViewById(R.id.note_type_browser_list);</span>
        }
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8884)) {</span>
<span class="nc" id="L213">            enableToolbar();</span>
        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8885)) {</span>
<span class="nc" id="L216">            mActionBar = getSupportActionBar();</span>
        }
<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8886)) {</span>
<span class="nc" id="L219">            startLoadingCollection();</span>
        }
<span class="nc" id="L221">    }</span>

    @Override
    public void onResume() {
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8887)) {</span>
<span class="nc" id="L226">            Timber.d(&quot;onResume()&quot;);</span>
        }
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8888)) {</span>
<span class="nc" id="L229">            super.onResume();</span>
        }
<span class="nc" id="L231">    }</span>

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8889)) {</span>
<span class="nc" id="L236">            super.onCreateOptionsMenu(menu);</span>
        }
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8890)) {</span>
<span class="nc" id="L239">            getMenuInflater().inflate(R.menu.model_browser, menu);</span>
        }
<span class="nc" id="L241">        return true;</span>
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L246">        int itemId = item.getItemId();</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8893)) {</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">            if (itemId == android.R.id.home) {</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8892)) {</span>
<span class="nc" id="L250">                    onBackPressed();</span>
                }
<span class="nc" id="L252">                return true;</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">            } else if (itemId == R.id.action_add_new_note_type) {</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8891)) {</span>
<span class="nc" id="L255">                    addNewNoteTypeDialog();</span>
                }
<span class="nc" id="L257">                return true;</span>
            }
        }
<span class="nc" id="L260">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    public void onStop() {
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8894)) {</span>
<span class="nc" id="L266">            super.onStop();</span>
        }
<span class="nc bnc" id="L268" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8897)) {</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (!isFinishing()) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8895)) {</span>
<span class="nc" id="L271">                    WidgetStatus.update(this);</span>
                }
<span class="nc bnc" id="L273" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8896)) {</span>
<span class="nc" id="L274">                    UIUtils.saveCollectionInBackground();</span>
                }
            }
        }
<span class="nc" id="L278">    }</span>

    @Override
    public void onDestroy() {
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8898)) {</span>
<span class="nc" id="L283">            TaskManager.cancelAllTasks(CollectionTask.CountModels.class);</span>
        }
<span class="nc bnc" id="L285" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8899)) {</span>
<span class="nc" id="L286">            super.onDestroy();</span>
        }
<span class="nc" id="L288">    }</span>

    // ----------------------------------------------------------------------------
    @Override
    public void onCollectionLoaded(Collection col) {
<span class="nc bnc" id="L293" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8900)) {</span>
<span class="nc" id="L294">            super.onCollectionLoaded(col);</span>
        }
<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8901)) {</span>
<span class="nc" id="L297">            this.col = col;</span>
        }
<span class="nc bnc" id="L299" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8902)) {</span>
<span class="nc" id="L300">            TaskManager.launchCollectionTask(new CollectionTask.CountModels(), loadingModelsHandler());</span>
        }
<span class="nc" id="L302">    }</span>

    /*
     * Fills the main list view with model names.
     * Handles filling the ArrayLists and attaching
     * ArrayAdapters to main ListView
     */
    private void fillModelList() {
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8903)) {</span>
            // Anonymous class for handling list item clicks
<span class="nc" id="L312">            mModelDisplayList = new ArrayList&lt;&gt;(mModels.size());</span>
        }
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8904)) {</span>
<span class="nc" id="L315">            mModelIds = new ArrayList&lt;&gt;(mModels.size());</span>
        }
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8912)) {</span>
            {
<span class="nc" id="L319">                long _loopCounter141 = 0;</span>
<span class="nc bnc" id="L320" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(8911) ? (i &gt;= mModels.size()) : (ListenerUtil.mutListener.listen(8910) ? (i &lt;= mModels.size()) : (ListenerUtil.mutListener.listen(8909) ? (i &gt; mModels.size()) : (ListenerUtil.mutListener.listen(8908) ? (i != mModels.size()) : (ListenerUtil.mutListener.listen(8907) ? (i == mModels.size()) : (i &lt; mModels.size())))))); i++) {</span>
<span class="nc" id="L321">                    ListenerUtil.loopListener.listen(&quot;_loopCounter141&quot;, ++_loopCounter141);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8905)) {</span>
<span class="nc" id="L323">                        mModelIds.add(mModels.get(i).getLong(&quot;id&quot;));</span>
                    }
<span class="nc bnc" id="L325" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8906)) {</span>
<span class="nc" id="L326">                        mModelDisplayList.add(new DisplayPair(mModels.get(i).getString(&quot;name&quot;), mCardCounts.get(i)));</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8913)) {</span>
<span class="nc" id="L332">            mModelDisplayAdapter = new DisplayPairAdapter(this, mModelDisplayList);</span>
        }
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8914)) {</span>
<span class="nc" id="L335">            mModelListView.setAdapter(mModelDisplayAdapter);</span>
        }
<span class="nc bnc" id="L337" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8915)) {</span>
<span class="nc" id="L338">            mModelListView.setOnItemClickListener((parent, view, position, id) -&gt; {</span>
<span class="nc" id="L339">                long noteTypeID = mModelIds.get(position);</span>
<span class="nc" id="L340">                mModelListPosition = position;</span>
<span class="nc" id="L341">                Intent noteOpenIntent = new Intent(ModelBrowser.this, ModelFieldEditor.class);</span>
<span class="nc" id="L342">                noteOpenIntent.putExtra(&quot;title&quot;, mModelDisplayList.get(position).getName());</span>
<span class="nc" id="L343">                noteOpenIntent.putExtra(&quot;noteTypeID&quot;, noteTypeID);</span>
<span class="nc" id="L344">                startActivityForResultWithAnimation(noteOpenIntent, 0, LEFT);</span>
<span class="nc" id="L345">            });</span>
        }
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8916)) {</span>
<span class="nc" id="L348">            mModelListView.setOnItemLongClickListener((parent, view, position, id) -&gt; {</span>
<span class="nc" id="L349">                String cardName = mModelDisplayList.get(position).getName();</span>
<span class="nc" id="L350">                mCurrentID = mModelIds.get(position);</span>
<span class="nc" id="L351">                mModelListPosition = position;</span>
<span class="nc" id="L352">                mContextMenu = ModelBrowserContextMenu.newInstance(cardName, mContextMenuListener);</span>
<span class="nc" id="L353">                showDialogFragment(mContextMenu);</span>
<span class="nc" id="L354">                return true;</span>
            });
        }
<span class="nc bnc" id="L357" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8917)) {</span>
<span class="nc" id="L358">            updateSubtitleText();</span>
        }
<span class="nc" id="L360">    }</span>

    /*
     * Updates the subtitle showing the amount of mModels available
     * ONLY CALL THIS AFTER initializing the main list
     */
    private void updateSubtitleText() {
<span class="nc" id="L367">        int count = mModelIds.size();</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8918)) {</span>
<span class="nc" id="L369">            mActionBar.setSubtitle(getResources().getQuantityString(R.plurals.model_browser_types_available, count, count));</span>
        }
<span class="nc" id="L371">    }</span>

    /*
     *Creates the dialogue box to select a note type, add a name, and then clone it
     */
    private void addNewNoteTypeDialog() {
<span class="nc" id="L377">        String add = getResources().getString(R.string.model_browser_add_add);</span>
<span class="nc" id="L378">        String clone = getResources().getString(R.string.model_browser_add_clone);</span>
        // Populates arrayadapters listing the mModels (includes prefixes/suffixes)
<span class="nc bnc" id="L380" title="All 2 branches missed.">        int existingModelSize = (mModels == null) ? 0 : mModels.size();</span>
<span class="nc" id="L381">        int stdModelSize = StdModels.stdModels.length;</span>
<span class="nc bnc" id="L382" title="All 8 branches missed.">        ArrayList&lt;String&gt; newModelLabels = new ArrayList&lt;&gt;((ListenerUtil.mutListener.listen(8922) ? (existingModelSize % stdModelSize) : (ListenerUtil.mutListener.listen(8921) ? (existingModelSize / stdModelSize) : (ListenerUtil.mutListener.listen(8920) ? (existingModelSize * stdModelSize) : (ListenerUtil.mutListener.listen(8919) ? (existingModelSize - stdModelSize) : (existingModelSize + stdModelSize))))));</span>
<span class="nc" id="L383">        ArrayList&lt;String&gt; existingModelsNames = new ArrayList&lt;&gt;(existingModelSize);</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8923)) {</span>
            // Used to fetch model names
<span class="nc" id="L386">            mNewModelNames = new ArrayList&lt;&gt;(stdModelSize);</span>
        }
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8926)) {</span>
            {
<span class="nc" id="L390">                long _loopCounter142 = 0;</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                for (StdModels StdModels : StdModels.stdModels) {</span>
<span class="nc" id="L392">                    ListenerUtil.loopListener.listen(&quot;_loopCounter142&quot;, ++_loopCounter142);</span>
<span class="nc" id="L393">                    String defaultName = StdModels.getDefaultName();</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8924)) {</span>
<span class="nc" id="L395">                        newModelLabels.add(String.format(add, defaultName));</span>
                    }
<span class="nc bnc" id="L397" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8925)) {</span>
<span class="nc" id="L398">                        mNewModelNames.add(defaultName);</span>
                    }
                }
            }
        }
<span class="nc" id="L403">        final int numStdModels = newModelLabels.size();</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8931)) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">            if (mModels != null) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8930)) {</span>
                    {
<span class="nc" id="L408">                        long _loopCounter143 = 0;</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">                        for (Model model : mModels) {</span>
<span class="nc" id="L410">                            ListenerUtil.loopListener.listen(&quot;_loopCounter143&quot;, ++_loopCounter143);</span>
<span class="nc" id="L411">                            String name = model.getString(&quot;name&quot;);</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8927)) {</span>
<span class="nc" id="L413">                                newModelLabels.add(String.format(clone, name));</span>
                            }
<span class="nc bnc" id="L415" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8928)) {</span>
<span class="nc" id="L416">                                mNewModelNames.add(name);</span>
                            }
<span class="nc bnc" id="L418" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8929)) {</span>
<span class="nc" id="L419">                                existingModelsNames.add(name);</span>
                            }
<span class="nc" id="L421">                        }</span>
                    }
                }
            }
        }
<span class="nc" id="L426">        final Spinner addSelectionSpinner = new Spinner(this);</span>
<span class="nc" id="L427">        ArrayAdapter&lt;String&gt; mNewModelAdapter = new ArrayAdapter&lt;&gt;(this, R.layout.dropdown_deck_item, newModelLabels);</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8932)) {</span>
<span class="nc" id="L429">            addSelectionSpinner.setAdapter(mNewModelAdapter);</span>
        }
<span class="nc bnc" id="L431" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8933)) {</span>
<span class="nc" id="L432">            new MaterialDialog.Builder(this).title(R.string.model_browser_add).positiveText(R.string.dialog_ok).customView(addSelectionSpinner, true).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L433">                mModelNameInput = new FixedEditText(ModelBrowser.this);</span>
<span class="nc" id="L434">                mModelNameInput.setSingleLine();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">                final boolean isStdModel = addSelectionSpinner.getSelectedItemPosition() &lt; numStdModels;</span>
                // Try to find a unique model name. Add &quot;clone&quot; if cloning, and random digits if necessary.
<span class="nc" id="L437">                String suggestedName = mNewModelNames.get(addSelectionSpinner.getSelectedItemPosition());</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">                if (!isStdModel) {</span>
<span class="nc" id="L439">                    suggestedName += &quot; &quot; + getResources().getString(R.string.model_clone_suffix);</span>
                }
<span class="nc bnc" id="L441" title="All 2 branches missed.">                if (existingModelsNames.contains(suggestedName)) {</span>
<span class="nc" id="L442">                    suggestedName = randomizeName(suggestedName);</span>
                }
<span class="nc" id="L444">                mModelNameInput.setText(suggestedName);</span>
<span class="nc" id="L445">                mModelNameInput.setSelection(mModelNameInput.getText().length());</span>
                // Create textbox to name new model
<span class="nc" id="L447">                new MaterialDialog.Builder(ModelBrowser.this).title(R.string.model_browser_add).positiveText(R.string.dialog_ok).customView(mModelNameInput, true).onPositive((innerDialog, innerWhich) -&gt; {</span>
<span class="nc" id="L448">                    String modelName = mModelNameInput.getText().toString();</span>
<span class="nc" id="L449">                    addNewNoteType(modelName, addSelectionSpinner.getSelectedItemPosition());</span>
<span class="nc" id="L450">                }).negativeText(R.string.dialog_cancel).show();</span>
<span class="nc" id="L451">            }).negativeText(R.string.dialog_cancel).show();</span>
        }
<span class="nc" id="L453">    }</span>

    /**
     * Add a new note type
     * @param modelName name of the new model
     * @param position position in dialog the user selected to add / clone the model type from
     */
    private void addNewNoteType(String modelName, int position) {
        Model model;
<span class="nc bnc" id="L462" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(8938) ? (modelName.length() &gt;= 0) : (ListenerUtil.mutListener.listen(8937) ? (modelName.length() &lt;= 0) : (ListenerUtil.mutListener.listen(8936) ? (modelName.length() &lt; 0) : (ListenerUtil.mutListener.listen(8935) ? (modelName.length() != 0) : (ListenerUtil.mutListener.listen(8934) ? (modelName.length() == 0) : (modelName.length() &gt; 0))))))) {</span>
<span class="nc" id="L463">            int nbStdModels = StdModels.stdModels.length;</span>
<span class="nc bnc" id="L464" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8944) ? (position &gt;= nbStdModels) : (ListenerUtil.mutListener.listen(8943) ? (position &lt;= nbStdModels) : (ListenerUtil.mutListener.listen(8942) ? (position &gt; nbStdModels) : (ListenerUtil.mutListener.listen(8941) ? (position != nbStdModels) : (ListenerUtil.mutListener.listen(8940) ? (position == nbStdModels) : (position &lt; nbStdModels))))))) {</span>
<span class="nc" id="L465">                model = StdModels.stdModels[position].add(col);</span>
            } else {
                // Model that is being cloned
<span class="nc bnc" id="L468" title="All 8 branches missed.">                Model oldModel = mModels.get((ListenerUtil.mutListener.listen(8948) ? (position % nbStdModels) : (ListenerUtil.mutListener.listen(8947) ? (position / nbStdModels) : (ListenerUtil.mutListener.listen(8946) ? (position * nbStdModels) : (ListenerUtil.mutListener.listen(8945) ? (position + nbStdModels) : (position - nbStdModels)))))).deepClone();</span>
<span class="nc" id="L469">                Model newModel = StdModels.basicModel.add(col);</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8949)) {</span>
<span class="nc" id="L471">                    oldModel.put(&quot;id&quot;, newModel.getLong(&quot;id&quot;));</span>
                }
<span class="nc" id="L473">                model = oldModel;</span>
            }
<span class="nc bnc" id="L475" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8950)) {</span>
<span class="nc" id="L476">                model.put(&quot;name&quot;, modelName);</span>
            }
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8951)) {</span>
<span class="nc" id="L479">                col.getModels().update(model);</span>
            }
<span class="nc bnc" id="L481" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8952)) {</span>
<span class="nc" id="L482">                fullRefresh();</span>
            }
<span class="nc" id="L484">        } else {</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8939)) {</span>
<span class="nc" id="L486">                showToast(getResources().getString(R.string.toast_empty_name));</span>
            }
        }
<span class="nc" id="L489">    }</span>

    /*
     * Displays a confirmation box asking if you want to delete the note type and then deletes it if confirmed
     */
    private void deleteModelDialog() {
<span class="nc bnc" id="L495" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8968)) {</span>
<span class="nc bnc" id="L496" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8957) ? (mModelIds.size() &gt;= 1) : (ListenerUtil.mutListener.listen(8956) ? (mModelIds.size() &lt;= 1) : (ListenerUtil.mutListener.listen(8955) ? (mModelIds.size() &lt; 1) : (ListenerUtil.mutListener.listen(8954) ? (mModelIds.size() != 1) : (ListenerUtil.mutListener.listen(8953) ? (mModelIds.size() == 1) : (mModelIds.size() &gt; 1))))))) {</span>
<span class="nc" id="L497">                Runnable confirm = () -&gt; {</span>
<span class="nc" id="L498">                    col.modSchemaNoCheck();</span>
<span class="nc" id="L499">                    deleteModel();</span>
<span class="nc" id="L500">                    dismissContextMenu();</span>
<span class="nc" id="L501">                };</span>
<span class="nc" id="L502">                Runnable cancel = this::dismissContextMenu;</span>
                try {
<span class="nc bnc" id="L504" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8963)) {</span>
<span class="nc" id="L505">                        col.modSchema();</span>
                    }
<span class="nc" id="L507">                    ConfirmationDialog d = new ConfirmationDialog();</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8964)) {</span>
<span class="nc" id="L509">                        d.setArgs(getResources().getString(R.string.model_delete_warning));</span>
                    }
<span class="nc bnc" id="L511" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8965)) {</span>
<span class="nc" id="L512">                        d.setConfirm(confirm);</span>
                    }
<span class="nc bnc" id="L514" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8966)) {</span>
<span class="nc" id="L515">                        d.setCancel(cancel);</span>
                    }
<span class="nc bnc" id="L517" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8967)) {</span>
<span class="nc" id="L518">                        ModelBrowser.this.showDialogFragment(d);</span>
                    }
<span class="nc" id="L520">                } catch (ConfirmModSchemaException e) {</span>
<span class="nc" id="L521">                    ConfirmationDialog c = new ConfirmationDialog();</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8959)) {</span>
<span class="nc" id="L523">                        c.setArgs(getResources().getString(R.string.full_sync_confirmation));</span>
                    }
<span class="nc bnc" id="L525" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8960)) {</span>
<span class="nc" id="L526">                        c.setConfirm(confirm);</span>
                    }
<span class="nc bnc" id="L528" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8961)) {</span>
<span class="nc" id="L529">                        c.setCancel(cancel);</span>
                    }
<span class="nc bnc" id="L531" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8962)) {</span>
<span class="nc" id="L532">                        showDialogFragment(c);</span>
                    }
<span class="nc" id="L534">                }</span>
<span class="nc" id="L535">            } else // Prevent users from deleting last model</span>
            {
<span class="nc bnc" id="L537" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8958)) {</span>
<span class="nc" id="L538">                    showToast(getString(R.string.toast_last_model));</span>
                }
            }
        }
<span class="nc" id="L542">    }</span>

    /*
     * Displays a confirmation box asking if you want to rename the note type and then renames it if confirmed
     */
    private void renameModelDialog() {
<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8969)) {</span>
<span class="nc" id="L549">            mModelNameInput = new FixedEditText(this);</span>
        }
<span class="nc bnc" id="L551" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8970)) {</span>
<span class="nc" id="L552">            mModelNameInput.setSingleLine(true);</span>
        }
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8971)) {</span>
<span class="nc" id="L555">            mModelNameInput.setText(mModels.get(mModelListPosition).getString(&quot;name&quot;));</span>
        }
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8972)) {</span>
<span class="nc" id="L558">            mModelNameInput.setSelection(mModelNameInput.getText().length());</span>
        }
<span class="nc bnc" id="L560" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8973)) {</span>
<span class="nc" id="L561">            new MaterialDialog.Builder(this).title(R.string.rename_model).positiveText(R.string.rename).negativeText(R.string.dialog_cancel).customView(mModelNameInput, true).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L562">                Model model = mModels.get(mModelListPosition);</span>
<span class="nc" id="L563">                String deckName = mModelNameInput.getText().toString().replaceAll(&quot;[\&quot;\\n\\r]&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">                if (deckName.length() &gt; 0) {</span>
<span class="nc" id="L565">                    model.put(&quot;name&quot;, deckName);</span>
<span class="nc" id="L566">                    col.getModels().update(model);</span>
<span class="nc" id="L567">                    mModels.get(mModelListPosition).put(&quot;name&quot;, deckName);</span>
<span class="nc" id="L568">                    mModelDisplayList.set(mModelListPosition, new DisplayPair(mModels.get(mModelListPosition).getString(&quot;name&quot;), mCardCounts.get(mModelListPosition)));</span>
<span class="nc" id="L569">                    refreshList();</span>
                } else {
<span class="nc" id="L571">                    showToast(getResources().getString(R.string.toast_empty_name));</span>
                }
<span class="nc" id="L573">            }).show();</span>
        }
<span class="nc" id="L575">    }</span>

    private void dismissContextMenu() {
<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8976)) {</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">            if (mContextMenu != null) {</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8974)) {</span>
<span class="nc" id="L581">                    mContextMenu.dismiss();</span>
                }
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8975)) {</span>
<span class="nc" id="L584">                    mContextMenu = null;</span>
                }
            }
        }
<span class="nc" id="L588">    }</span>

    /*
     * Opens the Template Editor (Card Editor) to allow
     * the user to edit the current note's templates.
     */
    private void openTemplateEditor() {
<span class="nc" id="L595">        Intent intent = new Intent(this, CardTemplateEditor.class);</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8977)) {</span>
<span class="nc" id="L597">            intent.putExtra(&quot;modelId&quot;, mCurrentID);</span>
        }
<span class="nc bnc" id="L599" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8978)) {</span>
<span class="nc" id="L600">            startActivityForResultWithAnimation(intent, REQUEST_TEMPLATE_EDIT, LEFT);</span>
        }
<span class="nc" id="L602">    }</span>

    /*
     * Updates the ArrayAdapters for the main ListView.
     * ArrayLists must be manually updated.
     */
    private void refreshList() {
<span class="nc bnc" id="L609" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8979)) {</span>
<span class="nc" id="L610">            mModelDisplayAdapter.notifyDataSetChanged();</span>
        }
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8980)) {</span>
<span class="nc" id="L613">            updateSubtitleText();</span>
        }
<span class="nc" id="L615">    }</span>

    /*
     * Reloads everything
     */
    private void fullRefresh() {
<span class="nc bnc" id="L621" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8981)) {</span>
<span class="nc" id="L622">            TaskManager.launchCollectionTask(new CollectionTask.CountModels(), loadingModelsHandler());</span>
        }
<span class="nc" id="L624">    }</span>

    /*
     * Deletes the currently selected model
     */
    private void deleteModel() {
<span class="nc bnc" id="L630" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8982)) {</span>
<span class="nc" id="L631">            TaskManager.launchCollectionTask(new CollectionTask.DeleteModel(mCurrentID), deleteModelHandler());</span>
        }
<span class="nc bnc" id="L633" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8983)) {</span>
<span class="nc" id="L634">            mModels.remove(mModelListPosition);</span>
        }
<span class="nc bnc" id="L636" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8984)) {</span>
<span class="nc" id="L637">            mModelIds.remove(mModelListPosition);</span>
        }
<span class="nc bnc" id="L639" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8985)) {</span>
<span class="nc" id="L640">            mModelDisplayList.remove(mModelListPosition);</span>
        }
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8986)) {</span>
<span class="nc" id="L643">            mCardCounts.remove(mModelListPosition);</span>
        }
<span class="nc bnc" id="L645" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8987)) {</span>
<span class="nc" id="L646">            refreshList();</span>
        }
<span class="nc" id="L648">    }</span>

    /*
     * Generates a random alphanumeric sequence of 6 characters
     * Used to append to the end of new note types to dissuade
     * User from reusing names (which are technically not unique however
     */
    private String randomizeName(String s) {
<span class="nc" id="L656">        char[] charSet = &quot;123456789abcdefghijklmnopqrstuvqxwzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;.toCharArray();</span>
<span class="nc" id="L657">        char[] randomString = new char[6];</span>
<span class="nc" id="L658">        Random random = new Random();</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8994)) {</span>
            {
<span class="nc" id="L661">                long _loopCounter144 = 0;</span>
<span class="nc bnc" id="L662" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(8993) ? (i &gt;= 6) : (ListenerUtil.mutListener.listen(8992) ? (i &lt;= 6) : (ListenerUtil.mutListener.listen(8991) ? (i &gt; 6) : (ListenerUtil.mutListener.listen(8990) ? (i != 6) : (ListenerUtil.mutListener.listen(8989) ? (i == 6) : (i &lt; 6)))))); i++) {</span>
<span class="nc" id="L663">                    ListenerUtil.loopListener.listen(&quot;_loopCounter144&quot;, ++_loopCounter144);</span>
<span class="nc" id="L664">                    int randomIndex = random.nextInt(charSet.length);</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8988)) {</span>
<span class="nc" id="L666">                        randomString[i] = charSet[randomIndex];</span>
                    }
                }
            }
        }
<span class="nc" id="L671">        return s + &quot; &quot; + new String(randomString);</span>
    }

    private void showToast(CharSequence text) {
<span class="nc" id="L675">        int duration = Toast.LENGTH_SHORT;</span>
<span class="nc" id="L676">        Toast toast = Toast.makeText(this, text, duration);</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8995)) {</span>
<span class="nc" id="L678">            toast.show();</span>
        }
<span class="nc" id="L680">    }</span>

    /*
     * Used so that the main ListView is able to display the number of notes using the model
     * along with the name.
     */
    public static class DisplayPair {

        private final String name;

        private final int count;

<span class="nc" id="L692">        public DisplayPair(String name, int count) {</span>
<span class="nc" id="L693">            this.name = name;</span>
<span class="nc" id="L694">            this.count = count;</span>
<span class="nc" id="L695">        }</span>

        public String getName() {
<span class="nc" id="L698">            return name;</span>
        }

        public int getCount() {
<span class="nc" id="L702">            return count;</span>
        }

        @Override
        @NonNull
        public String toString() {
<span class="nc" id="L708">            return getName();</span>
        }
    }

    /*
     * For display in the main list via an ArrayAdapter
     */
    public class DisplayPairAdapter extends ArrayAdapter&lt;DisplayPair&gt; {

<span class="nc" id="L717">        public DisplayPairAdapter(Context context, ArrayList&lt;DisplayPair&gt; items) {</span>
<span class="nc" id="L718">            super(context, R.layout.model_browser_list_item, R.id.model_list_item_1, items);</span>
<span class="nc" id="L719">        }</span>

        @NonNull
        @Override
        public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {
<span class="nc" id="L724">            DisplayPair item = getItem(position);</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8997)) {</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">                if (convertView == null) {</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8996)) {</span>
<span class="nc" id="L728">                        convertView = LayoutInflater.from(getContext()).inflate(R.layout.model_browser_list_item, parent, false);</span>
                    }
                }
            }
<span class="nc" id="L732">            TextView tvName = convertView.findViewById(R.id.model_list_item_1);</span>
<span class="nc" id="L733">            TextView tvHome = convertView.findViewById(R.id.model_list_item_2);</span>
<span class="nc" id="L734">            int count = item.getCount();</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8998)) {</span>
<span class="nc" id="L736">                tvName.setText(item.getName());</span>
            }
<span class="nc bnc" id="L738" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8999)) {</span>
<span class="nc" id="L739">                tvHome.setText(getResources().getQuantityString(R.plurals.model_browser_of_type, count, count));</span>
            }
<span class="nc" id="L741">            return convertView;</span>
        }
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc bnc" id="L747" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9000)) {</span>
<span class="nc" id="L748">            super.onActivityResult(requestCode, resultCode, data);</span>
        }
<span class="nc bnc" id="L750" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9007)) {</span>
<span class="nc bnc" id="L751" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9005) ? (requestCode &gt;= REQUEST_TEMPLATE_EDIT) : (ListenerUtil.mutListener.listen(9004) ? (requestCode &lt;= REQUEST_TEMPLATE_EDIT) : (ListenerUtil.mutListener.listen(9003) ? (requestCode &gt; REQUEST_TEMPLATE_EDIT) : (ListenerUtil.mutListener.listen(9002) ? (requestCode &lt; REQUEST_TEMPLATE_EDIT) : (ListenerUtil.mutListener.listen(9001) ? (requestCode != REQUEST_TEMPLATE_EDIT) : (requestCode == REQUEST_TEMPLATE_EDIT))))))) {</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9006)) {</span>
<span class="nc" id="L753">                    TaskManager.launchCollectionTask(new CollectionTask.CountModels(), loadingModelsHandler());</span>
                }
            }
        }
<span class="nc" id="L757">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>