<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeckAdapter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki.widgets</a> &gt; <span class="el_source">DeckAdapter.java</span></div><h1>DeckAdapter.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2015 Houssam Salem &lt;houssam.salem.au@gmail.com&gt;                        *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki.widgets;

import android.content.Context;
import android.content.res.TypedArray;
import android.graphics.Color;
import android.graphics.drawable.ColorDrawable;
import android.graphics.drawable.Drawable;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.core.content.ContextCompat;
import androidx.recyclerview.widget.RecyclerView;
import android.text.TextUtils;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Filter;
import android.widget.Filterable;
import android.widget.ImageButton;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import com.ichi2.anki.R;
import com.ichi2.compat.CompatHelper;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Deck;
import com.ichi2.libanki.sched.AbstractDeckTreeNode;
import com.ichi2.utils.FilterResultsUtils;
import com.ichi2.libanki.sched.Counts;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import static android.view.View.IMPORTANT_FOR_ACCESSIBILITY_NO;
import static android.view.View.IMPORTANT_FOR_ACCESSIBILITY_YES;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

public class DeckAdapter&lt;T extends AbstractDeckTreeNode&lt;T&gt;&gt; extends RecyclerView.Adapter&lt;DeckAdapter.ViewHolder&gt; implements Filterable {

    /* Make the selected deck roughly half transparent if there is a background */
    public static final double SELECTED_DECK_ALPHA_AGAINST_BACKGROUND = 0.45;

    private final LayoutInflater mLayoutInflater;

    private final List&lt;T&gt; mDeckList;

    /**
     * A subset of mDeckList (currently displayed)
     */
<span class="nc" id="L65">    private final List&lt;AbstractDeckTreeNode&lt;?&gt;&gt; mCurrentDeckList = new ArrayList&lt;&gt;();</span>

    private final int mZeroCountColor;

    private final int mNewCountColor;

    private final int mLearnCountColor;

    private final int mReviewCountColor;

    private final int mRowCurrentDrawable;

    private final int mDeckNameDefaultColor;

    private final int mDeckNameDynColor;

    private final Drawable mExpandImage;

    private final Drawable mCollapseImage;

<span class="nc" id="L85">    private final Drawable mNoExpander = new ColorDrawable(Color.TRANSPARENT);</span>

    // Listeners
    private View.OnClickListener mDeckClickListener;

    private View.OnClickListener mDeckExpanderClickListener;

    private View.OnLongClickListener mDeckLongClickListener;

    private View.OnClickListener mCountsClickListener;

    private Collection mCol;

    // Totals accumulated as each deck is processed
    private int mNew;

    private int mLrn;

    private int mRev;

    private boolean mNumbersComputed;

    // Flags
    private boolean mHasSubdecks;

    // Whether we have a background (so some items should be partially transparent).
    private boolean mPartiallyTransparentForBackground;

    // ViewHolder class to save inflated views for recycling
    public static class ViewHolder extends RecyclerView.ViewHolder {

        public final RelativeLayout deckLayout;

        public final LinearLayout countsLayout;

        public final ImageButton deckExpander;

        public final ImageButton indentView;

        public final TextView deckName;

        public final TextView deckNew;

        public final TextView deckLearn;

        public final TextView deckRev;

        public ViewHolder(View v) {
<span class="nc" id="L133">            super(v);</span>
<span class="nc" id="L134">            deckLayout = v.findViewById(R.id.DeckPickerHoriz);</span>
<span class="nc" id="L135">            countsLayout = v.findViewById(R.id.counts_layout);</span>
<span class="nc" id="L136">            deckExpander = v.findViewById(R.id.deckpicker_expander);</span>
<span class="nc" id="L137">            indentView = v.findViewById(R.id.deckpicker_indent);</span>
<span class="nc" id="L138">            deckName = v.findViewById(R.id.deckpicker_name);</span>
<span class="nc" id="L139">            deckNew = v.findViewById(R.id.deckpicker_new);</span>
<span class="nc" id="L140">            deckLearn = v.findViewById(R.id.deckpicker_lrn);</span>
<span class="nc" id="L141">            deckRev = v.findViewById(R.id.deckpicker_rev);</span>
<span class="nc" id="L142">        }</span>
    }

<span class="nc" id="L145">    public DeckAdapter(LayoutInflater layoutInflater, Context context) {</span>
<span class="nc" id="L146">        mLayoutInflater = layoutInflater;</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        mDeckList = new ArrayList&lt;&gt;((mCol == null) ? 10 : mCol.getDecks().count());</span>
        // Get the colors from the theme attributes
<span class="nc" id="L149">        int[] attrs = new int[] { R.attr.zeroCountColor, R.attr.newCountColor, R.attr.learnCountColor, R.attr.reviewCountColor, R.attr.currentDeckBackground, android.R.attr.textColor, R.attr.dynDeckColor, R.attr.expandRef, R.attr.collapseRef };</span>
<span class="nc" id="L150">        TypedArray ta = context.obtainStyledAttributes(attrs);</span>
<span class="nc" id="L151">        mZeroCountColor = ta.getColor(0, ContextCompat.getColor(context, R.color.black));</span>
<span class="nc" id="L152">        mNewCountColor = ta.getColor(1, ContextCompat.getColor(context, R.color.black));</span>
<span class="nc" id="L153">        mLearnCountColor = ta.getColor(2, ContextCompat.getColor(context, R.color.black));</span>
<span class="nc" id="L154">        mReviewCountColor = ta.getColor(3, ContextCompat.getColor(context, R.color.black));</span>
<span class="nc" id="L155">        mRowCurrentDrawable = ta.getResourceId(4, 0);</span>
<span class="nc" id="L156">        mDeckNameDefaultColor = ta.getColor(5, ContextCompat.getColor(context, R.color.black));</span>
<span class="nc" id="L157">        mDeckNameDynColor = ta.getColor(6, ContextCompat.getColor(context, R.color.material_blue_A700));</span>
<span class="nc" id="L158">        mExpandImage = ta.getDrawable(7);</span>
<span class="nc" id="L159">        mCollapseImage = ta.getDrawable(8);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3939)) {</span>
<span class="nc" id="L161">            ta.recycle();</span>
        }
<span class="nc" id="L163">    }</span>

    public void setDeckClickListener(View.OnClickListener listener) {
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3940)) {</span>
<span class="nc" id="L167">            mDeckClickListener = listener;</span>
        }
<span class="nc" id="L169">    }</span>

    public void setCountsClickListener(View.OnClickListener listener) {
<span class="nc bnc" id="L172" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3941)) {</span>
<span class="nc" id="L173">            mCountsClickListener = listener;</span>
        }
<span class="nc" id="L175">    }</span>

    public void setDeckExpanderClickListener(View.OnClickListener listener) {
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3942)) {</span>
<span class="nc" id="L179">            mDeckExpanderClickListener = listener;</span>
        }
<span class="nc" id="L181">    }</span>

    public void setDeckLongClickListener(View.OnLongClickListener listener) {
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3943)) {</span>
<span class="nc" id="L185">            mDeckLongClickListener = listener;</span>
        }
<span class="nc" id="L187">    }</span>

    /**
     * Sets whether the control should have partial transparency to allow a background to be seen
     */
    public void enablePartialTransparencyForBackground(boolean isTransparent) {
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3944)) {</span>
<span class="nc" id="L194">            mPartiallyTransparentForBackground = isTransparent;</span>
        }
<span class="nc" id="L196">    }</span>

    /**
     * Consume a list of {@link AbstractDeckTreeNode}s to render a new deck list.
     * @param filter The string to filter the deck by
     */
    public void buildDeckList(List&lt;T&gt; nodes, Collection col, @Nullable CharSequence filter) {
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3945)) {</span>
<span class="nc" id="L204">            mCol = col;</span>
        }
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3946)) {</span>
<span class="nc" id="L207">            mDeckList.clear();</span>
        }
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3947)) {</span>
<span class="nc" id="L210">            mCurrentDeckList.clear();</span>
        }
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3948)) {</span>
<span class="nc" id="L213">            mNew = mLrn = mRev = 0;</span>
        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3949)) {</span>
<span class="nc" id="L216">            mNumbersComputed = true;</span>
        }
<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3950)) {</span>
<span class="nc" id="L219">            mHasSubdecks = false;</span>
        }
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3951)) {</span>
<span class="nc" id="L222">            processNodes(nodes);</span>
        }
<span class="nc bnc" id="L224" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3952)) {</span>
            // Filtering performs notifyDataSetChanged after the async work is complete
<span class="nc" id="L226">            getFilter().filter(filter);</span>
        }
<span class="nc" id="L228">    }</span>

    public AbstractDeckTreeNode&lt;?&gt; getNodeByDid(long did) {
<span class="nc" id="L231">        int pos = findDeckPosition(did);</span>
<span class="nc" id="L232">        return getDeckList().get(pos);</span>
    }

    @NonNull
    @Override
    public DeckAdapter.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
<span class="nc" id="L238">        View v = mLayoutInflater.inflate(R.layout.deck_item, parent, false);</span>
<span class="nc" id="L239">        return new ViewHolder(v);</span>
    }

    @Override
    public void onBindViewHolder(ViewHolder holder, int position) {
        // Update views for this node
<span class="nc" id="L245">        AbstractDeckTreeNode&lt;?&gt; node = mCurrentDeckList.get(position);</span>
        // Set the expander icon and padding according to whether or not there are any subdecks
<span class="nc" id="L247">        RelativeLayout deckLayout = holder.deckLayout;</span>
<span class="nc" id="L248">        int rightPadding = (int) deckLayout.getResources().getDimension(R.dimen.deck_picker_right_padding);</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3958)) {</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (mHasSubdecks) {</span>
<span class="nc" id="L251">                int smallPadding = (int) deckLayout.getResources().getDimension(R.dimen.deck_picker_left_padding_small);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3955)) {</span>
<span class="nc" id="L253">                    deckLayout.setPadding(smallPadding, 0, rightPadding, 0);</span>
                }
<span class="nc bnc" id="L255" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3956)) {</span>
<span class="nc" id="L256">                    holder.deckExpander.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3957)) {</span>
                    // Create the correct expander for this deck
<span class="nc" id="L260">                    setDeckExpander(holder.deckExpander, holder.indentView, node);</span>
                }
<span class="nc" id="L262">            } else {</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3953)) {</span>
<span class="nc" id="L264">                    holder.deckExpander.setVisibility(View.GONE);</span>
                }
<span class="nc" id="L266">                int normalPadding = (int) deckLayout.getResources().getDimension(R.dimen.deck_picker_left_padding);</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3954)) {</span>
<span class="nc" id="L268">                    deckLayout.setPadding(normalPadding, 0, rightPadding, 0);</span>
                }
            }
        }
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3962)) {</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (node.hasChildren()) {</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3960)) {</span>
<span class="nc" id="L275">                    holder.deckExpander.setTag(node.getDid());</span>
                }
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3961)) {</span>
<span class="nc" id="L278">                    holder.deckExpander.setOnClickListener(mDeckExpanderClickListener);</span>
                }
            } else {
<span class="nc bnc" id="L281" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3959)) {</span>
<span class="nc" id="L282">                    holder.deckExpander.setClickable(false);</span>
                }
            }
        }
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3963)) {</span>
<span class="nc" id="L287">            holder.deckLayout.setBackgroundResource(mRowCurrentDrawable);</span>
        }
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3969)) {</span>
            // Set background colour. The current deck has its own color
<span class="nc bnc" id="L291" title="All 2 branches missed.">            if (isCurrentlySelectedDeck(node)) {</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3966)) {</span>
<span class="nc" id="L293">                    holder.deckLayout.setBackgroundResource(mRowCurrentDrawable);</span>
                }
<span class="nc bnc" id="L295" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3968)) {</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">                    if (mPartiallyTransparentForBackground) {</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(3967)) {</span>
<span class="nc" id="L298">                            setBackgroundAlpha(holder.deckLayout, SELECTED_DECK_ALPHA_AGAINST_BACKGROUND);</span>
                        }
                    }
                }
            } else {
                // Ripple effect
<span class="nc" id="L304">                int[] attrs = new int[] { android.R.attr.selectableItemBackground };</span>
<span class="nc" id="L305">                TypedArray ta = holder.deckLayout.getContext().obtainStyledAttributes(attrs);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3964)) {</span>
<span class="nc" id="L307">                    holder.deckLayout.setBackgroundResource(ta.getResourceId(0, 0));</span>
                }
<span class="nc bnc" id="L309" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3965)) {</span>
<span class="nc" id="L310">                    ta.recycle();</span>
                }
            }
        }
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3970)) {</span>
            // Set deck name and colour. Filtered decks have their own colour
<span class="nc" id="L316">            holder.deckName.setText(node.getLastDeckNameComponent());</span>
        }
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3973)) {</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">            if (mCol.getDecks().isDyn(node.getDid())) {</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3972)) {</span>
<span class="nc" id="L321">                    holder.deckName.setTextColor(mDeckNameDynColor);</span>
                }
            } else {
<span class="nc bnc" id="L324" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3971)) {</span>
<span class="nc" id="L325">                    holder.deckName.setTextColor(mDeckNameDefaultColor);</span>
                }
            }
        }
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3995)) {</span>
            // Set the card counts and their colors
<span class="nc bnc" id="L331" title="All 2 branches missed.">            if (node.shouldDisplayCounts()) {</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3974)) {</span>
<span class="nc" id="L333">                    holder.deckNew.setText(String.valueOf(node.getNewCount()));</span>
                }
<span class="nc bnc" id="L335" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3980)) {</span>
<span class="nc bnc" id="L336" title="All 22 branches missed.">                    holder.deckNew.setTextColor(((ListenerUtil.mutListener.listen(3979) ? (node.getNewCount() &gt;= 0) : (ListenerUtil.mutListener.listen(3978) ? (node.getNewCount() &lt;= 0) : (ListenerUtil.mutListener.listen(3977) ? (node.getNewCount() &gt; 0) : (ListenerUtil.mutListener.listen(3976) ? (node.getNewCount() &lt; 0) : (ListenerUtil.mutListener.listen(3975) ? (node.getNewCount() != 0) : (node.getNewCount() == 0))))))) ? mZeroCountColor : mNewCountColor);</span>
                }
<span class="nc bnc" id="L338" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3981)) {</span>
<span class="nc" id="L339">                    holder.deckLearn.setText(String.valueOf(node.getLrnCount()));</span>
                }
<span class="nc bnc" id="L341" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3987)) {</span>
<span class="nc bnc" id="L342" title="All 22 branches missed.">                    holder.deckLearn.setTextColor(((ListenerUtil.mutListener.listen(3986) ? (node.getLrnCount() &gt;= 0) : (ListenerUtil.mutListener.listen(3985) ? (node.getLrnCount() &lt;= 0) : (ListenerUtil.mutListener.listen(3984) ? (node.getLrnCount() &gt; 0) : (ListenerUtil.mutListener.listen(3983) ? (node.getLrnCount() &lt; 0) : (ListenerUtil.mutListener.listen(3982) ? (node.getLrnCount() != 0) : (node.getLrnCount() == 0))))))) ? mZeroCountColor : mLearnCountColor);</span>
                }
<span class="nc bnc" id="L344" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3988)) {</span>
<span class="nc" id="L345">                    holder.deckRev.setText(String.valueOf(node.getRevCount()));</span>
                }
<span class="nc bnc" id="L347" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(3994)) {</span>
<span class="nc bnc" id="L348" title="All 22 branches missed.">                    holder.deckRev.setTextColor(((ListenerUtil.mutListener.listen(3993) ? (node.getRevCount() &gt;= 0) : (ListenerUtil.mutListener.listen(3992) ? (node.getRevCount() &lt;= 0) : (ListenerUtil.mutListener.listen(3991) ? (node.getRevCount() &gt; 0) : (ListenerUtil.mutListener.listen(3990) ? (node.getRevCount() &lt; 0) : (ListenerUtil.mutListener.listen(3989) ? (node.getRevCount() != 0) : (node.getRevCount() == 0))))))) ? mZeroCountColor : mReviewCountColor);</span>
                }
            }
        }
<span class="nc bnc" id="L352" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3996)) {</span>
            // Store deck ID in layout's tag for easy retrieval in our click listeners
<span class="nc" id="L354">            holder.deckLayout.setTag(node.getDid());</span>
        }
<span class="nc bnc" id="L356" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3997)) {</span>
<span class="nc" id="L357">            holder.countsLayout.setTag(node.getDid());</span>
        }
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3998)) {</span>
            // Set click listeners
<span class="nc" id="L361">            holder.deckLayout.setOnClickListener(mDeckClickListener);</span>
        }
<span class="nc bnc" id="L363" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(3999)) {</span>
<span class="nc" id="L364">            holder.deckLayout.setOnLongClickListener(mDeckLongClickListener);</span>
        }
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4000)) {</span>
<span class="nc" id="L367">            holder.countsLayout.setOnClickListener(mCountsClickListener);</span>
        }
<span class="nc" id="L369">    }</span>

    private void setBackgroundAlpha(View view, @SuppressWarnings(&quot;SameParameterValue&quot;) double alphaPercentage) {
<span class="nc" id="L372">        Drawable background = view.getBackground().mutate();</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4005)) {</span>
<span class="nc bnc" id="L374" title="All 8 branches missed.">            background.setAlpha((int) ((ListenerUtil.mutListener.listen(4004) ? (255 % alphaPercentage) : (ListenerUtil.mutListener.listen(4003) ? (255 / alphaPercentage) : (ListenerUtil.mutListener.listen(4002) ? (255 - alphaPercentage) : (ListenerUtil.mutListener.listen(4001) ? (255 + alphaPercentage) : (255 * alphaPercentage)))))));</span>
        }
<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4006)) {</span>
<span class="nc" id="L377">            view.setBackground(background);</span>
        }
<span class="nc" id="L379">    }</span>

    private boolean isCurrentlySelectedDeck(AbstractDeckTreeNode&lt;?&gt; node) {
<span class="nc bnc" id="L382" title="All 2 branches missed.">        return node.getDid() == mCol.getDecks().current().optLong(&quot;id&quot;);</span>
    }

    @Override
    public int getItemCount() {
<span class="nc" id="L387">        return mCurrentDeckList.size();</span>
    }

    private void setDeckExpander(ImageButton expander, ImageButton indent, AbstractDeckTreeNode&lt;?&gt; node) {
<span class="nc" id="L391">        boolean collapsed = mCol.getDecks().get(node.getDid()).optBoolean(&quot;collapsed&quot;, false);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4015)) {</span>
            // Apply the correct expand/collapse drawable
<span class="nc bnc" id="L394" title="All 2 branches missed.">            if (node.hasChildren()) {</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4009)) {</span>
<span class="nc" id="L396">                    expander.setImportantForAccessibility(IMPORTANT_FOR_ACCESSIBILITY_YES);</span>
                }
<span class="nc bnc" id="L398" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4014)) {</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">                    if (collapsed) {</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4012)) {</span>
<span class="nc" id="L401">                            expander.setImageDrawable(mExpandImage);</span>
                        }
<span class="nc bnc" id="L403" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4013)) {</span>
<span class="nc" id="L404">                            expander.setContentDescription(expander.getContext().getString(R.string.expand));</span>
                        }
                    } else {
<span class="nc bnc" id="L407" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4010)) {</span>
<span class="nc" id="L408">                            expander.setImageDrawable(mCollapseImage);</span>
                        }
<span class="nc bnc" id="L410" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4011)) {</span>
<span class="nc" id="L411">                            expander.setContentDescription(expander.getContext().getString(R.string.collapse));</span>
                        }
                    }
                }
            } else {
<span class="nc bnc" id="L416" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4007)) {</span>
<span class="nc" id="L417">                    expander.setImageDrawable(mNoExpander);</span>
                }
<span class="nc bnc" id="L419" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4008)) {</span>
<span class="nc" id="L420">                    expander.setImportantForAccessibility(IMPORTANT_FOR_ACCESSIBILITY_NO);</span>
                }
            }
        }
        // Add some indenting for each nested level
<span class="nc bnc" id="L425" title="All 8 branches missed.">        int width = (ListenerUtil.mutListener.listen(4019) ? ((int) indent.getResources().getDimension(R.dimen.keyline_1) % node.getDepth()) : (ListenerUtil.mutListener.listen(4018) ? ((int) indent.getResources().getDimension(R.dimen.keyline_1) / node.getDepth()) : (ListenerUtil.mutListener.listen(4017) ? ((int) indent.getResources().getDimension(R.dimen.keyline_1) - node.getDepth()) : (ListenerUtil.mutListener.listen(4016) ? ((int) indent.getResources().getDimension(R.dimen.keyline_1) + node.getDepth()) : ((int) indent.getResources().getDimension(R.dimen.keyline_1) * node.getDepth())))));</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4020)) {</span>
<span class="nc" id="L427">            indent.setMinimumWidth(width);</span>
        }
<span class="nc" id="L429">    }</span>

    private void processNodes(List&lt;T&gt; nodes) {
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4051)) {</span>
            {
<span class="nc" id="L434">                long _loopCounter93 = 0;</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">                for (T node : nodes) {</span>
<span class="nc" id="L436">                    ListenerUtil.loopListener.listen(&quot;_loopCounter93&quot;, ++_loopCounter93);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4034)) {</span>
                        // We don't hide it if it's the only deck or if it has sub-decks.
<span class="nc bnc" id="L439" title="All 186 branches missed.">                        if ((ListenerUtil.mutListener.listen(4032) ? ((ListenerUtil.mutListener.listen(4031) ? ((ListenerUtil.mutListener.listen(4025) ? (node.getDid() &gt;= 1) : (ListenerUtil.mutListener.listen(4024) ? (node.getDid() &lt;= 1) : (ListenerUtil.mutListener.listen(4023) ? (node.getDid() &gt; 1) : (ListenerUtil.mutListener.listen(4022) ? (node.getDid() &lt; 1) : (ListenerUtil.mutListener.listen(4021) ? (node.getDid() != 1) : (node.getDid() == 1)))))) || (ListenerUtil.mutListener.listen(4030) ? (nodes.size() &gt;= 1) : (ListenerUtil.mutListener.listen(4029) ? (nodes.size() &lt;= 1) : (ListenerUtil.mutListener.listen(4028) ? (nodes.size() &lt; 1) : (ListenerUtil.mutListener.listen(4027) ? (nodes.size() != 1) : (ListenerUtil.mutListener.listen(4026) ? (nodes.size() == 1) : (nodes.size() &gt; 1))))))) : ((ListenerUtil.mutListener.listen(4025) ? (node.getDid() &gt;= 1) : (ListenerUtil.mutListener.listen(4024) ? (node.getDid() &lt;= 1) : (ListenerUtil.mutListener.listen(4023) ? (node.getDid() &gt; 1) : (ListenerUtil.mutListener.listen(4022) ? (node.getDid() &lt; 1) : (ListenerUtil.mutListener.listen(4021) ? (node.getDid() != 1) : (node.getDid() == 1)))))) &amp;&amp; (ListenerUtil.mutListener.listen(4030) ? (nodes.size() &gt;= 1) : (ListenerUtil.mutListener.listen(4029) ? (nodes.size() &lt;= 1) : (ListenerUtil.mutListener.listen(4028) ? (nodes.size() &lt; 1) : (ListenerUtil.mutListener.listen(4027) ? (nodes.size() != 1) : (ListenerUtil.mutListener.listen(4026) ? (nodes.size() == 1) : (nodes.size() &gt; 1)))))))) || !node.hasChildren()) : ((ListenerUtil.mutListener.listen(4031) ? ((ListenerUtil.mutListener.listen(4025) ? (node.getDid() &gt;= 1) : (ListenerUtil.mutListener.listen(4024) ? (node.getDid() &lt;= 1) : (ListenerUtil.mutListener.listen(4023) ? (node.getDid() &gt; 1) : (ListenerUtil.mutListener.listen(4022) ? (node.getDid() &lt; 1) : (ListenerUtil.mutListener.listen(4021) ? (node.getDid() != 1) : (node.getDid() == 1)))))) || (ListenerUtil.mutListener.listen(4030) ? (nodes.size() &gt;= 1) : (ListenerUtil.mutListener.listen(4029) ? (nodes.size() &lt;= 1) : (ListenerUtil.mutListener.listen(4028) ? (nodes.size() &lt; 1) : (ListenerUtil.mutListener.listen(4027) ? (nodes.size() != 1) : (ListenerUtil.mutListener.listen(4026) ? (nodes.size() == 1) : (nodes.size() &gt; 1))))))) : ((ListenerUtil.mutListener.listen(4025) ? (node.getDid() &gt;= 1) : (ListenerUtil.mutListener.listen(4024) ? (node.getDid() &lt;= 1) : (ListenerUtil.mutListener.listen(4023) ? (node.getDid() &gt; 1) : (ListenerUtil.mutListener.listen(4022) ? (node.getDid() &lt; 1) : (ListenerUtil.mutListener.listen(4021) ? (node.getDid() != 1) : (node.getDid() == 1)))))) &amp;&amp; (ListenerUtil.mutListener.listen(4030) ? (nodes.size() &gt;= 1) : (ListenerUtil.mutListener.listen(4029) ? (nodes.size() &lt;= 1) : (ListenerUtil.mutListener.listen(4028) ? (nodes.size() &lt; 1) : (ListenerUtil.mutListener.listen(4027) ? (nodes.size() != 1) : (ListenerUtil.mutListener.listen(4026) ? (nodes.size() == 1) : (nodes.size() &gt; 1)))))))) &amp;&amp; !node.hasChildren()))) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4033)) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                                if (mCol.getDb().queryScalar(&quot;select 1 from cards where did = 1&quot;) == 0) {</span>
<span class="nc" id="L442">                                    continue;</span>
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L447" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4037)) {</span>
                        {
<span class="nc" id="L449">                            long _loopCounter92 = 0;</span>
                            // If any of this node's parents are collapsed, don't add it to the deck list
<span class="nc bnc" id="L451" title="All 2 branches missed.">                            for (Deck parent : mCol.getDecks().parents(node.getDid())) {</span>
<span class="nc" id="L452">                                ListenerUtil.loopListener.listen(&quot;_loopCounter92&quot;, ++_loopCounter92);</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4035)) {</span>
                                    // If a deck has a parent it means it's a subdeck so set a flag
<span class="nc" id="L455">                                    mHasSubdecks = true;</span>
                                }
<span class="nc bnc" id="L457" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4036)) {</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                                    if (parent.optBoolean(&quot;collapsed&quot;)) {</span>
<span class="nc" id="L459">                                        return;</span>
                                    }
                                }
<span class="nc" id="L462">                            }</span>
                        }
                    }
<span class="nc bnc" id="L465" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4038)) {</span>
<span class="nc" id="L466">                        mDeckList.add(node);</span>
                    }
<span class="nc bnc" id="L468" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4039)) {</span>
<span class="nc" id="L469">                        mCurrentDeckList.add(node);</span>
                    }
<span class="nc bnc" id="L471" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4049)) {</span>
                        // Add this node's counts to the totals if it's a parent deck
<span class="nc bnc" id="L473" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(4044) ? (node.getDepth() &gt;= 0) : (ListenerUtil.mutListener.listen(4043) ? (node.getDepth() &lt;= 0) : (ListenerUtil.mutListener.listen(4042) ? (node.getDepth() &gt; 0) : (ListenerUtil.mutListener.listen(4041) ? (node.getDepth() &lt; 0) : (ListenerUtil.mutListener.listen(4040) ? (node.getDepth() != 0) : (node.getDepth() == 0))))))) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4048)) {</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                                if (node.shouldDisplayCounts()) {</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(4045)) {</span>
<span class="nc" id="L477">                                        mNew += node.getNewCount();</span>
                                    }
<span class="nc bnc" id="L479" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(4046)) {</span>
<span class="nc" id="L480">                                        mLrn += node.getLrnCount();</span>
                                    }
<span class="nc bnc" id="L482" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(4047)) {</span>
<span class="nc" id="L483">                                        mRev += node.getRevCount();</span>
                                    }
                                }
                            }
                        }
                    }
<span class="nc bnc" id="L489" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4050)) {</span>
                        // Process sub-decks
<span class="nc" id="L491">                        processNodes(node.getChildren());</span>
                    }
<span class="nc" id="L493">                }</span>
            }
        }
<span class="nc" id="L496">    }</span>

    /**
     * Return the position of the deck in the deck list. If the deck is a child of a collapsed deck
     * (i.e., not visible in the deck list), then the position of the parent deck is returned instead.
     *
     * An invalid deck ID will return position 0.
     */
    public int findDeckPosition(long did) {
        {
<span class="nc" id="L506">            long _loopCounter94 = 0;</span>
<span class="nc bnc" id="L507" title="All 22 branches missed.">            for (int i = 0; (ListenerUtil.mutListener.listen(4061) ? (i &gt;= mCurrentDeckList.size()) : (ListenerUtil.mutListener.listen(4060) ? (i &lt;= mCurrentDeckList.size()) : (ListenerUtil.mutListener.listen(4059) ? (i &gt; mCurrentDeckList.size()) : (ListenerUtil.mutListener.listen(4058) ? (i != mCurrentDeckList.size()) : (ListenerUtil.mutListener.listen(4057) ? (i == mCurrentDeckList.size()) : (i &lt; mCurrentDeckList.size())))))); i++) {</span>
<span class="nc" id="L508">                ListenerUtil.loopListener.listen(&quot;_loopCounter94&quot;, ++_loopCounter94);</span>
<span class="nc bnc" id="L509" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(4056) ? (mCurrentDeckList.get(i).getDid() &gt;= did) : (ListenerUtil.mutListener.listen(4055) ? (mCurrentDeckList.get(i).getDid() &lt;= did) : (ListenerUtil.mutListener.listen(4054) ? (mCurrentDeckList.get(i).getDid() &gt; did) : (ListenerUtil.mutListener.listen(4053) ? (mCurrentDeckList.get(i).getDid() &lt; did) : (ListenerUtil.mutListener.listen(4052) ? (mCurrentDeckList.get(i).getDid() != did) : (mCurrentDeckList.get(i).getDid() == did))))))) {</span>
<span class="nc" id="L510">                    return i;</span>
                }
            }
        }
        // If the deck is not in our list, we search again using the immediate parent
<span class="nc" id="L515">        List&lt;Deck&gt; parents = mCol.getDecks().parents(did);</span>
<span class="nc bnc" id="L516" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(4066) ? (parents.size() &gt;= 0) : (ListenerUtil.mutListener.listen(4065) ? (parents.size() &lt;= 0) : (ListenerUtil.mutListener.listen(4064) ? (parents.size() &gt; 0) : (ListenerUtil.mutListener.listen(4063) ? (parents.size() &lt; 0) : (ListenerUtil.mutListener.listen(4062) ? (parents.size() != 0) : (parents.size() == 0))))))) {</span>
<span class="nc" id="L517">            return 0;</span>
        } else {
<span class="nc bnc" id="L519" title="All 8 branches missed.">            return findDeckPosition(parents.get((ListenerUtil.mutListener.listen(4070) ? (parents.size() % 1) : (ListenerUtil.mutListener.listen(4069) ? (parents.size() / 1) : (ListenerUtil.mutListener.listen(4068) ? (parents.size() * 1) : (ListenerUtil.mutListener.listen(4067) ? (parents.size() + 1) : (parents.size() - 1)))))).optLong(&quot;id&quot;, 0));</span>
        }
    }

    @Nullable
    public Integer getEta() {
<span class="nc bnc" id="L525" title="All 2 branches missed.">        if (mNumbersComputed) {</span>
<span class="nc" id="L526">            return mCol.getSched().eta(new Counts(mNew, mLrn, mRev));</span>
        } else {
<span class="nc" id="L528">            return null;</span>
        }
    }

    @Nullable
    public Integer getDue() {
<span class="nc bnc" id="L534" title="All 2 branches missed.">        if (mNumbersComputed) {</span>
<span class="nc bnc" id="L535" title="All 48 branches missed.">            return (ListenerUtil.mutListener.listen(4078) ? ((ListenerUtil.mutListener.listen(4074) ? (mNew % mLrn) : (ListenerUtil.mutListener.listen(4073) ? (mNew / mLrn) : (ListenerUtil.mutListener.listen(4072) ? (mNew * mLrn) : (ListenerUtil.mutListener.listen(4071) ? (mNew - mLrn) : (mNew + mLrn))))) % mRev) : (ListenerUtil.mutListener.listen(4077) ? ((ListenerUtil.mutListener.listen(4074) ? (mNew % mLrn) : (ListenerUtil.mutListener.listen(4073) ? (mNew / mLrn) : (ListenerUtil.mutListener.listen(4072) ? (mNew * mLrn) : (ListenerUtil.mutListener.listen(4071) ? (mNew - mLrn) : (mNew + mLrn))))) / mRev) : (ListenerUtil.mutListener.listen(4076) ? ((ListenerUtil.mutListener.listen(4074) ? (mNew % mLrn) : (ListenerUtil.mutListener.listen(4073) ? (mNew / mLrn) : (ListenerUtil.mutListener.listen(4072) ? (mNew * mLrn) : (ListenerUtil.mutListener.listen(4071) ? (mNew - mLrn) : (mNew + mLrn))))) * mRev) : (ListenerUtil.mutListener.listen(4075) ? ((ListenerUtil.mutListener.listen(4074) ? (mNew % mLrn) : (ListenerUtil.mutListener.listen(4073) ? (mNew / mLrn) : (ListenerUtil.mutListener.listen(4072) ? (mNew * mLrn) : (ListenerUtil.mutListener.listen(4071) ? (mNew - mLrn) : (mNew + mLrn))))) - mRev) : ((ListenerUtil.mutListener.listen(4074) ? (mNew % mLrn) : (ListenerUtil.mutListener.listen(4073) ? (mNew / mLrn) : (ListenerUtil.mutListener.listen(4072) ? (mNew * mLrn) : (ListenerUtil.mutListener.listen(4071) ? (mNew - mLrn) : (mNew + mLrn))))) + mRev)))));</span>
        } else {
<span class="nc" id="L537">            return null;</span>
        }
    }

    private List&lt;AbstractDeckTreeNode&lt;?&gt;&gt; getDeckList() {
<span class="nc" id="L542">        return mCurrentDeckList;</span>
    }

    @Override
    public Filter getFilter() {
<span class="nc" id="L547">        return new DeckFilter();</span>
    }

    private class DeckFilter extends Filter {

<span class="nc" id="L552">        @NonNull</span>
        private final ArrayList&lt;AbstractDeckTreeNode&lt;?&gt;&gt; mFilteredDecks = new ArrayList&lt;&gt;();

<span class="nc" id="L555">        private DeckFilter() {</span>
<span class="nc" id="L556">            super();</span>
<span class="nc" id="L557">        }</span>

        private List&lt;T&gt; getAllDecks() {
<span class="nc" id="L560">            return mDeckList;</span>
        }

        @Override
        protected FilterResults performFiltering(CharSequence constraint) {
<span class="nc bnc" id="L565" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4079)) {</span>
<span class="nc" id="L566">                mFilteredDecks.clear();</span>
            }
<span class="nc bnc" id="L568" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4080)) {</span>
<span class="nc" id="L569">                mFilteredDecks.ensureCapacity(mCol.getDecks().count());</span>
            }
<span class="nc" id="L571">            List&lt;T&gt; allDecks = getAllDecks();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4083)) {</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                if (TextUtils.isEmpty(constraint)) {</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4082)) {</span>
<span class="nc" id="L575">                        mFilteredDecks.addAll(allDecks);</span>
                    }
                } else {
<span class="nc" id="L578">                    final String filterPattern = constraint.toString().toLowerCase(Locale.getDefault()).trim();</span>
<span class="nc" id="L579">                    List&lt;T&gt; filteredDecks = filterDecks(filterPattern, allDecks);</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4081)) {</span>
<span class="nc" id="L581">                        mFilteredDecks.addAll(filteredDecks);</span>
                    }
                }
            }
<span class="nc" id="L585">            return FilterResultsUtils.fromCollection(mFilteredDecks);</span>
        }

        @Override
        protected void publishResults(CharSequence constraint, FilterResults results) {
<span class="nc bnc" id="L590" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4084)) {</span>
<span class="nc" id="L591">                mCurrentDeckList.clear();</span>
            }
<span class="nc bnc" id="L593" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4085)) {</span>
<span class="nc" id="L594">                mCurrentDeckList.addAll(mFilteredDecks);</span>
            }
<span class="nc bnc" id="L596" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4086)) {</span>
<span class="nc" id="L597">                notifyDataSetChanged();</span>
            }
<span class="nc" id="L599">        }</span>

        private List&lt;T&gt; filterDecks(String filterPattern, List&lt;T&gt; allDecks) {
<span class="nc" id="L602">            ArrayList&lt;T&gt; ret = new ArrayList&lt;&gt;(allDecks.size());</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4089)) {</span>
                {
<span class="nc" id="L605">                    long _loopCounter95 = 0;</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">                    for (T tag : allDecks) {</span>
<span class="nc" id="L607">                        ListenerUtil.loopListener.listen(&quot;_loopCounter95&quot;, ++_loopCounter95);</span>
<span class="nc" id="L608">                        T node = filterDeckInternal(filterPattern, tag);</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4088)) {</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">                            if (node != null) {</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4087)) {</span>
<span class="nc" id="L612">                                    ret.add(node);</span>
                                }
                            }
                        }
<span class="nc" id="L616">                    }</span>
                }
            }
<span class="nc" id="L619">            return ret;</span>
        }

        @Nullable
        private T filterDeckInternal(String filterPattern, T root) {
<span class="nc bnc" id="L624" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4090)) {</span>
                // If a deck contains the string, then all its children are valid
<span class="nc bnc" id="L626" title="All 2 branches missed.">                if (containsFilterString(filterPattern, root)) {</span>
<span class="nc" id="L627">                    return root;</span>
                }
            }
<span class="nc" id="L630">            List&lt;T&gt; children = root.getChildren();</span>
<span class="nc" id="L631">            List&lt;T&gt; ret = new ArrayList&lt;&gt;(children.size());</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4093)) {</span>
                {
<span class="nc" id="L634">                    long _loopCounter96 = 0;</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                    for (T child : children) {</span>
<span class="nc" id="L636">                        ListenerUtil.loopListener.listen(&quot;_loopCounter96&quot;, ++_loopCounter96);</span>
<span class="nc" id="L637">                        T returned = filterDeckInternal(filterPattern, child);</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4092)) {</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">                            if (returned != null) {</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4091)) {</span>
<span class="nc" id="L641">                                    ret.add(returned);</span>
                                }
                            }
                        }
<span class="nc" id="L645">                    }</span>
                }
            }
            // If any of a deck's children contains the search string, then the deck is valid
<span class="nc bnc" id="L649" title="All 2 branches missed.">            return ret.isEmpty() ? null : root.withChildren(ret);</span>
        }

        private boolean containsFilterString(String filterPattern, T root) {
<span class="nc" id="L653">            String deckName = root.getFullDeckName();</span>
<span class="nc bnc" id="L654" title="All 10 branches missed.">            return (ListenerUtil.mutListener.listen(4094) ? (deckName.toLowerCase(Locale.getDefault()).contains(filterPattern) &amp;&amp; deckName.toLowerCase(Locale.ROOT).contains(filterPattern)) : (deckName.toLowerCase(Locale.getDefault()).contains(filterPattern) || deckName.toLowerCase(Locale.ROOT).contains(filterPattern)));</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>