<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NavigationDrawerActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">NavigationDrawerActivity.java</span></div><h1>NavigationDrawerActivity.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2014 Timothy Rae &lt;perceptualchaos2@gmail.com&gt;                          *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki;

import android.content.Intent;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.os.Bundle;
import android.os.Handler;
import com.google.android.material.navigation.NavigationView;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.core.app.TaskStackBuilder;
import androidx.core.content.ContextCompat;
import androidx.core.view.GravityCompat;
import androidx.appcompat.app.ActionBarDrawerToggle;
import androidx.appcompat.widget.SwitchCompat;
import androidx.appcompat.widget.Toolbar;
import android.view.KeyEvent;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import com.ichi2.anki.dialogs.HelpDialog;
import com.ichi2.themes.Themes;
import androidx.drawerlayout.widget.ClosableDrawerLayout;
import androidx.drawerlayout.widget.DrawerLayout;
import timber.log.Timber;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.*;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L46">public abstract class NavigationDrawerActivity extends AnkiActivity implements NavigationView.OnNavigationItemSelectedListener {</span>

    /**
     * Navigation Drawer
     */
    protected CharSequence mTitle;

<span class="nc" id="L53">    protected Boolean mFragmented = false;</span>

<span class="nc" id="L55">    private boolean mNavButtonGoesBack = false;</span>

    // Other members
    private String mOldColPath;

    private int mOldTheme;

    // Navigation drawer list item entries
    private DrawerLayout mDrawerLayout;

    private NavigationView mNavigationView;

    private ActionBarDrawerToggle mDrawerToggle;

    private SwitchCompat mNightModeSwitch;

    // Intent request codes
    public static final int REQUEST_PREFERENCES_UPDATE = 100;

    public static final int REQUEST_BROWSE_CARDS = 101;

    public static final int REQUEST_STATISTICS = 102;

    private static final String NIGHT_MODE_PREFERENCE = &quot;invertedColors&quot;;

    /**
     * runnable that will be executed after the drawer has been closed.
     */
    private Runnable pendingRunnable;

    // Navigation drawer initialisation
    protected void initNavigationDrawer(View mainView) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9224)) {</span>
            // Create inherited navigation drawer layout here so that it can be used by parent class
<span class="nc" id="L89">            mDrawerLayout = mainView.findViewById(R.id.drawer_layout);</span>
        }
<span class="nc bnc" id="L91" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9225)) {</span>
            // set a custom shadow that overlays the main content when the drawer opens
<span class="nc" id="L93">            mDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow, GravityCompat.START);</span>
        }
<span class="nc bnc" id="L95" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9226)) {</span>
            // Force transparent status bar with primary dark color underlayed so that the drawer displays under status bar
<span class="nc" id="L97">            getWindow().setStatusBarColor(ContextCompat.getColor(this, R.color.transparent));</span>
        }
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9227)) {</span>
<span class="nc" id="L100">            mDrawerLayout.setStatusBarBackgroundColor(Themes.getColorFromAttr(this, R.attr.colorPrimaryDark));</span>
        }
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9228)) {</span>
            // Setup toolbar and hamburger
<span class="nc" id="L104">            mNavigationView = mDrawerLayout.findViewById(R.id.navdrawer_items_container);</span>
        }
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9229)) {</span>
<span class="nc" id="L107">            mNavigationView.setNavigationItemSelectedListener(this);</span>
        }
<span class="nc" id="L109">        Toolbar toolbar = mainView.findViewById(R.id.toolbar);</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9234)) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            if (toolbar != null) {</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9230)) {</span>
<span class="nc" id="L113">                    setSupportActionBar(toolbar);</span>
                }
<span class="nc bnc" id="L115" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9231)) {</span>
                    // enable ActionBar app icon to behave as action to toggle nav drawer
<span class="nc" id="L117">                    getSupportActionBar().setDisplayHomeAsUpEnabled(true);</span>
                }
<span class="nc bnc" id="L119" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9232)) {</span>
<span class="nc" id="L120">                    getSupportActionBar().setHomeButtonEnabled(true);</span>
                }
<span class="nc bnc" id="L122" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9233)) {</span>
                    // Decide which action to take when the navigation button is tapped.
<span class="nc" id="L124">                    toolbar.setNavigationOnClickListener(v -&gt; onNavigationPressed());</span>
                }
            }
        }
        // Configure night-mode switch
<span class="nc" id="L129">        final SharedPreferences preferences = getPreferences();</span>
<span class="nc" id="L130">        View actionLayout = mNavigationView.getMenu().findItem(R.id.nav_night_mode).getActionView();</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9235)) {</span>
<span class="nc" id="L132">            mNightModeSwitch = actionLayout.findViewById(R.id.switch_compat);</span>
        }
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9236)) {</span>
<span class="nc" id="L135">            mNightModeSwitch.setChecked(preferences.getBoolean(NIGHT_MODE_PREFERENCE, false));</span>
        }
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9237)) {</span>
<span class="nc" id="L138">            mNightModeSwitch.setOnCheckedChangeListener((buttonView, isChecked) -&gt; applyNightMode(isChecked));</span>
        }
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9243)) {</span>
            // between the sliding drawer and the action bar app icon
<span class="nc" id="L142">            mDrawerToggle = new ActionBarDrawerToggle(this, mDrawerLayout, 0, 0) {</span>

                @Override
                public void onDrawerClosed(View drawerView) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9238)) {</span>
<span class="nc" id="L147">                        super.onDrawerClosed(drawerView);</span>
                    }
<span class="nc bnc" id="L149" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9239)) {</span>
<span class="nc" id="L150">                        supportInvalidateOptionsMenu();</span>
                    }
<span class="nc bnc" id="L152" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9240)) {</span>
                        // PERF: May be able to reduce this delay
<span class="nc" id="L154">                        new Handler().postDelayed(() -&gt; {</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">                            if (pendingRunnable != null) {</span>
<span class="nc" id="L156">                                new Handler().post(pendingRunnable);</span>
<span class="nc" id="L157">                                pendingRunnable = null;</span>
                            }
<span class="nc" id="L159">                        }, 100);</span>
                    }
<span class="nc" id="L161">                }</span>

                @Override
                public void onDrawerOpened(View drawerView) {
<span class="nc bnc" id="L165" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9241)) {</span>
<span class="nc" id="L166">                        super.onDrawerOpened(drawerView);</span>
                    }
<span class="nc bnc" id="L168" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(9242)) {</span>
<span class="nc" id="L169">                        supportInvalidateOptionsMenu();</span>
                    }
<span class="nc" id="L171">                }</span>
            };
        }
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9246)) {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (mDrawerLayout instanceof ClosableDrawerLayout) {</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9245)) {</span>
<span class="nc" id="L177">                    ((ClosableDrawerLayout) mDrawerLayout).setAnimationEnabled(animationEnabled());</span>
                }
            } else {
<span class="nc bnc" id="L180" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9244)) {</span>
<span class="nc" id="L181">                    Timber.w(&quot;Unexpected Drawer layout - could not modify navigation animation&quot;);</span>
                }
            }
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9247)) {</span>
<span class="nc" id="L186">            mDrawerToggle.setDrawerSlideAnimationEnabled(animationEnabled());</span>
        }
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9248)) {</span>
<span class="nc" id="L189">            mDrawerLayout.addDrawerListener(mDrawerToggle);</span>
        }
<span class="nc" id="L191">    }</span>

    /**
     * Sets selected navigation drawer item
     */
    protected void selectNavigationItem(int itemId) {
<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9250)) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (mNavigationView == null) {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9249)) {</span>
<span class="nc" id="L200">                    Timber.e(&quot;Could not select item in navigation drawer as NavigationView null&quot;);</span>
                }
<span class="nc" id="L202">                return;</span>
            }
        }
<span class="nc" id="L205">        Menu menu = mNavigationView.getMenu();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9266)) {</span>
<span class="nc bnc" id="L207" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9255) ? (itemId &gt;= -1) : (ListenerUtil.mutListener.listen(9254) ? (itemId &lt;= -1) : (ListenerUtil.mutListener.listen(9253) ? (itemId &gt; -1) : (ListenerUtil.mutListener.listen(9252) ? (itemId &lt; -1) : (ListenerUtil.mutListener.listen(9251) ? (itemId != -1) : (itemId == -1))))))) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9265)) {</span>
                    {
<span class="nc" id="L210">                        long _loopCounter147 = 0;</span>
<span class="nc bnc" id="L211" title="All 22 branches missed.">                        for (int i = 0; (ListenerUtil.mutListener.listen(9264) ? (i &gt;= menu.size()) : (ListenerUtil.mutListener.listen(9263) ? (i &lt;= menu.size()) : (ListenerUtil.mutListener.listen(9262) ? (i &gt; menu.size()) : (ListenerUtil.mutListener.listen(9261) ? (i != menu.size()) : (ListenerUtil.mutListener.listen(9260) ? (i == menu.size()) : (i &lt; menu.size())))))); i++) {</span>
<span class="nc" id="L212">                            ListenerUtil.loopListener.listen(&quot;_loopCounter147&quot;, ++_loopCounter147);</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(9259)) {</span>
<span class="nc" id="L214">                                menu.getItem(i).setChecked(false);</span>
                            }
                        }
<span class="nc" id="L217">                    }</span>
                }
            } else {
<span class="nc" id="L220">                MenuItem item = menu.findItem(itemId);</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9258)) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                    if (item != null) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9257)) {</span>
<span class="nc" id="L224">                            item.setChecked(true);</span>
                        }
                    } else {
<span class="nc bnc" id="L227" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9256)) {</span>
<span class="nc" id="L228">                            Timber.e(&quot;Could not find item %d&quot;, itemId);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L234">    }</span>

    @Override
    public void setTitle(CharSequence title) {
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9267)) {</span>
<span class="nc" id="L239">            mTitle = title;</span>
        }
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9269)) {</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">            if (getSupportActionBar() != null) {</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9268)) {</span>
<span class="nc" id="L244">                    getSupportActionBar().setTitle(mTitle);</span>
                }
            }
        }
<span class="nc" id="L248">    }</span>

    @Override
    protected void onPostCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9270)) {</span>
<span class="nc" id="L253">            super.onPostCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9272)) {</span>
            // Sync the toggle state after onRestoreInstanceState has occurred.
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (mDrawerToggle != null) {</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9271)) {</span>
<span class="nc" id="L259">                    mDrawerToggle.syncState();</span>
                }
            }
        }
<span class="nc" id="L263">    }</span>

    private SharedPreferences getPreferences() {
<span class="nc" id="L266">        return AnkiDroidApp.getSharedPrefs(NavigationDrawerActivity.this);</span>
    }

    private void applyNightMode(boolean setToNightMode) {
<span class="nc" id="L270">        final SharedPreferences preferences = getPreferences();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9273)) {</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">            Timber.i(&quot;Night mode was %s&quot;, setToNightMode ? &quot;enabled&quot; : &quot;disabled&quot;);</span>
        }
<span class="nc bnc" id="L274" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9274)) {</span>
<span class="nc" id="L275">            preferences.edit().putBoolean(NIGHT_MODE_PREFERENCE, setToNightMode).apply();</span>
        }
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9275)) {</span>
<span class="nc" id="L278">            restartActivityInvalidateBackstack(NavigationDrawerActivity.this);</span>
        }
<span class="nc" id="L280">    }</span>

    @Override
    public void onConfigurationChanged(@NonNull Configuration newConfig) {
<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9276)) {</span>
<span class="nc" id="L285">            super.onConfigurationChanged(newConfig);</span>
        }
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9278)) {</span>
            // Pass any configuration change to the drawer toggles
<span class="nc bnc" id="L289" title="All 2 branches missed.">            if (mDrawerToggle != null) {</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9277)) {</span>
<span class="nc" id="L291">                    mDrawerToggle.onConfigurationChanged(newConfig);</span>
                }
            }
        }
<span class="nc" id="L295">    }</span>

    public ActionBarDrawerToggle getDrawerToggle() {
<span class="nc" id="L298">        return mDrawerToggle;</span>
    }

    /**
     * This function locks the navigation drawer closed in regards to swipes,
     * but continues to allowed it to be opened via it's indicator button. This
     * function in a noop if the drawer hasn't been initialized.
     */
    protected void disableDrawerSwipe() {
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9280)) {</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">            if (mDrawerLayout != null) {</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9279)) {</span>
<span class="nc" id="L310">                    mDrawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED);</span>
                }
            }
        }
<span class="nc" id="L314">    }</span>

    /**
     * This function allows swipes to open the navigation drawer. This
     * function in a noop if the drawer hasn't been initialized.
     */
    protected void enableDrawerSwipe() {
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9282)) {</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">            if (mDrawerLayout != null) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9281)) {</span>
<span class="nc" id="L324">                    mDrawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_UNLOCKED);</span>
                }
            }
        }
<span class="nc" id="L328">    }</span>

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc" id="L332">        final SharedPreferences preferences = getPreferences();</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9283)) {</span>
<span class="nc" id="L334">            Timber.i(&quot;Handling Activity Result: %d. Result: %d&quot;, requestCode, resultCode);</span>
        }
<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9284)) {</span>
<span class="nc" id="L337">            NotificationChannels.setup(getApplicationContext());</span>
        }
<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9300)) {</span>
            // Restart the activity on preference change
<span class="nc bnc" id="L341" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(9289) ? (requestCode &gt;= REQUEST_PREFERENCES_UPDATE) : (ListenerUtil.mutListener.listen(9288) ? (requestCode &lt;= REQUEST_PREFERENCES_UPDATE) : (ListenerUtil.mutListener.listen(9287) ? (requestCode &gt; REQUEST_PREFERENCES_UPDATE) : (ListenerUtil.mutListener.listen(9286) ? (requestCode &lt; REQUEST_PREFERENCES_UPDATE) : (ListenerUtil.mutListener.listen(9285) ? (requestCode != REQUEST_PREFERENCES_UPDATE) : (requestCode == REQUEST_PREFERENCES_UPDATE))))))) {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9299)) {</span>
<span class="nc bnc" id="L343" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(9291) ? (mOldColPath != null || CollectionHelper.getCurrentAnkiDroidDirectory(this).equals(mOldColPath)) : (mOldColPath != null &amp;&amp; CollectionHelper.getCurrentAnkiDroidDirectory(this).equals(mOldColPath)))) {</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9298)) {</span>
                            // collection path hasn't been changed so just restart the current activity
<span class="nc bnc" id="L346" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(9294) ? ((this instanceof Reviewer) || preferences.getBoolean(&quot;tts&quot;, false)) : ((this instanceof Reviewer) &amp;&amp; preferences.getBoolean(&quot;tts&quot;, false)))) {</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9297)) {</span>
                                    // because onDestroy() of old Activity interferes with TTS in new Activity
<span class="nc" id="L349">                                    finishWithoutAnimation();</span>
                                }
<span class="nc bnc" id="L351" title="All 2 branches missed.">                            } else if (mOldTheme != Themes.getCurrentTheme(getApplicationContext())) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9296)) {</span>
                                    // The current theme was changed, so need to reload the stack with the new theme
<span class="nc" id="L354">                                    restartActivityInvalidateBackstack(this);</span>
                                }
                            } else {
<span class="nc bnc" id="L357" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(9295)) {</span>
<span class="nc" id="L358">                                    restartActivity();</span>
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L363" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9292)) {</span>
                            // collection path has changed so kick the user back to the DeckPicker
<span class="nc" id="L365">                            CollectionHelper.getInstance().closeCollection(true, &quot;Preference Modification: collection path changed&quot;);</span>
                        }
<span class="nc bnc" id="L367" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(9293)) {</span>
<span class="nc" id="L368">                            restartActivityInvalidateBackstack(this);</span>
                        }
                    }
                }
            } else {
<span class="nc bnc" id="L373" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9290)) {</span>
<span class="nc" id="L374">                    super.onActivityResult(requestCode, resultCode, data);</span>
                }
            }
        }
<span class="nc" id="L378">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9304)) {</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">            if (isDrawerOpen()) {</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9302)) {</span>
<span class="nc" id="L385">                    Timber.i(&quot;Back key pressed&quot;);</span>
                }
<span class="nc bnc" id="L387" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9303)) {</span>
<span class="nc" id="L388">                    closeDrawer();</span>
                }
            } else {
<span class="nc bnc" id="L391" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9301)) {</span>
<span class="nc" id="L392">                    super.onBackPressed();</span>
                }
            }
        }
<span class="nc" id="L396">    }</span>

    /**
     * Called, when navigation button of the action bar is pressed.
     * Design pattern: template method. Subclasses can override this to define their own behaviour.
     */
    protected void onNavigationPressed() {
<span class="nc bnc" id="L403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9307)) {</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (mNavButtonGoesBack) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9306)) {</span>
<span class="nc" id="L406">                    finishWithAnimation(RIGHT);</span>
                }
            } else {
<span class="nc bnc" id="L409" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9305)) {</span>
<span class="nc" id="L410">                    openDrawer();</span>
                }
            }
        }
<span class="nc" id="L414">    }</span>

    @Override
    public boolean onNavigationItemSelected(final MenuItem item) {
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9308)) {</span>
            // Don't do anything if user selects already selected position
<span class="nc bnc" id="L420" title="All 2 branches missed.">            if (item.isChecked()) {</span>
<span class="nc" id="L421">                return true;</span>
            }
        }
<span class="nc bnc" id="L424" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9309)) {</span>
            /*
         * This runnable will be executed in onDrawerClosed(...)
         * to make the animation more fluid on older devices.
         */
<span class="nc" id="L429">            pendingRunnable = () -&gt; {</span>
                // Take action if a different item selected
<span class="nc" id="L431">                int itemId = item.getItemId();</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">                if (itemId == R.id.nav_decks) {</span>
<span class="nc" id="L433">                    Timber.i(&quot;Navigating to decks&quot;);</span>
<span class="nc" id="L434">                    Intent deckPicker = new Intent(NavigationDrawerActivity.this, DeckPicker.class);</span>
                    // opening DeckPicker should clear back history
<span class="nc" id="L436">                    deckPicker.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);</span>
<span class="nc" id="L437">                    startActivityWithAnimation(deckPicker, RIGHT);</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">                } else if (itemId == R.id.nav_browser) {</span>
<span class="nc" id="L439">                    Timber.i(&quot;Navigating to card browser&quot;);</span>
<span class="nc" id="L440">                    openCardBrowser();</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                } else if (itemId == R.id.nav_stats) {</span>
<span class="nc" id="L442">                    Timber.i(&quot;Navigating to stats&quot;);</span>
<span class="nc" id="L443">                    Intent intent = new Intent(NavigationDrawerActivity.this, Statistics.class);</span>
<span class="nc" id="L444">                    startActivityForResultWithAnimation(intent, REQUEST_STATISTICS, LEFT);</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">                } else if (itemId == R.id.nav_night_mode) {</span>
<span class="nc" id="L446">                    Timber.i(&quot;Toggling Night Mode&quot;);</span>
<span class="nc" id="L447">                    mNightModeSwitch.performClick();</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">                } else if (itemId == R.id.nav_settings) {</span>
<span class="nc" id="L449">                    Timber.i(&quot;Navigating to settings&quot;);</span>
<span class="nc" id="L450">                    mOldColPath = CollectionHelper.getCurrentAnkiDroidDirectory(NavigationDrawerActivity.this);</span>
                    // Remember the theme we started with so we can restart the Activity if it changes
<span class="nc" id="L452">                    mOldTheme = Themes.getCurrentTheme(getApplicationContext());</span>
<span class="nc" id="L453">                    startActivityForResultWithAnimation(new Intent(NavigationDrawerActivity.this, Preferences.class), REQUEST_PREFERENCES_UPDATE, FADE);</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">                } else if (itemId == R.id.nav_help) {</span>
<span class="nc" id="L455">                    Timber.i(&quot;Navigating to help&quot;);</span>
<span class="nc" id="L456">                    showDialogFragment(HelpDialog.createInstance(this));</span>
                }
<span class="nc" id="L458">            };</span>
        }
<span class="nc bnc" id="L460" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9310)) {</span>
<span class="nc" id="L461">            closeDrawer();</span>
        }
<span class="nc" id="L463">        return true;</span>
    }

    protected void openCardBrowser() {
<span class="nc" id="L467">        Intent intent = new Intent(NavigationDrawerActivity.this, CardBrowser.class);</span>
<span class="nc" id="L468">        Long currentCardId = getCurrentCardId();</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9312)) {</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">            if (currentCardId != null) {</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9311)) {</span>
<span class="nc" id="L472">                    intent.putExtra(&quot;currentCard&quot;, currentCardId);</span>
                }
            }
        }
<span class="nc bnc" id="L476" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9313)) {</span>
<span class="nc" id="L477">            startActivityForResultWithAnimation(intent, REQUEST_BROWSE_CARDS, LEFT);</span>
        }
<span class="nc" id="L479">    }</span>

    // Override this to specify a specific card id
    @Nullable
    protected Long getCurrentCardId() {
<span class="nc" id="L484">        return null;</span>
    }

    protected void showBackIcon() {
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9315)) {</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">            if (mDrawerToggle != null) {</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9314)) {</span>
<span class="nc" id="L491">                    mDrawerToggle.setDrawerIndicatorEnabled(false);</span>
                }
            }
        }
<span class="nc bnc" id="L495" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9317)) {</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">            if (getSupportActionBar() != null) {</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9316)) {</span>
<span class="nc" id="L498">                    getSupportActionBar().setDisplayHomeAsUpEnabled(true);</span>
                }
            }
        }
<span class="nc bnc" id="L502" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9318)) {</span>
<span class="nc" id="L503">            mNavButtonGoesBack = true;</span>
        }
<span class="nc" id="L505">    }</span>

    protected void restoreDrawerIcon() {
<span class="nc bnc" id="L508" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9320)) {</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">            if (mDrawerToggle != null) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9319)) {</span>
<span class="nc" id="L511">                    getDrawerToggle().setDrawerIndicatorEnabled(true);</span>
                }
            }
        }
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9321)) {</span>
<span class="nc" id="L516">            mNavButtonGoesBack = false;</span>
        }
<span class="nc" id="L518">    }</span>

    public boolean isDrawerOpen() {
<span class="nc" id="L521">        return mDrawerLayout.isDrawerOpen(GravityCompat.START);</span>
    }

    /**
     * Restart the activity and discard old backstack, creating it new from the hierarchy in the manifest
     */
    protected void restartActivityInvalidateBackstack(AnkiActivity activity) {
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9322)) {</span>
<span class="nc" id="L529">            Timber.i(&quot;AnkiActivity -- restartActivityInvalidateBackstack()&quot;);</span>
        }
<span class="nc" id="L531">        Intent intent = new Intent();</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9323)) {</span>
<span class="nc" id="L533">            intent.setClass(activity, activity.getClass());</span>
        }
<span class="nc" id="L535">        TaskStackBuilder stackBuilder = TaskStackBuilder.create(activity);</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9324)) {</span>
<span class="nc" id="L537">            stackBuilder.addNextIntentWithParentStack(intent);</span>
        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9325)) {</span>
<span class="nc" id="L540">            stackBuilder.startActivities(new Bundle());</span>
        }
<span class="nc bnc" id="L542" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9326)) {</span>
<span class="nc" id="L543">            activity.finishWithoutAnimation();</span>
        }
<span class="nc" id="L545">    }</span>

    public void toggleDrawer() {
<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9329)) {</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">            if (!isDrawerOpen()) {</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9328)) {</span>
<span class="nc" id="L551">                    openDrawer();</span>
                }
            } else {
<span class="nc bnc" id="L554" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9327)) {</span>
<span class="nc" id="L555">                    closeDrawer();</span>
                }
            }
        }
<span class="nc" id="L559">    }</span>

    private void openDrawer() {
<span class="nc bnc" id="L562" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9330)) {</span>
<span class="nc" id="L563">            mDrawerLayout.openDrawer(GravityCompat.START, animationEnabled());</span>
        }
<span class="nc" id="L565">    }</span>

    private void closeDrawer() {
<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9331)) {</span>
<span class="nc" id="L569">            mDrawerLayout.closeDrawer(GravityCompat.START, animationEnabled());</span>
        }
<span class="nc" id="L571">    }</span>

    public void focusNavigation() {
<span class="nc bnc" id="L574" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9332)) {</span>
            // mNavigationView.getMenu().getItem(0).setChecked(true);
<span class="nc" id="L576">            selectNavigationItem(R.id.nav_decks);</span>
        }
<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9333)) {</span>
<span class="nc" id="L579">            mNavigationView.requestFocus();</span>
        }
<span class="nc" id="L581">    }</span>

    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9334)) {</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (!isDrawerOpen()) {</span>
<span class="nc" id="L587">                return super.onKeyDown(keyCode, event);</span>
            }
        }
<span class="nc bnc" id="L590" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(9336)) {</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">            if (keyCode == KeyEvent.KEYCODE_DPAD_RIGHT) {</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(9335)) {</span>
<span class="nc" id="L593">                    closeDrawer();</span>
                }
<span class="nc" id="L595">                return true;</span>
            }
        }
<span class="nc" id="L598">        return super.onKeyDown(keyCode, event);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>