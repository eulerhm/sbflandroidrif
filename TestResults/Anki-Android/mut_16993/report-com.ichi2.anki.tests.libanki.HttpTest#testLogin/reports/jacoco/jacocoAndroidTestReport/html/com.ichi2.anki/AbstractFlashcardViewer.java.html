<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractFlashcardViewer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">AbstractFlashcardViewer.java</span></div><h1>AbstractFlashcardViewer.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2011 Kostas Spyropoulos &lt;inigo.aldana@gmail.com&gt;                       *
 *  Copyright (c) 2014 Bruno Romero de Azevedo &lt;brunodea@inf.ufsm.br&gt;                    *
 *  Copyright (c) 2014â€“15 Roland Sieker &lt;ospalh@gmail.com&gt;                               *
 *  Copyright (c) 2015 Timothy Rae &lt;perceptualchaos2@gmail.com&gt;                          *
 *  Copyright (c) 2016 Mark Carter &lt;mark@marcardar.com&gt;                                  *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki;

import android.annotation.SuppressLint;
import android.annotation.TargetApi;
import android.content.ActivityNotFoundException;
import android.content.BroadcastReceiver;
import android.content.ClipData;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.content.res.Resources;
import android.graphics.Color;
import android.net.ConnectivityManager;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.os.SystemClock;
import androidx.annotation.CheckResult;
import androidx.annotation.IdRes;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.annotation.VisibleForTesting;
import androidx.coordinatorlayout.widget.CoordinatorLayout;
import androidx.core.content.ContextCompat;
import androidx.appcompat.app.ActionBar;
import androidx.webkit.internal.AssetHelper;
import androidx.webkit.WebViewAssetLoader;
import android.text.TextUtils;
import android.util.Pair;
import android.util.TypedValue;
import android.view.GestureDetector;
import android.view.GestureDetector.SimpleOnGestureListener;
import android.view.Gravity;
import android.view.KeyEvent;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.view.WindowManager;
import android.view.inputmethod.EditorInfo;
import android.view.inputmethod.InputMethodManager;
import android.webkit.CookieManager;
import android.webkit.JavascriptInterface;
import android.webkit.JsResult;
import android.webkit.RenderProcessGoneDetail;
import android.webkit.WebChromeClient;
import android.webkit.WebResourceError;
import android.webkit.WebResourceRequest;
import android.webkit.WebResourceResponse;
import android.webkit.WebView;
import android.webkit.WebView.HitTestResult;
import android.webkit.WebViewClient;
import android.widget.Button;
import android.widget.Chronometer;
import android.widget.EditText;
import android.widget.FrameLayout;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import com.afollestad.materialdialogs.MaterialDialog;
import com.google.android.material.snackbar.Snackbar;
import com.ichi2.anim.ViewAnimation;
import com.ichi2.anki.cardviewer.GestureTapProcessor;
import com.ichi2.anki.cardviewer.MissingImageHandler;
import com.ichi2.anki.dialogs.TagsDialog;
import com.ichi2.anki.multimediacard.AudioView;
import com.ichi2.anki.cardviewer.CardAppearance;
import com.ichi2.anki.receiver.SdCardReceiver;
import com.ichi2.anki.reviewer.CardMarker;
import com.ichi2.anki.cardviewer.CardTemplate;
import com.ichi2.anki.reviewer.ReviewerCustomFonts;
import com.ichi2.anki.reviewer.ReviewerUi;
import com.ichi2.anki.cardviewer.TypedAnswer;
import com.ichi2.async.CollectionTask;
import com.ichi2.async.TaskListener;
import com.ichi2.async.TaskManager;
import com.ichi2.compat.CompatHelper;
import com.ichi2.libanki.Decks;
import com.ichi2.libanki.Model;
import com.ichi2.libanki.sched.AbstractSched;
import com.ichi2.libanki.Card;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Consts;
import com.ichi2.libanki.DeckConfig;
import com.ichi2.libanki.Note;
import com.ichi2.libanki.Sound;
import com.ichi2.libanki.Utils;
import com.ichi2.libanki.template.MathJax;
import com.ichi2.libanki.template.TemplateFilters;
import com.ichi2.themes.HtmlColors;
import com.ichi2.themes.Themes;
import com.ichi2.utils.AdaptionUtil;
import com.ichi2.utils.AndroidUiUtils;
import com.ichi2.utils.ClipboardUtil;
import com.ichi2.utils.BooleanGetter;
import com.ichi2.utils.CardGetter;
import com.ichi2.utils.DiffEngine;
import com.ichi2.utils.FunctionalInterfaces.Consumer;
import com.ichi2.utils.FunctionalInterfaces.Function;
import com.ichi2.utils.JSONArray;
import com.ichi2.utils.JSONException;
import com.ichi2.utils.JSONObject;
import com.ichi2.utils.WebViewDebugging;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.lang.ref.WeakReference;
import java.net.URLDecoder;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedHashSet;
import java.util.Set;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import timber.log.Timber;
import static com.ichi2.anki.cardviewer.CardAppearance.calculateDynamicFontSize;
import static com.ichi2.anki.cardviewer.ViewerCommand.*;
import static com.ichi2.anki.reviewer.CardMarker.*;
import static com.ichi2.libanki.Sound.SoundSide;
import com.github.zafarkhaja.semver.Version;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.*;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

@SuppressWarnings({ &quot;PMD.AvoidThrowingRawExceptionTypes&quot;, &quot;PMD.FieldDeclarationsShouldBeAtStartOfClass&quot; })
<span class="nc" id="L160">public abstract class AbstractFlashcardViewer extends NavigationDrawerActivity implements ReviewerUi, CommandProcessor {</span>

    /**
     * Result codes that are returned when this activity finishes.
     */
    public static final int RESULT_DEFAULT = 50;

    public static final int RESULT_NO_MORE_CARDS = 52;

    public static final int RESULT_ABORT_AND_SYNC = 53;

    /**
     * Available options performed by other activities.
     */
    public static final int EDIT_CURRENT_CARD = 0;

    public static final int DECK_OPTIONS = 1;

    public static final int EASE_1 = 1;

    public static final int EASE_2 = 2;

    public static final int EASE_3 = 3;

    public static final int EASE_4 = 4;

    /**
     * Maximum time in milliseconds to wait before accepting answer button presses.
     */
    @VisibleForTesting
    protected static final int DOUBLE_TAP_IGNORE_THRESHOLD = 200;

    /**
     * Time to wait in milliseconds before resuming fullscreen mode *
     */
    protected static final int INITIAL_HIDE_DELAY = 200;

    // Type answer patterns
<span class="nc" id="L198">    private static final Pattern sTypeAnsPat = Pattern.compile(&quot;\\[\\[type:(.+?)]]&quot;);</span>

    /**
     * to be sent to and from the card editor
     */
    private static Card sEditorCard;

<span class="nc" id="L205">    protected static boolean sDisplayAnswer = false;</span>

<span class="nc" id="L207">    private boolean mTtsInitialized = false;</span>

<span class="nc" id="L209">    private boolean mReplayOnTtsInit = false;</span>

    protected static final int MENU_DISABLED = 3;

    // js api developer contact
<span class="nc" id="L214">    private String mCardSuppliedDeveloperContact = &quot;&quot;;</span>

<span class="nc" id="L216">    private String mCardSuppliedApiVersion = &quot;&quot;;</span>

    private static final String sCurrentJsApiVersion = &quot;0.0.1&quot;;

    private static final String sMinimumJsApiVersion = &quot;0.0.1&quot;;

    // JS API ERROR CODE
    private static final int ankiJsErrorCodeDefault = 0;

    private static final int ankiJsErrorCodeMarkCard = 1;

    private static final int ankiJsErrorCodeFlagCard = 2;

    /**
     * Broadcast that informs us when the sd card is about to be unmounted
     */
<span class="nc" id="L232">    private BroadcastReceiver mUnmountReceiver = null;</span>

    /**
     * Variables to hold preferences
     */
    private CardAppearance mCardAppearance;

    private boolean mPrefShowTopbar;

    private boolean mShowTimer;

    protected boolean mPrefWhiteboard;

    private int mPrefFullscreenReview;

    private int mRelativeButtonSize;

    private boolean mDoubleScrolling;

    private boolean mScrollingButtons;

    private boolean mGesturesEnabled;

    // Android WebView
    protected boolean mSpeakText;

<span class="nc" id="L258">    protected boolean mDisableClipboard = false;</span>

    protected boolean mOptUseGeneralTimerSettings;

    protected boolean mUseTimer;

    protected int mWaitAnswerSecond;

    protected int mWaitQuestionSecond;

    protected boolean mPrefUseTimer;

    protected boolean mOptUseTimer;

    protected int mOptWaitAnswerSecond;

    protected int mOptWaitQuestionSecond;

    protected boolean mUseInputTag;

    private boolean mDoNotUseCodeFormatting;

    // Default short animation duration, provided by Android framework
    protected int mShortAnimDuration;

    // Preferences from the collection
    private boolean mShowNextReviewTime;

    // Answer card &amp; cloze deletion variables
<span class="nc" id="L287">    private String mTypeCorrect = null;</span>

    // What the learner actually typed
<span class="nc" id="L290">    private String mTypeInput = &quot;&quot;;</span>

    // Font face of the compare to field
<span class="nc" id="L293">    private String mTypeFont = &quot;&quot;;</span>

    // Its font size
<span class="nc" id="L296">    private int mTypeSize = 0;</span>

    private String mTypeWarning;

<span class="nc" id="L300">    private boolean mIsSelecting = false;</span>

<span class="nc" id="L302">    private boolean mTouchStarted = false;</span>

<span class="nc" id="L304">    private boolean mInAnswer = false;</span>

<span class="nc" id="L306">    private boolean mAnswerSoundsAdded = false;</span>

    private CardTemplate mCardTemplate;

    /**
     * Variables to hold layout objects that we need to update or handle events for
     */
    private View mLookUpIcon;

    private WebView mCardWebView;

    private FrameLayout mCardFrame;

    private FrameLayout mTouchLayer;

    private TextView mChosenAnswer;

    protected TextView mNext1;

    protected TextView mNext2;

    protected TextView mNext3;

    protected TextView mNext4;

    protected EditText mAnswerField;

    protected TextView mEase1;

    protected TextView mEase2;

    protected TextView mEase3;

    protected TextView mEase4;

    protected LinearLayout mFlipCardLayout;

    protected LinearLayout mEaseButtonsLayout;

    protected LinearLayout mEase1Layout;

    protected LinearLayout mEase2Layout;

    protected LinearLayout mEase3Layout;

    protected LinearLayout mEase4Layout;

    protected FrameLayout mPreviewButtonsLayout;

    protected ImageView mPreviewPrevCard;

    protected ImageView mPreviewNextCard;

    protected TextView mPreviewToggleAnswerText;

    protected RelativeLayout mTopBarLayout;

    private Chronometer mCardTimer;

    protected Whiteboard mWhiteboard;

    private android.content.ClipboardManager mClipboard;

    protected Card mCurrentCard;

    private int mCurrentEase;

<span class="nc" id="L373">    private boolean mButtonHeightSet = false;</span>

    private static final int sShowChosenAnswerLength = 2000;

    /**
     * A record of the last time the &quot;show answer&quot; or ease buttons were pressed. We keep track
     * of this time to ignore accidental button presses.
     */
    @VisibleForTesting
    protected long mLastClickTime;

    /**
     * Swipe Detection
     */
    private GestureDetector gestureDetector;

    private MyGestureDetector mGestureDetectorImpl;

    private boolean mLinkOverridesTouchGesture;

<span class="nc" id="L393">    private boolean mIsXScrolling = false;</span>

<span class="nc" id="L395">    private boolean mIsYScrolling = false;</span>

    /**
     * Gesture Allocation
     */
    private int mGestureSwipeUp;

    private int mGestureSwipeDown;

    private int mGestureSwipeLeft;

    private int mGestureSwipeRight;

    private int mGestureDoubleTap;

    private int mGestureLongclick;

    private int mGestureVolumeUp;

    private int mGestureVolumeDown;

<span class="nc" id="L416">    private GestureTapProcessor mGestureTapProcessor = new GestureTapProcessor();</span>

    private String mCardContent;

    private String mBaseUrl;

    private String mViewerUrl;

    private WebViewAssetLoader mAssetLoader;

<span class="nc" id="L426">    private final int mFadeDuration = 300;</span>

    protected AbstractSched mSched;

<span class="nc" id="L430">    private final Sound mSoundPlayer = new Sound();</span>

    /**
     * Time taken o play all medias in mSoundPlayer
     */
    private long mUseTimerDynamicMS;

    /**
     * File of the temporary mic record *
     */
    protected AudioView mMicToolBar;

    protected String mTempAudioPath;

    /**
     * Last card that the WebView Renderer crashed on.
     * If we get 2 crashes on the same card, then we likely have an infinite loop and want to exit gracefully.
     */
<span class="nc" id="L448">    @Nullable</span>
    private Long lastCrashingCardId = null;

    /**
     * Reference to the parent of the cardFrame to allow regeneration of the cardFrame in case of crash
     */
    private ViewGroup mCardFrameParent;

    /**
     * Lock to allow thread-safe regeneration of mCard
     */
<span class="nc" id="L459">    private final ReadWriteLock mCardLock = new ReentrantReadWriteLock();</span>

    /**
     * whether controls are currently blocked, and how long we expect them to be
     */
<span class="nc" id="L464">    private ReviewerUi.ControlBlock mControlBlocked = ControlBlock.SLOW;</span>

    /**
     * Handle Mark/Flag state of cards
     */
    private CardMarker mCardMarker;

    /**
     * Handle providing help for &quot;Image Not Found&quot;
     */
<span class="nc" id="L474">    private static final MissingImageHandler mMissingImageHandler = new MissingImageHandler();</span>

<span class="nc" id="L476">    private final Handler mHandler = new Handler() {</span>

        @Override
        public void handleMessage(Message msg) {
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4172)) {</span>
<span class="nc" id="L481">                mSoundPlayer.stopSounds();</span>
            }
<span class="nc bnc" id="L483" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4173)) {</span>
<span class="nc" id="L484">                mSoundPlayer.playSound((String) msg.obj, null, null, getSoundErrorListener());</span>
            }
<span class="nc" id="L486">        }</span>
    };

<span class="nc" id="L489">    private final Handler longClickHandler = new Handler();</span>

<span class="nc" id="L491">    private final Runnable longClickTestRunnable = new Runnable() {</span>

        @Override
        public void run() {
<span class="nc bnc" id="L495" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4174)) {</span>
<span class="nc" id="L496">                Timber.i(&quot;AbstractFlashcardViewer:: onEmulatedLongClick&quot;);</span>
            }
<span class="nc bnc" id="L498" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4177)) {</span>
                // Show hint about lookup function if dictionary available
<span class="nc bnc" id="L500" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(4175) ? (!mDisableClipboard || Lookup.isAvailable()) : (!mDisableClipboard &amp;&amp; Lookup.isAvailable()))) {</span>
<span class="nc" id="L501">                    String lookupHint = getResources().getString(R.string.lookup_hint);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4176)) {</span>
<span class="nc" id="L503">                        UIUtils.showThemedToast(AbstractFlashcardViewer.this, lookupHint, false);</span>
                    }
                }
            }
<span class="nc bnc" id="L507" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4178)) {</span>
<span class="nc" id="L508">                CompatHelper.getCompat().vibrate(AnkiDroidApp.getInstance().getApplicationContext(), 50);</span>
            }
<span class="nc bnc" id="L510" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4179)) {</span>
<span class="nc" id="L511">                longClickHandler.postDelayed(startLongClickAction, 300);</span>
            }
<span class="nc" id="L513">        }</span>
    };

<span class="nc" id="L516">    private final Runnable startLongClickAction = new Runnable() {</span>

        @Override
        public void run() {
<span class="nc bnc" id="L520" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4180)) {</span>
<span class="nc" id="L521">                executeCommand(mGestureLongclick);</span>
            }
<span class="nc" id="L523">        }</span>
    };

    // Handler for the &quot;show answer&quot; button
<span class="nc" id="L527">    private final View.OnClickListener mFlipCardListener = new View.OnClickListener() {</span>

        @Override
        public void onClick(View view) {
<span class="nc bnc" id="L531" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4181)) {</span>
<span class="nc" id="L532">                Timber.i(&quot;AbstractFlashcardViewer:: Show answer button pressed&quot;);</span>
            }
<span class="nc bnc" id="L534" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4191)) {</span>
                // Ignore what is most likely an accidental double-tap.
<span class="nc bnc" id="L536" title="All 70 branches missed.">                if ((ListenerUtil.mutListener.listen(4190) ? ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &gt;= DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4189) ? ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &lt;= DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4188) ? ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &gt; DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4187) ? ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) != DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4186) ? ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) == DOUBLE_TAP_IGNORE_THRESHOLD) : ((ListenerUtil.mutListener.listen(4185) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4184) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4183) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4182) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &lt; DOUBLE_TAP_IGNORE_THRESHOLD))))))) {</span>
<span class="nc" id="L537">                    return;</span>
                }
            }
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4192)) {</span>
<span class="nc" id="L541">                mLastClickTime = SystemClock.elapsedRealtime();</span>
            }
<span class="nc bnc" id="L543" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4193)) {</span>
<span class="nc" id="L544">                mTimeoutHandler.removeCallbacks(mShowAnswerTask);</span>
            }
<span class="nc bnc" id="L546" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4194)) {</span>
<span class="nc" id="L547">                displayCardAnswer();</span>
            }
<span class="nc" id="L549">        }</span>
    };

<span class="nc" id="L552">    private final View.OnClickListener mSelectEaseHandler = new View.OnClickListener() {</span>

        @Override
        public void onClick(View view) {
<span class="nc bnc" id="L556" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4204)) {</span>
                // Ignore what is most likely an accidental double-tap.
<span class="nc bnc" id="L558" title="All 70 branches missed.">                if ((ListenerUtil.mutListener.listen(4203) ? ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &gt;= DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4202) ? ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &lt;= DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4201) ? ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &gt; DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4200) ? ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) != DOUBLE_TAP_IGNORE_THRESHOLD) : (ListenerUtil.mutListener.listen(4199) ? ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) == DOUBLE_TAP_IGNORE_THRESHOLD) : ((ListenerUtil.mutListener.listen(4198) ? (SystemClock.elapsedRealtime() % mLastClickTime) : (ListenerUtil.mutListener.listen(4197) ? (SystemClock.elapsedRealtime() / mLastClickTime) : (ListenerUtil.mutListener.listen(4196) ? (SystemClock.elapsedRealtime() * mLastClickTime) : (ListenerUtil.mutListener.listen(4195) ? (SystemClock.elapsedRealtime() + mLastClickTime) : (SystemClock.elapsedRealtime() - mLastClickTime))))) &lt; DOUBLE_TAP_IGNORE_THRESHOLD))))))) {</span>
<span class="nc" id="L559">                    return;</span>
                }
            }
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4205)) {</span>
<span class="nc" id="L563">                mLastClickTime = SystemClock.elapsedRealtime();</span>
            }
<span class="nc bnc" id="L565" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4206)) {</span>
<span class="nc" id="L566">                mTimeoutHandler.removeCallbacks(mShowQuestionTask);</span>
            }
<span class="nc" id="L568">            int id = view.getId();</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4216)) {</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">                if (id == R.id.flashcard_layout_ease1) {</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4214)) {</span>
<span class="nc" id="L572">                        Timber.i(&quot;AbstractFlashcardViewer:: EASE_1 pressed&quot;);</span>
                    }
<span class="nc bnc" id="L574" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4215)) {</span>
<span class="nc" id="L575">                        answerCard(Consts.BUTTON_ONE);</span>
                    }
<span class="nc bnc" id="L577" title="All 2 branches missed.">                } else if (id == R.id.flashcard_layout_ease2) {</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4212)) {</span>
<span class="nc" id="L579">                        Timber.i(&quot;AbstractFlashcardViewer:: EASE_2 pressed&quot;);</span>
                    }
<span class="nc bnc" id="L581" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4213)) {</span>
<span class="nc" id="L582">                        answerCard(Consts.BUTTON_TWO);</span>
                    }
<span class="nc bnc" id="L584" title="All 2 branches missed.">                } else if (id == R.id.flashcard_layout_ease3) {</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4210)) {</span>
<span class="nc" id="L586">                        Timber.i(&quot;AbstractFlashcardViewer:: EASE_3 pressed&quot;);</span>
                    }
<span class="nc bnc" id="L588" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4211)) {</span>
<span class="nc" id="L589">                        answerCard(Consts.BUTTON_THREE);</span>
                    }
<span class="nc bnc" id="L591" title="All 2 branches missed.">                } else if (id == R.id.flashcard_layout_ease4) {</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4208)) {</span>
<span class="nc" id="L593">                        Timber.i(&quot;AbstractFlashcardViewer:: EASE_4 pressed&quot;);</span>
                    }
<span class="nc bnc" id="L595" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4209)) {</span>
<span class="nc" id="L596">                        answerCard(Consts.BUTTON_FOUR);</span>
                    }
                } else {
<span class="nc bnc" id="L599" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4207)) {</span>
<span class="nc" id="L600">                        mCurrentEase = 0;</span>
                    }
                }
            }
<span class="nc" id="L604">        }</span>
    };

<span class="nc" id="L607">    private final View.OnTouchListener mGestureListener = new View.OnTouchListener() {</span>

        @Override
        public boolean onTouch(View v, MotionEvent event) {
<span class="nc bnc" id="L611" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4217)) {</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">                if (gestureDetector.onTouchEvent(event)) {</span>
<span class="nc" id="L613">                    return true;</span>
                }
            }
<span class="nc bnc" id="L616" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4226)) {</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">                if (!mDisableClipboard) {</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4225)) {</span>
<span class="nc bnc" id="L619" title="All 3 branches missed.">                        switch(event.getAction()) {</span>
                            case MotionEvent.ACTION_DOWN:
<span class="nc bnc" id="L621" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4218)) {</span>
<span class="nc" id="L622">                                    mTouchStarted = true;</span>
                                }
<span class="nc bnc" id="L624" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4219)) {</span>
<span class="nc" id="L625">                                    longClickHandler.postDelayed(longClickTestRunnable, 800);</span>
                                }
                                break;
                            case MotionEvent.ACTION_UP:
                            case MotionEvent.ACTION_MOVE:
<span class="nc bnc" id="L630" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4222)) {</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">                                    if (mTouchStarted) {</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(4220)) {</span>
<span class="nc" id="L633">                                            longClickHandler.removeCallbacks(longClickTestRunnable);</span>
                                        }
<span class="nc bnc" id="L635" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(4221)) {</span>
<span class="nc" id="L636">                                            mTouchStarted = false;</span>
                                        }
                                    }
                                }
                                break;
                            default:
<span class="nc bnc" id="L642" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4223)) {</span>
<span class="nc" id="L643">                                    longClickHandler.removeCallbacks(longClickTestRunnable);</span>
                                }
<span class="nc bnc" id="L645" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4224)) {</span>
<span class="nc" id="L646">                                    mTouchStarted = false;</span>
                                }
                                break;
                        }
                    }
                }
            }
<span class="nc bnc" id="L653" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4227)) {</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">                if (!mGestureDetectorImpl.eventCanBeSentToWebView(event)) {</span>
<span class="nc" id="L655">                    return false;</span>
                }
            }
<span class="nc bnc" id="L658" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4228)) {</span>
                // Gesture listener is added before mCard is set
<span class="nc" id="L660">                processCardAction(cardWebView -&gt; {</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">                    if (cardWebView == null)</span>
<span class="nc" id="L662">                        return;</span>
<span class="nc" id="L663">                    cardWebView.dispatchTouchEvent(event);</span>
<span class="nc" id="L664">                });</span>
            }
<span class="nc" id="L666">            return false;</span>
        }
    };

    @SuppressLint(&quot;CheckResult&quot;)
    // This is intentionally package-private as it removes the need for synthetic accessors
    void processCardAction(Consumer&lt;WebView&gt; cardConsumer) {
<span class="nc bnc" id="L673" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4229)) {</span>
<span class="nc" id="L674">            processCardFunction(cardWebView -&gt; {</span>
<span class="nc" id="L675">                cardConsumer.consume(cardWebView);</span>
<span class="nc" id="L676">                return true;</span>
            });
        }
<span class="nc" id="L679">    }</span>

    @CheckResult
    private &lt;T&gt; T processCardFunction(Function&lt;WebView, T&gt; cardFunction) {
<span class="nc" id="L683">        Lock readLock = mCardLock.readLock();</span>
        try {
<span class="nc bnc" id="L685" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4231)) {</span>
<span class="nc" id="L686">                readLock.lock();</span>
            }
<span class="nc" id="L688">            return cardFunction.apply(mCardWebView);</span>
        } finally {
<span class="nc bnc" id="L690" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4230)) {</span>
<span class="nc" id="L691">                readLock.unlock();</span>
            }
        }
    }

<span class="nc" id="L696">    protected final NextCardHandler&lt;BooleanGetter&gt; mDismissCardHandler = new NextCardHandler() {</span>
    };

<span class="nc" id="L699">    private final TaskListener&lt;CardGetter, BooleanGetter&gt; mUpdateCardHandler = new TaskListener&lt;CardGetter, BooleanGetter&gt;() {</span>

        private boolean mNoMoreCards;

        @Override
        public void onPreExecute() {
<span class="nc bnc" id="L705" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4232)) {</span>
<span class="nc" id="L706">                showProgressBar();</span>
            }
<span class="nc" id="L708">        }</span>

        @Override
        public void onProgressUpdate(CardGetter cardGetter) {
<span class="nc" id="L712">            Card card = cardGetter.getCard();</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4234)) {</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">                if (mCurrentCard != card) {</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4233)) {</span>
                        /*
                 * Before updating mCurrentCard, we check whether it is changing or not. If the current card changes,
                 * then we need to display it as a new card, without showing the answer.
                 */
<span class="nc" id="L720">                        sDisplayAnswer = false;</span>
                    }
                }
            }
<span class="nc bnc" id="L724" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4235)) {</span>
<span class="nc" id="L725">                mCurrentCard = card;</span>
            }
<span class="nc bnc" id="L727" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4236)) {</span>
                // Tasks should always be launched from GUI. So in
<span class="nc" id="L729">                TaskManager.launchCollectionTask(new CollectionTask.PreloadNextCard());</span>
            }
<span class="nc bnc" id="L731" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4239)) {</span>
                // listener and not in background
<span class="nc bnc" id="L733" title="All 2 branches missed.">                if (mCurrentCard == null) {</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4237)) {</span>
                        // If the card is null means that there are no more cards scheduled for review.
<span class="nc" id="L736">                        mNoMoreCards = true;</span>
                    }
<span class="nc bnc" id="L738" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4238)) {</span>
<span class="nc" id="L739">                        showProgressBar();</span>
                    }
<span class="nc" id="L741">                    return;</span>
                }
            }
<span class="nc bnc" id="L744" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4242)) {</span>
<span class="nc bnc" id="L745" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(4240) ? (mPrefWhiteboard || mWhiteboard != null) : (mPrefWhiteboard &amp;&amp; mWhiteboard != null))) {</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4241)) {</span>
<span class="nc" id="L747">                        mWhiteboard.clear();</span>
                    }
                }
            }
<span class="nc bnc" id="L751" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4243)) {</span>
<span class="nc" id="L752">                updateTypeAnswerInfo();</span>
            }
<span class="nc bnc" id="L754" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4251)) {</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">                if (sDisplayAnswer) {</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4247)) {</span>
                        // load sounds from scratch, to expose any edit changes
<span class="nc" id="L758">                        mSoundPlayer.resetSounds();</span>
                    }
<span class="nc bnc" id="L760" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4248)) {</span>
                        // causes answer sounds to be reloaded
<span class="nc" id="L762">                        mAnswerSoundsAdded = false;</span>
                    }
<span class="nc bnc" id="L764" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4249)) {</span>
                        // questions must be intentionally regenerated
<span class="nc" id="L766">                        generateQuestionSoundList();</span>
                    }
<span class="nc bnc" id="L768" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4250)) {</span>
<span class="nc" id="L769">                        displayCardAnswer();</span>
                    }
                } else {
<span class="nc bnc" id="L772" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4244)) {</span>
<span class="nc" id="L773">                        displayCardQuestion();</span>
                    }
<span class="nc bnc" id="L775" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4245)) {</span>
<span class="nc" id="L776">                        mCurrentCard.startTimer();</span>
                    }
<span class="nc bnc" id="L778" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4246)) {</span>
<span class="nc" id="L779">                        initTimer();</span>
                    }
                }
            }
<span class="nc bnc" id="L783" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4252)) {</span>
<span class="nc" id="L784">                hideProgressBar();</span>
            }
<span class="nc" id="L786">        }</span>

        @Override
        public void onPostExecute(BooleanGetter result) {
<span class="nc bnc" id="L790" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4254)) {</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">                if (!result.getBoolean()) {</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4253)) {</span>
                        // RuntimeException occurred on update cards
<span class="nc" id="L794">                        closeReviewer(DeckPicker.RESULT_DB_ERROR, false);</span>
                    }
<span class="nc" id="L796">                    return;</span>
                }
            }
<span class="nc bnc" id="L799" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4256)) {</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">                if (mNoMoreCards) {</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4255)) {</span>
<span class="nc" id="L802">                        closeReviewer(RESULT_NO_MORE_CARDS, true);</span>
                    }
                }
            }
<span class="nc" id="L806">        }</span>
    };

<span class="nc" id="L809">    abstract class NextCardHandler&lt;Result extends BooleanGetter&gt; extends TaskListener&lt;Card, Result&gt; {</span>

        private boolean mNoMoreCards;

        @Override
        public void onPreExecute() {
<span class="nc bnc" id="L815" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4257)) {</span>
<span class="nc" id="L816">                dealWithTimeBox();</span>
            }
<span class="nc" id="L818">        }</span>

        @Override
        public void onProgressUpdate(Card card) {
<span class="nc bnc" id="L822" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4258)) {</span>
<span class="nc" id="L823">                displayNext(card);</span>
            }
<span class="nc" id="L825">        }</span>

        protected void displayNext(Card nextCard) {
<span class="nc" id="L828">            Resources res = getResources();</span>
<span class="nc bnc" id="L829" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4260)) {</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">                if (mSched == null) {</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4259)) {</span>
                        // TODO: proper testing for restored activity
<span class="nc" id="L833">                        finishWithoutAnimation();</span>
                    }
<span class="nc" id="L835">                    return;</span>
                }
            }
<span class="nc bnc" id="L838" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4261)) {</span>
<span class="nc" id="L839">                mCurrentCard = nextCard;</span>
            }
<span class="nc bnc" id="L841" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4268)) {</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">                if (mCurrentCard == null) {</span>
<span class="nc bnc" id="L843" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4267)) {</span>
                        // other handlers use this, toggle state every time through
<span class="nc" id="L845">                        mNoMoreCards = true;</span>
                    }
                } else {
<span class="nc bnc" id="L848" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4262)) {</span>
                        // other handlers use this, toggle state every time through
<span class="nc" id="L850">                        mNoMoreCards = false;</span>
                    }
<span class="nc bnc" id="L852" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4263)) {</span>
                        // Start reviewing next card
<span class="nc" id="L854">                        updateTypeAnswerInfo();</span>
                    }
<span class="nc bnc" id="L856" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4264)) {</span>
<span class="nc" id="L857">                        hideProgressBar();</span>
                    }
<span class="nc bnc" id="L859" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4265)) {</span>
<span class="nc" id="L860">                        AbstractFlashcardViewer.this.unblockControls();</span>
                    }
<span class="nc bnc" id="L862" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4266)) {</span>
<span class="nc" id="L863">                        AbstractFlashcardViewer.this.displayCardQuestion();</span>
                    }
                }
            }
<span class="nc" id="L867">        }</span>

        private void dealWithTimeBox() {
<span class="nc" id="L870">            Resources res = getResources();</span>
<span class="nc" id="L871">            Pair&lt;Integer, Integer&gt; elapsed = getCol().timeboxReached();</span>
<span class="nc bnc" id="L872" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4275)) {</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">                if (elapsed != null) {</span>
<span class="nc" id="L874">                    int nCards = elapsed.second;</span>
<span class="nc bnc" id="L875" title="All 8 branches missed.">                    int nMins = (ListenerUtil.mutListener.listen(4272) ? (elapsed.first % 60) : (ListenerUtil.mutListener.listen(4271) ? (elapsed.first * 60) : (ListenerUtil.mutListener.listen(4270) ? (elapsed.first - 60) : (ListenerUtil.mutListener.listen(4269) ? (elapsed.first + 60) : (elapsed.first / 60)))));</span>
<span class="nc" id="L876">                    String mins = res.getQuantityString(R.plurals.in_minutes, nMins, nMins);</span>
<span class="nc" id="L877">                    String timeboxMessage = res.getQuantityString(R.plurals.timebox_reached, nCards, nCards, mins);</span>
<span class="nc bnc" id="L878" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4273)) {</span>
<span class="nc" id="L879">                        UIUtils.showThemedToast(AbstractFlashcardViewer.this, timeboxMessage, true);</span>
                    }
<span class="nc bnc" id="L881" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4274)) {</span>
<span class="nc" id="L882">                        getCol().startTimebox();</span>
                    }
                }
            }
<span class="nc" id="L886">        }</span>

        @Override
        public void onPostExecute(Result result) {
<span class="nc bnc" id="L890" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4276)) {</span>
<span class="nc" id="L891">                postNextCardDisplay(result.getBoolean());</span>
            }
<span class="nc" id="L893">        }</span>

        protected void postNextCardDisplay(boolean displaySuccess) {
<span class="nc bnc" id="L896" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4278)) {</span>
<span class="nc bnc" id="L897" title="All 2 branches missed.">                if (!displaySuccess) {</span>
<span class="nc bnc" id="L898" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4277)) {</span>
                        // RuntimeException occurred on answering cards
<span class="nc" id="L900">                        closeReviewer(DeckPicker.RESULT_DB_ERROR, false);</span>
                    }
<span class="nc" id="L902">                    return;</span>
                }
            }
<span class="nc bnc" id="L905" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4280)) {</span>
                // precedence when returning to study options.
<span class="nc bnc" id="L907" title="All 2 branches missed.">                if (mNoMoreCards) {</span>
<span class="nc bnc" id="L908" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4279)) {</span>
<span class="nc" id="L909">                        closeReviewer(RESULT_NO_MORE_CARDS, true);</span>
                    }
                }
            }
<span class="nc bnc" id="L913" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4281)) {</span>
                // set the correct mark/unmark icon on action bar
<span class="nc" id="L915">                refreshActionBar();</span>
            }
<span class="nc bnc" id="L917" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4282)) {</span>
<span class="nc" id="L918">                focusDefaultLayout();</span>
            }
<span class="nc" id="L920">        }</span>
    }

    private void focusDefaultLayout() {
<span class="nc bnc" id="L924" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4287)) {</span>
<span class="nc bnc" id="L925" title="All 2 branches missed.">            if (!AndroidUiUtils.isRunningOnTv(this)) {</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4286)) {</span>
<span class="nc" id="L927">                    findViewById(R.id.root_layout).requestFocus();</span>
                }
            } else {
<span class="nc" id="L930">                View flip = findViewById(R.id.answer_options_layout);</span>
<span class="nc bnc" id="L931" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4283)) {</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">                    if (flip == null) {</span>
<span class="nc" id="L933">                        return;</span>
                    }
                }
<span class="nc bnc" id="L936" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4284)) {</span>
<span class="nc" id="L937">                    Timber.d(&quot;Requesting focus for flip button&quot;);</span>
                }
<span class="nc bnc" id="L939" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4285)) {</span>
<span class="nc" id="L940">                    flip.requestFocus();</span>
                }
            }
        }
<span class="nc" id="L944">    }</span>

    protected NextCardHandler&lt;BooleanGetter&gt; mAnswerCardHandler(boolean quick) {
<span class="nc" id="L947">        return new NextCardHandler() {</span>

            @Override
            public void onPreExecute() {
<span class="nc bnc" id="L951" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4288)) {</span>
<span class="nc" id="L952">                    super.onPreExecute();</span>
                }
<span class="nc bnc" id="L954" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4289)) {</span>
<span class="nc" id="L955">                    blockControls(quick);</span>
                }
<span class="nc" id="L957">            }</span>
        };
    }

    /**
     * Extract type answer/cloze text and font/size
     */
    private void updateTypeAnswerInfo() {
<span class="nc bnc" id="L965" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4290)) {</span>
<span class="nc" id="L966">            mTypeCorrect = null;</span>
        }
<span class="nc bnc" id="L968" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4291)) {</span>
<span class="nc" id="L969">            mTypeInput = &quot;&quot;;</span>
        }
<span class="nc" id="L971">        String q = mCurrentCard.q(false);</span>
<span class="nc" id="L972">        Matcher m = sTypeAnsPat.matcher(q);</span>
<span class="nc" id="L973">        int clozeIdx = 0;</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4292)) {</span>
<span class="nc bnc" id="L975" title="All 2 branches missed.">            if (!m.find()) {</span>
<span class="nc" id="L976">                return;</span>
            }
        }
<span class="nc" id="L979">        String fldTag = m.group(1);</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4299)) {</span>
            // if it's a cloze, extract data
<span class="nc bnc" id="L982" title="All 2 branches missed.">            if (fldTag.startsWith(&quot;cloze:&quot;)) {</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4297)) {</span>
                    // get field and cloze position
<span class="nc bnc" id="L985" title="All 8 branches missed.">                    clozeIdx = (ListenerUtil.mutListener.listen(4296) ? (mCurrentCard.getOrd() % 1) : (ListenerUtil.mutListener.listen(4295) ? (mCurrentCard.getOrd() / 1) : (ListenerUtil.mutListener.listen(4294) ? (mCurrentCard.getOrd() * 1) : (ListenerUtil.mutListener.listen(4293) ? (mCurrentCard.getOrd() - 1) : (mCurrentCard.getOrd() + 1)))));</span>
                }
<span class="nc bnc" id="L987" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4298)) {</span>
<span class="nc" id="L988">                    fldTag = fldTag.split(&quot;:&quot;)[1];</span>
                }
            }
        }
        // loop through fields for a match
<span class="nc" id="L993">        JSONArray flds = mCurrentCard.model().getJSONArray(&quot;flds&quot;);</span>
<span class="nc bnc" id="L994" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4311)) {</span>
            {
<span class="nc" id="L996">                long _loopCounter99 = 0;</span>
<span class="nc bnc" id="L997" title="All 2 branches missed.">                for (JSONObject fld : flds.jsonObjectIterable()) {</span>
<span class="nc" id="L998">                    ListenerUtil.loopListener.listen(&quot;_loopCounter99&quot;, ++_loopCounter99);</span>
<span class="nc" id="L999">                    String name = fld.getString(&quot;name&quot;);</span>
<span class="nc bnc" id="L1000" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4310)) {</span>
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                        if (name.equals(fldTag)) {</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4300)) {</span>
<span class="nc" id="L1003">                                mTypeCorrect = mCurrentCard.note().getItem(name);</span>
                            }
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4307)) {</span>
<span class="nc bnc" id="L1006" title="All 22 branches missed.">                                if ((ListenerUtil.mutListener.listen(4305) ? (clozeIdx &gt;= 0) : (ListenerUtil.mutListener.listen(4304) ? (clozeIdx &lt;= 0) : (ListenerUtil.mutListener.listen(4303) ? (clozeIdx &gt; 0) : (ListenerUtil.mutListener.listen(4302) ? (clozeIdx &lt; 0) : (ListenerUtil.mutListener.listen(4301) ? (clozeIdx == 0) : (clozeIdx != 0))))))) {</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(4306)) {</span>
                                        // narrow to cloze
<span class="nc" id="L1009">                                        mTypeCorrect = contentForCloze(mTypeCorrect, clozeIdx);</span>
                                    }
                                }
                            }
<span class="nc bnc" id="L1013" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4308)) {</span>
<span class="nc" id="L1014">                                mTypeFont = fld.getString(&quot;font&quot;);</span>
                            }
<span class="nc bnc" id="L1016" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4309)) {</span>
<span class="nc" id="L1017">                                mTypeSize = fld.getInt(&quot;size&quot;);</span>
                            }
                            break;
                        }
                    }
<span class="nc" id="L1022">                }</span>
            }
        }
<span class="nc bnc" id="L1025" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4322)) {</span>
<span class="nc bnc" id="L1026" title="All 2 branches missed.">            if (mTypeCorrect == null) {</span>
<span class="nc bnc" id="L1027" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4321)) {</span>
<span class="nc bnc" id="L1028" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(4318) ? (clozeIdx &gt;= 0) : (ListenerUtil.mutListener.listen(4317) ? (clozeIdx &lt;= 0) : (ListenerUtil.mutListener.listen(4316) ? (clozeIdx &gt; 0) : (ListenerUtil.mutListener.listen(4315) ? (clozeIdx &lt; 0) : (ListenerUtil.mutListener.listen(4314) ? (clozeIdx == 0) : (clozeIdx != 0))))))) {</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4320)) {</span>
<span class="nc" id="L1030">                            mTypeWarning = getResources().getString(R.string.empty_card_warning);</span>
                        }
                    } else {
<span class="nc bnc" id="L1033" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4319)) {</span>
<span class="nc" id="L1034">                            mTypeWarning = getResources().getString(R.string.unknown_type_field_warning, fldTag);</span>
                        }
                    }
                }
<span class="nc bnc" id="L1038" title="All 2 branches missed.">            } else if (&quot;&quot;.equals(mTypeCorrect)) {</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4313)) {</span>
<span class="nc" id="L1040">                    mTypeCorrect = null;</span>
                }
            } else {
<span class="nc bnc" id="L1043" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4312)) {</span>
<span class="nc" id="L1044">                    mTypeWarning = null;</span>
                }
            }
        }
<span class="nc" id="L1048">    }</span>

    /**
     * Format question field when it contains typeAnswer or clozes. If there was an error during type text extraction, a
     * warning is displayed
     *
     * @param buf The question text
     * @return The formatted question text
     */
    private String typeAnsQuestionFilter(String buf) {
<span class="nc" id="L1058">        Matcher m = sTypeAnsPat.matcher(buf);</span>
<span class="nc bnc" id="L1059" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4323)) {</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">            if (mTypeWarning != null) {</span>
<span class="nc" id="L1061">                return m.replaceFirst(mTypeWarning);</span>
            }
        }
<span class="nc" id="L1064">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L1065" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4339)) {</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">            if (mUseInputTag) {</span>
<span class="nc bnc" id="L1067" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4328)) {</span>
                    // shouldOverrideUrlLoading() in createWebView() in this file.
<span class="nc" id="L1069">                    sb.append(&quot;&lt;center&gt;\n&lt;input type=\&quot;text\&quot; name=\&quot;typed\&quot; id=\&quot;typeans\&quot; onfocus=\&quot;taFocus();\&quot; &quot; + &quot;onblur=\&quot;taBlur(this);\&quot; onKeyPress=\&quot;return taKey(this, event)\&quot; autocomplete=\&quot;off\&quot; &quot;);</span>
                }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4337)) {</span>
                    // desktop just doesnâ€™t show the input tag there. Do it with standard values here instead.)
<span class="nc bnc" id="L1073" title="All 66 branches missed.">                    if ((ListenerUtil.mutListener.listen(4335) ? ((ListenerUtil.mutListener.listen(4329) ? (mTypeFont != null || !TextUtils.isEmpty(mTypeFont)) : (mTypeFont != null &amp;&amp; !TextUtils.isEmpty(mTypeFont))) || (ListenerUtil.mutListener.listen(4334) ? (mTypeSize &gt;= 0) : (ListenerUtil.mutListener.listen(4333) ? (mTypeSize &lt;= 0) : (ListenerUtil.mutListener.listen(4332) ? (mTypeSize &lt; 0) : (ListenerUtil.mutListener.listen(4331) ? (mTypeSize != 0) : (ListenerUtil.mutListener.listen(4330) ? (mTypeSize == 0) : (mTypeSize &gt; 0))))))) : ((ListenerUtil.mutListener.listen(4329) ? (mTypeFont != null || !TextUtils.isEmpty(mTypeFont)) : (mTypeFont != null &amp;&amp; !TextUtils.isEmpty(mTypeFont))) &amp;&amp; (ListenerUtil.mutListener.listen(4334) ? (mTypeSize &gt;= 0) : (ListenerUtil.mutListener.listen(4333) ? (mTypeSize &lt;= 0) : (ListenerUtil.mutListener.listen(4332) ? (mTypeSize &lt; 0) : (ListenerUtil.mutListener.listen(4331) ? (mTypeSize != 0) : (ListenerUtil.mutListener.listen(4330) ? (mTypeSize == 0) : (mTypeSize &gt; 0))))))))) {</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4336)) {</span>
<span class="nc" id="L1075">                            sb.append(&quot;style=\&quot;font-family: '&quot;).append(mTypeFont).append(&quot;'; font-size: &quot;).append(mTypeSize).append(&quot;px;\&quot; &quot;);</span>
                        }
                    }
                }
<span class="nc bnc" id="L1079" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4338)) {</span>
<span class="nc" id="L1080">                    sb.append(&quot;&gt;\n&lt;/center&gt;\n&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L1083" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4324)) {</span>
<span class="nc" id="L1084">                    sb.append(&quot;&lt;span id=\&quot;typeans\&quot; class=\&quot;typePrompt&quot;);</span>
                }
<span class="nc bnc" id="L1086" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4326)) {</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                    if (mUseInputTag) {</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4325)) {</span>
<span class="nc" id="L1089">                            sb.append(&quot; typeOff&quot;);</span>
                        }
                    }
                }
<span class="nc bnc" id="L1093" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4327)) {</span>
<span class="nc" id="L1094">                    sb.append(&quot;\&quot;&gt;........&lt;/span&gt;&quot;);</span>
                }
            }
        }
<span class="nc" id="L1098">        return m.replaceAll(sb.toString());</span>
    }

    /**
     * Fill the placeholder for the type comparison. Show the correct answer, and the comparison if appropriate.
     *
     * @param buf The answer text
     * @param userAnswer Text typed by the user, or empty.
     * @param correctAnswer The correct answer, taken from the note.
     * @return The formatted answer text
     */
    @VisibleForTesting
    String typeAnsAnswerFilter(String buf, String userAnswer, String correctAnswer) {
<span class="nc" id="L1111">        Matcher m = sTypeAnsPat.matcher(buf);</span>
<span class="nc" id="L1112">        DiffEngine diffEngine = new DiffEngine();</span>
<span class="nc" id="L1113">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4340)) {</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">            sb.append(mDoNotUseCodeFormatting ? &quot;&lt;div&gt;&lt;span id=\&quot;typeans\&quot;&gt;&quot; : &quot;&lt;div&gt;&lt;code id=\&quot;typeans\&quot;&gt;&quot;);</span>
        }
<span class="nc bnc" id="L1117" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4350)) {</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">            if (!TextUtils.isEmpty(userAnswer)) {</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4349)) {</span>
                    // The user did type something.
<span class="nc bnc" id="L1121" title="All 2 branches missed.">                    if (userAnswer.equals(correctAnswer)) {</span>
<span class="nc bnc" id="L1122" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4347)) {</span>
                            // and it was right.
<span class="nc" id="L1124">                            sb.append(Matcher.quoteReplacement(DiffEngine.wrapGood(correctAnswer)));</span>
                        }
<span class="nc bnc" id="L1126" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4348)) {</span>
                            // Heavy check mark
<span class="nc" id="L1128">                            sb.append(&quot;&lt;span id=\&quot;typecheckmark\&quot;&gt;\u2714&lt;/span&gt;&quot;);</span>
                        }
                    } else {
                        // exactly the same as the correct text.
<span class="nc" id="L1132">                        String[] diffedStrings = diffEngine.diffedHtmlStrings(correctAnswer, userAnswer);</span>
<span class="nc bnc" id="L1133" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4344)) {</span>
                            // We know we get back two strings.
<span class="nc" id="L1135">                            sb.append(Matcher.quoteReplacement(diffedStrings[0]));</span>
                        }
<span class="nc bnc" id="L1137" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4345)) {</span>
<span class="nc" id="L1138">                            sb.append(&quot;&lt;br&gt;&lt;span id=\&quot;typearrow\&quot;&gt;&amp;darr;&lt;/span&gt;&lt;br&gt;&quot;);</span>
                        }
<span class="nc bnc" id="L1140" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4346)) {</span>
<span class="nc" id="L1141">                            sb.append(Matcher.quoteReplacement(diffedStrings[1]));</span>
                        }
<span class="nc" id="L1143">                    }</span>
                }
            } else {
<span class="nc bnc" id="L1146" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4343)) {</span>
<span class="nc bnc" id="L1147" title="All 2 branches missed.">                    if (!mUseInputTag) {</span>
<span class="nc bnc" id="L1148" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4342)) {</span>
<span class="nc" id="L1149">                            sb.append(Matcher.quoteReplacement(DiffEngine.wrapMissing(correctAnswer)));</span>
                        }
                    } else {
<span class="nc bnc" id="L1152" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4341)) {</span>
<span class="nc" id="L1153">                            sb.append(Matcher.quoteReplacement(correctAnswer));</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4351)) {</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">            sb.append(mDoNotUseCodeFormatting ? &quot;&lt;/span&gt;&lt;/div&gt;&quot; : &quot;&lt;/code&gt;&lt;/div&gt;&quot;);</span>
        }
<span class="nc" id="L1162">        return m.replaceAll(sb.toString());</span>
    }

    private String contentForCloze(String txt, int idx) {
        // In Android, } should be escaped
        @SuppressWarnings(&quot;RegExpRedundantEscape&quot;)
<span class="nc" id="L1168">        Pattern re = Pattern.compile(&quot;\\{\\{c&quot; + idx + &quot;::(.+?)\\}\\}&quot;);</span>
<span class="nc" id="L1169">        Matcher m = re.matcher(txt);</span>
        // Size can't be known in advance
<span class="nc" id="L1171">        Set&lt;String&gt; matches = new LinkedHashSet&lt;&gt;();</span>
        // they appear in.
        String groupOne;
<span class="nc" id="L1174">        int colonColonIndex = -1;</span>
        {
<span class="nc" id="L1176">            long _loopCounter100 = 0;</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">            while (m.find()) {</span>
<span class="nc" id="L1178">                ListenerUtil.loopListener.listen(&quot;_loopCounter100&quot;, ++_loopCounter100);</span>
<span class="nc" id="L1179">                groupOne = m.group(1);</span>
<span class="nc bnc" id="L1180" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4352)) {</span>
<span class="nc" id="L1181">                    colonColonIndex = groupOne.indexOf(&quot;::&quot;);</span>
                }
<span class="nc bnc" id="L1183" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(4357) ? (colonColonIndex &gt;= -1) : (ListenerUtil.mutListener.listen(4356) ? (colonColonIndex &lt;= -1) : (ListenerUtil.mutListener.listen(4355) ? (colonColonIndex &lt; -1) : (ListenerUtil.mutListener.listen(4354) ? (colonColonIndex != -1) : (ListenerUtil.mutListener.listen(4353) ? (colonColonIndex == -1) : (colonColonIndex &gt; -1))))))) {</span>
                    // Cut out the hint.
<span class="nc" id="L1185">                    groupOne = groupOne.substring(0, colonColonIndex);</span>
                }
<span class="nc bnc" id="L1187" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4358)) {</span>
<span class="nc" id="L1188">                    matches.add(groupOne);</span>
                }
            }
        }
        // Now do what the pythonic &quot;, &quot;.join(matches) does in a tricky way
<span class="nc" id="L1193">        String prefix = &quot;&quot;;</span>
<span class="nc" id="L1194">        StringBuilder resultBuilder = new StringBuilder();</span>
<span class="nc bnc" id="L1195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4362)) {</span>
            {
<span class="nc" id="L1197">                long _loopCounter101 = 0;</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">                for (String match : matches) {</span>
<span class="nc" id="L1199">                    ListenerUtil.loopListener.listen(&quot;_loopCounter101&quot;, ++_loopCounter101);</span>
<span class="nc bnc" id="L1200" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4359)) {</span>
<span class="nc" id="L1201">                        resultBuilder.append(prefix);</span>
                    }
<span class="nc bnc" id="L1203" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4360)) {</span>
<span class="nc" id="L1204">                        resultBuilder.append(match);</span>
                    }
<span class="nc bnc" id="L1206" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4361)) {</span>
<span class="nc" id="L1207">                        prefix = &quot;, &quot;;</span>
                    }
<span class="nc" id="L1209">                }</span>
            }
        }
<span class="nc" id="L1212">        return resultBuilder.toString();</span>
    }

<span class="nc" id="L1215">    private final Handler mTimerHandler = new Handler();</span>

<span class="nc" id="L1217">    private final Runnable removeChosenAnswerText = new Runnable() {</span>

        @Override
        public void run() {
<span class="nc bnc" id="L1221" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4363)) {</span>
<span class="nc" id="L1222">                mChosenAnswer.setText(&quot;&quot;);</span>
            }
<span class="nc" id="L1224">        }</span>
    };

    protected int mPrefWaitAnswerSecond;

    protected int mPrefWaitQuestionSecond;

    protected int getAnswerButtonCount() {
<span class="nc" id="L1232">        return getCol().getSched().answerButtons(mCurrentCard);</span>
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc bnc" id="L1237" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4364)) {</span>
<span class="nc" id="L1238">            Timber.d(&quot;onCreate()&quot;);</span>
        }
<span class="nc" id="L1240">        SharedPreferences preferences = restorePreferences();</span>
<span class="nc bnc" id="L1241" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4365)) {</span>
<span class="nc" id="L1242">            mCardAppearance = CardAppearance.create(new ReviewerCustomFonts(this.getBaseContext()), preferences);</span>
        }
<span class="nc bnc" id="L1244" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4366)) {</span>
<span class="nc" id="L1245">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L1247" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4367)) {</span>
<span class="nc" id="L1248">            setContentView(getContentViewAttr(mPrefFullscreenReview));</span>
        }
<span class="nc bnc" id="L1250" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4368)) {</span>
            // Make ACTION_PROCESS_TEXT for in-app searching possible on &gt; Android 4.0
<span class="nc" id="L1252">            getDelegate().setHandleNativeActionModesEnabled(true);</span>
        }
<span class="nc" id="L1254">        View mainView = findViewById(android.R.id.content);</span>
<span class="nc bnc" id="L1255" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4369)) {</span>
<span class="nc" id="L1256">            initNavigationDrawer(mainView);</span>
        }
<span class="nc bnc" id="L1258" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4370)) {</span>
<span class="nc" id="L1259">            mShortAnimDuration = getResources().getInteger(android.R.integer.config_shortAnimTime);</span>
        }
<span class="nc" id="L1261">    }</span>

    protected int getContentViewAttr(int fullscreenMode) {
<span class="nc" id="L1264">        return R.layout.reviewer;</span>
    }

    protected boolean isFullscreen() {
<span class="nc bnc" id="L1268" title="All 2 branches missed.">        return !getSupportActionBar().isShowing();</span>
    }

    @Override
    public void onConfigurationChanged(Configuration config) {
<span class="nc bnc" id="L1273" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4371)) {</span>
            // called when screen rotated, etc, since recreating the Webview is too expensive
<span class="nc" id="L1275">            super.onConfigurationChanged(config);</span>
        }
<span class="nc bnc" id="L1277" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4372)) {</span>
<span class="nc" id="L1278">            refreshActionBar();</span>
        }
<span class="nc" id="L1280">    }</span>

    protected abstract void setTitle();

    // Finish initializing the activity after the collection has been correctly loaded
    @Override
    protected void onCollectionLoaded(Collection col) {
<span class="nc bnc" id="L1287" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4373)) {</span>
<span class="nc" id="L1288">            super.onCollectionLoaded(col);</span>
        }
<span class="nc bnc" id="L1290" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4374)) {</span>
<span class="nc" id="L1291">            mSched = col.getSched();</span>
        }
<span class="nc" id="L1293">        String mediaDir = col.getMedia().dir();</span>
<span class="nc bnc" id="L1294" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4375)) {</span>
<span class="nc" id="L1295">            mBaseUrl = Utils.getBaseUrl(mediaDir);</span>
        }
<span class="nc bnc" id="L1297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4376)) {</span>
<span class="nc" id="L1298">            mViewerUrl = mBaseUrl + &quot;__viewer__.html&quot;;</span>
        }
<span class="nc bnc" id="L1300" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4380)) {</span>
<span class="nc" id="L1301">            mAssetLoader = new WebViewAssetLoader.Builder().addPathHandler(&quot;/&quot;, new WebViewAssetLoader.PathHandler() {</span>

                @Override
                public WebResourceResponse handle(String path) {
                    try {
<span class="nc" id="L1306">                        File file = new File(mediaDir, path);</span>
<span class="nc" id="L1307">                        FileInputStream is = new FileInputStream(file);</span>
<span class="nc" id="L1308">                        String mimeType = AssetHelper.guessMimeType(path);</span>
<span class="nc" id="L1309">                        HashMap&lt;String, String&gt; headers = new HashMap&lt;String, String&gt;();</span>
<span class="nc bnc" id="L1310" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4378)) {</span>
<span class="nc" id="L1311">                            headers.put(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span>
                        }
<span class="nc" id="L1313">                        WebResourceResponse response = new WebResourceResponse(mimeType, null, is);</span>
<span class="nc bnc" id="L1314" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4379)) {</span>
<span class="nc" id="L1315">                            response.setResponseHeaders(headers);</span>
                        }
<span class="nc" id="L1317">                        return response;</span>
<span class="nc" id="L1318">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L1319" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4377)) {</span>
<span class="nc" id="L1320">                            Timber.e(e, &quot;Error trying to open path in asset loader&quot;);</span>
                        }
                    }
<span class="nc" id="L1323">                    return null;</span>
                }
<span class="nc" id="L1325">            }).build();</span>
        }
<span class="nc bnc" id="L1327" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4381)) {</span>
<span class="nc" id="L1328">            registerExternalStorageListener();</span>
        }
<span class="nc bnc" id="L1330" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4382)) {</span>
<span class="nc" id="L1331">            restoreCollectionPreferences();</span>
        }
<span class="nc bnc" id="L1333" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4383)) {</span>
<span class="nc" id="L1334">            initLayout();</span>
        }
<span class="nc bnc" id="L1336" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4384)) {</span>
<span class="nc" id="L1337">            setTitle();</span>
        }
<span class="nc bnc" id="L1339" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4386)) {</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">            if (!mDisableClipboard) {</span>
<span class="nc bnc" id="L1341" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4385)) {</span>
<span class="nc" id="L1342">                    clearClipboard();</span>
                }
            }
        }
        // Load the template for the card
        try {
<span class="nc" id="L1348">            String data = Utils.convertStreamToString(getAssets().open(&quot;card_template.html&quot;));</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4388)) {</span>
<span class="nc" id="L1350">                mCardTemplate = new CardTemplate(data);</span>
            }
<span class="nc" id="L1352">        } catch (IOException e) {</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4387)) {</span>
<span class="nc" id="L1354">                e.printStackTrace();</span>
            }
<span class="nc" id="L1356">        }</span>
<span class="nc bnc" id="L1357" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4390)) {</span>
            // Initialize text-to-speech. This is an asynchronous operation.
<span class="nc bnc" id="L1359" title="All 2 branches missed.">            if (mSpeakText) {</span>
<span class="nc bnc" id="L1360" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4389)) {</span>
<span class="nc" id="L1361">                    ReadText.initializeTts(this, new ReadTextListener());</span>
                }
            }
        }
<span class="nc bnc" id="L1365" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4391)) {</span>
            // Initialize dictionary lookup feature
<span class="nc" id="L1367">            Lookup.initialize(this);</span>
        }
<span class="nc bnc" id="L1369" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4392)) {</span>
<span class="nc" id="L1370">            updateActionBar();</span>
        }
<span class="nc bnc" id="L1372" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4393)) {</span>
<span class="nc" id="L1373">            supportInvalidateOptionsMenu();</span>
        }
<span class="nc" id="L1375">    }</span>

    // Saves deck each time Reviewer activity loses focus
    @Override
    protected void onPause() {
<span class="nc bnc" id="L1380" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4394)) {</span>
<span class="nc" id="L1381">            super.onPause();</span>
        }
<span class="nc bnc" id="L1383" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4395)) {</span>
<span class="nc" id="L1384">            Timber.d(&quot;onPause()&quot;);</span>
        }
<span class="nc bnc" id="L1386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4396)) {</span>
<span class="nc" id="L1387">            mTimeoutHandler.removeCallbacks(mShowAnswerTask);</span>
        }
<span class="nc bnc" id="L1389" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4397)) {</span>
<span class="nc" id="L1390">            mTimeoutHandler.removeCallbacks(mShowQuestionTask);</span>
        }
<span class="nc bnc" id="L1392" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4398)) {</span>
<span class="nc" id="L1393">            longClickHandler.removeCallbacks(longClickTestRunnable);</span>
        }
<span class="nc bnc" id="L1395" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4399)) {</span>
<span class="nc" id="L1396">            longClickHandler.removeCallbacks(startLongClickAction);</span>
        }
<span class="nc bnc" id="L1398" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4400)) {</span>
<span class="nc" id="L1399">            pauseTimer();</span>
        }
<span class="nc bnc" id="L1401" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4401)) {</span>
<span class="nc" id="L1402">            mSoundPlayer.stopSounds();</span>
        }
<span class="nc bnc" id="L1404" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4402)) {</span>
            // Prevent loss of data in Cookies
<span class="nc" id="L1406">            CookieManager.getInstance().flush();</span>
        }
<span class="nc" id="L1408">    }</span>

    @Override
    protected void onResume() {
<span class="nc bnc" id="L1412" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4403)) {</span>
<span class="nc" id="L1413">            super.onResume();</span>
        }
<span class="nc bnc" id="L1415" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4404)) {</span>
<span class="nc" id="L1416">            resumeTimer();</span>
        }
<span class="nc bnc" id="L1418" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4405)) {</span>
            // Set the context for the Sound manager
<span class="nc" id="L1420">            mSoundPlayer.setContext(new WeakReference&lt;&gt;(this));</span>
        }
<span class="nc bnc" id="L1422" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4406)) {</span>
            // Reset the activity title
<span class="nc" id="L1424">            setTitle();</span>
        }
<span class="nc bnc" id="L1426" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4407)) {</span>
<span class="nc" id="L1427">            updateActionBar();</span>
        }
<span class="nc bnc" id="L1429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4408)) {</span>
<span class="nc" id="L1430">            selectNavigationItem(-1);</span>
        }
<span class="nc" id="L1432">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L1436" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4409)) {</span>
<span class="nc" id="L1437">            super.onDestroy();</span>
        }
<span class="nc bnc" id="L1439" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4411)) {</span>
            // not a valid id.
<span class="nc bnc" id="L1441" title="All 2 branches missed.">            if (mSched != null) {</span>
<span class="nc bnc" id="L1442" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4410)) {</span>
<span class="nc" id="L1443">                    mSched.discardCurrentCard();</span>
                }
            }
        }
<span class="nc bnc" id="L1447" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4412)) {</span>
<span class="nc" id="L1448">            Timber.d(&quot;onDestroy()&quot;);</span>
        }
<span class="nc bnc" id="L1450" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4414)) {</span>
<span class="nc bnc" id="L1451" title="All 2 branches missed.">            if (mSpeakText) {</span>
<span class="nc bnc" id="L1452" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4413)) {</span>
<span class="nc" id="L1453">                    ReadText.releaseTts();</span>
                }
            }
        }
<span class="nc bnc" id="L1457" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4416)) {</span>
<span class="nc bnc" id="L1458" title="All 2 branches missed.">            if (mUnmountReceiver != null) {</span>
<span class="nc bnc" id="L1459" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4415)) {</span>
<span class="nc" id="L1460">                    unregisterReceiver(mUnmountReceiver);</span>
                }
            }
        }
<span class="nc bnc" id="L1464" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4418)) {</span>
            // http://developer.android.com/reference/android/webkit/WebView.html#destroy()
<span class="nc bnc" id="L1466" title="All 2 branches missed.">            if (mCardFrame != null) {</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4417)) {</span>
<span class="nc" id="L1468">                    mCardFrame.removeAllViews();</span>
                }
            }
        }
<span class="nc bnc" id="L1472" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4419)) {</span>
            // OK to do without a lock
<span class="nc" id="L1474">            destroyWebView(mCardWebView);</span>
        }
<span class="nc" id="L1476">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L1480" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4423)) {</span>
<span class="nc bnc" id="L1481" title="All 2 branches missed.">            if (isDrawerOpen()) {</span>
<span class="nc bnc" id="L1482" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4422)) {</span>
<span class="nc" id="L1483">                    super.onBackPressed();</span>
                }
            } else {
<span class="nc bnc" id="L1486" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4420)) {</span>
<span class="nc" id="L1487">                    Timber.i(&quot;Back key pressed&quot;);</span>
                }
<span class="nc bnc" id="L1489" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4421)) {</span>
<span class="nc" id="L1490">                    closeReviewer(RESULT_DEFAULT, false);</span>
                }
            }
        }
<span class="nc" id="L1494">    }</span>

    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L1498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4424)) {</span>
<span class="nc bnc" id="L1499" title="All 2 branches missed.">            if (processCardFunction(cardWebView -&gt; processHardwareButtonScroll(keyCode, cardWebView))) {</span>
<span class="nc" id="L1500">                return true;</span>
            }
        }
<span class="nc" id="L1503">        return super.onKeyDown(keyCode, event);</span>
    }

    @Override
    @Nullable
    protected Long getCurrentCardId() {
<span class="nc bnc" id="L1509" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4425)) {</span>
<span class="nc bnc" id="L1510" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc" id="L1511">                return null;</span>
            }
        }
<span class="nc" id="L1514">        return mCurrentCard.getId();</span>
    }

    private boolean processHardwareButtonScroll(int keyCode, WebView card) {
<span class="nc bnc" id="L1518" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4429)) {</span>
<span class="nc bnc" id="L1519" title="All 2 branches missed.">            if (keyCode == KeyEvent.KEYCODE_PAGE_UP) {</span>
<span class="nc bnc" id="L1520" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4426)) {</span>
<span class="nc" id="L1521">                    card.pageUp(false);</span>
                }
<span class="nc bnc" id="L1523" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4428)) {</span>
<span class="nc bnc" id="L1524" title="All 2 branches missed.">                    if (mDoubleScrolling) {</span>
<span class="nc bnc" id="L1525" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4427)) {</span>
<span class="nc" id="L1526">                            card.pageUp(false);</span>
                        }
                    }
                }
<span class="nc" id="L1530">                return true;</span>
            }
        }
<span class="nc bnc" id="L1533" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4433)) {</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">            if (keyCode == KeyEvent.KEYCODE_PAGE_DOWN) {</span>
<span class="nc bnc" id="L1535" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4430)) {</span>
<span class="nc" id="L1536">                    card.pageDown(false);</span>
                }
<span class="nc bnc" id="L1538" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4432)) {</span>
<span class="nc bnc" id="L1539" title="All 2 branches missed.">                    if (mDoubleScrolling) {</span>
<span class="nc bnc" id="L1540" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4431)) {</span>
<span class="nc" id="L1541">                            card.pageDown(false);</span>
                        }
                    }
                }
<span class="nc" id="L1545">                return true;</span>
            }
        }
<span class="nc bnc" id="L1548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4438)) {</span>
<span class="nc bnc" id="L1549" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4434) ? (mScrollingButtons || keyCode == KeyEvent.KEYCODE_PICTSYMBOLS) : (mScrollingButtons &amp;&amp; keyCode == KeyEvent.KEYCODE_PICTSYMBOLS))) {</span>
<span class="nc bnc" id="L1550" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4435)) {</span>
<span class="nc" id="L1551">                    card.pageUp(false);</span>
                }
<span class="nc bnc" id="L1553" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4437)) {</span>
<span class="nc bnc" id="L1554" title="All 2 branches missed.">                    if (mDoubleScrolling) {</span>
<span class="nc bnc" id="L1555" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4436)) {</span>
<span class="nc" id="L1556">                            card.pageUp(false);</span>
                        }
                    }
                }
<span class="nc" id="L1560">                return true;</span>
            }
        }
<span class="nc bnc" id="L1563" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4443)) {</span>
<span class="nc bnc" id="L1564" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4439) ? (mScrollingButtons || keyCode == KeyEvent.KEYCODE_SWITCH_CHARSET) : (mScrollingButtons &amp;&amp; keyCode == KeyEvent.KEYCODE_SWITCH_CHARSET))) {</span>
<span class="nc bnc" id="L1565" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4440)) {</span>
<span class="nc" id="L1566">                    card.pageDown(false);</span>
                }
<span class="nc bnc" id="L1568" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4442)) {</span>
<span class="nc bnc" id="L1569" title="All 2 branches missed.">                    if (mDoubleScrolling) {</span>
<span class="nc bnc" id="L1570" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4441)) {</span>
<span class="nc" id="L1571">                            card.pageDown(false);</span>
                        }
                    }
                }
<span class="nc" id="L1575">                return true;</span>
            }
        }
<span class="nc" id="L1578">        return false;</span>
    }

    @Override
    public boolean onKeyUp(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L1583" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4444)) {</span>
<span class="nc bnc" id="L1584" title="All 2 branches missed.">            if (answerFieldIsFocused()) {</span>
<span class="nc" id="L1585">                return super.onKeyUp(keyCode, event);</span>
            }
        }
<span class="nc bnc" id="L1588" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4449)) {</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">            if (!sDisplayAnswer) {</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4448)) {</span>
<span class="nc bnc" id="L1591" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(4446) ? ((ListenerUtil.mutListener.listen(4445) ? (keyCode == KeyEvent.KEYCODE_SPACE &amp;&amp; keyCode == KeyEvent.KEYCODE_ENTER) : (keyCode == KeyEvent.KEYCODE_SPACE || keyCode == KeyEvent.KEYCODE_ENTER)) &amp;&amp; keyCode == KeyEvent.KEYCODE_NUMPAD_ENTER) : ((ListenerUtil.mutListener.listen(4445) ? (keyCode == KeyEvent.KEYCODE_SPACE &amp;&amp; keyCode == KeyEvent.KEYCODE_ENTER) : (keyCode == KeyEvent.KEYCODE_SPACE || keyCode == KeyEvent.KEYCODE_ENTER)) || keyCode == KeyEvent.KEYCODE_NUMPAD_ENTER))) {</span>
<span class="nc bnc" id="L1592" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4447)) {</span>
<span class="nc" id="L1593">                            displayCardAnswer();</span>
                        }
<span class="nc" id="L1595">                        return true;</span>
                    }
                }
            }
        }
<span class="nc" id="L1600">        return super.onKeyUp(keyCode, event);</span>
    }

    protected boolean answerFieldIsFocused() {
<span class="nc bnc" id="L1604" title="All 10 branches missed.">        return (ListenerUtil.mutListener.listen(4450) ? (mAnswerField != null || mAnswerField.isFocused()) : (mAnswerField != null &amp;&amp; mAnswerField.isFocused()));</span>
    }

    protected boolean clipboardHasText() {
<span class="nc bnc" id="L1608" title="All 2 branches missed.">        return !TextUtils.isEmpty(ClipboardUtil.getText(mClipboard));</span>
    }

    /**
     * We use the clipboard here for the lookup dictionary functionality
     * If the clipboard has data and we're using the functionality, then
     */
    private void clearClipboard() {
<span class="nc bnc" id="L1616" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4451)) {</span>
<span class="nc bnc" id="L1617" title="All 2 branches missed.">            if (mClipboard == null) {</span>
<span class="nc" id="L1618">                return;</span>
            }
        }
        try {
<span class="nc bnc" id="L1622" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4463)) {</span>
<span class="nc bnc" id="L1623" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(4458) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.P) : (ListenerUtil.mutListener.listen(4457) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.P) : (ListenerUtil.mutListener.listen(4456) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.P) : (ListenerUtil.mutListener.listen(4455) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.P) : (ListenerUtil.mutListener.listen(4454) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.P) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P))))))) {</span>
<span class="nc bnc" id="L1624" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4462)) {</span>
<span class="nc" id="L1625">                        mClipboard.clearPrimaryClip();</span>
                    }
                } else {
<span class="nc bnc" id="L1628" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4459)) {</span>
<span class="nc bnc" id="L1629" title="All 2 branches missed.">                        if (!mClipboard.hasPrimaryClip()) {</span>
<span class="nc" id="L1630">                            return;</span>
                        }
                    }
<span class="nc" id="L1633">                    CharSequence descriptionLabel = ClipboardUtil.getDescriptionLabel(mClipboard.getPrimaryClip());</span>
<span class="nc bnc" id="L1634" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4461)) {</span>
<span class="nc bnc" id="L1635" title="All 2 branches missed.">                        if (!&quot;Cleared&quot;.contentEquals(descriptionLabel)) {</span>
<span class="nc bnc" id="L1636" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4460)) {</span>
<span class="nc" id="L1637">                                mClipboard.setPrimaryClip(ClipData.newPlainText(&quot;Cleared&quot;, &quot;&quot;));</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L1643">        } catch (Exception e) {</span>
<span class="nc bnc" id="L1644" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4452)) {</span>
                // must disable it or AnkiDroid will crash if it tries to use it.
<span class="nc" id="L1646">                Timber.e(&quot;Clipboard error. Disabling text selection setting.&quot;);</span>
            }
<span class="nc bnc" id="L1648" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4453)) {</span>
<span class="nc" id="L1649">                mDisableClipboard = true;</span>
            }
<span class="nc" id="L1651">        }</span>
<span class="nc" id="L1652">    }</span>

    /**
     * Returns the text stored in the clipboard or the empty string if the clipboard is empty or contains something that
     * cannot be convered to text.
     *
     * @return the text in clipboard or the empty string.
     */
    private CharSequence clipboardGetText() {
<span class="nc" id="L1661">        CharSequence text = ClipboardUtil.getText(mClipboard);</span>
<span class="nc bnc" id="L1662" title="All 2 branches missed.">        return text != null ? text : &quot;&quot;;</span>
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc bnc" id="L1667" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4464)) {</span>
<span class="nc" id="L1668">            super.onActivityResult(requestCode, resultCode, data);</span>
        }
<span class="nc bnc" id="L1670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4471)) {</span>
<span class="nc bnc" id="L1671" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(4469) ? (resultCode &gt;= DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(4468) ? (resultCode &lt;= DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(4467) ? (resultCode &gt; DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(4466) ? (resultCode &lt; DeckPicker.RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(4465) ? (resultCode != DeckPicker.RESULT_DB_ERROR) : (resultCode == DeckPicker.RESULT_DB_ERROR))))))) {</span>
<span class="nc bnc" id="L1672" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4470)) {</span>
<span class="nc" id="L1673">                    closeReviewer(DeckPicker.RESULT_DB_ERROR, false);</span>
                }
            }
        }
<span class="nc bnc" id="L1677" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4478)) {</span>
<span class="nc bnc" id="L1678" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(4476) ? (resultCode &gt;= DeckPicker.RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(4475) ? (resultCode &lt;= DeckPicker.RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(4474) ? (resultCode &gt; DeckPicker.RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(4473) ? (resultCode &lt; DeckPicker.RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(4472) ? (resultCode != DeckPicker.RESULT_MEDIA_EJECTED) : (resultCode == DeckPicker.RESULT_MEDIA_EJECTED))))))) {</span>
<span class="nc bnc" id="L1679" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4477)) {</span>
<span class="nc" id="L1680">                    finishNoStorageAvailable();</span>
                }
            }
        }
<span class="nc bnc" id="L1684" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4481)) {</span>
            /* Reset the schedule and reload the latest card off the top of the stack if required.
           The card could have been rescheduled, the deck could have changed, or a change of
           note type could have lead to the card being deleted */
<span class="nc bnc" id="L1688" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4479) ? (data != null || data.hasExtra(&quot;reloadRequired&quot;)) : (data != null &amp;&amp; data.hasExtra(&quot;reloadRequired&quot;)))) {</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4480)) {</span>
<span class="nc" id="L1690">                    performReload();</span>
                }
            }
        }
<span class="nc bnc" id="L1694" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4501)) {</span>
<span class="nc bnc" id="L1695" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(4486) ? (requestCode &gt;= EDIT_CURRENT_CARD) : (ListenerUtil.mutListener.listen(4485) ? (requestCode &lt;= EDIT_CURRENT_CARD) : (ListenerUtil.mutListener.listen(4484) ? (requestCode &gt; EDIT_CURRENT_CARD) : (ListenerUtil.mutListener.listen(4483) ? (requestCode &lt; EDIT_CURRENT_CARD) : (ListenerUtil.mutListener.listen(4482) ? (requestCode != EDIT_CURRENT_CARD) : (requestCode == EDIT_CURRENT_CARD))))))) {</span>
<span class="nc bnc" id="L1696" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4500)) {</span>
<span class="nc bnc" id="L1697" title="All 2 branches missed.">                    if (resultCode == RESULT_OK) {</span>
<span class="nc bnc" id="L1698" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4497)) {</span>
                            // content of note was changed so update the note and current card
<span class="nc" id="L1700">                            Timber.i(&quot;AbstractFlashcardViewer:: Saving card...&quot;);</span>
                        }
<span class="nc bnc" id="L1702" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4498)) {</span>
<span class="nc" id="L1703">                            TaskManager.launchCollectionTask(new CollectionTask.UpdateNote(sEditorCard, true, canAccessScheduler()), mUpdateCardHandler);</span>
                        }
<span class="nc bnc" id="L1705" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4499)) {</span>
<span class="nc" id="L1706">                            onEditedNoteChanged();</span>
                        }
<span class="nc bnc" id="L1708" title="All 26 branches missed.">                    } else if ((ListenerUtil.mutListener.listen(4495) ? (resultCode == RESULT_CANCELED || !((ListenerUtil.mutListener.listen(4494) ? (data != null || data.hasExtra(&quot;reloadRequired&quot;)) : (data != null &amp;&amp; data.hasExtra(&quot;reloadRequired&quot;))))) : (resultCode == RESULT_CANCELED &amp;&amp; !((ListenerUtil.mutListener.listen(4494) ? (data != null || data.hasExtra(&quot;reloadRequired&quot;)) : (data != null &amp;&amp; data.hasExtra(&quot;reloadRequired&quot;))))))) {</span>
<span class="nc bnc" id="L1709" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4496)) {</span>
                            // nothing was changed by the note editor so just redraw the card
<span class="nc" id="L1711">                            redrawCard();</span>
                        }
                    }
                }
<span class="nc bnc" id="L1715" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(4492) ? ((ListenerUtil.mutListener.listen(4491) ? (requestCode &gt;= DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4490) ? (requestCode &lt;= DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4489) ? (requestCode &gt; DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4488) ? (requestCode &lt; DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4487) ? (requestCode != DECK_OPTIONS) : (requestCode == DECK_OPTIONS)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(4491) ? (requestCode &gt;= DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4490) ? (requestCode &lt;= DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4489) ? (requestCode &gt; DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4488) ? (requestCode &lt; DECK_OPTIONS) : (ListenerUtil.mutListener.listen(4487) ? (requestCode != DECK_OPTIONS) : (requestCode == DECK_OPTIONS)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc bnc" id="L1716" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4493)) {</span>
<span class="nc" id="L1717">                    performReload();</span>
                }
            }
        }
<span class="nc bnc" id="L1721" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4503)) {</span>
<span class="nc bnc" id="L1722" title="All 2 branches missed.">            if (!mDisableClipboard) {</span>
<span class="nc bnc" id="L1723" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4502)) {</span>
<span class="nc" id="L1724">                    clearClipboard();</span>
                }
            }
        }
<span class="nc" id="L1728">    }</span>

    /**
     * Whether the class should use collection.getSched() when performing tasks.
     * The aim of this method is to completely distinguish FlashcardViewer from Reviewer
     *
     * This is partially implemented, the end goal is that the FlashcardViewer will not have any coupling to getSched
     *
     * Currently, this is used for note edits - in a reviewing context, this should show the next card.
     * In a previewing context, the card should not change.
     */
    protected boolean canAccessScheduler() {
<span class="nc" id="L1740">        return false;</span>
    }

    protected void onEditedNoteChanged() {
<span class="nc" id="L1744">    }</span>

    /**
     * An action which may invalidate the current list of cards has been performed
     */
    protected abstract void performReload();

    // Get the did of the parent deck (ignoring any subdecks)
    protected long getParentDid() {
<span class="nc" id="L1753">        return getCol().getDecks().selected();</span>
    }

    private void redrawCard() {
<span class="nc bnc" id="L1757" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4506)) {</span>
            // if the activity was destroyed. In this case, just wait until onCollectionLoaded callback succeeds.
<span class="nc bnc" id="L1759" title="All 2 branches missed.">            if (hasLoadedCardContent()) {</span>
<span class="nc bnc" id="L1760" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4505)) {</span>
<span class="nc" id="L1761">                    fillFlashcard();</span>
                }
            } else {
<span class="nc bnc" id="L1764" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4504)) {</span>
<span class="nc" id="L1765">                    Timber.i(&quot;Skipping card redraw - card still initialising.&quot;);</span>
                }
            }
        }
<span class="nc" id="L1769">    }</span>

    /**
     * Whether the callback to onCollectionLoaded has loaded card content
     */
    private boolean hasLoadedCardContent() {
<span class="nc bnc" id="L1775" title="All 2 branches missed.">        return mCardContent != null;</span>
    }

    public GestureDetector getGestureDetector() {
<span class="nc" id="L1779">        return gestureDetector;</span>
    }

    /**
     * Show/dismiss dialog when sd card is ejected/remounted (collection is saved by SdCardReceiver)
     */
    private void registerExternalStorageListener() {
<span class="nc bnc" id="L1786" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4512)) {</span>
<span class="nc bnc" id="L1787" title="All 2 branches missed.">            if (mUnmountReceiver == null) {</span>
<span class="nc bnc" id="L1788" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4509)) {</span>
<span class="nc" id="L1789">                    mUnmountReceiver = new BroadcastReceiver() {</span>

                        @Override
                        public void onReceive(Context context, Intent intent) {
<span class="nc bnc" id="L1793" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4508)) {</span>
<span class="nc bnc" id="L1794" title="All 2 branches missed.">                                if (intent.getAction().equals(SdCardReceiver.MEDIA_EJECT)) {</span>
<span class="nc bnc" id="L1795" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(4507)) {</span>
<span class="nc" id="L1796">                                        finishWithoutAnimation();</span>
                                    }
                                }
                            }
<span class="nc" id="L1800">                        }</span>
                    };
                }
<span class="nc" id="L1803">                IntentFilter iFilter = new IntentFilter();</span>
<span class="nc bnc" id="L1804" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4510)) {</span>
<span class="nc" id="L1805">                    iFilter.addAction(SdCardReceiver.MEDIA_EJECT);</span>
                }
<span class="nc bnc" id="L1807" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4511)) {</span>
<span class="nc" id="L1808">                    registerReceiver(mUnmountReceiver, iFilter);</span>
                }
            }
        }
<span class="nc" id="L1812">    }</span>

    private void pauseTimer() {
<span class="nc bnc" id="L1815" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4514)) {</span>
<span class="nc bnc" id="L1816" title="All 2 branches missed.">            if (mCurrentCard != null) {</span>
<span class="nc bnc" id="L1817" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4513)) {</span>
<span class="nc" id="L1818">                    mCurrentCard.stopTimer();</span>
                }
            }
        }
<span class="nc bnc" id="L1822" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4516)) {</span>
            // it run would trigger the time limit condition (red, stopped timer) in the background.
<span class="nc bnc" id="L1824" title="All 2 branches missed.">            if (mCardTimer != null) {</span>
<span class="nc bnc" id="L1825" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4515)) {</span>
<span class="nc" id="L1826">                    mCardTimer.stop();</span>
                }
            }
        }
<span class="nc" id="L1830">    }</span>

    private void resumeTimer() {
<span class="nc bnc" id="L1833" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4534)) {</span>
<span class="nc bnc" id="L1834" title="All 2 branches missed.">            if (mCurrentCard != null) {</span>
<span class="nc bnc" id="L1835" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4517)) {</span>
                    // suspend and resume.
<span class="nc" id="L1837">                    mCurrentCard.resumeTimer();</span>
                }
<span class="nc bnc" id="L1839" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4522)) {</span>
                    // timeTaken() seconds ago.
<span class="nc bnc" id="L1841" title="All 8 branches missed.">                    mCardTimer.setBase((ListenerUtil.mutListener.listen(4521) ? (SystemClock.elapsedRealtime() % mCurrentCard.timeTaken()) : (ListenerUtil.mutListener.listen(4520) ? (SystemClock.elapsedRealtime() / mCurrentCard.timeTaken()) : (ListenerUtil.mutListener.listen(4519) ? (SystemClock.elapsedRealtime() * mCurrentCard.timeTaken()) : (ListenerUtil.mutListener.listen(4518) ? (SystemClock.elapsedRealtime() + mCurrentCard.timeTaken()) : (SystemClock.elapsedRealtime() - mCurrentCard.timeTaken()))))));</span>
                }
<span class="nc bnc" id="L1843" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4533)) {</span>
                    // Don't start the timer if we have already reached the time limit or it will tick over
<span class="nc bnc" id="L1845" title="All 70 branches missed.">                    if ((ListenerUtil.mutListener.listen(4531) ? (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) &gt;= mCurrentCard.timeLimit()) : (ListenerUtil.mutListener.listen(4530) ? (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) &lt;= mCurrentCard.timeLimit()) : (ListenerUtil.mutListener.listen(4529) ? (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) &gt; mCurrentCard.timeLimit()) : (ListenerUtil.mutListener.listen(4528) ? (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) != mCurrentCard.timeLimit()) : (ListenerUtil.mutListener.listen(4527) ? (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) == mCurrentCard.timeLimit()) : (((ListenerUtil.mutListener.listen(4526) ? (SystemClock.elapsedRealtime() % mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4525) ? (SystemClock.elapsedRealtime() / mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4524) ? (SystemClock.elapsedRealtime() * mCardTimer.getBase()) : (ListenerUtil.mutListener.listen(4523) ? (SystemClock.elapsedRealtime() + mCardTimer.getBase()) : (SystemClock.elapsedRealtime() - mCardTimer.getBase())))))) &lt; mCurrentCard.timeLimit()))))))) {</span>
<span class="nc bnc" id="L1846" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4532)) {</span>
<span class="nc" id="L1847">                            mCardTimer.start();</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1853">    }</span>

    protected void undo() {
<span class="nc bnc" id="L1856" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4536)) {</span>
<span class="nc bnc" id="L1857" title="All 2 branches missed.">            if (isUndoAvailable()) {</span>
<span class="nc bnc" id="L1858" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4535)) {</span>
<span class="nc" id="L1859">                    TaskManager.launchCollectionTask(new CollectionTask.Undo(), mAnswerCardHandler(false));</span>
                }
            }
        }
<span class="nc" id="L1863">    }</span>

    private void finishNoStorageAvailable() {
<span class="nc bnc" id="L1866" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4537)) {</span>
<span class="nc" id="L1867">            AbstractFlashcardViewer.this.setResult(DeckPicker.RESULT_MEDIA_EJECTED);</span>
        }
<span class="nc bnc" id="L1869" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4538)) {</span>
<span class="nc" id="L1870">            finishWithoutAnimation();</span>
        }
<span class="nc" id="L1872">    }</span>

    protected void editCard() {
<span class="nc bnc" id="L1875" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4539)) {</span>
<span class="nc bnc" id="L1876" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
                // This should never occurs. It means the review button was pressed while there is no more card in the reviewer.
<span class="nc" id="L1878">                return;</span>
            }
        }
<span class="nc" id="L1881">        Intent editCard = new Intent(AbstractFlashcardViewer.this, NoteEditor.class);</span>
<span class="nc bnc" id="L1882" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4540)) {</span>
<span class="nc" id="L1883">            editCard.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_REVIEWER);</span>
        }
<span class="nc bnc" id="L1885" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4541)) {</span>
<span class="nc" id="L1886">            sEditorCard = mCurrentCard;</span>
        }
<span class="nc bnc" id="L1888" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4542)) {</span>
<span class="nc" id="L1889">            startActivityForResultWithAnimation(editCard, EDIT_CURRENT_CARD, LEFT);</span>
        }
<span class="nc" id="L1891">    }</span>

    protected void generateQuestionSoundList() {
<span class="nc bnc" id="L1894" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4543)) {</span>
<span class="nc" id="L1895">            mSoundPlayer.addSounds(mBaseUrl, mCurrentCard.qSimple(), SoundSide.QUESTION);</span>
        }
<span class="nc" id="L1897">    }</span>

    protected void lookUpOrSelectText() {
<span class="nc bnc" id="L1900" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4547)) {</span>
<span class="nc bnc" id="L1901" title="All 2 branches missed.">            if (clipboardHasText()) {</span>
<span class="nc bnc" id="L1902" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4545)) {</span>
<span class="nc" id="L1903">                    Timber.d(&quot;Clipboard has text = %b&quot;, clipboardHasText());</span>
                }
<span class="nc bnc" id="L1905" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4546)) {</span>
<span class="nc" id="L1906">                    lookUp();</span>
                }
            } else {
<span class="nc bnc" id="L1909" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4544)) {</span>
<span class="nc" id="L1910">                    selectAndCopyText();</span>
                }
            }
        }
<span class="nc" id="L1914">    }</span>

    private void lookUp() {
<span class="nc bnc" id="L1917" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4548)) {</span>
<span class="nc" id="L1918">            mLookUpIcon.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L1920" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4549)) {</span>
<span class="nc" id="L1921">            mIsSelecting = false;</span>
        }
<span class="nc bnc" id="L1923" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4551)) {</span>
<span class="nc bnc" id="L1924" title="All 2 branches missed.">            if (Lookup.lookUp(clipboardGetText().toString())) {</span>
<span class="nc bnc" id="L1925" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4550)) {</span>
<span class="nc" id="L1926">                    clearClipboard();</span>
                }
            }
        }
<span class="nc" id="L1930">    }</span>

    private void showLookupButtonIfNeeded() {
<span class="nc bnc" id="L1933" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4560)) {</span>
<span class="nc bnc" id="L1934" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4552) ? (!mDisableClipboard || mClipboard != null) : (!mDisableClipboard &amp;&amp; mClipboard != null))) {</span>
<span class="nc bnc" id="L1935" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4559)) {</span>
<span class="nc bnc" id="L1936" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(4554) ? ((ListenerUtil.mutListener.listen(4553) ? (clipboardGetText().length() != 0 || Lookup.isAvailable()) : (clipboardGetText().length() != 0 &amp;&amp; Lookup.isAvailable())) || mLookUpIcon.getVisibility() != View.VISIBLE) : ((ListenerUtil.mutListener.listen(4553) ? (clipboardGetText().length() != 0 || Lookup.isAvailable()) : (clipboardGetText().length() != 0 &amp;&amp; Lookup.isAvailable())) &amp;&amp; mLookUpIcon.getVisibility() != View.VISIBLE))) {</span>
<span class="nc bnc" id="L1937" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4557)) {</span>
<span class="nc" id="L1938">                            mLookUpIcon.setVisibility(View.VISIBLE);</span>
                        }
<span class="nc bnc" id="L1940" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4558)) {</span>
<span class="nc" id="L1941">                            enableViewAnimation(mLookUpIcon, ViewAnimation.fade(ViewAnimation.FADE_IN, mFadeDuration, 0));</span>
                        }
<span class="nc bnc" id="L1943" title="All 2 branches missed.">                    } else if (mLookUpIcon.getVisibility() == View.VISIBLE) {</span>
<span class="nc bnc" id="L1944" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4555)) {</span>
<span class="nc" id="L1945">                            mLookUpIcon.setVisibility(View.GONE);</span>
                        }
<span class="nc bnc" id="L1947" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4556)) {</span>
<span class="nc" id="L1948">                            enableViewAnimation(mLookUpIcon, ViewAnimation.fade(ViewAnimation.FADE_OUT, mFadeDuration, 0));</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1954">    }</span>

    private void hideLookupButton() {
<span class="nc bnc" id="L1957" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4565)) {</span>
<span class="nc bnc" id="L1958" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4561) ? (!mDisableClipboard || mLookUpIcon.getVisibility() != View.GONE) : (!mDisableClipboard &amp;&amp; mLookUpIcon.getVisibility() != View.GONE))) {</span>
<span class="nc bnc" id="L1959" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4562)) {</span>
<span class="nc" id="L1960">                    mLookUpIcon.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L1962" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4563)) {</span>
<span class="nc" id="L1963">                    enableViewAnimation(mLookUpIcon, ViewAnimation.fade(ViewAnimation.FADE_OUT, mFadeDuration, 0));</span>
                }
<span class="nc bnc" id="L1965" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4564)) {</span>
<span class="nc" id="L1966">                    clearClipboard();</span>
                }
            }
        }
<span class="nc" id="L1970">    }</span>

    protected void showDeleteNoteDialog() {
<span class="nc" id="L1973">        Resources res = getResources();</span>
<span class="nc bnc" id="L1974" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4566)) {</span>
<span class="nc" id="L1975">            new MaterialDialog.Builder(this).title(res.getString(R.string.delete_card_title)).iconAttr(R.attr.dialogErrorIcon).content(res.getString(R.string.delete_note_message, Utils.stripHTML(mCurrentCard.q(true)))).positiveText(R.string.dialog_positive_delete).negativeText(R.string.dialog_cancel).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L1976">                Timber.i(&quot;AbstractFlashcardViewer:: OK button pressed to delete note %d&quot;, mCurrentCard.getNid());</span>
<span class="nc" id="L1977">                mSoundPlayer.stopSounds();</span>
<span class="nc" id="L1978">                dismiss(Collection.DismissType.DELETE_NOTE);</span>
<span class="nc" id="L1979">            }).build().show();</span>
        }
<span class="nc" id="L1981">    }</span>

    private int getRecommendedEase(boolean easy) {
        try {
<span class="nc bnc" id="L1985" title="All 4 branches missed.">            switch(getAnswerButtonCount()) {</span>
                case 2:
<span class="nc" id="L1987">                    return EASE_2;</span>
                case 3:
<span class="nc bnc" id="L1989" title="All 2 branches missed.">                    return easy ? EASE_3 : EASE_2;</span>
                case 4:
<span class="nc bnc" id="L1991" title="All 2 branches missed.">                    return easy ? EASE_4 : EASE_3;</span>
                default:
<span class="nc" id="L1993">                    return 0;</span>
            }
<span class="nc" id="L1995">        } catch (RuntimeException e) {</span>
<span class="nc bnc" id="L1996" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4567)) {</span>
<span class="nc" id="L1997">                AnkiDroidApp.sendExceptionReport(e, &quot;AbstractReviewer-getRecommendedEase&quot;);</span>
            }
<span class="nc bnc" id="L1999" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4568)) {</span>
<span class="nc" id="L2000">                closeReviewer(DeckPicker.RESULT_DB_ERROR, true);</span>
            }
<span class="nc" id="L2002">            return 0;</span>
        }
    }

    protected void answerCard(@Consts.BUTTON_TYPE int ease) {
<span class="nc bnc" id="L2007" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4569)) {</span>
<span class="nc bnc" id="L2008" title="All 2 branches missed.">            if (mInAnswer) {</span>
<span class="nc" id="L2009">                return;</span>
            }
        }
<span class="nc bnc" id="L2012" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4570)) {</span>
<span class="nc" id="L2013">            mIsSelecting = false;</span>
        }
<span class="nc bnc" id="L2015" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4571)) {</span>
<span class="nc" id="L2016">            hideLookupButton();</span>
        }
<span class="nc" id="L2018">        int buttonNumber = getCol().getSched().answerButtons(mCurrentCard);</span>
<span class="nc bnc" id="L2019" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4577)) {</span>
            // Detect invalid ease for current card (e.g. by using keyboard shortcut or gesture).
<span class="nc bnc" id="L2021" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(4576) ? (buttonNumber &gt;= ease) : (ListenerUtil.mutListener.listen(4575) ? (buttonNumber &lt;= ease) : (ListenerUtil.mutListener.listen(4574) ? (buttonNumber &gt; ease) : (ListenerUtil.mutListener.listen(4573) ? (buttonNumber != ease) : (ListenerUtil.mutListener.listen(4572) ? (buttonNumber == ease) : (buttonNumber &lt; ease))))))) {</span>
<span class="nc" id="L2022">                return;</span>
            }
        }
<span class="nc bnc" id="L2025" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4597)) {</span>
            // Set the dots appearing below the toolbar
<span class="nc bnc" id="L2027" title="All 5 branches missed.">            switch(ease) {</span>
                case EASE_1:
<span class="nc bnc" id="L2029" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4578)) {</span>
<span class="nc" id="L2030">                        mChosenAnswer.setText(&quot;\u2022&quot;);</span>
                    }
<span class="nc bnc" id="L2032" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4579)) {</span>
<span class="nc" id="L2033">                        mChosenAnswer.setTextColor(ContextCompat.getColor(this, R.color.material_red_500));</span>
                    }
                    break;
                case EASE_2:
<span class="nc bnc" id="L2037" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4580)) {</span>
<span class="nc" id="L2038">                        mChosenAnswer.setText(&quot;\u2022\u2022&quot;);</span>
                    }
<span class="nc bnc" id="L2040" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4586)) {</span>
<span class="nc bnc" id="L2041" title="All 22 branches missed.">                        mChosenAnswer.setTextColor(ContextCompat.getColor(this, (ListenerUtil.mutListener.listen(4585) ? (buttonNumber &gt;= Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4584) ? (buttonNumber &lt;= Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4583) ? (buttonNumber &gt; Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4582) ? (buttonNumber &lt; Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4581) ? (buttonNumber != Consts.BUTTON_FOUR) : (buttonNumber == Consts.BUTTON_FOUR)))))) ? R.color.material_blue_grey_600 : R.color.material_green_500));</span>
                    }
                    break;
                case EASE_3:
<span class="nc bnc" id="L2045" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4587)) {</span>
<span class="nc" id="L2046">                        mChosenAnswer.setText(&quot;\u2022\u2022\u2022&quot;);</span>
                    }
<span class="nc bnc" id="L2048" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4593)) {</span>
<span class="nc bnc" id="L2049" title="All 22 branches missed.">                        mChosenAnswer.setTextColor(ContextCompat.getColor(this, (ListenerUtil.mutListener.listen(4592) ? (buttonNumber &gt;= Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4591) ? (buttonNumber &lt;= Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4590) ? (buttonNumber &gt; Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4589) ? (buttonNumber &lt; Consts.BUTTON_FOUR) : (ListenerUtil.mutListener.listen(4588) ? (buttonNumber != Consts.BUTTON_FOUR) : (buttonNumber == Consts.BUTTON_FOUR)))))) ? R.color.material_green_500 : R.color.material_light_blue_500));</span>
                    }
                    break;
                case EASE_4:
<span class="nc bnc" id="L2053" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4594)) {</span>
<span class="nc" id="L2054">                        mChosenAnswer.setText(&quot;\u2022\u2022\u2022\u2022&quot;);</span>
                    }
<span class="nc bnc" id="L2056" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4595)) {</span>
<span class="nc" id="L2057">                        mChosenAnswer.setTextColor(ContextCompat.getColor(this, R.color.material_light_blue_500));</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L2061" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4596)) {</span>
<span class="nc" id="L2062">                        Timber.w(&quot;Unknown easy type %s&quot;, ease);</span>
                    }
                    break;
            }
        }
<span class="nc bnc" id="L2067" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4598)) {</span>
            // remove chosen answer hint after a while
<span class="nc" id="L2069">            mTimerHandler.removeCallbacks(removeChosenAnswerText);</span>
        }
<span class="nc bnc" id="L2071" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4599)) {</span>
<span class="nc" id="L2072">            mTimerHandler.postDelayed(removeChosenAnswerText, sShowChosenAnswerLength);</span>
        }
<span class="nc bnc" id="L2074" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4600)) {</span>
<span class="nc" id="L2075">            mSoundPlayer.stopSounds();</span>
        }
<span class="nc bnc" id="L2077" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4601)) {</span>
<span class="nc" id="L2078">            mCurrentEase = ease;</span>
        }
<span class="nc bnc" id="L2080" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4602)) {</span>
<span class="nc" id="L2081">            TaskManager.launchCollectionTask(new CollectionTask.AnswerAndGetCard(mCurrentCard, mCurrentEase), mAnswerCardHandler(true));</span>
        }
<span class="nc" id="L2083">    }</span>

    @Override
    public boolean dispatchKeyEvent(KeyEvent event) {
<span class="nc bnc" id="L2087" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4613)) {</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">            if (event.getAction() == KeyEvent.ACTION_DOWN) {</span>
                // assign correct gesture code
<span class="nc" id="L2090">                int gesture = COMMAND_NOTHING;</span>
<span class="nc bnc" id="L2091" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4605)) {</span>
<span class="nc bnc" id="L2092" title="All 3 branches missed.">                    switch(event.getKeyCode()) {</span>
                        case KeyEvent.KEYCODE_VOLUME_UP:
<span class="nc bnc" id="L2094" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4603)) {</span>
<span class="nc" id="L2095">                                gesture = mGestureVolumeUp;</span>
                            }
                            break;
                        case KeyEvent.KEYCODE_VOLUME_DOWN:
<span class="nc bnc" id="L2099" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4604)) {</span>
<span class="nc" id="L2100">                                gesture = mGestureVolumeDown;</span>
                            }
                            break;
                    }
                }
<span class="nc bnc" id="L2105" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4612)) {</span>
                    // Execute gesture's command, but only consume event if action is assigned. We want the volume buttons to work normally otherwise.
<span class="nc bnc" id="L2107" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(4610) ? (gesture &gt;= COMMAND_NOTHING) : (ListenerUtil.mutListener.listen(4609) ? (gesture &lt;= COMMAND_NOTHING) : (ListenerUtil.mutListener.listen(4608) ? (gesture &gt; COMMAND_NOTHING) : (ListenerUtil.mutListener.listen(4607) ? (gesture &lt; COMMAND_NOTHING) : (ListenerUtil.mutListener.listen(4606) ? (gesture == COMMAND_NOTHING) : (gesture != COMMAND_NOTHING))))))) {</span>
<span class="nc bnc" id="L2108" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4611)) {</span>
<span class="nc" id="L2109">                            executeCommand(gesture);</span>
                        }
<span class="nc" id="L2111">                        return true;</span>
                    }
                }
            }
        }
<span class="nc" id="L2116">        return super.dispatchKeyEvent(event);</span>
    }

    // Set the content view to the one provided and initialize accessors.
    protected void initLayout() {
<span class="nc" id="L2121">        FrameLayout mCardContainer = findViewById(R.id.flashcard_frame);</span>
<span class="nc bnc" id="L2122" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4614)) {</span>
<span class="nc" id="L2123">            mTopBarLayout = findViewById(R.id.top_bar);</span>
        }
<span class="nc" id="L2125">        ImageView mark = mTopBarLayout.findViewById(R.id.mark_icon);</span>
<span class="nc" id="L2126">        ImageView flag = mTopBarLayout.findViewById(R.id.flag_icon);</span>
<span class="nc bnc" id="L2127" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4615)) {</span>
<span class="nc" id="L2128">            mCardMarker = new CardMarker(mark, flag);</span>
        }
<span class="nc bnc" id="L2130" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4616)) {</span>
<span class="nc" id="L2131">            mCardFrame = findViewById(R.id.flashcard);</span>
        }
<span class="nc bnc" id="L2133" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4617)) {</span>
<span class="nc" id="L2134">            mCardFrameParent = (ViewGroup) mCardFrame.getParent();</span>
        }
<span class="nc bnc" id="L2136" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4618)) {</span>
<span class="nc" id="L2137">            mTouchLayer = findViewById(R.id.touch_layer);</span>
        }
<span class="nc bnc" id="L2139" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4619)) {</span>
<span class="nc" id="L2140">            mTouchLayer.setOnTouchListener(mGestureListener);</span>
        }
<span class="nc bnc" id="L2142" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4621)) {</span>
<span class="nc bnc" id="L2143" title="All 2 branches missed.">            if (!mDisableClipboard) {</span>
<span class="nc bnc" id="L2144" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4620)) {</span>
<span class="nc" id="L2145">                    mClipboard = (android.content.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);</span>
                }
            }
        }
<span class="nc bnc" id="L2149" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4622)) {</span>
<span class="nc" id="L2150">            mCardFrame.removeAllViews();</span>
        }
<span class="nc bnc" id="L2152" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4623)) {</span>
            // Initialize swipe
<span class="nc bnc" id="L2154" title="All 2 branches missed.">            mGestureDetectorImpl = mLinkOverridesTouchGesture ? new LinkDetectingGestureDetector() : new MyGestureDetector();</span>
        }
<span class="nc bnc" id="L2156" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4624)) {</span>
<span class="nc" id="L2157">            gestureDetector = new GestureDetector(this, mGestureDetectorImpl);</span>
        }
<span class="nc bnc" id="L2159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4625)) {</span>
<span class="nc" id="L2160">            mEaseButtonsLayout = findViewById(R.id.ease_buttons);</span>
        }
<span class="nc bnc" id="L2162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4626)) {</span>
<span class="nc" id="L2163">            mEase1 = findViewById(R.id.ease1);</span>
        }
<span class="nc bnc" id="L2165" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4627)) {</span>
<span class="nc" id="L2166">            mEase1Layout = findViewById(R.id.flashcard_layout_ease1);</span>
        }
<span class="nc bnc" id="L2168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4628)) {</span>
<span class="nc" id="L2169">            mEase1Layout.setOnClickListener(mSelectEaseHandler);</span>
        }
<span class="nc bnc" id="L2171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4629)) {</span>
<span class="nc" id="L2172">            mEase2 = findViewById(R.id.ease2);</span>
        }
<span class="nc bnc" id="L2174" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4630)) {</span>
<span class="nc" id="L2175">            mEase2Layout = findViewById(R.id.flashcard_layout_ease2);</span>
        }
<span class="nc bnc" id="L2177" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4631)) {</span>
<span class="nc" id="L2178">            mEase2Layout.setOnClickListener(mSelectEaseHandler);</span>
        }
<span class="nc bnc" id="L2180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4632)) {</span>
<span class="nc" id="L2181">            mEase3 = findViewById(R.id.ease3);</span>
        }
<span class="nc bnc" id="L2183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4633)) {</span>
<span class="nc" id="L2184">            mEase3Layout = findViewById(R.id.flashcard_layout_ease3);</span>
        }
<span class="nc bnc" id="L2186" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4634)) {</span>
<span class="nc" id="L2187">            mEase3Layout.setOnClickListener(mSelectEaseHandler);</span>
        }
<span class="nc bnc" id="L2189" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4635)) {</span>
<span class="nc" id="L2190">            mEase4 = findViewById(R.id.ease4);</span>
        }
<span class="nc bnc" id="L2192" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4636)) {</span>
<span class="nc" id="L2193">            mEase4Layout = findViewById(R.id.flashcard_layout_ease4);</span>
        }
<span class="nc bnc" id="L2195" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4637)) {</span>
<span class="nc" id="L2196">            mEase4Layout.setOnClickListener(mSelectEaseHandler);</span>
        }
<span class="nc bnc" id="L2198" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4638)) {</span>
<span class="nc" id="L2199">            mNext1 = findViewById(R.id.nextTime1);</span>
        }
<span class="nc bnc" id="L2201" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4639)) {</span>
<span class="nc" id="L2202">            mNext2 = findViewById(R.id.nextTime2);</span>
        }
<span class="nc bnc" id="L2204" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4640)) {</span>
<span class="nc" id="L2205">            mNext3 = findViewById(R.id.nextTime3);</span>
        }
<span class="nc bnc" id="L2207" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4641)) {</span>
<span class="nc" id="L2208">            mNext4 = findViewById(R.id.nextTime4);</span>
        }
<span class="nc bnc" id="L2210" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4646)) {</span>
<span class="nc bnc" id="L2211" title="All 2 branches missed.">            if (!mShowNextReviewTime) {</span>
<span class="nc bnc" id="L2212" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4642)) {</span>
<span class="nc" id="L2213">                    mNext1.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L2215" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4643)) {</span>
<span class="nc" id="L2216">                    mNext2.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L2218" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4644)) {</span>
<span class="nc" id="L2219">                    mNext3.setVisibility(View.GONE);</span>
                }
<span class="nc bnc" id="L2221" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4645)) {</span>
<span class="nc" id="L2222">                    mNext4.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc" id="L2226">        Button mFlipCard = findViewById(R.id.flip_card);</span>
<span class="nc bnc" id="L2227" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4647)) {</span>
<span class="nc" id="L2228">            mFlipCardLayout = findViewById(R.id.flashcard_layout_flip);</span>
        }
<span class="nc bnc" id="L2230" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4648)) {</span>
<span class="nc" id="L2231">            mFlipCardLayout.setOnClickListener(mFlipCardListener);</span>
        }
<span class="nc bnc" id="L2233" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4650)) {</span>
<span class="nc bnc" id="L2234" title="All 2 branches missed.">            if (animationEnabled()) {</span>
<span class="nc bnc" id="L2235" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4649)) {</span>
<span class="nc" id="L2236">                    mFlipCard.setBackgroundResource(Themes.getResFromAttr(this, R.attr.hardButtonRippleRef));</span>
                }
            }
        }
<span class="nc bnc" id="L2240" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4707)) {</span>
<span class="nc bnc" id="L2241" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(4656) ? (!mButtonHeightSet || (ListenerUtil.mutListener.listen(4655) ? (mRelativeButtonSize &gt;= 100) : (ListenerUtil.mutListener.listen(4654) ? (mRelativeButtonSize &lt;= 100) : (ListenerUtil.mutListener.listen(4653) ? (mRelativeButtonSize &gt; 100) : (ListenerUtil.mutListener.listen(4652) ? (mRelativeButtonSize &lt; 100) : (ListenerUtil.mutListener.listen(4651) ? (mRelativeButtonSize == 100) : (mRelativeButtonSize != 100))))))) : (!mButtonHeightSet &amp;&amp; (ListenerUtil.mutListener.listen(4655) ? (mRelativeButtonSize &gt;= 100) : (ListenerUtil.mutListener.listen(4654) ? (mRelativeButtonSize &lt;= 100) : (ListenerUtil.mutListener.listen(4653) ? (mRelativeButtonSize &gt; 100) : (ListenerUtil.mutListener.listen(4652) ? (mRelativeButtonSize &lt; 100) : (ListenerUtil.mutListener.listen(4651) ? (mRelativeButtonSize == 100) : (mRelativeButtonSize != 100))))))))) {</span>
<span class="nc" id="L2242">                ViewGroup.LayoutParams params = mFlipCardLayout.getLayoutParams();</span>
<span class="nc bnc" id="L2243" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4665)) {</span>
<span class="nc bnc" id="L2244" title="All 48 branches missed.">                    params.height = (ListenerUtil.mutListener.listen(4664) ? ((ListenerUtil.mutListener.listen(4660) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4659) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4658) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4657) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) % 100) : (ListenerUtil.mutListener.listen(4663) ? ((ListenerUtil.mutListener.listen(4660) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4659) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4658) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4657) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) * 100) : (ListenerUtil.mutListener.listen(4662) ? ((ListenerUtil.mutListener.listen(4660) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4659) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4658) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4657) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) - 100) : (ListenerUtil.mutListener.listen(4661) ? ((ListenerUtil.mutListener.listen(4660) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4659) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4658) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4657) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) + 100) : ((ListenerUtil.mutListener.listen(4660) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4659) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4658) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4657) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) / 100)))));</span>
                }
<span class="nc bnc" id="L2246" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4666)) {</span>
<span class="nc" id="L2247">                    params = mEase1Layout.getLayoutParams();</span>
                }
<span class="nc bnc" id="L2249" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4675)) {</span>
<span class="nc bnc" id="L2250" title="All 48 branches missed.">                    params.height = (ListenerUtil.mutListener.listen(4674) ? ((ListenerUtil.mutListener.listen(4670) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4669) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4668) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4667) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) % 100) : (ListenerUtil.mutListener.listen(4673) ? ((ListenerUtil.mutListener.listen(4670) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4669) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4668) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4667) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) * 100) : (ListenerUtil.mutListener.listen(4672) ? ((ListenerUtil.mutListener.listen(4670) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4669) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4668) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4667) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) - 100) : (ListenerUtil.mutListener.listen(4671) ? ((ListenerUtil.mutListener.listen(4670) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4669) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4668) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4667) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) + 100) : ((ListenerUtil.mutListener.listen(4670) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4669) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4668) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4667) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) / 100)))));</span>
                }
<span class="nc bnc" id="L2252" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4676)) {</span>
<span class="nc" id="L2253">                    params = mEase2Layout.getLayoutParams();</span>
                }
<span class="nc bnc" id="L2255" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4685)) {</span>
<span class="nc bnc" id="L2256" title="All 48 branches missed.">                    params.height = (ListenerUtil.mutListener.listen(4684) ? ((ListenerUtil.mutListener.listen(4680) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4679) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4678) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4677) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) % 100) : (ListenerUtil.mutListener.listen(4683) ? ((ListenerUtil.mutListener.listen(4680) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4679) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4678) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4677) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) * 100) : (ListenerUtil.mutListener.listen(4682) ? ((ListenerUtil.mutListener.listen(4680) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4679) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4678) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4677) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) - 100) : (ListenerUtil.mutListener.listen(4681) ? ((ListenerUtil.mutListener.listen(4680) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4679) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4678) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4677) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) + 100) : ((ListenerUtil.mutListener.listen(4680) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4679) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4678) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4677) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) / 100)))));</span>
                }
<span class="nc bnc" id="L2258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4686)) {</span>
<span class="nc" id="L2259">                    params = mEase3Layout.getLayoutParams();</span>
                }
<span class="nc bnc" id="L2261" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4695)) {</span>
<span class="nc bnc" id="L2262" title="All 48 branches missed.">                    params.height = (ListenerUtil.mutListener.listen(4694) ? ((ListenerUtil.mutListener.listen(4690) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4689) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4688) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4687) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) % 100) : (ListenerUtil.mutListener.listen(4693) ? ((ListenerUtil.mutListener.listen(4690) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4689) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4688) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4687) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) * 100) : (ListenerUtil.mutListener.listen(4692) ? ((ListenerUtil.mutListener.listen(4690) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4689) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4688) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4687) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) - 100) : (ListenerUtil.mutListener.listen(4691) ? ((ListenerUtil.mutListener.listen(4690) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4689) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4688) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4687) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) + 100) : ((ListenerUtil.mutListener.listen(4690) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4689) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4688) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4687) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) / 100)))));</span>
                }
<span class="nc bnc" id="L2264" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4696)) {</span>
<span class="nc" id="L2265">                    params = mEase4Layout.getLayoutParams();</span>
                }
<span class="nc bnc" id="L2267" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4705)) {</span>
<span class="nc bnc" id="L2268" title="All 48 branches missed.">                    params.height = (ListenerUtil.mutListener.listen(4704) ? ((ListenerUtil.mutListener.listen(4700) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4699) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4698) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4697) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) % 100) : (ListenerUtil.mutListener.listen(4703) ? ((ListenerUtil.mutListener.listen(4700) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4699) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4698) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4697) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) * 100) : (ListenerUtil.mutListener.listen(4702) ? ((ListenerUtil.mutListener.listen(4700) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4699) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4698) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4697) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) - 100) : (ListenerUtil.mutListener.listen(4701) ? ((ListenerUtil.mutListener.listen(4700) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4699) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4698) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4697) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) + 100) : ((ListenerUtil.mutListener.listen(4700) ? (params.height % mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4699) ? (params.height / mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4698) ? (params.height - mRelativeButtonSize) : (ListenerUtil.mutListener.listen(4697) ? (params.height + mRelativeButtonSize) : (params.height * mRelativeButtonSize))))) / 100)))));</span>
                }
<span class="nc bnc" id="L2270" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4706)) {</span>
<span class="nc" id="L2271">                    mButtonHeightSet = true;</span>
                }
            }
        }
<span class="nc bnc" id="L2275" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4708)) {</span>
<span class="nc" id="L2276">            mPreviewButtonsLayout = findViewById(R.id.preview_buttons_layout);</span>
        }
<span class="nc bnc" id="L2278" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4709)) {</span>
<span class="nc" id="L2279">            mPreviewPrevCard = findViewById(R.id.preview_previous_flashcard);</span>
        }
<span class="nc bnc" id="L2281" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4710)) {</span>
<span class="nc" id="L2282">            mPreviewNextCard = findViewById(R.id.preview_next_flashcard);</span>
        }
<span class="nc bnc" id="L2284" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4711)) {</span>
<span class="nc" id="L2285">            mPreviewToggleAnswerText = findViewById(R.id.preview_flip_flashcard);</span>
        }
<span class="nc bnc" id="L2287" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4712)) {</span>
<span class="nc" id="L2288">            mCardTimer = findViewById(R.id.card_time);</span>
        }
<span class="nc bnc" id="L2290" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4713)) {</span>
<span class="nc" id="L2291">            mChosenAnswer = findViewById(R.id.choosen_answer);</span>
        }
<span class="nc bnc" id="L2293" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4714)) {</span>
<span class="nc" id="L2294">            mAnswerField = findViewById(R.id.answer_field);</span>
        }
<span class="nc bnc" id="L2296" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4715)) {</span>
<span class="nc" id="L2297">            mLookUpIcon = findViewById(R.id.lookup_button);</span>
        }
<span class="nc bnc" id="L2299" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4716)) {</span>
<span class="nc" id="L2300">            mLookUpIcon.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2302" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4717)) {</span>
<span class="nc" id="L2303">            mLookUpIcon.setOnClickListener(arg0 -&gt; {</span>
<span class="nc" id="L2304">                Timber.i(&quot;AbstractFlashcardViewer:: Lookup button pressed&quot;);</span>
<span class="nc bnc" id="L2305" title="All 2 branches missed.">                if (clipboardHasText()) {</span>
<span class="nc" id="L2306">                    lookUp();</span>
                }
<span class="nc" id="L2308">            });</span>
        }
<span class="nc bnc" id="L2310" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4718)) {</span>
<span class="nc" id="L2311">            initControls();</span>
        }
        // Position answer buttons
<span class="nc" id="L2314">        String answerButtonsPosition = AnkiDroidApp.getSharedPrefs(this).getString(getString(R.string.answer_buttons_position_preference), &quot;bottom&quot;);</span>
<span class="nc" id="L2315">        LinearLayout answerArea = findViewById(R.id.bottom_area_layout);</span>
<span class="nc" id="L2316">        RelativeLayout.LayoutParams answerAreaParams = (RelativeLayout.LayoutParams) answerArea.getLayoutParams();</span>
<span class="nc" id="L2317">        RelativeLayout.LayoutParams cardContainerParams = (RelativeLayout.LayoutParams) mCardContainer.getLayoutParams();</span>
<span class="nc bnc" id="L2318" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4727)) {</span>
<span class="nc bnc" id="L2319" title="All 3 branches missed.">            switch(answerButtonsPosition) {</span>
                case &quot;top&quot;:
<span class="nc bnc" id="L2321" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4719)) {</span>
<span class="nc" id="L2322">                        cardContainerParams.addRule(RelativeLayout.BELOW, R.id.bottom_area_layout);</span>
                    }
<span class="nc bnc" id="L2324" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4720)) {</span>
<span class="nc" id="L2325">                        answerAreaParams.addRule(RelativeLayout.BELOW, R.id.mic_tool_bar_layer);</span>
                    }
<span class="nc bnc" id="L2327" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4721)) {</span>
<span class="nc" id="L2328">                        answerArea.removeView(mAnswerField);</span>
                    }
<span class="nc bnc" id="L2330" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4722)) {</span>
<span class="nc" id="L2331">                        answerArea.addView(mAnswerField, 1);</span>
                    }
                    break;
                case &quot;bottom&quot;:
<span class="nc bnc" id="L2335" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4723)) {</span>
<span class="nc" id="L2336">                        cardContainerParams.addRule(RelativeLayout.ABOVE, R.id.bottom_area_layout);</span>
                    }
<span class="nc bnc" id="L2338" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4724)) {</span>
<span class="nc" id="L2339">                        cardContainerParams.addRule(RelativeLayout.BELOW, R.id.mic_tool_bar_layer);</span>
                    }
<span class="nc bnc" id="L2341" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4725)) {</span>
<span class="nc" id="L2342">                        answerAreaParams.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM);</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L2346" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4726)) {</span>
<span class="nc" id="L2347">                        Timber.w(&quot;Unknown answerButtonsPosition: %s&quot;, answerButtonsPosition);</span>
                    }
                    break;
            }
        }
<span class="nc bnc" id="L2352" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4728)) {</span>
<span class="nc" id="L2353">            answerArea.setLayoutParams(answerAreaParams);</span>
        }
<span class="nc bnc" id="L2355" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4729)) {</span>
<span class="nc" id="L2356">            mCardContainer.setLayoutParams(cardContainerParams);</span>
        }
<span class="nc" id="L2358">    }</span>

    // they request we review carefully because of XSS security, we have
    @SuppressLint(&quot;SetJavaScriptEnabled&quot;)
    protected WebView createWebView() {
<span class="nc" id="L2363">        WebView webView = new MyWebView(this);</span>
<span class="nc bnc" id="L2364" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4730)) {</span>
<span class="nc" id="L2365">            webView.setScrollBarStyle(View.SCROLLBARS_OUTSIDE_OVERLAY);</span>
        }
<span class="nc bnc" id="L2367" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4731)) {</span>
<span class="nc" id="L2368">            webView.getSettings().setDisplayZoomControls(false);</span>
        }
<span class="nc bnc" id="L2370" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4732)) {</span>
<span class="nc" id="L2371">            webView.getSettings().setBuiltInZoomControls(true);</span>
        }
<span class="nc bnc" id="L2373" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4733)) {</span>
<span class="nc" id="L2374">            webView.getSettings().setSupportZoom(true);</span>
        }
<span class="nc bnc" id="L2376" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4734)) {</span>
            // Start at the most zoomed-out level
<span class="nc" id="L2378">            webView.getSettings().setLoadWithOverviewMode(true);</span>
        }
<span class="nc bnc" id="L2380" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4735)) {</span>
<span class="nc" id="L2381">            webView.getSettings().setJavaScriptEnabled(true);</span>
        }
<span class="nc bnc" id="L2383" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4736)) {</span>
<span class="nc" id="L2384">            webView.setWebChromeClient(new AnkiDroidWebChromeClient());</span>
        }
<span class="nc bnc" id="L2386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4737)) {</span>
            // Problems with focus and input tags is the reason we keep the old type answer mechanism for old Androids.
<span class="nc" id="L2388">            webView.setFocusableInTouchMode(mUseInputTag);</span>
        }
<span class="nc bnc" id="L2390" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4738)) {</span>
<span class="nc" id="L2391">            webView.setScrollbarFadingEnabled(true);</span>
        }
<span class="nc bnc" id="L2393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4739)) {</span>
<span class="nc" id="L2394">            Timber.d(&quot;Focusable = %s, Focusable in touch mode = %s&quot;, webView.isFocusable(), webView.isFocusableInTouchMode());</span>
        }
<span class="nc bnc" id="L2396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4740)) {</span>
<span class="nc" id="L2397">            webView.setWebViewClient(new CardViewerWebClient(mAssetLoader));</span>
        }
<span class="nc bnc" id="L2399" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4741)) {</span>
            // Set transparent color to prevent flashing white when night mode enabled
<span class="nc" id="L2401">            webView.setBackgroundColor(Color.argb(1, 0, 0, 0));</span>
        }
<span class="nc bnc" id="L2403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4742)) {</span>
            // Javascript interface for calling AnkiDroid functions in webview, see card.js
<span class="nc" id="L2405">            webView.addJavascriptInterface(javaScriptFunction(), &quot;AnkiDroidJS&quot;);</span>
        }
<span class="nc" id="L2407">        return webView;</span>
    }

    /**
     * If a card is displaying the question, flip it, otherwise answer it
     */
    private void flipOrAnswerCard(int cardOrdinal) {
<span class="nc bnc" id="L2414" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4744)) {</span>
<span class="nc bnc" id="L2415" title="All 2 branches missed.">            if (!sDisplayAnswer) {</span>
<span class="nc bnc" id="L2416" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4743)) {</span>
<span class="nc" id="L2417">                    displayCardAnswer();</span>
                }
<span class="nc" id="L2419">                return;</span>
            }
        }
<span class="nc bnc" id="L2422" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4745)) {</span>
<span class="nc" id="L2423">            performClickWithVisualFeedback(cardOrdinal);</span>
        }
<span class="nc" id="L2425">    }</span>

    private boolean webViewRendererLastCrashedOnCard(long cardId) {
<span class="nc bnc" id="L2428" title="All 50 branches missed.">        return (ListenerUtil.mutListener.listen(4751) ? (lastCrashingCardId != null || (ListenerUtil.mutListener.listen(4750) ? (lastCrashingCardId &gt;= cardId) : (ListenerUtil.mutListener.listen(4749) ? (lastCrashingCardId &lt;= cardId) : (ListenerUtil.mutListener.listen(4748) ? (lastCrashingCardId &gt; cardId) : (ListenerUtil.mutListener.listen(4747) ? (lastCrashingCardId &lt; cardId) : (ListenerUtil.mutListener.listen(4746) ? (lastCrashingCardId != cardId) : (lastCrashingCardId == cardId))))))) : (lastCrashingCardId != null &amp;&amp; (ListenerUtil.mutListener.listen(4750) ? (lastCrashingCardId &gt;= cardId) : (ListenerUtil.mutListener.listen(4749) ? (lastCrashingCardId &lt;= cardId) : (ListenerUtil.mutListener.listen(4748) ? (lastCrashingCardId &gt; cardId) : (ListenerUtil.mutListener.listen(4747) ? (lastCrashingCardId &lt; cardId) : (ListenerUtil.mutListener.listen(4746) ? (lastCrashingCardId != cardId) : (lastCrashingCardId == cardId))))))));</span>
    }

    private boolean canRecoverFromWebViewRendererCrash() {
        // Revisit webViewCrashedOnCard() if changing this. Logic currently assumes we have a card.
<span class="nc bnc" id="L2433" title="All 2 branches missed.">        return mCurrentCard != null;</span>
    }

    // #5780 - Users could OOM the WebView Renderer. This triggers the same symptoms
    @VisibleForTesting()
    @SuppressWarnings(&quot;unused&quot;)
    public void crashWebViewRenderer() {
<span class="nc bnc" id="L2440" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4752)) {</span>
<span class="nc" id="L2441">            loadUrlInViewer(&quot;chrome://crash&quot;);</span>
        }
<span class="nc" id="L2443">    }</span>

    /**
     * Used to set the &quot;javascript:&quot; URIs for IPC
     */
    private void loadUrlInViewer(final String url) {
<span class="nc bnc" id="L2449" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4753)) {</span>
<span class="nc" id="L2450">            processCardAction(cardWebView -&gt; cardWebView.loadUrl(url));</span>
        }
<span class="nc" id="L2452">    }</span>

    private &lt;T extends View&gt; T inflateNewView(@IdRes int id) {
<span class="nc" id="L2455">        int layoutId = getContentViewAttr(mPrefFullscreenReview);</span>
<span class="nc" id="L2456">        ViewGroup content = (ViewGroup) LayoutInflater.from(AbstractFlashcardViewer.this).inflate(layoutId, null, false);</span>
<span class="nc" id="L2457">        T ret = content.findViewById(id);</span>
<span class="nc bnc" id="L2458" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4754)) {</span>
            // detach the view from its parent
<span class="nc" id="L2460">            ((ViewGroup) ret.getParent()).removeView(ret);</span>
        }
<span class="nc bnc" id="L2462" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4755)) {</span>
<span class="nc" id="L2463">            content.removeAllViews();</span>
        }
<span class="nc" id="L2465">        return ret;</span>
    }

    private void destroyWebView(WebView webView) {
        try {
<span class="nc bnc" id="L2470" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4761)) {</span>
<span class="nc bnc" id="L2471" title="All 2 branches missed.">                if (webView != null) {</span>
<span class="nc bnc" id="L2472" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4757)) {</span>
<span class="nc" id="L2473">                        webView.stopLoading();</span>
                    }
<span class="nc bnc" id="L2475" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4758)) {</span>
<span class="nc" id="L2476">                        webView.setWebChromeClient(null);</span>
                    }
<span class="nc bnc" id="L2478" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4759)) {</span>
<span class="nc" id="L2479">                        webView.setWebViewClient(null);</span>
                    }
<span class="nc bnc" id="L2481" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4760)) {</span>
<span class="nc" id="L2482">                        webView.destroy();</span>
                    }
                }
            }
<span class="nc" id="L2486">        } catch (NullPointerException npe) {</span>
<span class="nc bnc" id="L2487" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4756)) {</span>
<span class="nc" id="L2488">                Timber.e(npe, &quot;WebView became null on destruction&quot;);</span>
            }
<span class="nc" id="L2490">        }</span>
<span class="nc" id="L2491">    }</span>

    protected boolean shouldShowNextReviewTime() {
<span class="nc" id="L2494">        return mShowNextReviewTime;</span>
    }

    protected void displayAnswerBottomBar() {
<span class="nc bnc" id="L2498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4762)) {</span>
<span class="nc" id="L2499">            mFlipCardLayout.setClickable(false);</span>
        }
<span class="nc bnc" id="L2501" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4763)) {</span>
<span class="nc" id="L2502">            mEaseButtonsLayout.setVisibility(View.VISIBLE);</span>
        }
<span class="nc" id="L2504">        Runnable after = () -&gt; mFlipCardLayout.setVisibility(View.GONE);</span>
<span class="nc bnc" id="L2505" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4767)) {</span>
            // hide &quot;Show Answer&quot; button
<span class="nc bnc" id="L2507" title="All 2 branches missed.">            if (animationDisabled()) {</span>
<span class="nc bnc" id="L2508" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4766)) {</span>
<span class="nc" id="L2509">                    after.run();</span>
                }
            } else {
<span class="nc bnc" id="L2512" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4764)) {</span>
<span class="nc" id="L2513">                    mFlipCardLayout.setAlpha(1);</span>
                }
<span class="nc bnc" id="L2515" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4765)) {</span>
<span class="nc" id="L2516">                    mFlipCardLayout.animate().alpha(0).setDuration(mShortAnimDuration).withEndAction(after);</span>
                }
            }
        }
<span class="nc" id="L2520">    }</span>

    protected void hideEaseButtons() {
<span class="nc" id="L2523">        Runnable after = this::actualHideEaseButtons;</span>
<span class="nc bnc" id="L2524" title="All 2 branches missed.">        boolean easeButtonsVisible = mEaseButtonsLayout.getVisibility() == View.VISIBLE;</span>
<span class="nc bnc" id="L2525" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4768)) {</span>
<span class="nc" id="L2526">            mFlipCardLayout.setClickable(true);</span>
        }
<span class="nc bnc" id="L2528" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4769)) {</span>
<span class="nc" id="L2529">            mFlipCardLayout.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L2531" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4774)) {</span>
<span class="nc bnc" id="L2532" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4770) ? (animationDisabled() &amp;&amp; !easeButtonsVisible) : (animationDisabled() || !easeButtonsVisible))) {</span>
<span class="nc bnc" id="L2533" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4773)) {</span>
<span class="nc" id="L2534">                    after.run();</span>
                }
            } else {
<span class="nc bnc" id="L2537" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4771)) {</span>
<span class="nc" id="L2538">                    mFlipCardLayout.setAlpha(0);</span>
                }
<span class="nc bnc" id="L2540" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4772)) {</span>
<span class="nc" id="L2541">                    mFlipCardLayout.animate().alpha(1).setDuration(mShortAnimDuration).withEndAction(after);</span>
                }
            }
        }
<span class="nc bnc" id="L2545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4775)) {</span>
<span class="nc" id="L2546">            focusAnswerCompletionField();</span>
        }
<span class="nc" id="L2548">    }</span>

    private void actualHideEaseButtons() {
<span class="nc bnc" id="L2551" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4776)) {</span>
<span class="nc" id="L2552">            mEaseButtonsLayout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2554" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4777)) {</span>
<span class="nc" id="L2555">            mEase1Layout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2557" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4778)) {</span>
<span class="nc" id="L2558">            mEase2Layout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2560" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4779)) {</span>
<span class="nc" id="L2561">            mEase3Layout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2563" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4780)) {</span>
<span class="nc" id="L2564">            mEase4Layout.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L2566" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4781)) {</span>
<span class="nc" id="L2567">            mNext1.setText(&quot;&quot;);</span>
        }
<span class="nc bnc" id="L2569" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4782)) {</span>
<span class="nc" id="L2570">            mNext2.setText(&quot;&quot;);</span>
        }
<span class="nc bnc" id="L2572" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4783)) {</span>
<span class="nc" id="L2573">            mNext3.setText(&quot;&quot;);</span>
        }
<span class="nc bnc" id="L2575" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4784)) {</span>
<span class="nc" id="L2576">            mNext4.setText(&quot;&quot;);</span>
        }
<span class="nc" id="L2578">    }</span>

    /**
     * Focuses the appropriate field for an answer
     * And allows keyboard shortcuts to go to the default handlers.
     */
    private void focusAnswerCompletionField() {
<span class="nc bnc" id="L2585" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4787)) {</span>
            // In this case, the user can use touch to focus the field if necessary.
<span class="nc bnc" id="L2587" title="All 2 branches missed.">            if (typeAnswer()) {</span>
<span class="nc bnc" id="L2588" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4786)) {</span>
<span class="nc" id="L2589">                    mAnswerField.requestFocus();</span>
                }
            } else {
<span class="nc bnc" id="L2592" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4785)) {</span>
<span class="nc" id="L2593">                    mFlipCardLayout.requestFocus();</span>
                }
            }
        }
<span class="nc" id="L2597">    }</span>

    protected void switchTopBarVisibility(int visible) {
<span class="nc bnc" id="L2600" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4789)) {</span>
<span class="nc bnc" id="L2601" title="All 2 branches missed.">            if (mShowTimer) {</span>
<span class="nc bnc" id="L2602" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4788)) {</span>
<span class="nc" id="L2603">                    mCardTimer.setVisibility(visible);</span>
                }
            }
        }
<span class="nc bnc" id="L2607" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4790)) {</span>
<span class="nc" id="L2608">            mChosenAnswer.setVisibility(visible);</span>
        }
<span class="nc" id="L2610">    }</span>

    protected void initControls() {
<span class="nc bnc" id="L2613" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4791)) {</span>
<span class="nc" id="L2614">            mCardFrame.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L2616" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4792)) {</span>
<span class="nc" id="L2617">            mChosenAnswer.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L2619" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4793)) {</span>
<span class="nc" id="L2620">            mFlipCardLayout.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L2622" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4794)) {</span>
<span class="nc bnc" id="L2623" title="All 2 branches missed.">            mAnswerField.setVisibility(typeAnswer() ? View.VISIBLE : View.GONE);</span>
        }
<span class="nc bnc" id="L2625" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4795)) {</span>
<span class="nc" id="L2626">            mAnswerField.setOnEditorActionListener((v, actionId, event) -&gt; {</span>
<span class="nc bnc" id="L2627" title="All 2 branches missed.">                if (actionId == EditorInfo.IME_ACTION_DONE) {</span>
<span class="nc" id="L2628">                    displayCardAnswer();</span>
<span class="nc" id="L2629">                    return true;</span>
                }
<span class="nc" id="L2631">                return false;</span>
            });
        }
<span class="nc bnc" id="L2634" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4796)) {</span>
<span class="nc" id="L2635">            mAnswerField.setOnKeyListener((v, keyCode, event) -&gt; {</span>
<span class="nc bnc" id="L2636" title="All 6 branches missed.">                if (event.getAction() == KeyEvent.ACTION_UP &amp;&amp; (keyCode == KeyEvent.KEYCODE_ENTER || keyCode == KeyEvent.KEYCODE_NUMPAD_ENTER)) {</span>
<span class="nc" id="L2637">                    displayCardAnswer();</span>
<span class="nc" id="L2638">                    return true;</span>
                }
<span class="nc" id="L2640">                return false;</span>
            });
        }
<span class="nc" id="L2643">    }</span>

    protected SharedPreferences restorePreferences() {
<span class="nc" id="L2646">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc bnc" id="L2647" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4797)) {</span>
<span class="nc" id="L2648">            mUseInputTag = preferences.getBoolean(&quot;useInputTag&quot;, false);</span>
        }
<span class="nc bnc" id="L2650" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4798)) {</span>
<span class="nc" id="L2651">            mDoNotUseCodeFormatting = preferences.getBoolean(&quot;noCodeFormatting&quot;, false);</span>
        }
<span class="nc bnc" id="L2653" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4799)) {</span>
            // On newer Androids, ignore this setting, which should be hidden in the prefs anyway.
<span class="nc" id="L2655">            mDisableClipboard = &quot;0&quot;.equals(preferences.getString(&quot;dictionary&quot;, &quot;0&quot;));</span>
        }
<span class="nc bnc" id="L2657" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4800)) {</span>
            // mDeckFilename = preferences.getString(&quot;deckFilename&quot;, &quot;&quot;);
<span class="nc" id="L2659">            mPrefFullscreenReview = Integer.parseInt(preferences.getString(&quot;fullscreenMode&quot;, &quot;0&quot;));</span>
        }
<span class="nc bnc" id="L2661" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4801)) {</span>
<span class="nc" id="L2662">            mRelativeButtonSize = preferences.getInt(&quot;answerButtonSize&quot;, 100);</span>
        }
<span class="nc bnc" id="L2664" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4802)) {</span>
<span class="nc" id="L2665">            mSpeakText = preferences.getBoolean(&quot;tts&quot;, false);</span>
        }
<span class="nc bnc" id="L2667" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4803)) {</span>
<span class="nc" id="L2668">            mPrefUseTimer = preferences.getBoolean(&quot;timeoutAnswer&quot;, false);</span>
        }
<span class="nc bnc" id="L2670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4804)) {</span>
<span class="nc" id="L2671">            mPrefWaitAnswerSecond = preferences.getInt(&quot;timeoutAnswerSeconds&quot;, 20);</span>
        }
<span class="nc bnc" id="L2673" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4805)) {</span>
<span class="nc" id="L2674">            mPrefWaitQuestionSecond = preferences.getInt(&quot;timeoutQuestionSeconds&quot;, 60);</span>
        }
<span class="nc bnc" id="L2676" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4806)) {</span>
<span class="nc" id="L2677">            mScrollingButtons = preferences.getBoolean(&quot;scrolling_buttons&quot;, false);</span>
        }
<span class="nc bnc" id="L2679" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4807)) {</span>
<span class="nc" id="L2680">            mDoubleScrolling = preferences.getBoolean(&quot;double_scrolling&quot;, false);</span>
        }
<span class="nc bnc" id="L2682" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4808)) {</span>
<span class="nc" id="L2683">            mPrefShowTopbar = preferences.getBoolean(&quot;showTopbar&quot;, true);</span>
        }
<span class="nc bnc" id="L2685" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4809)) {</span>
<span class="nc" id="L2686">            mGesturesEnabled = AnkiDroidApp.initiateGestures(preferences);</span>
        }
<span class="nc bnc" id="L2688" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4810)) {</span>
<span class="nc" id="L2689">            mLinkOverridesTouchGesture = preferences.getBoolean(&quot;linkOverridesTouchGesture&quot;, false);</span>
        }
<span class="nc bnc" id="L2691" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4820)) {</span>
<span class="nc bnc" id="L2692" title="All 2 branches missed.">            if (mGesturesEnabled) {</span>
<span class="nc bnc" id="L2693" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4811)) {</span>
<span class="nc" id="L2694">                    mGestureSwipeUp = Integer.parseInt(preferences.getString(&quot;gestureSwipeUp&quot;, &quot;9&quot;));</span>
                }
<span class="nc bnc" id="L2696" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4812)) {</span>
<span class="nc" id="L2697">                    mGestureSwipeDown = Integer.parseInt(preferences.getString(&quot;gestureSwipeDown&quot;, &quot;0&quot;));</span>
                }
<span class="nc bnc" id="L2699" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4813)) {</span>
<span class="nc" id="L2700">                    mGestureSwipeLeft = Integer.parseInt(preferences.getString(&quot;gestureSwipeLeft&quot;, &quot;8&quot;));</span>
                }
<span class="nc bnc" id="L2702" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4814)) {</span>
<span class="nc" id="L2703">                    mGestureSwipeRight = Integer.parseInt(preferences.getString(&quot;gestureSwipeRight&quot;, &quot;17&quot;));</span>
                }
<span class="nc bnc" id="L2705" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4815)) {</span>
<span class="nc" id="L2706">                    mGestureDoubleTap = Integer.parseInt(preferences.getString(&quot;gestureDoubleTap&quot;, &quot;7&quot;));</span>
                }
<span class="nc bnc" id="L2708" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4816)) {</span>
<span class="nc" id="L2709">                    mGestureTapProcessor.init(preferences);</span>
                }
<span class="nc bnc" id="L2711" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4817)) {</span>
<span class="nc" id="L2712">                    mGestureLongclick = Integer.parseInt(preferences.getString(&quot;gestureLongclick&quot;, &quot;11&quot;));</span>
                }
<span class="nc bnc" id="L2714" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4818)) {</span>
<span class="nc" id="L2715">                    mGestureVolumeUp = Integer.parseInt(preferences.getString(&quot;gestureVolumeUp&quot;, &quot;0&quot;));</span>
                }
<span class="nc bnc" id="L2717" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4819)) {</span>
<span class="nc" id="L2718">                    mGestureVolumeDown = Integer.parseInt(preferences.getString(&quot;gestureVolumeDown&quot;, &quot;0&quot;));</span>
                }
            }
        }
<span class="nc bnc" id="L2722" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4822)) {</span>
<span class="nc bnc" id="L2723" title="All 2 branches missed.">            if (preferences.getBoolean(&quot;keepScreenOn&quot;, false)) {</span>
<span class="nc bnc" id="L2724" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4821)) {</span>
<span class="nc" id="L2725">                    this.getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);</span>
                }
            }
        }
<span class="nc" id="L2729">        return preferences;</span>
    }

    protected void restoreCollectionPreferences() {
        // These are preferences we pull out of the collection instead of SharedPreferences
        try {
<span class="nc bnc" id="L2735" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4827)) {</span>
<span class="nc" id="L2736">                mShowNextReviewTime = getCol().getConf().getBoolean(&quot;estTimes&quot;);</span>
            }
            // but be prepared to go with all default if it's a dynamic deck
<span class="nc" id="L2739">            JSONObject revOptions = new JSONObject();</span>
<span class="nc" id="L2740">            long selectedDid = getCol().getDecks().selected();</span>
<span class="nc bnc" id="L2741" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4829)) {</span>
<span class="nc bnc" id="L2742" title="All 2 branches missed.">                if (!getCol().getDecks().isDyn(selectedDid)) {</span>
<span class="nc bnc" id="L2743" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4828)) {</span>
<span class="nc" id="L2744">                        revOptions = getCol().getDecks().confForDid(selectedDid).getJSONObject(&quot;rev&quot;);</span>
                    }
                }
            }
<span class="nc bnc" id="L2748" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4830)) {</span>
<span class="nc" id="L2749">                mOptUseGeneralTimerSettings = revOptions.optBoolean(&quot;useGeneralTimeoutSettings&quot;, true);</span>
            }
<span class="nc bnc" id="L2751" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4831)) {</span>
<span class="nc" id="L2752">                mOptUseTimer = revOptions.optBoolean(&quot;timeoutAnswer&quot;, false);</span>
            }
<span class="nc bnc" id="L2754" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4832)) {</span>
<span class="nc" id="L2755">                mOptWaitAnswerSecond = revOptions.optInt(&quot;timeoutAnswerSeconds&quot;, 20);</span>
            }
<span class="nc bnc" id="L2757" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4833)) {</span>
<span class="nc" id="L2758">                mOptWaitQuestionSecond = revOptions.optInt(&quot;timeoutQuestionSeconds&quot;, 60);</span>
            }
<span class="nc" id="L2760">        } catch (JSONException e) {</span>
<span class="nc bnc" id="L2761" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4823)) {</span>
<span class="nc" id="L2762">                Timber.e(e, &quot;Unable to restoreCollectionPreferences&quot;);</span>
            }
<span class="nc" id="L2764">            throw new RuntimeException(e);</span>
<span class="nc" id="L2765">        } catch (NullPointerException npe) {</span>
            // NPE on collection only happens if the Collection is broken, follow AnkiActivity example
<span class="nc" id="L2767">            Intent deckPicker = new Intent(this, DeckPicker.class);</span>
<span class="nc bnc" id="L2768" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4824)) {</span>
                // don't currently do anything with this
<span class="nc" id="L2770">                deckPicker.putExtra(&quot;collectionLoadError&quot;, true);</span>
            }
<span class="nc bnc" id="L2772" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4825)) {</span>
<span class="nc" id="L2773">                deckPicker.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);</span>
            }
<span class="nc bnc" id="L2775" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4826)) {</span>
<span class="nc" id="L2776">                startActivityWithAnimation(deckPicker, LEFT);</span>
            }
<span class="nc" id="L2778">        }</span>
<span class="nc" id="L2779">    }</span>

    private void setInterface() {
<span class="nc bnc" id="L2782" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4834)) {</span>
<span class="nc bnc" id="L2783" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc" id="L2784">                return;</span>
            }
        }
<span class="nc bnc" id="L2787" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4835)) {</span>
<span class="nc" id="L2788">            recreateWebView();</span>
        }
<span class="nc" id="L2790">    }</span>

    private void recreateWebView() {
<span class="nc bnc" id="L2793" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4840)) {</span>
<span class="nc bnc" id="L2794" title="All 2 branches missed.">            if (mCardWebView == null) {</span>
<span class="nc bnc" id="L2795" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4836)) {</span>
<span class="nc" id="L2796">                    mCardWebView = createWebView();</span>
                }
<span class="nc bnc" id="L2798" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4837)) {</span>
<span class="nc" id="L2799">                    WebViewDebugging.initializeDebugging(AnkiDroidApp.getSharedPrefs(this));</span>
                }
<span class="nc bnc" id="L2801" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4838)) {</span>
<span class="nc" id="L2802">                    mCardFrame.addView(mCardWebView);</span>
                }
<span class="nc bnc" id="L2804" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4839)) {</span>
<span class="nc" id="L2805">                    mGestureDetectorImpl.onWebViewCreated(mCardWebView);</span>
                }
            }
        }
<span class="nc bnc" id="L2809" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4842)) {</span>
<span class="nc bnc" id="L2810" title="All 2 branches missed.">            if (mCardWebView.getVisibility() != View.VISIBLE) {</span>
<span class="nc bnc" id="L2811" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4841)) {</span>
<span class="nc" id="L2812">                    mCardWebView.setVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc" id="L2816">    }</span>

    private void updateForNewCard() {
<span class="nc bnc" id="L2819" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4843)) {</span>
<span class="nc" id="L2820">            updateActionBar();</span>
        }
<span class="nc bnc" id="L2822" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4845)) {</span>
            // Clean answer field
<span class="nc bnc" id="L2824" title="All 2 branches missed.">            if (typeAnswer()) {</span>
<span class="nc bnc" id="L2825" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4844)) {</span>
<span class="nc" id="L2826">                    mAnswerField.setText(&quot;&quot;);</span>
                }
            }
        }
<span class="nc bnc" id="L2830" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4848)) {</span>
<span class="nc bnc" id="L2831" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4846) ? (mPrefWhiteboard || mWhiteboard != null) : (mPrefWhiteboard &amp;&amp; mWhiteboard != null))) {</span>
<span class="nc bnc" id="L2832" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4847)) {</span>
<span class="nc" id="L2833">                    mWhiteboard.clear();</span>
                }
            }
        }
<span class="nc" id="L2837">    }</span>

    protected void updateActionBar() {
<span class="nc bnc" id="L2840" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4849)) {</span>
<span class="nc" id="L2841">            updateDeckName();</span>
        }
<span class="nc" id="L2843">    }</span>

    protected void updateDeckName() {
<span class="nc bnc" id="L2846" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4850)) {</span>
<span class="nc bnc" id="L2847" title="All 2 branches missed.">            if (mCurrentCard == null)</span>
<span class="nc" id="L2848">                return;</span>
        }
<span class="nc" id="L2850">        ActionBar actionBar = getSupportActionBar();</span>
<span class="nc bnc" id="L2851" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4852)) {</span>
<span class="nc bnc" id="L2852" title="All 2 branches missed.">            if (actionBar != null) {</span>
<span class="nc" id="L2853">                String title = Decks.basename(getCol().getDecks().get(mCurrentCard.getDid()).getString(&quot;name&quot;));</span>
<span class="nc bnc" id="L2854" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4851)) {</span>
<span class="nc" id="L2855">                    actionBar.setTitle(title);</span>
                }
            }
        }
<span class="nc bnc" id="L2859" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4854)) {</span>
<span class="nc bnc" id="L2860" title="All 2 branches missed.">            if (!mPrefShowTopbar) {</span>
<span class="nc bnc" id="L2861" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4853)) {</span>
<span class="nc" id="L2862">                    mTopBarLayout.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc" id="L2866">    }</span>

    /*
     * Handler for the delay in auto showing question and/or answer One toggle for both question and answer, could set
     * longer delay for auto next question
     */
<span class="nc" id="L2872">    protected final Handler mTimeoutHandler = new Handler();</span>

<span class="nc" id="L2874">    protected final Runnable mShowQuestionTask = new Runnable() {</span>

        @Override
        public void run() {
<span class="nc bnc" id="L2878" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4857)) {</span>
                // Assume hitting the &quot;Again&quot; button when auto next question
<span class="nc bnc" id="L2880" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(4855) ? (mEase1Layout.isEnabled() || mEase1Layout.getVisibility() == View.VISIBLE) : (mEase1Layout.isEnabled() &amp;&amp; mEase1Layout.getVisibility() == View.VISIBLE))) {</span>
<span class="nc bnc" id="L2881" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4856)) {</span>
<span class="nc" id="L2882">                        mEase1Layout.performClick();</span>
                    }
                }
            }
<span class="nc" id="L2886">        }</span>
    };

<span class="nc" id="L2889">    protected final Runnable mShowAnswerTask = new Runnable() {</span>

        @Override
        public void run() {
<span class="nc bnc" id="L2893" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4860)) {</span>
<span class="nc bnc" id="L2894" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(4858) ? (mFlipCardLayout.isEnabled() || mFlipCardLayout.getVisibility() == View.VISIBLE) : (mFlipCardLayout.isEnabled() &amp;&amp; mFlipCardLayout.getVisibility() == View.VISIBLE))) {</span>
<span class="nc bnc" id="L2895" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4859)) {</span>
<span class="nc" id="L2896">                        mFlipCardLayout.performClick();</span>
                    }
                }
            }
<span class="nc" id="L2900">        }</span>
    };

<span class="nc" id="L2903">    class ReadTextListener implements ReadText.ReadTextListener {</span>

        public void onDone() {
<span class="nc bnc" id="L2906" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4861)) {</span>
<span class="nc bnc" id="L2907" title="All 2 branches missed.">                if (!mUseTimer) {</span>
<span class="nc" id="L2908">                    return;</span>
                }
            }
<span class="nc bnc" id="L2911" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4884)) {</span>
<span class="nc bnc" id="L2912" title="All 2 branches missed.">                if (ReadText.getmQuestionAnswer() == SoundSide.QUESTION) {</span>
<span class="nc bnc" id="L2913" title="All 8 branches missed.">                    long delay = (ListenerUtil.mutListener.listen(4876) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4875) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4874) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4873) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000)))));</span>
<span class="nc bnc" id="L2914" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4883)) {</span>
<span class="nc bnc" id="L2915" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(4881) ? (delay &gt;= 0) : (ListenerUtil.mutListener.listen(4880) ? (delay &lt;= 0) : (ListenerUtil.mutListener.listen(4879) ? (delay &lt; 0) : (ListenerUtil.mutListener.listen(4878) ? (delay != 0) : (ListenerUtil.mutListener.listen(4877) ? (delay == 0) : (delay &gt; 0))))))) {</span>
<span class="nc bnc" id="L2916" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4882)) {</span>
<span class="nc" id="L2917">                                mTimeoutHandler.postDelayed(mShowAnswerTask, delay);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2921" title="All 2 branches missed.">                } else if (ReadText.getmQuestionAnswer() == SoundSide.ANSWER) {</span>
<span class="nc bnc" id="L2922" title="All 8 branches missed.">                    long delay = (ListenerUtil.mutListener.listen(4865) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4864) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4863) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4862) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000)))));</span>
<span class="nc bnc" id="L2923" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(4872)) {</span>
<span class="nc bnc" id="L2924" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(4870) ? (delay &gt;= 0) : (ListenerUtil.mutListener.listen(4869) ? (delay &lt;= 0) : (ListenerUtil.mutListener.listen(4868) ? (delay &lt; 0) : (ListenerUtil.mutListener.listen(4867) ? (delay != 0) : (ListenerUtil.mutListener.listen(4866) ? (delay == 0) : (delay &gt; 0))))))) {</span>
<span class="nc bnc" id="L2925" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(4871)) {</span>
<span class="nc" id="L2926">                                mTimeoutHandler.postDelayed(mShowQuestionTask, delay);</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L2932">        }</span>
    }

    protected void initTimer() {
<span class="nc" id="L2936">        final TypedValue typedValue = new TypedValue();</span>
<span class="nc bnc" id="L2937" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4885)) {</span>
<span class="nc" id="L2938">            mShowTimer = mCurrentCard.showTimer();</span>
        }
<span class="nc bnc" id="L2940" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4890)) {</span>
<span class="nc bnc" id="L2941" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4886) ? (mShowTimer || mCardTimer.getVisibility() == View.INVISIBLE) : (mShowTimer &amp;&amp; mCardTimer.getVisibility() == View.INVISIBLE))) {</span>
<span class="nc bnc" id="L2942" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4889)) {</span>
<span class="nc" id="L2943">                    mCardTimer.setVisibility(View.VISIBLE);</span>
                }
<span class="nc bnc" id="L2945" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(4887) ? (!mShowTimer || mCardTimer.getVisibility() != View.INVISIBLE) : (!mShowTimer &amp;&amp; mCardTimer.getVisibility() != View.INVISIBLE))) {</span>
<span class="nc bnc" id="L2946" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4888)) {</span>
<span class="nc" id="L2947">                    mCardTimer.setVisibility(View.INVISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L2951" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4891)) {</span>
            // Set normal timer color
<span class="nc" id="L2953">            getTheme().resolveAttribute(android.R.attr.textColor, typedValue, true);</span>
        }
<span class="nc bnc" id="L2955" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4892)) {</span>
<span class="nc" id="L2956">            mCardTimer.setTextColor(typedValue.data);</span>
        }
<span class="nc bnc" id="L2958" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4893)) {</span>
<span class="nc" id="L2959">            mCardTimer.setBase(SystemClock.elapsedRealtime());</span>
        }
<span class="nc bnc" id="L2961" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4894)) {</span>
<span class="nc" id="L2962">            mCardTimer.start();</span>
        }
<span class="nc bnc" id="L2964" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4895)) {</span>
            // Stop and highlight the timer if it reaches the time limit.
<span class="nc" id="L2966">            getTheme().resolveAttribute(R.attr.maxTimerColor, typedValue, true);</span>
        }
<span class="nc" id="L2968">        final int limit = mCurrentCard.timeLimit();</span>
<span class="nc bnc" id="L2969" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4896)) {</span>
<span class="nc" id="L2970">            mCardTimer.setOnChronometerTickListener(chronometer -&gt; {</span>
<span class="nc" id="L2971">                long elapsed = SystemClock.elapsedRealtime() - chronometer.getBase();</span>
<span class="nc bnc" id="L2972" title="All 2 branches missed.">                if (elapsed &gt;= limit) {</span>
<span class="nc" id="L2973">                    chronometer.setTextColor(typedValue.data);</span>
<span class="nc" id="L2974">                    chronometer.stop();</span>
                }
<span class="nc" id="L2976">            });</span>
        }
<span class="nc" id="L2978">    }</span>

    protected void displayCardQuestion() {
<span class="nc bnc" id="L2981" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4897)) {</span>
<span class="nc" id="L2982">            displayCardQuestion(false);</span>
        }
<span class="nc bnc" id="L2984" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4898)) {</span>
            // js api initialisation / reset
<span class="nc" id="L2986">            jsApiInit();</span>
        }
<span class="nc" id="L2988">    }</span>

    /**
     * String, as it will be displayed in the web viewer. Sound/video removed, image escaped...
     *     Or warning if required
     */
    private String displayString(boolean reload) {
<span class="nc bnc" id="L2995" title="All 2 branches missed.">        if (mCurrentCard.isEmpty()) {</span>
<span class="nc" id="L2996">            return getResources().getString(R.string.empty_card_warning);</span>
        } else {
<span class="nc" id="L2998">            String question = mCurrentCard.q(reload);</span>
<span class="nc bnc" id="L2999" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4899)) {</span>
<span class="nc" id="L3000">                question = getCol().getMedia().escapeImages(question);</span>
            }
<span class="nc bnc" id="L3002" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4900)) {</span>
<span class="nc" id="L3003">                question = typeAnsQuestionFilter(question);</span>
            }
<span class="nc bnc" id="L3005" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(4901)) {</span>
<span class="nc" id="L3006">                Timber.v(&quot;question: '%s'&quot;, question);</span>
            }
<span class="nc" id="L3008">            return CardAppearance.enrichWithQADiv(question, false);</span>
        }
    }

    protected void displayCardQuestion(boolean reload) {
<span class="nc bnc" id="L3013" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4902)) {</span>
<span class="nc" id="L3014">            Timber.d(&quot;displayCardQuestion()&quot;);</span>
        }
<span class="nc bnc" id="L3016" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4903)) {</span>
<span class="nc" id="L3017">            sDisplayAnswer = false;</span>
        }
<span class="nc bnc" id="L3019" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4904)) {</span>
<span class="nc" id="L3020">            setInterface();</span>
        }
<span class="nc" id="L3022">        String displayString = displayString(reload);</span>
<span class="nc bnc" id="L3023" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4908)) {</span>
<span class="nc bnc" id="L3024" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4905) ? (!mCurrentCard.isEmpty() || typeAnswer()) : (!mCurrentCard.isEmpty() &amp;&amp; typeAnswer()))) {</span>
<span class="nc bnc" id="L3025" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4907)) {</span>
                    // Show text entry based on if the user wants to write the answer
<span class="nc" id="L3027">                    mAnswerField.setVisibility(View.VISIBLE);</span>
                }
            } else {
<span class="nc bnc" id="L3030" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4906)) {</span>
<span class="nc" id="L3031">                    mAnswerField.setVisibility(View.GONE);</span>
                }
            }
        }
<span class="nc bnc" id="L3035" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4909)) {</span>
<span class="nc" id="L3036">            updateCard(displayString);</span>
        }
<span class="nc bnc" id="L3038" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4910)) {</span>
<span class="nc" id="L3039">            hideEaseButtons();</span>
        }
<span class="nc bnc" id="L3041" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4917)) {</span>
            // Check if it should use the general 'Timeout settings' or the ones specific to this deck
<span class="nc bnc" id="L3043" title="All 2 branches missed.">            if (mOptUseGeneralTimerSettings) {</span>
<span class="nc bnc" id="L3044" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4914)) {</span>
<span class="nc" id="L3045">                    mUseTimer = mPrefUseTimer;</span>
                }
<span class="nc bnc" id="L3047" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4915)) {</span>
<span class="nc" id="L3048">                    mWaitAnswerSecond = mPrefWaitAnswerSecond;</span>
                }
<span class="nc bnc" id="L3050" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4916)) {</span>
<span class="nc" id="L3051">                    mWaitQuestionSecond = mPrefWaitQuestionSecond;</span>
                }
            } else {
<span class="nc bnc" id="L3054" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4911)) {</span>
<span class="nc" id="L3055">                    mUseTimer = mOptUseTimer;</span>
                }
<span class="nc bnc" id="L3057" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4912)) {</span>
<span class="nc" id="L3058">                    mWaitAnswerSecond = mOptWaitAnswerSecond;</span>
                }
<span class="nc bnc" id="L3060" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4913)) {</span>
<span class="nc" id="L3061">                    mWaitQuestionSecond = mOptWaitQuestionSecond;</span>
                }
            }
        }
<span class="nc bnc" id="L3065" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4935)) {</span>
            // If the user wants to show the answer automatically
<span class="nc bnc" id="L3067" title="All 2 branches missed.">            if (mUseTimer) {</span>
<span class="nc bnc" id="L3068" title="All 48 branches missed.">                long delay = (ListenerUtil.mutListener.listen(4925) ? ((ListenerUtil.mutListener.listen(4921) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4920) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4919) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4918) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000))))) % mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4924) ? ((ListenerUtil.mutListener.listen(4921) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4920) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4919) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4918) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000))))) / mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4923) ? ((ListenerUtil.mutListener.listen(4921) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4920) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4919) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4918) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000))))) * mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4922) ? ((ListenerUtil.mutListener.listen(4921) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4920) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4919) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4918) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000))))) - mUseTimerDynamicMS) : ((ListenerUtil.mutListener.listen(4921) ? (mWaitAnswerSecond % 1000) : (ListenerUtil.mutListener.listen(4920) ? (mWaitAnswerSecond / 1000) : (ListenerUtil.mutListener.listen(4919) ? (mWaitAnswerSecond - 1000) : (ListenerUtil.mutListener.listen(4918) ? (mWaitAnswerSecond + 1000) : (mWaitAnswerSecond * 1000))))) + mUseTimerDynamicMS)))));</span>
<span class="nc bnc" id="L3069" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4934)) {</span>
<span class="nc bnc" id="L3070" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(4930) ? (delay &gt;= 0) : (ListenerUtil.mutListener.listen(4929) ? (delay &lt;= 0) : (ListenerUtil.mutListener.listen(4928) ? (delay &lt; 0) : (ListenerUtil.mutListener.listen(4927) ? (delay != 0) : (ListenerUtil.mutListener.listen(4926) ? (delay == 0) : (delay &gt; 0))))))) {</span>
<span class="nc bnc" id="L3071" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4931)) {</span>
<span class="nc" id="L3072">                            mTimeoutHandler.removeCallbacks(mShowAnswerTask);</span>
                        }
<span class="nc bnc" id="L3074" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4933)) {</span>
<span class="nc bnc" id="L3075" title="All 2 branches missed.">                            if (!mSpeakText) {</span>
<span class="nc bnc" id="L3076" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4932)) {</span>
<span class="nc" id="L3077">                                    mTimeoutHandler.postDelayed(mShowAnswerTask, delay);</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L3085" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4936)) {</span>
<span class="nc" id="L3086">            Timber.i(&quot;AbstractFlashcardViewer:: Question successfully shown for card id %d&quot;, mCurrentCard.getId());</span>
        }
<span class="nc" id="L3088">    }</span>

    /**
     * Clean up the correct answer text, so it can be used for the comparison with the typed text
     *
     * @param answer The content of the field the text typed by the user is compared to.
     * @return The correct answer text, with actual HTML and media references removed, and HTML entities unescaped.
     */
    protected String cleanCorrectAnswer(String answer) {
<span class="nc" id="L3097">        return TypedAnswer.cleanCorrectAnswer(answer);</span>
    }

    /**
     * Clean up the typed answer text, so it can be used for the comparison with the correct answer
     *
     * @param answer The answer text typed by the user.
     * @return The typed answer text, cleaned up.
     */
    protected String cleanTypedAnswer(String answer) {
<span class="nc bnc" id="L3107" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4938)) {</span>
<span class="nc bnc" id="L3108" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(4937) ? (answer == null &amp;&amp; &quot;&quot;.equals(answer)) : (answer == null || &quot;&quot;.equals(answer)))) {</span>
<span class="nc" id="L3109">                return &quot;&quot;;</span>
            }
        }
<span class="nc" id="L3112">        return Utils.nfcNormalized(answer.trim());</span>
    }

    protected void displayCardAnswer() {
<span class="nc bnc" id="L3116" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4939)) {</span>
            // #7294 Required in case the animation end action does not fire:
<span class="nc" id="L3118">            actualHideEaseButtons();</span>
        }
<span class="nc bnc" id="L3120" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4940)) {</span>
<span class="nc" id="L3121">            Timber.d(&quot;displayCardAnswer()&quot;);</span>
        }
<span class="nc bnc" id="L3123" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4941)) {</span>
<span class="nc" id="L3124">            mMissingImageHandler.onCardSideChange();</span>
        }
<span class="nc bnc" id="L3126" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4942)) {</span>
            // prevent answering (by e.g. gestures) before card is loaded
<span class="nc bnc" id="L3128" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc" id="L3129">                return;</span>
            }
        }
<span class="nc bnc" id="L3132" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4944)) {</span>
            // but sometimes failed to do so (e.g. if an OnKeyListener is attached).
<span class="nc bnc" id="L3134" title="All 2 branches missed.">            if (typeAnswer()) {</span>
<span class="nc" id="L3135">                InputMethodManager inputMethodManager = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);</span>
<span class="nc bnc" id="L3136" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4943)) {</span>
<span class="nc" id="L3137">                    inputMethodManager.hideSoftInputFromWindow(mAnswerField.getWindowToken(), 0);</span>
                }
            }
        }
<span class="nc bnc" id="L3141" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4945)) {</span>
<span class="nc" id="L3142">            sDisplayAnswer = true;</span>
        }
<span class="nc" id="L3144">        String answer = mCurrentCard.a();</span>
<span class="nc bnc" id="L3145" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4946)) {</span>
<span class="nc" id="L3146">            mSoundPlayer.stopSounds();</span>
        }
<span class="nc bnc" id="L3148" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4947)) {</span>
<span class="nc" id="L3149">            answer = getCol().getMedia().escapeImages(answer);</span>
        }
<span class="nc bnc" id="L3151" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4948)) {</span>
<span class="nc" id="L3152">            mAnswerField.setVisibility(View.GONE);</span>
        }
        // Clean up the user answer and the correct answer
        String userAnswer;
<span class="nc bnc" id="L3156" title="All 2 branches missed.">        if (mUseInputTag) {</span>
<span class="nc" id="L3157">            userAnswer = cleanTypedAnswer(mTypeInput);</span>
        } else {
<span class="nc" id="L3159">            userAnswer = cleanTypedAnswer(mAnswerField.getText().toString());</span>
        }
<span class="nc" id="L3161">        String correctAnswer = cleanCorrectAnswer(mTypeCorrect);</span>
<span class="nc bnc" id="L3162" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4949)) {</span>
<span class="nc" id="L3163">            Timber.d(&quot;correct answer = %s&quot;, correctAnswer);</span>
        }
<span class="nc bnc" id="L3165" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4950)) {</span>
<span class="nc" id="L3166">            Timber.d(&quot;user answer = %s&quot;, userAnswer);</span>
        }
<span class="nc bnc" id="L3168" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4951)) {</span>
<span class="nc" id="L3169">            answer = typeAnsAnswerFilter(answer, userAnswer, correctAnswer);</span>
        }
<span class="nc bnc" id="L3171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4952)) {</span>
<span class="nc" id="L3172">            mIsSelecting = false;</span>
        }
<span class="nc bnc" id="L3174" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4953)) {</span>
<span class="nc" id="L3175">            updateCard(CardAppearance.enrichWithQADiv(answer, true));</span>
        }
<span class="nc bnc" id="L3177" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4954)) {</span>
<span class="nc" id="L3178">            displayAnswerBottomBar();</span>
        }
<span class="nc bnc" id="L3180" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4972)) {</span>
            // If the user wants to show the next question automatically
<span class="nc bnc" id="L3182" title="All 2 branches missed.">            if (mUseTimer) {</span>
<span class="nc bnc" id="L3183" title="All 48 branches missed.">                long delay = (ListenerUtil.mutListener.listen(4962) ? ((ListenerUtil.mutListener.listen(4958) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4957) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4956) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4955) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000))))) % mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4961) ? ((ListenerUtil.mutListener.listen(4958) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4957) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4956) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4955) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000))))) / mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4960) ? ((ListenerUtil.mutListener.listen(4958) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4957) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4956) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4955) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000))))) * mUseTimerDynamicMS) : (ListenerUtil.mutListener.listen(4959) ? ((ListenerUtil.mutListener.listen(4958) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4957) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4956) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4955) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000))))) - mUseTimerDynamicMS) : ((ListenerUtil.mutListener.listen(4958) ? (mWaitQuestionSecond % 1000) : (ListenerUtil.mutListener.listen(4957) ? (mWaitQuestionSecond / 1000) : (ListenerUtil.mutListener.listen(4956) ? (mWaitQuestionSecond - 1000) : (ListenerUtil.mutListener.listen(4955) ? (mWaitQuestionSecond + 1000) : (mWaitQuestionSecond * 1000))))) + mUseTimerDynamicMS)))));</span>
<span class="nc bnc" id="L3184" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4971)) {</span>
<span class="nc bnc" id="L3185" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(4967) ? (delay &gt;= 0) : (ListenerUtil.mutListener.listen(4966) ? (delay &lt;= 0) : (ListenerUtil.mutListener.listen(4965) ? (delay &lt; 0) : (ListenerUtil.mutListener.listen(4964) ? (delay != 0) : (ListenerUtil.mutListener.listen(4963) ? (delay == 0) : (delay &gt; 0))))))) {</span>
<span class="nc bnc" id="L3186" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4968)) {</span>
<span class="nc" id="L3187">                            mTimeoutHandler.removeCallbacks(mShowQuestionTask);</span>
                        }
<span class="nc bnc" id="L3189" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4970)) {</span>
<span class="nc bnc" id="L3190" title="All 2 branches missed.">                            if (!mSpeakText) {</span>
<span class="nc bnc" id="L3191" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(4969)) {</span>
<span class="nc" id="L3192">                                    mTimeoutHandler.postDelayed(mShowQuestionTask, delay);</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L3200">    }</span>

    /**
     * Scroll the currently shown flashcard vertically
     *
     * @param dy amount to be scrolled
     */
    public void scrollCurrentCardBy(int dy) {
<span class="nc bnc" id="L3208" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4973)) {</span>
<span class="nc" id="L3209">            processCardAction(cardWebView -&gt; {</span>
<span class="nc bnc" id="L3210" title="All 4 branches missed.">                if (dy != 0 &amp;&amp; cardWebView.canScrollVertically(dy)) {</span>
<span class="nc" id="L3211">                    cardWebView.scrollBy(0, dy);</span>
                }
<span class="nc" id="L3213">            });</span>
        }
<span class="nc" id="L3215">    }</span>

    /**
     * Tap onto the currently shown flashcard at position x and y
     *
     * @param x horizontal position of the event
     * @param y vertical position of the event
     */
    public void tapOnCurrentCard(int x, int y) {
        // assemble suitable ACTION_DOWN and ACTION_UP events and forward them to the card's handler
<span class="nc" id="L3225">        MotionEvent eDown = MotionEvent.obtain(SystemClock.uptimeMillis(), SystemClock.uptimeMillis(), MotionEvent.ACTION_DOWN, x, y, 1, 1, 0, 1, 1, 0, 0);</span>
<span class="nc bnc" id="L3226" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4974)) {</span>
<span class="nc" id="L3227">            processCardAction(cardWebView -&gt; cardWebView.dispatchTouchEvent(eDown));</span>
        }
<span class="nc" id="L3229">        MotionEvent eUp = MotionEvent.obtain(eDown.getDownTime(), SystemClock.uptimeMillis(), MotionEvent.ACTION_UP, x, y, 1, 1, 0, 1, 1, 0, 0);</span>
<span class="nc bnc" id="L3230" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4975)) {</span>
<span class="nc" id="L3231">            processCardAction(cardWebView -&gt; cardWebView.dispatchTouchEvent(eUp));</span>
        }
<span class="nc" id="L3233">    }</span>

    /**
     * getAnswerFormat returns the answer part of this card's template as entered by user, without any parsing
     */
    public String getAnswerFormat() {
<span class="nc" id="L3239">        Model model = mCurrentCard.model();</span>
        JSONObject template;
<span class="nc bnc" id="L3241" title="All 2 branches missed.">        if (model.isStd()) {</span>
<span class="nc" id="L3242">            template = model.getJSONArray(&quot;tmpls&quot;).getJSONObject(mCurrentCard.getOrd());</span>
        } else {
<span class="nc" id="L3244">            template = model.getJSONArray(&quot;tmpls&quot;).getJSONObject(0);</span>
        }
<span class="nc" id="L3246">        return template.getString(&quot;afmt&quot;);</span>
    }

    private void addAnswerSounds(String answer) {
<span class="nc bnc" id="L3250" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4978)) {</span>
            // additionally, this condition reduces computation time
<span class="nc bnc" id="L3252" title="All 2 branches missed.">            if (!mAnswerSoundsAdded) {</span>
<span class="nc" id="L3253">                String answerSoundSource = removeFrontSideAudio(answer);</span>
<span class="nc bnc" id="L3254" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4976)) {</span>
<span class="nc" id="L3255">                    mSoundPlayer.addSounds(mBaseUrl, answerSoundSource, SoundSide.ANSWER);</span>
                }
<span class="nc bnc" id="L3257" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4977)) {</span>
<span class="nc" id="L3258">                    mAnswerSoundsAdded = true;</span>
                }
            }
        }
<span class="nc" id="L3262">    }</span>

    protected boolean isInNightMode() {
<span class="nc" id="L3265">        return mCardAppearance.isNightMode();</span>
    }

    private void updateCard(final String newContent) {
<span class="nc bnc" id="L3269" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4979)) {</span>
<span class="nc" id="L3270">            Timber.d(&quot;updateCard()&quot;);</span>
        }
<span class="nc bnc" id="L3272" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4980)) {</span>
<span class="nc" id="L3273">            mUseTimerDynamicMS = 0;</span>
        }
<span class="nc bnc" id="L3275" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4982)) {</span>
            // Add CSS for font color and font size
<span class="nc bnc" id="L3277" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc bnc" id="L3278" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4981)) {</span>
<span class="nc" id="L3279">                    processCardAction(cardWebView -&gt; cardWebView.getSettings().setDefaultFontSize(calculateDynamicFontSize(newContent)));</span>
                }
            }
        }
<span class="nc bnc" id="L3283" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4991)) {</span>
<span class="nc bnc" id="L3284" title="All 2 branches missed.">            if (sDisplayAnswer) {</span>
<span class="nc bnc" id="L3285" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4990)) {</span>
<span class="nc" id="L3286">                    addAnswerSounds(newContent);</span>
                }
            } else {
<span class="nc bnc" id="L3289" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4983)) {</span>
                    // leaving the card (such as when edited)
<span class="nc" id="L3291">                    mSoundPlayer.resetSounds();</span>
                }
<span class="nc bnc" id="L3293" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4984)) {</span>
<span class="nc" id="L3294">                    mAnswerSoundsAdded = false;</span>
                }
<span class="nc bnc" id="L3296" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4985)) {</span>
<span class="nc" id="L3297">                    mSoundPlayer.addSounds(mBaseUrl, newContent, SoundSide.QUESTION);</span>
                }
<span class="nc bnc" id="L3299" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4989)) {</span>
<span class="nc bnc" id="L3300" title="All 26 branches missed.">                    if ((ListenerUtil.mutListener.listen(4987) ? ((ListenerUtil.mutListener.listen(4986) ? (mUseTimer || !mAnswerSoundsAdded) : (mUseTimer &amp;&amp; !mAnswerSoundsAdded)) || getConfigForCurrentCard().optBoolean(&quot;autoplay&quot;, false)) : ((ListenerUtil.mutListener.listen(4986) ? (mUseTimer || !mAnswerSoundsAdded) : (mUseTimer &amp;&amp; !mAnswerSoundsAdded)) &amp;&amp; getConfigForCurrentCard().optBoolean(&quot;autoplay&quot;, false)))) {</span>
<span class="nc bnc" id="L3301" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(4988)) {</span>
<span class="nc" id="L3302">                            addAnswerSounds(mCurrentCard.a());</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L3308">        String content = Sound.expandSounds(mBaseUrl, newContent);</span>
<span class="nc bnc" id="L3309" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4992)) {</span>
<span class="nc" id="L3310">            content = CardAppearance.fixBoldStyle(content);</span>
        }
<span class="nc bnc" id="L3312" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4993)) {</span>
<span class="nc" id="L3313">            Timber.v(&quot;content card = \n %s&quot;, content);</span>
        }
<span class="nc" id="L3315">        String style = mCardAppearance.getStyle();</span>
<span class="nc bnc" id="L3316" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(4994)) {</span>
<span class="nc" id="L3317">            Timber.v(&quot;::style:: / %s&quot;, style);</span>
        }
        // CSS class for card-specific styling
<span class="nc bnc" id="L3320" title="All 8 branches missed.">        String cardClass = mCardAppearance.getCardClass((ListenerUtil.mutListener.listen(4998) ? (mCurrentCard.getOrd() % 1) : (ListenerUtil.mutListener.listen(4997) ? (mCurrentCard.getOrd() / 1) : (ListenerUtil.mutListener.listen(4996) ? (mCurrentCard.getOrd() * 1) : (ListenerUtil.mutListener.listen(4995) ? (mCurrentCard.getOrd() - 1) : (mCurrentCard.getOrd() + 1))))), Themes.getCurrentTheme(this));</span>
<span class="nc bnc" id="L3321" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5000)) {</span>
<span class="nc bnc" id="L3322" title="All 2 branches missed.">            if (MathJax.textContainsMathjax(content)) {</span>
<span class="nc bnc" id="L3323" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(4999)) {</span>
<span class="nc" id="L3324">                    cardClass += &quot; mathjax-needs-to-render&quot;;</span>
                }
            }
        }
<span class="nc bnc" id="L3328" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5003)) {</span>
<span class="nc bnc" id="L3329" title="All 2 branches missed.">            if (isInNightMode()) {</span>
<span class="nc bnc" id="L3330" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5002)) {</span>
<span class="nc bnc" id="L3331" title="All 2 branches missed.">                    if (!mCardAppearance.hasUserDefinedNightMode(mCurrentCard)) {</span>
<span class="nc bnc" id="L3332" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5001)) {</span>
<span class="nc" id="L3333">                            content = HtmlColors.invertColors(content);</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L3339" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5004)) {</span>
<span class="nc" id="L3340">            mCardContent = mCardTemplate.render(content, style, cardClass);</span>
        }
<span class="nc bnc" id="L3342" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5005)) {</span>
<span class="nc" id="L3343">            Timber.d(&quot;base url = %s&quot;, mBaseUrl);</span>
        }
<span class="nc bnc" id="L3345" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5008)) {</span>
<span class="nc bnc" id="L3346" title="All 2 branches missed.">            if (AnkiDroidApp.getSharedPrefs(this).getBoolean(&quot;html_javascript_debugging&quot;, false)) {</span>
                try {
<span class="nc" id="L3348">                    try (FileOutputStream f = new FileOutputStream(new File(CollectionHelper.getCurrentAnkiDroidDirectory(this), &quot;card.html&quot;))) {</span>
<span class="nc bnc" id="L3349" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5007)) {</span>
<span class="nc" id="L3350">                            f.write(mCardContent.getBytes());</span>
                        }
                    }
<span class="nc" id="L3353">                } catch (IOException e) {</span>
<span class="nc bnc" id="L3354" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5006)) {</span>
<span class="nc" id="L3355">                        Timber.d(e, &quot;failed to save card&quot;);</span>
                    }
<span class="nc" id="L3357">                }</span>
            }
        }
<span class="nc bnc" id="L3360" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5009)) {</span>
<span class="nc" id="L3361">            fillFlashcard();</span>
        }
<span class="nc bnc" id="L3363" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5010)) {</span>
            // Play sounds if appropriate
<span class="nc" id="L3365">            playSounds(false);</span>
        }
<span class="nc" id="L3367">    }</span>

    /**
     * Plays sounds (or TTS, if configured) for currently shown side of card.
     *
     * @param doAudioReplay indicates an anki desktop-like replay call is desired, whose behavior is identical to
     *            pressing the keyboard shortcut R on the desktop
     */
    protected void playSounds(boolean doAudioReplay) {
<span class="nc" id="L3376">        boolean replayQuestion = getConfigForCurrentCard().optBoolean(&quot;replayq&quot;, true);</span>
<span class="nc bnc" id="L3377" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5035)) {</span>
<span class="nc bnc" id="L3378" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5011) ? (getConfigForCurrentCard().optBoolean(&quot;autoplay&quot;, false) &amp;&amp; doAudioReplay) : (getConfigForCurrentCard().optBoolean(&quot;autoplay&quot;, false) || doAudioReplay))) {</span>
                // Use TTS if TTS preference enabled and no other sound source
<span class="nc bnc" id="L3380" title="All 74 branches missed.">                boolean useTTS = (ListenerUtil.mutListener.listen(5015) ? ((ListenerUtil.mutListener.listen(5013) ? (mSpeakText || !((ListenerUtil.mutListener.listen(5012) ? (sDisplayAnswer || mSoundPlayer.hasAnswer()) : (sDisplayAnswer &amp;&amp; mSoundPlayer.hasAnswer())))) : (mSpeakText &amp;&amp; !((ListenerUtil.mutListener.listen(5012) ? (sDisplayAnswer || mSoundPlayer.hasAnswer()) : (sDisplayAnswer &amp;&amp; mSoundPlayer.hasAnswer()))))) || !((ListenerUtil.mutListener.listen(5014) ? (!sDisplayAnswer || mSoundPlayer.hasQuestion()) : (!sDisplayAnswer &amp;&amp; mSoundPlayer.hasQuestion())))) : ((ListenerUtil.mutListener.listen(5013) ? (mSpeakText || !((ListenerUtil.mutListener.listen(5012) ? (sDisplayAnswer || mSoundPlayer.hasAnswer()) : (sDisplayAnswer &amp;&amp; mSoundPlayer.hasAnswer())))) : (mSpeakText &amp;&amp; !((ListenerUtil.mutListener.listen(5012) ? (sDisplayAnswer || mSoundPlayer.hasAnswer()) : (sDisplayAnswer &amp;&amp; mSoundPlayer.hasAnswer()))))) &amp;&amp; !((ListenerUtil.mutListener.listen(5014) ? (!sDisplayAnswer || mSoundPlayer.hasQuestion()) : (!sDisplayAnswer &amp;&amp; mSoundPlayer.hasQuestion())))));</span>
<span class="nc bnc" id="L3381" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5034)) {</span>
                    // We need to play the sounds from the proper side of the card
<span class="nc bnc" id="L3383" title="All 2 branches missed.">                    if (!useTTS) {</span>
<span class="nc bnc" id="L3384" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5033)) {</span>
                            // Text to speech not in effect here
<span class="nc bnc" id="L3386" title="All 26 branches missed.">                            if ((ListenerUtil.mutListener.listen(5025) ? ((ListenerUtil.mutListener.listen(5024) ? (doAudioReplay || replayQuestion) : (doAudioReplay &amp;&amp; replayQuestion)) || sDisplayAnswer) : ((ListenerUtil.mutListener.listen(5024) ? (doAudioReplay || replayQuestion) : (doAudioReplay &amp;&amp; replayQuestion)) &amp;&amp; sDisplayAnswer))) {</span>
<span class="nc bnc" id="L3387" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5032)) {</span>
                                    // only when all of the above are true will question be played with answer, to match desktop
<span class="nc" id="L3389">                                    playSounds(SoundSide.QUESTION_AND_ANSWER);</span>
                                }
<span class="nc bnc" id="L3391" title="All 2 branches missed.">                            } else if (sDisplayAnswer) {</span>
<span class="nc bnc" id="L3392" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5029)) {</span>
<span class="nc" id="L3393">                                    playSounds(SoundSide.ANSWER);</span>
                                }
<span class="nc bnc" id="L3395" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5031)) {</span>
<span class="nc bnc" id="L3396" title="All 2 branches missed.">                                    if (mUseTimer) {</span>
<span class="nc bnc" id="L3397" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5030)) {</span>
<span class="nc" id="L3398">                                            mUseTimerDynamicMS = mSoundPlayer.getSoundsLength(SoundSide.ANSWER);</span>
                                        }
                                    }
                                }
                            } else {
<span class="nc bnc" id="L3403" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5026)) {</span>
                                    // question is displayed
<span class="nc" id="L3405">                                    playSounds(SoundSide.QUESTION);</span>
                                }
<span class="nc bnc" id="L3407" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5028)) {</span>
                                    // If the user wants to show the answer automatically
<span class="nc bnc" id="L3409" title="All 2 branches missed.">                                    if (mUseTimer) {</span>
<span class="nc bnc" id="L3410" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5027)) {</span>
<span class="nc" id="L3411">                                            mUseTimerDynamicMS = mSoundPlayer.getSoundsLength(SoundSide.QUESTION_AND_ANSWER);</span>
                                        }
                                    }
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L3418" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5023)) {</span>
                            // If the question is displayed or if the question should be replayed, read the question
<span class="nc bnc" id="L3420" title="All 2 branches missed.">                            if (mTtsInitialized) {</span>
<span class="nc bnc" id="L3421" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5020)) {</span>
<span class="nc bnc" id="L3422" title="All 26 branches missed.">                                    if ((ListenerUtil.mutListener.listen(5018) ? (!sDisplayAnswer &amp;&amp; (ListenerUtil.mutListener.listen(5017) ? (doAudioReplay || replayQuestion) : (doAudioReplay &amp;&amp; replayQuestion))) : (!sDisplayAnswer || (ListenerUtil.mutListener.listen(5017) ? (doAudioReplay || replayQuestion) : (doAudioReplay &amp;&amp; replayQuestion))))) {</span>
<span class="nc bnc" id="L3423" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5019)) {</span>
<span class="nc" id="L3424">                                            readCardText(mCurrentCard, SoundSide.QUESTION);</span>
                                        }
                                    }
                                }
<span class="nc bnc" id="L3428" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5022)) {</span>
<span class="nc bnc" id="L3429" title="All 2 branches missed.">                                    if (sDisplayAnswer) {</span>
<span class="nc bnc" id="L3430" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5021)) {</span>
<span class="nc" id="L3431">                                            readCardText(mCurrentCard, SoundSide.ANSWER);</span>
                                        }
                                    }
                                }
                            } else {
<span class="nc bnc" id="L3436" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5016)) {</span>
<span class="nc" id="L3437">                                    mReplayOnTtsInit = true;</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L3445">    }</span>

    private void playSounds(SoundSide questionAndAnswer) {
<span class="nc bnc" id="L3448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5036)) {</span>
<span class="nc" id="L3449">            mSoundPlayer.playSounds(questionAndAnswer, getSoundErrorListener());</span>
        }
<span class="nc" id="L3451">    }</span>

    private Sound.OnErrorListener getSoundErrorListener() {
<span class="nc" id="L3454">        return (mp, what, extra, path) -&gt; {</span>
<span class="nc" id="L3455">            Timber.w(&quot;Media Error: (%d, %d). Calling OnCompletionListener&quot;, what, extra);</span>
            try {
<span class="nc" id="L3457">                File file = new File(path);</span>
<span class="nc bnc" id="L3458" title="All 2 branches missed.">                if (!file.exists()) {</span>
<span class="nc" id="L3459">                    mMissingImageHandler.processMissingSound(file, this::displayCouldNotFindMediaSnackbar);</span>
                }
<span class="nc" id="L3461">            } catch (Exception e) {</span>
<span class="nc" id="L3462">                return false;</span>
<span class="nc" id="L3463">            }</span>
<span class="nc" id="L3464">            return false;</span>
        };
    }

    /**
     * Reads the text (using TTS) for the given side of a card.
     *
     * @param card     The card to play TTS for
     * @param cardSide The side of the current card to play TTS for
     */
    private void readCardText(final Card card, final SoundSide cardSide) {
        final String cardSideContent;
<span class="nc bnc" id="L3476" title="All 2 branches missed.">        if (SoundSide.QUESTION == cardSide) {</span>
<span class="nc" id="L3477">            cardSideContent = card.q(true);</span>
<span class="nc bnc" id="L3478" title="All 2 branches missed.">        } else if (SoundSide.ANSWER == cardSide) {</span>
<span class="nc" id="L3479">            cardSideContent = card.getPureAnswer();</span>
        } else {
<span class="nc bnc" id="L3481" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5037)) {</span>
<span class="nc" id="L3482">                Timber.w(&quot;Unrecognised cardSide&quot;);</span>
            }
<span class="nc" id="L3484">            return;</span>
        }
<span class="nc" id="L3486">        String clozeReplacement = this.getString(R.string.reviewer_tts_cloze_spoken_replacement);</span>
<span class="nc bnc" id="L3487" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5038)) {</span>
<span class="nc" id="L3488">            ReadText.readCardSide(cardSide, cardSideContent, getDeckIdForCard(card), card.getOrd(), clozeReplacement);</span>
        }
<span class="nc" id="L3490">    }</span>

    /**
     * Shows the dialogue for selecting TTS for the current card and cardside.
     */
    protected void showSelectTtsDialogue() {
<span class="nc bnc" id="L3496" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5042)) {</span>
<span class="nc bnc" id="L3497" title="All 2 branches missed.">            if (mTtsInitialized) {</span>
<span class="nc bnc" id="L3498" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5041)) {</span>
<span class="nc bnc" id="L3499" title="All 2 branches missed.">                    if (!sDisplayAnswer) {</span>
<span class="nc bnc" id="L3500" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5040)) {</span>
<span class="nc" id="L3501">                            ReadText.selectTts(getTextForTts(mCurrentCard.q(true)), getDeckIdForCard(mCurrentCard), mCurrentCard.getOrd(), SoundSide.QUESTION);</span>
                        }
                    } else {
<span class="nc bnc" id="L3504" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5039)) {</span>
<span class="nc" id="L3505">                            ReadText.selectTts(getTextForTts(mCurrentCard.getPureAnswer()), getDeckIdForCard(mCurrentCard), mCurrentCard.getOrd(), SoundSide.ANSWER);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L3511">    }</span>

    private String getTextForTts(String text) {
<span class="nc" id="L3514">        String clozeReplacement = this.getString(R.string.reviewer_tts_cloze_spoken_replacement);</span>
<span class="nc" id="L3515">        String clozeReplaced = text.replace(TemplateFilters.CLOZE_DELETION_REPLACEMENT, clozeReplacement);</span>
<span class="nc" id="L3516">        return Utils.stripHTML(clozeReplaced);</span>
    }

    /**
     * Returns the configuration for the current {@link Card}.
     *
     * @return The configuration for the current {@link Card}
     */
    private DeckConfig getConfigForCurrentCard() {
<span class="nc" id="L3525">        return getCol().getDecks().confForDid(getDeckIdForCard(mCurrentCard));</span>
    }

    /**
     * Returns the deck ID of the given {@link Card}.
     *
     * @param card The {@link Card} to get the deck ID
     * @return The deck ID of the {@link Card}
     */
    private static long getDeckIdForCard(final Card card) {
        // else use the direct deck ID (in case of a 'normal' deck.
<span class="nc bnc" id="L3536" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(5047) ? (card.getODid() &gt;= 0) : (ListenerUtil.mutListener.listen(5046) ? (card.getODid() &lt;= 0) : (ListenerUtil.mutListener.listen(5045) ? (card.getODid() &gt; 0) : (ListenerUtil.mutListener.listen(5044) ? (card.getODid() &lt; 0) : (ListenerUtil.mutListener.listen(5043) ? (card.getODid() != 0) : (card.getODid() == 0)))))) ? card.getDid() : card.getODid();</span>
    }

    public void fillFlashcard() {
<span class="nc bnc" id="L3540" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5048)) {</span>
<span class="nc" id="L3541">            Timber.d(&quot;fillFlashcard()&quot;);</span>
        }
<span class="nc bnc" id="L3543" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5049)) {</span>
<span class="nc" id="L3544">            Timber.d(&quot;base url = %s&quot;, mBaseUrl);</span>
        }
<span class="nc bnc" id="L3546" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5051)) {</span>
<span class="nc bnc" id="L3547" title="All 2 branches missed.">            if (mCardContent == null) {</span>
<span class="nc bnc" id="L3548" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5050)) {</span>
<span class="nc" id="L3549">                    Timber.w(&quot;fillFlashCard() called with no card content&quot;);</span>
                }
<span class="nc" id="L3551">                return;</span>
            }
        }
<span class="nc" id="L3554">        final String cardContent = mCardContent;</span>
<span class="nc bnc" id="L3555" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5052)) {</span>
<span class="nc" id="L3556">            processCardAction(cardWebView -&gt; loadContentIntoCard(cardWebView, cardContent));</span>
        }
<span class="nc bnc" id="L3558" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5053)) {</span>
<span class="nc" id="L3559">            mGestureDetectorImpl.onFillFlashcard();</span>
        }
<span class="nc bnc" id="L3561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5056)) {</span>
<span class="nc bnc" id="L3562" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5054) ? (mShowTimer || mCardTimer.getVisibility() == View.INVISIBLE) : (mShowTimer &amp;&amp; mCardTimer.getVisibility() == View.INVISIBLE))) {</span>
<span class="nc bnc" id="L3563" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5055)) {</span>
<span class="nc" id="L3564">                    switchTopBarVisibility(View.VISIBLE);</span>
                }
            }
        }
<span class="nc bnc" id="L3568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5058)) {</span>
<span class="nc bnc" id="L3569" title="All 2 branches missed.">            if (!sDisplayAnswer) {</span>
<span class="nc bnc" id="L3570" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5057)) {</span>
<span class="nc" id="L3571">                    updateForNewCard();</span>
                }
            }
        }
<span class="nc" id="L3575">    }</span>

    private void loadContentIntoCard(WebView card, String content) {
<span class="nc bnc" id="L3578" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5061)) {</span>
<span class="nc bnc" id="L3579" title="All 2 branches missed.">            if (card != null) {</span>
<span class="nc bnc" id="L3580" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5059)) {</span>
<span class="nc bnc" id="L3581" title="All 2 branches missed.">                    card.getSettings().setMediaPlaybackRequiresUserGesture(!getConfigForCurrentCard().optBoolean(&quot;autoplay&quot;));</span>
                }
<span class="nc bnc" id="L3583" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5060)) {</span>
<span class="nc" id="L3584">                    card.loadDataWithBaseURL(mViewerUrl, content, &quot;text/html&quot;, &quot;utf-8&quot;, null);</span>
                }
            }
        }
<span class="nc" id="L3588">    }</span>

    public static Card getEditorCard() {
<span class="nc" id="L3591">        return sEditorCard;</span>
    }

    /**
     * @return true if the AnkiDroid preference for writing answer is true and if the Anki Deck CardLayout specifies a
     *         field to query
     */
    private boolean typeAnswer() {
<span class="nc bnc" id="L3599" title="All 10 branches missed.">        return (ListenerUtil.mutListener.listen(5062) ? (!mUseInputTag || null != mTypeCorrect) : (!mUseInputTag &amp;&amp; null != mTypeCorrect));</span>
    }

    private void unblockControls() {
<span class="nc bnc" id="L3603" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5063)) {</span>
<span class="nc" id="L3604">            mControlBlocked = ControlBlock.UNBLOCKED;</span>
        }
<span class="nc bnc" id="L3606" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5064)) {</span>
<span class="nc" id="L3607">            mCardFrame.setEnabled(true);</span>
        }
<span class="nc bnc" id="L3609" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5065)) {</span>
<span class="nc" id="L3610">            mFlipCardLayout.setEnabled(true);</span>
        }
<span class="nc bnc" id="L3612" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5086)) {</span>
<span class="nc bnc" id="L3613" title="All 5 branches missed.">            switch(mCurrentEase) {</span>
                case EASE_1:
<span class="nc bnc" id="L3615" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5066)) {</span>
<span class="nc" id="L3616">                        mEase1Layout.setClickable(true);</span>
                    }
<span class="nc bnc" id="L3618" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5067)) {</span>
<span class="nc" id="L3619">                        mEase2Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3621" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5068)) {</span>
<span class="nc" id="L3622">                        mEase3Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3624" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5069)) {</span>
<span class="nc" id="L3625">                        mEase4Layout.setEnabled(true);</span>
                    }
                    break;
                case EASE_2:
<span class="nc bnc" id="L3629" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5070)) {</span>
<span class="nc" id="L3630">                        mEase1Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3632" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5071)) {</span>
<span class="nc" id="L3633">                        mEase2Layout.setClickable(true);</span>
                    }
<span class="nc bnc" id="L3635" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5072)) {</span>
<span class="nc" id="L3636">                        mEase3Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3638" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5073)) {</span>
<span class="nc" id="L3639">                        mEase4Layout.setEnabled(true);</span>
                    }
                    break;
                case EASE_3:
<span class="nc bnc" id="L3643" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5074)) {</span>
<span class="nc" id="L3644">                        mEase1Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3646" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5075)) {</span>
<span class="nc" id="L3647">                        mEase2Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3649" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5076)) {</span>
<span class="nc" id="L3650">                        mEase3Layout.setClickable(true);</span>
                    }
<span class="nc bnc" id="L3652" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5077)) {</span>
<span class="nc" id="L3653">                        mEase4Layout.setEnabled(true);</span>
                    }
                    break;
                case EASE_4:
<span class="nc bnc" id="L3657" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5078)) {</span>
<span class="nc" id="L3658">                        mEase1Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3660" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5079)) {</span>
<span class="nc" id="L3661">                        mEase2Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3663" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5080)) {</span>
<span class="nc" id="L3664">                        mEase3Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3666" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5081)) {</span>
<span class="nc" id="L3667">                        mEase4Layout.setClickable(true);</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L3671" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5082)) {</span>
<span class="nc" id="L3672">                        mEase1Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3674" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5083)) {</span>
<span class="nc" id="L3675">                        mEase2Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3677" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5084)) {</span>
<span class="nc" id="L3678">                        mEase3Layout.setEnabled(true);</span>
                    }
<span class="nc bnc" id="L3680" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5085)) {</span>
<span class="nc" id="L3681">                        mEase4Layout.setEnabled(true);</span>
                    }
                    break;
            }
        }
<span class="nc bnc" id="L3686" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5089)) {</span>
<span class="nc bnc" id="L3687" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5087) ? (mPrefWhiteboard || mWhiteboard != null) : (mPrefWhiteboard &amp;&amp; mWhiteboard != null))) {</span>
<span class="nc bnc" id="L3688" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5088)) {</span>
<span class="nc" id="L3689">                    mWhiteboard.setEnabled(true);</span>
                }
            }
        }
<span class="nc bnc" id="L3693" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5091)) {</span>
<span class="nc bnc" id="L3694" title="All 2 branches missed.">            if (typeAnswer()) {</span>
<span class="nc bnc" id="L3695" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5090)) {</span>
<span class="nc" id="L3696">                    mAnswerField.setEnabled(true);</span>
                }
            }
        }
<span class="nc bnc" id="L3700" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5092)) {</span>
<span class="nc" id="L3701">            mTouchLayer.setVisibility(View.VISIBLE);</span>
        }
<span class="nc bnc" id="L3703" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5093)) {</span>
<span class="nc" id="L3704">            mInAnswer = false;</span>
        }
<span class="nc bnc" id="L3706" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5094)) {</span>
<span class="nc" id="L3707">            invalidateOptionsMenu();</span>
        }
<span class="nc" id="L3709">    }</span>

    /**
     * @param quick Whether we expect the control to come back quickly
     */
    @VisibleForTesting
    protected void blockControls(boolean quick) {
<span class="nc bnc" id="L3716" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5097)) {</span>
<span class="nc bnc" id="L3717" title="All 2 branches missed.">            if (quick) {</span>
<span class="nc bnc" id="L3718" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5096)) {</span>
<span class="nc" id="L3719">                    mControlBlocked = ControlBlock.QUICK;</span>
                }
            } else {
<span class="nc bnc" id="L3722" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5095)) {</span>
<span class="nc" id="L3723">                    mControlBlocked = ControlBlock.SLOW;</span>
                }
            }
        }
<span class="nc bnc" id="L3727" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5098)) {</span>
<span class="nc" id="L3728">            mCardFrame.setEnabled(false);</span>
        }
<span class="nc bnc" id="L3730" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5099)) {</span>
<span class="nc" id="L3731">            mFlipCardLayout.setEnabled(false);</span>
        }
<span class="nc bnc" id="L3733" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5100)) {</span>
<span class="nc" id="L3734">            mTouchLayer.setVisibility(View.INVISIBLE);</span>
        }
<span class="nc bnc" id="L3736" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5101)) {</span>
<span class="nc" id="L3737">            mInAnswer = true;</span>
        }
<span class="nc bnc" id="L3739" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5122)) {</span>
<span class="nc bnc" id="L3740" title="All 5 branches missed.">            switch(mCurrentEase) {</span>
                case EASE_1:
<span class="nc bnc" id="L3742" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5102)) {</span>
<span class="nc" id="L3743">                        mEase1Layout.setClickable(false);</span>
                    }
<span class="nc bnc" id="L3745" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5103)) {</span>
<span class="nc" id="L3746">                        mEase2Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3748" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5104)) {</span>
<span class="nc" id="L3749">                        mEase3Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3751" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5105)) {</span>
<span class="nc" id="L3752">                        mEase4Layout.setEnabled(false);</span>
                    }
                    break;
                case EASE_2:
<span class="nc bnc" id="L3756" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5106)) {</span>
<span class="nc" id="L3757">                        mEase1Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3759" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5107)) {</span>
<span class="nc" id="L3760">                        mEase2Layout.setClickable(false);</span>
                    }
<span class="nc bnc" id="L3762" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5108)) {</span>
<span class="nc" id="L3763">                        mEase3Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3765" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5109)) {</span>
<span class="nc" id="L3766">                        mEase4Layout.setEnabled(false);</span>
                    }
                    break;
                case EASE_3:
<span class="nc bnc" id="L3770" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5110)) {</span>
<span class="nc" id="L3771">                        mEase1Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3773" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5111)) {</span>
<span class="nc" id="L3774">                        mEase2Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3776" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5112)) {</span>
<span class="nc" id="L3777">                        mEase3Layout.setClickable(false);</span>
                    }
<span class="nc bnc" id="L3779" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5113)) {</span>
<span class="nc" id="L3780">                        mEase4Layout.setEnabled(false);</span>
                    }
                    break;
                case EASE_4:
<span class="nc bnc" id="L3784" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5114)) {</span>
<span class="nc" id="L3785">                        mEase1Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3787" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5115)) {</span>
<span class="nc" id="L3788">                        mEase2Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3790" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5116)) {</span>
<span class="nc" id="L3791">                        mEase3Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3793" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5117)) {</span>
<span class="nc" id="L3794">                        mEase4Layout.setClickable(false);</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L3798" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5118)) {</span>
<span class="nc" id="L3799">                        mEase1Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3801" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5119)) {</span>
<span class="nc" id="L3802">                        mEase2Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3804" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5120)) {</span>
<span class="nc" id="L3805">                        mEase3Layout.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L3807" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5121)) {</span>
<span class="nc" id="L3808">                        mEase4Layout.setEnabled(false);</span>
                    }
                    break;
            }
        }
<span class="nc bnc" id="L3813" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5125)) {</span>
<span class="nc bnc" id="L3814" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5123) ? (mPrefWhiteboard || mWhiteboard != null) : (mPrefWhiteboard &amp;&amp; mWhiteboard != null))) {</span>
<span class="nc bnc" id="L3815" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5124)) {</span>
<span class="nc" id="L3816">                    mWhiteboard.setEnabled(false);</span>
                }
            }
        }
<span class="nc bnc" id="L3820" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5127)) {</span>
<span class="nc bnc" id="L3821" title="All 2 branches missed.">            if (typeAnswer()) {</span>
<span class="nc bnc" id="L3822" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5126)) {</span>
<span class="nc" id="L3823">                    mAnswerField.setEnabled(false);</span>
                }
            }
        }
<span class="nc bnc" id="L3827" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5128)) {</span>
<span class="nc" id="L3828">            invalidateOptionsMenu();</span>
        }
<span class="nc" id="L3830">    }</span>

    /**
     * Select Text in the webview and automatically sends the selected text to the clipboard. From
     * http://cosmez.blogspot.com/2010/04/webview-emulateshiftheld-on-android.html
     */
    // Tracked separately in Github as #5024
    @SuppressWarnings(&quot;deprecation&quot;)
    private void selectAndCopyText() {
        try {
<span class="nc" id="L3840">            KeyEvent shiftPressEvent = new KeyEvent(0, 0, KeyEvent.ACTION_DOWN, KeyEvent.KEYCODE_SHIFT_LEFT, 0, 0);</span>
<span class="nc bnc" id="L3841" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5129)) {</span>
<span class="nc" id="L3842">                processCardAction(shiftPressEvent::dispatch);</span>
            }
<span class="nc bnc" id="L3844" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5130)) {</span>
<span class="nc" id="L3845">                shiftPressEvent.isShiftPressed();</span>
            }
<span class="nc bnc" id="L3847" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5131)) {</span>
<span class="nc" id="L3848">                mIsSelecting = true;</span>
            }
<span class="nc" id="L3850">        } catch (Exception e) {</span>
<span class="nc" id="L3851">            throw new AssertionError(e);</span>
<span class="nc" id="L3852">        }</span>
<span class="nc" id="L3853">    }</span>

    public boolean executeCommand(@ViewerCommandDef int which) {
<span class="nc bnc" id="L3856" title="All 50 branches missed.">        if ((ListenerUtil.mutListener.listen(5137) ? (isControlBlocked() || (ListenerUtil.mutListener.listen(5136) ? (which &gt;= COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5135) ? (which &lt;= COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5134) ? (which &gt; COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5133) ? (which &lt; COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5132) ? (which == COMMAND_EXIT) : (which != COMMAND_EXIT))))))) : (isControlBlocked() &amp;&amp; (ListenerUtil.mutListener.listen(5136) ? (which &gt;= COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5135) ? (which &lt;= COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5134) ? (which &gt; COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5133) ? (which &lt; COMMAND_EXIT) : (ListenerUtil.mutListener.listen(5132) ? (which == COMMAND_EXIT) : (which != COMMAND_EXIT))))))))) {</span>
<span class="nc" id="L3857">            return false;</span>
        }
<span class="nc bnc" id="L3859" title="All 38 branches missed.">        switch(which) {</span>
            case COMMAND_NOTHING:
<span class="nc" id="L3861">                return true;</span>
            case COMMAND_SHOW_ANSWER:
<span class="nc bnc" id="L3863" title="All 2 branches missed.">                if (sDisplayAnswer) {</span>
<span class="nc" id="L3864">                    return false;</span>
                }
<span class="nc bnc" id="L3866" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5138)) {</span>
<span class="nc" id="L3867">                    displayCardAnswer();</span>
                }
<span class="nc" id="L3869">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_EASE1:
<span class="nc bnc" id="L3871" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5139)) {</span>
<span class="nc" id="L3872">                    flipOrAnswerCard(EASE_1);</span>
                }
<span class="nc" id="L3874">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_EASE2:
<span class="nc bnc" id="L3876" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5140)) {</span>
<span class="nc" id="L3877">                    flipOrAnswerCard(EASE_2);</span>
                }
<span class="nc" id="L3879">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_EASE3:
<span class="nc bnc" id="L3881" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5141)) {</span>
<span class="nc" id="L3882">                    flipOrAnswerCard(EASE_3);</span>
                }
<span class="nc" id="L3884">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_EASE4:
<span class="nc bnc" id="L3886" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5142)) {</span>
<span class="nc" id="L3887">                    flipOrAnswerCard(EASE_4);</span>
                }
<span class="nc" id="L3889">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_RECOMMENDED:
<span class="nc bnc" id="L3891" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5143)) {</span>
<span class="nc" id="L3892">                    flipOrAnswerCard(getRecommendedEase(false));</span>
                }
<span class="nc" id="L3894">                return true;</span>
            case COMMAND_FLIP_OR_ANSWER_BETTER_THAN_RECOMMENDED:
<span class="nc bnc" id="L3896" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5144)) {</span>
<span class="nc" id="L3897">                    flipOrAnswerCard(getRecommendedEase(true));</span>
                }
<span class="nc" id="L3899">                return true;</span>
            case COMMAND_EXIT:
<span class="nc bnc" id="L3901" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5145)) {</span>
<span class="nc" id="L3902">                    closeReviewer(RESULT_DEFAULT, false);</span>
                }
<span class="nc" id="L3904">                return true;</span>
            case COMMAND_UNDO:
<span class="nc bnc" id="L3906" title="All 2 branches missed.">                if (!isUndoAvailable()) {</span>
<span class="nc" id="L3907">                    return false;</span>
                }
<span class="nc bnc" id="L3909" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5146)) {</span>
<span class="nc" id="L3910">                    undo();</span>
                }
<span class="nc" id="L3912">                return true;</span>
            case COMMAND_EDIT:
<span class="nc bnc" id="L3914" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5147)) {</span>
<span class="nc" id="L3915">                    editCard();</span>
                }
<span class="nc" id="L3917">                return true;</span>
            case COMMAND_CARD_INFO:
<span class="nc bnc" id="L3919" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5148)) {</span>
<span class="nc" id="L3920">                    openCardInfo();</span>
                }
<span class="nc" id="L3922">                return true;</span>
            case COMMAND_TAG:
<span class="nc bnc" id="L3924" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5149)) {</span>
<span class="nc" id="L3925">                    showTagsDialog();</span>
                }
<span class="nc" id="L3927">                return true;</span>
            case COMMAND_MARK:
<span class="nc bnc" id="L3929" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5150)) {</span>
<span class="nc" id="L3930">                    onMark(mCurrentCard);</span>
                }
<span class="nc" id="L3932">                return true;</span>
            case COMMAND_LOOKUP:
<span class="nc bnc" id="L3934" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5151)) {</span>
<span class="nc" id="L3935">                    lookUpOrSelectText();</span>
                }
<span class="nc" id="L3937">                return true;</span>
            case COMMAND_BURY_CARD:
<span class="nc bnc" id="L3939" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5152)) {</span>
<span class="nc" id="L3940">                    dismiss(Collection.DismissType.BURY_CARD);</span>
                }
<span class="nc" id="L3942">                return true;</span>
            case COMMAND_BURY_NOTE:
<span class="nc bnc" id="L3944" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5153)) {</span>
<span class="nc" id="L3945">                    dismiss(Collection.DismissType.BURY_NOTE);</span>
                }
<span class="nc" id="L3947">                return true;</span>
            case COMMAND_SUSPEND_CARD:
<span class="nc bnc" id="L3949" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5154)) {</span>
<span class="nc" id="L3950">                    dismiss(Collection.DismissType.SUSPEND_CARD);</span>
                }
<span class="nc" id="L3952">                return true;</span>
            case COMMAND_SUSPEND_NOTE:
<span class="nc bnc" id="L3954" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5155)) {</span>
<span class="nc" id="L3955">                    dismiss(Collection.DismissType.SUSPEND_NOTE);</span>
                }
<span class="nc" id="L3957">                return true;</span>
            case COMMAND_DELETE:
<span class="nc bnc" id="L3959" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5156)) {</span>
<span class="nc" id="L3960">                    showDeleteNoteDialog();</span>
                }
<span class="nc" id="L3962">                return true;</span>
            case COMMAND_PLAY_MEDIA:
<span class="nc bnc" id="L3964" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5157)) {</span>
<span class="nc" id="L3965">                    playSounds(true);</span>
                }
<span class="nc" id="L3967">                return true;</span>
            case COMMAND_TOGGLE_FLAG_RED:
<span class="nc bnc" id="L3969" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5158)) {</span>
<span class="nc" id="L3970">                    toggleFlag(FLAG_RED);</span>
                }
<span class="nc" id="L3972">                return true;</span>
            case COMMAND_TOGGLE_FLAG_ORANGE:
<span class="nc bnc" id="L3974" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5159)) {</span>
<span class="nc" id="L3975">                    toggleFlag(FLAG_ORANGE);</span>
                }
<span class="nc" id="L3977">                return true;</span>
            case COMMAND_TOGGLE_FLAG_GREEN:
<span class="nc bnc" id="L3979" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5160)) {</span>
<span class="nc" id="L3980">                    toggleFlag(FLAG_GREEN);</span>
                }
<span class="nc" id="L3982">                return true;</span>
            case COMMAND_TOGGLE_FLAG_BLUE:
<span class="nc bnc" id="L3984" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5161)) {</span>
<span class="nc" id="L3985">                    toggleFlag(FLAG_BLUE);</span>
                }
<span class="nc" id="L3987">                return true;</span>
            case COMMAND_UNSET_FLAG:
<span class="nc bnc" id="L3989" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5162)) {</span>
<span class="nc" id="L3990">                    onFlag(mCurrentCard, FLAG_NONE);</span>
                }
<span class="nc" id="L3992">                return true;</span>
            case COMMAND_ANSWER_FIRST_BUTTON:
<span class="nc" id="L3994">                return answerCardIfVisible(Consts.BUTTON_ONE);</span>
            case COMMAND_ANSWER_SECOND_BUTTON:
<span class="nc" id="L3996">                return answerCardIfVisible(Consts.BUTTON_TWO);</span>
            case COMMAND_ANSWER_THIRD_BUTTON:
<span class="nc" id="L3998">                return answerCardIfVisible(Consts.BUTTON_THREE);</span>
            case COMMAND_ANSWER_FOURTH_BUTTON:
<span class="nc" id="L4000">                return answerCardIfVisible(Consts.BUTTON_FOUR);</span>
            case COMMAND_ANSWER_RECOMMENDED:
<span class="nc" id="L4002">                return answerCardIfVisible(getRecommendedEase(false));</span>
            case COMMAND_PAGE_UP:
<span class="nc bnc" id="L4004" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5163)) {</span>
<span class="nc" id="L4005">                    onPageUp();</span>
                }
<span class="nc" id="L4007">                return true;</span>
            case COMMAND_PAGE_DOWN:
<span class="nc bnc" id="L4009" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5164)) {</span>
<span class="nc" id="L4010">                    onPageDown();</span>
                }
<span class="nc" id="L4012">                return true;</span>
            case COMMAND_ABORT_AND_SYNC:
<span class="nc bnc" id="L4014" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5165)) {</span>
<span class="nc" id="L4015">                    abortAndSync();</span>
                }
<span class="nc" id="L4017">                return true;</span>
            case COMMAND_RECORD_VOICE:
<span class="nc bnc" id="L4019" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5166)) {</span>
<span class="nc" id="L4020">                    recordVoice();</span>
                }
<span class="nc" id="L4022">                return true;</span>
            case COMMAND_REPLAY_VOICE:
<span class="nc bnc" id="L4024" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5167)) {</span>
<span class="nc" id="L4025">                    replayVoice();</span>
                }
<span class="nc" id="L4027">                return true;</span>
            case COMMAND_TOGGLE_WHITEBOARD:
<span class="nc bnc" id="L4029" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5168)) {</span>
<span class="nc" id="L4030">                    toggleWhiteboard();</span>
                }
<span class="nc" id="L4032">                return true;</span>
            default:
<span class="nc bnc" id="L4034" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5169)) {</span>
<span class="nc" id="L4035">                    Timber.w(&quot;Unknown command requested: %s&quot;, which);</span>
                }
<span class="nc" id="L4037">                return false;</span>
        }
    }

    protected void replayVoice() {
<span class="nc" id="L4042">    }</span>

    protected void recordVoice() {
<span class="nc" id="L4045">    }</span>

    protected void toggleWhiteboard() {
<span class="nc" id="L4048">    }</span>

    private void abortAndSync() {
<span class="nc bnc" id="L4051" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5170)) {</span>
<span class="nc" id="L4052">            closeReviewer(RESULT_ABORT_AND_SYNC, true);</span>
        }
<span class="nc" id="L4054">    }</span>

    protected void openCardInfo() {
<span class="nc bnc" id="L4057" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5172)) {</span>
<span class="nc bnc" id="L4058" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc bnc" id="L4059" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5171)) {</span>
<span class="nc" id="L4060">                    UIUtils.showThemedToast(this, getString(R.string.multimedia_editor_something_wrong), true);</span>
                }
<span class="nc" id="L4062">                return;</span>
            }
        }
<span class="nc" id="L4065">        Intent intent = new Intent(this, CardInfo.class);</span>
<span class="nc bnc" id="L4066" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5173)) {</span>
<span class="nc" id="L4067">            intent.putExtra(&quot;cardId&quot;, mCurrentCard.getId());</span>
        }
<span class="nc bnc" id="L4069" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5174)) {</span>
<span class="nc" id="L4070">            startActivityWithAnimation(intent, FADE);</span>
        }
<span class="nc" id="L4072">    }</span>

    /**
     * Displays a snackbar which does not obscure the answer buttons
     */
    protected void showSnackbar(String mainText, @StringRes int buttonText, OnClickListener onClickListener) {
<span class="nc" id="L4078">        Snackbar sb = UIUtils.getSnackbar(this, mainText, Snackbar.LENGTH_LONG, buttonText, onClickListener, mCardWebView, null);</span>
<span class="nc" id="L4079">        View easeButtons = findViewById(R.id.answer_options_layout);</span>
<span class="nc" id="L4080">        View previewButtons = findViewById(R.id.preview_buttons_layout);</span>
<span class="nc bnc" id="L4081" title="All 10 branches missed.">        View upperView = (ListenerUtil.mutListener.listen(5175) ? (previewButtons != null || previewButtons.getVisibility() != View.GONE) : (previewButtons != null &amp;&amp; previewButtons.getVisibility() != View.GONE)) ? previewButtons : easeButtons;</span>
<span class="nc bnc" id="L4082" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5181)) {</span>
<span class="nc bnc" id="L4083" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(5176) ? (upperView != null || upperView.getVisibility() != View.GONE) : (upperView != null &amp;&amp; upperView.getVisibility() != View.GONE))) {</span>
<span class="nc" id="L4084">                View sbView = sb.getView();</span>
<span class="nc" id="L4085">                CoordinatorLayout.LayoutParams layoutParams = (CoordinatorLayout.LayoutParams) sbView.getLayoutParams();</span>
<span class="nc bnc" id="L4086" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5177)) {</span>
<span class="nc" id="L4087">                    layoutParams.setAnchorId(upperView.getId());</span>
                }
<span class="nc bnc" id="L4089" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5178)) {</span>
<span class="nc" id="L4090">                    layoutParams.anchorGravity = Gravity.TOP;</span>
                }
<span class="nc bnc" id="L4092" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5179)) {</span>
<span class="nc" id="L4093">                    layoutParams.gravity = Gravity.TOP;</span>
                }
<span class="nc bnc" id="L4095" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5180)) {</span>
<span class="nc" id="L4096">                    sbView.setLayoutParams(layoutParams);</span>
                }
            }
        }
<span class="nc bnc" id="L4100" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5182)) {</span>
<span class="nc" id="L4101">            sb.show();</span>
        }
<span class="nc" id="L4103">    }</span>

    private void onPageUp() {
<span class="nc bnc" id="L4106" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5183)) {</span>
            // pageUp performs a half scroll, we want a full page
<span class="nc" id="L4108">            processCardAction(cardWebView -&gt; {</span>
<span class="nc" id="L4109">                cardWebView.pageUp(false);</span>
<span class="nc" id="L4110">                cardWebView.pageUp(false);</span>
<span class="nc" id="L4111">            });</span>
        }
<span class="nc" id="L4113">    }</span>

    private void onPageDown() {
<span class="nc bnc" id="L4116" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5184)) {</span>
<span class="nc" id="L4117">            processCardAction(cardWebView -&gt; {</span>
<span class="nc" id="L4118">                cardWebView.pageDown(false);</span>
<span class="nc" id="L4119">                cardWebView.pageDown(false);</span>
<span class="nc" id="L4120">            });</span>
        }
<span class="nc" id="L4122">    }</span>

    private void toggleFlag(@FlagDef int flag) {
<span class="nc bnc" id="L4125" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5194)) {</span>
<span class="nc bnc" id="L4126" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(5189) ? (mCurrentCard.userFlag() &gt;= flag) : (ListenerUtil.mutListener.listen(5188) ? (mCurrentCard.userFlag() &lt;= flag) : (ListenerUtil.mutListener.listen(5187) ? (mCurrentCard.userFlag() &gt; flag) : (ListenerUtil.mutListener.listen(5186) ? (mCurrentCard.userFlag() &lt; flag) : (ListenerUtil.mutListener.listen(5185) ? (mCurrentCard.userFlag() != flag) : (mCurrentCard.userFlag() == flag))))))) {</span>
<span class="nc bnc" id="L4127" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5192)) {</span>
<span class="nc" id="L4128">                    Timber.i(&quot;Toggle flag: unsetting flag&quot;);</span>
                }
<span class="nc bnc" id="L4130" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5193)) {</span>
<span class="nc" id="L4131">                    onFlag(mCurrentCard, FLAG_NONE);</span>
                }
            } else {
<span class="nc bnc" id="L4134" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5190)) {</span>
<span class="nc" id="L4135">                    Timber.i(&quot;Toggle flag: Setting flag to %d&quot;, flag);</span>
                }
<span class="nc bnc" id="L4137" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5191)) {</span>
<span class="nc" id="L4138">                    onFlag(mCurrentCard, flag);</span>
                }
            }
        }
<span class="nc" id="L4142">    }</span>

    private boolean answerCardIfVisible(@Consts.BUTTON_TYPE int ease) {
<span class="nc bnc" id="L4145" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5195)) {</span>
<span class="nc bnc" id="L4146" title="All 2 branches missed.">            if (!sDisplayAnswer) {</span>
<span class="nc" id="L4147">                return false;</span>
            }
        }
<span class="nc bnc" id="L4150" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5196)) {</span>
<span class="nc" id="L4151">            performClickWithVisualFeedback(ease);</span>
        }
<span class="nc" id="L4153">        return true;</span>
    }

    protected void performClickWithVisualFeedback(int ease) {
<span class="nc bnc" id="L4157" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5201)) {</span>
            // Delay could potentially be lower - testing with 20 left a visible &quot;click&quot;
<span class="nc bnc" id="L4159" title="All 5 branches missed.">            switch(ease) {</span>
                case EASE_1:
<span class="nc bnc" id="L4161" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5197)) {</span>
<span class="nc" id="L4162">                        performClickWithVisualFeedback(mEase1Layout);</span>
                    }
                    break;
                case EASE_2:
<span class="nc bnc" id="L4166" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5198)) {</span>
<span class="nc" id="L4167">                        performClickWithVisualFeedback(mEase2Layout);</span>
                    }
                    break;
                case EASE_3:
<span class="nc bnc" id="L4171" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5199)) {</span>
<span class="nc" id="L4172">                        performClickWithVisualFeedback(mEase3Layout);</span>
                    }
                    break;
                case EASE_4:
<span class="nc bnc" id="L4176" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5200)) {</span>
<span class="nc" id="L4177">                        performClickWithVisualFeedback(mEase4Layout);</span>
                    }
                    break;
            }
        }
<span class="nc" id="L4182">    }</span>

    private void performClickWithVisualFeedback(LinearLayout easeLayout) {
<span class="nc bnc" id="L4185" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5202)) {</span>
<span class="nc" id="L4186">            easeLayout.requestFocus();</span>
        }
<span class="nc bnc" id="L4188" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5203)) {</span>
<span class="nc" id="L4189">            easeLayout.postDelayed(easeLayout::performClick, 20);</span>
        }
<span class="nc" id="L4191">    }</span>

    @VisibleForTesting
    protected boolean isUndoAvailable() {
<span class="nc" id="L4195">        return getCol().undoAvailable();</span>
    }

    /**
     * Provides a hook for calling &quot;alert&quot; from javascript. Useful for debugging your javascript.
     */
<span class="nc" id="L4201">    public static final class AnkiDroidWebChromeClient extends WebChromeClient {</span>

        @Override
        public boolean onJsAlert(WebView view, String url, String message, JsResult result) {
<span class="nc bnc" id="L4205" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5204)) {</span>
<span class="nc" id="L4206">                Timber.i(&quot;AbstractFlashcardViewer:: onJsAlert: %s&quot;, message);</span>
            }
<span class="nc bnc" id="L4208" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5205)) {</span>
<span class="nc" id="L4209">                result.confirm();</span>
            }
<span class="nc" id="L4211">            return true;</span>
        }
    }

    protected void closeReviewer(int result, boolean saveDeck) {
<span class="nc bnc" id="L4216" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5207)) {</span>
            // Stop the mic recording if still pending
<span class="nc bnc" id="L4218" title="All 2 branches missed.">            if (mMicToolBar != null) {</span>
<span class="nc bnc" id="L4219" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5206)) {</span>
<span class="nc" id="L4220">                    mMicToolBar.notifyStopRecord();</span>
                }
            }
        }
<span class="nc bnc" id="L4224" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5210)) {</span>
            // Remove the temporary audio file
<span class="nc bnc" id="L4226" title="All 2 branches missed.">            if (mTempAudioPath != null) {</span>
<span class="nc" id="L4227">                File tempAudioPathToDelete = new File(mTempAudioPath);</span>
<span class="nc bnc" id="L4228" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5209)) {</span>
<span class="nc bnc" id="L4229" title="All 2 branches missed.">                    if (tempAudioPathToDelete.exists()) {</span>
<span class="nc bnc" id="L4230" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5208)) {</span>
<span class="nc" id="L4231">                            tempAudioPathToDelete.delete();</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L4237" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5211)) {</span>
<span class="nc" id="L4238">            mTimeoutHandler.removeCallbacks(mShowAnswerTask);</span>
        }
<span class="nc bnc" id="L4240" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5212)) {</span>
<span class="nc" id="L4241">            mTimeoutHandler.removeCallbacks(mShowQuestionTask);</span>
        }
<span class="nc bnc" id="L4243" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5213)) {</span>
<span class="nc" id="L4244">            mTimerHandler.removeCallbacks(removeChosenAnswerText);</span>
        }
<span class="nc bnc" id="L4246" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5214)) {</span>
<span class="nc" id="L4247">            longClickHandler.removeCallbacks(longClickTestRunnable);</span>
        }
<span class="nc bnc" id="L4249" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5215)) {</span>
<span class="nc" id="L4250">            longClickHandler.removeCallbacks(startLongClickAction);</span>
        }
<span class="nc bnc" id="L4252" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5216)) {</span>
<span class="nc" id="L4253">            AbstractFlashcardViewer.this.setResult(result);</span>
        }
<span class="nc bnc" id="L4255" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5218)) {</span>
<span class="nc bnc" id="L4256" title="All 2 branches missed.">            if (saveDeck) {</span>
<span class="nc bnc" id="L4257" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5217)) {</span>
<span class="nc" id="L4258">                    UIUtils.saveCollectionInBackground();</span>
                }
            }
        }
<span class="nc bnc" id="L4262" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5219)) {</span>
<span class="nc" id="L4263">            finishWithAnimation(RIGHT);</span>
        }
<span class="nc" id="L4265">    }</span>

    protected void refreshActionBar() {
<span class="nc bnc" id="L4268" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5220)) {</span>
<span class="nc" id="L4269">            supportInvalidateOptionsMenu();</span>
        }
<span class="nc" id="L4271">    }</span>

    /**
     * Fixing bug 720: &lt;input&gt; focus, thanks to pablomouzo on android issue 7189
     */
    class MyWebView extends WebView {

<span class="nc" id="L4278">        public MyWebView(Context context) {</span>
<span class="nc" id="L4279">            super(context);</span>
<span class="nc" id="L4280">        }</span>

        @Override
        public void loadDataWithBaseURL(@Nullable String baseUrl, String data, @Nullable String mimeType, @Nullable String encoding, @Nullable String historyUrl) {
<span class="nc bnc" id="L4284" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5223)) {</span>
<span class="nc bnc" id="L4285" title="All 2 branches missed.">                if (!AbstractFlashcardViewer.this.isDestroyed()) {</span>
<span class="nc bnc" id="L4286" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5222)) {</span>
<span class="nc" id="L4287">                        super.loadDataWithBaseURL(baseUrl, data, mimeType, encoding, historyUrl);</span>
                    }
                } else {
<span class="nc bnc" id="L4290" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5221)) {</span>
<span class="nc" id="L4291">                        Timber.w(&quot;Not loading card - Activity is in the process of being destroyed.&quot;);</span>
                    }
                }
            }
<span class="nc" id="L4295">        }</span>

        @Override
        protected void onScrollChanged(int horiz, int vert, int oldHoriz, int oldVert) {
<span class="nc bnc" id="L4299" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5224)) {</span>
<span class="nc" id="L4300">                super.onScrollChanged(horiz, vert, oldHoriz, oldVert);</span>
            }
<span class="nc bnc" id="L4302" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5244)) {</span>
<span class="nc bnc" id="L4303" title="All 118 branches missed.">                if ((ListenerUtil.mutListener.listen(5237) ? (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) &gt;= Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))) : (ListenerUtil.mutListener.listen(5236) ? (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) &lt;= Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))) : (ListenerUtil.mutListener.listen(5235) ? (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) &lt; Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))) : (ListenerUtil.mutListener.listen(5234) ? (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) != Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))) : (ListenerUtil.mutListener.listen(5233) ? (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) == Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))) : (Math.abs((ListenerUtil.mutListener.listen(5228) ? (horiz % oldHoriz) : (ListenerUtil.mutListener.listen(5227) ? (horiz / oldHoriz) : (ListenerUtil.mutListener.listen(5226) ? (horiz * oldHoriz) : (ListenerUtil.mutListener.listen(5225) ? (horiz + oldHoriz) : (horiz - oldHoriz)))))) &gt; Math.abs((ListenerUtil.mutListener.listen(5232) ? (vert % oldVert) : (ListenerUtil.mutListener.listen(5231) ? (vert / oldVert) : (ListenerUtil.mutListener.listen(5230) ? (vert * oldVert) : (ListenerUtil.mutListener.listen(5229) ? (vert + oldVert) : (vert - oldVert))))))))))))) {</span>
<span class="nc bnc" id="L4304" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5241)) {</span>
<span class="nc" id="L4305">                        mIsXScrolling = true;</span>
                    }
<span class="nc bnc" id="L4307" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5242)) {</span>
<span class="nc" id="L4308">                        scrollHandler.removeCallbacks(scrollXRunnable);</span>
                    }
<span class="nc bnc" id="L4310" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5243)) {</span>
<span class="nc" id="L4311">                        scrollHandler.postDelayed(scrollXRunnable, 300);</span>
                    }
                } else {
<span class="nc bnc" id="L4314" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5238)) {</span>
<span class="nc" id="L4315">                        mIsYScrolling = true;</span>
                    }
<span class="nc bnc" id="L4317" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5239)) {</span>
<span class="nc" id="L4318">                        scrollHandler.removeCallbacks(scrollYRunnable);</span>
                    }
<span class="nc bnc" id="L4320" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5240)) {</span>
<span class="nc" id="L4321">                        scrollHandler.postDelayed(scrollYRunnable, 300);</span>
                    }
                }
            }
<span class="nc" id="L4325">        }</span>

<span class="nc" id="L4327">        private final Handler scrollHandler = new Handler();</span>

<span class="nc" id="L4329">        private final Runnable scrollXRunnable = () -&gt; mIsXScrolling = false;</span>

<span class="nc" id="L4331">        private final Runnable scrollYRunnable = () -&gt; mIsYScrolling = false;</span>
    }

<span class="nc" id="L4334">    class MyGestureDetector extends SimpleOnGestureListener {</span>

        // Android design spec for the size of the status bar.
        private static final int NO_GESTURE_BORDER_DIP = 24;

        @Override
        public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {
<span class="nc bnc" id="L4341" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5245)) {</span>
<span class="nc" id="L4342">                Timber.d(&quot;onFling&quot;);</span>
            }
<span class="nc bnc" id="L4344" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5247)) {</span>
                // it would be lovely to use e1.getEdgeFlags(), but alas, it doesn't work.
<span class="nc bnc" id="L4346" title="All 2 branches missed.">                if (isTouchingEdge(e1)) {</span>
<span class="nc bnc" id="L4347" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5246)) {</span>
<span class="nc" id="L4348">                        Timber.d(&quot;ignoring edge fling&quot;);</span>
                    }
<span class="nc" id="L4350">                    return false;</span>
                }
            }
<span class="nc bnc" id="L4353" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5248)) {</span>
                // Go back to immersive mode if the user had temporarily exited it (and then execute swipe gesture)
<span class="nc" id="L4355">                AbstractFlashcardViewer.this.onFling();</span>
            }
<span class="nc bnc" id="L4357" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5320)) {</span>
<span class="nc bnc" id="L4358" title="All 2 branches missed.">                if (mGesturesEnabled) {</span>
                    try {
<span class="nc bnc" id="L4360" title="All 8 branches missed.">                        float dy = (ListenerUtil.mutListener.listen(5253) ? (e2.getY() % e1.getY()) : (ListenerUtil.mutListener.listen(5252) ? (e2.getY() / e1.getY()) : (ListenerUtil.mutListener.listen(5251) ? (e2.getY() * e1.getY()) : (ListenerUtil.mutListener.listen(5250) ? (e2.getY() + e1.getY()) : (e2.getY() - e1.getY())))));</span>
<span class="nc bnc" id="L4361" title="All 8 branches missed.">                        float dx = (ListenerUtil.mutListener.listen(5257) ? (e2.getX() % e1.getX()) : (ListenerUtil.mutListener.listen(5256) ? (e2.getX() / e1.getX()) : (ListenerUtil.mutListener.listen(5255) ? (e2.getX() * e1.getX()) : (ListenerUtil.mutListener.listen(5254) ? (e2.getX() + e1.getX()) : (e2.getX() - e1.getX())))));</span>
<span class="nc bnc" id="L4362" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5319)) {</span>
<span class="nc bnc" id="L4363" title="All 22 branches missed.">                            if ((ListenerUtil.mutListener.listen(5262) ? (Math.abs(dx) &gt;= Math.abs(dy)) : (ListenerUtil.mutListener.listen(5261) ? (Math.abs(dx) &lt;= Math.abs(dy)) : (ListenerUtil.mutListener.listen(5260) ? (Math.abs(dx) &lt; Math.abs(dy)) : (ListenerUtil.mutListener.listen(5259) ? (Math.abs(dx) != Math.abs(dy)) : (ListenerUtil.mutListener.listen(5258) ? (Math.abs(dx) == Math.abs(dy)) : (Math.abs(dx) &gt; Math.abs(dy)))))))) {</span>
<span class="nc bnc" id="L4364" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5318)) {</span>
                                    // horizontal swipe if moved further in x direction than y direction
<span class="nc bnc" id="L4366" title="All 378 branches missed.">                                    if ((ListenerUtil.mutListener.listen(5302) ? ((ListenerUtil.mutListener.listen(5301) ? ((ListenerUtil.mutListener.listen(5300) ? ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsXScrolling) : ((ListenerUtil.mutListener.listen(5300) ? ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsXScrolling)) || !mIsSelecting) : ((ListenerUtil.mutListener.listen(5301) ? ((ListenerUtil.mutListener.listen(5300) ? ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsXScrolling) : ((ListenerUtil.mutListener.listen(5300) ? ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5294) ? (dx &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5293) ? (dx &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5292) ? (dx &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5291) ? (dx != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5290) ? (dx == AnkiDroidApp.sSwipeMinDistance) : (dx &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5299) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5298) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5297) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5296) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5295) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsXScrolling)) &amp;&amp; !mIsSelecting))) {</span>
<span class="nc bnc" id="L4367" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5317)) {</span>
                                            // right
<span class="nc" id="L4369">                                            executeCommand(mGestureSwipeRight);</span>
                                        }
<span class="nc bnc" id="L4371" title="All 378 branches missed.">                                    } else if ((ListenerUtil.mutListener.listen(5315) ? ((ListenerUtil.mutListener.listen(5314) ? ((ListenerUtil.mutListener.listen(5313) ? ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsXScrolling) : ((ListenerUtil.mutListener.listen(5313) ? ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsXScrolling)) || !mIsSelecting) : ((ListenerUtil.mutListener.listen(5314) ? ((ListenerUtil.mutListener.listen(5313) ? ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsXScrolling) : ((ListenerUtil.mutListener.listen(5313) ? ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5307) ? (dx &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5306) ? (dx &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5305) ? (dx &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5304) ? (dx != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5303) ? (dx == -AnkiDroidApp.sSwipeMinDistance) : (dx &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5312) ? (Math.abs(velocityX) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5311) ? (Math.abs(velocityX) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5310) ? (Math.abs(velocityX) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5309) ? (Math.abs(velocityX) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5308) ? (Math.abs(velocityX) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityX) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsXScrolling)) &amp;&amp; !mIsSelecting))) {</span>
<span class="nc bnc" id="L4372" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5316)) {</span>
                                            // left
<span class="nc" id="L4374">                                            executeCommand(mGestureSwipeLeft);</span>
                                        }
                                    }
                                }
                            } else {
<span class="nc bnc" id="L4379" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5289)) {</span>
                                    // otherwise vertical swipe
<span class="nc bnc" id="L4381" title="All 186 branches missed.">                                    if ((ListenerUtil.mutListener.listen(5274) ? ((ListenerUtil.mutListener.listen(5273) ? ((ListenerUtil.mutListener.listen(5267) ? (dy &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5266) ? (dy &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5265) ? (dy &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5264) ? (dy != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5263) ? (dy == AnkiDroidApp.sSwipeMinDistance) : (dy &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5272) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5271) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5270) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5269) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5268) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5267) ? (dy &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5266) ? (dy &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5265) ? (dy &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5264) ? (dy != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5263) ? (dy == AnkiDroidApp.sSwipeMinDistance) : (dy &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5272) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5271) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5270) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5269) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5268) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsYScrolling) : ((ListenerUtil.mutListener.listen(5273) ? ((ListenerUtil.mutListener.listen(5267) ? (dy &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5266) ? (dy &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5265) ? (dy &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5264) ? (dy != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5263) ? (dy == AnkiDroidApp.sSwipeMinDistance) : (dy &gt; AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5272) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5271) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5270) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5269) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5268) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5267) ? (dy &gt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5266) ? (dy &lt;= AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5265) ? (dy &lt; AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5264) ? (dy != AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5263) ? (dy == AnkiDroidApp.sSwipeMinDistance) : (dy &gt; AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5272) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5271) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5270) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5269) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5268) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsYScrolling))) {</span>
<span class="nc bnc" id="L4382" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5288)) {</span>
                                            // down
<span class="nc" id="L4384">                                            executeCommand(mGestureSwipeDown);</span>
                                        }
<span class="nc bnc" id="L4386" title="All 186 branches missed.">                                    } else if ((ListenerUtil.mutListener.listen(5286) ? ((ListenerUtil.mutListener.listen(5285) ? ((ListenerUtil.mutListener.listen(5279) ? (dy &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5278) ? (dy &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5277) ? (dy &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5276) ? (dy != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5275) ? (dy == -AnkiDroidApp.sSwipeMinDistance) : (dy &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5284) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5283) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5282) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5281) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5280) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5279) ? (dy &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5278) ? (dy &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5277) ? (dy &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5276) ? (dy != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5275) ? (dy == -AnkiDroidApp.sSwipeMinDistance) : (dy &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5284) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5283) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5282) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5281) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5280) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) || !mIsYScrolling) : ((ListenerUtil.mutListener.listen(5285) ? ((ListenerUtil.mutListener.listen(5279) ? (dy &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5278) ? (dy &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5277) ? (dy &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5276) ? (dy != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5275) ? (dy == -AnkiDroidApp.sSwipeMinDistance) : (dy &lt; -AnkiDroidApp.sSwipeMinDistance)))))) || (ListenerUtil.mutListener.listen(5284) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5283) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5282) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5281) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5280) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity))))))) : ((ListenerUtil.mutListener.listen(5279) ? (dy &gt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5278) ? (dy &lt;= -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5277) ? (dy &gt; -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5276) ? (dy != -AnkiDroidApp.sSwipeMinDistance) : (ListenerUtil.mutListener.listen(5275) ? (dy == -AnkiDroidApp.sSwipeMinDistance) : (dy &lt; -AnkiDroidApp.sSwipeMinDistance)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5284) ? (Math.abs(velocityY) &gt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5283) ? (Math.abs(velocityY) &lt;= AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5282) ? (Math.abs(velocityY) &lt; AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5281) ? (Math.abs(velocityY) != AnkiDroidApp.sSwipeThresholdVelocity) : (ListenerUtil.mutListener.listen(5280) ? (Math.abs(velocityY) == AnkiDroidApp.sSwipeThresholdVelocity) : (Math.abs(velocityY) &gt; AnkiDroidApp.sSwipeThresholdVelocity)))))))) &amp;&amp; !mIsYScrolling))) {</span>
<span class="nc bnc" id="L4387" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5287)) {</span>
                                            // up
<span class="nc" id="L4389">                                            executeCommand(mGestureSwipeUp);</span>
                                        }
                                    }
                                }
                            }
                        }
<span class="nc" id="L4395">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L4396" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5249)) {</span>
<span class="nc" id="L4397">                            Timber.e(e, &quot;onFling Exception&quot;);</span>
                        }
<span class="nc" id="L4399">                    }</span>
                }
            }
<span class="nc" id="L4402">            return false;</span>
        }

        private boolean isTouchingEdge(MotionEvent e1) {
<span class="nc" id="L4406">            int height = mTouchLayer.getHeight();</span>
<span class="nc" id="L4407">            int width = mTouchLayer.getWidth();</span>
<span class="nc bnc" id="L4408" title="All 8 branches missed.">            float margin = (ListenerUtil.mutListener.listen(5324) ? (NO_GESTURE_BORDER_DIP % getResources().getDisplayMetrics().density) : (ListenerUtil.mutListener.listen(5323) ? (NO_GESTURE_BORDER_DIP / getResources().getDisplayMetrics().density) : (ListenerUtil.mutListener.listen(5322) ? (NO_GESTURE_BORDER_DIP - getResources().getDisplayMetrics().density) : (ListenerUtil.mutListener.listen(5321) ? (NO_GESTURE_BORDER_DIP + getResources().getDisplayMetrics().density) : (NO_GESTURE_BORDER_DIP * getResources().getDisplayMetrics().density))))) + 0.5f;</span>
<span class="nc bnc" id="L4409" title="All 786 branches missed.">            return (ListenerUtil.mutListener.listen(5355) ? ((ListenerUtil.mutListener.listen(5345) ? ((ListenerUtil.mutListener.listen(5335) ? ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) || (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin)))))))) &amp;&amp; (ListenerUtil.mutListener.listen(5344) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5343) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5342) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5341) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) != margin) : (ListenerUtil.mutListener.listen(5340) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) == margin) : ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5335) ? ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) || (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin)))))))) || (ListenerUtil.mutListener.listen(5344) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5343) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5342) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5341) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) != margin) : (ListenerUtil.mutListener.listen(5340) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) == margin) : ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt; margin)))))))) &amp;&amp; (ListenerUtil.mutListener.listen(5354) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5353) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5352) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5351) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) != margin) : (ListenerUtil.mutListener.listen(5350) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) == margin) : ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5345) ? ((ListenerUtil.mutListener.listen(5335) ? ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) || (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin)))))))) &amp;&amp; (ListenerUtil.mutListener.listen(5344) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5343) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5342) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5341) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) != margin) : (ListenerUtil.mutListener.listen(5340) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) == margin) : ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5335) ? ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) &amp;&amp; (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin))))))) : ((ListenerUtil.mutListener.listen(5329) ? (e1.getX() &gt;= margin) : (ListenerUtil.mutListener.listen(5328) ? (e1.getX() &lt;= margin) : (ListenerUtil.mutListener.listen(5327) ? (e1.getX() &gt; margin) : (ListenerUtil.mutListener.listen(5326) ? (e1.getX() != margin) : (ListenerUtil.mutListener.listen(5325) ? (e1.getX() == margin) : (e1.getX() &lt; margin)))))) || (ListenerUtil.mutListener.listen(5334) ? (e1.getY() &gt;= margin) : (ListenerUtil.mutListener.listen(5333) ? (e1.getY() &lt;= margin) : (ListenerUtil.mutListener.listen(5332) ? (e1.getY() &gt; margin) : (ListenerUtil.mutListener.listen(5331) ? (e1.getY() != margin) : (ListenerUtil.mutListener.listen(5330) ? (e1.getY() == margin) : (e1.getY() &lt; margin)))))))) || (ListenerUtil.mutListener.listen(5344) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5343) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5342) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5341) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) != margin) : (ListenerUtil.mutListener.listen(5340) ? ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) == margin) : ((ListenerUtil.mutListener.listen(5339) ? (height % e1.getY()) : (ListenerUtil.mutListener.listen(5338) ? (height / e1.getY()) : (ListenerUtil.mutListener.listen(5337) ? (height * e1.getY()) : (ListenerUtil.mutListener.listen(5336) ? (height + e1.getY()) : (height - e1.getY()))))) &lt; margin)))))))) || (ListenerUtil.mutListener.listen(5354) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &gt;= margin) : (ListenerUtil.mutListener.listen(5353) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &lt;= margin) : (ListenerUtil.mutListener.listen(5352) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &gt; margin) : (ListenerUtil.mutListener.listen(5351) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) != margin) : (ListenerUtil.mutListener.listen(5350) ? ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) == margin) : ((ListenerUtil.mutListener.listen(5349) ? (width % e1.getX()) : (ListenerUtil.mutListener.listen(5348) ? (width / e1.getX()) : (ListenerUtil.mutListener.listen(5347) ? (width * e1.getX()) : (ListenerUtil.mutListener.listen(5346) ? (width + e1.getX()) : (width - e1.getX()))))) &lt; margin))))))));</span>
        }

        @Override
        public boolean onDoubleTap(MotionEvent e) {
<span class="nc bnc" id="L4414" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5357)) {</span>
<span class="nc bnc" id="L4415" title="All 2 branches missed.">                if (mGesturesEnabled) {</span>
<span class="nc bnc" id="L4416" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5356)) {</span>
<span class="nc" id="L4417">                        executeCommand(mGestureDoubleTap);</span>
                    }
                }
            }
<span class="nc" id="L4421">            return true;</span>
        }

        @Override
        public boolean onSingleTapUp(MotionEvent e) {
<span class="nc bnc" id="L4426" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5360)) {</span>
<span class="nc bnc" id="L4427" title="All 2 branches missed.">                if (mTouchStarted) {</span>
<span class="nc bnc" id="L4428" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5358)) {</span>
<span class="nc" id="L4429">                        longClickHandler.removeCallbacks(longClickTestRunnable);</span>
                    }
<span class="nc bnc" id="L4431" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5359)) {</span>
<span class="nc" id="L4432">                        mTouchStarted = false;</span>
                    }
                }
            }
<span class="nc" id="L4436">            return false;</span>
        }

        @Override
        public boolean onSingleTapConfirmed(MotionEvent e) {
<span class="nc bnc" id="L4441" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5361)) {</span>
                // Go back to immersive mode if the user had temporarily exited it (and ignore the tap gesture)
<span class="nc bnc" id="L4443" title="All 2 branches missed.">                if (onSingleTap()) {</span>
<span class="nc" id="L4444">                    return true;</span>
                }
            }
<span class="nc bnc" id="L4447" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5362)) {</span>
<span class="nc" id="L4448">                executeTouchCommand(e);</span>
            }
<span class="nc" id="L4450">            return false;</span>
        }

        protected void executeTouchCommand(@NonNull MotionEvent e) {
<span class="nc bnc" id="L4454" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5365)) {</span>
<span class="nc bnc" id="L4455" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(5363) ? (mGesturesEnabled || !mIsSelecting) : (mGesturesEnabled &amp;&amp; !mIsSelecting))) {</span>
<span class="nc" id="L4456">                    int height = mTouchLayer.getHeight();</span>
<span class="nc" id="L4457">                    int width = mTouchLayer.getWidth();</span>
<span class="nc" id="L4458">                    float posX = e.getX();</span>
<span class="nc" id="L4459">                    float posY = e.getY();</span>
<span class="nc" id="L4460">                    int gesture = mGestureTapProcessor.getCommandFromTap(height, width, posX, posY);</span>
<span class="nc bnc" id="L4461" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5364)) {</span>
<span class="nc" id="L4462">                        executeCommand(gesture);</span>
                    }
                }
            }
<span class="nc bnc" id="L4466" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5366)) {</span>
<span class="nc" id="L4467">                mIsSelecting = false;</span>
            }
<span class="nc bnc" id="L4469" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5367)) {</span>
<span class="nc" id="L4470">                showLookupButtonIfNeeded();</span>
            }
<span class="nc" id="L4472">        }</span>

        public void onWebViewCreated(@NonNull WebView webView) {
<span class="nc" id="L4475">        }</span>

        public void onFillFlashcard() {
<span class="nc" id="L4478">        }</span>

        public boolean eventCanBeSentToWebView(@NonNull MotionEvent event) {
<span class="nc" id="L4481">            return true;</span>
        }
    }

    protected boolean onSingleTap() {
<span class="nc" id="L4486">        return false;</span>
    }

    protected void onFling() {
<span class="nc" id="L4490">    }</span>

    /**
     * #6141 - blocks clicking links from executing &quot;touch&quot; gestures.
     * COULD_BE_BETTER: Make base class static and move this out of the CardViewer
     */
<span class="nc" id="L4496">    class LinkDetectingGestureDetector extends AbstractFlashcardViewer.MyGestureDetector {</span>

        /**
         * A list of events to process when listening to WebView touches
         */
<span class="nc" id="L4501">        private final HashSet&lt;MotionEvent&gt; mDesiredTouchEvents = new HashSet&lt;&gt;(2);</span>

        /**
         * A list of events we sent to the WebView (to block double-processing)
         */
<span class="nc" id="L4506">        private final HashSet&lt;MotionEvent&gt; mDispatchedTouchEvents = new HashSet&lt;&gt;(2);</span>

        @Override
        public void onFillFlashcard() {
<span class="nc bnc" id="L4510" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5368)) {</span>
<span class="nc" id="L4511">                Timber.d(&quot;Removing pending touch events for gestures&quot;);</span>
            }
<span class="nc bnc" id="L4513" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5369)) {</span>
<span class="nc" id="L4514">                mDesiredTouchEvents.clear();</span>
            }
<span class="nc bnc" id="L4516" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5370)) {</span>
<span class="nc" id="L4517">                mDispatchedTouchEvents.clear();</span>
            }
<span class="nc" id="L4519">        }</span>

        @Override
        public boolean eventCanBeSentToWebView(@NonNull MotionEvent event) {
            // if we processed the event, we don't want to perform it again
<span class="nc bnc" id="L4524" title="All 2 branches missed.">            return !mDispatchedTouchEvents.remove(event);</span>
        }

        @Override
        protected void executeTouchCommand(@NonNull MotionEvent downEvent) {
<span class="nc bnc" id="L4529" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5371)) {</span>
<span class="nc" id="L4530">                downEvent.setAction(MotionEvent.ACTION_DOWN);</span>
            }
<span class="nc" id="L4532">            MotionEvent upEvent = MotionEvent.obtainNoHistory(downEvent);</span>
<span class="nc bnc" id="L4533" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5372)) {</span>
<span class="nc" id="L4534">                upEvent.setAction(MotionEvent.ACTION_UP);</span>
            }
<span class="nc bnc" id="L4536" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5373)) {</span>
                // mark the events we want to process
<span class="nc" id="L4538">                mDesiredTouchEvents.add(downEvent);</span>
            }
<span class="nc bnc" id="L4540" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5374)) {</span>
<span class="nc" id="L4541">                mDesiredTouchEvents.add(upEvent);</span>
            }
<span class="nc bnc" id="L4543" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5375)) {</span>
                // mark the events to can guard against double-processing
<span class="nc" id="L4545">                mDispatchedTouchEvents.add(downEvent);</span>
            }
<span class="nc bnc" id="L4547" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5376)) {</span>
<span class="nc" id="L4548">                mDispatchedTouchEvents.add(upEvent);</span>
            }
<span class="nc bnc" id="L4550" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5377)) {</span>
<span class="nc" id="L4551">                Timber.d(&quot;Dispatching touch events&quot;);</span>
            }
<span class="nc bnc" id="L4553" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5378)) {</span>
<span class="nc" id="L4554">                processCardAction(cardWebView -&gt; {</span>
<span class="nc" id="L4555">                    cardWebView.dispatchTouchEvent(downEvent);</span>
<span class="nc" id="L4556">                    cardWebView.dispatchTouchEvent(upEvent);</span>
<span class="nc" id="L4557">                });</span>
            }
<span class="nc" id="L4559">        }</span>

        @SuppressLint(&quot;ClickableViewAccessibility&quot;)
        @Override
        public void onWebViewCreated(@NonNull WebView webView) {
<span class="nc bnc" id="L4564" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5379)) {</span>
<span class="nc" id="L4565">                Timber.d(&quot;Initializing WebView touch handler&quot;);</span>
            }
<span class="nc bnc" id="L4567" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5380)) {</span>
<span class="nc" id="L4568">                webView.setOnTouchListener((webViewAsView, motionEvent) -&gt; {</span>
<span class="nc bnc" id="L4569" title="All 2 branches missed.">                    if (!mDesiredTouchEvents.remove(motionEvent)) {</span>
<span class="nc" id="L4570">                        return false;</span>
                    }
                    // But we don't want to handle this as a touch event.
<span class="nc bnc" id="L4573" title="All 2 branches missed.">                    if (motionEvent.getAction() == MotionEvent.ACTION_UP) {</span>
<span class="nc" id="L4574">                        return true;</span>
                    }
<span class="nc" id="L4576">                    WebView cardWebView = (WebView) webViewAsView;</span>
                    HitTestResult result;
                    try {
<span class="nc" id="L4579">                        result = cardWebView.getHitTestResult();</span>
<span class="nc" id="L4580">                    } catch (Exception e) {</span>
<span class="nc" id="L4581">                        Timber.w(e, &quot;Cannot obtain HitTest result&quot;);</span>
<span class="nc" id="L4582">                        return true;</span>
<span class="nc" id="L4583">                    }</span>
<span class="nc bnc" id="L4584" title="All 2 branches missed.">                    if (isLinkClick(result)) {</span>
<span class="nc" id="L4585">                        Timber.v(&quot;Detected link click - ignoring gesture dispatch&quot;);</span>
<span class="nc" id="L4586">                        return true;</span>
                    }
<span class="nc bnc" id="L4588" title="All 2 branches missed.">                    Timber.v(&quot;Executing continuation for click type: %d&quot;, result == null ? -178 : result.getType());</span>
<span class="nc" id="L4589">                    super.executeTouchCommand(motionEvent);</span>
<span class="nc" id="L4590">                    return true;</span>
                });
            }
<span class="nc" id="L4593">        }</span>

        private boolean isLinkClick(HitTestResult result) {
<span class="nc bnc" id="L4596" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5381)) {</span>
<span class="nc bnc" id="L4597" title="All 2 branches missed.">                if (result == null) {</span>
<span class="nc" id="L4598">                    return false;</span>
                }
            }
<span class="nc" id="L4601">            int type = result.getType();</span>
<span class="nc bnc" id="L4602" title="All 10 branches missed.">            return (ListenerUtil.mutListener.listen(5382) ? (type == HitTestResult.SRC_ANCHOR_TYPE &amp;&amp; type == HitTestResult.SRC_IMAGE_ANCHOR_TYPE) : (type == HitTestResult.SRC_ANCHOR_TYPE || type == HitTestResult.SRC_IMAGE_ANCHOR_TYPE));</span>
        }
    }

    /**
     * Removes first occurrence in answerContent of any audio that is present due to use of
     * {{FrontSide}} on the answer.
     * @param answerContent     The content from which to remove front side audio.
     * @return                  The content stripped of audio due to {{FrontSide}} inclusion.
     */
    private String removeFrontSideAudio(String answerContent) {
<span class="nc" id="L4613">        String answerFormat = getAnswerFormat();</span>
<span class="nc" id="L4614">        String newAnswerContent = answerContent;</span>
<span class="nc bnc" id="L4615" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5385)) {</span>
<span class="nc bnc" id="L4616" title="All 2 branches missed.">            if (answerFormat.contains(&quot;{{FrontSide}}&quot;)) {</span>
                // possible audio removal necessary
<span class="nc" id="L4618">                String frontSideFormat = mCurrentCard._getQA(false).get(&quot;q&quot;);</span>
<span class="nc" id="L4619">                Matcher audioReferences = Sound.sSoundPattern.matcher(frontSideFormat);</span>
<span class="nc bnc" id="L4620" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5384)) {</span>
                    {
<span class="nc" id="L4622">                        long _loopCounter102 = 0;</span>
                        // remove the first instance of audio contained in &quot;{{FrontSide}}&quot;
<span class="nc bnc" id="L4624" title="All 2 branches missed.">                        while (audioReferences.find()) {</span>
<span class="nc" id="L4625">                            ListenerUtil.loopListener.listen(&quot;_loopCounter102&quot;, ++_loopCounter102);</span>
<span class="nc bnc" id="L4626" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5383)) {</span>
<span class="nc" id="L4627">                                newAnswerContent = newAnswerContent.replaceFirst(Pattern.quote(audioReferences.group()), &quot;&quot;);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L4634">        return newAnswerContent;</span>
    }

    /**
     * Public method to start new video player activity
     */
    public void playVideo(String path) {
<span class="nc bnc" id="L4641" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5386)) {</span>
<span class="nc" id="L4642">            Timber.i(&quot;Launching Video: %s&quot;, path);</span>
        }
<span class="nc" id="L4644">        Intent videoPlayer = new Intent(this, VideoPlayer.class);</span>
<span class="nc bnc" id="L4645" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5387)) {</span>
<span class="nc" id="L4646">            videoPlayer.putExtra(&quot;path&quot;, path);</span>
        }
<span class="nc bnc" id="L4648" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5388)) {</span>
<span class="nc" id="L4649">            startActivityWithoutAnimation(videoPlayer);</span>
        }
<span class="nc" id="L4651">    }</span>

    /**
     * Callback for when TTS has been initialized.
     */
    public void ttsInitialized() {
<span class="nc bnc" id="L4657" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5389)) {</span>
<span class="nc" id="L4658">            mTtsInitialized = true;</span>
        }
<span class="nc bnc" id="L4660" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5391)) {</span>
<span class="nc bnc" id="L4661" title="All 2 branches missed.">            if (mReplayOnTtsInit) {</span>
<span class="nc bnc" id="L4662" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5390)) {</span>
<span class="nc" id="L4663">                    playSounds(true);</span>
                }
            }
        }
<span class="nc" id="L4667">    }</span>

    private void drawMark() {
<span class="nc bnc" id="L4670" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5392)) {</span>
<span class="nc bnc" id="L4671" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc" id="L4672">                return;</span>
            }
        }
<span class="nc bnc" id="L4675" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5393)) {</span>
<span class="nc" id="L4676">            mCardMarker.displayMark(shouldDisplayMark());</span>
        }
<span class="nc" id="L4678">    }</span>

    protected boolean shouldDisplayMark() {
<span class="nc" id="L4681">        return mCurrentCard.note().hasTag(&quot;marked&quot;);</span>
    }

    protected void onMark(Card card) {
<span class="nc bnc" id="L4685" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5394)) {</span>
<span class="nc bnc" id="L4686" title="All 2 branches missed.">            if (card == null) {</span>
<span class="nc" id="L4687">                return;</span>
            }
        }
<span class="nc" id="L4690">        Note note = card.note();</span>
<span class="nc bnc" id="L4691" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5397)) {</span>
<span class="nc bnc" id="L4692" title="All 2 branches missed.">            if (note.hasTag(&quot;marked&quot;)) {</span>
<span class="nc bnc" id="L4693" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5396)) {</span>
<span class="nc" id="L4694">                    note.delTag(&quot;marked&quot;);</span>
                }
            } else {
<span class="nc bnc" id="L4697" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5395)) {</span>
<span class="nc" id="L4698">                    note.addTag(&quot;marked&quot;);</span>
                }
            }
        }
<span class="nc bnc" id="L4702" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5398)) {</span>
<span class="nc" id="L4703">            note.flush();</span>
        }
<span class="nc bnc" id="L4705" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5399)) {</span>
<span class="nc" id="L4706">            refreshActionBar();</span>
        }
<span class="nc bnc" id="L4708" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5400)) {</span>
<span class="nc" id="L4709">            drawMark();</span>
        }
<span class="nc" id="L4711">    }</span>

    private void drawFlag() {
<span class="nc bnc" id="L4714" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5401)) {</span>
<span class="nc bnc" id="L4715" title="All 2 branches missed.">            if (mCurrentCard == null) {</span>
<span class="nc" id="L4716">                return;</span>
            }
        }
<span class="nc bnc" id="L4719" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5402)) {</span>
<span class="nc" id="L4720">            mCardMarker.displayFlag(getFlagToDisplay());</span>
        }
<span class="nc" id="L4722">    }</span>

    @FlagDef
    protected int getFlagToDisplay() {
<span class="nc" id="L4726">        return mCurrentCard.userFlag();</span>
    }

    protected void onFlag(Card card, @FlagDef int flag) {
<span class="nc bnc" id="L4730" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5403)) {</span>
<span class="nc bnc" id="L4731" title="All 2 branches missed.">            if (card == null) {</span>
<span class="nc" id="L4732">                return;</span>
            }
        }
<span class="nc bnc" id="L4735" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5404)) {</span>
<span class="nc" id="L4736">            card.setUserFlag(flag);</span>
        }
<span class="nc bnc" id="L4738" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5405)) {</span>
<span class="nc" id="L4739">            card.flush();</span>
        }
<span class="nc bnc" id="L4741" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5406)) {</span>
<span class="nc" id="L4742">            refreshActionBar();</span>
        }
<span class="nc bnc" id="L4744" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5407)) {</span>
<span class="nc" id="L4745">            drawFlag();</span>
        }
<span class="nc" id="L4747">    }</span>

    protected void dismiss(Collection.DismissType type) {
<span class="nc bnc" id="L4750" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5408)) {</span>
<span class="nc" id="L4751">            blockControls(false);</span>
        }
<span class="nc bnc" id="L4753" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5409)) {</span>
<span class="nc" id="L4754">            TaskManager.launchCollectionTask(new CollectionTask.DismissNote(mCurrentCard, type), mDismissCardHandler);</span>
        }
<span class="nc" id="L4756">    }</span>

    /**
     * Signals from a WebView represent actions with no parameters
     */
    @VisibleForTesting
<span class="nc" id="L4762">    static class WebViewSignalParserUtils {</span>

        /**
         * A signal which we did not know how to handle
         */
        public static final int SIGNAL_UNHANDLED = 0;

        /**
         * A known signal which should perform a noop
         */
        public static final int SIGNAL_NOOP = 1;

        public static final int TYPE_FOCUS = 2;

        /**
         * Tell the app that we no longer want to focus the WebView and should instead return keyboard focus to a
         * native answer input method.
         */
        public static final int RELINQUISH_FOCUS = 3;

        public static final int SHOW_ANSWER = 4;

        public static final int ANSWER_ORDINAL_1 = 5;

        public static final int ANSWER_ORDINAL_2 = 6;

        public static final int ANSWER_ORDINAL_3 = 7;

        public static final int ANSWER_ORDINAL_4 = 8;

        public static int getSignalFromUrl(String url) {
<span class="nc bnc" id="L4793" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5410)) {</span>
<span class="nc bnc" id="L4794" title="All 8 branches missed.">                switch(url) {</span>
                    case &quot;signal:typefocus&quot;:
<span class="nc" id="L4796">                        return TYPE_FOCUS;</span>
                    case &quot;signal:relinquishFocus&quot;:
<span class="nc" id="L4798">                        return RELINQUISH_FOCUS;</span>
                    case &quot;signal:show_answer&quot;:
<span class="nc" id="L4800">                        return SHOW_ANSWER;</span>
                    case &quot;signal:answer_ease1&quot;:
<span class="nc" id="L4802">                        return ANSWER_ORDINAL_1;</span>
                    case &quot;signal:answer_ease2&quot;:
<span class="nc" id="L4804">                        return ANSWER_ORDINAL_2;</span>
                    case &quot;signal:answer_ease3&quot;:
<span class="nc" id="L4806">                        return ANSWER_ORDINAL_3;</span>
                    case &quot;signal:answer_ease4&quot;:
<span class="nc" id="L4808">                        return ANSWER_ORDINAL_4;</span>
                    default:
                        break;
                }
            }
<span class="nc bnc" id="L4813" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5412)) {</span>
<span class="nc bnc" id="L4814" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:answer_ease&quot;)) {</span>
<span class="nc bnc" id="L4815" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5411)) {</span>
<span class="nc" id="L4816">                        Timber.w(&quot;Unhandled signal: ease value: %s&quot;, url);</span>
                    }
<span class="nc" id="L4818">                    return SIGNAL_NOOP;</span>
                }
            }
            // unknown, or not a signal.
<span class="nc" id="L4822">            return SIGNAL_UNHANDLED;</span>
        }
    }

    protected class CardViewerWebClient extends WebViewClient {

        private WebViewAssetLoader mLoader;

<span class="nc" id="L4830">        CardViewerWebClient(WebViewAssetLoader loader) {</span>
<span class="nc" id="L4831">            super();</span>
<span class="nc bnc" id="L4832" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5413)) {</span>
<span class="nc" id="L4833">                mLoader = loader;</span>
            }
<span class="nc" id="L4835">        }</span>

        @Override
        @TargetApi(Build.VERSION_CODES.N)
        public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
<span class="nc" id="L4840">            String url = request.getUrl().toString();</span>
<span class="nc bnc" id="L4841" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5414)) {</span>
<span class="nc" id="L4842">                Timber.d(&quot;Obtained URL from card: '%s'&quot;, url);</span>
            }
<span class="nc" id="L4844">            return filterUrl(url);</span>
        }

        @Nullable
        @Override
        // required for lower APIs (I think)
        @SuppressWarnings(&quot;deprecation&quot;)
        public WebResourceResponse shouldInterceptRequest(WebView view, String url) {
<span class="nc bnc" id="L4852" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5416)) {</span>
                // response is null if nothing required
<span class="nc bnc" id="L4854" title="All 2 branches missed.">                if (isLoadedFromProtocolRelativeUrl(url)) {</span>
<span class="nc bnc" id="L4855" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5415)) {</span>
<span class="nc" id="L4856">                        mMissingImageHandler.processInefficientImage(AbstractFlashcardViewer.this::displayMediaUpgradeRequiredSnackbar);</span>
                    }
                }
            }
<span class="nc" id="L4860">            return null;</span>
        }

        @Override
        @TargetApi(Build.VERSION_CODES.N)
        public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) {
<span class="nc" id="L4866">            WebResourceResponse result = mLoader.shouldInterceptRequest(request.getUrl());</span>
<span class="nc bnc" id="L4867" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5417)) {</span>
<span class="nc bnc" id="L4868" title="All 2 branches missed.">                if (result != null) {</span>
<span class="nc" id="L4869">                    return result;</span>
                }
            }
<span class="nc bnc" id="L4872" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5420)) {</span>
<span class="nc bnc" id="L4873" title="All 2 branches missed.">                if (!AdaptionUtil.hasWebBrowser(getBaseContext())) {</span>
<span class="nc" id="L4874">                    String scheme = request.getUrl().getScheme().trim();</span>
<span class="nc bnc" id="L4875" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5419)) {</span>
<span class="nc bnc" id="L4876" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(5418) ? (&quot;http&quot;.equalsIgnoreCase(scheme) &amp;&amp; &quot;https&quot;.equalsIgnoreCase(scheme)) : (&quot;http&quot;.equalsIgnoreCase(scheme) || &quot;https&quot;.equalsIgnoreCase(scheme)))) {</span>
<span class="nc" id="L4877">                            String response = getResources().getString(R.string.no_outgoing_link_in_cardbrowser);</span>
<span class="nc" id="L4878">                            return new WebResourceResponse(&quot;text/html&quot;, &quot;utf-8&quot;, new ByteArrayInputStream(response.getBytes()));</span>
                        }
                    }
                }
            }
<span class="nc bnc" id="L4883" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5422)) {</span>
<span class="nc bnc" id="L4884" title="All 2 branches missed.">                if (isLoadedFromProtocolRelativeUrl(request.getUrl().toString())) {</span>
<span class="nc bnc" id="L4885" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5421)) {</span>
<span class="nc" id="L4886">                        mMissingImageHandler.processInefficientImage(AbstractFlashcardViewer.this::displayMediaUpgradeRequiredSnackbar);</span>
                    }
                }
            }
<span class="nc" id="L4890">            return null;</span>
        }

        protected boolean isLoadedFromProtocolRelativeUrl(String url) {
            // because &lt;img src=&quot;x.png&quot;&gt; maps to file:///.../x.png
<span class="nc bnc" id="L4895" title="All 10 branches missed.">            return (ListenerUtil.mutListener.listen(5423) ? (url.startsWith(&quot;file://&quot;) || !url.startsWith(&quot;file:///&quot;)) : (url.startsWith(&quot;file://&quot;) &amp;&amp; !url.startsWith(&quot;file:///&quot;)));</span>
        }

        @Override
        public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) {
<span class="nc bnc" id="L4900" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5424)) {</span>
<span class="nc" id="L4901">                super.onReceivedError(view, request, error);</span>
            }
<span class="nc bnc" id="L4903" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5425)) {</span>
<span class="nc" id="L4904">                mMissingImageHandler.processFailure(request, AbstractFlashcardViewer.this::displayCouldNotFindMediaSnackbar);</span>
            }
<span class="nc" id="L4906">        }</span>

        @Override
        public void onReceivedHttpError(WebView view, WebResourceRequest request, WebResourceResponse errorResponse) {
<span class="nc bnc" id="L4910" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5426)) {</span>
<span class="nc" id="L4911">                super.onReceivedHttpError(view, request, errorResponse);</span>
            }
<span class="nc bnc" id="L4913" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5427)) {</span>
<span class="nc" id="L4914">                mMissingImageHandler.processFailure(request, AbstractFlashcardViewer.this::displayCouldNotFindMediaSnackbar);</span>
            }
<span class="nc" id="L4916">        }</span>

        @Override
        // tracked as #5017 in github
        @SuppressWarnings(&quot;deprecation&quot;)
        public boolean shouldOverrideUrlLoading(WebView view, String url) {
<span class="nc" id="L4922">            return filterUrl(url);</span>
        }

        // We play sounds through these links when a user taps the sound icon.
        private boolean filterUrl(String url) {
<span class="nc bnc" id="L4927" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5430)) {</span>
<span class="nc bnc" id="L4928" title="All 2 branches missed.">                if (url.startsWith(&quot;playsound:&quot;)) {</span>
                    // Send a message that will be handled on the UI thread.
<span class="nc" id="L4930">                    Message msg = Message.obtain();</span>
<span class="nc bnc" id="L4931" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5428)) {</span>
<span class="nc" id="L4932">                        msg.obj = url.replaceFirst(&quot;playsound:&quot;, &quot;&quot;);</span>
                    }
<span class="nc bnc" id="L4934" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5429)) {</span>
<span class="nc" id="L4935">                        mHandler.sendMessage(msg);</span>
                    }
<span class="nc" id="L4937">                    return true;</span>
                }
            }
<span class="nc bnc" id="L4940" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5432)) {</span>
<span class="nc bnc" id="L4941" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(5431) ? (url.startsWith(&quot;file&quot;) &amp;&amp; url.startsWith(&quot;data:&quot;)) : (url.startsWith(&quot;file&quot;) || url.startsWith(&quot;data:&quot;)))) {</span>
                    // Let the webview load files, i.e. local images.
<span class="nc" id="L4943">                    return false;</span>
                }
            }
<span class="nc bnc" id="L4946" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5435)) {</span>
<span class="nc bnc" id="L4947" title="All 2 branches missed.">                if (url.startsWith(&quot;typeblurtext:&quot;)) {</span>
<span class="nc bnc" id="L4948" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5433)) {</span>
                        // Store the text the javascript has send usâ€¦
<span class="nc" id="L4950">                        mTypeInput = decodeUrl(url.replaceFirst(&quot;typeblurtext:&quot;, &quot;&quot;));</span>
                    }
<span class="nc bnc" id="L4952" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5434)) {</span>
                        // â€¦ and show the â€œSHOW ANSWERâ€ button again.
<span class="nc" id="L4954">                        mFlipCardLayout.setVisibility(View.VISIBLE);</span>
                    }
<span class="nc" id="L4956">                    return true;</span>
                }
            }
<span class="nc bnc" id="L4959" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5438)) {</span>
<span class="nc bnc" id="L4960" title="All 2 branches missed.">                if (url.startsWith(&quot;typeentertext:&quot;)) {</span>
<span class="nc bnc" id="L4961" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5436)) {</span>
                        // Store the text the javascript has send usâ€¦
<span class="nc" id="L4963">                        mTypeInput = decodeUrl(url.replaceFirst(&quot;typeentertext:&quot;, &quot;&quot;));</span>
                    }
<span class="nc bnc" id="L4965" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5437)) {</span>
                        // â€¦ and show the answer.
<span class="nc" id="L4967">                        mFlipCardLayout.performClick();</span>
                    }
<span class="nc" id="L4969">                    return true;</span>
                }
            }
<span class="nc bnc" id="L4972" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5442)) {</span>
                // Show options menu from WebView
<span class="nc bnc" id="L4974" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:anki_show_options_menu&quot;)) {</span>
<span class="nc bnc" id="L4975" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5441)) {</span>
<span class="nc bnc" id="L4976" title="All 2 branches missed.">                        if (isFullscreen()) {</span>
<span class="nc bnc" id="L4977" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5440)) {</span>
<span class="nc" id="L4978">                                openOptionsMenu();</span>
                            }
                        } else {
<span class="nc bnc" id="L4981" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5439)) {</span>
<span class="nc" id="L4982">                                UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.ankidroid_turn_on_fullscreen_options_menu), true);</span>
                            }
                        }
                    }
<span class="nc" id="L4986">                    return true;</span>
                }
            }
<span class="nc bnc" id="L4989" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5446)) {</span>
                // Show Navigation Drawer from WebView
<span class="nc bnc" id="L4991" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:anki_show_navigation_drawer&quot;)) {</span>
<span class="nc bnc" id="L4992" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5445)) {</span>
<span class="nc bnc" id="L4993" title="All 2 branches missed.">                        if (isFullscreen()) {</span>
<span class="nc bnc" id="L4994" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5444)) {</span>
<span class="nc" id="L4995">                                AbstractFlashcardViewer.this.onNavigationPressed();</span>
                            }
                        } else {
<span class="nc bnc" id="L4998" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5443)) {</span>
<span class="nc" id="L4999">                                UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.ankidroid_turn_on_fullscreen_nav_drawer), true);</span>
                            }
                        }
                    }
<span class="nc" id="L5003">                    return true;</span>
                }
            }
<span class="nc bnc" id="L5006" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5448)) {</span>
                // card.html reload
<span class="nc bnc" id="L5008" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:reload_card_html&quot;)) {</span>
<span class="nc bnc" id="L5009" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5447)) {</span>
<span class="nc" id="L5010">                        redrawCard();</span>
                    }
<span class="nc" id="L5012">                    return true;</span>
                }
            }
<span class="nc bnc" id="L5015" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5453)) {</span>
                // mark card using javascript
<span class="nc bnc" id="L5017" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:mark_current_card&quot;)) {</span>
<span class="nc bnc" id="L5018" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5452)) {</span>
<span class="nc bnc" id="L5019" title="All 2 branches missed.">                        if (isAnkiApiNull(&quot;markCard&quot;)) {</span>
<span class="nc bnc" id="L5020" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5451)) {</span>
<span class="nc" id="L5021">                                showDeveloperContact(ankiJsErrorCodeDefault);</span>
                            }
<span class="nc" id="L5023">                            return true;</span>
<span class="nc bnc" id="L5024" title="All 2 branches missed.">                        } else if (mJsApiListMap.get(&quot;markCard&quot;)) {</span>
<span class="nc bnc" id="L5025" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5450)) {</span>
<span class="nc" id="L5026">                                executeCommand(COMMAND_MARK);</span>
                            }
                        } else {
<span class="nc bnc" id="L5029" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5449)) {</span>
                                // see 02-string.xml
<span class="nc" id="L5031">                                showDeveloperContact(ankiJsErrorCodeMarkCard);</span>
                            }
                        }
                    }
<span class="nc" id="L5035">                    return true;</span>
                }
            }
<span class="nc bnc" id="L5038" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5464)) {</span>
                // flag card (blue, green, orange, red) using javascript from AnkiDroid webview
<span class="nc bnc" id="L5040" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:flag_&quot;)) {</span>
<span class="nc bnc" id="L5041" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5456)) {</span>
<span class="nc bnc" id="L5042" title="All 2 branches missed.">                        if (isAnkiApiNull(&quot;toggleFlag&quot;)) {</span>
<span class="nc bnc" id="L5043" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5455)) {</span>
<span class="nc" id="L5044">                                showDeveloperContact(ankiJsErrorCodeDefault);</span>
                            }
<span class="nc" id="L5046">                            return true;</span>
<span class="nc bnc" id="L5047" title="All 2 branches missed.">                        } else if (!mJsApiListMap.get(&quot;toggleFlag&quot;)) {</span>
<span class="nc bnc" id="L5048" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(5454)) {</span>
                                // see 02-string.xml
<span class="nc" id="L5050">                                showDeveloperContact(ankiJsErrorCodeFlagCard);</span>
                            }
<span class="nc" id="L5052">                            return true;</span>
                        }
                    }
<span class="nc" id="L5055">                    String mFlag = url.replaceFirst(&quot;signal:flag_&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L5056" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5463)) {</span>
<span class="nc bnc" id="L5057" title="All 6 branches missed.">                        switch(mFlag) {</span>
                            case &quot;none&quot;:
<span class="nc bnc" id="L5059" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5457)) {</span>
<span class="nc" id="L5060">                                    executeCommand(COMMAND_UNSET_FLAG);</span>
                                }
<span class="nc" id="L5062">                                return true;</span>
                            case &quot;red&quot;:
<span class="nc bnc" id="L5064" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5458)) {</span>
<span class="nc" id="L5065">                                    executeCommand(COMMAND_TOGGLE_FLAG_RED);</span>
                                }
<span class="nc" id="L5067">                                return true;</span>
                            case &quot;orange&quot;:
<span class="nc bnc" id="L5069" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5459)) {</span>
<span class="nc" id="L5070">                                    executeCommand(COMMAND_TOGGLE_FLAG_ORANGE);</span>
                                }
<span class="nc" id="L5072">                                return true;</span>
                            case &quot;green&quot;:
<span class="nc bnc" id="L5074" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5460)) {</span>
<span class="nc" id="L5075">                                    executeCommand(COMMAND_TOGGLE_FLAG_GREEN);</span>
                                }
<span class="nc" id="L5077">                                return true;</span>
                            case &quot;blue&quot;:
<span class="nc bnc" id="L5079" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5461)) {</span>
<span class="nc" id="L5080">                                    executeCommand(COMMAND_TOGGLE_FLAG_BLUE);</span>
                                }
<span class="nc" id="L5082">                                return true;</span>
                            default:
<span class="nc bnc" id="L5084" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5462)) {</span>
<span class="nc" id="L5085">                                    Timber.d(&quot;No such Flag found.&quot;);</span>
                                }
<span class="nc" id="L5087">                                return true;</span>
                        }
                    }
                }
            }
<span class="nc bnc" id="L5092" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5466)) {</span>
                // Show toast using JS
<span class="nc bnc" id="L5094" title="All 2 branches missed.">                if (url.startsWith(&quot;signal:anki_show_toast:&quot;)) {</span>
<span class="nc" id="L5095">                    String msg = url.replaceFirst(&quot;signal:anki_show_toast:&quot;, &quot;&quot;);</span>
<span class="nc" id="L5096">                    String msgDecode = decodeUrl(msg);</span>
<span class="nc bnc" id="L5097" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5465)) {</span>
<span class="nc" id="L5098">                        UIUtils.showThemedToast(AbstractFlashcardViewer.this, msgDecode, true);</span>
                    }
<span class="nc" id="L5100">                    return true;</span>
                }
            }
<span class="nc" id="L5103">            int signalOrdinal = WebViewSignalParserUtils.getSignalFromUrl(url);</span>
<span class="nc bnc" id="L5104" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5476)) {</span>
<span class="nc bnc" id="L5105" title="All 10 branches missed.">                switch(signalOrdinal) {</span>
                    case WebViewSignalParserUtils.SIGNAL_UNHANDLED:
                        // continue parsing
<span class="nc" id="L5108">                        break;</span>
                    case WebViewSignalParserUtils.SIGNAL_NOOP:
<span class="nc" id="L5110">                        return true;</span>
                    case WebViewSignalParserUtils.TYPE_FOCUS:
<span class="nc bnc" id="L5112" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5467)) {</span>
                            // space by itself.
<span class="nc" id="L5114">                            mFlipCardLayout.setVisibility(View.GONE);</span>
                        }
<span class="nc" id="L5116">                        return true;</span>
                    case WebViewSignalParserUtils.RELINQUISH_FOCUS:
<span class="nc bnc" id="L5118" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5468)) {</span>
                            // #5811 - The WebView could be focused via mouse. Allow components to return focus to Android.
<span class="nc" id="L5120">                            focusAnswerCompletionField();</span>
                        }
<span class="nc" id="L5122">                        return true;</span>
                    /*
                 *  Call displayCardAnswer() and answerCard() from anki deck template using javascript
                 *  See card.js in assets/scripts folder
                 */
                    case WebViewSignalParserUtils.SHOW_ANSWER:
<span class="nc bnc" id="L5128" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5470)) {</span>
                            // display answer when showAnswer() called from card.js
<span class="nc bnc" id="L5130" title="All 2 branches missed.">                            if (!sDisplayAnswer) {</span>
<span class="nc bnc" id="L5131" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5469)) {</span>
<span class="nc" id="L5132">                                    displayCardAnswer();</span>
                                }
                            }
                        }
<span class="nc" id="L5136">                        return true;</span>
                    case WebViewSignalParserUtils.ANSWER_ORDINAL_1:
<span class="nc bnc" id="L5138" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5471)) {</span>
<span class="nc" id="L5139">                            flipOrAnswerCard(EASE_1);</span>
                        }
<span class="nc" id="L5141">                        return true;</span>
                    case WebViewSignalParserUtils.ANSWER_ORDINAL_2:
<span class="nc bnc" id="L5143" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5472)) {</span>
<span class="nc" id="L5144">                            flipOrAnswerCard(EASE_2);</span>
                        }
<span class="nc" id="L5146">                        return true;</span>
                    case WebViewSignalParserUtils.ANSWER_ORDINAL_3:
<span class="nc bnc" id="L5148" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5473)) {</span>
<span class="nc" id="L5149">                            flipOrAnswerCard(EASE_3);</span>
                        }
<span class="nc" id="L5151">                        return true;</span>
                    case WebViewSignalParserUtils.ANSWER_ORDINAL_4:
<span class="nc bnc" id="L5153" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5474)) {</span>
<span class="nc" id="L5154">                            flipOrAnswerCard(EASE_4);</span>
                        }
<span class="nc" id="L5156">                        return true;</span>
                    default:
<span class="nc bnc" id="L5158" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5475)) {</span>
                            // This is not the same as SIGNAL_UNHANDLED, where it isn't a known signal.
<span class="nc" id="L5160">                            Timber.w(&quot;Unhandled signal case: %d&quot;, signalOrdinal);</span>
                        }
<span class="nc" id="L5162">                        return true;</span>
                }
            }
<span class="nc" id="L5165">            Intent intent = null;</span>
            try {
<span class="nc bnc" id="L5167" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5489)) {</span>
<span class="nc bnc" id="L5168" title="All 2 branches missed.">                    if (url.startsWith(&quot;intent:&quot;)) {</span>
<span class="nc bnc" id="L5169" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5488)) {</span>
<span class="nc" id="L5170">                            intent = Intent.parseUri(url, Intent.URI_INTENT_SCHEME);</span>
                        }
<span class="nc bnc" id="L5172" title="All 2 branches missed.">                    } else if (url.startsWith(&quot;android-app:&quot;)) {</span>
<span class="nc bnc" id="L5173" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5487)) {</span>
<span class="nc bnc" id="L5174" title="All 22 branches missed.">                            if ((ListenerUtil.mutListener.listen(5482) ? (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP_MR1) : (ListenerUtil.mutListener.listen(5481) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.LOLLIPOP_MR1) : (ListenerUtil.mutListener.listen(5480) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.LOLLIPOP_MR1) : (ListenerUtil.mutListener.listen(5479) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.LOLLIPOP_MR1) : (ListenerUtil.mutListener.listen(5478) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP_MR1) : (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP_MR1))))))) {</span>
<span class="nc bnc" id="L5175" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5484)) {</span>
<span class="nc" id="L5176">                                    intent = Intent.parseUri(url, 0);</span>
                                }
<span class="nc bnc" id="L5178" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5485)) {</span>
<span class="nc" id="L5179">                                    intent.setData(null);</span>
                                }
<span class="nc bnc" id="L5181" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5486)) {</span>
<span class="nc" id="L5182">                                    intent.setPackage(Uri.parse(url).getHost());</span>
                                }
                            } else {
<span class="nc bnc" id="L5185" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5483)) {</span>
<span class="nc" id="L5186">                                    intent = Intent.parseUri(url, Intent.URI_ANDROID_APP_SCHEME);</span>
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L5192" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5499)) {</span>
<span class="nc bnc" id="L5193" title="All 2 branches missed.">                    if (intent != null) {</span>
<span class="nc bnc" id="L5194" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5498)) {</span>
<span class="nc bnc" id="L5195" title="All 2 branches missed.">                            if (getPackageManager().resolveActivity(intent, 0) == null) {</span>
<span class="nc" id="L5196">                                String packageName = intent.getPackage();</span>
<span class="nc bnc" id="L5197" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5497)) {</span>
<span class="nc bnc" id="L5198" title="All 2 branches missed.">                                    if (packageName == null) {</span>
<span class="nc bnc" id="L5199" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5495)) {</span>
<span class="nc" id="L5200">                                            Timber.d(&quot;Not using resolved intent uri because not available: %s&quot;, intent);</span>
                                        }
<span class="nc bnc" id="L5202" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5496)) {</span>
<span class="nc" id="L5203">                                            intent = null;</span>
                                        }
                                    } else {
<span class="nc bnc" id="L5206" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5491)) {</span>
<span class="nc" id="L5207">                                            Timber.d(&quot;Resolving intent uri to market uri because not available: %s&quot;, intent);</span>
                                        }
<span class="nc bnc" id="L5209" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5492)) {</span>
<span class="nc" id="L5210">                                            intent = new Intent(Intent.ACTION_VIEW, Uri.parse(&quot;market://details?id=&quot; + packageName));</span>
                                        }
<span class="nc bnc" id="L5212" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(5494)) {</span>
<span class="nc bnc" id="L5213" title="All 2 branches missed.">                                            if (getPackageManager().resolveActivity(intent, 0) == null) {</span>
<span class="nc bnc" id="L5214" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(5493)) {</span>
<span class="nc" id="L5215">                                                    intent = null;</span>
                                                }
                                            }
                                        }
                                    }
                                }
<span class="nc" id="L5221">                            } else {</span>
<span class="nc bnc" id="L5222" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5490)) {</span>
                                    // https://developer.chrome.com/multidevice/android/intents says that we should remove this
<span class="nc" id="L5224">                                    intent.addCategory(Intent.CATEGORY_BROWSABLE);</span>
                                }
                            }
                        }
                    }
                }
<span class="nc" id="L5230">            } catch (Throwable t) {</span>
<span class="nc bnc" id="L5231" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5477)) {</span>
<span class="nc" id="L5232">                    Timber.w(&quot;Unable to parse intent uri: %s because: %s&quot;, url, t.getMessage());</span>
                }
<span class="nc" id="L5234">            }</span>
<span class="nc bnc" id="L5235" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5503)) {</span>
<span class="nc bnc" id="L5236" title="All 2 branches missed.">                if (intent == null) {</span>
<span class="nc bnc" id="L5237" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5501)) {</span>
<span class="nc" id="L5238">                        Timber.d(&quot;Opening external link \&quot;%s\&quot; with an Intent&quot;, url);</span>
                    }
<span class="nc bnc" id="L5240" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5502)) {</span>
<span class="nc" id="L5241">                        intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));</span>
                    }
                } else {
<span class="nc bnc" id="L5244" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5500)) {</span>
<span class="nc" id="L5245">                        Timber.d(&quot;Opening resolved external link \&quot;%s\&quot; with an Intent: %s&quot;, url, intent);</span>
                    }
                }
            }
            try {
<span class="nc bnc" id="L5250" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5505)) {</span>
<span class="nc" id="L5251">                    startActivityWithoutAnimation(intent);</span>
                }
<span class="nc" id="L5253">            } catch (ActivityNotFoundException e) {</span>
<span class="nc bnc" id="L5254" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5504)) {</span>
                    // Don't crash if the intent is not handled
<span class="nc" id="L5256">                    e.printStackTrace();</span>
                }
<span class="nc" id="L5258">            }</span>
<span class="nc" id="L5259">            return true;</span>
        }

        private String decodeUrl(String url) {
            try {
<span class="nc" id="L5264">                return URLDecoder.decode(url, &quot;UTF-8&quot;);</span>
<span class="nc" id="L5265">            } catch (UnsupportedEncodingException e) {</span>
<span class="nc bnc" id="L5266" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5506)) {</span>
<span class="nc" id="L5267">                    Timber.e(e, &quot;UTF-8 isn't supported as an encoding?&quot;);</span>
                }
<span class="nc" id="L5269">            } catch (Exception e) {</span>
<span class="nc bnc" id="L5270" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5507)) {</span>
<span class="nc" id="L5271">                    Timber.e(e, &quot;Exception decoding: '%s'&quot;, url);</span>
                }
<span class="nc bnc" id="L5273" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5508)) {</span>
<span class="nc" id="L5274">                    UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.card_viewer_url_decode_error), true);</span>
                }
<span class="nc" id="L5276">            }</span>
<span class="nc" id="L5277">            return &quot;&quot;;</span>
        }

        // Run any post-load events in javascript that rely on the window being completely loaded.
        @Override
        public void onPageFinished(WebView view, String url) {
<span class="nc bnc" id="L5283" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5509)) {</span>
<span class="nc" id="L5284">                Timber.d(&quot;Java onPageFinished triggered: %s&quot;, url);</span>
            }
<span class="nc bnc" id="L5286" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5514)) {</span>
                // onPageFinished will be called multiple times if the WebView redirects by setting window.location.href
<span class="nc bnc" id="L5288" title="All 2 branches missed.">                if (url.equals(mViewerUrl)) {</span>
<span class="nc bnc" id="L5289" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5510)) {</span>
<span class="nc" id="L5290">                        Timber.d(&quot;New URL, drawing flags, marks, and triggering JS onPageFinished: %s&quot;, url);</span>
                    }
<span class="nc bnc" id="L5292" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5511)) {</span>
<span class="nc" id="L5293">                        drawFlag();</span>
                    }
<span class="nc bnc" id="L5295" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5512)) {</span>
<span class="nc" id="L5296">                        drawMark();</span>
                    }
<span class="nc bnc" id="L5298" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5513)) {</span>
<span class="nc" id="L5299">                        view.loadUrl(&quot;javascript:onPageFinished();&quot;);</span>
                    }
                }
            }
<span class="nc" id="L5303">        }</span>

        /**
         * Fix: #5780 - WebView Renderer OOM crashes reviewer
         */
        @Override
        @TargetApi(Build.VERSION_CODES.O)
        public boolean onRenderProcessGone(WebView view, RenderProcessGoneDetail detail) {
<span class="nc bnc" id="L5311" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5515)) {</span>
<span class="nc" id="L5312">                Timber.i(&quot;Obtaining write lock for card&quot;);</span>
            }
<span class="nc" id="L5314">            Lock writeLock = mCardLock.writeLock();</span>
<span class="nc bnc" id="L5315" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5516)) {</span>
<span class="nc" id="L5316">                Timber.i(&quot;Obtained write lock for card&quot;);</span>
            }
            try {
<span class="nc bnc" id="L5319" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5519)) {</span>
<span class="nc" id="L5320">                    writeLock.lock();</span>
                }
<span class="nc bnc" id="L5322" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5522)) {</span>
<span class="nc bnc" id="L5323" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(5520) ? (mCardWebView == null &amp;&amp; !mCardWebView.equals(view)) : (mCardWebView == null || !mCardWebView.equals(view)))) {</span>
<span class="nc bnc" id="L5324" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5521)) {</span>
                            // We have nothing to handle. Returning false is a desire to crash, so return true.
<span class="nc" id="L5326">                            Timber.i(&quot;Unrelated WebView Renderer terminated. Crashed: %b&quot;, detail.didCrash());</span>
                        }
<span class="nc" id="L5328">                        return true;</span>
                    }
                }
<span class="nc bnc" id="L5331" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5523)) {</span>
<span class="nc" id="L5332">                    Timber.e(&quot;WebView Renderer process terminated. Crashed: %b&quot;, detail.didCrash());</span>
                }
<span class="nc bnc" id="L5334" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5524)) {</span>
                    // &quot;crash wasn't handled by all associated webviews, triggering application crash&quot;
<span class="nc" id="L5336">                    mCardFrame.removeAllViews();</span>
                }
<span class="nc bnc" id="L5338" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5525)) {</span>
<span class="nc" id="L5339">                    mCardFrameParent.removeView(mCardFrame);</span>
                }
<span class="nc bnc" id="L5341" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5526)) {</span>
                    // destroy after removal from the view - produces logcat warnings otherwise
<span class="nc" id="L5343">                    destroyWebView(mCardWebView);</span>
                }
<span class="nc bnc" id="L5345" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5527)) {</span>
<span class="nc" id="L5346">                    mCardWebView = null;</span>
                }
<span class="nc bnc" id="L5348" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5528)) {</span>
                    // inflate a new instance of mCardFrame
<span class="nc" id="L5350">                    mCardFrame = inflateNewView(R.id.flashcard);</span>
                }
<span class="nc bnc" id="L5352" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5529)) {</span>
                    // I'll keep this line unless I see another crash, which would point to another underlying issue.
<span class="nc" id="L5354">                    System.gc();</span>
                }
                // It's not necessarily an OOM crash, false implies a general code which is for &quot;system terminated&quot;.
<span class="nc bnc" id="L5357" title="All 2 branches missed.">                int errorCauseId = detail.didCrash() ? R.string.webview_crash_unknown : R.string.webview_crash_oom;</span>
<span class="nc" id="L5358">                String errorCauseString = getResources().getString(errorCauseId);</span>
<span class="nc bnc" id="L5359" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5533)) {</span>
<span class="nc bnc" id="L5360" title="All 2 branches missed.">                    if (!canRecoverFromWebViewRendererCrash()) {</span>
<span class="nc bnc" id="L5361" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5530)) {</span>
<span class="nc" id="L5362">                            Timber.e(&quot;Unrecoverable WebView Render crash&quot;);</span>
                        }
<span class="nc" id="L5364">                        String errorMessage = getResources().getString(R.string.webview_crash_fatal, errorCauseString);</span>
<span class="nc bnc" id="L5365" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5531)) {</span>
<span class="nc" id="L5366">                            UIUtils.showThemedToast(AbstractFlashcardViewer.this, errorMessage, false);</span>
                        }
<span class="nc bnc" id="L5368" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5532)) {</span>
<span class="nc" id="L5369">                            finishWithoutAnimation();</span>
                        }
<span class="nc" id="L5371">                        return true;</span>
                    }
                }
<span class="nc bnc" id="L5374" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5536)) {</span>
<span class="nc bnc" id="L5375" title="All 2 branches missed.">                    if (webViewRendererLastCrashedOnCard(mCurrentCard.getId())) {</span>
<span class="nc bnc" id="L5376" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5534)) {</span>
<span class="nc" id="L5377">                            Timber.e(&quot;Web Renderer crash loop on card: %d&quot;, mCurrentCard.getId());</span>
                        }
<span class="nc bnc" id="L5379" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5535)) {</span>
<span class="nc" id="L5380">                            displayRenderLoopDialog(mCurrentCard, detail);</span>
                        }
<span class="nc" id="L5382">                        return true;</span>
                    }
                }
<span class="nc bnc" id="L5385" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5537)) {</span>
                    // This logic may need to be better defined. The card could have changed by the time we get here.
<span class="nc" id="L5387">                    lastCrashingCardId = mCurrentCard.getId();</span>
                }
<span class="nc" id="L5389">                String nonFatalError = getResources().getString(R.string.webview_crash_nonfatal, errorCauseString);</span>
<span class="nc bnc" id="L5390" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5538)) {</span>
<span class="nc" id="L5391">                    UIUtils.showThemedToast(AbstractFlashcardViewer.this, nonFatalError, false);</span>
                }
<span class="nc bnc" id="L5393" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5539)) {</span>
                    // we need to add at index 0 so gestures still go through.
<span class="nc" id="L5395">                    mCardFrameParent.addView(mCardFrame, 0);</span>
                }
<span class="nc bnc" id="L5397" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5540)) {</span>
<span class="nc" id="L5398">                    recreateWebView();</span>
                }
            } finally {
<span class="nc bnc" id="L5401" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5517)) {</span>
<span class="nc" id="L5402">                    writeLock.unlock();</span>
                }
<span class="nc bnc" id="L5404" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5518)) {</span>
<span class="nc" id="L5405">                    Timber.d(&quot;Relinquished writeLock&quot;);</span>
                }
            }
<span class="nc bnc" id="L5408" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5541)) {</span>
<span class="nc" id="L5409">                displayCardQuestion();</span>
            }
            // We handled the crash and can continue.
<span class="nc" id="L5412">            return true;</span>
        }

        @TargetApi(Build.VERSION_CODES.O)
        private void displayRenderLoopDialog(Card currentCard, RenderProcessGoneDetail detail) {
<span class="nc" id="L5417">            String cardInformation = Long.toString(currentCard.getId());</span>
<span class="nc" id="L5418">            Resources res = getResources();</span>
<span class="nc bnc" id="L5419" title="All 2 branches missed.">            String errorDetails = detail.didCrash() ? res.getString(R.string.webview_crash_unknwon_detailed) : res.getString(R.string.webview_crash_oom_details);</span>
<span class="nc bnc" id="L5420" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5542)) {</span>
<span class="nc" id="L5421">                new MaterialDialog.Builder(AbstractFlashcardViewer.this).title(res.getString(R.string.webview_crash_loop_dialog_title)).content(res.getString(R.string.webview_crash_loop_dialog_content, cardInformation, errorDetails)).positiveText(R.string.dialog_ok).cancelable(false).canceledOnTouchOutside(false).onPositive((materialDialog, dialogAction) -&gt; finishWithoutAnimation()).show();</span>
            }
<span class="nc" id="L5423">        }</span>
    }

    private void displayCouldNotFindMediaSnackbar(String filename) {
<span class="nc" id="L5427">        OnClickListener onClickListener = (v) -&gt; openUrl(Uri.parse(getString(R.string.link_faq_missing_media)));</span>
<span class="nc bnc" id="L5428" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5543)) {</span>
<span class="nc" id="L5429">            showSnackbar(getString(R.string.card_viewer_could_not_find_image, filename), R.string.help, onClickListener);</span>
        }
<span class="nc" id="L5431">    }</span>

    private void displayMediaUpgradeRequiredSnackbar() {
<span class="nc" id="L5434">        OnClickListener onClickListener = (v) -&gt; openUrl(Uri.parse(getString(R.string.link_faq_invalid_protocol_relative)));</span>
<span class="nc bnc" id="L5435" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5544)) {</span>
<span class="nc" id="L5436">            showSnackbar(getString(R.string.card_viewer_media_relative_protocol), R.string.help, onClickListener);</span>
        }
<span class="nc" id="L5438">    }</span>

    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
    protected String getTypedInputText() {
<span class="nc" id="L5442">        return mTypeInput;</span>
    }

    @SuppressLint(&quot;WebViewApiAvailability&quot;)
    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
    void handleUrlFromJavascript(String url) {
<span class="nc bnc" id="L5448" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5552)) {</span>
<span class="nc bnc" id="L5449" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(5549) ? (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(5548) ? (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(5547) ? (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(5546) ? (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) : (ListenerUtil.mutListener.listen(5545) ? (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) : (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O))))))) {</span>
                // WebViewCompat recommended here, but I'll avoid the dependency as it's test code
<span class="nc" id="L5451">                CardViewerWebClient c = ((CardViewerWebClient) this.mCardWebView.getWebViewClient());</span>
<span class="nc bnc" id="L5452" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5550)) {</span>
<span class="nc bnc" id="L5453" title="All 2 branches missed.">                    if (c == null) {</span>
<span class="nc" id="L5454">                        throw new IllegalStateException(&quot;Couldn't obtain WebView - maybe it wasn't created yet&quot;);</span>
                    }
                }
<span class="nc bnc" id="L5457" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5551)) {</span>
<span class="nc" id="L5458">                    c.filterUrl(url);</span>
                }
<span class="nc" id="L5460">            } else {</span>
<span class="nc" id="L5461">                throw new IllegalStateException(&quot;Can't get WebViewClient due to Android API&quot;);</span>
            }
        }
<span class="nc" id="L5464">    }</span>

    // Check if value null
    private boolean isAnkiApiNull(String api) {
<span class="nc bnc" id="L5468" title="All 2 branches missed.">        return mJsApiListMap.get(api) == null;</span>
    }

    /*
     * see 02-strings.xml
     * Show Error code when mark card or flag card unsupported
     * 1 - mark card
     * 2 - flag card
     *
     * show developer contact if js api used in card is deprecated
     */
    private void showDeveloperContact(int errorCode) {
<span class="nc" id="L5480">        String errorMsg = getString(R.string.anki_js_error_code, errorCode);</span>
<span class="nc" id="L5481">        View parentLayout = findViewById(android.R.id.content);</span>
<span class="nc" id="L5482">        String snackbarMsg = getString(R.string.api_version_developer_contact, mCardSuppliedDeveloperContact, errorMsg);</span>
<span class="nc" id="L5483">        Snackbar snackbar = Snackbar.make(parentLayout, snackbarMsg, Snackbar.LENGTH_LONG);</span>
<span class="nc" id="L5484">        View snackbarView = snackbar.getView();</span>
<span class="nc" id="L5485">        TextView snackTextView = snackbarView.findViewById(com.google.android.material.R.id.snackbar_text);</span>
<span class="nc bnc" id="L5486" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5553)) {</span>
<span class="nc" id="L5487">            snackTextView.setTextColor(Color.WHITE);</span>
        }
<span class="nc bnc" id="L5489" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5554)) {</span>
<span class="nc" id="L5490">            snackTextView.setMaxLines(3);</span>
        }
<span class="nc bnc" id="L5492" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5555)) {</span>
<span class="nc" id="L5493">            snackbar.setActionTextColor(Color.MAGENTA).setAction(getString(R.string.reviewer_invalid_api_version_visit_documentation), view -&gt; openUrl(Uri.parse(&quot;https://github.com/ankidroid/Anki-Android/wiki&quot;)));</span>
        }
<span class="nc bnc" id="L5495" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5556)) {</span>
<span class="nc" id="L5496">            snackbar.show();</span>
        }
<span class="nc" id="L5498">    }</span>

    /**
     * Supplied api version must be equal to current api version to call mark card, toggle flag functions etc.
     */
    private boolean requireApiVersion(String apiVer, String apiDevContact) {
        try {
<span class="nc bnc" id="L5505" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5558)) {</span>
<span class="nc bnc" id="L5506" title="All 2 branches missed.">                if (TextUtils.isEmpty(apiDevContact)) {</span>
<span class="nc" id="L5507">                    return false;</span>
                }
            }
<span class="nc" id="L5510">            Version mVersionCurrent = Version.valueOf(sCurrentJsApiVersion);</span>
<span class="nc" id="L5511">            Version mVersionSupplied = Version.valueOf(apiVer);</span>
<span class="nc bnc" id="L5512" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5561)) {</span>
                /*
            * if api major version equals to supplied major version then return true and also check for minor version and patch version
            * show toast for update and contact developer if need updates
            * otherwise return false
            */
<span class="nc bnc" id="L5518" title="All 2 branches missed.">                if (mVersionSupplied.equals(mVersionCurrent)) {</span>
<span class="nc" id="L5519">                    return true;</span>
<span class="nc bnc" id="L5520" title="All 2 branches missed.">                } else if (mVersionSupplied.lessThan(mVersionCurrent)) {</span>
<span class="nc bnc" id="L5521" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5560)) {</span>
<span class="nc" id="L5522">                        UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.update_js_api_version, mCardSuppliedDeveloperContact), false);</span>
                    }
<span class="nc" id="L5524">                    return mVersionSupplied.greaterThanOrEqualTo(Version.valueOf(sMinimumJsApiVersion));</span>
                } else {
<span class="nc bnc" id="L5526" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5559)) {</span>
<span class="nc" id="L5527">                        UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.valid_js_api_version, mCardSuppliedDeveloperContact), false);</span>
                    }
<span class="nc" id="L5529">                    return false;</span>
                }
            }
<span class="nc" id="L5532">        } catch (Exception e) {</span>
<span class="nc bnc" id="L5533" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5557)) {</span>
<span class="nc" id="L5534">                Timber.w(e, &quot;requireApiVersion::exception&quot;);</span>
            }
<span class="nc" id="L5536">        }</span>
<span class="nc" id="L5537">        return false;</span>
    }

    @VisibleForTesting
    void loadInitialCard() {
<span class="nc bnc" id="L5542" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5562)) {</span>
<span class="nc" id="L5543">            TaskManager.launchCollectionTask(new CollectionTask.GetCard(), mAnswerCardHandler(false));</span>
        }
<span class="nc" id="L5545">    }</span>

    public ReviewerUi.ControlBlock getControlBlocked() {
<span class="nc" id="L5548">        return mControlBlocked;</span>
    }

    public boolean isDisplayingAnswer() {
<span class="nc" id="L5552">        return sDisplayAnswer;</span>
    }

    public boolean isControlBlocked() {
<span class="nc bnc" id="L5556" title="All 2 branches missed.">        return getControlBlocked() != ControlBlock.UNBLOCKED;</span>
    }

    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
    static void setEditorCard(Card card) {
<span class="nc bnc" id="L5561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5563)) {</span>
            // I don't see why we don't do this by intent.
<span class="nc" id="L5563">            sEditorCard = card;</span>
        }
<span class="nc" id="L5565">    }</span>

    @VisibleForTesting
    String getCorrectTypedAnswer() {
<span class="nc" id="L5569">        return mTypeCorrect;</span>
    }

    @VisibleForTesting
    String getCardContent() {
<span class="nc" id="L5574">        return mCardContent;</span>
    }

    protected void showTagsDialog() {
<span class="nc" id="L5578">        ArrayList&lt;String&gt; tags = new ArrayList&lt;&gt;(getCol().getTags().all());</span>
<span class="nc" id="L5579">        ArrayList&lt;String&gt; selTags = new ArrayList&lt;&gt;(mCurrentCard.note().getTags());</span>
<span class="nc" id="L5580">        TagsDialog.TagsDialogListener tagsDialogListener = (selectedTags, option) -&gt; {</span>
<span class="nc bnc" id="L5581" title="All 2 branches missed.">            if (!mCurrentCard.note().getTags().equals(selectedTags)) {</span>
<span class="nc" id="L5582">                String tagString = TextUtils.join(&quot; &quot;, selectedTags);</span>
<span class="nc" id="L5583">                Note note = mCurrentCard.note();</span>
<span class="nc" id="L5584">                note.setTagsFromStr(tagString);</span>
<span class="nc" id="L5585">                note.flush();</span>
                // Reload current card to reflect tag changes
<span class="nc" id="L5587">                displayCardQuestion(true);</span>
            }
<span class="nc" id="L5589">        };</span>
<span class="nc" id="L5590">        TagsDialog dialog = TagsDialog.newInstance(TagsDialog.TYPE_ADD_TAG, selTags, tags);</span>
<span class="nc bnc" id="L5591" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5564)) {</span>
<span class="nc" id="L5592">            dialog.setTagsDialogListener(tagsDialogListener);</span>
        }
<span class="nc bnc" id="L5594" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5565)) {</span>
<span class="nc" id="L5595">            showDialogFragment(dialog);</span>
        }
<span class="nc" id="L5597">    }</span>

    // init or reset api list
    private void jsApiInit() {
<span class="nc bnc" id="L5601" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5566)) {</span>
<span class="nc" id="L5602">            mCardSuppliedApiVersion = &quot;&quot;;</span>
        }
<span class="nc bnc" id="L5604" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5567)) {</span>
<span class="nc" id="L5605">            mCardSuppliedDeveloperContact = &quot;&quot;;</span>
        }
<span class="nc bnc" id="L5607" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(5569)) {</span>
            {
<span class="nc" id="L5609">                long _loopCounter103 = 0;</span>
<span class="nc bnc" id="L5610" title="All 2 branches missed.">                for (String api : mApiList) {</span>
<span class="nc" id="L5611">                    ListenerUtil.loopListener.listen(&quot;_loopCounter103&quot;, ++_loopCounter103);</span>
<span class="nc bnc" id="L5612" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5568)) {</span>
<span class="nc" id="L5613">                        mJsApiListMap.put(api, false);</span>
                    }
                }
            }
        }
<span class="nc" id="L5618">    }</span>

    // list of api that can be accessed
<span class="nc" id="L5621">    private final String[] mApiList = { &quot;toggleFlag&quot;, &quot;markCard&quot; };</span>

    // JS api list enable/disable status
<span class="nc" id="L5624">    private final HashMap&lt;String, Boolean&gt; mJsApiListMap = new HashMap&lt;&gt;(mApiList.length);</span>

    public JavaScriptFunction javaScriptFunction() {
<span class="nc" id="L5627">        return new JavaScriptFunction();</span>
    }

<span class="nc" id="L5630">    public class JavaScriptFunction {</span>

        // if supplied api version match then enable api
        private void enableJsApi() {
<span class="nc bnc" id="L5634" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(5571)) {</span>
                {
<span class="nc" id="L5636">                    long _loopCounter104 = 0;</span>
<span class="nc bnc" id="L5637" title="All 2 branches missed.">                    for (String api : mApiList) {</span>
<span class="nc" id="L5638">                        ListenerUtil.loopListener.listen(&quot;_loopCounter104&quot;, ++_loopCounter104);</span>
<span class="nc bnc" id="L5639" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5570)) {</span>
<span class="nc" id="L5640">                            mJsApiListMap.put(api, true);</span>
                        }
                    }
                }
            }
<span class="nc" id="L5645">        }</span>

        @JavascriptInterface
        public String init(String jsonData) {
            JSONObject data;
<span class="nc" id="L5650">            String apiStatusJson = &quot;&quot;;</span>
            try {
<span class="nc" id="L5652">                data = new JSONObject(jsonData);</span>
<span class="nc bnc" id="L5653" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5578)) {</span>
<span class="nc bnc" id="L5654" title="All 2 branches missed.">                    if (!(data == JSONObject.NULL)) {</span>
<span class="nc bnc" id="L5655" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5573)) {</span>
<span class="nc" id="L5656">                            mCardSuppliedApiVersion = data.optString(&quot;version&quot;, &quot;&quot;);</span>
                        }
<span class="nc bnc" id="L5658" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5574)) {</span>
<span class="nc" id="L5659">                            mCardSuppliedDeveloperContact = data.optString(&quot;developer&quot;, &quot;&quot;);</span>
                        }
<span class="nc bnc" id="L5661" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5576)) {</span>
<span class="nc bnc" id="L5662" title="All 2 branches missed.">                            if (requireApiVersion(mCardSuppliedApiVersion, mCardSuppliedDeveloperContact)) {</span>
<span class="nc bnc" id="L5663" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(5575)) {</span>
<span class="nc" id="L5664">                                    enableJsApi();</span>
                                }
                            }
                        }
<span class="nc bnc" id="L5668" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(5577)) {</span>
<span class="nc" id="L5669">                            apiStatusJson = JSONObject.fromMap(mJsApiListMap).toString();</span>
                        }
                    }
                }
<span class="nc" id="L5673">            } catch (JSONException j) {</span>
<span class="nc bnc" id="L5674" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5572)) {</span>
<span class="nc" id="L5675">                    UIUtils.showThemedToast(AbstractFlashcardViewer.this, getString(R.string.invalid_json_data, j.getLocalizedMessage()), false);</span>
                }
<span class="nc" id="L5677">            }</span>
<span class="nc" id="L5678">            return apiStatusJson;</span>
        }

        // It's overridden in the Reviewer, where those values are actually defined.
        @JavascriptInterface
        public String ankiGetNewCardCount() {
<span class="nc" id="L5684">            return &quot;-1&quot;;</span>
        }

        @JavascriptInterface
        public String ankiGetLrnCardCount() {
<span class="nc" id="L5689">            return &quot;-1&quot;;</span>
        }

        @JavascriptInterface
        public String ankiGetRevCardCount() {
<span class="nc" id="L5694">            return &quot;-1&quot;;</span>
        }

        @JavascriptInterface
        public int ankiGetETA() {
<span class="nc" id="L5699">            return -1;</span>
        }

        @JavascriptInterface
        public boolean ankiGetCardMark() {
<span class="nc" id="L5704">            return shouldDisplayMark();</span>
        }

        @JavascriptInterface
        public int ankiGetCardFlag() {
<span class="nc" id="L5709">            return mCurrentCard.userFlag();</span>
        }

        @JavascriptInterface
        public String ankiGetNextTime1() {
<span class="nc" id="L5714">            return (String) mNext1.getText();</span>
        }

        @JavascriptInterface
        public String ankiGetNextTime2() {
<span class="nc" id="L5719">            return (String) mNext2.getText();</span>
        }

        @JavascriptInterface
        public String ankiGetNextTime3() {
<span class="nc" id="L5724">            return (String) mNext3.getText();</span>
        }

        @JavascriptInterface
        public String ankiGetNextTime4() {
<span class="nc" id="L5729">            return (String) mNext4.getText();</span>
        }

        @JavascriptInterface
        public int ankiGetCardReps() {
<span class="nc" id="L5734">            return mCurrentCard.getReps();</span>
        }

        @JavascriptInterface
        public int ankiGetCardInterval() {
<span class="nc" id="L5739">            return mCurrentCard.getIvl();</span>
        }

        /**
         * Returns the ease as an int (percentage * 10). Default: 2500 (250%). Minimum: 1300 (130%)
         */
        @JavascriptInterface
        public int ankiGetCardFactor() {
<span class="nc" id="L5747">            return mCurrentCard.getFactor();</span>
        }

        /**
         * Returns the last modified time as a Unix timestamp in seconds. Example: 1477384099
         */
        @JavascriptInterface
        public long ankiGetCardMod() {
<span class="nc" id="L5755">            return mCurrentCard.getMod();</span>
        }

        /**
         * Returns the ID of the card. Example: 1477380543053
         */
        @JavascriptInterface
        public long ankiGetCardId() {
<span class="nc" id="L5763">            return mCurrentCard.getId();</span>
        }

        /**
         * Returns the ID of the note which generated the card. Example: 1590418157630
         */
        @JavascriptInterface
        public long ankiGetCardNid() {
<span class="nc" id="L5771">            return mCurrentCard.getNid();</span>
        }

        @JavascriptInterface
        @Consts.CARD_TYPE
        public int ankiGetCardType() {
<span class="nc" id="L5777">            return mCurrentCard.getType();</span>
        }

        /**
         * Returns the ID of the deck which contains the card. Example: 1595967594978
         */
        @JavascriptInterface
        public long ankiGetCardDid() {
<span class="nc" id="L5785">            return mCurrentCard.getDid();</span>
        }

        @JavascriptInterface
        public int ankiGetCardLeft() {
<span class="nc" id="L5790">            return mCurrentCard.getLeft();</span>
        }

        /**
         * Returns the ID of the home deck for the card if it is filtered, or 0 if not filtered. Example: 1595967594978
         */
        @JavascriptInterface
        public long ankiGetCardODid() {
<span class="nc" id="L5798">            return mCurrentCard.getODid();</span>
        }

        @JavascriptInterface
        public long ankiGetCardODue() {
<span class="nc" id="L5803">            return mCurrentCard.getODue();</span>
        }

        @JavascriptInterface
        @Consts.CARD_QUEUE
        public int ankiGetCardQueue() {
<span class="nc" id="L5809">            return mCurrentCard.getQueue();</span>
        }

        @JavascriptInterface
        public int ankiGetCardLapses() {
<span class="nc" id="L5814">            return mCurrentCard.getLapses();</span>
        }

        @JavascriptInterface
        public long ankiGetCardDue() {
<span class="nc" id="L5819">            return mCurrentCard.getDue();</span>
        }

        @JavascriptInterface
        public boolean ankiIsInFullscreen() {
<span class="nc" id="L5824">            return isFullscreen();</span>
        }

        @JavascriptInterface
        public boolean ankiIsTopbarShown() {
<span class="nc" id="L5829">            return mPrefShowTopbar;</span>
        }

        @JavascriptInterface
        public boolean ankiIsInNightMode() {
<span class="nc" id="L5834">            return isInNightMode();</span>
        }

        @JavascriptInterface
        public boolean ankiIsActiveNetworkMetered() {
            try {
<span class="nc" id="L5840">                ConnectivityManager cm = (ConnectivityManager) AnkiDroidApp.getInstance().getApplicationContext().getSystemService(Context.CONNECTIVITY_SERVICE);</span>
<span class="nc bnc" id="L5841" title="All 2 branches missed.">                if (cm == null) {</span>
<span class="nc bnc" id="L5842" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(5580)) {</span>
<span class="nc" id="L5843">                        Timber.w(&quot;ConnectivityManager not found - assuming metered connection&quot;);</span>
                    }
<span class="nc" id="L5845">                    return true;</span>
                }
<span class="nc" id="L5847">                return cm.isActiveNetworkMetered();</span>
<span class="nc" id="L5848">            } catch (Exception e) {</span>
<span class="nc bnc" id="L5849" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(5579)) {</span>
<span class="nc" id="L5850">                    Timber.w(e, &quot;Exception obtaining metered connection - assuming metered connection&quot;);</span>
                }
<span class="nc" id="L5852">                return true;</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>