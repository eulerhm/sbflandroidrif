<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeckPicker.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.anki</a> &gt; <span class="el_source">DeckPicker.java</span></div><h1>DeckPicker.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2009 Andrew Dubya &lt;andrewdubya@gmail.com&gt;                              *
 *  Copyright (c) 2009 Nicolas Raoul &lt;nicolas.raoul@gmail.com&gt;                           *
 *  Copyright (c) 2009 Edu Zamora &lt;edu.zasu@gmail.com&gt;                                   *
 *  Copyright (c) 2009 Daniel Svard &lt;daniel.svard@gmail.com&gt;                             *
 *  Copyright (c) 2010 Norbert Nagold &lt;norbert.nagold@gmail.com&gt;                         *
 *  Copyright (c) 2014 Timothy Rae &lt;perceptualchaos2@gmail.com&gt;
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.anki;

import android.Manifest;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.PackageManager;
import android.content.res.Resources;
import android.content.res.TypedArray;
import android.database.SQLException;
import android.graphics.PixelFormat;
import android.graphics.drawable.Drawable;
import android.net.Uri;
import android.os.Bundle;
import android.os.Message;
import android.os.ParcelFileDescriptor;
import android.provider.Settings;
import com.afollestad.materialdialogs.GravityEnum;
import com.google.android.material.snackbar.Snackbar;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.annotation.StringRes;
import androidx.annotation.VisibleForTesting;
import androidx.appcompat.widget.SearchView;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import androidx.core.content.FileProvider;
import androidx.core.content.pm.ShortcutInfoCompat;
import androidx.core.content.pm.ShortcutManagerCompat;
import androidx.core.graphics.drawable.IconCompat;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentTransaction;
import androidx.core.app.ShareCompat;
import androidx.swiperefreshlayout.widget.SwipeRefreshLayout;
import androidx.recyclerview.widget.DividerItemDecoration;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import android.text.TextUtils;
import android.util.Pair;
import android.util.TypedValue;
import android.view.KeyEvent;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewPropertyAnimator;
import android.view.Window;
import android.view.WindowManager;
import android.widget.EditText;
import android.widget.Filterable;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.Toast;
import com.afollestad.materialdialogs.MaterialDialog;
import com.getbase.floatingactionbutton.FloatingActionButton;
import com.getbase.floatingactionbutton.FloatingActionsMenu;
import com.ichi2.anki.CollectionHelper.CollectionIntegrityStorageCheck;
import com.ichi2.anki.StudyOptionsFragment.StudyOptionsListener;
import com.ichi2.anki.analytics.UsageAnalytics;
import com.ichi2.anki.dialogs.AsyncDialogFragment;
import com.ichi2.anki.dialogs.ConfirmationDialog;
import com.ichi2.anki.dialogs.CustomStudyDialog;
import com.ichi2.anki.dialogs.DatabaseErrorDialog;
import com.ichi2.anki.dialogs.DeckPickerAnalyticsOptInDialog;
import com.ichi2.anki.dialogs.DeckPickerBackupNoSpaceLeftDialog;
import com.ichi2.anki.dialogs.DeckPickerConfirmDeleteDeckDialog;
import com.ichi2.anki.dialogs.DeckPickerContextMenu;
import com.ichi2.anki.dialogs.DeckPickerExportCompleteDialog;
import com.ichi2.anki.dialogs.DeckPickerNoSpaceLeftDialog;
import com.ichi2.anki.dialogs.DialogHandler;
import com.ichi2.anki.dialogs.ExportDialog;
import com.ichi2.anki.dialogs.ImportDialog;
import com.ichi2.anki.dialogs.MediaCheckDialog;
import com.ichi2.anki.dialogs.SyncErrorDialog;
import com.ichi2.anki.exception.ConfirmModSchemaException;
import com.ichi2.anki.exception.DeckRenameException;
import com.ichi2.anki.receiver.SdCardReceiver;
import com.ichi2.anki.stats.AnkiStatsTaskHandler;
import com.ichi2.anki.web.HostNumFactory;
import com.ichi2.anki.widgets.DeckAdapter;
import com.ichi2.async.Connection;
import com.ichi2.async.Connection.Payload;
import com.ichi2.async.CollectionTask;
import com.ichi2.async.TaskListener;
import com.ichi2.async.TaskListenerWithContext;
import com.ichi2.async.TaskManager;
import com.ichi2.compat.CompatHelper;
import com.ichi2.libanki.Card;
import com.ichi2.libanki.Collection;
import com.ichi2.libanki.Decks;
import com.ichi2.libanki.Model;
import com.ichi2.libanki.Models;
import com.ichi2.libanki.Utils;
import com.ichi2.libanki.importer.AnkiPackageImporter;
import com.ichi2.libanki.sched.AbstractDeckTreeNode;
import com.ichi2.libanki.sched.DeckTreeNode;
import com.ichi2.libanki.sync.CustomSyncServerUrlException;
import com.ichi2.libanki.sync.Syncer;
import com.ichi2.libanki.utils.TimeUtils;
import com.ichi2.themes.StyledProgressDialog;
import com.ichi2.ui.BadgeDrawableBuilder;
import com.ichi2.ui.FixedEditText;
import com.ichi2.utils.AdaptionUtil;
import com.ichi2.utils.BooleanGetter;
import com.ichi2.utils.ImportUtils;
import com.ichi2.utils.PairWithBoolean;
import com.ichi2.utils.Permissions;
import com.ichi2.utils.SyncStatus;
import com.ichi2.utils.Triple;
import com.ichi2.utils.VersionUtils;
import com.ichi2.widget.WidgetStatus;
import com.ichi2.utils.JSONException;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import java.util.TreeMap;
import timber.log.Timber;
import static com.ichi2.async.Connection.ConflictResolution.FULL_DOWNLOAD;
import static com.ichi2.anim.ActivityTransitionAnimation.Direction.*;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

<span class="nc" id="L152">public class DeckPicker extends NavigationDrawerActivity implements StudyOptionsListener, SyncErrorDialog.SyncErrorDialogListener, ImportDialog.ImportDialogListener, MediaCheckDialog.MediaCheckDialogListener, ExportDialog.ExportDialogListener, ActivityCompat.OnRequestPermissionsResultCallback, CustomStudyDialog.CustomStudyListener {</span>

    /**
     * Result codes from other activities
     */
    public static final int RESULT_MEDIA_EJECTED = 202;

    public static final int RESULT_DB_ERROR = 203;

    protected static final String UPGRADE_VERSION_KEY = &quot;lastUpgradeVersion&quot;;

    /**
     * Available options performed by other activities (request codes for onActivityResult())
     */
    private static final int REQUEST_STORAGE_PERMISSION = 0;

    private static final int REQUEST_PATH_UPDATE = 1;

    public static final int REPORT_FEEDBACK = 4;

    private static final int LOG_IN_FOR_SYNC = 6;

    private static final int SHOW_INFO_NEW_VERSION = 9;

    public static final int SHOW_STUDYOPTIONS = 11;

    private static final int ADD_NOTE = 12;

    private static final int PICK_APKG_FILE = 13;

    private static final int PICK_EXPORT_FILE = 14;

    // 10 minutes in milliseconds.
    public static final long AUTOMATIC_SYNC_MIN_INTERVAL = 600000;

    private static final int SWIPE_TO_SYNC_TRIGGER_DISTANCE = 400;

    // Short animation duration from system
    private int mShortAnimDuration;

    private RelativeLayout mDeckPickerContent;

    private MaterialDialog mProgressDialog;

    private View mStudyoptionsFrame;

    private RecyclerView mRecyclerView;

    private LinearLayoutManager mRecyclerViewLayoutManager;

    private DeckAdapter mDeckListAdapter;

    private FloatingActionsMenu mActionsMenu;

<span class="nc" id="L206">    private final Snackbar.Callback mSnackbarShowHideCallback = new Snackbar.Callback();</span>

    private LinearLayout mNoDecksPlaceholder;

    private SwipeRefreshLayout mPullToSyncWrapper;

    private TextView mReviewSummaryTextView;

<span class="nc" id="L214">    private BroadcastReceiver mUnmountReceiver = null;</span>

    private long mContextMenuDid;

    private EditText mDialogEditText;

    // flag asking user to do a full sync which is used in upgrade path
<span class="nc" id="L221">    private boolean mRecommendFullSync = false;</span>

    // flag keeping track of when the app has been paused
<span class="nc" id="L224">    private boolean mActivityPaused = false;</span>

    private String mExportFileName;

<span class="nc" id="L228">    @Nullable</span>
    private CollectionTask&lt;?, ?, ?, ?&gt; mEmptyCardTask = null;

    @VisibleForTesting
    public List&lt;? extends AbstractDeckTreeNode&lt;?&gt;&gt; mDueTree;

    /**
     * Flag to indicate whether the activity will perform a sync in its onResume.
     * Since syncing closes the database, this flag allows us to avoid doing any
     * work in onResume that might use the database and go straight to syncing.
     */
<span class="nc" id="L239">    private boolean mSyncOnResume = false;</span>

    /**
     * Keep track of which deck was last given focus in the deck list. If we find that this value
     * has changed between deck list refreshes, we need to recenter the deck list to the new current
     * deck.
     */
    private long mFocusedDeck;

    /**
     * If we have accepted the &quot;We will show you permissions&quot; dialog, don't show it again on activity rebirth
     */
    private boolean mClosedWelcomeMessage;

    private SearchView mToolbarSearchView;

<span class="nc" id="L255">    private final OnClickListener mDeckExpanderClickListener = view -&gt; {</span>
<span class="nc" id="L256">        Long did = (Long) view.getTag();</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (getCol().getDecks().children(did).size() &gt; 0) {</span>
<span class="nc" id="L258">            getCol().getDecks().collapse(did);</span>
<span class="nc" id="L259">            __renderPage();</span>
<span class="nc" id="L260">            dismissAllDialogFragments();</span>
        }
<span class="nc" id="L262">    };</span>

<span class="nc" id="L264">    private final OnClickListener mDeckClickListener = v -&gt; onDeckClick(v, DeckSelectionType.DEFAULT);</span>

<span class="nc" id="L266">    private final OnClickListener mCountsClickListener = v -&gt; onDeckClick(v, DeckSelectionType.SHOW_STUDY_OPTIONS);</span>

    private void onDeckClick(View v, DeckSelectionType selectionType) {
<span class="nc" id="L269">        long deckId = (long) v.getTag();</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7104)) {</span>
<span class="nc" id="L271">            Timber.i(&quot;DeckPicker:: Selected deck with id %d&quot;, deckId);</span>
        }
<span class="nc bnc" id="L273" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7107)) {</span>
<span class="nc bnc" id="L274" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7105) ? (mActionsMenu != null || mActionsMenu.isExpanded()) : (mActionsMenu != null &amp;&amp; mActionsMenu.isExpanded()))) {</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7106)) {</span>
<span class="nc" id="L276">                    mActionsMenu.collapse();</span>
                }
            }
        }
<span class="nc" id="L280">        boolean collectionIsOpen = false;</span>
        try {
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7110)) {</span>
<span class="nc" id="L283">                collectionIsOpen = colIsOpen();</span>
            }
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7111)) {</span>
<span class="nc" id="L286">                handleDeckSelection(deckId, selectionType);</span>
            }
<span class="nc bnc" id="L288" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7113)) {</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">                if (mFragmented) {</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7112)) {</span>
                        // This interferes with the ripple effect, so we don't do it if lollipop and not tablet view
<span class="nc" id="L292">                        mDeckListAdapter.notifyDataSetChanged();</span>
                    }
                }
            }
<span class="nc" id="L296">        } catch (Exception e) {</span>
            // Maybe later don't report if collectionIsOpen is false?
<span class="nc" id="L298">            String info = deckId + &quot; colOpen:&quot; + collectionIsOpen;</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7108)) {</span>
<span class="nc" id="L300">                AnkiDroidApp.sendExceptionReport(e, &quot;deckPicker::onDeckClick&quot;, info);</span>
            }
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7109)) {</span>
<span class="nc" id="L303">                displayFailedToOpenDeck(deckId);</span>
            }
<span class="nc" id="L305">        }</span>
<span class="nc" id="L306">    }</span>

    private void displayFailedToOpenDeck(long deckId) {
        // We use the Deck ID as the deck likely doesn't exist any more.
<span class="nc" id="L310">        String message = getString(R.string.deck_picker_failed_deck_load, Long.toString(deckId));</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7114)) {</span>
<span class="nc" id="L312">            UIUtils.showThemedToast(this, message, false);</span>
        }
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7115)) {</span>
<span class="nc" id="L315">            Timber.w(message);</span>
        }
<span class="nc" id="L317">    }</span>

<span class="nc" id="L319">    private final View.OnLongClickListener mDeckLongClickListener = new View.OnLongClickListener() {</span>

        @Override
        public boolean onLongClick(View v) {
<span class="nc" id="L323">            long deckId = (long) v.getTag();</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7116)) {</span>
<span class="nc" id="L325">                Timber.i(&quot;DeckPicker:: Long tapped on deck with id %d&quot;, deckId);</span>
            }
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7117)) {</span>
<span class="nc" id="L328">                mContextMenuDid = deckId;</span>
            }
<span class="nc bnc" id="L330" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7118)) {</span>
<span class="nc" id="L331">                showDialogFragment(DeckPickerContextMenu.newInstance(deckId));</span>
            }
<span class="nc" id="L333">            return true;</span>
        }
    };

<span class="nc" id="L337">    private final ImportAddListener mImportAddListener = new ImportAddListener(this);</span>

    private static class ImportAddListener extends TaskListenerWithContext&lt;DeckPicker, String, Triple&lt;AnkiPackageImporter, Boolean, String&gt;&gt; {

        public ImportAddListener(DeckPicker deckPicker) {
<span class="nc" id="L342">            super(deckPicker);</span>
<span class="nc" id="L343">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, Triple&lt;AnkiPackageImporter, Boolean, String&gt; result) {
<span class="nc bnc" id="L347" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7121)) {</span>
<span class="nc bnc" id="L348" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7119) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7120)) {</span>
<span class="nc" id="L350">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L354" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7128)) {</span>
                // instead of a successful result.
<span class="nc bnc" id="L356" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7122) ? (result.second || result.third != null) : (result.second &amp;&amp; result.third != null))) {</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7126)) {</span>
<span class="nc" id="L358">                        Timber.w(&quot;Import: Add Failed: %s&quot;, result.third);</span>
                    }
<span class="nc bnc" id="L360" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7127)) {</span>
<span class="nc" id="L361">                        deckPicker.showSimpleMessageDialog(result.third);</span>
                    }
                } else {
<span class="nc bnc" id="L364" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7123)) {</span>
<span class="nc" id="L365">                        Timber.i(&quot;Import: Add succeeded&quot;);</span>
                    }
<span class="nc" id="L367">                    AnkiPackageImporter imp = result.first;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7124)) {</span>
<span class="nc" id="L369">                        deckPicker.showSimpleMessageDialog(TextUtils.join(&quot;\n&quot;, imp.getLog()));</span>
                    }
<span class="nc bnc" id="L371" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7125)) {</span>
<span class="nc" id="L372">                        deckPicker.updateDeckList();</span>
                    }
                }
            }
<span class="nc" id="L376">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L380" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7131)) {</span>
<span class="nc bnc" id="L381" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7129) ? (deckPicker.mProgressDialog == null &amp;&amp; !deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog == null || !deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7130)) {</span>
<span class="nc" id="L383">                        deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, deckPicker.getResources().getString(R.string.import_title), null, false);</span>
                    }
                }
            }
<span class="nc" id="L387">        }</span>

        @Override
        public void actualOnProgressUpdate(@NonNull DeckPicker deckPicker, String content) {
<span class="nc bnc" id="L391" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7132)) {</span>
<span class="nc" id="L392">                deckPicker.mProgressDialog.setContent(content);</span>
            }
<span class="nc" id="L394">        }</span>
    }

    private ImportReplaceListener importReplaceListener() {
<span class="nc" id="L398">        return new ImportReplaceListener(this);</span>
    }

    private static class ImportReplaceListener extends TaskListenerWithContext&lt;DeckPicker, String, BooleanGetter&gt; {

        public ImportReplaceListener(DeckPicker deckPicker) {
<span class="nc" id="L404">            super(deckPicker);</span>
<span class="nc" id="L405">        }</span>

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, BooleanGetter result) {
<span class="nc bnc" id="L410" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7133)) {</span>
<span class="nc" id="L411">                Timber.i(&quot;Import: Replace Task Completed&quot;);</span>
            }
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7136)) {</span>
<span class="nc bnc" id="L414" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7134) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7135)) {</span>
<span class="nc" id="L416">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc" id="L420">            Resources res = deckPicker.getResources();</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7139)) {</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">                if (result.getBoolean()) {</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7138)) {</span>
<span class="nc" id="L424">                        deckPicker.updateDeckList();</span>
                    }
                } else {
<span class="nc bnc" id="L427" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7137)) {</span>
<span class="nc" id="L428">                        deckPicker.showSimpleMessageDialog(res.getString(R.string.import_log_no_apkg), true);</span>
                    }
                }
            }
<span class="nc" id="L432">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L436" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7142)) {</span>
<span class="nc bnc" id="L437" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7140) ? (deckPicker.mProgressDialog == null &amp;&amp; !deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog == null || !deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7141)) {</span>
<span class="nc" id="L439">                        deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, deckPicker.getResources().getString(R.string.import_title), deckPicker.getResources().getString(R.string.import_replacing), false);</span>
                    }
                }
            }
<span class="nc" id="L443">        }</span>

        @Override
        public void actualOnProgressUpdate(@NonNull DeckPicker deckPicker, String message) {
<span class="nc bnc" id="L447" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7143)) {</span>
<span class="nc" id="L448">                deckPicker.mProgressDialog.setContent(message);</span>
            }
<span class="nc" id="L450">        }</span>
    }

    private ExportListener exportListener() {
<span class="nc" id="L454">        return new ExportListener(this);</span>
    }

    private static class ExportListener extends TaskListenerWithContext&lt;DeckPicker, Void, Pair&lt;Boolean, String&gt;&gt; {

        public ExportListener(DeckPicker deckPicker) {
<span class="nc" id="L460">            super(deckPicker);</span>
<span class="nc" id="L461">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7144)) {</span>
<span class="nc" id="L466">                deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, &quot;&quot;, deckPicker.getResources().getString(R.string.export_in_progress), false);</span>
            }
<span class="nc" id="L468">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, Pair&lt;Boolean, String&gt; result) {
<span class="nc bnc" id="L472" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7147)) {</span>
<span class="nc bnc" id="L473" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7145) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7146)) {</span>
<span class="nc" id="L475">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L479" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7155)) {</span>
                // instead of a successful result.
<span class="nc bnc" id="L481" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7148) ? (result.first || result.second != null) : (result.first &amp;&amp; result.second != null))) {</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7153)) {</span>
<span class="nc" id="L483">                        Timber.w(&quot;Export Failed: %s&quot;, result.second);</span>
                    }
<span class="nc bnc" id="L485" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7154)) {</span>
<span class="nc" id="L486">                        deckPicker.showSimpleMessageDialog(result.second);</span>
                    }
                } else {
<span class="nc bnc" id="L489" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7149)) {</span>
<span class="nc" id="L490">                        Timber.i(&quot;Export successful&quot;);</span>
                    }
<span class="nc" id="L492">                    String exportPath = result.second;</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7152)) {</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">                        if (exportPath != null) {</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7151)) {</span>
<span class="nc" id="L496">                                deckPicker.showAsyncDialogFragment(DeckPickerExportCompleteDialog.newInstance(exportPath));</span>
                            }
                        } else {
<span class="nc bnc" id="L499" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7150)) {</span>
<span class="nc" id="L500">                                UIUtils.showThemedToast(deckPicker, deckPicker.getResources().getString(R.string.export_unsuccessful), true);</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L506">        }</span>
    }

    /**
     * Called when the activity is first created.
     */
    @Override
    protected void onCreate(Bundle savedInstanceState) throws SQLException {
<span class="nc bnc" id="L514" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7156)) {</span>
<span class="nc" id="L515">            Timber.d(&quot;onCreate()&quot;);</span>
        }
<span class="nc bnc" id="L517" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7157)) {</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">            if (showedActivityFailedScreen(savedInstanceState)) {</span>
<span class="nc" id="L519">                return;</span>
            }
        }
<span class="nc" id="L522">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7158)) {</span>
            // we need to restore here, as we need it before super.onCreate() is called.
<span class="nc" id="L525">            restoreWelcomeMessage(savedInstanceState);</span>
        }
        // Open Collection on UI thread while splash screen is showing
<span class="nc" id="L528">        boolean colOpen = firstCollectionOpen();</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7159)) {</span>
            // Then set theme and content view
<span class="nc" id="L531">            super.onCreate(savedInstanceState);</span>
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7160)) {</span>
<span class="nc" id="L534">            setContentView(R.layout.homescreen);</span>
        }
<span class="nc" id="L536">        View mainView = findViewById(android.R.id.content);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7161)) {</span>
            // check, if tablet layout
<span class="nc" id="L539">            mStudyoptionsFrame = findViewById(R.id.studyoptions_fragment);</span>
        }
<span class="nc bnc" id="L541" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7163)) {</span>
            // set protected variable from NavigationDrawerActivity
<span class="nc bnc" id="L543" title="All 10 branches missed.">            mFragmented = (ListenerUtil.mutListener.listen(7162) ? (mStudyoptionsFrame != null || mStudyoptionsFrame.getVisibility() == View.VISIBLE) : (mStudyoptionsFrame != null &amp;&amp; mStudyoptionsFrame.getVisibility() == View.VISIBLE));</span>
        }
<span class="nc bnc" id="L545" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7164)) {</span>
<span class="nc" id="L546">            registerExternalStorageListener();</span>
        }
<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7165)) {</span>
            // create inherited navigation drawer layout here so that it can be used by parent class
<span class="nc" id="L550">            initNavigationDrawer(mainView);</span>
        }
<span class="nc bnc" id="L552" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7166)) {</span>
<span class="nc" id="L553">            setTitle(getResources().getString(R.string.app_name));</span>
        }
<span class="nc bnc" id="L555" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7167)) {</span>
<span class="nc" id="L556">            mDeckPickerContent = findViewById(R.id.deck_picker_content);</span>
        }
<span class="nc bnc" id="L558" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7168)) {</span>
<span class="nc" id="L559">            mRecyclerView = findViewById(R.id.files);</span>
        }
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7169)) {</span>
<span class="nc" id="L562">            mNoDecksPlaceholder = findViewById(R.id.no_decks_placeholder);</span>
        }
<span class="nc bnc" id="L564" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7170)) {</span>
<span class="nc" id="L565">            mDeckPickerContent.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L567" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7171)) {</span>
<span class="nc" id="L568">            mNoDecksPlaceholder.setVisibility(View.GONE);</span>
        }
<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7172)) {</span>
            // specify a LinearLayoutManager and set up item dividers for the RecyclerView
<span class="nc" id="L572">            mRecyclerViewLayoutManager = new LinearLayoutManager(this);</span>
        }
<span class="nc bnc" id="L574" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7173)) {</span>
<span class="nc" id="L575">            mRecyclerView.setLayoutManager(mRecyclerViewLayoutManager);</span>
        }
<span class="nc" id="L577">        TypedArray ta = this.obtainStyledAttributes(new int[] { R.attr.deckDivider });</span>
<span class="nc" id="L578">        Drawable divider = ta.getDrawable(0);</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7174)) {</span>
<span class="nc" id="L580">            ta.recycle();</span>
        }
<span class="nc" id="L582">        DividerItemDecoration dividerDecorator = new DividerItemDecoration(this, mRecyclerViewLayoutManager.getOrientation());</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7175)) {</span>
<span class="nc" id="L584">            dividerDecorator.setDrawable(divider);</span>
        }
<span class="nc bnc" id="L586" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7176)) {</span>
<span class="nc" id="L587">            mRecyclerView.addItemDecoration(dividerDecorator);</span>
        }
        // Add background to Deckpicker activity
<span class="nc bnc" id="L590" title="All 2 branches missed.">        View view = mFragmented ? findViewById(R.id.deckpicker_view) : findViewById(R.id.root_layout);</span>
<span class="nc" id="L591">        boolean hasDeckPickerBackground = false;</span>
        try {
<span class="nc bnc" id="L593" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7181)) {</span>
<span class="nc" id="L594">                hasDeckPickerBackground = applyDeckPickerBackground(view);</span>
            }
<span class="nc" id="L596">        } catch (OutOfMemoryError e) {</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7177)) {</span>
                // 6608 - OOM should be catchable here.
<span class="nc" id="L599">                Timber.w(e, &quot;Failed to apply background - OOM&quot;);</span>
            }
<span class="nc bnc" id="L601" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7178)) {</span>
<span class="nc" id="L602">                UIUtils.showThemedToast(this, getString(R.string.background_image_too_large), false);</span>
            }
<span class="nc" id="L604">        } catch (Exception e) {</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7179)) {</span>
<span class="nc" id="L606">                Timber.w(e, &quot;Failed to apply background&quot;);</span>
            }
<span class="nc bnc" id="L608" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7180)) {</span>
<span class="nc" id="L609">                UIUtils.showThemedToast(this, getString(R.string.failed_to_apply_background_image, e.getLocalizedMessage()), false);</span>
            }
<span class="nc" id="L611">        }</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7182)) {</span>
            // create and set an adapter for the RecyclerView
<span class="nc" id="L614">            mDeckListAdapter = new DeckAdapter(getLayoutInflater(), this);</span>
        }
<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7183)) {</span>
<span class="nc" id="L617">            mDeckListAdapter.setDeckClickListener(mDeckClickListener);</span>
        }
<span class="nc bnc" id="L619" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7184)) {</span>
<span class="nc" id="L620">            mDeckListAdapter.setCountsClickListener(mCountsClickListener);</span>
        }
<span class="nc bnc" id="L622" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7185)) {</span>
<span class="nc" id="L623">            mDeckListAdapter.setDeckExpanderClickListener(mDeckExpanderClickListener);</span>
        }
<span class="nc bnc" id="L625" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7186)) {</span>
<span class="nc" id="L626">            mDeckListAdapter.setDeckLongClickListener(mDeckLongClickListener);</span>
        }
<span class="nc bnc" id="L628" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7187)) {</span>
<span class="nc" id="L629">            mDeckListAdapter.enablePartialTransparencyForBackground(hasDeckPickerBackground);</span>
        }
<span class="nc bnc" id="L631" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7188)) {</span>
<span class="nc" id="L632">            mRecyclerView.setAdapter(mDeckListAdapter);</span>
        }
<span class="nc bnc" id="L634" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7189)) {</span>
<span class="nc" id="L635">            mPullToSyncWrapper = findViewById(R.id.pull_to_sync_wrapper);</span>
        }
<span class="nc bnc" id="L637" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7190)) {</span>
<span class="nc" id="L638">            mPullToSyncWrapper.setDistanceToTriggerSync(SWIPE_TO_SYNC_TRIGGER_DISTANCE);</span>
        }
<span class="nc bnc" id="L640" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7191)) {</span>
<span class="nc" id="L641">            mPullToSyncWrapper.setOnRefreshListener(() -&gt; {</span>
<span class="nc" id="L642">                Timber.i(&quot;Pull to Sync: Syncing&quot;);</span>
<span class="nc" id="L643">                mPullToSyncWrapper.setRefreshing(false);</span>
<span class="nc" id="L644">                sync();</span>
<span class="nc" id="L645">            });</span>
        }
<span class="nc bnc" id="L647" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7192)) {</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">            mPullToSyncWrapper.getViewTreeObserver().addOnScrollChangedListener(() -&gt; mPullToSyncWrapper.setEnabled(mRecyclerViewLayoutManager.findFirstCompletelyVisibleItemPosition() == 0));</span>
        }
<span class="nc bnc" id="L650" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7193)) {</span>
            // Setup the FloatingActionButtons, should work everywhere with min API &gt;= 15
<span class="nc" id="L652">            mActionsMenu = findViewById(R.id.add_content_menu);</span>
        }
<span class="nc bnc" id="L654" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7194)) {</span>
<span class="nc" id="L655">            mActionsMenu.findViewById(R.id.fab_expand_menu_button).setContentDescription(getString(R.string.menu_add));</span>
        }
<span class="nc bnc" id="L657" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7195)) {</span>
<span class="nc" id="L658">            configureFloatingActionsMenu();</span>
        }
<span class="nc bnc" id="L660" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7196)) {</span>
<span class="nc" id="L661">            mReviewSummaryTextView = findViewById(R.id.today_stats_text_view);</span>
        }
<span class="nc bnc" id="L663" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7197)) {</span>
<span class="nc" id="L664">            Timber.i(&quot;colOpen: %b&quot;, colOpen);</span>
        }
<span class="nc bnc" id="L666" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7210)) {</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">            if (colOpen) {</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7209)) {</span>
                    // Show any necessary dialogs (e.g. changelog, special messages, etc)
<span class="nc" id="L670">                    showStartupScreensAndDialogs(preferences, 0);</span>
                }
            } else {
<span class="nc bnc" id="L673" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7208)) {</span>
                    // Show error dialogs
<span class="nc bnc" id="L675" title="All 2 branches missed.">                    if (Permissions.hasStorageAccessPermission(this)) {</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7207)) {</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">                            if (!AnkiDroidApp.isSdCardMounted()) {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7205)) {</span>
<span class="nc" id="L679">                                    Timber.i(&quot;SD card not mounted&quot;);</span>
                                }
<span class="nc bnc" id="L681" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7206)) {</span>
<span class="nc" id="L682">                                    onSdCardNotMounted();</span>
                                }
<span class="nc bnc" id="L684" title="All 2 branches missed.">                            } else if (!CollectionHelper.isCurrentAnkiDroidDirAccessible(this)) {</span>
<span class="nc bnc" id="L685" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7202)) {</span>
<span class="nc" id="L686">                                    Timber.i(&quot;AnkiDroid directory inaccessible&quot;);</span>
                                }
<span class="nc" id="L688">                                Intent i = Preferences.getPreferenceSubscreenIntent(this, &quot;com.ichi2.anki.prefs.advanced&quot;);</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7203)) {</span>
<span class="nc" id="L690">                                    startActivityForResultWithoutAnimation(i, REQUEST_PATH_UPDATE);</span>
                                }
<span class="nc bnc" id="L692" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7204)) {</span>
<span class="nc" id="L693">                                    Toast.makeText(this, R.string.directory_inaccessible, Toast.LENGTH_LONG).show();</span>
                                }
<span class="nc bnc" id="L695" title="All 2 branches missed.">                            } else if (isFutureAnkiDroidVersion()) {</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7200)) {</span>
<span class="nc" id="L697">                                    Timber.i(&quot;Displaying database versioning&quot;);</span>
                                }
<span class="nc bnc" id="L699" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7201)) {</span>
<span class="nc" id="L700">                                    showDatabaseErrorDialog(DatabaseErrorDialog.INCOMPATIBLE_DB_VERSION);</span>
                                }
                            } else {
<span class="nc bnc" id="L703" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7198)) {</span>
<span class="nc" id="L704">                                    Timber.i(&quot;Displaying database error&quot;);</span>
                                }
<span class="nc bnc" id="L706" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7199)) {</span>
<span class="nc" id="L707">                                    showDatabaseErrorDialog(DatabaseErrorDialog.DIALOG_LOAD_FAILED);</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L715" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7211)) {</span>
<span class="nc" id="L716">            mShortAnimDuration = getResources().getInteger(android.R.integer.config_shortAnimTime);</span>
        }
<span class="nc" id="L718">    }</span>

    private boolean isFutureAnkiDroidVersion() {
        try {
<span class="nc" id="L722">            return CollectionHelper.isFutureAnkiDroidVersion(this);</span>
<span class="nc" id="L723">        } catch (Exception e) {</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7212)) {</span>
<span class="nc" id="L725">                Timber.w(e, &quot;Could not determine if future AnkiDroid version - assuming not&quot;);</span>
            }
<span class="nc" id="L727">            return false;</span>
        }
    }

    // throws doesn't seem to be checked by the compiler - consider it to be documentation
    private boolean applyDeckPickerBackground(View view) throws OutOfMemoryError {
        // Allow the user to clear data and get back to a good state if they provide an invalid background.
<span class="nc bnc" id="L734" title="All 2 branches missed.">        if (!AnkiDroidApp.getSharedPrefs(this).getBoolean(&quot;deckPickerBackground&quot;, false)) {</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7213)) {</span>
<span class="nc" id="L736">                Timber.d(&quot;No DeckPicker background preference&quot;);</span>
            }
<span class="nc bnc" id="L738" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7214)) {</span>
<span class="nc" id="L739">                view.setBackgroundResource(0);</span>
            }
<span class="nc" id="L741">            return false;</span>
        }
<span class="nc" id="L743">        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);</span>
<span class="nc" id="L744">        File imgFile = new File(currentAnkiDroidDirectory, &quot;DeckPickerBackground.png&quot;);</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">        if (!imgFile.exists()) {</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7217)) {</span>
<span class="nc" id="L747">                Timber.d(&quot;No DeckPicker background image&quot;);</span>
            }
<span class="nc bnc" id="L749" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7218)) {</span>
<span class="nc" id="L750">                view.setBackgroundResource(0);</span>
            }
<span class="nc" id="L752">            return false;</span>
        } else {
<span class="nc bnc" id="L754" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7215)) {</span>
<span class="nc" id="L755">                Timber.i(&quot;Applying background&quot;);</span>
            }
<span class="nc" id="L757">            Drawable drawable = Drawable.createFromPath(imgFile.getAbsolutePath());</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7216)) {</span>
<span class="nc" id="L759">                view.setBackground(drawable);</span>
            }
<span class="nc" id="L761">            return true;</span>
        }
    }

    /**
     * Try to open the Collection for the first time, and do some error handling if it wasn't successful
     * @return whether or not we were successful
     */
    private boolean firstCollectionOpen() {
<span class="nc bnc" id="L770" title="All 2 branches missed.">        if (AnkiDroidApp.webViewFailedToLoad()) {</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7219)) {</span>
<span class="nc" id="L772">                new MaterialDialog.Builder(this).title(R.string.ankidroid_init_failed_webview_title).content(getString(R.string.ankidroid_init_failed_webview, AnkiDroidApp.getWebViewErrorMessage())).positiveText(R.string.close).onPositive((d, w) -&gt; exit()).cancelable(false).show();</span>
            }
<span class="nc" id="L774">            return false;</span>
        }
<span class="nc bnc" id="L776" title="All 2 branches missed.">        if (Permissions.hasStorageAccessPermission(this)) {</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7223)) {</span>
<span class="nc" id="L778">                Timber.i(&quot;User has permissions to access collection&quot;);</span>
            }
            // Show error dialog if collection could not be opened
<span class="nc bnc" id="L781" title="All 2 branches missed.">            return CollectionHelper.getInstance().getColSafe(this) != null;</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">        } else if (mClosedWelcomeMessage) {</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7222)) {</span>
                // Even if the dialog is showing, we want to show it again.
<span class="nc" id="L785">                ActivityCompat.requestPermissions(this, new String[] { Manifest.permission.WRITE_EXTERNAL_STORAGE }, REQUEST_STORAGE_PERMISSION);</span>
            }
<span class="nc" id="L787">            return false;</span>
        } else {
<span class="nc bnc" id="L789" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7220)) {</span>
<span class="nc" id="L790">                Timber.i(&quot;Displaying initial permission request dialog&quot;);</span>
            }
<span class="nc bnc" id="L792" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7221)) {</span>
                // Request storage permission if we don't have it (e.g. on Android 6.0+)
<span class="nc" id="L794">                new MaterialDialog.Builder(this).title(R.string.collection_load_welcome_request_permissions_title).titleGravity(GravityEnum.CENTER).content(R.string.collection_load_welcome_request_permissions_details).positiveText(R.string.dialog_ok).onPositive((innerDialog, innerWhich) -&gt; {</span>
<span class="nc" id="L795">                    this.mClosedWelcomeMessage = true;</span>
<span class="nc" id="L796">                    ActivityCompat.requestPermissions(this, new String[] { Manifest.permission.WRITE_EXTERNAL_STORAGE }, REQUEST_STORAGE_PERMISSION);</span>
<span class="nc" id="L797">                }).cancelable(false).canceledOnTouchOutside(false).show();</span>
            }
<span class="nc" id="L799">            return false;</span>
        }
    }

    private void configureFloatingActionsMenu() {
<span class="nc" id="L804">        final FloatingActionButton addDeckButton = findViewById(R.id.add_deck_action);</span>
<span class="nc" id="L805">        final FloatingActionButton addSharedButton = findViewById(R.id.add_shared_action);</span>
<span class="nc" id="L806">        final FloatingActionButton addNoteButton = findViewById(R.id.add_note_action);</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7224)) {</span>
<span class="nc" id="L808">            addDeckButton.setOnClickListener(view -&gt; {</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                if (mActionsMenu == null) {</span>
<span class="nc" id="L810">                    return;</span>
                }
<span class="nc" id="L812">                mActionsMenu.collapse();</span>
<span class="nc" id="L813">                mDialogEditText = new FixedEditText(DeckPicker.this);</span>
<span class="nc" id="L814">                mDialogEditText.setSingleLine(true);</span>
                // mDialogEditText.setFilters(new InputFilter[] { mDeckNameFilter });
<span class="nc" id="L816">                new MaterialDialog.Builder(DeckPicker.this).title(R.string.new_deck).positiveText(R.string.dialog_ok).customView(mDialogEditText, true).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L817">                    String deckName = mDialogEditText.getText().toString();</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">                    if (Decks.isValidDeckName(deckName)) {</span>
<span class="nc" id="L819">                        createNewDeck(deckName);</span>
                    } else {
<span class="nc" id="L821">                        Timber.i(&quot;configureFloatingActionsMenu::addDeckButton::onPositiveListener - Not creating invalid deck name '%s'&quot;, deckName);</span>
<span class="nc" id="L822">                        UIUtils.showThemedToast(this, getString(R.string.invalid_deck_name), false);</span>
                    }
<span class="nc" id="L824">                }).negativeText(R.string.dialog_cancel).show();</span>
<span class="nc" id="L825">            });</span>
        }
<span class="nc bnc" id="L827" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7225)) {</span>
<span class="nc" id="L828">            addSharedButton.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L829">                Timber.i(&quot;Adding Shared Deck&quot;);</span>
<span class="nc" id="L830">                mActionsMenu.collapse();</span>
<span class="nc" id="L831">                addSharedDeck();</span>
<span class="nc" id="L832">            });</span>
        }
<span class="nc bnc" id="L834" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7226)) {</span>
<span class="nc" id="L835">            addNoteButton.setOnClickListener(view -&gt; {</span>
<span class="nc" id="L836">                Timber.i(&quot;Adding Note&quot;);</span>
<span class="nc" id="L837">                mActionsMenu.collapse();</span>
<span class="nc" id="L838">                addNote();</span>
<span class="nc" id="L839">            });</span>
        }
<span class="nc" id="L841">    }</span>

    private void createNewDeck(String deckName) {
<span class="nc bnc" id="L844" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7227)) {</span>
<span class="nc" id="L845">            Timber.i(&quot;DeckPicker:: Creating new deck...&quot;);</span>
        }
<span class="nc bnc" id="L847" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7228)) {</span>
<span class="nc" id="L848">            getCol().getDecks().id(deckName, true);</span>
        }
<span class="nc bnc" id="L850" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7229)) {</span>
<span class="nc" id="L851">            updateDeckList();</span>
        }
<span class="nc" id="L853">    }</span>

    @Override
    public boolean onPrepareOptionsMenu(Menu menu) {
<span class="nc bnc" id="L857" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7230)) {</span>
            // Null check to prevent crash when col inaccessible
<span class="nc bnc" id="L859" title="All 2 branches missed.">            if (CollectionHelper.getInstance().getColSafe(this) == null) {</span>
<span class="nc" id="L860">                return false;</span>
            }
        }
<span class="nc" id="L863">        return super.onPrepareOptionsMenu(menu);</span>
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc bnc" id="L868" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7231)) {</span>
<span class="nc" id="L869">            Timber.d(&quot;onCreateOptionsMenu()&quot;);</span>
        }
<span class="nc bnc" id="L871" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7232)) {</span>
<span class="nc" id="L872">            getMenuInflater().inflate(R.menu.deck_picker, menu);</span>
        }
<span class="nc" id="L874">        boolean sdCardAvailable = AnkiDroidApp.isSdCardMounted();</span>
<span class="nc bnc" id="L875" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7233)) {</span>
<span class="nc" id="L876">            menu.findItem(R.id.action_sync).setEnabled(sdCardAvailable);</span>
        }
<span class="nc bnc" id="L878" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7234)) {</span>
<span class="nc" id="L879">            menu.findItem(R.id.action_new_filtered_deck).setEnabled(sdCardAvailable);</span>
        }
<span class="nc bnc" id="L881" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7235)) {</span>
<span class="nc" id="L882">            menu.findItem(R.id.action_check_database).setEnabled(sdCardAvailable);</span>
        }
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7236)) {</span>
<span class="nc" id="L885">            menu.findItem(R.id.action_check_media).setEnabled(sdCardAvailable);</span>
        }
<span class="nc bnc" id="L887" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7237)) {</span>
<span class="nc" id="L888">            menu.findItem(R.id.action_empty_cards).setEnabled(sdCardAvailable);</span>
        }
        // I haven't had an exception here, but it feels this may be flaky
        try {
<span class="nc bnc" id="L892" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7239)) {</span>
<span class="nc" id="L893">                displaySyncBadge(menu);</span>
            }
<span class="nc" id="L895">        } catch (Exception e) {</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7238)) {</span>
<span class="nc" id="L897">                Timber.w(e, &quot;Error Displaying Sync Badge&quot;);</span>
            }
<span class="nc" id="L899">        }</span>
<span class="nc" id="L900">        MenuItem toolbarSearchItem = menu.findItem(R.id.deck_picker_action_filter);</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7240)) {</span>
<span class="nc" id="L902">            mToolbarSearchView = (SearchView) toolbarSearchItem.getActionView();</span>
        }
<span class="nc bnc" id="L904" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7241)) {</span>
<span class="nc" id="L905">            mToolbarSearchView.setQueryHint(getString(R.string.search_decks));</span>
        }
<span class="nc bnc" id="L907" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7244)) {</span>
<span class="nc" id="L908">            mToolbarSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {</span>

                @Override
                public boolean onQueryTextSubmit(String query) {
<span class="nc bnc" id="L912" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7242)) {</span>
<span class="nc" id="L913">                        mToolbarSearchView.clearFocus();</span>
                    }
<span class="nc" id="L915">                    return true;</span>
                }

                @Override
                public boolean onQueryTextChange(String newText) {
<span class="nc" id="L920">                    Filterable adapter = (Filterable) mRecyclerView.getAdapter();</span>
<span class="nc bnc" id="L921" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7243)) {</span>
<span class="nc" id="L922">                        adapter.getFilter().filter(newText);</span>
                    }
<span class="nc" id="L924">                    return true;</span>
                }
            });
        }
<span class="nc bnc" id="L928" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7256)) {</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">            if (colIsOpen()) {</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7249)) {</span>
                    // Show / hide undo
<span class="nc bnc" id="L932" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(7245) ? (mFragmented &amp;&amp; !getCol().undoAvailable()) : (mFragmented || !getCol().undoAvailable()))) {</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7248)) {</span>
<span class="nc" id="L934">                            menu.findItem(R.id.action_undo).setVisible(false);</span>
                        }
                    } else {
<span class="nc" id="L937">                        Resources res = getResources();</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7246)) {</span>
<span class="nc" id="L939">                            menu.findItem(R.id.action_undo).setVisible(true);</span>
                        }
<span class="nc" id="L941">                        String undo = res.getString(R.string.studyoptions_congrats_undo, getCol().undoName(res));</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7247)) {</span>
<span class="nc" id="L943">                            menu.findItem(R.id.action_undo).setTitle(undo);</span>
                        }
                    }
                }
<span class="nc bnc" id="L947" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7255)) {</span>
                    // Remove the filter - not necessary and search has other implications for new users.
<span class="nc bnc" id="L949" title="All 22 branches missed.">                    menu.findItem(R.id.deck_picker_action_filter).setVisible((ListenerUtil.mutListener.listen(7254) ? (getCol().getDecks().count() &lt;= 10) : (ListenerUtil.mutListener.listen(7253) ? (getCol().getDecks().count() &gt; 10) : (ListenerUtil.mutListener.listen(7252) ? (getCol().getDecks().count() &lt; 10) : (ListenerUtil.mutListener.listen(7251) ? (getCol().getDecks().count() != 10) : (ListenerUtil.mutListener.listen(7250) ? (getCol().getDecks().count() == 10) : (getCol().getDecks().count() &gt;= 10)))))));</span>
                }
            }
        }
<span class="nc" id="L953">        return super.onCreateOptionsMenu(menu);</span>
    }

    private void displaySyncBadge(Menu menu) {
<span class="nc" id="L957">        MenuItem syncMenu = menu.findItem(R.id.action_sync);</span>
<span class="nc" id="L958">        SyncStatus syncStatus = SyncStatus.getSyncStatus(this::getCol);</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7267)) {</span>
<span class="nc bnc" id="L960" title="All 4 branches missed.">            switch(syncStatus) {</span>
                case BADGE_DISABLED:
                case NO_CHANGES:
                case INCONCLUSIVE:
<span class="nc bnc" id="L964" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7257)) {</span>
<span class="nc" id="L965">                        BadgeDrawableBuilder.removeBadge(syncMenu);</span>
                    }
<span class="nc bnc" id="L967" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7258)) {</span>
<span class="nc" id="L968">                        syncMenu.setTitle(R.string.button_sync);</span>
                    }
                    break;
                case HAS_CHANGES:
<span class="nc bnc" id="L972" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7259)) {</span>
                        // Light orange icon
<span class="nc" id="L974">                        new BadgeDrawableBuilder(getResources()).withColor(ContextCompat.getColor(this, R.color.badge_warning)).replaceBadge(syncMenu);</span>
                    }
<span class="nc bnc" id="L976" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7260)) {</span>
<span class="nc" id="L977">                        syncMenu.setTitle(R.string.button_sync);</span>
                    }
                    break;
                case NO_ACCOUNT:
                case FULL_SYNC:
<span class="nc bnc" id="L982" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7263)) {</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">                        if (syncStatus == SyncStatus.NO_ACCOUNT) {</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7262)) {</span>
<span class="nc" id="L985">                                syncMenu.setTitle(R.string.sync_menu_title_no_account);</span>
                            }
<span class="nc bnc" id="L987" title="All 2 branches missed.">                        } else if (syncStatus == SyncStatus.FULL_SYNC) {</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7261)) {</span>
<span class="nc" id="L989">                                syncMenu.setTitle(R.string.sync_menu_title_full_sync);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L993" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7264)) {</span>
                        // Orange-red icon with exclamation mark
<span class="nc" id="L995">                        new BadgeDrawableBuilder(getResources()).withText('!').withColor(ContextCompat.getColor(this, R.color.badge_error)).replaceBadge(syncMenu);</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L999" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7265)) {</span>
<span class="nc" id="L1000">                        Timber.w(&quot;Unhandled sync status: %s&quot;, syncStatus);</span>
                    }
<span class="nc bnc" id="L1002" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7266)) {</span>
<span class="nc" id="L1003">                        syncMenu.setTitle(R.string.sync_title);</span>
                    }
                    break;
            }
        }
<span class="nc" id="L1008">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L1012">        Resources res = getResources();</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7268)) {</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">            if (getDrawerToggle().onOptionsItemSelected(item)) {</span>
<span class="nc" id="L1015">                return true;</span>
            }
        }
<span class="nc" id="L1018">        int itemId = item.getItemId();</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7294)) {</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">            if (itemId == R.id.action_undo) {</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7292)) {</span>
<span class="nc" id="L1022">                    Timber.i(&quot;DeckPicker:: Undo button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1024" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7293)) {</span>
<span class="nc" id="L1025">                    undo();</span>
                }
<span class="nc" id="L1027">                return true;</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">            } else if (itemId == R.id.action_sync) {</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7290)) {</span>
<span class="nc" id="L1030">                    Timber.i(&quot;DeckPicker:: Sync button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1032" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7291)) {</span>
<span class="nc" id="L1033">                    sync();</span>
                }
<span class="nc" id="L1035">                return true;</span>
<span class="nc bnc" id="L1036" title="All 2 branches missed.">            } else if (itemId == R.id.action_import) {</span>
<span class="nc bnc" id="L1037" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7288)) {</span>
<span class="nc" id="L1038">                    Timber.i(&quot;DeckPicker:: Import button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1040" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7289)) {</span>
<span class="nc" id="L1041">                    showImportDialog(ImportDialog.DIALOG_IMPORT_HINT);</span>
                }
<span class="nc" id="L1043">                return true;</span>
<span class="nc bnc" id="L1044" title="All 2 branches missed.">            } else if (itemId == R.id.action_new_filtered_deck) {</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7281)) {</span>
<span class="nc" id="L1046">                    Timber.i(&quot;DeckPicker:: New filtered deck button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1048" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7282)) {</span>
<span class="nc" id="L1049">                    mDialogEditText = new FixedEditText(DeckPicker.this);</span>
                }
<span class="nc" id="L1051">                ArrayList&lt;String&gt; names = getCol().getDecks().allNames();</span>
<span class="nc" id="L1052">                int n = 1;</span>
<span class="nc" id="L1053">                String name = String.format(Locale.getDefault(), &quot;%s %d&quot;, res.getString(R.string.filtered_deck_name), n);</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7285)) {</span>
                    {
<span class="nc" id="L1056">                        long _loopCounter130 = 0;</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                        while (names.contains(name)) {</span>
<span class="nc" id="L1058">                            ListenerUtil.loopListener.listen(&quot;_loopCounter130&quot;, ++_loopCounter130);</span>
<span class="nc bnc" id="L1059" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7283)) {</span>
<span class="nc" id="L1060">                                n++;</span>
                            }
<span class="nc bnc" id="L1062" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7284)) {</span>
<span class="nc" id="L1063">                                name = String.format(Locale.getDefault(), &quot;%s %d&quot;, res.getString(R.string.filtered_deck_name), n);</span>
                            }
                        }
                    }
                }
<span class="nc bnc" id="L1068" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7286)) {</span>
<span class="nc" id="L1069">                    mDialogEditText.setText(name);</span>
                }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7287)) {</span>
                    // mDialogEditText.setFilters(new InputFilter[] { mDeckNameFilter });
<span class="nc" id="L1073">                    new MaterialDialog.Builder(DeckPicker.this).title(res.getString(R.string.new_deck)).customView(mDialogEditText, true).positiveText(R.string.create).negativeText(R.string.dialog_cancel).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L1074">                        String filteredDeckName = mDialogEditText.getText().toString();</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">                        if (!Decks.isValidDeckName(filteredDeckName)) {</span>
<span class="nc" id="L1076">                            Timber.i(&quot;Not creating deck with invalid name '%s'&quot;, filteredDeckName);</span>
<span class="nc" id="L1077">                            UIUtils.showThemedToast(this, getString(R.string.invalid_deck_name), false);</span>
<span class="nc" id="L1078">                            return;</span>
                        }
<span class="nc" id="L1080">                        Timber.i(&quot;DeckPicker:: Creating filtered deck...&quot;);</span>
<span class="nc" id="L1081">                        getCol().getDecks().newDyn(filteredDeckName);</span>
<span class="nc" id="L1082">                        openStudyOptions(true);</span>
<span class="nc" id="L1083">                    }).show();</span>
                }
<span class="nc" id="L1085">                return true;</span>
<span class="nc bnc" id="L1086" title="All 2 branches missed.">            } else if (itemId == R.id.action_check_database) {</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7279)) {</span>
<span class="nc" id="L1088">                    Timber.i(&quot;DeckPicker:: Check database button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1090" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7280)) {</span>
<span class="nc" id="L1091">                    showDatabaseErrorDialog(DatabaseErrorDialog.DIALOG_CONFIRM_DATABASE_CHECK);</span>
                }
<span class="nc" id="L1093">                return true;</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">            } else if (itemId == R.id.action_check_media) {</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7277)) {</span>
<span class="nc" id="L1096">                    Timber.i(&quot;DeckPicker:: Check media button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7278)) {</span>
<span class="nc" id="L1099">                    showMediaCheckDialog(MediaCheckDialog.DIALOG_CONFIRM_MEDIA_CHECK);</span>
                }
<span class="nc" id="L1101">                return true;</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">            } else if (itemId == R.id.action_empty_cards) {</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7275)) {</span>
<span class="nc" id="L1104">                    Timber.i(&quot;DeckPicker:: Empty cards button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1106" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7276)) {</span>
<span class="nc" id="L1107">                    handleEmptyCards();</span>
                }
<span class="nc" id="L1109">                return true;</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">            } else if (itemId == R.id.action_model_browser_open) {</span>
<span class="nc bnc" id="L1111" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7273)) {</span>
<span class="nc" id="L1112">                    Timber.i(&quot;DeckPicker:: Model browser button pressed&quot;);</span>
                }
<span class="nc" id="L1114">                Intent noteTypeBrowser = new Intent(this, ModelBrowser.class);</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7274)) {</span>
<span class="nc" id="L1116">                    startActivityForResultWithAnimation(noteTypeBrowser, 0, LEFT);</span>
                }
<span class="nc" id="L1118">                return true;</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">            } else if (itemId == R.id.action_restore_backup) {</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7271)) {</span>
<span class="nc" id="L1121">                    Timber.i(&quot;DeckPicker:: Restore from backup button pressed&quot;);</span>
                }
<span class="nc bnc" id="L1123" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7272)) {</span>
<span class="nc" id="L1124">                    showDatabaseErrorDialog(DatabaseErrorDialog.DIALOG_CONFIRM_RESTORE_BACKUP);</span>
                }
<span class="nc" id="L1126">                return true;</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">            } else if (itemId == R.id.action_export) {</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7269)) {</span>
<span class="nc" id="L1129">                    Timber.i(&quot;DeckPicker:: Export collection button pressed&quot;);</span>
                }
<span class="nc" id="L1131">                String msg = getResources().getString(R.string.confirm_apkg_export);</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7270)) {</span>
<span class="nc" id="L1133">                    showDialogFragment(ExportDialog.newInstance(msg));</span>
                }
<span class="nc" id="L1135">                return true;</span>
            }
        }
<span class="nc" id="L1138">        return super.onOptionsItemSelected(item);</span>
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent intent) {
<span class="nc bnc" id="L1143" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7295)) {</span>
<span class="nc" id="L1144">            super.onActivityResult(requestCode, resultCode, intent);</span>
        }
<span class="nc bnc" id="L1146" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7308)) {</span>
<span class="nc bnc" id="L1147" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(7300) ? (resultCode &gt;= RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(7299) ? (resultCode &lt;= RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(7298) ? (resultCode &gt; RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(7297) ? (resultCode &lt; RESULT_MEDIA_EJECTED) : (ListenerUtil.mutListener.listen(7296) ? (resultCode != RESULT_MEDIA_EJECTED) : (resultCode == RESULT_MEDIA_EJECTED))))))) {</span>
<span class="nc bnc" id="L1148" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7307)) {</span>
<span class="nc" id="L1149">                    onSdCardNotMounted();</span>
                }
<span class="nc" id="L1151">                return;</span>
<span class="nc bnc" id="L1152" title="All 22 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7305) ? (resultCode &gt;= RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(7304) ? (resultCode &lt;= RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(7303) ? (resultCode &gt; RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(7302) ? (resultCode &lt; RESULT_DB_ERROR) : (ListenerUtil.mutListener.listen(7301) ? (resultCode != RESULT_DB_ERROR) : (resultCode == RESULT_DB_ERROR))))))) {</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7306)) {</span>
<span class="nc" id="L1154">                    handleDbError();</span>
                }
<span class="nc" id="L1156">                return;</span>
            }
        }
<span class="nc bnc" id="L1159" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7382)) {</span>
<span class="nc bnc" id="L1160" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(7313) ? (requestCode &gt;= SHOW_INFO_NEW_VERSION) : (ListenerUtil.mutListener.listen(7312) ? (requestCode &lt;= SHOW_INFO_NEW_VERSION) : (ListenerUtil.mutListener.listen(7311) ? (requestCode &gt; SHOW_INFO_NEW_VERSION) : (ListenerUtil.mutListener.listen(7310) ? (requestCode &lt; SHOW_INFO_NEW_VERSION) : (ListenerUtil.mutListener.listen(7309) ? (requestCode != SHOW_INFO_NEW_VERSION) : (requestCode == SHOW_INFO_NEW_VERSION))))))) {</span>
<span class="nc bnc" id="L1161" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7381)) {</span>
<span class="nc" id="L1162">                    showStartupScreensAndDialogs(AnkiDroidApp.getSharedPrefs(getBaseContext()), 3);</span>
                }
<span class="nc bnc" id="L1164" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7319) ? ((ListenerUtil.mutListener.listen(7318) ? (requestCode &gt;= LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7317) ? (requestCode &lt;= LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7316) ? (requestCode &gt; LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7315) ? (requestCode &lt; LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7314) ? (requestCode != LOG_IN_FOR_SYNC) : (requestCode == LOG_IN_FOR_SYNC)))))) || resultCode == RESULT_OK) : ((ListenerUtil.mutListener.listen(7318) ? (requestCode &gt;= LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7317) ? (requestCode &lt;= LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7316) ? (requestCode &gt; LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7315) ? (requestCode &lt; LOG_IN_FOR_SYNC) : (ListenerUtil.mutListener.listen(7314) ? (requestCode != LOG_IN_FOR_SYNC) : (requestCode == LOG_IN_FOR_SYNC)))))) &amp;&amp; resultCode == RESULT_OK))) {</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7380)) {</span>
<span class="nc" id="L1166">                    mSyncOnResume = true;</span>
                }
<span class="nc bnc" id="L1168" title="All 90 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7330) ? ((ListenerUtil.mutListener.listen(7324) ? (requestCode &gt;= REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7323) ? (requestCode &lt;= REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7322) ? (requestCode &gt; REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7321) ? (requestCode &lt; REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7320) ? (requestCode != REQUEST_REVIEW) : (requestCode == REQUEST_REVIEW)))))) &amp;&amp; (ListenerUtil.mutListener.listen(7329) ? (requestCode &gt;= SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7328) ? (requestCode &lt;= SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7327) ? (requestCode &gt; SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7326) ? (requestCode &lt; SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7325) ? (requestCode != SHOW_STUDYOPTIONS) : (requestCode == SHOW_STUDYOPTIONS))))))) : ((ListenerUtil.mutListener.listen(7324) ? (requestCode &gt;= REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7323) ? (requestCode &lt;= REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7322) ? (requestCode &gt; REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7321) ? (requestCode &lt; REQUEST_REVIEW) : (ListenerUtil.mutListener.listen(7320) ? (requestCode != REQUEST_REVIEW) : (requestCode == REQUEST_REVIEW)))))) || (ListenerUtil.mutListener.listen(7329) ? (requestCode &gt;= SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7328) ? (requestCode &lt;= SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7327) ? (requestCode &gt; SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7326) ? (requestCode &lt; SHOW_STUDYOPTIONS) : (ListenerUtil.mutListener.listen(7325) ? (requestCode != SHOW_STUDYOPTIONS) : (requestCode == SHOW_STUDYOPTIONS))))))))) {</span>
<span class="nc bnc" id="L1169" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7379)) {</span>
<span class="nc bnc" id="L1170" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7367) ? (resultCode &gt;= Reviewer.RESULT_NO_MORE_CARDS) : (ListenerUtil.mutListener.listen(7366) ? (resultCode &lt;= Reviewer.RESULT_NO_MORE_CARDS) : (ListenerUtil.mutListener.listen(7365) ? (resultCode &gt; Reviewer.RESULT_NO_MORE_CARDS) : (ListenerUtil.mutListener.listen(7364) ? (resultCode &lt; Reviewer.RESULT_NO_MORE_CARDS) : (ListenerUtil.mutListener.listen(7363) ? (resultCode != Reviewer.RESULT_NO_MORE_CARDS) : (resultCode == Reviewer.RESULT_NO_MORE_CARDS))))))) {</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7378)) {</span>
                            // Show a message when reviewing has finished
<span class="nc bnc" id="L1173" title="All 2 branches missed.">                            if (getCol().getSched().count() == 0) {</span>
<span class="nc bnc" id="L1174" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7377)) {</span>
<span class="nc" id="L1175">                                    UIUtils.showSimpleSnackbar(this, R.string.studyoptions_congrats_finished, false);</span>
                                }
                            } else {
<span class="nc bnc" id="L1178" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7376)) {</span>
<span class="nc" id="L1179">                                    UIUtils.showSimpleSnackbar(this, R.string.studyoptions_no_cards_due, false);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L1183" title="All 22 branches missed.">                    } else if ((ListenerUtil.mutListener.listen(7372) ? (resultCode &gt;= Reviewer.RESULT_ABORT_AND_SYNC) : (ListenerUtil.mutListener.listen(7371) ? (resultCode &lt;= Reviewer.RESULT_ABORT_AND_SYNC) : (ListenerUtil.mutListener.listen(7370) ? (resultCode &gt; Reviewer.RESULT_ABORT_AND_SYNC) : (ListenerUtil.mutListener.listen(7369) ? (resultCode &lt; Reviewer.RESULT_ABORT_AND_SYNC) : (ListenerUtil.mutListener.listen(7368) ? (resultCode != Reviewer.RESULT_ABORT_AND_SYNC) : (resultCode == Reviewer.RESULT_ABORT_AND_SYNC))))))) {</span>
<span class="nc bnc" id="L1184" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7373)) {</span>
<span class="nc" id="L1185">                            Timber.i(&quot;Obtained Abort and Sync result&quot;);</span>
                        }
<span class="nc bnc" id="L1187" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7374)) {</span>
<span class="nc" id="L1188">                            CollectionTask.waitForAllToFinish(4);</span>
                        }
<span class="nc bnc" id="L1190" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7375)) {</span>
<span class="nc" id="L1191">                            sync();</span>
                        }
                    }
                }
<span class="nc bnc" id="L1195" title="All 22 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7335) ? (requestCode &gt;= REQUEST_BROWSE_CARDS) : (ListenerUtil.mutListener.listen(7334) ? (requestCode &lt;= REQUEST_BROWSE_CARDS) : (ListenerUtil.mutListener.listen(7333) ? (requestCode &gt; REQUEST_BROWSE_CARDS) : (ListenerUtil.mutListener.listen(7332) ? (requestCode &lt; REQUEST_BROWSE_CARDS) : (ListenerUtil.mutListener.listen(7331) ? (requestCode != REQUEST_BROWSE_CARDS) : (requestCode == REQUEST_BROWSE_CARDS))))))) {</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7362)) {</span>
                    // Store the selected deck after opening browser
<span class="nc bnc" id="L1198" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(7359) ? (intent != null || intent.getBooleanExtra(&quot;allDecksSelected&quot;, false)) : (intent != null &amp;&amp; intent.getBooleanExtra(&quot;allDecksSelected&quot;, false)))) {</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7361)) {</span>
<span class="nc" id="L1200">                            AnkiDroidApp.getSharedPrefs(this).edit().putLong(&quot;browserDeckIdFromDeckPicker&quot;, Decks.NOT_FOUND_DECK_ID).apply();</span>
                        }
                    } else {
<span class="nc" id="L1203">                        long selectedDeck = getCol().getDecks().selected();</span>
<span class="nc bnc" id="L1204" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7360)) {</span>
<span class="nc" id="L1205">                            AnkiDroidApp.getSharedPrefs(this).edit().putLong(&quot;browserDeckIdFromDeckPicker&quot;, selectedDeck).apply();</span>
                        }
<span class="nc" id="L1207">                    }</span>
                }
<span class="nc bnc" id="L1209" title="All 22 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7340) ? (requestCode &gt;= REQUEST_PATH_UPDATE) : (ListenerUtil.mutListener.listen(7339) ? (requestCode &lt;= REQUEST_PATH_UPDATE) : (ListenerUtil.mutListener.listen(7338) ? (requestCode &gt; REQUEST_PATH_UPDATE) : (ListenerUtil.mutListener.listen(7337) ? (requestCode &lt; REQUEST_PATH_UPDATE) : (ListenerUtil.mutListener.listen(7336) ? (requestCode != REQUEST_PATH_UPDATE) : (requestCode == REQUEST_PATH_UPDATE))))))) {</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7358)) {</span>
                    // The collection path was inaccessible on startup so just close the activity and let user restart
<span class="nc" id="L1212">                    finishWithoutAnimation();</span>
                }
<span class="nc bnc" id="L1214" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7346) ? (((ListenerUtil.mutListener.listen(7345) ? (requestCode &gt;= PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7344) ? (requestCode &lt;= PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7343) ? (requestCode &gt; PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7342) ? (requestCode &lt; PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7341) ? (requestCode != PICK_APKG_FILE) : (requestCode == PICK_APKG_FILE))))))) || (resultCode == RESULT_OK)) : (((ListenerUtil.mutListener.listen(7345) ? (requestCode &gt;= PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7344) ? (requestCode &lt;= PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7343) ? (requestCode &gt; PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7342) ? (requestCode &lt; PICK_APKG_FILE) : (ListenerUtil.mutListener.listen(7341) ? (requestCode != PICK_APKG_FILE) : (requestCode == PICK_APKG_FILE))))))) &amp;&amp; (resultCode == RESULT_OK)))) {</span>
<span class="nc" id="L1215">                ImportUtils.ImportResult importResult = ImportUtils.handleFileImport(this, intent);</span>
<span class="nc bnc" id="L1216" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7357)) {</span>
<span class="nc bnc" id="L1217" title="All 2 branches missed.">                    if (!importResult.isSuccess()) {</span>
<span class="nc bnc" id="L1218" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7356)) {</span>
<span class="nc" id="L1219">                            ImportUtils.showImportUnsuccessfulDialog(this, importResult.getHumanReadableMessage(), false);</span>
                        }
                    }
                }
<span class="nc bnc" id="L1223" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7352) ? (((ListenerUtil.mutListener.listen(7351) ? (requestCode &gt;= PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7350) ? (requestCode &lt;= PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7349) ? (requestCode &gt; PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7348) ? (requestCode &lt; PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7347) ? (requestCode != PICK_EXPORT_FILE) : (requestCode == PICK_EXPORT_FILE))))))) || (resultCode == RESULT_OK)) : (((ListenerUtil.mutListener.listen(7351) ? (requestCode &gt;= PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7350) ? (requestCode &lt;= PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7349) ? (requestCode &gt; PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7348) ? (requestCode &lt; PICK_EXPORT_FILE) : (ListenerUtil.mutListener.listen(7347) ? (requestCode != PICK_EXPORT_FILE) : (requestCode == PICK_EXPORT_FILE))))))) &amp;&amp; (resultCode == RESULT_OK)))) {</span>
<span class="nc bnc" id="L1224" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7355)) {</span>
<span class="nc bnc" id="L1225" title="All 2 branches missed.">                    if (exportToProvider(intent, true)) {</span>
<span class="nc bnc" id="L1226" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7354)) {</span>
<span class="nc" id="L1227">                            UIUtils.showSimpleSnackbar(this, getString(R.string.export_save_apkg_successful), true);</span>
                        }
                    } else {
<span class="nc bnc" id="L1230" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7353)) {</span>
<span class="nc" id="L1231">                            UIUtils.showSimpleSnackbar(this, getString(R.string.export_save_apkg_unsuccessful), false);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1237">    }</span>

    private boolean exportToProvider(Intent intent, boolean deleteAfterExport) {
<span class="nc bnc" id="L1240" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7385)) {</span>
<span class="nc bnc" id="L1241" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7383) ? ((intent == null) &amp;&amp; (intent.getData() == null)) : ((intent == null) || (intent.getData() == null)))) {</span>
<span class="nc bnc" id="L1242" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7384)) {</span>
<span class="nc" id="L1243">                    Timber.e(&quot;exportToProvider() provided with insufficient intent data %s&quot;, intent);</span>
                }
<span class="nc" id="L1245">                return false;</span>
            }
        }
<span class="nc" id="L1248">        Uri uri = intent.getData();</span>
<span class="nc bnc" id="L1249" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7386)) {</span>
<span class="nc" id="L1250">            Timber.d(&quot;Exporting from file to ContentProvider URI: %s/%s&quot;, mExportFileName, uri.toString());</span>
        }
        FileOutputStream fileOutputStream;
        ParcelFileDescriptor pfd;
        try {
<span class="nc" id="L1255">            pfd = getContentResolver().openFileDescriptor(uri, &quot;w&quot;);</span>
<span class="nc bnc" id="L1256" title="All 2 branches missed.">            if (pfd != null) {</span>
<span class="nc" id="L1257">                fileOutputStream = new FileOutputStream(pfd.getFileDescriptor());</span>
<span class="nc bnc" id="L1258" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7389)) {</span>
<span class="nc" id="L1259">                    CompatHelper.getCompat().copyFile(mExportFileName, fileOutputStream);</span>
                }
<span class="nc bnc" id="L1261" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7390)) {</span>
<span class="nc" id="L1262">                    fileOutputStream.close();</span>
                }
<span class="nc bnc" id="L1264" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7391)) {</span>
<span class="nc" id="L1265">                    pfd.close();</span>
                }
            } else {
<span class="nc bnc" id="L1268" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7388)) {</span>
<span class="nc" id="L1269">                    Timber.w(&quot;exportToProvider() failed - ContentProvider returned null file descriptor for %s&quot;, uri);</span>
                }
<span class="nc" id="L1271">                return false;</span>
            }
<span class="nc bnc" id="L1273" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7394)) {</span>
<span class="nc bnc" id="L1274" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7392) ? (deleteAfterExport || !new File(mExportFileName).delete()) : (deleteAfterExport &amp;&amp; !new File(mExportFileName).delete()))) {</span>
<span class="nc bnc" id="L1275" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7393)) {</span>
<span class="nc" id="L1276">                        Timber.w(&quot;Failed to delete temporary export file %s&quot;, mExportFileName);</span>
                    }
                }
            }
<span class="nc" id="L1280">        } catch (Exception e) {</span>
<span class="nc bnc" id="L1281" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7387)) {</span>
<span class="nc" id="L1282">                Timber.e(e, &quot;Unable to export file to Uri: %s/%s&quot;, mExportFileName, uri.toString());</span>
            }
<span class="nc" id="L1284">            return false;</span>
<span class="nc" id="L1285">        }</span>
<span class="nc" id="L1286">        return true;</span>
    }

    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
<span class="nc bnc" id="L1290" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7414)) {</span>
<span class="nc bnc" id="L1291" title="All 90 branches missed.">            if ((ListenerUtil.mutListener.listen(7405) ? ((ListenerUtil.mutListener.listen(7399) ? (requestCode &gt;= REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7398) ? (requestCode &lt;= REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7397) ? (requestCode &gt; REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7396) ? (requestCode &lt; REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7395) ? (requestCode != REQUEST_STORAGE_PERMISSION) : (requestCode == REQUEST_STORAGE_PERMISSION)))))) || (ListenerUtil.mutListener.listen(7404) ? (permissions.length &gt;= 1) : (ListenerUtil.mutListener.listen(7403) ? (permissions.length &lt;= 1) : (ListenerUtil.mutListener.listen(7402) ? (permissions.length &gt; 1) : (ListenerUtil.mutListener.listen(7401) ? (permissions.length &lt; 1) : (ListenerUtil.mutListener.listen(7400) ? (permissions.length != 1) : (permissions.length == 1))))))) : ((ListenerUtil.mutListener.listen(7399) ? (requestCode &gt;= REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7398) ? (requestCode &lt;= REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7397) ? (requestCode &gt; REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7396) ? (requestCode &lt; REQUEST_STORAGE_PERMISSION) : (ListenerUtil.mutListener.listen(7395) ? (requestCode != REQUEST_STORAGE_PERMISSION) : (requestCode == REQUEST_STORAGE_PERMISSION)))))) &amp;&amp; (ListenerUtil.mutListener.listen(7404) ? (permissions.length &gt;= 1) : (ListenerUtil.mutListener.listen(7403) ? (permissions.length &lt;= 1) : (ListenerUtil.mutListener.listen(7402) ? (permissions.length &gt; 1) : (ListenerUtil.mutListener.listen(7401) ? (permissions.length &lt; 1) : (ListenerUtil.mutListener.listen(7400) ? (permissions.length != 1) : (permissions.length == 1))))))))) {</span>
<span class="nc bnc" id="L1292" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7413)) {</span>
<span class="nc bnc" id="L1293" title="All 2 branches missed.">                    if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {</span>
<span class="nc bnc" id="L1294" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7411)) {</span>
<span class="nc" id="L1295">                            invalidateOptionsMenu();</span>
                        }
<span class="nc bnc" id="L1297" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7412)) {</span>
<span class="nc" id="L1298">                            showStartupScreensAndDialogs(AnkiDroidApp.getSharedPrefs(this), 0);</span>
                        }
                    } else {
<span class="nc bnc" id="L1301" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7406)) {</span>
                            // User denied access to file storage  so show error toast and display &quot;App Info&quot;
<span class="nc" id="L1303">                            Toast.makeText(this, R.string.startup_no_storage_permission, Toast.LENGTH_LONG).show();</span>
                        }
<span class="nc bnc" id="L1305" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7407)) {</span>
<span class="nc" id="L1306">                            finishWithoutAnimation();</span>
                        }
                        // Open the Android settings page for our app so that the user can grant the missing permission
<span class="nc" id="L1309">                        Intent intent = new Intent();</span>
<span class="nc bnc" id="L1310" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7408)) {</span>
<span class="nc" id="L1311">                            intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</span>
                        }
<span class="nc" id="L1313">                        Uri uri = Uri.fromParts(&quot;package&quot;, getPackageName(), null);</span>
<span class="nc bnc" id="L1314" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7409)) {</span>
<span class="nc" id="L1315">                            intent.setData(uri);</span>
                        }
<span class="nc bnc" id="L1317" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7410)) {</span>
<span class="nc" id="L1318">                            startActivityWithoutAnimation(intent);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1324">    }</span>

    @Override
    protected void onResume() {
<span class="nc bnc" id="L1328" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7415)) {</span>
<span class="nc" id="L1329">            Timber.d(&quot;onResume()&quot;);</span>
        }
<span class="nc bnc" id="L1331" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7416)) {</span>
<span class="nc" id="L1332">            super.onResume();</span>
        }
<span class="nc bnc" id="L1334" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7417)) {</span>
<span class="nc" id="L1335">            mActivityPaused = false;</span>
        }
<span class="nc bnc" id="L1337" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7426)) {</span>
<span class="nc bnc" id="L1338" title="All 2 branches missed.">            if (mSyncOnResume) {</span>
<span class="nc bnc" id="L1339" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7423)) {</span>
<span class="nc" id="L1340">                    Timber.i(&quot;Performing Sync on Resume&quot;);</span>
                }
<span class="nc bnc" id="L1342" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7424)) {</span>
<span class="nc" id="L1343">                    sync();</span>
                }
<span class="nc bnc" id="L1345" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7425)) {</span>
<span class="nc" id="L1346">                    mSyncOnResume = false;</span>
                }
<span class="nc bnc" id="L1348" title="All 2 branches missed.">            } else if (colIsOpen()) {</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7418)) {</span>
<span class="nc" id="L1350">                    selectNavigationItem(R.id.nav_decks);</span>
                }
<span class="nc bnc" id="L1352" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7420)) {</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">                    if (mDueTree == null) {</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7419)) {</span>
<span class="nc" id="L1355">                            updateDeckList(true);</span>
                        }
                    }
                }
<span class="nc bnc" id="L1359" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7421)) {</span>
<span class="nc" id="L1360">                    updateDeckList();</span>
                }
<span class="nc bnc" id="L1362" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7422)) {</span>
<span class="nc" id="L1363">                    setTitle(getResources().getString(R.string.app_name));</span>
                }
            }
        }
<span class="nc bnc" id="L1367" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7427)) {</span>
            /* Complete task and enqueue fetching nonessential data for
          startup. */
<span class="nc" id="L1370">            TaskManager.launchCollectionTask(new CollectionTask.LoadCollectionComplete());</span>
        }
<span class="nc bnc" id="L1372" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7428)) {</span>
            // Update sync status (if we've come back from a screen)
<span class="nc" id="L1374">            supportInvalidateOptionsMenu();</span>
        }
<span class="nc" id="L1376">    }</span>

    @Override
    public void onSaveInstanceState(@NonNull Bundle savedInstanceState) {
<span class="nc bnc" id="L1380" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7429)) {</span>
<span class="nc" id="L1381">            super.onSaveInstanceState(savedInstanceState);</span>
        }
<span class="nc bnc" id="L1383" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7430)) {</span>
<span class="nc" id="L1384">            savedInstanceState.putLong(&quot;mContextMenuDid&quot;, mContextMenuDid);</span>
        }
<span class="nc bnc" id="L1386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7431)) {</span>
<span class="nc" id="L1387">            savedInstanceState.putBoolean(&quot;mClosedWelcomeMessage&quot;, mClosedWelcomeMessage);</span>
        }
<span class="nc" id="L1389">    }</span>

    @Override
    public void onRestoreInstanceState(Bundle savedInstanceState) {
<span class="nc bnc" id="L1393" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7432)) {</span>
<span class="nc" id="L1394">            super.onRestoreInstanceState(savedInstanceState);</span>
        }
<span class="nc bnc" id="L1396" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7433)) {</span>
<span class="nc" id="L1397">            mContextMenuDid = savedInstanceState.getLong(&quot;mContextMenuDid&quot;);</span>
        }
<span class="nc" id="L1399">    }</span>

    @Override
    protected void onPause() {
<span class="nc bnc" id="L1403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7434)) {</span>
<span class="nc" id="L1404">            Timber.d(&quot;onPause()&quot;);</span>
        }
<span class="nc bnc" id="L1406" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7435)) {</span>
<span class="nc" id="L1407">            mActivityPaused = true;</span>
        }
<span class="nc bnc" id="L1409" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7436)) {</span>
            // The deck count will be computed on resume. No need to compute it now
<span class="nc" id="L1411">            TaskManager.cancelAllTasks(CollectionTask.LoadDeckCounts.class);</span>
        }
<span class="nc bnc" id="L1413" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7437)) {</span>
<span class="nc" id="L1414">            super.onPause();</span>
        }
<span class="nc" id="L1416">    }</span>

    @Override
    protected void onStop() {
<span class="nc bnc" id="L1420" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7438)) {</span>
<span class="nc" id="L1421">            Timber.d(&quot;onStop()&quot;);</span>
        }
<span class="nc bnc" id="L1423" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7439)) {</span>
<span class="nc" id="L1424">            super.onStop();</span>
        }
<span class="nc bnc" id="L1426" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7442)) {</span>
<span class="nc bnc" id="L1427" title="All 2 branches missed.">            if (colIsOpen()) {</span>
<span class="nc bnc" id="L1428" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7440)) {</span>
<span class="nc" id="L1429">                    WidgetStatus.update(this);</span>
                }
<span class="nc bnc" id="L1431" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7441)) {</span>
                    // Ignore the modification - a change in deck shouldn't trigger the icon for &quot;pending changes&quot;.
<span class="nc" id="L1433">                    UIUtils.saveCollectionInBackground(true);</span>
                }
            }
        }
<span class="nc" id="L1437">    }</span>

    @Override
    protected void onDestroy() {
<span class="nc bnc" id="L1441" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7443)) {</span>
<span class="nc" id="L1442">            super.onDestroy();</span>
        }
<span class="nc bnc" id="L1444" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7445)) {</span>
<span class="nc bnc" id="L1445" title="All 2 branches missed.">            if (mUnmountReceiver != null) {</span>
<span class="nc bnc" id="L1446" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7444)) {</span>
<span class="nc" id="L1447">                    unregisterReceiver(mUnmountReceiver);</span>
                }
            }
        }
<span class="nc bnc" id="L1451" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7448)) {</span>
<span class="nc bnc" id="L1452" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7446) ? (mProgressDialog != null || mProgressDialog.isShowing()) : (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L1453" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7447)) {</span>
<span class="nc" id="L1454">                    mProgressDialog.dismiss();</span>
                }
            }
        }
<span class="nc bnc" id="L1458" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7449)) {</span>
<span class="nc" id="L1459">            Timber.d(&quot;onDestroy()&quot;);</span>
        }
<span class="nc" id="L1461">    }</span>

    private void automaticSync() {
<span class="nc" id="L1464">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
        // (currently 10 minutes)
<span class="nc" id="L1466">        String hkey = preferences.getString(&quot;hkey&quot;, &quot;&quot;);</span>
<span class="nc" id="L1467">        long lastSyncTime = preferences.getLong(&quot;lastSyncTime&quot;, 0);</span>
<span class="nc bnc" id="L1468" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7469)) {</span>
<span class="nc bnc" id="L1469" title="All 354 branches missed.">            if ((ListenerUtil.mutListener.listen(7466) ? ((ListenerUtil.mutListener.listen(7456) ? ((ListenerUtil.mutListener.listen(7455) ? ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) || preferences.getBoolean(&quot;automaticSyncMode&quot;, false)) : ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) &amp;&amp; preferences.getBoolean(&quot;automaticSyncMode&quot;, false))) || Connection.isOnline()) : ((ListenerUtil.mutListener.listen(7455) ? ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) || preferences.getBoolean(&quot;automaticSyncMode&quot;, false)) : ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) &amp;&amp; preferences.getBoolean(&quot;automaticSyncMode&quot;, false))) &amp;&amp; Connection.isOnline())) || (ListenerUtil.mutListener.listen(7465) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &gt;= AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7464) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &lt;= AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7463) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &lt; AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7462) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) != AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7461) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) == AUTOMATIC_SYNC_MIN_INTERVAL) : ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &gt; AUTOMATIC_SYNC_MIN_INTERVAL))))))) : ((ListenerUtil.mutListener.listen(7456) ? ((ListenerUtil.mutListener.listen(7455) ? ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) || preferences.getBoolean(&quot;automaticSyncMode&quot;, false)) : ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) &amp;&amp; preferences.getBoolean(&quot;automaticSyncMode&quot;, false))) || Connection.isOnline()) : ((ListenerUtil.mutListener.listen(7455) ? ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) || preferences.getBoolean(&quot;automaticSyncMode&quot;, false)) : ((ListenerUtil.mutListener.listen(7454) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7453) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7452) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7451) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7450) ? (hkey.length() == 0) : (hkey.length() != 0)))))) &amp;&amp; preferences.getBoolean(&quot;automaticSyncMode&quot;, false))) &amp;&amp; Connection.isOnline())) &amp;&amp; (ListenerUtil.mutListener.listen(7465) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &gt;= AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7464) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &lt;= AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7463) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &lt; AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7462) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) != AUTOMATIC_SYNC_MIN_INTERVAL) : (ListenerUtil.mutListener.listen(7461) ? ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) == AUTOMATIC_SYNC_MIN_INTERVAL) : ((ListenerUtil.mutListener.listen(7460) ? (getCol().getTime().intTimeMS() % lastSyncTime) : (ListenerUtil.mutListener.listen(7459) ? (getCol().getTime().intTimeMS() / lastSyncTime) : (ListenerUtil.mutListener.listen(7458) ? (getCol().getTime().intTimeMS() * lastSyncTime) : (ListenerUtil.mutListener.listen(7457) ? (getCol().getTime().intTimeMS() + lastSyncTime) : (getCol().getTime().intTimeMS() - lastSyncTime))))) &gt; AUTOMATIC_SYNC_MIN_INTERVAL))))))))) {</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7467)) {</span>
<span class="nc" id="L1471">                    Timber.i(&quot;Triggering Automatic Sync&quot;);</span>
                }
<span class="nc bnc" id="L1473" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7468)) {</span>
<span class="nc" id="L1474">                    sync();</span>
                }
            }
        }
<span class="nc" id="L1478">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc bnc" id="L1482" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7477)) {</span>
<span class="nc bnc" id="L1483" title="All 2 branches missed.">            if (isDrawerOpen()) {</span>
<span class="nc bnc" id="L1484" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7476)) {</span>
<span class="nc" id="L1485">                    super.onBackPressed();</span>
                }
            } else {
<span class="nc bnc" id="L1488" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7470)) {</span>
<span class="nc" id="L1489">                    Timber.i(&quot;Back key pressed&quot;);</span>
                }
<span class="nc bnc" id="L1491" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7475)) {</span>
<span class="nc bnc" id="L1492" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(7471) ? (mActionsMenu != null || mActionsMenu.isExpanded()) : (mActionsMenu != null &amp;&amp; mActionsMenu.isExpanded()))) {</span>
<span class="nc bnc" id="L1493" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7474)) {</span>
<span class="nc" id="L1494">                            mActionsMenu.collapse();</span>
                        }
                    } else {
<span class="nc bnc" id="L1497" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7472)) {</span>
<span class="nc" id="L1498">                            automaticSync();</span>
                        }
<span class="nc bnc" id="L1500" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7473)) {</span>
<span class="nc" id="L1501">                            finishWithAnimation();</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L1507">    }</span>

    private void finishWithAnimation() {
<span class="nc bnc" id="L1510" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7478)) {</span>
<span class="nc" id="L1511">            super.finishWithAnimation(DOWN);</span>
        }
<span class="nc" id="L1513">    }</span>

    @Override
    public boolean onKeyUp(int keyCode, KeyEvent event) {
<span class="nc bnc" id="L1517" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7481)) {</span>
<span class="nc bnc" id="L1518" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7479) ? (mToolbarSearchView != null || mToolbarSearchView.hasFocus()) : (mToolbarSearchView != null &amp;&amp; mToolbarSearchView.hasFocus()))) {</span>
<span class="nc bnc" id="L1519" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7480)) {</span>
<span class="nc" id="L1520">                    Timber.d(&quot;Skipping keypress: search action bar is focused&quot;);</span>
                }
<span class="nc" id="L1522">                return true;</span>
            }
        }
<span class="nc bnc" id="L1525" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7490)) {</span>
<span class="nc bnc" id="L1526" title="All 5 branches missed.">            switch(keyCode) {</span>
                case KeyEvent.KEYCODE_A:
<span class="nc bnc" id="L1528" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7482)) {</span>
<span class="nc" id="L1529">                        Timber.i(&quot;Adding Note from keypress&quot;);</span>
                    }
<span class="nc bnc" id="L1531" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7483)) {</span>
<span class="nc" id="L1532">                        addNote();</span>
                    }
                    break;
                case KeyEvent.KEYCODE_B:
<span class="nc bnc" id="L1536" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7484)) {</span>
<span class="nc" id="L1537">                        Timber.i(&quot;Open Browser from keypress&quot;);</span>
                    }
<span class="nc bnc" id="L1539" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7485)) {</span>
<span class="nc" id="L1540">                        openCardBrowser();</span>
                    }
                    break;
                case KeyEvent.KEYCODE_Y:
<span class="nc bnc" id="L1544" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7486)) {</span>
<span class="nc" id="L1545">                        Timber.i(&quot;Sync from keypress&quot;);</span>
                    }
<span class="nc bnc" id="L1547" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7487)) {</span>
<span class="nc" id="L1548">                        sync();</span>
                    }
                    break;
                case KeyEvent.KEYCODE_SLASH:
                case KeyEvent.KEYCODE_S:
<span class="nc bnc" id="L1553" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7488)) {</span>
<span class="nc" id="L1554">                        Timber.i(&quot;Study from keypress&quot;);</span>
                    }
<span class="nc bnc" id="L1556" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7489)) {</span>
<span class="nc" id="L1557">                        handleDeckSelection(getCol().getDecks().selected(), DeckSelectionType.SKIP_STUDY_OPTIONS);</span>
                    }
                    break;
                default:
                    break;
            }
        }
<span class="nc" id="L1564">        return super.onKeyUp(keyCode, event);</span>
    }

    private void restoreWelcomeMessage(Bundle savedInstanceState) {
<span class="nc bnc" id="L1568" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7491)) {</span>
<span class="nc bnc" id="L1569" title="All 2 branches missed.">            if (savedInstanceState == null) {</span>
<span class="nc" id="L1570">                return;</span>
            }
        }
<span class="nc bnc" id="L1573" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7492)) {</span>
<span class="nc" id="L1574">            mClosedWelcomeMessage = savedInstanceState.getBoolean(&quot;mClosedWelcomeMessage&quot;);</span>
        }
<span class="nc" id="L1576">    }</span>

    /**
     * Perform the following tasks:
     * Automatic backup
     * loadStudyOptionsFragment() if tablet
     * Automatic sync
     */
    private void onFinishedStartup() {
<span class="nc bnc" id="L1585" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7493)) {</span>
            // create backup in background if needed
<span class="nc" id="L1587">            BackupManager.performBackupInBackground(getCol().getPath(), getCol().getTime());</span>
        }
<span class="nc bnc" id="L1589" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7501)) {</span>
            // Force a full sync if flag was set in upgrade path, asking the user to confirm if necessary
<span class="nc bnc" id="L1591" title="All 2 branches missed.">            if (mRecommendFullSync) {</span>
<span class="nc bnc" id="L1592" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7494)) {</span>
<span class="nc" id="L1593">                    mRecommendFullSync = false;</span>
                }
                try {
<span class="nc bnc" id="L1596" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7500)) {</span>
<span class="nc" id="L1597">                        getCol().modSchema();</span>
                    }
<span class="nc" id="L1599">                } catch (ConfirmModSchemaException e) {</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7495)) {</span>
<span class="nc" id="L1601">                        Timber.w(&quot;Forcing full sync&quot;);</span>
                    }
                    // We have to show the dialog via the DialogHandler since this method is called via an async task
<span class="nc" id="L1604">                    Resources res = getResources();</span>
<span class="nc" id="L1605">                    Message handlerMessage = Message.obtain();</span>
<span class="nc bnc" id="L1606" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7496)) {</span>
<span class="nc" id="L1607">                        handlerMessage.what = DialogHandler.MSG_SHOW_FORCE_FULL_SYNC_DIALOG;</span>
                    }
<span class="nc" id="L1609">                    Bundle handlerMessageData = new Bundle();</span>
<span class="nc bnc" id="L1610" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7497)) {</span>
<span class="nc" id="L1611">                        handlerMessageData.putString(&quot;message&quot;, res.getString(R.string.full_sync_confirmation_upgrade) + &quot;\n\n&quot; + res.getString(R.string.full_sync_confirmation));</span>
                    }
<span class="nc bnc" id="L1613" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7498)) {</span>
<span class="nc" id="L1614">                        handlerMessage.setData(handlerMessageData);</span>
                    }
<span class="nc bnc" id="L1616" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7499)) {</span>
<span class="nc" id="L1617">                        getDialogHandler().sendMessage(handlerMessage);</span>
                    }
<span class="nc" id="L1619">                }</span>
            }
        }
<span class="nc bnc" id="L1622" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7503)) {</span>
            // Open StudyOptionsFragment if in fragmented mode
<span class="nc bnc" id="L1624" title="All 2 branches missed.">            if (mFragmented) {</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7502)) {</span>
<span class="nc" id="L1626">                    loadStudyOptionsFragment(false);</span>
                }
            }
        }
<span class="nc bnc" id="L1630" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7504)) {</span>
<span class="nc" id="L1631">            automaticSync();</span>
        }
<span class="nc" id="L1633">    }</span>

    private void showCollectionErrorDialog() {
<span class="nc bnc" id="L1636" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7505)) {</span>
<span class="nc" id="L1637">            getDialogHandler().sendEmptyMessage(DialogHandler.MSG_SHOW_COLLECTION_LOADING_ERROR_DIALOG);</span>
        }
<span class="nc" id="L1639">    }</span>

    public void addNote() {
<span class="nc" id="L1642">        Intent intent = new Intent(DeckPicker.this, NoteEditor.class);</span>
<span class="nc bnc" id="L1643" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7506)) {</span>
<span class="nc" id="L1644">            intent.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_DECKPICKER);</span>
        }
<span class="nc bnc" id="L1646" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7507)) {</span>
<span class="nc" id="L1647">            startActivityForResultWithAnimation(intent, ADD_NOTE, LEFT);</span>
        }
<span class="nc" id="L1649">    }</span>

    private void showStartupScreensAndDialogs(SharedPreferences preferences, int skip) {
<span class="nc bnc" id="L1652" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7629)) {</span>
<span class="nc bnc" id="L1653" title="All 2 branches missed.">            if (!BackupManager.enoughDiscSpace(CollectionHelper.getCurrentAnkiDroidDirectory(this))) {</span>
<span class="nc bnc" id="L1654" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7627)) {</span>
<span class="nc" id="L1655">                    Timber.i(&quot;Not enough space to do backup&quot;);</span>
                }
<span class="nc bnc" id="L1657" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7628)) {</span>
<span class="nc" id="L1658">                    showDialogFragment(DeckPickerNoSpaceLeftDialog.newInstance());</span>
                }
<span class="nc bnc" id="L1660" title="All 2 branches missed.">            } else if (preferences.getBoolean(&quot;noSpaceLeft&quot;, false)) {</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7624)) {</span>
<span class="nc" id="L1662">                    Timber.i(&quot;No space left&quot;);</span>
                }
<span class="nc bnc" id="L1664" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7625)) {</span>
<span class="nc" id="L1665">                    showDialogFragment(DeckPickerBackupNoSpaceLeftDialog.newInstance());</span>
                }
<span class="nc bnc" id="L1667" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7626)) {</span>
<span class="nc" id="L1668">                    preferences.edit().remove(&quot;noSpaceLeft&quot;).apply();</span>
                }
<span class="nc bnc" id="L1670" title="All 2 branches missed.">            } else if (&quot;&quot;.equals(preferences.getString(&quot;lastVersion&quot;, &quot;&quot;))) {</span>
<span class="nc bnc" id="L1671" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7621)) {</span>
<span class="nc" id="L1672">                    Timber.i(&quot;Fresh install&quot;);</span>
                }
<span class="nc bnc" id="L1674" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7622)) {</span>
<span class="nc" id="L1675">                    preferences.edit().putString(&quot;lastVersion&quot;, VersionUtils.getPkgVersionName()).apply();</span>
                }
<span class="nc bnc" id="L1677" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7623)) {</span>
<span class="nc" id="L1678">                    onFinishedStartup();</span>
                }
<span class="nc bnc" id="L1680" title="All 50 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7513) ? ((ListenerUtil.mutListener.listen(7512) ? (skip &gt;= 2) : (ListenerUtil.mutListener.listen(7511) ? (skip &lt;= 2) : (ListenerUtil.mutListener.listen(7510) ? (skip &gt; 2) : (ListenerUtil.mutListener.listen(7509) ? (skip != 2) : (ListenerUtil.mutListener.listen(7508) ? (skip == 2) : (skip &lt; 2)))))) || !preferences.getString(&quot;lastVersion&quot;, &quot;&quot;).equals(VersionUtils.getPkgVersionName())) : ((ListenerUtil.mutListener.listen(7512) ? (skip &gt;= 2) : (ListenerUtil.mutListener.listen(7511) ? (skip &lt;= 2) : (ListenerUtil.mutListener.listen(7510) ? (skip &gt; 2) : (ListenerUtil.mutListener.listen(7509) ? (skip != 2) : (ListenerUtil.mutListener.listen(7508) ? (skip == 2) : (skip &lt; 2)))))) &amp;&amp; !preferences.getString(&quot;lastVersion&quot;, &quot;&quot;).equals(VersionUtils.getPkgVersionName())))) {</span>
<span class="nc bnc" id="L1681" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7516)) {</span>
<span class="nc" id="L1682">                    Timber.i(&quot;AnkiDroid is being updated and a collection already exists.&quot;);</span>
                }
<span class="nc bnc" id="L1684" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7518)) {</span>
                    // The user might appreciate us now, see if they will help us get better?
<span class="nc bnc" id="L1686" title="All 2 branches missed.">                    if (!preferences.contains(UsageAnalytics.ANALYTICS_OPTIN_KEY)) {</span>
<span class="nc bnc" id="L1687" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7517)) {</span>
<span class="nc" id="L1688">                            showDialogFragment(DeckPickerAnalyticsOptInDialog.newInstance());</span>
                        }
                    }
                }
                // installation of AnkiDroid and we don't run the check.
<span class="nc" id="L1693">                long current = VersionUtils.getPkgVersionCode();</span>
<span class="nc bnc" id="L1694" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7519)) {</span>
<span class="nc" id="L1695">                    Timber.i(&quot;Current AnkiDroid version: %s&quot;, current);</span>
                }
                long previous;
<span class="nc bnc" id="L1698" title="All 2 branches missed.">                if (preferences.contains(UPGRADE_VERSION_KEY)) {</span>
                    // Upgrading currently installed app
<span class="nc" id="L1700">                    previous = getPreviousVersion(preferences, current);</span>
                } else {
                    // Fresh install
<span class="nc" id="L1703">                    previous = current;</span>
                }
<span class="nc bnc" id="L1705" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7520)) {</span>
<span class="nc" id="L1706">                    preferences.edit().putLong(UPGRADE_VERSION_KEY, current).apply();</span>
                }
<span class="nc bnc" id="L1708" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7529)) {</span>
                    // It is rebuilt on the next sync or media check
<span class="nc bnc" id="L1710" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7525) ? (previous &gt;= 20300200) : (ListenerUtil.mutListener.listen(7524) ? (previous &lt;= 20300200) : (ListenerUtil.mutListener.listen(7523) ? (previous &gt; 20300200) : (ListenerUtil.mutListener.listen(7522) ? (previous != 20300200) : (ListenerUtil.mutListener.listen(7521) ? (previous == 20300200) : (previous &lt; 20300200))))))) {</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7526)) {</span>
<span class="nc" id="L1712">                            Timber.i(&quot;Deleting media database&quot;);</span>
                        }
<span class="nc" id="L1714">                        File mediaDb = new File(CollectionHelper.getCurrentAnkiDroidDirectory(this), &quot;collection.media.ad.db2&quot;);</span>
<span class="nc bnc" id="L1715" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7528)) {</span>
<span class="nc bnc" id="L1716" title="All 2 branches missed.">                            if (mediaDb.exists()) {</span>
<span class="nc bnc" id="L1717" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7527)) {</span>
<span class="nc" id="L1718">                                    mediaDb.delete();</span>
                                }
                            }
                        }
                    }
                }
<span class="nc bnc" id="L1724" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7537)) {</span>
                    // Recommend the user to do a full-sync if they're upgrading from before 2.3.1beta8
<span class="nc bnc" id="L1726" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7534) ? (previous &gt;= 20301208) : (ListenerUtil.mutListener.listen(7533) ? (previous &lt;= 20301208) : (ListenerUtil.mutListener.listen(7532) ? (previous &gt; 20301208) : (ListenerUtil.mutListener.listen(7531) ? (previous != 20301208) : (ListenerUtil.mutListener.listen(7530) ? (previous == 20301208) : (previous &lt; 20301208))))))) {</span>
<span class="nc bnc" id="L1727" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7535)) {</span>
<span class="nc" id="L1728">                            Timber.i(&quot;Recommend the user to do a full-sync&quot;);</span>
                        }
<span class="nc bnc" id="L1730" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7536)) {</span>
<span class="nc" id="L1731">                            mRecommendFullSync = true;</span>
                        }
                    }
                }
<span class="nc bnc" id="L1735" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7550)) {</span>
                    // Fix &quot;font-family&quot; definition in templates created by AnkiDroid before 2.6alhpa23
<span class="nc bnc" id="L1737" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7542) ? (previous &gt;= 20600123) : (ListenerUtil.mutListener.listen(7541) ? (previous &lt;= 20600123) : (ListenerUtil.mutListener.listen(7540) ? (previous &gt; 20600123) : (ListenerUtil.mutListener.listen(7539) ? (previous != 20600123) : (ListenerUtil.mutListener.listen(7538) ? (previous == 20600123) : (previous &lt; 20600123))))))) {</span>
<span class="nc bnc" id="L1738" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7543)) {</span>
<span class="nc" id="L1739">                            Timber.i(&quot;Fixing font-family definition in templates&quot;);</span>
                        }
                        try {
<span class="nc" id="L1742">                            Models models = getCol().getModels();</span>
<span class="nc bnc" id="L1743" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7548)) {</span>
                                {
<span class="nc" id="L1745">                                    long _loopCounter131 = 0;</span>
<span class="nc bnc" id="L1746" title="All 2 branches missed.">                                    for (Model m : models.all()) {</span>
<span class="nc" id="L1747">                                        ListenerUtil.loopListener.listen(&quot;_loopCounter131&quot;, ++_loopCounter131);</span>
<span class="nc" id="L1748">                                        String css = m.getString(&quot;css&quot;);</span>
<span class="nc bnc" id="L1749" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7547)) {</span>
<span class="nc bnc" id="L1750" title="All 2 branches missed.">                                            if (css.contains(&quot;font-familiy&quot;)) {</span>
<span class="nc bnc" id="L1751" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7545)) {</span>
<span class="nc" id="L1752">                                                    m.put(&quot;css&quot;, css.replace(&quot;font-familiy&quot;, &quot;font-family&quot;));</span>
                                                }
<span class="nc bnc" id="L1754" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7546)) {</span>
<span class="nc" id="L1755">                                                    models.save(m);</span>
                                                }
                                            }
                                        }
<span class="nc" id="L1759">                                    }</span>
                                }
                            }
<span class="nc bnc" id="L1762" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7549)) {</span>
<span class="nc" id="L1763">                                models.flush();</span>
                            }
<span class="nc" id="L1765">                        } catch (JSONException e) {</span>
<span class="nc bnc" id="L1766" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7544)) {</span>
<span class="nc" id="L1767">                                Timber.e(e, &quot;Failed to upgrade css definitions.&quot;);</span>
                            }
<span class="nc" id="L1769">                        }</span>
                    }
                }
                // Check if preference upgrade or database check required, otherwise go to new feature screen
<span class="nc" id="L1773">                int upgradePrefsVersion = AnkiDroidApp.CHECK_PREFERENCES_AT_VERSION;</span>
<span class="nc" id="L1774">                int upgradeDbVersion = AnkiDroidApp.CHECK_DB_AT_VERSION;</span>
<span class="nc bnc" id="L1775" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7559)) {</span>
                    // Specifying a checkpoint in the future is not supported, please don't do it!
<span class="nc bnc" id="L1777" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7555) ? (current &gt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7554) ? (current &lt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7553) ? (current &gt; upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7552) ? (current != upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7551) ? (current == upgradePrefsVersion) : (current &lt; upgradePrefsVersion))))))) {</span>
<span class="nc bnc" id="L1778" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7556)) {</span>
<span class="nc" id="L1779">                            Timber.e(&quot;Checkpoint in future produced.&quot;);</span>
                        }
<span class="nc bnc" id="L1781" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7557)) {</span>
<span class="nc" id="L1782">                            UIUtils.showSimpleSnackbar(this, &quot;Invalid value for CHECK_PREFERENCES_AT_VERSION&quot;, false);</span>
                        }
<span class="nc bnc" id="L1784" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7558)) {</span>
<span class="nc" id="L1785">                            onFinishedStartup();</span>
                        }
<span class="nc" id="L1787">                        return;</span>
                    }
                }
<span class="nc bnc" id="L1790" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7568)) {</span>
<span class="nc bnc" id="L1791" title="All 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(7564) ? (current &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7563) ? (current &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7562) ? (current &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7561) ? (current != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7560) ? (current == upgradeDbVersion) : (current &lt; upgradeDbVersion))))))) {</span>
<span class="nc bnc" id="L1792" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7565)) {</span>
<span class="nc" id="L1793">                            Timber.e(&quot;Invalid value for CHECK_DB_AT_VERSION&quot;);</span>
                        }
<span class="nc bnc" id="L1795" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7566)) {</span>
<span class="nc" id="L1796">                            UIUtils.showSimpleSnackbar(this, &quot;Invalid value for CHECK_DB_AT_VERSION&quot;, false);</span>
                        }
<span class="nc bnc" id="L1798" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7567)) {</span>
<span class="nc" id="L1799">                            onFinishedStartup();</span>
                        }
<span class="nc" id="L1801">                        return;</span>
                    }
                }
                // TODO: remove this variable if we really want to do the full db check on every user
<span class="nc" id="L1805">                boolean skipDbCheck = false;</span>
<span class="nc bnc" id="L1806" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7620)) {</span>
                    // noinspection ConstantConditions
<span class="nc bnc" id="L1808" title="All 146 branches missed.">                    if ((ListenerUtil.mutListener.listen(7580) ? (((ListenerUtil.mutListener.listen(7574) ? (!skipDbCheck || (ListenerUtil.mutListener.listen(7573) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7572) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7571) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7570) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7569) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))) : (!skipDbCheck &amp;&amp; (ListenerUtil.mutListener.listen(7573) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7572) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7571) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7570) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7569) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))))) &amp;&amp; (ListenerUtil.mutListener.listen(7579) ? (previous &gt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7578) ? (previous &lt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7577) ? (previous &gt; upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7576) ? (previous != upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7575) ? (previous == upgradePrefsVersion) : (previous &lt; upgradePrefsVersion))))))) : (((ListenerUtil.mutListener.listen(7574) ? (!skipDbCheck || (ListenerUtil.mutListener.listen(7573) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7572) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7571) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7570) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7569) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))) : (!skipDbCheck &amp;&amp; (ListenerUtil.mutListener.listen(7573) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7572) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7571) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7570) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7569) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))))) || (ListenerUtil.mutListener.listen(7579) ? (previous &gt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7578) ? (previous &lt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7577) ? (previous &gt; upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7576) ? (previous != upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7575) ? (previous == upgradePrefsVersion) : (previous &lt; upgradePrefsVersion))))))))) {</span>
<span class="nc bnc" id="L1809" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7603)) {</span>
<span class="nc bnc" id="L1810" title="All 22 branches missed.">                            if ((ListenerUtil.mutListener.listen(7600) ? (previous &gt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7599) ? (previous &lt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7598) ? (previous &gt; upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7597) ? (previous != upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7596) ? (previous == upgradePrefsVersion) : (previous &lt; upgradePrefsVersion))))))) {</span>
<span class="nc bnc" id="L1811" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7601)) {</span>
<span class="nc" id="L1812">                                    Timber.i(&quot;showStartupScreensAndDialogs() running upgradePreferences()&quot;);</span>
                                }
<span class="nc bnc" id="L1814" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7602)) {</span>
<span class="nc" id="L1815">                                    upgradePreferences(previous);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L1819" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7619)) {</span>
                            // noinspection ConstantConditions
<span class="nc bnc" id="L1821" title="All 50 branches missed.">                            if ((ListenerUtil.mutListener.listen(7609) ? (!skipDbCheck || (ListenerUtil.mutListener.listen(7608) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7607) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7606) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7605) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7604) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))) : (!skipDbCheck &amp;&amp; (ListenerUtil.mutListener.listen(7608) ? (previous &gt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7607) ? (previous &lt;= upgradeDbVersion) : (ListenerUtil.mutListener.listen(7606) ? (previous &gt; upgradeDbVersion) : (ListenerUtil.mutListener.listen(7605) ? (previous != upgradeDbVersion) : (ListenerUtil.mutListener.listen(7604) ? (previous == upgradeDbVersion) : (previous &lt; upgradeDbVersion))))))))) {</span>
<span class="nc bnc" id="L1822" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7617)) {</span>
<span class="nc" id="L1823">                                    Timber.i(&quot;showStartupScreensAndDialogs() running integrityCheck()&quot;);</span>
                                }
<span class="nc bnc" id="L1825" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7618)) {</span>
                                    // and show a warning before the user knows what is happening.
<span class="nc" id="L1827">                                    new MaterialDialog.Builder(this).title(R.string.integrity_check_startup_title).content(R.string.integrity_check_startup_content).positiveText(R.string.check_db).negativeText(R.string.close).onPositive((materialDialog, dialogAction) -&gt; integrityCheck()).onNeutral((materialDialog, dialogAction) -&gt; restartActivity()).onNegative((materialDialog, dialogAction) -&gt; restartActivity()).canceledOnTouchOutside(false).cancelable(false).build().show();</span>
                                }
<span class="nc bnc" id="L1829" title="All 22 branches missed.">                            } else if ((ListenerUtil.mutListener.listen(7614) ? (previous &gt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7613) ? (previous &lt;= upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7612) ? (previous &gt; upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7611) ? (previous != upgradePrefsVersion) : (ListenerUtil.mutListener.listen(7610) ? (previous == upgradePrefsVersion) : (previous &lt; upgradePrefsVersion))))))) {</span>
<span class="nc bnc" id="L1830" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7615)) {</span>
<span class="nc" id="L1831">                                    Timber.i(&quot;Updated preferences with no integrity check - restarting activity&quot;);</span>
                                }
<span class="nc bnc" id="L1833" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7616)) {</span>
                                    // proceed
<span class="nc" id="L1835">                                    restartActivity();</span>
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L1840" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7595)) {</span>
                            // There the &quot;lastVersion&quot; is set, so that this code is not reached again
<span class="nc bnc" id="L1842" title="All 2 branches missed.">                            if (VersionUtils.isReleaseVersion()) {</span>
<span class="nc bnc" id="L1843" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7585)) {</span>
<span class="nc" id="L1844">                                    Timber.i(&quot;Displaying new features&quot;);</span>
                                }
<span class="nc" id="L1846">                                Intent infoIntent = new Intent(this, Info.class);</span>
<span class="nc bnc" id="L1847" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7586)) {</span>
<span class="nc" id="L1848">                                    infoIntent.putExtra(Info.TYPE_EXTRA, Info.TYPE_NEW_VERSION);</span>
                                }
<span class="nc bnc" id="L1850" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7594)) {</span>
<span class="nc bnc" id="L1851" title="All 22 branches missed.">                                    if ((ListenerUtil.mutListener.listen(7591) ? (skip &gt;= 0) : (ListenerUtil.mutListener.listen(7590) ? (skip &lt;= 0) : (ListenerUtil.mutListener.listen(7589) ? (skip &gt; 0) : (ListenerUtil.mutListener.listen(7588) ? (skip &lt; 0) : (ListenerUtil.mutListener.listen(7587) ? (skip == 0) : (skip != 0))))))) {</span>
<span class="nc bnc" id="L1852" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7593)) {</span>
<span class="nc" id="L1853">                                            startActivityForResultWithAnimation(infoIntent, SHOW_INFO_NEW_VERSION, LEFT);</span>
                                        }
                                    } else {
<span class="nc bnc" id="L1856" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7592)) {</span>
<span class="nc" id="L1857">                                            startActivityForResultWithoutAnimation(infoIntent, SHOW_INFO_NEW_VERSION);</span>
                                        }
                                    }
                                }
<span class="nc" id="L1861">                            } else {</span>
<span class="nc bnc" id="L1862" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7581)) {</span>
<span class="nc" id="L1863">                                    Timber.i(&quot;Dev Build - not showing 'new features'&quot;);</span>
                                }
<span class="nc bnc" id="L1865" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7582)) {</span>
                                    // Don't show new features dialog for development builds
<span class="nc" id="L1867">                                    preferences.edit().putString(&quot;lastVersion&quot;, VersionUtils.getPkgVersionName()).apply();</span>
                                }
<span class="nc" id="L1869">                                String ver = getResources().getString(R.string.updated_version, VersionUtils.getPkgVersionName());</span>
<span class="nc bnc" id="L1870" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7583)) {</span>
<span class="nc" id="L1871">                                    UIUtils.showSnackbar(this, ver, true, -1, null, findViewById(R.id.root_layout), null);</span>
                                }
<span class="nc bnc" id="L1873" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7584)) {</span>
<span class="nc" id="L1874">                                    showStartupScreensAndDialogs(preferences, 2);</span>
                                }
                            }
                        }
                    }
                }
<span class="nc" id="L1880">            } else {</span>
<span class="nc bnc" id="L1881" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7514)) {</span>
                    // This is the main call when there is nothing special required
<span class="nc" id="L1883">                    Timber.i(&quot;No startup screens required&quot;);</span>
                }
<span class="nc bnc" id="L1885" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7515)) {</span>
<span class="nc" id="L1886">                    onFinishedStartup();</span>
                }
            }
        }
<span class="nc" id="L1890">    }</span>

    protected long getPreviousVersion(SharedPreferences preferences, long current) {
        long previous;
        try {
<span class="nc" id="L1895">            previous = preferences.getLong(UPGRADE_VERSION_KEY, current);</span>
<span class="nc" id="L1896">        } catch (ClassCastException e) {</span>
            try {
                // set 20900203 to default value, as it's the latest version that stores integer in shared prefs
<span class="nc" id="L1899">                previous = preferences.getInt(UPGRADE_VERSION_KEY, 20900203);</span>
<span class="nc" id="L1900">            } catch (ClassCastException cce) {</span>
                // Previous versions stored this as a string.
<span class="nc" id="L1902">                String s = preferences.getString(UPGRADE_VERSION_KEY, &quot;&quot;);</span>
                // We manually set the version here, but anything older will force a DB check.
<span class="nc bnc" id="L1904" title="All 2 branches missed.">                if (&quot;2.0.2&quot;.equals(s)) {</span>
<span class="nc" id="L1905">                    previous = 40;</span>
                } else {
<span class="nc" id="L1907">                    previous = 0;</span>
                }
<span class="nc" id="L1909">            }</span>
<span class="nc bnc" id="L1910" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7630)) {</span>
<span class="nc" id="L1911">                Timber.d(&quot;Updating shared preferences stored key %s type to long&quot;, UPGRADE_VERSION_KEY);</span>
            }
<span class="nc bnc" id="L1913" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7631)) {</span>
                // Expected Editor.putLong to be called later to update the value in shared prefs
<span class="nc" id="L1915">                preferences.edit().remove(UPGRADE_VERSION_KEY).apply();</span>
            }
<span class="nc" id="L1917">        }</span>
<span class="nc bnc" id="L1918" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7632)) {</span>
<span class="nc" id="L1919">            Timber.i(&quot;Previous AnkiDroid version: %s&quot;, previous);</span>
        }
<span class="nc" id="L1921">        return previous;</span>
    }

    private void upgradePreferences(long previousVersionCode) {
<span class="nc" id="L1925">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc bnc" id="L1926" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7640)) {</span>
            // clear all prefs if super old version to prevent any errors
<span class="nc bnc" id="L1928" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(7637) ? (previousVersionCode &gt;= 20300130) : (ListenerUtil.mutListener.listen(7636) ? (previousVersionCode &lt;= 20300130) : (ListenerUtil.mutListener.listen(7635) ? (previousVersionCode &gt; 20300130) : (ListenerUtil.mutListener.listen(7634) ? (previousVersionCode != 20300130) : (ListenerUtil.mutListener.listen(7633) ? (previousVersionCode == 20300130) : (previousVersionCode &lt; 20300130))))))) {</span>
<span class="nc bnc" id="L1929" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7638)) {</span>
<span class="nc" id="L1930">                    Timber.i(&quot;Old version of Anki - Clearing preferences&quot;);</span>
                }
<span class="nc bnc" id="L1932" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7639)) {</span>
<span class="nc" id="L1933">                    preferences.edit().clear().apply();</span>
                }
            }
        }
<span class="nc bnc" id="L1937" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7653)) {</span>
            // when upgrading from before 2.5alpha35
<span class="nc bnc" id="L1939" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(7645) ? (previousVersionCode &gt;= 20500135) : (ListenerUtil.mutListener.listen(7644) ? (previousVersionCode &lt;= 20500135) : (ListenerUtil.mutListener.listen(7643) ? (previousVersionCode &gt; 20500135) : (ListenerUtil.mutListener.listen(7642) ? (previousVersionCode != 20500135) : (ListenerUtil.mutListener.listen(7641) ? (previousVersionCode == 20500135) : (previousVersionCode &lt; 20500135))))))) {</span>
<span class="nc bnc" id="L1940" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7646)) {</span>
<span class="nc" id="L1941">                    Timber.i(&quot;Old version of Anki - Fixing Zoom&quot;);</span>
                }
                // Card zooming behaviour was changed the preferences renamed
<span class="nc" id="L1944">                int oldCardZoom = preferences.getInt(&quot;relativeDisplayFontSize&quot;, 100);</span>
<span class="nc" id="L1945">                int oldImageZoom = preferences.getInt(&quot;relativeImageSize&quot;, 100);</span>
<span class="nc bnc" id="L1946" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7647)) {</span>
<span class="nc" id="L1947">                    preferences.edit().putInt(&quot;cardZoom&quot;, oldCardZoom).apply();</span>
                }
<span class="nc bnc" id="L1949" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7648)) {</span>
<span class="nc" id="L1950">                    preferences.edit().putInt(&quot;imageZoom&quot;, oldImageZoom).apply();</span>
                }
<span class="nc bnc" id="L1952" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7650)) {</span>
<span class="nc bnc" id="L1953" title="All 2 branches missed.">                    if (!preferences.getBoolean(&quot;useBackup&quot;, true)) {</span>
<span class="nc bnc" id="L1954" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7649)) {</span>
<span class="nc" id="L1955">                            preferences.edit().putInt(&quot;backupMax&quot;, 0).apply();</span>
                        }
                    }
                }
<span class="nc bnc" id="L1959" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7651)) {</span>
<span class="nc" id="L1960">                    preferences.edit().remove(&quot;useBackup&quot;).apply();</span>
                }
<span class="nc bnc" id="L1962" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7652)) {</span>
<span class="nc" id="L1963">                    preferences.edit().remove(&quot;intentAdditionInstantAdd&quot;).apply();</span>
                }
            }
        }
<span class="nc bnc" id="L1967" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7658)) {</span>
<span class="nc bnc" id="L1968" title="All 2 branches missed.">            if (preferences.contains(&quot;fullscreenReview&quot;)) {</span>
<span class="nc bnc" id="L1969" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7654)) {</span>
<span class="nc" id="L1970">                    Timber.i(&quot;Old version of Anki - Fixing Fullscreen&quot;);</span>
                }
                // clear fullscreen flag as we use a integer
                try {
<span class="nc" id="L1974">                    boolean old = preferences.getBoolean(&quot;fullscreenReview&quot;, false);</span>
<span class="nc bnc" id="L1975" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7656)) {</span>
<span class="nc bnc" id="L1976" title="All 2 branches missed.">                        preferences.edit().putString(&quot;fullscreenMode&quot;, old ? &quot;1&quot; : &quot;0&quot;).apply();</span>
                    }
<span class="nc" id="L1978">                } catch (ClassCastException e) {</span>
<span class="nc bnc" id="L1979" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7655)) {</span>
                        // TODO:  can remove this catch as it was only here to fix an error in the betas
<span class="nc" id="L1981">                        preferences.edit().remove(&quot;fullscreenMode&quot;).apply();</span>
                    }
<span class="nc" id="L1983">                }</span>
<span class="nc bnc" id="L1984" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7657)) {</span>
<span class="nc" id="L1985">                    preferences.edit().remove(&quot;fullscreenReview&quot;).apply();</span>
                }
            }
        }
<span class="nc" id="L1989">    }</span>

    private UndoTaskListener undoTaskListener(boolean isReview) {
<span class="nc" id="L1992">        return new UndoTaskListener(isReview, this);</span>
    }

    private static class UndoTaskListener extends TaskListenerWithContext&lt;DeckPicker, Card, BooleanGetter&gt; {

        private final boolean isReview;

        public UndoTaskListener(boolean isReview, DeckPicker deckPicker) {
<span class="nc" id="L2000">            super(deckPicker);</span>
<span class="nc" id="L2001">            this.isReview = isReview;</span>
<span class="nc" id="L2002">        }</span>

        @Override
        public void actualOnCancelled(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L2006" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7659)) {</span>
<span class="nc" id="L2007">                deckPicker.hideProgressBar();</span>
            }
<span class="nc" id="L2009">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L2013" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7660)) {</span>
<span class="nc" id="L2014">                deckPicker.showProgressBar();</span>
            }
<span class="nc" id="L2016">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, BooleanGetter voi) {
<span class="nc bnc" id="L2020" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7661)) {</span>
<span class="nc" id="L2021">                deckPicker.hideProgressBar();</span>
            }
<span class="nc bnc" id="L2023" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7662)) {</span>
<span class="nc" id="L2024">                Timber.i(&quot;Undo completed&quot;);</span>
            }
<span class="nc bnc" id="L2026" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7665)) {</span>
<span class="nc bnc" id="L2027" title="All 2 branches missed.">                if (isReview) {</span>
<span class="nc bnc" id="L2028" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7663)) {</span>
<span class="nc" id="L2029">                        Timber.i(&quot;Review undone - opening reviewer.&quot;);</span>
                    }
<span class="nc bnc" id="L2031" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7664)) {</span>
<span class="nc" id="L2032">                        deckPicker.openReviewer();</span>
                    }
                }
            }
<span class="nc" id="L2036">        }</span>
    }

    private void undo() {
<span class="nc bnc" id="L2040" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7666)) {</span>
<span class="nc" id="L2041">            Timber.i(&quot;undo()&quot;);</span>
        }
<span class="nc" id="L2043">        String undoReviewString = getResources().getString(R.string.undo_action_review);</span>
<span class="nc" id="L2044">        final boolean isReview = undoReviewString.equals(getCol().undoName(getResources()));</span>
<span class="nc bnc" id="L2045" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7667)) {</span>
<span class="nc" id="L2046">            TaskManager.launchCollectionTask(new CollectionTask.Undo(), undoTaskListener(isReview));</span>
        }
<span class="nc" id="L2048">    }</span>

    // Show dialogs to deal with database loading issues etc
    public void showDatabaseErrorDialog(int id) {
<span class="nc" id="L2052">        AsyncDialogFragment newFragment = DatabaseErrorDialog.newInstance(id);</span>
<span class="nc bnc" id="L2053" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7668)) {</span>
<span class="nc" id="L2054">            showAsyncDialogFragment(newFragment);</span>
        }
<span class="nc" id="L2056">    }</span>

    @Override
    public void showMediaCheckDialog(int id) {
<span class="nc bnc" id="L2060" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7669)) {</span>
<span class="nc" id="L2061">            showAsyncDialogFragment(MediaCheckDialog.newInstance(id));</span>
        }
<span class="nc" id="L2063">    }</span>

    @Override
    public void showMediaCheckDialog(int id, List&lt;List&lt;String&gt;&gt; checkList) {
<span class="nc bnc" id="L2067" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7670)) {</span>
<span class="nc" id="L2068">            showAsyncDialogFragment(MediaCheckDialog.newInstance(id, checkList));</span>
        }
<span class="nc" id="L2070">    }</span>

    /**
     * Show a specific sync error dialog
     * @param id id of dialog to show
     */
    @Override
    public void showSyncErrorDialog(int id) {
<span class="nc bnc" id="L2078" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7671)) {</span>
<span class="nc" id="L2079">            showSyncErrorDialog(id, &quot;&quot;);</span>
        }
<span class="nc" id="L2081">    }</span>

    /**
     * Show a specific sync error dialog
     * @param id id of dialog to show
     * @param message text to show
     */
    @Override
    public void showSyncErrorDialog(int id, String message) {
<span class="nc" id="L2090">        AsyncDialogFragment newFragment = SyncErrorDialog.newInstance(id, message);</span>
<span class="nc bnc" id="L2091" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7672)) {</span>
<span class="nc" id="L2092">            showAsyncDialogFragment(newFragment, NotificationChannels.Channel.SYNC);</span>
        }
<span class="nc" id="L2094">    }</span>

    /**
     *  Show simple error dialog with just the message and OK button. Reload the activity when dialog closed.
     */
    private void showSyncErrorMessage(@Nullable String message) {
<span class="nc" id="L2100">        String title = getResources().getString(R.string.sync_error);</span>
<span class="nc bnc" id="L2101" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7673)) {</span>
<span class="nc" id="L2102">            showSimpleMessageDialog(title, message, true);</span>
        }
<span class="nc" id="L2104">    }</span>

    /**
     *  Show a simple snackbar message or notification if the activity is not in foreground
     * @param messageResource String resource for message
     */
    private void showSyncLogMessage(@StringRes int messageResource, String syncMessage) {
<span class="nc bnc" id="L2111" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7687)) {</span>
<span class="nc bnc" id="L2112" title="All 2 branches missed.">            if (mActivityPaused) {</span>
<span class="nc" id="L2113">                Resources res = AnkiDroidApp.getAppResources();</span>
<span class="nc bnc" id="L2114" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7686)) {</span>
<span class="nc" id="L2115">                    showSimpleNotification(res.getString(R.string.app_name), res.getString(messageResource), NotificationChannels.Channel.SYNC);</span>
                }
<span class="nc" id="L2117">            } else {</span>
<span class="nc bnc" id="L2118" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7685)) {</span>
<span class="nc bnc" id="L2119" title="All 50 branches missed.">                    if ((ListenerUtil.mutListener.listen(7679) ? (syncMessage == null &amp;&amp; (ListenerUtil.mutListener.listen(7678) ? (syncMessage.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7677) ? (syncMessage.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7676) ? (syncMessage.length() &gt; 0) : (ListenerUtil.mutListener.listen(7675) ? (syncMessage.length() &lt; 0) : (ListenerUtil.mutListener.listen(7674) ? (syncMessage.length() != 0) : (syncMessage.length() == 0))))))) : (syncMessage == null || (ListenerUtil.mutListener.listen(7678) ? (syncMessage.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7677) ? (syncMessage.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7676) ? (syncMessage.length() &gt; 0) : (ListenerUtil.mutListener.listen(7675) ? (syncMessage.length() &lt; 0) : (ListenerUtil.mutListener.listen(7674) ? (syncMessage.length() != 0) : (syncMessage.length() == 0))))))))) {</span>
<span class="nc bnc" id="L2120" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7684)) {</span>
<span class="nc bnc" id="L2121" title="All 10 branches missed.">                            if ((ListenerUtil.mutListener.listen(7681) ? (messageResource == R.string.youre_offline || !Connection.getAllowSyncOnNoConnection()) : (messageResource == R.string.youre_offline &amp;&amp; !Connection.getAllowSyncOnNoConnection()))) {</span>
                                // #6396 - Add a temporary &quot;Try Anyway&quot; button until we sort out `isOnline`
<span class="nc" id="L2123">                                View root = this.findViewById(R.id.root_layout);</span>
<span class="nc bnc" id="L2124" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7683)) {</span>
<span class="nc" id="L2125">                                    UIUtils.showSnackbar(this, messageResource, false, R.string.sync_even_if_offline, (v) -&gt; {</span>
<span class="nc" id="L2126">                                        Connection.setAllowSyncOnNoConnection(true);</span>
<span class="nc" id="L2127">                                        sync();</span>
<span class="nc" id="L2128">                                    }, null);</span>
                                }
<span class="nc" id="L2130">                            } else {</span>
<span class="nc bnc" id="L2131" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7682)) {</span>
<span class="nc" id="L2132">                                    UIUtils.showSimpleSnackbar(this, messageResource, false);</span>
                                }
                            }
                        }
                    } else {
<span class="nc" id="L2137">                        Resources res = AnkiDroidApp.getAppResources();</span>
<span class="nc bnc" id="L2138" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7680)) {</span>
<span class="nc" id="L2139">                            showSimpleMessageDialog(res.getString(messageResource), syncMessage, false);</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L2145">    }</span>

    @Override
    public void showImportDialog(int id) {
<span class="nc bnc" id="L2149" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7688)) {</span>
<span class="nc" id="L2150">            showImportDialog(id, &quot;&quot;);</span>
        }
<span class="nc" id="L2152">    }</span>

    @Override
    public void showImportDialog(int id, String message) {
<span class="nc bnc" id="L2156" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7709)) {</span>
            // On API19+ we only use import dialog to confirm, otherwise we use it the whole time
<span class="nc bnc" id="L2158" title="All 90 branches missed.">            if ((ListenerUtil.mutListener.listen(7699) ? (((ListenerUtil.mutListener.listen(7693) ? (id &gt;= ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7692) ? (id &lt;= ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7691) ? (id &gt; ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7690) ? (id &lt; ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7689) ? (id != ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (id == ImportDialog.DIALOG_IMPORT_ADD_CONFIRM))))))) &amp;&amp; ((ListenerUtil.mutListener.listen(7698) ? (id &gt;= ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7697) ? (id &lt;= ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7696) ? (id &gt; ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7695) ? (id &lt; ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7694) ? (id != ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (id == ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM)))))))) : (((ListenerUtil.mutListener.listen(7693) ? (id &gt;= ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7692) ? (id &lt;= ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7691) ? (id &gt; ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7690) ? (id &lt; ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (ListenerUtil.mutListener.listen(7689) ? (id != ImportDialog.DIALOG_IMPORT_ADD_CONFIRM) : (id == ImportDialog.DIALOG_IMPORT_ADD_CONFIRM))))))) || ((ListenerUtil.mutListener.listen(7698) ? (id &gt;= ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7697) ? (id &lt;= ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7696) ? (id &gt; ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7695) ? (id &lt; ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (ListenerUtil.mutListener.listen(7694) ? (id != ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM) : (id == ImportDialog.DIALOG_IMPORT_REPLACE_CONFIRM)))))))))) {</span>
<span class="nc bnc" id="L2159" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7707)) {</span>
<span class="nc" id="L2160">                    Timber.d(&quot;showImportDialog() delegating to ImportDialog&quot;);</span>
                }
<span class="nc" id="L2162">                AsyncDialogFragment newFragment = ImportDialog.newInstance(id, message);</span>
<span class="nc bnc" id="L2163" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7708)) {</span>
<span class="nc" id="L2164">                    showAsyncDialogFragment(newFragment);</span>
                }
<span class="nc" id="L2166">            } else {</span>
<span class="nc bnc" id="L2167" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7700)) {</span>
<span class="nc" id="L2168">                    Timber.d(&quot;showImportDialog() delegating to file picker intent&quot;);</span>
                }
<span class="nc" id="L2170">                Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);</span>
<span class="nc bnc" id="L2171" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7701)) {</span>
<span class="nc" id="L2172">                    intent.addCategory(Intent.CATEGORY_OPENABLE);</span>
                }
<span class="nc bnc" id="L2174" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7702)) {</span>
<span class="nc" id="L2175">                    intent.setType(&quot;*/*&quot;);</span>
                }
<span class="nc bnc" id="L2177" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7703)) {</span>
<span class="nc" id="L2178">                    intent.putExtra(&quot;android.content.extra.SHOW_ADVANCED&quot;, true);</span>
                }
<span class="nc bnc" id="L2180" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7704)) {</span>
<span class="nc" id="L2181">                    intent.putExtra(&quot;android.content.extra.FANCY&quot;, true);</span>
                }
<span class="nc bnc" id="L2183" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7705)) {</span>
<span class="nc" id="L2184">                    intent.putExtra(&quot;android.content.extra.SHOW_FILESIZE&quot;, true);</span>
                }
<span class="nc bnc" id="L2186" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7706)) {</span>
<span class="nc" id="L2187">                    startActivityForResultWithoutAnimation(intent, PICK_APKG_FILE);</span>
                }
            }
        }
<span class="nc" id="L2191">    }</span>

    public void onSdCardNotMounted() {
<span class="nc bnc" id="L2194" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7710)) {</span>
<span class="nc" id="L2195">            UIUtils.showThemedToast(this, getResources().getString(R.string.sd_card_not_mounted), false);</span>
        }
<span class="nc bnc" id="L2197" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7711)) {</span>
<span class="nc" id="L2198">            finishWithoutAnimation();</span>
        }
<span class="nc" id="L2200">    }</span>

    // Callback method to submit error report
    public void sendErrorReport() {
<span class="nc bnc" id="L2204" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7712)) {</span>
<span class="nc" id="L2205">            AnkiDroidApp.sendExceptionReport(new RuntimeException(), &quot;DeckPicker.sendErrorReport&quot;);</span>
        }
<span class="nc" id="L2207">    }</span>

    private RepairCollectionTask repairCollectionTask() {
<span class="nc" id="L2210">        return new RepairCollectionTask(this);</span>
    }

    private static class RepairCollectionTask extends TaskListenerWithContext&lt;DeckPicker, Void, Boolean&gt; {

        public RepairCollectionTask(DeckPicker deckPicker) {
<span class="nc" id="L2216">            super(deckPicker);</span>
<span class="nc" id="L2217">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L2221" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7713)) {</span>
<span class="nc" id="L2222">                deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, &quot;&quot;, deckPicker.getResources().getString(R.string.backup_repair_deck_progress), false);</span>
            }
<span class="nc" id="L2224">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, Boolean result) {
<span class="nc bnc" id="L2228" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7716)) {</span>
<span class="nc bnc" id="L2229" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7714) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L2230" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7715)) {</span>
<span class="nc" id="L2231">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L2235" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7719)) {</span>
<span class="nc bnc" id="L2236" title="All 2 branches missed.">                if (!result) {</span>
<span class="nc bnc" id="L2237" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7717)) {</span>
<span class="nc" id="L2238">                        UIUtils.showThemedToast(deckPicker, deckPicker.getResources().getString(R.string.deck_repair_error), true);</span>
                    }
<span class="nc bnc" id="L2240" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7718)) {</span>
<span class="nc" id="L2241">                        deckPicker.showCollectionErrorDialog();</span>
                    }
                }
            }
<span class="nc" id="L2245">        }</span>
    }

    // Callback method to handle repairing deck
    public void repairCollection() {
<span class="nc bnc" id="L2250" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7720)) {</span>
<span class="nc" id="L2251">            Timber.i(&quot;Repairing the Collection&quot;);</span>
        }
<span class="nc bnc" id="L2253" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7721)) {</span>
<span class="nc" id="L2254">            TaskManager.launchCollectionTask(new CollectionTask.RepairCollectionn(), repairCollectionTask());</span>
        }
<span class="nc" id="L2256">    }</span>

    // Callback method to handle database integrity check
    public void integrityCheck() {
        // display a dialog box if we don't have the space
<span class="nc" id="L2261">        CollectionIntegrityStorageCheck status = CollectionIntegrityStorageCheck.createInstance(this);</span>
<span class="nc bnc" id="L2262" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7725)) {</span>
<span class="nc bnc" id="L2263" title="All 2 branches missed.">            if (status.shouldWarnOnIntegrityCheck()) {</span>
<span class="nc bnc" id="L2264" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7723)) {</span>
<span class="nc" id="L2265">                    Timber.d(&quot;Displaying File Size confirmation&quot;);</span>
                }
<span class="nc bnc" id="L2267" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7724)) {</span>
<span class="nc" id="L2268">                    new MaterialDialog.Builder(this).title(R.string.check_db_title).content(status.getWarningDetails(this)).positiveText(R.string.integrity_check_continue_anyway).onPositive((dialog, which) -&gt; performIntegrityCheck()).negativeText(R.string.dialog_cancel).show();</span>
                }
            } else {
<span class="nc bnc" id="L2271" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7722)) {</span>
<span class="nc" id="L2272">                    performIntegrityCheck();</span>
                }
            }
        }
<span class="nc" id="L2276">    }</span>

    private void performIntegrityCheck() {
<span class="nc bnc" id="L2279" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7726)) {</span>
<span class="nc" id="L2280">            Timber.i(&quot;performIntegrityCheck()&quot;);</span>
        }
<span class="nc bnc" id="L2282" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7727)) {</span>
<span class="nc" id="L2283">            TaskManager.launchCollectionTask(new CollectionTask.CheckDatabase(), new CheckDatabaseListener());</span>
        }
<span class="nc" id="L2285">    }</span>

    private MediaCheckListener mediaCheckListener() {
<span class="nc" id="L2288">        return new MediaCheckListener(this);</span>
    }

    private static class MediaCheckListener extends TaskListenerWithContext&lt;DeckPicker, Void, PairWithBoolean&lt;List&lt;List&lt;String&gt;&gt;&gt;&gt; {

        public MediaCheckListener(DeckPicker deckPicker) {
<span class="nc" id="L2294">            super(deckPicker);</span>
<span class="nc" id="L2295">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L2299" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7728)) {</span>
<span class="nc" id="L2300">                deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, &quot;&quot;, deckPicker.getResources().getString(R.string.check_media_message), false);</span>
            }
<span class="nc" id="L2302">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, PairWithBoolean&lt;List&lt;List&lt;String&gt;&gt;&gt; result) {
<span class="nc bnc" id="L2306" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7731)) {</span>
<span class="nc bnc" id="L2307" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7729) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L2308" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7730)) {</span>
<span class="nc" id="L2309">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L2313" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7734)) {</span>
<span class="nc bnc" id="L2314" title="All 2 branches missed.">                if (result.bool) {</span>
                    @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L2316">                    List&lt;List&lt;String&gt;&gt; checkList = result.other;</span>
<span class="nc bnc" id="L2317" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7733)) {</span>
<span class="nc" id="L2318">                        deckPicker.showMediaCheckDialog(MediaCheckDialog.DIALOG_MEDIA_CHECK_RESULTS, checkList);</span>
                    }
<span class="nc" id="L2320">                } else {</span>
<span class="nc bnc" id="L2321" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7732)) {</span>
<span class="nc" id="L2322">                        deckPicker.showSimpleMessageDialog(deckPicker.getResources().getString(R.string.check_media_failed));</span>
                    }
                }
            }
<span class="nc" id="L2326">        }</span>
    }

    @Override
    public void mediaCheck() {
<span class="nc bnc" id="L2331" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7735)) {</span>
<span class="nc" id="L2332">            TaskManager.launchCollectionTask(new CollectionTask.CheckMedia(), mediaCheckListener());</span>
        }
<span class="nc" id="L2334">    }</span>

    private MediaDeleteListener mediaDeleteListener() {
<span class="nc" id="L2337">        return new MediaDeleteListener(this);</span>
    }

    private static class MediaDeleteListener extends TaskListenerWithContext&lt;DeckPicker, Void, Integer&gt; {

        public MediaDeleteListener(DeckPicker deckPicker) {
<span class="nc" id="L2343">            super(deckPicker);</span>
<span class="nc" id="L2344">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L2348" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7736)) {</span>
<span class="nc" id="L2349">                deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, &quot;&quot;, deckPicker.getResources().getString(R.string.delete_media_message), false);</span>
            }
<span class="nc" id="L2351">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, Integer deletedFiles) {
<span class="nc bnc" id="L2355" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7739)) {</span>
<span class="nc bnc" id="L2356" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7737) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L2357" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7738)) {</span>
<span class="nc" id="L2358">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L2362" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7740)) {</span>
<span class="nc" id="L2363">                deckPicker.showSimpleMessageDialog(deckPicker.getResources().getString(R.string.delete_media_result_title), deckPicker.getResources().getQuantityString(R.plurals.delete_media_result_message, deletedFiles, deletedFiles));</span>
            }
<span class="nc" id="L2365">        }</span>
    }

    @Override
    public void deleteUnused(List&lt;String&gt; unused) {
<span class="nc bnc" id="L2370" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7741)) {</span>
<span class="nc" id="L2371">            TaskManager.launchCollectionTask(new CollectionTask.DeleteMedia(unused), mediaDeleteListener());</span>
        }
<span class="nc" id="L2373">    }</span>

    public void exit() {
<span class="nc bnc" id="L2376" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7742)) {</span>
<span class="nc" id="L2377">            CollectionHelper.getInstance().closeCollection(false, &quot;DeckPicker:exit()&quot;);</span>
        }
<span class="nc bnc" id="L2379" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7743)) {</span>
<span class="nc" id="L2380">            finishWithoutAnimation();</span>
        }
<span class="nc" id="L2382">    }</span>

    public void handleDbError() {
<span class="nc bnc" id="L2385" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7744)) {</span>
<span class="nc" id="L2386">            Timber.i(&quot;Displaying Database Error&quot;);</span>
        }
<span class="nc bnc" id="L2388" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7745)) {</span>
<span class="nc" id="L2389">            showDatabaseErrorDialog(DatabaseErrorDialog.DIALOG_LOAD_FAILED);</span>
        }
<span class="nc" id="L2391">    }</span>

    public void handleDbLocked() {
<span class="nc bnc" id="L2394" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7746)) {</span>
<span class="nc" id="L2395">            Timber.i(&quot;Displaying Database Locked&quot;);</span>
        }
<span class="nc bnc" id="L2397" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7747)) {</span>
<span class="nc" id="L2398">            showDatabaseErrorDialog(DatabaseErrorDialog.DIALOG_DB_LOCKED);</span>
        }
<span class="nc" id="L2400">    }</span>

    public void restoreFromBackup(String path) {
<span class="nc bnc" id="L2403" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7748)) {</span>
<span class="nc" id="L2404">            importReplace(path);</span>
        }
<span class="nc" id="L2406">    }</span>

    // Helper function to check if there are any saved stacktraces
    public boolean hasErrorFiles() {
<span class="nc bnc" id="L2410" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7750)) {</span>
            {
<span class="nc" id="L2412">                long _loopCounter132 = 0;</span>
<span class="nc bnc" id="L2413" title="All 2 branches missed.">                for (String file : this.fileList()) {</span>
<span class="nc" id="L2414">                    ListenerUtil.loopListener.listen(&quot;_loopCounter132&quot;, ++_loopCounter132);</span>
<span class="nc bnc" id="L2415" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7749)) {</span>
<span class="nc bnc" id="L2416" title="All 2 branches missed.">                        if (file.endsWith(&quot;.stacktrace&quot;)) {</span>
<span class="nc" id="L2417">                            return true;</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L2423">        return false;</span>
    }

    // Sync with Anki Web
    @Override
    public void sync() {
<span class="nc bnc" id="L2429" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7751)) {</span>
<span class="nc" id="L2430">            sync(null);</span>
        }
<span class="nc" id="L2432">    }</span>

    /**
     * The mother of all syncing attempts. This might be called from sync() as first attempt to sync a collection OR
     * from the mSyncConflictResolutionListener if the first attempt determines that a full-sync is required.
     */
    @Override
    public void sync(Connection.ConflictResolution syncConflictResolution) {
<span class="nc" id="L2440">        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc" id="L2441">        String hkey = preferences.getString(&quot;hkey&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L2442" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7761)) {</span>
<span class="nc bnc" id="L2443" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(7756) ? (hkey.length() &gt;= 0) : (ListenerUtil.mutListener.listen(7755) ? (hkey.length() &lt;= 0) : (ListenerUtil.mutListener.listen(7754) ? (hkey.length() &gt; 0) : (ListenerUtil.mutListener.listen(7753) ? (hkey.length() &lt; 0) : (ListenerUtil.mutListener.listen(7752) ? (hkey.length() != 0) : (hkey.length() == 0))))))) {</span>
<span class="nc bnc" id="L2444" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7758)) {</span>
<span class="nc" id="L2445">                    Timber.w(&quot;User not logged in&quot;);</span>
                }
<span class="nc bnc" id="L2447" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7759)) {</span>
<span class="nc" id="L2448">                    mPullToSyncWrapper.setRefreshing(false);</span>
                }
<span class="nc bnc" id="L2450" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7760)) {</span>
<span class="nc" id="L2451">                    showSyncErrorDialog(SyncErrorDialog.DIALOG_USER_NOT_LOGGED_IN_SYNC);</span>
                }
            } else {
<span class="nc bnc" id="L2454" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7757)) {</span>
<span class="nc" id="L2455">                    Connection.sync(mSyncListener, new Connection.Payload(new Object[] { hkey, preferences.getBoolean(&quot;syncFetchesMedia&quot;, true), syncConflictResolution, HostNumFactory.getInstance(getBaseContext()) }));</span>
                }
            }
        }
<span class="nc" id="L2459">    }</span>

<span class="nc" id="L2461">    private final Connection.TaskListener mSyncListener = new Connection.CancellableTaskListener() {</span>

        private String currentMessage;

        private long countUp;

        private long countDown;

<span class="nc" id="L2469">        private boolean dialogDisplayFailure = false;</span>

        @Override
        public void onDisconnected() {
<span class="nc bnc" id="L2473" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7762)) {</span>
<span class="nc" id="L2474">                showSyncLogMessage(R.string.youre_offline, &quot;&quot;);</span>
            }
<span class="nc" id="L2476">        }</span>

        @Override
        public void onCancelled() {
<span class="nc bnc" id="L2480" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7763)) {</span>
<span class="nc" id="L2481">                showSyncLogMessage(R.string.sync_cancelled, &quot;&quot;);</span>
            }
<span class="nc bnc" id="L2483" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7766)) {</span>
<span class="nc bnc" id="L2484" title="All 2 branches missed.">                if (!dialogDisplayFailure) {</span>
<span class="nc bnc" id="L2485" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7764)) {</span>
<span class="nc" id="L2486">                        mProgressDialog.dismiss();</span>
                    }
<span class="nc bnc" id="L2488" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7765)) {</span>
                        // update deck list in case sync was cancelled during media sync and main sync was actually successful
<span class="nc" id="L2490">                        updateDeckList();</span>
                    }
                }
            }
<span class="nc bnc" id="L2494" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7767)) {</span>
                // reset our display failure fate, just in case it is re-used
<span class="nc" id="L2496">                dialogDisplayFailure = false;</span>
            }
<span class="nc" id="L2498">        }</span>

        @Override
        public void onPreExecute() {
<span class="nc bnc" id="L2502" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7768)) {</span>
<span class="nc" id="L2503">                countUp = 0;</span>
            }
<span class="nc bnc" id="L2505" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7769)) {</span>
<span class="nc" id="L2506">                countDown = 0;</span>
            }
<span class="nc" id="L2508">            final long syncStartTime = getCol().getTime().intTimeMS();</span>
<span class="nc bnc" id="L2509" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7776)) {</span>
<span class="nc bnc" id="L2510" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7770) ? (mProgressDialog == null &amp;&amp; !mProgressDialog.isShowing()) : (mProgressDialog == null || !mProgressDialog.isShowing()))) {</span>
                    try {
<span class="nc bnc" id="L2512" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7774)) {</span>
<span class="nc" id="L2513">                            mProgressDialog = StyledProgressDialog.show(DeckPicker.this, getResources().getString(R.string.sync_title), getResources().getString(R.string.sync_title) + &quot;\n&quot; + getResources().getString(R.string.sync_up_down_size, countUp, countDown), false);</span>
                        }
<span class="nc" id="L2515">                    } catch (WindowManager.BadTokenException e) {</span>
<span class="nc bnc" id="L2516" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7771)) {</span>
                            // If we could not show the progress dialog to start even, bail out - user will get a message
<span class="nc" id="L2518">                            Timber.w(e, &quot;Unable to display Sync progress dialog, Activity not valid?&quot;);</span>
                        }
<span class="nc bnc" id="L2520" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7772)) {</span>
<span class="nc" id="L2521">                            dialogDisplayFailure = true;</span>
                        }
<span class="nc bnc" id="L2523" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7773)) {</span>
<span class="nc" id="L2524">                            Connection.cancel();</span>
                        }
<span class="nc" id="L2526">                        return;</span>
<span class="nc" id="L2527">                    }</span>
<span class="nc bnc" id="L2528" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7775)) {</span>
                        // Override the back key so that the user can cancel a sync which is in progress
<span class="nc" id="L2530">                        mProgressDialog.setOnKeyListener((dialog, keyCode, event) -&gt; {</span>
                            // Make sure our method doesn't get called twice
<span class="nc bnc" id="L2532" title="All 2 branches missed.">                            if (event.getAction() != KeyEvent.ACTION_DOWN) {</span>
<span class="nc" id="L2533">                                return true;</span>
                            }
<span class="nc bnc" id="L2535" title="All 6 branches missed.">                            if (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; Connection.isCancellable() &amp;&amp; !Connection.getIsCancelled()) {</span>
                                // If less than 2s has elapsed since sync started then don't ask for confirmation
<span class="nc bnc" id="L2537" title="All 2 branches missed.">                                if (getCol().getTime().intTimeMS() - syncStartTime &lt; 2000) {</span>
<span class="nc" id="L2538">                                    Connection.cancel();</span>
<span class="nc" id="L2539">                                    mProgressDialog.setContent(R.string.sync_cancel_message);</span>
<span class="nc" id="L2540">                                    return true;</span>
                                }
                                // Show confirmation dialog to check if the user wants to cancel the sync
<span class="nc" id="L2543">                                MaterialDialog.Builder builder = new MaterialDialog.Builder(mProgressDialog.getContext());</span>
<span class="nc" id="L2544">                                builder.content(R.string.cancel_sync_confirm).cancelable(false).positiveText(R.string.dialog_ok).negativeText(R.string.continue_sync).onPositive((inner_dialog, which) -&gt; {</span>
<span class="nc" id="L2545">                                    mProgressDialog.setContent(R.string.sync_cancel_message);</span>
<span class="nc" id="L2546">                                    Connection.cancel();</span>
<span class="nc" id="L2547">                                });</span>
<span class="nc" id="L2548">                                builder.show();</span>
<span class="nc" id="L2549">                                return true;</span>
                            } else {
<span class="nc" id="L2551">                                return false;</span>
                            }
                        });
                    }
                }
            }
            // Note: getLs() in Libanki doesn't take into account the case when no changes were found, or sync cancelled
<span class="nc" id="L2558">            SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc bnc" id="L2559" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7777)) {</span>
<span class="nc" id="L2560">                preferences.edit().putLong(&quot;lastSyncTime&quot;, syncStartTime).apply();</span>
            }
<span class="nc" id="L2562">        }</span>

        @Override
        public void onProgressUpdate(Object... values) {
<span class="nc" id="L2566">            Resources res = getResources();</span>
<span class="nc bnc" id="L2567" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7804)) {</span>
<span class="nc bnc" id="L2568" title="All 2 branches missed.">                if (values[0] instanceof Boolean) {</span>
                    // This is the part Download missing media of syncing
<span class="nc" id="L2570">                    int total = (Integer) values[1];</span>
<span class="nc" id="L2571">                    int done = (Integer) values[2];</span>
<span class="nc bnc" id="L2572" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7802)) {</span>
<span class="nc" id="L2573">                        values[0] = (values[3]);</span>
                    }
<span class="nc bnc" id="L2575" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7803)) {</span>
<span class="nc" id="L2576">                        values[1] = res.getString(R.string.sync_downloading_media, done, total);</span>
                    }
<span class="nc bnc" id="L2578" title="All 2 branches missed.">                } else if (values[0] instanceof Integer) {</span>
<span class="nc" id="L2579">                    int id = (Integer) values[0];</span>
<span class="nc bnc" id="L2580" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7793)) {</span>
<span class="nc bnc" id="L2581" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(7791) ? (id &gt;= 0) : (ListenerUtil.mutListener.listen(7790) ? (id &lt;= 0) : (ListenerUtil.mutListener.listen(7789) ? (id &gt; 0) : (ListenerUtil.mutListener.listen(7788) ? (id &lt; 0) : (ListenerUtil.mutListener.listen(7787) ? (id == 0) : (id != 0))))))) {</span>
<span class="nc bnc" id="L2582" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7792)) {</span>
<span class="nc" id="L2583">                                currentMessage = res.getString(id);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2587" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7801)) {</span>
<span class="nc bnc" id="L2588" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(7798) ? (values.length &lt;= 3) : (ListenerUtil.mutListener.listen(7797) ? (values.length &gt; 3) : (ListenerUtil.mutListener.listen(7796) ? (values.length &lt; 3) : (ListenerUtil.mutListener.listen(7795) ? (values.length != 3) : (ListenerUtil.mutListener.listen(7794) ? (values.length == 3) : (values.length &gt;= 3))))))) {</span>
<span class="nc bnc" id="L2589" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7799)) {</span>
<span class="nc" id="L2590">                                countUp = (Long) values[1];</span>
                            }
<span class="nc bnc" id="L2592" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7800)) {</span>
<span class="nc" id="L2593">                                countDown = (Long) values[2];</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2597" title="All 2 branches missed.">                } else if (values[0] instanceof String) {</span>
<span class="nc bnc" id="L2598" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7778)) {</span>
<span class="nc" id="L2599">                        currentMessage = (String) values[0];</span>
                    }
<span class="nc bnc" id="L2601" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7786)) {</span>
<span class="nc bnc" id="L2602" title="All 22 branches missed.">                        if ((ListenerUtil.mutListener.listen(7783) ? (values.length &lt;= 3) : (ListenerUtil.mutListener.listen(7782) ? (values.length &gt; 3) : (ListenerUtil.mutListener.listen(7781) ? (values.length &lt; 3) : (ListenerUtil.mutListener.listen(7780) ? (values.length != 3) : (ListenerUtil.mutListener.listen(7779) ? (values.length == 3) : (values.length &gt;= 3))))))) {</span>
<span class="nc bnc" id="L2603" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7784)) {</span>
<span class="nc" id="L2604">                                countUp = (Long) values[1];</span>
                            }
<span class="nc bnc" id="L2606" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7785)) {</span>
<span class="nc" id="L2607">                                countDown = (Long) values[2];</span>
                            }
                        }
                    }
                }
            }
<span class="nc bnc" id="L2613" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7815)) {</span>
<span class="nc bnc" id="L2614" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(7805) ? (mProgressDialog != null || mProgressDialog.isShowing()) : (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L2615" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7814)) {</span>
                        // mProgressDialog.setTitle((String) values[0]);
<span class="nc bnc" id="L2617" title="All 16 branches missed.">                        mProgressDialog.setContent(currentMessage + &quot;\n&quot; + res.getString(R.string.sync_up_down_size, (ListenerUtil.mutListener.listen(7809) ? (countUp % 1024) : (ListenerUtil.mutListener.listen(7808) ? (countUp * 1024) : (ListenerUtil.mutListener.listen(7807) ? (countUp - 1024) : (ListenerUtil.mutListener.listen(7806) ? (countUp + 1024) : (countUp / 1024))))), (ListenerUtil.mutListener.listen(7813) ? (countDown % 1024) : (ListenerUtil.mutListener.listen(7812) ? (countDown * 1024) : (ListenerUtil.mutListener.listen(7811) ? (countDown - 1024) : (ListenerUtil.mutListener.listen(7810) ? (countDown + 1024) : (countDown / 1024)))))));</span>
                    }
                }
            }
<span class="nc" id="L2621">        }</span>

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void onPostExecute(Payload data) {
<span class="nc bnc" id="L2626" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7816)) {</span>
<span class="nc" id="L2627">                mPullToSyncWrapper.setRefreshing(false);</span>
            }
<span class="nc" id="L2629">            String dialogMessage = &quot;&quot;;</span>
<span class="nc bnc" id="L2630" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7817)) {</span>
<span class="nc" id="L2631">                Timber.d(&quot;Sync Listener onPostExecute()&quot;);</span>
            }
<span class="nc" id="L2633">            Resources res = getResources();</span>
            try {
<span class="nc bnc" id="L2635" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7822)) {</span>
<span class="nc bnc" id="L2636" title="All 10 branches missed.">                    if ((ListenerUtil.mutListener.listen(7820) ? (mProgressDialog != null || mProgressDialog.isShowing()) : (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L2637" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(7821)) {</span>
<span class="nc" id="L2638">                            mProgressDialog.dismiss();</span>
                        }
                    }
                }
<span class="nc" id="L2642">            } catch (IllegalArgumentException e) {</span>
<span class="nc bnc" id="L2643" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7818)) {</span>
<span class="nc" id="L2644">                    Timber.e(e, &quot;Could not dismiss mProgressDialog. The Activity must have been destroyed while the AsyncTask was running&quot;);</span>
                }
<span class="nc bnc" id="L2646" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7819)) {</span>
<span class="nc" id="L2647">                    AnkiDroidApp.sendExceptionReport(e, &quot;DeckPicker.onPostExecute&quot;, &quot;Could not dismiss mProgressDialog&quot;);</span>
                }
<span class="nc" id="L2649">            }</span>
<span class="nc" id="L2650">            String syncMessage = data.message;</span>
<span class="nc bnc" id="L2651" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7937)) {</span>
<span class="nc bnc" id="L2652" title="All 2 branches missed.">                if (!data.success) {</span>
<span class="nc" id="L2653">                    Object[] result = data.result;</span>
<span class="nc" id="L2654">                    Syncer.ConnectionResultType resultType = data.resultType;</span>
<span class="nc bnc" id="L2655" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7936)) {</span>
<span class="nc bnc" id="L2656" title="All 2 branches missed.">                        if (resultType != null) {</span>
<span class="nc bnc" id="L2657" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7935)) {</span>
<span class="nc bnc" id="L2658" title="All 19 branches missed.">                                switch(resultType) {</span>
                                    case BAD_AUTH:
                                        // delete old auth information
<span class="nc" id="L2661">                                        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());</span>
<span class="nc" id="L2662">                                        Editor editor = preferences.edit();</span>
<span class="nc bnc" id="L2663" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7852)) {</span>
<span class="nc" id="L2664">                                            editor.putString(&quot;username&quot;, &quot;&quot;);</span>
                                        }
<span class="nc bnc" id="L2666" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7853)) {</span>
<span class="nc" id="L2667">                                            editor.putString(&quot;hkey&quot;, &quot;&quot;);</span>
                                        }
<span class="nc bnc" id="L2669" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7854)) {</span>
<span class="nc" id="L2670">                                            editor.apply();</span>
                                        }
<span class="nc bnc" id="L2672" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7855)) {</span>
                                            // then show not logged in dialog
<span class="nc" id="L2674">                                            showSyncErrorDialog(SyncErrorDialog.DIALOG_USER_NOT_LOGGED_IN_SYNC);</span>
                                        }
                                        break;
                                    case NO_CHANGES:
<span class="nc bnc" id="L2678" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7856)) {</span>
<span class="nc" id="L2679">                                            SyncStatus.markSyncCompleted();</span>
                                        }
<span class="nc bnc" id="L2681" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7857)) {</span>
                                            // show no changes message, use false flag so we don't show &quot;sync error&quot; as the Dialog title
<span class="nc" id="L2683">                                            showSyncLogMessage(R.string.sync_no_changes_message, &quot;&quot;);</span>
                                        }
                                        break;
                                    case CLOCK_OFF:
<span class="nc" id="L2687">                                        long diff = (Long) result[0];</span>
<span class="nc bnc" id="L2688" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7879)) {</span>
<span class="nc bnc" id="L2689" title="All 22 branches missed.">                                            if ((ListenerUtil.mutListener.listen(7862) ? (diff &lt;= 86100) : (ListenerUtil.mutListener.listen(7861) ? (diff &gt; 86100) : (ListenerUtil.mutListener.listen(7860) ? (diff &lt; 86100) : (ListenerUtil.mutListener.listen(7859) ? (diff != 86100) : (ListenerUtil.mutListener.listen(7858) ? (diff == 86100) : (diff &gt;= 86100))))))) {</span>
<span class="nc bnc" id="L2690" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7878)) {</span>
                                                    // The difference if more than a day minus 5 minutes acceptable by ankiweb error
<span class="nc" id="L2692">                                                    dialogMessage = res.getString(R.string.sync_log_clocks_unsynchronized, diff, res.getString(R.string.sync_log_clocks_unsynchronized_date));</span>
                                                }
<span class="nc bnc" id="L2694" title="All 310 branches missed.">                                            } else if ((ListenerUtil.mutListener.listen(7875) ? (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) &lt;= 1500.0) : (ListenerUtil.mutListener.listen(7874) ? (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) &gt; 1500.0) : (ListenerUtil.mutListener.listen(7873) ? (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) &lt; 1500.0) : (ListenerUtil.mutListener.listen(7872) ? (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) != 1500.0) : (ListenerUtil.mutListener.listen(7871) ? (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) == 1500.0) : (Math.abs((ListenerUtil.mutListener.listen(7870) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) % 1800.0) : (ListenerUtil.mutListener.listen(7869) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) / 1800.0) : (ListenerUtil.mutListener.listen(7868) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) * 1800.0) : (ListenerUtil.mutListener.listen(7867) ? (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) + 1800.0) : (((ListenerUtil.mutListener.listen(7866) ? (diff / 3600.0) : (ListenerUtil.mutListener.listen(7865) ? (diff * 3600.0) : (ListenerUtil.mutListener.listen(7864) ? (diff - 3600.0) : (ListenerUtil.mutListener.listen(7863) ? (diff + 3600.0) : (diff % 3600.0)))))) - 1800.0)))))) &gt;= 1500.0))))))) {</span>
<span class="nc bnc" id="L2695" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7877)) {</span>
                                                    // It doesn't work for all timezones, but it covers most and it's a guess anyway
<span class="nc" id="L2697">                                                    dialogMessage = res.getString(R.string.sync_log_clocks_unsynchronized, diff, res.getString(R.string.sync_log_clocks_unsynchronized_tz));</span>
                                                }
                                            } else {
<span class="nc bnc" id="L2700" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7876)) {</span>
<span class="nc" id="L2701">                                                    dialogMessage = res.getString(R.string.sync_log_clocks_unsynchronized, diff, &quot;&quot;);</span>
                                                }
                                            }
                                        }
<span class="nc bnc" id="L2705" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7880)) {</span>
<span class="nc" id="L2706">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case FULL_SYNC:
<span class="nc bnc" id="L2710" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7883)) {</span>
<span class="nc bnc" id="L2711" title="All 2 branches missed.">                                            if (getCol().isEmpty()) {</span>
<span class="nc bnc" id="L2712" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7882)) {</span>
                                                    // don't prompt user to resolve sync conflict if local collection empty
<span class="nc" id="L2714">                                                    sync(FULL_DOWNLOAD);</span>
                                                }
                                            } else {
<span class="nc bnc" id="L2717" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7881)) {</span>
                                                    // If can't be resolved then automatically then show conflict resolution dialog
<span class="nc" id="L2719">                                                    showSyncErrorDialog(SyncErrorDialog.DIALOG_SYNC_CONFLICT_RESOLUTION);</span>
                                                }
                                            }
                                        }
                                        break;
                                    case BASIC_CHECK_FAILED:
<span class="nc bnc" id="L2725" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7884)) {</span>
<span class="nc" id="L2726">                                            dialogMessage = res.getString(R.string.sync_basic_check_failed, res.getString(R.string.check_db));</span>
                                        }
<span class="nc bnc" id="L2728" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7885)) {</span>
<span class="nc" id="L2729">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case DB_ERROR:
<span class="nc bnc" id="L2733" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7886)) {</span>
<span class="nc" id="L2734">                                            showSyncErrorDialog(SyncErrorDialog.DIALOG_SYNC_CORRUPT_COLLECTION, syncMessage);</span>
                                        }
                                        break;
                                    case OVERWRITE_ERROR:
<span class="nc bnc" id="L2738" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7887)) {</span>
<span class="nc" id="L2739">                                            dialogMessage = res.getString(R.string.sync_overwrite_error);</span>
                                        }
<span class="nc bnc" id="L2741" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7888)) {</span>
<span class="nc" id="L2742">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case REMOTE_DB_ERROR:
<span class="nc bnc" id="L2746" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7889)) {</span>
<span class="nc" id="L2747">                                            dialogMessage = res.getString(R.string.sync_remote_db_error);</span>
                                        }
<span class="nc bnc" id="L2749" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7890)) {</span>
<span class="nc" id="L2750">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case SD_ACCESS_ERROR:
<span class="nc bnc" id="L2754" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7891)) {</span>
<span class="nc" id="L2755">                                            dialogMessage = res.getString(R.string.sync_write_access_error);</span>
                                        }
<span class="nc bnc" id="L2757" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7892)) {</span>
<span class="nc" id="L2758">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case FINISH_ERROR:
<span class="nc bnc" id="L2762" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7893)) {</span>
<span class="nc" id="L2763">                                            dialogMessage = res.getString(R.string.sync_log_finish_error);</span>
                                        }
<span class="nc bnc" id="L2765" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7894)) {</span>
<span class="nc" id="L2766">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case CONNECTION_ERROR:
<span class="nc bnc" id="L2770" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7895)) {</span>
<span class="nc" id="L2771">                                            dialogMessage = res.getString(R.string.sync_connection_error);</span>
                                        }
<span class="nc bnc" id="L2773" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7903)) {</span>
<span class="nc bnc" id="L2774" title="All 50 branches missed.">                                            if ((ListenerUtil.mutListener.listen(7901) ? ((ListenerUtil.mutListener.listen(7900) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7899) ? (result.length &gt; 0) : (ListenerUtil.mutListener.listen(7898) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7897) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7896) ? (result.length == 0) : (result.length &gt;= 0)))))) || result[0] instanceof Exception) : ((ListenerUtil.mutListener.listen(7900) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7899) ? (result.length &gt; 0) : (ListenerUtil.mutListener.listen(7898) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7897) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7896) ? (result.length == 0) : (result.length &gt;= 0)))))) &amp;&amp; result[0] instanceof Exception))) {</span>
<span class="nc bnc" id="L2775" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7902)) {</span>
<span class="nc" id="L2776">                                                    dialogMessage += &quot;\n\n&quot; + ((Exception) result[0]).getLocalizedMessage();</span>
                                                }
                                            }
                                        }
<span class="nc bnc" id="L2780" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7904)) {</span>
<span class="nc" id="L2781">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case IO_EXCEPTION:
<span class="nc bnc" id="L2785" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7905)) {</span>
<span class="nc" id="L2786">                                            handleDbError();</span>
                                        }
                                        break;
                                    case GENERIC_ERROR:
<span class="nc bnc" id="L2790" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7906)) {</span>
<span class="nc" id="L2791">                                            dialogMessage = res.getString(R.string.sync_generic_error);</span>
                                        }
<span class="nc bnc" id="L2793" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7907)) {</span>
<span class="nc" id="L2794">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case OUT_OF_MEMORY_ERROR:
<span class="nc bnc" id="L2798" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7908)) {</span>
<span class="nc" id="L2799">                                            dialogMessage = res.getString(R.string.error_insufficient_memory);</span>
                                        }
<span class="nc bnc" id="L2801" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7909)) {</span>
<span class="nc" id="L2802">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case SANITY_CHECK_ERROR:
<span class="nc bnc" id="L2806" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7910)) {</span>
<span class="nc" id="L2807">                                            dialogMessage = res.getString(R.string.sync_sanity_failed);</span>
                                        }
<span class="nc bnc" id="L2809" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7911)) {</span>
<span class="nc" id="L2810">                                            showSyncErrorDialog(SyncErrorDialog.DIALOG_SYNC_SANITY_ERROR, joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case SERVER_ABORT:
<span class="nc bnc" id="L2814" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7912)) {</span>
                                            // syncMsg has already been set above, no need to fetch it here.
<span class="nc" id="L2816">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case MEDIA_SYNC_SERVER_ERROR:
<span class="nc bnc" id="L2820" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7913)) {</span>
<span class="nc" id="L2821">                                            dialogMessage = res.getString(R.string.sync_media_error_check);</span>
                                        }
<span class="nc bnc" id="L2823" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7914)) {</span>
<span class="nc" id="L2824">                                            showSyncErrorDialog(SyncErrorDialog.DIALOG_MEDIA_SYNC_ERROR, joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    case CUSTOM_SYNC_SERVER_URL:
<span class="nc bnc" id="L2828" title="All 50 branches missed.">                                        String url = (ListenerUtil.mutListener.listen(7920) ? ((ListenerUtil.mutListener.listen(7919) ? (result.length &gt;= 0) : (ListenerUtil.mutListener.listen(7918) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7917) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7916) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7915) ? (result.length == 0) : (result.length &gt; 0)))))) || result[0] instanceof CustomSyncServerUrlException) : ((ListenerUtil.mutListener.listen(7919) ? (result.length &gt;= 0) : (ListenerUtil.mutListener.listen(7918) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7917) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7916) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7915) ? (result.length == 0) : (result.length &gt; 0)))))) &amp;&amp; result[0] instanceof CustomSyncServerUrlException)) ? ((CustomSyncServerUrlException) result[0]).getUrl() : &quot;unknown&quot;;</span>
<span class="nc bnc" id="L2829" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7921)) {</span>
<span class="nc" id="L2830">                                            dialogMessage = res.getString(R.string.sync_error_invalid_sync_server, url);</span>
                                        }
<span class="nc bnc" id="L2832" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7922)) {</span>
<span class="nc" id="L2833">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                    default:
<span class="nc bnc" id="L2837" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7933)) {</span>
<span class="nc bnc" id="L2838" title="All 50 branches missed.">                                            if ((ListenerUtil.mutListener.listen(7928) ? ((ListenerUtil.mutListener.listen(7927) ? (result.length &gt;= 0) : (ListenerUtil.mutListener.listen(7926) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7925) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7924) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7923) ? (result.length == 0) : (result.length &gt; 0)))))) || result[0] instanceof Integer) : ((ListenerUtil.mutListener.listen(7927) ? (result.length &gt;= 0) : (ListenerUtil.mutListener.listen(7926) ? (result.length &lt;= 0) : (ListenerUtil.mutListener.listen(7925) ? (result.length &lt; 0) : (ListenerUtil.mutListener.listen(7924) ? (result.length != 0) : (ListenerUtil.mutListener.listen(7923) ? (result.length == 0) : (result.length &gt; 0)))))) &amp;&amp; result[0] instanceof Integer))) {</span>
<span class="nc" id="L2839">                                                int code = (Integer) result[0];</span>
<span class="nc bnc" id="L2840" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7930)) {</span>
<span class="nc" id="L2841">                                                    dialogMessage = rewriteError(code);</span>
                                                }
<span class="nc bnc" id="L2843" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7932)) {</span>
<span class="nc bnc" id="L2844" title="All 2 branches missed.">                                                    if (dialogMessage == null) {</span>
<span class="nc bnc" id="L2845" title="All 2 branches missed.">                                                        if (!ListenerUtil.mutListener.listen(7931)) {</span>
<span class="nc" id="L2846">                                                            dialogMessage = res.getString(R.string.sync_log_error_specific, Integer.toString(code), result[1]);</span>
                                                        }
                                                    }
                                                }
<span class="nc" id="L2850">                                            } else {</span>
<span class="nc bnc" id="L2851" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(7929)) {</span>
<span class="nc" id="L2852">                                                    dialogMessage = res.getString(R.string.sync_log_error_specific, Integer.toString(-1), resultType);</span>
                                                }
                                            }
                                        }
<span class="nc bnc" id="L2856" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7934)) {</span>
<span class="nc" id="L2857">                                            showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                                        }
                                        break;
                                }
                            }
                        } else {
<span class="nc bnc" id="L2863" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7850)) {</span>
<span class="nc" id="L2864">                                dialogMessage = res.getString(R.string.sync_generic_error);</span>
                            }
<span class="nc bnc" id="L2866" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7851)) {</span>
<span class="nc" id="L2867">                                showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));</span>
                            }
                        }
                    }
<span class="nc" id="L2871">                } else {</span>
<span class="nc bnc" id="L2872" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7823)) {</span>
<span class="nc" id="L2873">                        Timber.i(&quot;Sync was successful&quot;);</span>
                    }
<span class="nc bnc" id="L2875" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7842)) {</span>
<span class="nc bnc" id="L2876" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(7824) ? (data.data[2] != null || !&quot;&quot;.equals(data.data[2])) : (data.data[2] != null &amp;&amp; !&quot;&quot;.equals(data.data[2])))) {</span>
<span class="nc bnc" id="L2877" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7840)) {</span>
<span class="nc" id="L2878">                                Timber.i(&quot;Syncing had additional information&quot;);</span>
                            }
                            // Note: Do not log this data. May contain user email.
<span class="nc" id="L2881">                            String message = res.getString(R.string.sync_database_acknowledge) + &quot;\n\n&quot; + data.data[2];</span>
<span class="nc bnc" id="L2882" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7841)) {</span>
<span class="nc" id="L2883">                                showSimpleMessageDialog(message);</span>
                            }
<span class="nc bnc" id="L2885" title="All 50 branches missed.">                        } else if ((ListenerUtil.mutListener.listen(7830) ? ((ListenerUtil.mutListener.listen(7829) ? (data.data.length &gt;= 0) : (ListenerUtil.mutListener.listen(7828) ? (data.data.length &lt;= 0) : (ListenerUtil.mutListener.listen(7827) ? (data.data.length &lt; 0) : (ListenerUtil.mutListener.listen(7826) ? (data.data.length != 0) : (ListenerUtil.mutListener.listen(7825) ? (data.data.length == 0) : (data.data.length &gt; 0)))))) || data.data[0] instanceof Connection.ConflictResolution) : ((ListenerUtil.mutListener.listen(7829) ? (data.data.length &gt;= 0) : (ListenerUtil.mutListener.listen(7828) ? (data.data.length &lt;= 0) : (ListenerUtil.mutListener.listen(7827) ? (data.data.length &lt; 0) : (ListenerUtil.mutListener.listen(7826) ? (data.data.length != 0) : (ListenerUtil.mutListener.listen(7825) ? (data.data.length == 0) : (data.data.length &gt; 0)))))) &amp;&amp; data.data[0] instanceof Connection.ConflictResolution))) {</span>
                            // A full sync occurred
<span class="nc" id="L2887">                            Connection.ConflictResolution dataString = (Connection.ConflictResolution) data.data[0];</span>
<span class="nc bnc" id="L2888" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7839)) {</span>
<span class="nc bnc" id="L2889" title="All 3 branches missed.">                                switch(dataString) {</span>
                                    case FULL_UPLOAD:
<span class="nc bnc" id="L2891" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7833)) {</span>
<span class="nc" id="L2892">                                            Timber.i(&quot;Full Upload Completed&quot;);</span>
                                        }
<span class="nc bnc" id="L2894" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7834)) {</span>
<span class="nc" id="L2895">                                            showSyncLogMessage(R.string.sync_log_uploading_message, syncMessage);</span>
                                        }
                                        break;
                                    case FULL_DOWNLOAD:
<span class="nc bnc" id="L2899" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7835)) {</span>
<span class="nc" id="L2900">                                            Timber.i(&quot;Full Download Completed&quot;);</span>
                                        }
<span class="nc bnc" id="L2902" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7836)) {</span>
<span class="nc" id="L2903">                                            showSyncLogMessage(R.string.backup_full_sync_from_server, syncMessage);</span>
                                        }
                                        break;
                                    default:
<span class="nc bnc" id="L2907" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7837)) {</span>
                                            // should not be possible
<span class="nc" id="L2909">                                            Timber.i(&quot;Full Sync Completed (Unknown Direction)&quot;);</span>
                                        }
<span class="nc bnc" id="L2911" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(7838)) {</span>
<span class="nc" id="L2912">                                            showSyncLogMessage(R.string.sync_database_acknowledge, syncMessage);</span>
                                        }
                                        break;
                                }
                            }
<span class="nc" id="L2917">                        } else {</span>
<span class="nc bnc" id="L2918" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7831)) {</span>
<span class="nc" id="L2919">                                Timber.i(&quot;Regular sync completed successfully&quot;);</span>
                            }
<span class="nc bnc" id="L2921" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7832)) {</span>
<span class="nc" id="L2922">                                showSyncLogMessage(R.string.sync_database_acknowledge, syncMessage);</span>
                            }
                        }
                    }
<span class="nc bnc" id="L2926" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7843)) {</span>
                        // Mark sync as completed - then refresh the sync icon
<span class="nc" id="L2928">                        SyncStatus.markSyncCompleted();</span>
                    }
<span class="nc bnc" id="L2930" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7844)) {</span>
<span class="nc" id="L2931">                        supportInvalidateOptionsMenu();</span>
                    }
<span class="nc bnc" id="L2933" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7845)) {</span>
<span class="nc" id="L2934">                        updateDeckList();</span>
                    }
<span class="nc bnc" id="L2936" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7846)) {</span>
<span class="nc" id="L2937">                        WidgetStatus.update(DeckPicker.this);</span>
                    }
<span class="nc bnc" id="L2939" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7849)) {</span>
<span class="nc bnc" id="L2940" title="All 2 branches missed.">                        if (mFragmented) {</span>
                            try {
<span class="nc bnc" id="L2942" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7848)) {</span>
<span class="nc" id="L2943">                                    loadStudyOptionsFragment(false);</span>
                                }
<span class="nc" id="L2945">                            } catch (IllegalStateException e) {</span>
<span class="nc bnc" id="L2946" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(7847)) {</span>
                                    // fragment here is fine since we build a fresh fragment on resume anyway.
<span class="nc" id="L2948">                                    Timber.w(e, &quot;Failed to load StudyOptionsFragment after sync.&quot;);</span>
                                }
<span class="nc" id="L2950">                            }</span>
                        }
                    }
                }
            }
<span class="nc" id="L2955">        }</span>
    };

    @VisibleForTesting()
    @Nullable
    public String rewriteError(int code) {
        String msg;
<span class="nc" id="L2962">        Resources res = getResources();</span>
<span class="nc bnc" id="L2963" title="All 9 branches missed.">        switch(code) {</span>
            case 407:
<span class="nc" id="L2965">                msg = res.getString(R.string.sync_error_407_proxy_required);</span>
<span class="nc" id="L2966">                break;</span>
            case 409:
<span class="nc" id="L2968">                msg = res.getString(R.string.sync_error_409);</span>
<span class="nc" id="L2969">                break;</span>
            case 413:
<span class="nc" id="L2971">                msg = res.getString(R.string.sync_error_413_collection_size);</span>
<span class="nc" id="L2972">                break;</span>
            case 500:
<span class="nc" id="L2974">                msg = res.getString(R.string.sync_error_500_unknown);</span>
<span class="nc" id="L2975">                break;</span>
            case 501:
<span class="nc" id="L2977">                msg = res.getString(R.string.sync_error_501_upgrade_required);</span>
<span class="nc" id="L2978">                break;</span>
            case 502:
<span class="nc" id="L2980">                msg = res.getString(R.string.sync_error_502_maintenance);</span>
<span class="nc" id="L2981">                break;</span>
            case 503:
<span class="nc" id="L2983">                msg = res.getString(R.string.sync_too_busy);</span>
<span class="nc" id="L2984">                break;</span>
            case 504:
<span class="nc" id="L2986">                msg = res.getString(R.string.sync_error_504_gateway_timeout);</span>
<span class="nc" id="L2987">                break;</span>
            default:
<span class="nc" id="L2989">                msg = null;</span>
                break;
        }
<span class="nc" id="L2992">        return msg;</span>
    }

    @Nullable
    public static String joinSyncMessages(@Nullable String dialogMessage, @Nullable String syncMessage) {
        // If both strings have text, separate them by a new line, otherwise return whichever has text
<span class="nc bnc" id="L2998" title="All 10 branches missed.">        if ((ListenerUtil.mutListener.listen(7938) ? (!TextUtils.isEmpty(dialogMessage) || !TextUtils.isEmpty(syncMessage)) : (!TextUtils.isEmpty(dialogMessage) &amp;&amp; !TextUtils.isEmpty(syncMessage)))) {</span>
<span class="nc" id="L2999">            return dialogMessage + &quot;\n\n&quot; + syncMessage;</span>
<span class="nc bnc" id="L3000" title="All 2 branches missed.">        } else if (!TextUtils.isEmpty(dialogMessage)) {</span>
<span class="nc" id="L3001">            return dialogMessage;</span>
        } else {
<span class="nc" id="L3003">            return syncMessage;</span>
        }
    }

    @Override
    public void loginToSyncServer() {
<span class="nc" id="L3009">        Intent myAccount = new Intent(this, MyAccount.class);</span>
<span class="nc bnc" id="L3010" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7939)) {</span>
<span class="nc" id="L3011">            myAccount.putExtra(&quot;notLoggedIn&quot;, true);</span>
        }
<span class="nc bnc" id="L3013" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7940)) {</span>
<span class="nc" id="L3014">            startActivityForResultWithAnimation(myAccount, LOG_IN_FOR_SYNC, FADE);</span>
        }
<span class="nc" id="L3016">    }</span>

    // Callback to import a file -- adding it to existing collection
    @Override
    public void importAdd(String importPath) {
<span class="nc bnc" id="L3021" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7941)) {</span>
<span class="nc" id="L3022">            Timber.d(&quot;importAdd() for file %s&quot;, importPath);</span>
        }
<span class="nc bnc" id="L3024" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7942)) {</span>
<span class="nc" id="L3025">            TaskManager.launchCollectionTask(new CollectionTask.ImportAdd(importPath), mImportAddListener);</span>
        }
<span class="nc" id="L3027">    }</span>

    // Callback to import a file -- replacing the existing collection
    @Override
    public void importReplace(String importPath) {
<span class="nc bnc" id="L3032" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7943)) {</span>
<span class="nc" id="L3033">            TaskManager.launchCollectionTask(new CollectionTask.ImportReplace(importPath), importReplaceListener());</span>
        }
<span class="nc" id="L3035">    }</span>

    @Override
    public void exportApkg(String filename, Long did, boolean includeSched, boolean includeMedia) {
<span class="nc" id="L3039">        File exportDir = new File(getExternalCacheDir(), &quot;export&quot;);</span>
<span class="nc bnc" id="L3040" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7944)) {</span>
<span class="nc" id="L3041">            exportDir.mkdirs();</span>
        }
        File exportPath;
<span class="nc" id="L3044">        String timeStampSuffix = &quot;-&quot; + TimeUtils.getTimestamp(getCol().getTime());</span>
<span class="nc bnc" id="L3045" title="All 2 branches missed.">        if (filename != null) {</span>
            // filename has been explicitly specified
<span class="nc" id="L3047">            exportPath = new File(exportDir, filename);</span>
<span class="nc bnc" id="L3048" title="All 2 branches missed.">        } else if (did != null) {</span>
            // filename not explicitly specified, but a deck has been specified so use deck name
<span class="nc" id="L3050">            exportPath = new File(exportDir, getCol().getDecks().get(did).getString(&quot;name&quot;).replaceAll(&quot;\\W+&quot;, &quot;_&quot;) + timeStampSuffix + &quot;.apkg&quot;);</span>
<span class="nc bnc" id="L3051" title="All 2 branches missed.">        } else if (!includeSched) {</span>
            // full export without scheduling is assumed to be shared with someone else -- use &quot;All Decks.apkg&quot;
<span class="nc" id="L3053">            exportPath = new File(exportDir, &quot;All Decks&quot; + timeStampSuffix + &quot;.apkg&quot;);</span>
        } else {
            // full collection export -- use &quot;collection.colpkg&quot;
<span class="nc" id="L3056">            File colPath = new File(getCol().getPath());</span>
<span class="nc" id="L3057">            String newFileName = colPath.getName().replace(&quot;.anki2&quot;, timeStampSuffix + &quot;.colpkg&quot;);</span>
<span class="nc" id="L3058">            exportPath = new File(exportDir, newFileName);</span>
        }
<span class="nc bnc" id="L3060" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7945)) {</span>
<span class="nc" id="L3061">            TaskManager.launchCollectionTask(new CollectionTask.ExportApkg(exportPath.getPath(), did, includeSched, includeMedia), exportListener());</span>
        }
<span class="nc" id="L3063">    }</span>

    public void emailFile(String path) {
        // Make sure the file actually exists
<span class="nc" id="L3067">        File attachment = new File(path);</span>
<span class="nc bnc" id="L3068" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7948)) {</span>
<span class="nc bnc" id="L3069" title="All 2 branches missed.">            if (!attachment.exists()) {</span>
<span class="nc bnc" id="L3070" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7946)) {</span>
<span class="nc" id="L3071">                    Timber.e(&quot;Specified apkg file %s does not exist&quot;, path);</span>
                }
<span class="nc bnc" id="L3073" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7947)) {</span>
<span class="nc" id="L3074">                    UIUtils.showThemedToast(this, getResources().getString(R.string.apk_share_error), false);</span>
                }
<span class="nc" id="L3076">                return;</span>
            }
        }
        // Get a URI for the file to be shared via the FileProvider API
        Uri uri;
        try {
<span class="nc" id="L3082">            uri = FileProvider.getUriForFile(DeckPicker.this, &quot;com.ichi2.anki.apkgfileprovider&quot;, attachment);</span>
<span class="nc" id="L3083">        } catch (IllegalArgumentException e) {</span>
<span class="nc bnc" id="L3084" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7949)) {</span>
<span class="nc" id="L3085">                Timber.e(&quot;Could not generate a valid URI for the apkg file&quot;);</span>
            }
<span class="nc bnc" id="L3087" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(7950)) {</span>
<span class="nc" id="L3088">                UIUtils.showThemedToast(this, getResources().getString(R.string.apk_share_error), false);</span>
            }
<span class="nc" id="L3090">            return;</span>
<span class="nc" id="L3091">        }</span>
<span class="nc" id="L3092">        Intent shareIntent = ShareCompat.IntentBuilder.from(DeckPicker.this).setType(&quot;application/apkg&quot;).setStream(uri).setSubject(getString(R.string.export_email_subject, attachment.getName())).setHtmlText(getString(R.string.export_email_text)).getIntent();</span>
<span class="nc bnc" id="L3093" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7954)) {</span>
<span class="nc bnc" id="L3094" title="All 2 branches missed.">            if (shareIntent.resolveActivity(getPackageManager()) != null) {</span>
<span class="nc bnc" id="L3095" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7953)) {</span>
<span class="nc" id="L3096">                    startActivityWithoutAnimation(shareIntent);</span>
                }
            } else {
<span class="nc bnc" id="L3099" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7951)) {</span>
                    // Try to save it?
<span class="nc" id="L3101">                    UIUtils.showSimpleSnackbar(this, R.string.export_send_no_handlers, false);</span>
                }
<span class="nc bnc" id="L3103" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7952)) {</span>
<span class="nc" id="L3104">                    saveExportFile(path);</span>
                }
            }
        }
<span class="nc" id="L3108">    }</span>

    public void saveExportFile(String path) {
        // Make sure the file actually exists
<span class="nc" id="L3112">        File attachment = new File(path);</span>
<span class="nc bnc" id="L3113" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7957)) {</span>
<span class="nc bnc" id="L3114" title="All 2 branches missed.">            if (!attachment.exists()) {</span>
<span class="nc bnc" id="L3115" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7955)) {</span>
<span class="nc" id="L3116">                    Timber.e(&quot;saveExportFile() Specified apkg file %s does not exist&quot;, path);</span>
                }
<span class="nc bnc" id="L3118" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7956)) {</span>
<span class="nc" id="L3119">                    UIUtils.showSimpleSnackbar(this, R.string.export_save_apkg_unsuccessful, false);</span>
                }
<span class="nc" id="L3121">                return;</span>
            }
        }
<span class="nc bnc" id="L3124" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7958)) {</span>
            // Send the user to the standard Android file picker via Intent
<span class="nc" id="L3126">            mExportFileName = path;</span>
        }
<span class="nc" id="L3128">        Intent saveIntent = new Intent(Intent.ACTION_CREATE_DOCUMENT);</span>
<span class="nc bnc" id="L3129" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7959)) {</span>
<span class="nc" id="L3130">            saveIntent.addCategory(Intent.CATEGORY_OPENABLE);</span>
        }
<span class="nc bnc" id="L3132" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7960)) {</span>
<span class="nc" id="L3133">            saveIntent.setType(&quot;application/apkg&quot;);</span>
        }
<span class="nc bnc" id="L3135" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7961)) {</span>
<span class="nc" id="L3136">            saveIntent.putExtra(Intent.EXTRA_TITLE, attachment.getName());</span>
        }
<span class="nc bnc" id="L3138" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7962)) {</span>
<span class="nc" id="L3139">            saveIntent.putExtra(&quot;android.content.extra.SHOW_ADVANCED&quot;, true);</span>
        }
<span class="nc bnc" id="L3141" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7963)) {</span>
<span class="nc" id="L3142">            saveIntent.putExtra(&quot;android.content.extra.FANCY&quot;, true);</span>
        }
<span class="nc bnc" id="L3144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7964)) {</span>
<span class="nc" id="L3145">            saveIntent.putExtra(&quot;android.content.extra.SHOW_FILESIZE&quot;, true);</span>
        }
<span class="nc bnc" id="L3147" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7965)) {</span>
<span class="nc" id="L3148">            startActivityForResultWithoutAnimation(saveIntent, PICK_EXPORT_FILE);</span>
        }
<span class="nc" id="L3150">    }</span>

    /**
     * Load a new studyOptionsFragment. If withDeckOptions is true, the deck options activity will
     * be loaded on top of it. Use this flag when creating a new filtered deck to allow the user to
     * modify the filter settings before being shown the fragment. The fragment itself will handle
     * rebuilding the deck if the settings change.
     */
    private void loadStudyOptionsFragment(boolean withDeckOptions) {
<span class="nc" id="L3159">        StudyOptionsFragment details = StudyOptionsFragment.newInstance(withDeckOptions);</span>
<span class="nc" id="L3160">        FragmentTransaction ft = getSupportFragmentManager().beginTransaction();</span>
<span class="nc bnc" id="L3161" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7966)) {</span>
<span class="nc" id="L3162">            ft.replace(R.id.studyoptions_fragment, details);</span>
        }
<span class="nc bnc" id="L3164" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7967)) {</span>
<span class="nc" id="L3165">            ft.commit();</span>
        }
<span class="nc" id="L3167">    }</span>

    public StudyOptionsFragment getFragment() {
<span class="nc" id="L3170">        Fragment frag = getSupportFragmentManager().findFragmentById(R.id.studyoptions_fragment);</span>
<span class="nc bnc" id="L3171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7968)) {</span>
<span class="nc bnc" id="L3172" title="All 2 branches missed.">            if ((frag instanceof StudyOptionsFragment)) {</span>
<span class="nc" id="L3173">                return (StudyOptionsFragment) frag;</span>
            }
        }
<span class="nc" id="L3176">        return null;</span>
    }

    /**
     * Show a message when the SD card is ejected
     */
    private void registerExternalStorageListener() {
<span class="nc bnc" id="L3183" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7976)) {</span>
<span class="nc bnc" id="L3184" title="All 2 branches missed.">            if (mUnmountReceiver == null) {</span>
<span class="nc bnc" id="L3185" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7972)) {</span>
<span class="nc" id="L3186">                    mUnmountReceiver = new BroadcastReceiver() {</span>

                        @Override
                        public void onReceive(Context context, Intent intent) {
<span class="nc bnc" id="L3190" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7971)) {</span>
<span class="nc bnc" id="L3191" title="All 2 branches missed.">                                if (intent.getAction().equals(SdCardReceiver.MEDIA_EJECT)) {</span>
<span class="nc bnc" id="L3192" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7970)) {</span>
<span class="nc" id="L3193">                                        onSdCardNotMounted();</span>
                                    }
<span class="nc bnc" id="L3195" title="All 2 branches missed.">                                } else if (intent.getAction().equals(SdCardReceiver.MEDIA_MOUNT)) {</span>
<span class="nc bnc" id="L3196" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(7969)) {</span>
<span class="nc" id="L3197">                                        restartActivity();</span>
                                    }
                                }
                            }
<span class="nc" id="L3201">                        }</span>
                    };
                }
<span class="nc" id="L3204">                IntentFilter iFilter = new IntentFilter();</span>
<span class="nc bnc" id="L3205" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7973)) {</span>
<span class="nc" id="L3206">                    iFilter.addAction(SdCardReceiver.MEDIA_EJECT);</span>
                }
<span class="nc bnc" id="L3208" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7974)) {</span>
<span class="nc" id="L3209">                    iFilter.addAction(SdCardReceiver.MEDIA_MOUNT);</span>
                }
<span class="nc bnc" id="L3211" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7975)) {</span>
<span class="nc" id="L3212">                    registerReceiver(mUnmountReceiver, iFilter);</span>
                }
            }
        }
<span class="nc" id="L3216">    }</span>

    public void addSharedDeck() {
<span class="nc bnc" id="L3219" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7977)) {</span>
<span class="nc" id="L3220">            openUrl(Uri.parse(getResources().getString(R.string.shared_decks_url)));</span>
        }
<span class="nc" id="L3222">    }</span>

    private void openStudyOptions(boolean withDeckOptions) {
<span class="nc bnc" id="L3225" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7982)) {</span>
<span class="nc bnc" id="L3226" title="All 2 branches missed.">            if (mFragmented) {</span>
<span class="nc bnc" id="L3227" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7981)) {</span>
                    // The fragment will show the study options screen instead of launching a new activity.
<span class="nc" id="L3229">                    loadStudyOptionsFragment(withDeckOptions);</span>
                }
            } else {
<span class="nc" id="L3232">                Intent intent = new Intent();</span>
<span class="nc bnc" id="L3233" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7978)) {</span>
<span class="nc" id="L3234">                    intent.putExtra(&quot;withDeckOptions&quot;, withDeckOptions);</span>
                }
<span class="nc bnc" id="L3236" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7979)) {</span>
<span class="nc" id="L3237">                    intent.setClass(this, StudyOptionsActivity.class);</span>
                }
<span class="nc bnc" id="L3239" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7980)) {</span>
<span class="nc" id="L3240">                    startActivityForResultWithAnimation(intent, SHOW_STUDYOPTIONS, LEFT);</span>
                }
            }
        }
<span class="nc" id="L3244">    }</span>

    private void openReviewerOrStudyOptions(DeckSelectionType selectionType) {
<span class="nc bnc" id="L3247" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7989)) {</span>
<span class="nc bnc" id="L3248" title="All 4 branches missed.">            switch(selectionType) {</span>
                case DEFAULT:
<span class="nc bnc" id="L3250" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7985)) {</span>
<span class="nc bnc" id="L3251" title="All 2 branches missed.">                        if (mFragmented) {</span>
<span class="nc bnc" id="L3252" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7984)) {</span>
<span class="nc" id="L3253">                                openStudyOptions(false);</span>
                            }
                        } else {
<span class="nc bnc" id="L3256" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(7983)) {</span>
<span class="nc" id="L3257">                                openReviewer();</span>
                            }
                        }
                    }
<span class="nc" id="L3261">                    return;</span>
                case SHOW_STUDY_OPTIONS:
<span class="nc bnc" id="L3263" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7986)) {</span>
<span class="nc" id="L3264">                        openStudyOptions(false);</span>
                    }
<span class="nc" id="L3266">                    return;</span>
                case SKIP_STUDY_OPTIONS:
<span class="nc bnc" id="L3268" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7987)) {</span>
<span class="nc" id="L3269">                        openReviewer();</span>
                    }
<span class="nc" id="L3271">                    return;</span>
                default:
<span class="nc bnc" id="L3273" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(7988)) {</span>
<span class="nc" id="L3274">                        Timber.w(&quot;openReviewerOrStudyOptions: Unknown selection: %s&quot;, selectionType);</span>
                    }
            }
        }
<span class="nc" id="L3278">    }</span>

    private void handleDeckSelection(long did, DeckSelectionType selectionType) {
<span class="nc bnc" id="L3281" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7991)) {</span>
            // Clear the undo history when selecting a new deck
<span class="nc bnc" id="L3283" title="All 2 branches missed.">            if (getCol().getDecks().selected() != did) {</span>
<span class="nc bnc" id="L3284" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7990)) {</span>
<span class="nc" id="L3285">                    getCol().clearUndo();</span>
                }
            }
        }
<span class="nc bnc" id="L3289" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7992)) {</span>
            // Select the deck
<span class="nc" id="L3291">            getCol().getDecks().select(did);</span>
        }
<span class="nc bnc" id="L3293" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7993)) {</span>
            // Also forget the last deck used by the Browser
<span class="nc" id="L3295">            CardBrowser.clearLastDeckId();</span>
        }
<span class="nc bnc" id="L3297" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7994)) {</span>
            // Reset the schedule so that we get the counts for the currently selected deck
<span class="nc" id="L3299">            mFocusedDeck = did;</span>
        }
        // Get some info about the deck to handle special cases
<span class="nc" id="L3302">        AbstractDeckTreeNode&lt;?&gt; deckDueTreeNode = mDeckListAdapter.getNodeByDid(did);</span>
<span class="nc bnc" id="L3303" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(7997)) {</span>
<span class="nc bnc" id="L3304" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(7995) ? (!deckDueTreeNode.shouldDisplayCounts() &amp;&amp; deckDueTreeNode.knownToHaveRep()) : (!deckDueTreeNode.shouldDisplayCounts() || deckDueTreeNode.knownToHaveRep()))) {</span>
<span class="nc bnc" id="L3305" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(7996)) {</span>
                    // If there is nothing to review, it'll come back to deck picker.
<span class="nc" id="L3307">                    openReviewerOrStudyOptions(selectionType);</span>
                }
<span class="nc" id="L3309">                return;</span>
            }
        }
<span class="nc bnc" id="L3312" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8014)) {</span>
            // Figure out what action to take
<span class="nc bnc" id="L3314" title="All 2 branches missed.">            if (getCol().getSched().hasCardsTodayAfterStudyAheadLimit()) {</span>
<span class="nc bnc" id="L3315" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8013)) {</span>
                    // If there are cards due that can't be studied yet (due to the learn ahead limit) then go to study options
<span class="nc" id="L3317">                    openStudyOptions(false);</span>
                }
<span class="nc bnc" id="L3319" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7998) ? (getCol().getSched().newDue() &amp;&amp; getCol().getSched().revDue()) : (getCol().getSched().newDue() || getCol().getSched().revDue()))) {</span>
<span class="nc bnc" id="L3320" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8009)) {</span>
                    // If there are no cards to review because of the daily study limit then give &quot;Study more&quot; option
<span class="nc" id="L3322">                    UIUtils.showSnackbar(this, R.string.studyoptions_limit_reached, false, R.string.study_more, v -&gt; {</span>
<span class="nc" id="L3323">                        CustomStudyDialog d = CustomStudyDialog.newInstance(CustomStudyDialog.CONTEXT_MENU_LIMITS, getCol().getDecks().selected(), true);</span>
<span class="nc" id="L3324">                        showDialogFragment(d);</span>
<span class="nc" id="L3325">                    }, findViewById(R.id.root_layout), mSnackbarShowHideCallback);</span>
                }
<span class="nc bnc" id="L3327" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8012)) {</span>
                    // are required for all snackbars below.
<span class="nc bnc" id="L3329" title="All 2 branches missed.">                    if (mFragmented) {</span>
<span class="nc bnc" id="L3330" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8011)) {</span>
                            // regardless of whether the deck is currently reviewable or not.
<span class="nc" id="L3332">                            openStudyOptions(false);</span>
                        }
                    } else {
<span class="nc bnc" id="L3335" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8010)) {</span>
                            // highlighted correctly.
<span class="nc" id="L3337">                            updateDeckList();</span>
                        }
                    }
                }
<span class="nc bnc" id="L3341" title="All 2 branches missed.">            } else if (getCol().getDecks().isDyn(did)) {</span>
<span class="nc bnc" id="L3342" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8008)) {</span>
                    // Go to the study options screen if filtered deck with no cards to study
<span class="nc" id="L3344">                    openStudyOptions(false);</span>
                }
<span class="nc bnc" id="L3346" title="All 10 branches missed.">            } else if ((ListenerUtil.mutListener.listen(7999) ? (!deckDueTreeNode.hasChildren() || getCol().isEmptyDeck(did)) : (!deckDueTreeNode.hasChildren() &amp;&amp; getCol().isEmptyDeck(did)))) {</span>
<span class="nc bnc" id="L3347" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8004)) {</span>
                    // If the deck is empty and has no children then show a message saying it's empty
<span class="nc" id="L3349">                    UIUtils.showSnackbar(this, R.string.empty_deck, false, R.string.empty_deck_add_note, v -&gt; addNote(), findViewById(R.id.root_layout), mSnackbarShowHideCallback);</span>
                }
<span class="nc bnc" id="L3351" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8007)) {</span>
<span class="nc bnc" id="L3352" title="All 2 branches missed.">                    if (mFragmented) {</span>
<span class="nc bnc" id="L3353" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8006)) {</span>
<span class="nc" id="L3354">                            openStudyOptions(false);</span>
                        }
                    } else {
<span class="nc bnc" id="L3357" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8005)) {</span>
<span class="nc" id="L3358">                            updateDeckList();</span>
                        }
                    }
                }
            } else {
<span class="nc bnc" id="L3363" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8000)) {</span>
                    // Otherwise say there are no cards scheduled to study, and give option to do custom study
<span class="nc" id="L3365">                    UIUtils.showSnackbar(this, R.string.studyoptions_empty_schedule, false, R.string.custom_study, v -&gt; {</span>
<span class="nc" id="L3366">                        CustomStudyDialog d = CustomStudyDialog.newInstance(CustomStudyDialog.CONTEXT_MENU_EMPTY_SCHEDULE, getCol().getDecks().selected(), true);</span>
<span class="nc" id="L3367">                        showDialogFragment(d);</span>
<span class="nc" id="L3368">                    }, findViewById(R.id.root_layout), mSnackbarShowHideCallback);</span>
                }
<span class="nc bnc" id="L3370" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8003)) {</span>
<span class="nc bnc" id="L3371" title="All 2 branches missed.">                    if (mFragmented) {</span>
<span class="nc bnc" id="L3372" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8002)) {</span>
<span class="nc" id="L3373">                            openStudyOptions(false);</span>
                        }
                    } else {
<span class="nc bnc" id="L3376" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8001)) {</span>
<span class="nc" id="L3377">                            updateDeckList();</span>
                        }
                    }
                }
            }
        }
<span class="nc" id="L3383">    }</span>

    private void openHelpUrl(Uri helpUrl) {
<span class="nc bnc" id="L3386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8015)) {</span>
<span class="nc" id="L3387">            openUrl(helpUrl);</span>
        }
<span class="nc" id="L3389">    }</span>

    /**
     * Scroll the deck list so that it is centered on the current deck.
     *
     * @param did The deck ID of the deck to select.
     */
    private void scrollDecklistToDeck(long did) {
<span class="nc" id="L3397">        int position = mDeckListAdapter.findDeckPosition(did);</span>
<span class="nc bnc" id="L3398" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8020)) {</span>
<span class="nc bnc" id="L3399" title="All 8 branches missed.">            mRecyclerViewLayoutManager.scrollToPositionWithOffset(position, ((ListenerUtil.mutListener.listen(8019) ? (mRecyclerView.getHeight() % 2) : (ListenerUtil.mutListener.listen(8018) ? (mRecyclerView.getHeight() * 2) : (ListenerUtil.mutListener.listen(8017) ? (mRecyclerView.getHeight() - 2) : (ListenerUtil.mutListener.listen(8016) ? (mRecyclerView.getHeight() + 2) : (mRecyclerView.getHeight() / 2)))))));</span>
        }
<span class="nc" id="L3401">    }</span>

    private &lt;T extends AbstractDeckTreeNode&lt;T&gt;&gt; UpdateDeckListListener&lt;T&gt; updateDeckListListener() {
<span class="nc" id="L3404">        return new UpdateDeckListListener&lt;T&gt;(this);</span>
    }

    private static class UpdateDeckListListener&lt;T extends AbstractDeckTreeNode&lt;T&gt;&gt; extends TaskListenerWithContext&lt;DeckPicker, Void, List&lt;T&gt;&gt; {

        public UpdateDeckListListener(DeckPicker deckPicker) {
<span class="nc" id="L3410">            super(deckPicker);</span>
<span class="nc" id="L3411">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L3415" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8022)) {</span>
<span class="nc bnc" id="L3416" title="All 2 branches missed.">                if (!deckPicker.colIsOpen()) {</span>
<span class="nc bnc" id="L3417" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8021)) {</span>
<span class="nc" id="L3418">                        deckPicker.showProgressBar();</span>
                    }
                }
            }
<span class="nc bnc" id="L3422" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8023)) {</span>
<span class="nc" id="L3423">                Timber.d(&quot;Refreshing deck list&quot;);</span>
            }
<span class="nc" id="L3425">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, List&lt;T&gt; dueTree) {
<span class="nc bnc" id="L3429" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8024)) {</span>
<span class="nc" id="L3430">                Timber.i(&quot;Updating deck list UI&quot;);</span>
            }
<span class="nc bnc" id="L3432" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8025)) {</span>
<span class="nc" id="L3433">                deckPicker.hideProgressBar();</span>
            }
<span class="nc bnc" id="L3435" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8027)) {</span>
                // Make sure the fragment is visible
<span class="nc bnc" id="L3437" title="All 2 branches missed.">                if (deckPicker.mFragmented) {</span>
<span class="nc bnc" id="L3438" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8026)) {</span>
<span class="nc" id="L3439">                        deckPicker.mStudyoptionsFrame.setVisibility(View.VISIBLE);</span>
                    }
                }
            }
<span class="nc bnc" id="L3443" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8030)) {</span>
<span class="nc bnc" id="L3444" title="All 2 branches missed.">                if (dueTree == null) {</span>
<span class="nc bnc" id="L3445" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8028)) {</span>
<span class="nc" id="L3446">                        Timber.e(&quot;null result loading deck counts&quot;);</span>
                    }
<span class="nc bnc" id="L3448" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8029)) {</span>
<span class="nc" id="L3449">                        deckPicker.showCollectionErrorDialog();</span>
                    }
<span class="nc" id="L3451">                    return;</span>
                }
            }
<span class="nc bnc" id="L3454" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8031)) {</span>
<span class="nc" id="L3455">                deckPicker.mDueTree = dueTree;</span>
            }
<span class="nc bnc" id="L3457" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8032)) {</span>
<span class="nc" id="L3458">                deckPicker.__renderPage();</span>
            }
<span class="nc bnc" id="L3460" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8033)) {</span>
                // Update the mini statistics bar as well
<span class="nc" id="L3462">                AnkiStatsTaskHandler.createReviewSummaryStatistics(deckPicker.getCol(), deckPicker.mReviewSummaryTextView);</span>
            }
<span class="nc bnc" id="L3464" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8034)) {</span>
<span class="nc" id="L3465">                Timber.d(&quot;Startup - Deck List UI Completed&quot;);</span>
            }
<span class="nc" id="L3467">        }</span>
    }

    /**
     * Launch an asynchronous task to rebuild the deck list and recalculate the deck counts. Use this
     * after any change to a deck (e.g., rename, importing, add/delete) that needs to be reflected
     * in the deck list.
     *
     * This method also triggers an update for the widget to reflect the newly calculated counts.
     */
    private void updateDeckList() {
<span class="nc bnc" id="L3478" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8035)) {</span>
<span class="nc" id="L3479">            updateDeckList(false);</span>
        }
<span class="nc" id="L3481">    }</span>

    private void updateDeckList(boolean quick) {
<span class="nc bnc" id="L3484" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8038)) {</span>
<span class="nc bnc" id="L3485" title="All 2 branches missed.">            if (quick) {</span>
<span class="nc bnc" id="L3486" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8037)) {</span>
<span class="nc" id="L3487">                    TaskManager.launchCollectionTask(new CollectionTask.LoadDeck(), updateDeckListListener());</span>
                }
            } else {
<span class="nc bnc" id="L3490" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8036)) {</span>
<span class="nc" id="L3491">                    TaskManager.launchCollectionTask(new CollectionTask.LoadDeckCounts(), updateDeckListListener());</span>
                }
            }
        }
<span class="nc" id="L3495">    }</span>

    public void __renderPage() {
<span class="nc bnc" id="L3498" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8040)) {</span>
<span class="nc bnc" id="L3499" title="All 2 branches missed.">            if (mDueTree == null) {</span>
<span class="nc bnc" id="L3500" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8039)) {</span>
                    // We may need to recompute it.
<span class="nc" id="L3502">                    updateDeckList();</span>
                }
<span class="nc" id="L3504">                return;</span>
            }
        }
        // Check if default deck is the only available and there are no cards
<span class="nc bnc" id="L3508" title="All 106 branches missed.">        boolean isEmpty = (ListenerUtil.mutListener.listen(8047) ? ((ListenerUtil.mutListener.listen(8046) ? ((ListenerUtil.mutListener.listen(8045) ? (mDueTree.size() &gt;= 1) : (ListenerUtil.mutListener.listen(8044) ? (mDueTree.size() &lt;= 1) : (ListenerUtil.mutListener.listen(8043) ? (mDueTree.size() &gt; 1) : (ListenerUtil.mutListener.listen(8042) ? (mDueTree.size() &lt; 1) : (ListenerUtil.mutListener.listen(8041) ? (mDueTree.size() != 1) : (mDueTree.size() == 1)))))) || mDueTree.get(0).getDid() == 1) : ((ListenerUtil.mutListener.listen(8045) ? (mDueTree.size() &gt;= 1) : (ListenerUtil.mutListener.listen(8044) ? (mDueTree.size() &lt;= 1) : (ListenerUtil.mutListener.listen(8043) ? (mDueTree.size() &gt; 1) : (ListenerUtil.mutListener.listen(8042) ? (mDueTree.size() &lt; 1) : (ListenerUtil.mutListener.listen(8041) ? (mDueTree.size() != 1) : (mDueTree.size() == 1)))))) &amp;&amp; mDueTree.get(0).getDid() == 1)) || getCol().isEmpty()) : ((ListenerUtil.mutListener.listen(8046) ? ((ListenerUtil.mutListener.listen(8045) ? (mDueTree.size() &gt;= 1) : (ListenerUtil.mutListener.listen(8044) ? (mDueTree.size() &lt;= 1) : (ListenerUtil.mutListener.listen(8043) ? (mDueTree.size() &gt; 1) : (ListenerUtil.mutListener.listen(8042) ? (mDueTree.size() &lt; 1) : (ListenerUtil.mutListener.listen(8041) ? (mDueTree.size() != 1) : (mDueTree.size() == 1)))))) || mDueTree.get(0).getDid() == 1) : ((ListenerUtil.mutListener.listen(8045) ? (mDueTree.size() &gt;= 1) : (ListenerUtil.mutListener.listen(8044) ? (mDueTree.size() &lt;= 1) : (ListenerUtil.mutListener.listen(8043) ? (mDueTree.size() &gt; 1) : (ListenerUtil.mutListener.listen(8042) ? (mDueTree.size() &lt; 1) : (ListenerUtil.mutListener.listen(8041) ? (mDueTree.size() != 1) : (mDueTree.size() == 1)))))) &amp;&amp; mDueTree.get(0).getDid() == 1)) &amp;&amp; getCol().isEmpty()));</span>
<span class="nc bnc" id="L3509" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8067)) {</span>
<span class="nc bnc" id="L3510" title="All 2 branches missed.">            if (animationDisabled()) {</span>
<span class="nc bnc" id="L3511" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8065)) {</span>
<span class="nc bnc" id="L3512" title="All 2 branches missed.">                    mDeckPickerContent.setVisibility(isEmpty ? View.GONE : View.VISIBLE);</span>
                }
<span class="nc bnc" id="L3514" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8066)) {</span>
<span class="nc bnc" id="L3515" title="All 2 branches missed.">                    mNoDecksPlaceholder.setVisibility(isEmpty ? View.VISIBLE : View.GONE);</span>
                }
            } else {
<span class="nc" id="L3518">                float translation = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 8, getResources().getDisplayMetrics());</span>
<span class="nc bnc" id="L3519" title="All 2 branches missed.">                boolean decksListShown = mDeckPickerContent.getVisibility() == View.VISIBLE;</span>
<span class="nc bnc" id="L3520" title="All 2 branches missed.">                boolean placeholderShown = mNoDecksPlaceholder.getVisibility() == View.VISIBLE;</span>
<span class="nc bnc" id="L3521" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8064)) {</span>
<span class="nc bnc" id="L3522" title="All 2 branches missed.">                    if (isEmpty) {</span>
<span class="nc bnc" id="L3523" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8057)) {</span>
<span class="nc bnc" id="L3524" title="All 2 branches missed.">                            if (decksListShown) {</span>
<span class="nc bnc" id="L3525" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8056)) {</span>
<span class="nc" id="L3526">                                    fadeOut(mDeckPickerContent, mShortAnimDuration, translation);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L3530" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8063)) {</span>
<span class="nc bnc" id="L3531" title="All 2 branches missed.">                            if (!placeholderShown) {</span>
<span class="nc bnc" id="L3532" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8062)) {</span>
<span class="nc bnc" id="L3533" title="All 10 branches missed.">                                    fadeIn(mNoDecksPlaceholder, mShortAnimDuration, translation).setStartDelay(decksListShown ? (ListenerUtil.mutListener.listen(8061) ? (mShortAnimDuration % 2) : (ListenerUtil.mutListener.listen(8060) ? (mShortAnimDuration / 2) : (ListenerUtil.mutListener.listen(8059) ? (mShortAnimDuration - 2) : (ListenerUtil.mutListener.listen(8058) ? (mShortAnimDuration + 2) : (mShortAnimDuration * 2))))) : 0);</span>
                                }
                            }
                        }
                    } else {
<span class="nc bnc" id="L3538" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8053)) {</span>
<span class="nc bnc" id="L3539" title="All 2 branches missed.">                            if (!decksListShown) {</span>
<span class="nc bnc" id="L3540" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8052)) {</span>
<span class="nc bnc" id="L3541" title="All 10 branches missed.">                                    fadeIn(mDeckPickerContent, mShortAnimDuration, translation).setStartDelay(placeholderShown ? (ListenerUtil.mutListener.listen(8051) ? (mShortAnimDuration % 2) : (ListenerUtil.mutListener.listen(8050) ? (mShortAnimDuration / 2) : (ListenerUtil.mutListener.listen(8049) ? (mShortAnimDuration - 2) : (ListenerUtil.mutListener.listen(8048) ? (mShortAnimDuration + 2) : (mShortAnimDuration * 2))))) : 0);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L3545" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8055)) {</span>
<span class="nc bnc" id="L3546" title="All 2 branches missed.">                            if (placeholderShown) {</span>
<span class="nc bnc" id="L3547" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(8054)) {</span>
<span class="nc" id="L3548">                                    fadeOut(mNoDecksPlaceholder, mShortAnimDuration, translation);</span>
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L3556" title="All 2 branches missed.">        CharSequence currentFilter = mToolbarSearchView != null ? mToolbarSearchView.getQuery() : null;</span>
<span class="nc bnc" id="L3557" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8072)) {</span>
<span class="nc bnc" id="L3558" title="All 2 branches missed.">            if (isEmpty) {</span>
<span class="nc bnc" id="L3559" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8069)) {</span>
<span class="nc bnc" id="L3560" title="All 2 branches missed.">                    if (getSupportActionBar() != null) {</span>
<span class="nc bnc" id="L3561" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8068)) {</span>
<span class="nc" id="L3562">                            getSupportActionBar().setSubtitle(null);</span>
                        }
                    }
                }
<span class="nc bnc" id="L3566" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8071)) {</span>
<span class="nc bnc" id="L3567" title="All 2 branches missed.">                    if (mToolbarSearchView != null) {</span>
<span class="nc bnc" id="L3568" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8070)) {</span>
<span class="nc" id="L3569">                            mDeckListAdapter.getFilter().filter(currentFilter);</span>
                        }
                    }
                }
                // We're done here
<span class="nc" id="L3574">                return;</span>
            }
        }
<span class="nc bnc" id="L3577" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8073)) {</span>
<span class="nc" id="L3578">            mDeckListAdapter.buildDeckList(mDueTree, getCol(), currentFilter);</span>
        }
        // Set the &quot;x due in y minutes&quot; subtitle
        try {
<span class="nc" id="L3582">            Integer eta = mDeckListAdapter.getEta();</span>
<span class="nc" id="L3583">            Integer due = mDeckListAdapter.getDue();</span>
<span class="nc" id="L3584">            Resources res = getResources();</span>
<span class="nc bnc" id="L3585" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8090)) {</span>
<span class="nc bnc" id="L3586" title="All 2 branches missed.">                if (getCol().cardCount() != -1) {</span>
<span class="nc" id="L3587">                    String time = &quot;-&quot;;</span>
<span class="nc bnc" id="L3588" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8086)) {</span>
<span class="nc bnc" id="L3589" title="All 50 branches missed.">                        if ((ListenerUtil.mutListener.listen(8080) ? ((ListenerUtil.mutListener.listen(8079) ? (eta &gt;= -1) : (ListenerUtil.mutListener.listen(8078) ? (eta &lt;= -1) : (ListenerUtil.mutListener.listen(8077) ? (eta &gt; -1) : (ListenerUtil.mutListener.listen(8076) ? (eta &lt; -1) : (ListenerUtil.mutListener.listen(8075) ? (eta == -1) : (eta != -1)))))) || eta != null) : ((ListenerUtil.mutListener.listen(8079) ? (eta &gt;= -1) : (ListenerUtil.mutListener.listen(8078) ? (eta &lt;= -1) : (ListenerUtil.mutListener.listen(8077) ? (eta &gt; -1) : (ListenerUtil.mutListener.listen(8076) ? (eta &lt; -1) : (ListenerUtil.mutListener.listen(8075) ? (eta == -1) : (eta != -1)))))) &amp;&amp; eta != null))) {</span>
<span class="nc bnc" id="L3590" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8085)) {</span>
<span class="nc bnc" id="L3591" title="All 8 branches missed.">                                time = Utils.timeQuantityTopDeckPicker(AnkiDroidApp.getInstance(), (ListenerUtil.mutListener.listen(8084) ? (eta % 60) : (ListenerUtil.mutListener.listen(8083) ? (eta / 60) : (ListenerUtil.mutListener.listen(8082) ? (eta - 60) : (ListenerUtil.mutListener.listen(8081) ? (eta + 60) : (eta * 60))))));</span>
                            }
                        }
                    }
<span class="nc bnc" id="L3595" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8089)) {</span>
<span class="nc bnc" id="L3596" title="All 10 branches missed.">                        if ((ListenerUtil.mutListener.listen(8087) ? (due != null || getSupportActionBar() != null) : (due != null &amp;&amp; getSupportActionBar() != null))) {</span>
<span class="nc bnc" id="L3597" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8088)) {</span>
<span class="nc" id="L3598">                                getSupportActionBar().setSubtitle(res.getQuantityString(R.plurals.deckpicker_title, due, due, time));</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L3604">        } catch (RuntimeException e) {</span>
<span class="nc bnc" id="L3605" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8074)) {</span>
<span class="nc" id="L3606">                Timber.e(e, &quot;RuntimeException setting time remaining&quot;);</span>
            }
<span class="nc" id="L3608">        }</span>
<span class="nc" id="L3609">        long current = getCol().getDecks().current().optLong(&quot;id&quot;);</span>
<span class="nc bnc" id="L3610" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8098)) {</span>
<span class="nc bnc" id="L3611" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8095) ? (mFocusedDeck &gt;= current) : (ListenerUtil.mutListener.listen(8094) ? (mFocusedDeck &lt;= current) : (ListenerUtil.mutListener.listen(8093) ? (mFocusedDeck &gt; current) : (ListenerUtil.mutListener.listen(8092) ? (mFocusedDeck &lt; current) : (ListenerUtil.mutListener.listen(8091) ? (mFocusedDeck == current) : (mFocusedDeck != current))))))) {</span>
<span class="nc bnc" id="L3612" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8096)) {</span>
<span class="nc" id="L3613">                    scrollDecklistToDeck(current);</span>
                }
<span class="nc bnc" id="L3615" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8097)) {</span>
<span class="nc" id="L3616">                    mFocusedDeck = current;</span>
                }
            }
        }
<span class="nc" id="L3620">    }</span>

    public static ViewPropertyAnimator fadeIn(View view, int duration) {
<span class="nc" id="L3623">        return fadeIn(view, duration, 0);</span>
    }

    public static ViewPropertyAnimator fadeIn(View view, int duration, float translation) {
<span class="nc" id="L3627">        return fadeIn(view, duration, translation, () -&gt; view.setVisibility(View.VISIBLE));</span>
    }

    public static ViewPropertyAnimator fadeIn(View view, int duration, float translation, Runnable startAction) {
<span class="nc bnc" id="L3631" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8099)) {</span>
<span class="nc" id="L3632">            view.setAlpha(0);</span>
        }
<span class="nc bnc" id="L3634" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8100)) {</span>
<span class="nc" id="L3635">            view.setTranslationY(translation);</span>
        }
<span class="nc" id="L3637">        return view.animate().alpha(1).translationY(0).setDuration(duration).withStartAction(startAction);</span>
    }

    public static ViewPropertyAnimator fadeOut(View view, int duration) {
<span class="nc" id="L3641">        return fadeOut(view, duration, 0);</span>
    }

    public static ViewPropertyAnimator fadeOut(View view, int duration, float translation) {
<span class="nc" id="L3645">        return fadeOut(view, duration, translation, () -&gt; view.setVisibility(View.GONE));</span>
    }

    public static ViewPropertyAnimator fadeOut(View view, int duration, float translation, Runnable endAction) {
<span class="nc bnc" id="L3649" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8101)) {</span>
<span class="nc" id="L3650">            view.setAlpha(1);</span>
        }
<span class="nc bnc" id="L3652" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8102)) {</span>
<span class="nc" id="L3653">            view.setTranslationY(0);</span>
        }
<span class="nc" id="L3655">        return view.animate().alpha(0).translationY(translation).setDuration(duration).withEndAction(endAction);</span>
    }

    // Callback to show study options for currently selected deck
    public void showContextMenuDeckOptions() {
<span class="nc bnc" id="L3660" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8107)) {</span>
            // open deck options
<span class="nc bnc" id="L3662" title="All 2 branches missed.">            if (getCol().getDecks().isDyn(mContextMenuDid)) {</span>
                // open cram options if filtered deck
<span class="nc" id="L3664">                Intent i = new Intent(DeckPicker.this, FilteredDeckOptions.class);</span>
<span class="nc bnc" id="L3665" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8105)) {</span>
<span class="nc" id="L3666">                    i.putExtra(&quot;did&quot;, mContextMenuDid);</span>
                }
<span class="nc bnc" id="L3668" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8106)) {</span>
<span class="nc" id="L3669">                    startActivityWithAnimation(i, FADE);</span>
                }
<span class="nc" id="L3671">            } else {</span>
                // otherwise open regular options
<span class="nc" id="L3673">                Intent i = new Intent(DeckPicker.this, DeckOptions.class);</span>
<span class="nc bnc" id="L3674" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8103)) {</span>
<span class="nc" id="L3675">                    i.putExtra(&quot;did&quot;, mContextMenuDid);</span>
                }
<span class="nc bnc" id="L3677" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8104)) {</span>
<span class="nc" id="L3678">                    startActivityWithAnimation(i, FADE);</span>
                }
            }
        }
<span class="nc" id="L3682">    }</span>

    // Callback to show export dialog for currently selected deck
    public void showContextMenuExportDialog() {
<span class="nc bnc" id="L3686" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8108)) {</span>
<span class="nc" id="L3687">            exportDeck(mContextMenuDid);</span>
        }
<span class="nc" id="L3689">    }</span>

    public void exportDeck(long did) {
<span class="nc" id="L3692">        String msg = getResources().getString(R.string.confirm_apkg_export_deck, getCol().getDecks().get(did).getString(&quot;name&quot;));</span>
<span class="nc bnc" id="L3693" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8109)) {</span>
<span class="nc" id="L3694">            showDialogFragment(ExportDialog.newInstance(msg, did));</span>
        }
<span class="nc" id="L3696">    }</span>

    public void createIcon(Context context) {
        // This code should not be reachable with lower versions
<span class="nc" id="L3700">        ShortcutInfoCompat shortcut = new ShortcutInfoCompat.Builder(this, Long.toString(mContextMenuDid)).setIntent(new Intent(context, Reviewer.class).setAction(Intent.ACTION_VIEW).putExtra(&quot;deckId&quot;, mContextMenuDid)).setIcon(IconCompat.createWithResource(context, R.mipmap.ic_launcher)).setShortLabel(Decks.basename(getCol().getDecks().name(mContextMenuDid))).setLongLabel(getCol().getDecks().name(mContextMenuDid)).build();</span>
        try {
<span class="nc" id="L3702">            boolean success = ShortcutManagerCompat.requestPinShortcut(this, shortcut, null);</span>
<span class="nc bnc" id="L3703" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8112)) {</span>
                // User report: &quot;success&quot; is true even if Vivo does not have permission
<span class="nc bnc" id="L3705" title="All 2 branches missed.">                if (AdaptionUtil.isVivo()) {</span>
<span class="nc bnc" id="L3706" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8111)) {</span>
<span class="nc" id="L3707">                        UIUtils.showThemedToast(this, getString(R.string.create_shortcut_error_vivo), false);</span>
                    }
                }
            }
<span class="nc bnc" id="L3711" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8114)) {</span>
<span class="nc bnc" id="L3712" title="All 2 branches missed.">                if (!success) {</span>
<span class="nc bnc" id="L3713" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8113)) {</span>
<span class="nc" id="L3714">                        UIUtils.showThemedToast(this, getString(R.string.create_shortcut_failed), false);</span>
                    }
                }
            }
<span class="nc" id="L3718">        } catch (Exception e) {</span>
<span class="nc bnc" id="L3719" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8110)) {</span>
<span class="nc" id="L3720">                UIUtils.showThemedToast(this, getString(R.string.create_shortcut_error, e.getLocalizedMessage()), false);</span>
            }
<span class="nc" id="L3722">        }</span>
<span class="nc" id="L3723">    }</span>

    // Callback to show dialog to rename the current deck
    public void renameDeckDialog() {
<span class="nc bnc" id="L3727" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8115)) {</span>
<span class="nc" id="L3728">            renameDeckDialog(mContextMenuDid);</span>
        }
<span class="nc" id="L3730">    }</span>

    public void renameDeckDialog(final long did) {
<span class="nc" id="L3733">        final Resources res = getResources();</span>
<span class="nc bnc" id="L3734" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8116)) {</span>
<span class="nc" id="L3735">            mDialogEditText = new FixedEditText(DeckPicker.this);</span>
        }
<span class="nc bnc" id="L3737" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8117)) {</span>
<span class="nc" id="L3738">            mDialogEditText.setSingleLine();</span>
        }
<span class="nc" id="L3740">        final String currentName = getCol().getDecks().name(did);</span>
<span class="nc bnc" id="L3741" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8118)) {</span>
<span class="nc" id="L3742">            mDialogEditText.setText(currentName);</span>
        }
<span class="nc bnc" id="L3744" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8119)) {</span>
<span class="nc" id="L3745">            mDialogEditText.setSelection(mDialogEditText.getText().length());</span>
        }
<span class="nc bnc" id="L3747" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8120)) {</span>
<span class="nc" id="L3748">            new MaterialDialog.Builder(DeckPicker.this).title(res.getString(R.string.rename_deck)).customView(mDialogEditText, true).positiveText(R.string.rename).negativeText(R.string.dialog_cancel).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L3749">                String newName = mDialogEditText.getText().toString().replaceAll(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span class="nc" id="L3750">                Collection col = getCol();</span>
<span class="nc bnc" id="L3751" title="All 2 branches missed.">                if (!Decks.isValidDeckName(newName)) {</span>
<span class="nc" id="L3752">                    Timber.i(&quot;renameDeckDialog not renaming deck to invalid name '%s'&quot;, newName);</span>
<span class="nc" id="L3753">                    UIUtils.showThemedToast(this, getString(R.string.invalid_deck_name), false);</span>
<span class="nc bnc" id="L3754" title="All 2 branches missed.">                } else if (!newName.equals(currentName)) {</span>
                    try {
<span class="nc" id="L3756">                        col.getDecks().rename(col.getDecks().get(did), newName);</span>
<span class="nc" id="L3757">                    } catch (DeckRenameException e) {</span>
                        // We get a localized string from libanki to explain the error
<span class="nc" id="L3759">                        UIUtils.showThemedToast(DeckPicker.this, e.getLocalizedMessage(res), false);</span>
<span class="nc" id="L3760">                    }</span>
                }
<span class="nc" id="L3762">                dismissAllDialogFragments();</span>
<span class="nc" id="L3763">                mDeckListAdapter.notifyDataSetChanged();</span>
<span class="nc" id="L3764">                updateDeckList();</span>
<span class="nc bnc" id="L3765" title="All 2 branches missed.">                if (mFragmented) {</span>
<span class="nc" id="L3766">                    loadStudyOptionsFragment(false);</span>
                }
<span class="nc" id="L3768">            }).onNegative((dialog, which) -&gt; dismissAllDialogFragments()).build().show();</span>
        }
<span class="nc" id="L3770">    }</span>

    // Callback to show confirm deck deletion dialog before deleting currently selected deck
    public void confirmDeckDeletion() {
<span class="nc bnc" id="L3774" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8121)) {</span>
<span class="nc" id="L3775">            confirmDeckDeletion(mContextMenuDid);</span>
        }
<span class="nc" id="L3777">    }</span>

    public void confirmDeckDeletion(long did) {
<span class="nc" id="L3780">        Resources res = getResources();</span>
<span class="nc bnc" id="L3781" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8122)) {</span>
<span class="nc bnc" id="L3782" title="All 2 branches missed.">            if (!colIsOpen()) {</span>
<span class="nc" id="L3783">                return;</span>
            }
        }
<span class="nc bnc" id="L3786" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8130)) {</span>
<span class="nc bnc" id="L3787" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8127) ? (did &gt;= 1) : (ListenerUtil.mutListener.listen(8126) ? (did &lt;= 1) : (ListenerUtil.mutListener.listen(8125) ? (did &gt; 1) : (ListenerUtil.mutListener.listen(8124) ? (did &lt; 1) : (ListenerUtil.mutListener.listen(8123) ? (did != 1) : (did == 1))))))) {</span>
<span class="nc bnc" id="L3788" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8128)) {</span>
<span class="nc" id="L3789">                    UIUtils.showSimpleSnackbar(this, R.string.delete_deck_default_deck, true);</span>
                }
<span class="nc bnc" id="L3791" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8129)) {</span>
<span class="nc" id="L3792">                    dismissAllDialogFragments();</span>
                }
<span class="nc" id="L3794">                return;</span>
            }
        }
        // Get the number of cards contained in this deck and its subdecks
<span class="nc" id="L3798">        TreeMap&lt;String, Long&gt; children = getCol().getDecks().children(did);</span>
<span class="nc bnc" id="L3799" title="All 8 branches missed.">        long[] dids = new long[(ListenerUtil.mutListener.listen(8134) ? (children.size() % 1) : (ListenerUtil.mutListener.listen(8133) ? (children.size() / 1) : (ListenerUtil.mutListener.listen(8132) ? (children.size() * 1) : (ListenerUtil.mutListener.listen(8131) ? (children.size() - 1) : (children.size() + 1)))))];</span>
<span class="nc bnc" id="L3800" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8135)) {</span>
<span class="nc" id="L3801">            dids[0] = did;</span>
        }
<span class="nc" id="L3803">        int i = 1;</span>
<span class="nc bnc" id="L3804" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8137)) {</span>
            {
<span class="nc" id="L3806">                long _loopCounter133 = 0;</span>
<span class="nc bnc" id="L3807" title="All 2 branches missed.">                for (Long l : children.values()) {</span>
<span class="nc" id="L3808">                    ListenerUtil.loopListener.listen(&quot;_loopCounter133&quot;, ++_loopCounter133);</span>
<span class="nc bnc" id="L3809" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8136)) {</span>
<span class="nc" id="L3810">                        dids[i++] = l;</span>
                    }
<span class="nc" id="L3812">                }</span>
            }
        }
<span class="nc" id="L3815">        String ids = Utils.ids2str(dids);</span>
<span class="nc" id="L3816">        int cnt = getCol().getDb().queryScalar(&quot;select count() from cards where did in &quot; + ids + &quot; or odid in &quot; + ids);</span>
<span class="nc bnc" id="L3817" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8145)) {</span>
            // Delete empty decks without warning
<span class="nc bnc" id="L3819" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8142) ? (cnt &gt;= 0) : (ListenerUtil.mutListener.listen(8141) ? (cnt &lt;= 0) : (ListenerUtil.mutListener.listen(8140) ? (cnt &gt; 0) : (ListenerUtil.mutListener.listen(8139) ? (cnt &lt; 0) : (ListenerUtil.mutListener.listen(8138) ? (cnt != 0) : (cnt == 0))))))) {</span>
<span class="nc bnc" id="L3820" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8143)) {</span>
<span class="nc" id="L3821">                    deleteDeck(did);</span>
                }
<span class="nc bnc" id="L3823" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8144)) {</span>
<span class="nc" id="L3824">                    dismissAllDialogFragments();</span>
                }
<span class="nc" id="L3826">                return;</span>
            }
        }
        // Otherwise we show a warning and require confirmation
        String msg;
<span class="nc" id="L3831">        String deckName = &quot;'&quot; + getCol().getDecks().name(did) + &quot;'&quot;;</span>
<span class="nc" id="L3832">        boolean isDyn = getCol().getDecks().isDyn(did);</span>
<span class="nc bnc" id="L3833" title="All 2 branches missed.">        if (isDyn) {</span>
<span class="nc" id="L3834">            msg = res.getString(R.string.delete_cram_deck_message, deckName);</span>
        } else {
<span class="nc" id="L3836">            msg = res.getQuantityString(R.plurals.delete_deck_message, cnt, deckName, cnt);</span>
        }
<span class="nc bnc" id="L3838" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8146)) {</span>
<span class="nc" id="L3839">            showDialogFragment(DeckPickerConfirmDeleteDeckDialog.newInstance(msg));</span>
        }
<span class="nc" id="L3841">    }</span>

    // Callback to delete currently selected deck
    public void deleteContextMenuDeck() {
<span class="nc bnc" id="L3845" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8147)) {</span>
<span class="nc" id="L3846">            deleteDeck(mContextMenuDid);</span>
        }
<span class="nc" id="L3848">    }</span>

    public void deleteDeck(final long did) {
<span class="nc bnc" id="L3851" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8148)) {</span>
<span class="nc" id="L3852">            TaskManager.launchCollectionTask(new CollectionTask.DeleteDeck(did), deleteDeckListener(did));</span>
        }
<span class="nc" id="L3854">    }</span>

    private DeleteDeckListener deleteDeckListener(long did) {
<span class="nc" id="L3857">        return new DeleteDeckListener(did, this);</span>
    }

    private static class DeleteDeckListener extends TaskListenerWithContext&lt;DeckPicker, Void, int[]&gt; {

        private final long did;

        // Flag to indicate if the deck being deleted is the current deck.
        private boolean removingCurrent;

        public DeleteDeckListener(long did, DeckPicker deckPicker) {
<span class="nc" id="L3868">            super(deckPicker);</span>
<span class="nc" id="L3869">            this.did = did;</span>
<span class="nc" id="L3870">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L3874" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8149)) {</span>
<span class="nc" id="L3875">                deckPicker.mProgressDialog = StyledProgressDialog.show(deckPicker, &quot;&quot;, deckPicker.getResources().getString(R.string.delete_deck), false);</span>
            }
<span class="nc bnc" id="L3877" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8151)) {</span>
<span class="nc bnc" id="L3878" title="All 2 branches missed.">                if (did == deckPicker.getCol().getDecks().current().optLong(&quot;id&quot;)) {</span>
<span class="nc bnc" id="L3879" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8150)) {</span>
<span class="nc" id="L3880">                        removingCurrent = true;</span>
                    }
                }
            }
<span class="nc" id="L3884">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, @Nullable int[] v) {
<span class="nc bnc" id="L3888" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8156)) {</span>
                // new current deck. Otherwise we just update the list normally.
<span class="nc bnc" id="L3890" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8152) ? (deckPicker.mFragmented || removingCurrent) : (deckPicker.mFragmented &amp;&amp; removingCurrent))) {</span>
<span class="nc bnc" id="L3891" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8154)) {</span>
<span class="nc" id="L3892">                        deckPicker.updateDeckList();</span>
                    }
<span class="nc bnc" id="L3894" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8155)) {</span>
<span class="nc" id="L3895">                        deckPicker.openStudyOptions(false);</span>
                    }
                } else {
<span class="nc bnc" id="L3898" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8153)) {</span>
<span class="nc" id="L3899">                        deckPicker.updateDeckList();</span>
                    }
                }
            }
<span class="nc bnc" id="L3903" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8160)) {</span>
<span class="nc bnc" id="L3904" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8157) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
                    try {
<span class="nc bnc" id="L3906" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8159)) {</span>
<span class="nc" id="L3907">                            deckPicker.mProgressDialog.dismiss();</span>
                        }
<span class="nc" id="L3909">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L3910" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(8158)) {</span>
<span class="nc" id="L3911">                            Timber.e(e, &quot;onPostExecute - Exception dismissing dialog&quot;);</span>
                        }
<span class="nc" id="L3913">                    }</span>
                }
            }
<span class="nc" id="L3916">        }</span>
    }

    /**
     * Show progress bars and rebuild deck list on completion
     */
    private SimpleProgressListener simpleProgressListener() {
<span class="nc" id="L3923">        return new SimpleProgressListener(this);</span>
    }

    private static class SimpleProgressListener extends TaskListenerWithContext&lt;DeckPicker, Void, int[]&gt; {

        public SimpleProgressListener(DeckPicker deckPicker) {
<span class="nc" id="L3929">            super(deckPicker);</span>
<span class="nc" id="L3930">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L3934" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8161)) {</span>
<span class="nc" id="L3935">                deckPicker.showProgressBar();</span>
            }
<span class="nc" id="L3937">        }</span>

        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, int[] stats) {
<span class="nc bnc" id="L3941" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8162)) {</span>
<span class="nc" id="L3942">                deckPicker.updateDeckList();</span>
            }
<span class="nc bnc" id="L3944" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8164)) {</span>
<span class="nc bnc" id="L3945" title="All 2 branches missed.">                if (deckPicker.mFragmented) {</span>
<span class="nc bnc" id="L3946" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8163)) {</span>
<span class="nc" id="L3947">                        deckPicker.loadStudyOptionsFragment(false);</span>
                    }
                }
            }
<span class="nc" id="L3951">        }</span>
    }

    public void rebuildFiltered() {
<span class="nc bnc" id="L3955" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8165)) {</span>
<span class="nc" id="L3956">            getCol().getDecks().select(mContextMenuDid);</span>
        }
<span class="nc bnc" id="L3958" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8166)) {</span>
<span class="nc" id="L3959">            TaskManager.launchCollectionTask(new CollectionTask.RebuildCram(), simpleProgressListener());</span>
        }
<span class="nc" id="L3961">    }</span>

    public void emptyFiltered() {
<span class="nc bnc" id="L3964" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8167)) {</span>
<span class="nc" id="L3965">            getCol().getDecks().select(mContextMenuDid);</span>
        }
<span class="nc bnc" id="L3967" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8168)) {</span>
<span class="nc" id="L3968">            TaskManager.launchCollectionTask(new CollectionTask.EmptyCram(), simpleProgressListener());</span>
        }
<span class="nc" id="L3970">    }</span>

    @Override
    public void onAttachedToWindow() {
<span class="nc bnc" id="L3974" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8170)) {</span>
<span class="nc bnc" id="L3975" title="All 2 branches missed.">            if (!mFragmented) {</span>
<span class="nc" id="L3976">                Window window = getWindow();</span>
<span class="nc bnc" id="L3977" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8169)) {</span>
<span class="nc" id="L3978">                    window.setFormat(PixelFormat.RGBA_8888);</span>
                }
            }
        }
<span class="nc" id="L3982">    }</span>

    @Override
    public void onRequireDeckListUpdate() {
<span class="nc bnc" id="L3986" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8171)) {</span>
<span class="nc" id="L3987">            updateDeckList();</span>
        }
<span class="nc" id="L3989">    }</span>

    private void openReviewer() {
<span class="nc" id="L3992">        Intent reviewer = new Intent(this, Reviewer.class);</span>
<span class="nc bnc" id="L3993" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8172)) {</span>
<span class="nc" id="L3994">            startActivityForResultWithAnimation(reviewer, REQUEST_REVIEW, LEFT);</span>
        }
<span class="nc" id="L3996">    }</span>

    @Override
    public void onCreateCustomStudySession() {
<span class="nc bnc" id="L4000" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8173)) {</span>
<span class="nc" id="L4001">            updateDeckList();</span>
        }
<span class="nc bnc" id="L4003" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8174)) {</span>
<span class="nc" id="L4004">            openStudyOptions(false);</span>
        }
<span class="nc" id="L4006">    }</span>

    @Override
    public void onExtendStudyLimits() {
<span class="nc bnc" id="L4010" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8176)) {</span>
<span class="nc bnc" id="L4011" title="All 2 branches missed.">            if (mFragmented) {</span>
<span class="nc bnc" id="L4012" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(8175)) {</span>
<span class="nc" id="L4013">                    getFragment().refreshInterface(true);</span>
                }
            }
        }
<span class="nc bnc" id="L4017" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8177)) {</span>
<span class="nc" id="L4018">            updateDeckList();</span>
        }
<span class="nc" id="L4020">    }</span>

    public void handleEmptyCards() {
<span class="nc bnc" id="L4023" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8178)) {</span>
<span class="nc" id="L4024">            mEmptyCardTask = TaskManager.launchCollectionTask(new CollectionTask.FindEmptyCards(), handlerEmptyCardListener());</span>
        }
<span class="nc" id="L4026">    }</span>

    private HandleEmptyCardListener handlerEmptyCardListener() {
<span class="nc" id="L4029">        return new HandleEmptyCardListener(this);</span>
    }

    private static class HandleEmptyCardListener extends TaskListenerWithContext&lt;DeckPicker, Integer, List&lt;Long&gt;&gt; {

        private final int mNumberOfCards;

        private final int mOnePercent;

<span class="nc" id="L4038">        private int mIncreaseSinceLastUpdate = 0;</span>

        public HandleEmptyCardListener(DeckPicker deckPicker) {
<span class="nc" id="L4041">            super(deckPicker);</span>
<span class="nc" id="L4042">            mNumberOfCards = deckPicker.getCol().cardCount();</span>
<span class="nc bnc" id="L4043" title="All 8 branches missed.">            mOnePercent = (ListenerUtil.mutListener.listen(8182) ? (mNumberOfCards % 100) : (ListenerUtil.mutListener.listen(8181) ? (mNumberOfCards * 100) : (ListenerUtil.mutListener.listen(8180) ? (mNumberOfCards - 100) : (ListenerUtil.mutListener.listen(8179) ? (mNumberOfCards + 100) : (mNumberOfCards / 100)))));</span>
<span class="nc" id="L4044">        }</span>

        private void confirmCancel(@NonNull DeckPicker deckPicker, @NonNull CollectionTask&lt;?, ?, ?, ?&gt; task) {
<span class="nc bnc" id="L4047" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8183)) {</span>
<span class="nc" id="L4048">                new MaterialDialog.Builder(deckPicker).content(R.string.confirm_cancel).positiveText(deckPicker.getResources().getString(R.string.yes)).negativeText(deckPicker.getResources().getString(R.string.dialog_no)).onNegative((x, y) -&gt; actualOnPreExecute(deckPicker)).onPositive((x, y) -&gt; task.safeCancel()).show();</span>
            }
<span class="nc" id="L4050">        }</span>

        @Override
        public void actualOnPreExecute(@NonNull DeckPicker deckPicker) {
<span class="nc" id="L4054">            DialogInterface.OnCancelListener onCancel = (dialogInterface) -&gt; {</span>
<span class="nc" id="L4055">                CollectionTask&lt;?, ?, ?, ?&gt; emptyCardTask = deckPicker.mEmptyCardTask;</span>
<span class="nc bnc" id="L4056" title="All 2 branches missed.">                if (emptyCardTask != null) {</span>
<span class="nc" id="L4057">                    confirmCancel(deckPicker, emptyCardTask);</span>
                }
<span class="nc" id="L4059">            };</span>
<span class="nc bnc" id="L4060" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8184)) {</span>
<span class="nc" id="L4061">                deckPicker.mProgressDialog = new MaterialDialog.Builder(deckPicker).progress(false, mNumberOfCards).title(R.string.emtpy_cards_finding).cancelable(true).show();</span>
            }
<span class="nc bnc" id="L4063" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8185)) {</span>
<span class="nc" id="L4064">                deckPicker.mProgressDialog.setOnCancelListener(onCancel);</span>
            }
<span class="nc bnc" id="L4066" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8186)) {</span>
<span class="nc" id="L4067">                deckPicker.mProgressDialog.setCanceledOnTouchOutside(false);</span>
            }
<span class="nc" id="L4069">        }</span>

        @Override
        public void actualOnProgressUpdate(@NonNull DeckPicker deckPicker, @NonNull Integer progress) {
<span class="nc bnc" id="L4073" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8187)) {</span>
<span class="nc" id="L4074">                mIncreaseSinceLastUpdate += progress;</span>
            }
<span class="nc bnc" id="L4076" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8195)) {</span>
                // Increase each time at least a percent of card has been processed since last update
<span class="nc bnc" id="L4078" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(8192) ? (mIncreaseSinceLastUpdate &gt;= mOnePercent) : (ListenerUtil.mutListener.listen(8191) ? (mIncreaseSinceLastUpdate &lt;= mOnePercent) : (ListenerUtil.mutListener.listen(8190) ? (mIncreaseSinceLastUpdate &lt; mOnePercent) : (ListenerUtil.mutListener.listen(8189) ? (mIncreaseSinceLastUpdate != mOnePercent) : (ListenerUtil.mutListener.listen(8188) ? (mIncreaseSinceLastUpdate == mOnePercent) : (mIncreaseSinceLastUpdate &gt; mOnePercent))))))) {</span>
<span class="nc bnc" id="L4079" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8193)) {</span>
<span class="nc" id="L4080">                        deckPicker.mProgressDialog.incrementProgress(mIncreaseSinceLastUpdate);</span>
                    }
<span class="nc bnc" id="L4082" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8194)) {</span>
<span class="nc" id="L4083">                        mIncreaseSinceLastUpdate = 0;</span>
                    }
                }
            }
<span class="nc" id="L4087">        }</span>

        @Override
        public void actualOnCancelled(@NonNull DeckPicker deckPicker) {
<span class="nc bnc" id="L4091" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8196)) {</span>
<span class="nc" id="L4092">                deckPicker.mEmptyCardTask = null;</span>
            }
<span class="nc" id="L4094">        }</span>

        /**
         * @param deckPicker
         * @param cids Null if it is cancelled (in this case we should not have called this method) or a list of cids
         */
        @Override
        public void actualOnPostExecute(@NonNull DeckPicker deckPicker, @Nullable List&lt;Long&gt; cids) {
<span class="nc bnc" id="L4102" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8197)) {</span>
<span class="nc" id="L4103">                deckPicker.mEmptyCardTask = null;</span>
            }
<span class="nc bnc" id="L4105" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8198)) {</span>
<span class="nc bnc" id="L4106" title="All 2 branches missed.">                if (cids == null) {</span>
<span class="nc" id="L4107">                    return;</span>
                }
            }
<span class="nc bnc" id="L4110" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8208)) {</span>
<span class="nc bnc" id="L4111" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(8203) ? (cids.size() &gt;= 0) : (ListenerUtil.mutListener.listen(8202) ? (cids.size() &lt;= 0) : (ListenerUtil.mutListener.listen(8201) ? (cids.size() &gt; 0) : (ListenerUtil.mutListener.listen(8200) ? (cids.size() &lt; 0) : (ListenerUtil.mutListener.listen(8199) ? (cids.size() != 0) : (cids.size() == 0))))))) {</span>
<span class="nc bnc" id="L4112" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8207)) {</span>
<span class="nc" id="L4113">                        deckPicker.showSimpleMessageDialog(deckPicker.getResources().getString(R.string.empty_cards_none));</span>
                    }
                } else {
<span class="nc" id="L4116">                    String msg = String.format(deckPicker.getResources().getString(R.string.empty_cards_count), cids.size());</span>
<span class="nc" id="L4117">                    ConfirmationDialog dialog = new ConfirmationDialog();</span>
<span class="nc bnc" id="L4118" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8204)) {</span>
<span class="nc" id="L4119">                        dialog.setArgs(msg);</span>
                    }
<span class="nc" id="L4121">                    Runnable confirm = () -&gt; {</span>
<span class="nc" id="L4122">                        deckPicker.getCol().remCards(cids);</span>
<span class="nc" id="L4123">                        UIUtils.showSimpleSnackbar(deckPicker, String.format(deckPicker.getResources().getString(R.string.empty_cards_deleted), cids.size()), false);</span>
<span class="nc" id="L4124">                    };</span>
<span class="nc bnc" id="L4125" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8205)) {</span>
<span class="nc" id="L4126">                        dialog.setConfirm(confirm);</span>
                    }
<span class="nc bnc" id="L4128" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8206)) {</span>
<span class="nc" id="L4129">                        deckPicker.showDialogFragment(dialog);</span>
                    }
                }
            }
<span class="nc bnc" id="L4133" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8211)) {</span>
<span class="nc bnc" id="L4134" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8209) ? (deckPicker.mProgressDialog != null || deckPicker.mProgressDialog.isShowing()) : (deckPicker.mProgressDialog != null &amp;&amp; deckPicker.mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L4135" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8210)) {</span>
<span class="nc" id="L4136">                        deckPicker.mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc" id="L4140">        }</span>
    }

    public void createSubdeckDialog() {
<span class="nc bnc" id="L4144" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8212)) {</span>
<span class="nc" id="L4145">            createSubDeckDialog(mContextMenuDid);</span>
        }
<span class="nc" id="L4147">    }</span>

    private void createSubDeckDialog(long did) {
<span class="nc" id="L4150">        final Resources res = getResources();</span>
<span class="nc bnc" id="L4151" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8213)) {</span>
<span class="nc" id="L4152">            mDialogEditText = new FixedEditText(this);</span>
        }
<span class="nc bnc" id="L4154" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8214)) {</span>
<span class="nc" id="L4155">            mDialogEditText.setSingleLine();</span>
        }
<span class="nc bnc" id="L4157" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8215)) {</span>
<span class="nc" id="L4158">            mDialogEditText.setSelection(mDialogEditText.getText().length());</span>
        }
<span class="nc bnc" id="L4160" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(8216)) {</span>
<span class="nc" id="L4161">            new MaterialDialog.Builder(DeckPicker.this).title(R.string.create_subdeck).customView(mDialogEditText, true).positiveText(R.string.dialog_ok).negativeText(R.string.dialog_cancel).onPositive((dialog, which) -&gt; {</span>
<span class="nc" id="L4162">                String textValue = mDialogEditText.getText().toString();</span>
<span class="nc" id="L4163">                String newName = getCol().getDecks().getSubdeckName(did, textValue);</span>
<span class="nc bnc" id="L4164" title="All 2 branches missed.">                if (Decks.isValidDeckName(newName)) {</span>
<span class="nc" id="L4165">                    createNewDeck(newName);</span>
                } else {
<span class="nc" id="L4167">                    Timber.i(&quot;createSubDeckDialog - not creating invalid subdeck name '%s'&quot;, newName);</span>
<span class="nc" id="L4168">                    UIUtils.showThemedToast(this, getString(R.string.invalid_deck_name), false);</span>
                }
<span class="nc" id="L4170">                dismissAllDialogFragments();</span>
<span class="nc" id="L4171">                mDeckListAdapter.notifyDataSetChanged();</span>
<span class="nc" id="L4172">                updateDeckList();</span>
<span class="nc bnc" id="L4173" title="All 2 branches missed.">                if (mFragmented) {</span>
<span class="nc" id="L4174">                    loadStudyOptionsFragment(false);</span>
                }
<span class="nc" id="L4176">            }).onNegative((dialog, which) -&gt; dismissAllDialogFragments()).build().show();</span>
        }
<span class="nc" id="L4178">    }</span>

    @VisibleForTesting
<span class="nc" id="L4181">    class CheckDatabaseListener extends TaskListener&lt;String, Pair&lt;Boolean, Collection.CheckDatabaseResult&gt;&gt; {</span>

        @Override
        public void onPreExecute() {
<span class="nc bnc" id="L4185" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8217)) {</span>
<span class="nc" id="L4186">                mProgressDialog = StyledProgressDialog.show(DeckPicker.this, AnkiDroidApp.getAppResources().getString(R.string.app_name), getResources().getString(R.string.check_db_message), false);</span>
            }
<span class="nc" id="L4188">        }</span>

        @Override
        public void onPostExecute(Pair&lt;Boolean, Collection.CheckDatabaseResult&gt; result) {
<span class="nc bnc" id="L4192" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8220)) {</span>
<span class="nc bnc" id="L4193" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8218) ? (mProgressDialog != null || mProgressDialog.isShowing()) : (mProgressDialog != null &amp;&amp; mProgressDialog.isShowing()))) {</span>
<span class="nc bnc" id="L4194" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8219)) {</span>
<span class="nc" id="L4195">                        mProgressDialog.dismiss();</span>
                    }
                }
            }
<span class="nc bnc" id="L4199" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8222)) {</span>
<span class="nc bnc" id="L4200" title="All 2 branches missed.">                if (result == null) {</span>
<span class="nc bnc" id="L4201" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8221)) {</span>
<span class="nc" id="L4202">                        handleDbError();</span>
                    }
<span class="nc" id="L4204">                    return;</span>
                }
            }
<span class="nc" id="L4207">            Collection.CheckDatabaseResult databaseResult = result.second;</span>
<span class="nc bnc" id="L4208" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8226)) {</span>
<span class="nc bnc" id="L4209" title="All 2 branches missed.">                if (databaseResult == null) {</span>
<span class="nc bnc" id="L4210" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8225)) {</span>
<span class="nc bnc" id="L4211" title="All 2 branches missed.">                        if (result.first) {</span>
<span class="nc bnc" id="L4212" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8224)) {</span>
<span class="nc" id="L4213">                                Timber.w(&quot;Expected result data, got nothing&quot;);</span>
                            }
                        } else {
<span class="nc bnc" id="L4216" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8223)) {</span>
<span class="nc" id="L4217">                                handleDbError();</span>
                            }
                        }
                    }
<span class="nc" id="L4221">                    return;</span>
                }
            }
<span class="nc bnc" id="L4224" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8231)) {</span>
<span class="nc bnc" id="L4225" title="All 10 branches missed.">                if ((ListenerUtil.mutListener.listen(8227) ? (!result.first &amp;&amp; databaseResult.getFailed()) : (!result.first || databaseResult.getFailed()))) {</span>
<span class="nc bnc" id="L4226" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8230)) {</span>
<span class="nc bnc" id="L4227" title="All 2 branches missed.">                        if (databaseResult.getDatabaseLocked()) {</span>
<span class="nc bnc" id="L4228" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8229)) {</span>
<span class="nc" id="L4229">                                handleDbLocked();</span>
                            }
                        } else {
<span class="nc bnc" id="L4232" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(8228)) {</span>
<span class="nc" id="L4233">                                handleDbError();</span>
                            }
                        }
                    }
<span class="nc" id="L4237">                    return;</span>
                }
            }
<span class="nc" id="L4240">            int count = databaseResult.getCardsWithFixedHomeDeckCount();</span>
<span class="nc bnc" id="L4241" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8238)) {</span>
<span class="nc bnc" id="L4242" title="All 22 branches missed.">                if ((ListenerUtil.mutListener.listen(8236) ? (count &gt;= 0) : (ListenerUtil.mutListener.listen(8235) ? (count &lt;= 0) : (ListenerUtil.mutListener.listen(8234) ? (count &gt; 0) : (ListenerUtil.mutListener.listen(8233) ? (count &lt; 0) : (ListenerUtil.mutListener.listen(8232) ? (count == 0) : (count != 0))))))) {</span>
<span class="nc" id="L4243">                    String message = getResources().getString(R.string.integrity_check_fixed_no_home_deck, count);</span>
<span class="nc bnc" id="L4244" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(8237)) {</span>
<span class="nc" id="L4245">                        UIUtils.showThemedToast(DeckPicker.this, message, false);</span>
                    }
                }
            }
            String msg;
<span class="nc bnc" id="L4250" title="All 8 branches missed.">            long shrunkInMb = Math.round((ListenerUtil.mutListener.listen(8242) ? (databaseResult.getSizeChangeInKb() % 1024.0) : (ListenerUtil.mutListener.listen(8241) ? (databaseResult.getSizeChangeInKb() * 1024.0) : (ListenerUtil.mutListener.listen(8240) ? (databaseResult.getSizeChangeInKb() - 1024.0) : (ListenerUtil.mutListener.listen(8239) ? (databaseResult.getSizeChangeInKb() + 1024.0) : (databaseResult.getSizeChangeInKb() / 1024.0))))));</span>
<span class="nc bnc" id="L4251" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(8247) ? (shrunkInMb &gt;= 0.0) : (ListenerUtil.mutListener.listen(8246) ? (shrunkInMb &lt;= 0.0) : (ListenerUtil.mutListener.listen(8245) ? (shrunkInMb &lt; 0.0) : (ListenerUtil.mutListener.listen(8244) ? (shrunkInMb != 0.0) : (ListenerUtil.mutListener.listen(8243) ? (shrunkInMb == 0.0) : (shrunkInMb &gt; 0.0))))))) {</span>
<span class="nc" id="L4252">                msg = getResources().getString(R.string.check_db_acknowledge_shrunk, (int) shrunkInMb);</span>
            } else {
<span class="nc" id="L4254">                msg = getResources().getString(R.string.check_db_acknowledge);</span>
            }
<span class="nc bnc" id="L4256" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8248)) {</span>
                // Show result of database check and restart the app
<span class="nc" id="L4258">                showSimpleMessageDialog(msg, true);</span>
            }
<span class="nc" id="L4260">        }</span>

        @Override
        public void onProgressUpdate(String message) {
<span class="nc bnc" id="L4264" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(8249)) {</span>
<span class="nc" id="L4265">                mProgressDialog.setContent(message);</span>
            }
<span class="nc" id="L4267">        }</span>
    }

<span class="nc" id="L4270">    private enum DeckSelectionType {</span>

        /**
         * Show study options if fragmented, otherwise, review
         */
<span class="nc" id="L4275">        DEFAULT,</span>
        /**
         * Always show study options (if the deck counts are clicked)
         */
<span class="nc" id="L4279">        SHOW_STUDY_OPTIONS,</span>
        /**
         * Always open reviewer (keyboard shortcut)
         */
<span class="nc" id="L4283">        SKIP_STUDY_OPTIONS</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>