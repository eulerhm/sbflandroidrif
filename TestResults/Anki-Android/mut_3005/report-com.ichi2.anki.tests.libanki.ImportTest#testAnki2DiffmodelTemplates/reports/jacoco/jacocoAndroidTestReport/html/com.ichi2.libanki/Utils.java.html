<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Utils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AnkiDroid</a> &gt; <a href="index.source.html" class="el_package">com.ichi2.libanki</a> &gt; <span class="el_source">Utils.java</span></div><h1>Utils.java</h1><pre class="source lang-java linenums">/**
 * *************************************************************************************
 *  Copyright (c) 2009 Daniel Sv√§rd &lt;daniel.svard@gmail.com&gt;                             *
 *  Copyright (c) 2009 Edu Zamora &lt;edu.zasu@gmail.com&gt;                                   *
 *  Copyright (c) 2011 Norbert Nagold &lt;norbert.nagold@gmail.com&gt;                         *
 *  Copyright (c) 2012 Kostas Spyropoulos &lt;inigo.aldana@gmail.com&gt;                       *
 *                                                                                       *
 *  This program is free software; you can redistribute it and/or modify it under        *
 *  the terms of the GNU General Public License as published by the Free Software        *
 *  Foundation; either version 3 of the License, or (at your option) any later           *
 *  version.                                                                             *
 *                                                                                       *
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY      *
 *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      *
 *  PARTICULAR PURPOSE. See the GNU General Public License for more details.             *
 *                                                                                       *
 *  You should have received a copy of the GNU General Public License along with         *
 *  this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                           *
 * **************************************************************************************
 */
package com.ichi2.libanki;

import android.annotation.SuppressLint;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.content.res.Resources;
import android.net.Uri;
import android.text.Spanned;
import androidx.annotation.NonNull;
import android.os.StatFs;
import android.text.TextUtils;
import android.util.Pair;
import com.ichi2.anki.AnkiFont;
import com.ichi2.anki.CollectionHelper;
import com.ichi2.anki.R;
import com.ichi2.compat.CompatHelper;
import com.ichi2.utils.ImportUtils;
import com.ichi2.utils.JSONArray;
import com.ichi2.utils.JSONException;
import com.ichi2.utils.JSONObject;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.math.BigInteger;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.text.Normalizer;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Random;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;
import org.apache.commons.compress.archivers.zip.ZipFile;
import androidx.annotation.Nullable;
import androidx.core.text.HtmlCompat;
import timber.log.Timber;
import static com.ichi2.libanki.Consts.FIELD_SEPARATOR;
import static com.ichi2.utils.CollectionUtils.addAll;
import br.ufmg.labsoft.mutvariants.listeners.ListenerUtil;

@SuppressWarnings({ &quot;PMD.AvoidThrowingRawExceptionTypes&quot;, &quot;PMD.AvoidReassigningParameters&quot;, &quot;PMD.MethodNamingConventions&quot;, &quot;PMD.FieldDeclarationsShouldBeAtStartOfClass&quot; })
public class Utils {

    // Used to format doubles with English's decimal separator system
<span class="fc" id="L82">    public static final Locale ENGLISH_LOCALE = new Locale(&quot;en_US&quot;);</span>

    public static final int CHUNK_SIZE = 32768;

    // seconds
    private static final long TIME_MINUTE_LONG = 60;

    private static final long TIME_HOUR_LONG = 60 * TIME_MINUTE_LONG;

    private static final long TIME_DAY_LONG = 24 * TIME_HOUR_LONG;

    // seconds
    private static final double TIME_MINUTE = 60.0;

    private static final double TIME_HOUR = 60.0 * TIME_MINUTE;

    private static final double TIME_DAY = 24.0 * TIME_HOUR;

    private static final double TIME_MONTH = 30.0 * TIME_DAY;

    private static final double TIME_YEAR = 12.0 * TIME_MONTH;

    // List of all extensions we accept as font files.
<span class="fc" id="L105">    private static final String[] FONT_FILE_EXTENSIONS = new String[] { &quot;.ttf&quot;, &quot;.ttc&quot;, &quot;.otf&quot; };</span>

    /* Prevent class from being instantiated */
    private Utils() {
    }

    // Regex pattern used in removing tags from text before diff
<span class="fc" id="L112">    private static final Pattern stylePattern = Pattern.compile(&quot;(?si)&lt;style.*?&gt;.*?&lt;/style&gt;&quot;);</span>

<span class="fc" id="L114">    private static final Pattern scriptPattern = Pattern.compile(&quot;(?si)&lt;script.*?&gt;.*?&lt;/script&gt;&quot;);</span>

<span class="fc" id="L116">    private static final Pattern tagPattern = Pattern.compile(&quot;&lt;.*?&gt;&quot;);</span>

<span class="fc" id="L118">    private static final Pattern imgPattern = Pattern.compile(&quot;(?i)&lt;img[^&gt;]+src=[\&quot;']?([^\&quot;'&gt;]+)[\&quot;']?[^&gt;]*&gt;&quot;);</span>

<span class="fc" id="L120">    private static final Pattern soundPattern = Pattern.compile(&quot;(?i)\\[sound:([^]]+)]&quot;);</span>

<span class="fc" id="L122">    private static final Pattern htmlEntitiesPattern = Pattern.compile(&quot;&amp;#?\\w+;&quot;);</span>

    private static final String ALL_CHARACTERS = &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;;

    private static final String BASE91_EXTRA_CHARS = &quot;!#$%&amp;()*+,-./:;&lt;=&gt;?@[]^_`{|}~&quot;;

    private static final int FILE_COPY_BUFFER_SIZE = 1024 * 32;

    /**
     * Return a string representing a time quantity
     *
     * Equivalent to Anki's anki/utils.py's shortTimeFmt, applied to a number.
     * I.e. equivalent to Anki's anki/utils.py's fmtTimeSpan, with the parameter short=True.
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The time quantity string. Something like &quot;3 s&quot; or &quot;1.7
     * yr&quot;. Only months and year have a number after the decimal.
     */
    public static String timeQuantityTopDeckPicker(Context context, long time_s) {
<span class="nc" id="L142">        Resources res = context.getResources();</span>
        // hard-coded. See also 01-core.xml
<span class="nc bnc" id="L144" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(24147) ? (Math.abs(time_s) &gt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24146) ? (Math.abs(time_s) &lt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24145) ? (Math.abs(time_s) &gt; TIME_MINUTE) : (ListenerUtil.mutListener.listen(24144) ? (Math.abs(time_s) != TIME_MINUTE) : (ListenerUtil.mutListener.listen(24143) ? (Math.abs(time_s) == TIME_MINUTE) : (Math.abs(time_s) &lt; TIME_MINUTE))))))) {</span>
<span class="nc" id="L145">            return res.getString(R.string.time_quantity_seconds, time_s);</span>
<span class="nc bnc" id="L146" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24152) ? (Math.abs(time_s) &gt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24151) ? (Math.abs(time_s) &lt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24150) ? (Math.abs(time_s) &gt; TIME_HOUR) : (ListenerUtil.mutListener.listen(24149) ? (Math.abs(time_s) != TIME_HOUR) : (ListenerUtil.mutListener.listen(24148) ? (Math.abs(time_s) == TIME_HOUR) : (Math.abs(time_s) &lt; TIME_HOUR))))))) {</span>
<span class="nc bnc" id="L147" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_minutes, (int) Math.round((ListenerUtil.mutListener.listen(24203) ? (time_s % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24202) ? (time_s * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24201) ? (time_s - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24200) ? (time_s + TIME_MINUTE) : (time_s / TIME_MINUTE)))))));</span>
<span class="nc bnc" id="L148" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24157) ? (Math.abs(time_s) &gt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24156) ? (Math.abs(time_s) &lt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24155) ? (Math.abs(time_s) &gt; TIME_DAY) : (ListenerUtil.mutListener.listen(24154) ? (Math.abs(time_s) != TIME_DAY) : (ListenerUtil.mutListener.listen(24153) ? (Math.abs(time_s) == TIME_DAY) : (Math.abs(time_s) &lt; TIME_DAY))))))) {</span>
<span class="nc bnc" id="L149" title="All 56 branches missed.">            return res.getString(R.string.time_quantity_hours_minutes, (int) Math.floor((ListenerUtil.mutListener.listen(24191) ? (time_s % TIME_HOUR) : (ListenerUtil.mutListener.listen(24190) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24189) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24188) ? (time_s + TIME_HOUR) : (time_s / TIME_HOUR)))))), (int) Math.round((ListenerUtil.mutListener.listen(24199) ? (((ListenerUtil.mutListener.listen(24195) ? (time_s / TIME_HOUR) : (ListenerUtil.mutListener.listen(24194) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24193) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24192) ? (time_s + TIME_HOUR) : (time_s % TIME_HOUR)))))) % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24198) ? (((ListenerUtil.mutListener.listen(24195) ? (time_s / TIME_HOUR) : (ListenerUtil.mutListener.listen(24194) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24193) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24192) ? (time_s + TIME_HOUR) : (time_s % TIME_HOUR)))))) * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24197) ? (((ListenerUtil.mutListener.listen(24195) ? (time_s / TIME_HOUR) : (ListenerUtil.mutListener.listen(24194) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24193) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24192) ? (time_s + TIME_HOUR) : (time_s % TIME_HOUR)))))) - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24196) ? (((ListenerUtil.mutListener.listen(24195) ? (time_s / TIME_HOUR) : (ListenerUtil.mutListener.listen(24194) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24193) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24192) ? (time_s + TIME_HOUR) : (time_s % TIME_HOUR)))))) + TIME_MINUTE) : (((ListenerUtil.mutListener.listen(24195) ? (time_s / TIME_HOUR) : (ListenerUtil.mutListener.listen(24194) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24193) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24192) ? (time_s + TIME_HOUR) : (time_s % TIME_HOUR)))))) / TIME_MINUTE)))))));</span>
<span class="nc bnc" id="L150" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24162) ? (Math.abs(time_s) &gt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24161) ? (Math.abs(time_s) &lt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24160) ? (Math.abs(time_s) &gt; TIME_MONTH) : (ListenerUtil.mutListener.listen(24159) ? (Math.abs(time_s) != TIME_MONTH) : (ListenerUtil.mutListener.listen(24158) ? (Math.abs(time_s) == TIME_MONTH) : (Math.abs(time_s) &lt; TIME_MONTH))))))) {</span>
<span class="nc bnc" id="L151" title="All 56 branches missed.">            return res.getString(R.string.time_quantity_days_hours, (int) Math.floor((ListenerUtil.mutListener.listen(24179) ? (time_s % TIME_DAY) : (ListenerUtil.mutListener.listen(24178) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24177) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24176) ? (time_s + TIME_DAY) : (time_s / TIME_DAY)))))), (int) Math.round((ListenerUtil.mutListener.listen(24187) ? (((ListenerUtil.mutListener.listen(24183) ? (time_s / TIME_DAY) : (ListenerUtil.mutListener.listen(24182) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24181) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24180) ? (time_s + TIME_DAY) : (time_s % TIME_DAY)))))) % TIME_HOUR) : (ListenerUtil.mutListener.listen(24186) ? (((ListenerUtil.mutListener.listen(24183) ? (time_s / TIME_DAY) : (ListenerUtil.mutListener.listen(24182) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24181) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24180) ? (time_s + TIME_DAY) : (time_s % TIME_DAY)))))) * TIME_HOUR) : (ListenerUtil.mutListener.listen(24185) ? (((ListenerUtil.mutListener.listen(24183) ? (time_s / TIME_DAY) : (ListenerUtil.mutListener.listen(24182) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24181) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24180) ? (time_s + TIME_DAY) : (time_s % TIME_DAY)))))) - TIME_HOUR) : (ListenerUtil.mutListener.listen(24184) ? (((ListenerUtil.mutListener.listen(24183) ? (time_s / TIME_DAY) : (ListenerUtil.mutListener.listen(24182) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24181) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24180) ? (time_s + TIME_DAY) : (time_s % TIME_DAY)))))) + TIME_HOUR) : (((ListenerUtil.mutListener.listen(24183) ? (time_s / TIME_DAY) : (ListenerUtil.mutListener.listen(24182) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24181) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24180) ? (time_s + TIME_DAY) : (time_s % TIME_DAY)))))) / TIME_HOUR)))))));</span>
<span class="nc bnc" id="L152" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24167) ? (Math.abs(time_s) &gt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24166) ? (Math.abs(time_s) &lt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24165) ? (Math.abs(time_s) &gt; TIME_YEAR) : (ListenerUtil.mutListener.listen(24164) ? (Math.abs(time_s) != TIME_YEAR) : (ListenerUtil.mutListener.listen(24163) ? (Math.abs(time_s) == TIME_YEAR) : (Math.abs(time_s) &lt; TIME_YEAR))))))) {</span>
<span class="nc bnc" id="L153" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_months, (ListenerUtil.mutListener.listen(24175) ? (time_s % TIME_MONTH) : (ListenerUtil.mutListener.listen(24174) ? (time_s * TIME_MONTH) : (ListenerUtil.mutListener.listen(24173) ? (time_s - TIME_MONTH) : (ListenerUtil.mutListener.listen(24172) ? (time_s + TIME_MONTH) : (time_s / TIME_MONTH))))));</span>
        } else {
<span class="nc bnc" id="L155" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_years, (ListenerUtil.mutListener.listen(24171) ? (time_s % TIME_YEAR) : (ListenerUtil.mutListener.listen(24170) ? (time_s * TIME_YEAR) : (ListenerUtil.mutListener.listen(24169) ? (time_s - TIME_YEAR) : (ListenerUtil.mutListener.listen(24168) ? (time_s + TIME_YEAR) : (time_s / TIME_YEAR))))));</span>
        }
    }

    /**
     * Return a string representing a time quantity
     *
     * Equivalent to Anki's anki/utils.py's shortTimeFmt, applied to a number.
     * I.e. equivalent to Anki's anki/utils.py's fmtTimeSpan, with the parameter short=True.
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The time quantity string. Something like &quot;3 s&quot; or &quot;1.7
     * yr&quot;. Only months and year have a number after the decimal.
     */
    public static String timeQuantityNextIvl(Context context, long time_s) {
<span class="nc" id="L171">        Resources res = context.getResources();</span>
        // hard-coded. See also 01-core.xml
<span class="nc bnc" id="L173" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(24208) ? (Math.abs(time_s) &gt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24207) ? (Math.abs(time_s) &lt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24206) ? (Math.abs(time_s) &gt; TIME_MINUTE) : (ListenerUtil.mutListener.listen(24205) ? (Math.abs(time_s) != TIME_MINUTE) : (ListenerUtil.mutListener.listen(24204) ? (Math.abs(time_s) == TIME_MINUTE) : (Math.abs(time_s) &lt; TIME_MINUTE))))))) {</span>
<span class="nc" id="L174">            return res.getString(R.string.time_quantity_seconds, time_s);</span>
<span class="nc bnc" id="L175" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24213) ? (Math.abs(time_s) &gt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24212) ? (Math.abs(time_s) &lt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24211) ? (Math.abs(time_s) &gt; TIME_HOUR) : (ListenerUtil.mutListener.listen(24210) ? (Math.abs(time_s) != TIME_HOUR) : (ListenerUtil.mutListener.listen(24209) ? (Math.abs(time_s) == TIME_HOUR) : (Math.abs(time_s) &lt; TIME_HOUR))))))) {</span>
<span class="nc bnc" id="L176" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_minutes, (int) Math.round((ListenerUtil.mutListener.listen(24248) ? (time_s % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24247) ? (time_s * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24246) ? (time_s - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24245) ? (time_s + TIME_MINUTE) : (time_s / TIME_MINUTE)))))));</span>
<span class="nc bnc" id="L177" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24218) ? (Math.abs(time_s) &gt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24217) ? (Math.abs(time_s) &lt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24216) ? (Math.abs(time_s) &gt; TIME_DAY) : (ListenerUtil.mutListener.listen(24215) ? (Math.abs(time_s) != TIME_DAY) : (ListenerUtil.mutListener.listen(24214) ? (Math.abs(time_s) == TIME_DAY) : (Math.abs(time_s) &lt; TIME_DAY))))))) {</span>
<span class="nc bnc" id="L178" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_hours, (int) Math.round((ListenerUtil.mutListener.listen(24244) ? (time_s % TIME_HOUR) : (ListenerUtil.mutListener.listen(24243) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24242) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24241) ? (time_s + TIME_HOUR) : (time_s / TIME_HOUR)))))));</span>
<span class="nc bnc" id="L179" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24223) ? (Math.abs(time_s) &gt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24222) ? (Math.abs(time_s) &lt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24221) ? (Math.abs(time_s) &gt; TIME_MONTH) : (ListenerUtil.mutListener.listen(24220) ? (Math.abs(time_s) != TIME_MONTH) : (ListenerUtil.mutListener.listen(24219) ? (Math.abs(time_s) == TIME_MONTH) : (Math.abs(time_s) &lt; TIME_MONTH))))))) {</span>
<span class="nc bnc" id="L180" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_days, (int) Math.round((ListenerUtil.mutListener.listen(24240) ? (time_s % TIME_DAY) : (ListenerUtil.mutListener.listen(24239) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24238) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24237) ? (time_s + TIME_DAY) : (time_s / TIME_DAY)))))));</span>
<span class="nc bnc" id="L181" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24228) ? (Math.abs(time_s) &gt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24227) ? (Math.abs(time_s) &lt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24226) ? (Math.abs(time_s) &gt; TIME_YEAR) : (ListenerUtil.mutListener.listen(24225) ? (Math.abs(time_s) != TIME_YEAR) : (ListenerUtil.mutListener.listen(24224) ? (Math.abs(time_s) == TIME_YEAR) : (Math.abs(time_s) &lt; TIME_YEAR))))))) {</span>
<span class="nc bnc" id="L182" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_months, (ListenerUtil.mutListener.listen(24236) ? (time_s % TIME_MONTH) : (ListenerUtil.mutListener.listen(24235) ? (time_s * TIME_MONTH) : (ListenerUtil.mutListener.listen(24234) ? (time_s - TIME_MONTH) : (ListenerUtil.mutListener.listen(24233) ? (time_s + TIME_MONTH) : (time_s / TIME_MONTH))))));</span>
        } else {
<span class="nc bnc" id="L184" title="All 8 branches missed.">            return res.getString(R.string.time_quantity_years, (ListenerUtil.mutListener.listen(24232) ? (time_s % TIME_YEAR) : (ListenerUtil.mutListener.listen(24231) ? (time_s * TIME_YEAR) : (ListenerUtil.mutListener.listen(24230) ? (time_s - TIME_YEAR) : (ListenerUtil.mutListener.listen(24229) ? (time_s + TIME_YEAR) : (time_s / TIME_YEAR))))));</span>
        }
    }

    /**
     * Return a string representing how much time remains
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The time quantity string. Something like &quot;3 minutes left&quot; or &quot;2 hours left&quot;.
     */
    public static String remainingTime(Context context, long time_s) {
        // Time in unit x
        int time_x;
        // Time not counted in the number in unit x
        int remaining_seconds;
        // Time in the unit smaller than x
        int remaining;
<span class="nc" id="L202">        Resources res = context.getResources();</span>
<span class="nc bnc" id="L203" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(24253) ? (time_s &gt;= TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24252) ? (time_s &lt;= TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24251) ? (time_s &gt; TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24250) ? (time_s != TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24249) ? (time_s == TIME_HOUR_LONG) : (time_s &lt; TIME_HOUR_LONG))))))) {</span>
<span class="nc bnc" id="L204" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24286) ? (time_s % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24285) ? (time_s * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24284) ? (time_s - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24283) ? (time_s + TIME_MINUTE) : (time_s / TIME_MINUTE))))));</span>
<span class="nc" id="L205">            return res.getQuantityString(R.plurals.reviewer_window_title, time_x, time_x);</span>
<span class="nc bnc" id="L206" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24258) ? (time_s &gt;= TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24257) ? (time_s &lt;= TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24256) ? (time_s &gt; TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24255) ? (time_s != TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24254) ? (time_s == TIME_DAY_LONG) : (time_s &lt; TIME_DAY_LONG))))))) {</span>
<span class="nc bnc" id="L207" title="All 8 branches missed.">            time_x = (int) ((ListenerUtil.mutListener.listen(24274) ? (time_s % TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24273) ? (time_s * TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24272) ? (time_s - TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24271) ? (time_s + TIME_HOUR_LONG) : (time_s / TIME_HOUR_LONG))))));</span>
<span class="nc bnc" id="L208" title="All 8 branches missed.">            remaining_seconds = (int) ((ListenerUtil.mutListener.listen(24278) ? (time_s / TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24277) ? (time_s * TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24276) ? (time_s - TIME_HOUR_LONG) : (ListenerUtil.mutListener.listen(24275) ? (time_s + TIME_HOUR_LONG) : (time_s % TIME_HOUR_LONG))))));</span>
<span class="nc bnc" id="L209" title="All 8 branches missed.">            remaining = (int) Math.round((ListenerUtil.mutListener.listen(24282) ? ((float) remaining_seconds % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24281) ? ((float) remaining_seconds * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24280) ? ((float) remaining_seconds - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24279) ? ((float) remaining_seconds + TIME_MINUTE) : ((float) remaining_seconds / TIME_MINUTE))))));</span>
<span class="nc" id="L210">            return res.getQuantityString(R.plurals.reviewer_window_title_hours, time_x, time_x, remaining);</span>
        } else {
<span class="nc bnc" id="L212" title="All 8 branches missed.">            time_x = (int) ((ListenerUtil.mutListener.listen(24262) ? (time_s % TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24261) ? (time_s * TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24260) ? (time_s - TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24259) ? (time_s + TIME_DAY_LONG) : (time_s / TIME_DAY_LONG))))));</span>
<span class="nc bnc" id="L213" title="All 8 branches missed.">            remaining_seconds = (int) ((ListenerUtil.mutListener.listen(24266) ? ((float) time_s / TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24265) ? ((float) time_s * TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24264) ? ((float) time_s - TIME_DAY_LONG) : (ListenerUtil.mutListener.listen(24263) ? ((float) time_s + TIME_DAY_LONG) : ((float) time_s % TIME_DAY_LONG))))));</span>
<span class="nc bnc" id="L214" title="All 8 branches missed.">            remaining = (int) Math.round((ListenerUtil.mutListener.listen(24270) ? (remaining_seconds % TIME_HOUR) : (ListenerUtil.mutListener.listen(24269) ? (remaining_seconds * TIME_HOUR) : (ListenerUtil.mutListener.listen(24268) ? (remaining_seconds - TIME_HOUR) : (ListenerUtil.mutListener.listen(24267) ? (remaining_seconds + TIME_HOUR) : (remaining_seconds / TIME_HOUR))))));</span>
<span class="nc" id="L215">            return res.getQuantityString(R.plurals.reviewer_window_title_days, time_x, time_x, remaining);</span>
        }
    }

    /**
     * Return a string representing a time
     * (If you want a certain unit, use the strings directly)
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The formatted, localized time string. The time is always an integer.
     *  e.g. something like &quot;3 seconds&quot; or &quot;1 year&quot;.
     */
    public static String timeSpan(Context context, long time_s) {
        // Time in unit x
        int time_x;
<span class="nc" id="L231">        Resources res = context.getResources();</span>
<span class="nc bnc" id="L232" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(24291) ? (Math.abs(time_s) &gt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24290) ? (Math.abs(time_s) &lt;= TIME_MINUTE) : (ListenerUtil.mutListener.listen(24289) ? (Math.abs(time_s) &gt; TIME_MINUTE) : (ListenerUtil.mutListener.listen(24288) ? (Math.abs(time_s) != TIME_MINUTE) : (ListenerUtil.mutListener.listen(24287) ? (Math.abs(time_s) == TIME_MINUTE) : (Math.abs(time_s) &lt; TIME_MINUTE))))))) {</span>
<span class="nc" id="L233">            time_x = (int) time_s;</span>
<span class="nc" id="L234">            return res.getQuantityString(R.plurals.time_span_seconds, time_x, time_x);</span>
<span class="nc bnc" id="L235" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24296) ? (Math.abs(time_s) &gt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24295) ? (Math.abs(time_s) &lt;= TIME_HOUR) : (ListenerUtil.mutListener.listen(24294) ? (Math.abs(time_s) &gt; TIME_HOUR) : (ListenerUtil.mutListener.listen(24293) ? (Math.abs(time_s) != TIME_HOUR) : (ListenerUtil.mutListener.listen(24292) ? (Math.abs(time_s) == TIME_HOUR) : (Math.abs(time_s) &lt; TIME_HOUR))))))) {</span>
<span class="nc bnc" id="L236" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24331) ? (time_s % TIME_MINUTE) : (ListenerUtil.mutListener.listen(24330) ? (time_s * TIME_MINUTE) : (ListenerUtil.mutListener.listen(24329) ? (time_s - TIME_MINUTE) : (ListenerUtil.mutListener.listen(24328) ? (time_s + TIME_MINUTE) : (time_s / TIME_MINUTE))))));</span>
<span class="nc" id="L237">            return res.getQuantityString(R.plurals.time_span_minutes, time_x, time_x);</span>
<span class="nc bnc" id="L238" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24301) ? (Math.abs(time_s) &gt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24300) ? (Math.abs(time_s) &lt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24299) ? (Math.abs(time_s) &gt; TIME_DAY) : (ListenerUtil.mutListener.listen(24298) ? (Math.abs(time_s) != TIME_DAY) : (ListenerUtil.mutListener.listen(24297) ? (Math.abs(time_s) == TIME_DAY) : (Math.abs(time_s) &lt; TIME_DAY))))))) {</span>
<span class="nc bnc" id="L239" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24327) ? (time_s % TIME_HOUR) : (ListenerUtil.mutListener.listen(24326) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24325) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24324) ? (time_s + TIME_HOUR) : (time_s / TIME_HOUR))))));</span>
<span class="nc" id="L240">            return res.getQuantityString(R.plurals.time_span_hours, time_x, time_x);</span>
<span class="nc bnc" id="L241" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24306) ? (Math.abs(time_s) &gt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24305) ? (Math.abs(time_s) &lt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24304) ? (Math.abs(time_s) &gt; TIME_MONTH) : (ListenerUtil.mutListener.listen(24303) ? (Math.abs(time_s) != TIME_MONTH) : (ListenerUtil.mutListener.listen(24302) ? (Math.abs(time_s) == TIME_MONTH) : (Math.abs(time_s) &lt; TIME_MONTH))))))) {</span>
<span class="nc bnc" id="L242" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24323) ? (time_s % TIME_DAY) : (ListenerUtil.mutListener.listen(24322) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24321) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24320) ? (time_s + TIME_DAY) : (time_s / TIME_DAY))))));</span>
<span class="nc" id="L243">            return res.getQuantityString(R.plurals.time_span_days, time_x, time_x);</span>
<span class="nc bnc" id="L244" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24311) ? (Math.abs(time_s) &gt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24310) ? (Math.abs(time_s) &lt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24309) ? (Math.abs(time_s) &gt; TIME_YEAR) : (ListenerUtil.mutListener.listen(24308) ? (Math.abs(time_s) != TIME_YEAR) : (ListenerUtil.mutListener.listen(24307) ? (Math.abs(time_s) == TIME_YEAR) : (Math.abs(time_s) &lt; TIME_YEAR))))))) {</span>
<span class="nc bnc" id="L245" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24319) ? (time_s % TIME_MONTH) : (ListenerUtil.mutListener.listen(24318) ? (time_s * TIME_MONTH) : (ListenerUtil.mutListener.listen(24317) ? (time_s - TIME_MONTH) : (ListenerUtil.mutListener.listen(24316) ? (time_s + TIME_MONTH) : (time_s / TIME_MONTH))))));</span>
<span class="nc" id="L246">            return res.getQuantityString(R.plurals.time_span_months, time_x, time_x);</span>
        } else {
<span class="nc bnc" id="L248" title="All 8 branches missed.">            time_x = (int) Math.round((ListenerUtil.mutListener.listen(24315) ? (time_s % TIME_YEAR) : (ListenerUtil.mutListener.listen(24314) ? (time_s * TIME_YEAR) : (ListenerUtil.mutListener.listen(24313) ? (time_s - TIME_YEAR) : (ListenerUtil.mutListener.listen(24312) ? (time_s + TIME_YEAR) : (time_s / TIME_YEAR))))));</span>
<span class="nc" id="L249">            return res.getQuantityString(R.plurals.time_span_years, time_x, time_x);</span>
        }
    }

    /**
     * Return a proper string for a time value in seconds
     *
     * Similar to Anki anki/utils.py's fmtTimeSpan.
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The formatted, localized time string. The time is always a float. E.g. &quot;27.0 days&quot;
     */
    public static String roundedTimeSpanUnformatted(Context context, long time_s) {
        // As roundedTimeSpan, but without tags; for place where you don't use HTML
<span class="nc" id="L264">        return roundedTimeSpan(context, time_s).replace(&quot;&lt;b&gt;&quot;, &quot;&quot;).replace(&quot;&lt;/b&gt;&quot;, &quot;&quot;);</span>
    }

    /**
     * Return a proper string for a time value in seconds
     *
     * Similar to Anki anki/utils.py's fmtTimeSpan.
     *
     * @param context The application's environment.
     * @param time_s The time to format, in seconds
     * @return The formatted, localized time string. The time is always a float. E.g. &quot;&lt;b&gt;27.0&lt;/b&gt; days&quot;
     */
    public static String roundedTimeSpan(Context context, long time_s) {
<span class="nc bnc" id="L277" title="All 22 branches missed.">        if ((ListenerUtil.mutListener.listen(24336) ? (Math.abs(time_s) &gt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24335) ? (Math.abs(time_s) &lt;= TIME_DAY) : (ListenerUtil.mutListener.listen(24334) ? (Math.abs(time_s) &gt; TIME_DAY) : (ListenerUtil.mutListener.listen(24333) ? (Math.abs(time_s) != TIME_DAY) : (ListenerUtil.mutListener.listen(24332) ? (Math.abs(time_s) == TIME_DAY) : (Math.abs(time_s) &lt; TIME_DAY))))))) {</span>
<span class="nc bnc" id="L278" title="All 8 branches missed.">            return context.getResources().getString(R.string.stats_overview_hours, (ListenerUtil.mutListener.listen(24362) ? (time_s % TIME_HOUR) : (ListenerUtil.mutListener.listen(24361) ? (time_s * TIME_HOUR) : (ListenerUtil.mutListener.listen(24360) ? (time_s - TIME_HOUR) : (ListenerUtil.mutListener.listen(24359) ? (time_s + TIME_HOUR) : (time_s / TIME_HOUR))))));</span>
<span class="nc bnc" id="L279" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24341) ? (Math.abs(time_s) &gt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24340) ? (Math.abs(time_s) &lt;= TIME_MONTH) : (ListenerUtil.mutListener.listen(24339) ? (Math.abs(time_s) &gt; TIME_MONTH) : (ListenerUtil.mutListener.listen(24338) ? (Math.abs(time_s) != TIME_MONTH) : (ListenerUtil.mutListener.listen(24337) ? (Math.abs(time_s) == TIME_MONTH) : (Math.abs(time_s) &lt; TIME_MONTH))))))) {</span>
<span class="nc bnc" id="L280" title="All 8 branches missed.">            return context.getResources().getString(R.string.stats_overview_days, (ListenerUtil.mutListener.listen(24358) ? (time_s % TIME_DAY) : (ListenerUtil.mutListener.listen(24357) ? (time_s * TIME_DAY) : (ListenerUtil.mutListener.listen(24356) ? (time_s - TIME_DAY) : (ListenerUtil.mutListener.listen(24355) ? (time_s + TIME_DAY) : (time_s / TIME_DAY))))));</span>
<span class="nc bnc" id="L281" title="All 22 branches missed.">        } else if ((ListenerUtil.mutListener.listen(24346) ? (Math.abs(time_s) &gt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24345) ? (Math.abs(time_s) &lt;= TIME_YEAR) : (ListenerUtil.mutListener.listen(24344) ? (Math.abs(time_s) &gt; TIME_YEAR) : (ListenerUtil.mutListener.listen(24343) ? (Math.abs(time_s) != TIME_YEAR) : (ListenerUtil.mutListener.listen(24342) ? (Math.abs(time_s) == TIME_YEAR) : (Math.abs(time_s) &lt; TIME_YEAR))))))) {</span>
<span class="nc bnc" id="L282" title="All 8 branches missed.">            return context.getResources().getString(R.string.stats_overview_months, (ListenerUtil.mutListener.listen(24354) ? (time_s % TIME_MONTH) : (ListenerUtil.mutListener.listen(24353) ? (time_s * TIME_MONTH) : (ListenerUtil.mutListener.listen(24352) ? (time_s - TIME_MONTH) : (ListenerUtil.mutListener.listen(24351) ? (time_s + TIME_MONTH) : (time_s / TIME_MONTH))))));</span>
        } else {
<span class="nc bnc" id="L284" title="All 8 branches missed.">            return context.getResources().getString(R.string.stats_overview_years, (ListenerUtil.mutListener.listen(24350) ? (time_s % TIME_YEAR) : (ListenerUtil.mutListener.listen(24349) ? (time_s * TIME_YEAR) : (ListenerUtil.mutListener.listen(24348) ? (time_s - TIME_YEAR) : (ListenerUtil.mutListener.listen(24347) ? (time_s + TIME_YEAR) : (time_s / TIME_YEAR))))));</span>
        }
    }

    /**
     * Strips a text from &lt;style&gt;...&lt;/style&gt;, &lt;script&gt;...&lt;/script&gt; and &lt;_any_tag_&gt; HTML tags.
     * @param s The HTML text to be cleaned.
     * @return The text without the aforementioned tags.
     */
    public static String stripHTML(String s) {
<span class="pc bpc" id="L294" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24363)) {</span>
<span class="fc" id="L295">            s = stripHTMLScriptAndStyleTags(s);</span>
        }
<span class="fc" id="L297">        Matcher htmlMatcher = tagPattern.matcher(s);</span>
<span class="pc bpc" id="L298" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24364)) {</span>
<span class="fc" id="L299">            s = htmlMatcher.replaceAll(&quot;&quot;);</span>
        }
<span class="fc" id="L301">        return entsToTxt(s);</span>
    }

    /**
     * Strips &lt;style&gt;...&lt;/style&gt; and &lt;script&gt;...&lt;/script&gt; HTML tags and content from a string.
     * @param s The HTML text to be cleaned.
     * @return The text without the aforementioned tags.
     */
    public static String stripHTMLScriptAndStyleTags(String s) {
<span class="fc" id="L310">        Matcher htmlMatcher = stylePattern.matcher(s);</span>
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24365)) {</span>
<span class="fc" id="L312">            s = htmlMatcher.replaceAll(&quot;&quot;);</span>
        }
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24366)) {</span>
<span class="fc" id="L315">            htmlMatcher = scriptPattern.matcher(s);</span>
        }
<span class="fc" id="L317">        return htmlMatcher.replaceAll(&quot;&quot;);</span>
    }

    /**
     * Strip HTML but keep media filenames
     */
    public static String stripHTMLMedia(@NonNull String s) {
<span class="fc" id="L324">        return stripHTMLMedia(s, &quot; $1 &quot;);</span>
    }

    public static String stripHTMLMedia(@NonNull String s, String replacement) {
<span class="fc" id="L328">        Matcher imgMatcher = imgPattern.matcher(s);</span>
<span class="fc" id="L329">        return stripHTML(imgMatcher.replaceAll(replacement));</span>
    }

    /**
     * Strip sound but keep media filenames
     */
    public static String stripSoundMedia(String s) {
<span class="nc" id="L336">        return stripSoundMedia(s, &quot; $1 &quot;);</span>
    }

    public static String stripSoundMedia(String s, String replacement) {
<span class="nc" id="L340">        Matcher soundMatcher = soundPattern.matcher(s);</span>
<span class="nc" id="L341">        return soundMatcher.replaceAll(replacement);</span>
    }

    /**
     * Takes a string and replaces all the HTML symbols in it with their unescaped representation.
     * This should only affect substrings of the form &amp;something; and not tags.
     * Internet rumour says that Html.fromHtml() doesn't cover all cases, but it doesn't get less
     * vague than that.
     * @param html The HTML escaped text
     * @return The text with its HTML entities unescaped.
     */
    private static String entsToTxt(String html) {
<span class="pc bpc" id="L353" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24367)) {</span>
            // replace it first
<span class="fc" id="L355">            html = html.replace(&quot;&amp;nbsp;&quot;, &quot; &quot;);</span>
        }
<span class="fc" id="L357">        Matcher htmlEntities = htmlEntitiesPattern.matcher(html);</span>
<span class="fc" id="L358">        StringBuffer sb = new StringBuffer();</span>
<span class="pc bpc" id="L359" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24369)) {</span>
            {
<span class="fc" id="L361">                long _loopCounter642 = 0;</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">                while (htmlEntities.find()) {</span>
<span class="nc" id="L363">                    ListenerUtil.loopListener.listen(&quot;_loopCounter642&quot;, ++_loopCounter642);</span>
<span class="nc" id="L364">                    final Spanned spanned = HtmlCompat.fromHtml(htmlEntities.group(), HtmlCompat.FROM_HTML_MODE_LEGACY);</span>
<span class="nc" id="L365">                    final String replacement = Matcher.quoteReplacement(spanned.toString());</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24368)) {</span>
<span class="nc" id="L367">                        htmlEntities.appendReplacement(sb, replacement);</span>
                    }
<span class="nc" id="L369">                }</span>
            }
        }
<span class="pc bpc" id="L372" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24370)) {</span>
<span class="fc" id="L373">            htmlEntities.appendTail(sb);</span>
        }
<span class="fc" id="L375">        return sb.toString();</span>
    }

    /**
     * Given a list of integers, return a string '(int1,int2,...)'.
     */
    public static String ids2str(int[] ids) {
<span class="nc" id="L382">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24371)) {</span>
<span class="nc" id="L384">            sb.append(&quot;(&quot;);</span>
        }
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24377)) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">            if (ids != null) {</span>
<span class="nc" id="L388">                String s = Arrays.toString(ids);</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24376)) {</span>
<span class="nc bnc" id="L390" title="All 8 branches missed.">                    sb.append(s.substring(1, (ListenerUtil.mutListener.listen(24375) ? (s.length() % 1) : (ListenerUtil.mutListener.listen(24374) ? (s.length() / 1) : (ListenerUtil.mutListener.listen(24373) ? (s.length() * 1) : (ListenerUtil.mutListener.listen(24372) ? (s.length() + 1) : (s.length() - 1)))))));</span>
                }
            }
        }
<span class="nc bnc" id="L394" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24378)) {</span>
<span class="nc" id="L395">            sb.append(&quot;)&quot;);</span>
        }
<span class="nc" id="L397">        return sb.toString();</span>
    }

    /**
     * Given a list of integers, return a string '(int1,int2,...)'.
     */
    public static String ids2str(long[] ids) {
<span class="nc" id="L404">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24379)) {</span>
<span class="nc" id="L406">            sb.append(&quot;(&quot;);</span>
        }
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24385)) {</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            if (ids != null) {</span>
<span class="nc" id="L410">                String s = Arrays.toString(ids);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24384)) {</span>
<span class="nc bnc" id="L412" title="All 8 branches missed.">                    sb.append(s.substring(1, (ListenerUtil.mutListener.listen(24383) ? (s.length() % 1) : (ListenerUtil.mutListener.listen(24382) ? (s.length() / 1) : (ListenerUtil.mutListener.listen(24381) ? (s.length() * 1) : (ListenerUtil.mutListener.listen(24380) ? (s.length() + 1) : (s.length() - 1)))))));</span>
                }
            }
        }
<span class="nc bnc" id="L416" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24386)) {</span>
<span class="nc" id="L417">            sb.append(&quot;)&quot;);</span>
        }
<span class="nc" id="L419">        return sb.toString();</span>
    }

    /**
     * Given a list of integers, return a string '(int1,int2,...)'.
     */
    public static String ids2str(Long[] ids) {
<span class="nc" id="L426">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24387)) {</span>
<span class="nc" id="L428">            sb.append(&quot;(&quot;);</span>
        }
<span class="nc bnc" id="L430" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24393)) {</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">            if (ids != null) {</span>
<span class="nc" id="L432">                String s = Arrays.toString(ids);</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24392)) {</span>
<span class="nc bnc" id="L434" title="All 8 branches missed.">                    sb.append(s.substring(1, (ListenerUtil.mutListener.listen(24391) ? (s.length() % 1) : (ListenerUtil.mutListener.listen(24390) ? (s.length() / 1) : (ListenerUtil.mutListener.listen(24389) ? (s.length() * 1) : (ListenerUtil.mutListener.listen(24388) ? (s.length() + 1) : (s.length() - 1)))))));</span>
                }
            }
        }
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24394)) {</span>
<span class="nc" id="L439">            sb.append(&quot;)&quot;);</span>
        }
<span class="nc" id="L441">        return sb.toString();</span>
    }

    /**
     * Given a list of integers, return a string '(int1,int2,...)', in order given by the iterator.
     */
    public static &lt;T&gt; String ids2str(Iterable&lt;T&gt; ids) {
<span class="fc" id="L448">        StringBuilder sb = new StringBuilder(512);</span>
<span class="pc bpc" id="L449" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24395)) {</span>
<span class="fc" id="L450">            sb.append(&quot;(&quot;);</span>
        }
<span class="fc" id="L452">        boolean isNotFirst = false;</span>
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24400)) {</span>
            {
<span class="fc" id="L455">                long _loopCounter643 = 0;</span>
<span class="fc bfc" id="L456" title="All 2 branches covered.">                for (T id : ids) {</span>
<span class="fc" id="L457">                    ListenerUtil.loopListener.listen(&quot;_loopCounter643&quot;, ++_loopCounter643);</span>
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24398)) {</span>
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">                        if (isNotFirst) {</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24397)) {</span>
<span class="nc" id="L461">                                sb.append(&quot;, &quot;);</span>
                            }
                        } else {
<span class="pc bpc" id="L464" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24396)) {</span>
<span class="fc" id="L465">                                isNotFirst = true;</span>
                            }
                        }
                    }
<span class="pc bpc" id="L469" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24399)) {</span>
<span class="fc" id="L470">                        sb.append(id);</span>
                    }
<span class="fc" id="L472">                }</span>
            }
        }
<span class="pc bpc" id="L475" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24401)) {</span>
<span class="fc" id="L476">            sb.append(&quot;)&quot;);</span>
        }
<span class="fc" id="L478">        return sb.toString();</span>
    }

    /**
     * Given a list of integers, return a string '(int1,int2,...)'.
     */
    public static String ids2str(JSONArray ids) {
<span class="nc" id="L485">        StringBuilder str = new StringBuilder(512);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24402)) {</span>
<span class="nc" id="L487">            str.append(&quot;(&quot;);</span>
        }
<span class="nc bnc" id="L489" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24422)) {</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">            if (ids != null) {</span>
<span class="nc" id="L491">                int len = ids.length();</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24421)) {</span>
                    {
<span class="nc" id="L494">                        long _loopCounter644 = 0;</span>
<span class="nc bnc" id="L495" title="All 22 branches missed.">                        for (int i = 0; (ListenerUtil.mutListener.listen(24420) ? (i &gt;= len) : (ListenerUtil.mutListener.listen(24419) ? (i &lt;= len) : (ListenerUtil.mutListener.listen(24418) ? (i &gt; len) : (ListenerUtil.mutListener.listen(24417) ? (i != len) : (ListenerUtil.mutListener.listen(24416) ? (i == len) : (i &lt; len)))))); i++) {</span>
<span class="nc" id="L496">                            ListenerUtil.loopListener.listen(&quot;_loopCounter644&quot;, ++_loopCounter644);</span>
                            try {
<span class="nc bnc" id="L498" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24415)) {</span>
<span class="nc bnc" id="L499" title="All 70 branches missed.">                                    if ((ListenerUtil.mutListener.listen(24412) ? (i &gt;= ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))) : (ListenerUtil.mutListener.listen(24411) ? (i &lt;= ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))) : (ListenerUtil.mutListener.listen(24410) ? (i &gt; ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))) : (ListenerUtil.mutListener.listen(24409) ? (i &lt; ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))) : (ListenerUtil.mutListener.listen(24408) ? (i != ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))) : (i == ((ListenerUtil.mutListener.listen(24407) ? (len % 1) : (ListenerUtil.mutListener.listen(24406) ? (len / 1) : (ListenerUtil.mutListener.listen(24405) ? (len * 1) : (ListenerUtil.mutListener.listen(24404) ? (len + 1) : (len - 1))))))))))))) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(24414)) {</span>
<span class="nc" id="L501">                                            str.append(ids.getLong(i));</span>
                                        }
                                    } else {
<span class="nc bnc" id="L504" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(24413)) {</span>
<span class="nc" id="L505">                                            str.append(ids.getLong(i)).append(&quot;,&quot;);</span>
                                        }
                                    }
                                }
<span class="nc" id="L509">                            } catch (JSONException e) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24403)) {</span>
<span class="nc" id="L511">                                    Timber.e(e, &quot;ids2str :: JSONException&quot;);</span>
                                }
<span class="nc" id="L513">                            }</span>
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L519" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24423)) {</span>
<span class="nc" id="L520">            str.append(&quot;)&quot;);</span>
        }
<span class="nc" id="L522">        return str.toString();</span>
    }

    /**
     * LIBANKI: not in libanki
     *  Transform a collection of Long into an array of Long
     */
    public static long[] collection2Array(java.util.Collection&lt;Long&gt; list) {
<span class="nc" id="L530">        long[] ar = new long[list.size()];</span>
<span class="nc" id="L531">        int i = 0;</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24425)) {</span>
            {
<span class="nc" id="L534">                long _loopCounter645 = 0;</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">                for (long l : list) {</span>
<span class="nc" id="L536">                    ListenerUtil.loopListener.listen(&quot;_loopCounter645&quot;, ++_loopCounter645);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24424)) {</span>
<span class="nc" id="L538">                        ar[i++] = l;</span>
                    }
<span class="nc" id="L540">                }</span>
            }
        }
<span class="nc" id="L543">        return ar;</span>
    }

    public static Long[] list2ObjectArray(List&lt;Long&gt; list) {
<span class="nc" id="L547">        return list.toArray(new Long[0]);</span>
    }

    // used in ankiweb
    private static String base62(int num, String extra) {
<span class="nc" id="L552">        String table = ALL_CHARACTERS + extra;</span>
<span class="nc" id="L553">        int len = table.length();</span>
<span class="nc" id="L554">        String buf = &quot;&quot;;</span>
        int mod;
        {
<span class="nc" id="L557">            long _loopCounter646 = 0;</span>
<span class="nc bnc" id="L558" title="All 22 branches missed.">            while ((ListenerUtil.mutListener.listen(24444) ? (num &gt;= 0) : (ListenerUtil.mutListener.listen(24443) ? (num &lt;= 0) : (ListenerUtil.mutListener.listen(24442) ? (num &gt; 0) : (ListenerUtil.mutListener.listen(24441) ? (num &lt; 0) : (ListenerUtil.mutListener.listen(24440) ? (num == 0) : (num != 0))))))) {</span>
<span class="nc" id="L559">                ListenerUtil.loopListener.listen(&quot;_loopCounter646&quot;, ++_loopCounter646);</span>
<span class="nc bnc" id="L560" title="All 8 branches missed.">                mod = (ListenerUtil.mutListener.listen(24429) ? (num / len) : (ListenerUtil.mutListener.listen(24428) ? (num * len) : (ListenerUtil.mutListener.listen(24427) ? (num - len) : (ListenerUtil.mutListener.listen(24426) ? (num + len) : (num % len)))));</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24434)) {</span>
<span class="nc bnc" id="L562" title="All 8 branches missed.">                    buf = buf + table.substring(mod, (ListenerUtil.mutListener.listen(24433) ? (mod % 1) : (ListenerUtil.mutListener.listen(24432) ? (mod / 1) : (ListenerUtil.mutListener.listen(24431) ? (mod * 1) : (ListenerUtil.mutListener.listen(24430) ? (mod - 1) : (mod + 1))))));</span>
                }
<span class="nc bnc" id="L564" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24439)) {</span>
<span class="nc bnc" id="L565" title="All 8 branches missed.">                    num = (ListenerUtil.mutListener.listen(24438) ? (num % len) : (ListenerUtil.mutListener.listen(24437) ? (num * len) : (ListenerUtil.mutListener.listen(24436) ? (num - len) : (ListenerUtil.mutListener.listen(24435) ? (num + len) : (num / len)))));</span>
                }
            }
        }
<span class="nc" id="L569">        return buf;</span>
    }

    // all printable characters minus quotes, backslash and separators
    private static String base91(int num) {
<span class="nc" id="L574">        return base62(num, BASE91_EXTRA_CHARS);</span>
    }

    /**
     * return a base91-encoded 64bit random number
     */
    public static String guid64() {
<span class="nc bnc" id="L581" title="All 8 branches missed.">        return base91((new Random()).nextInt((int) ((ListenerUtil.mutListener.listen(24448) ? (Math.pow(2, 61) % 1) : (ListenerUtil.mutListener.listen(24447) ? (Math.pow(2, 61) / 1) : (ListenerUtil.mutListener.listen(24446) ? (Math.pow(2, 61) * 1) : (ListenerUtil.mutListener.listen(24445) ? (Math.pow(2, 61) + 1) : (Math.pow(2, 61) - 1))))))));</span>
    }

    // increment a guid by one, for note type conflicts
    // used in Anki
    @SuppressWarnings({ &quot;unused&quot; })
    public static String incGuid(String guid) {
<span class="nc" id="L588">        return new StringBuffer(_incGuid(new StringBuffer(guid).reverse().toString())).reverse().toString();</span>
    }

    private static String _incGuid(String guid) {
<span class="nc" id="L592">        String table = ALL_CHARACTERS + BASE91_EXTRA_CHARS;</span>
<span class="nc" id="L593">        int idx = table.indexOf(guid.substring(0, 1));</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24464)) {</span>
<span class="nc bnc" id="L595" title="All 70 branches missed.">            if ((ListenerUtil.mutListener.listen(24457) ? ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) &gt;= table.length()) : (ListenerUtil.mutListener.listen(24456) ? ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) &lt;= table.length()) : (ListenerUtil.mutListener.listen(24455) ? ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) &gt; table.length()) : (ListenerUtil.mutListener.listen(24454) ? ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) &lt; table.length()) : (ListenerUtil.mutListener.listen(24453) ? ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) != table.length()) : ((ListenerUtil.mutListener.listen(24452) ? (idx % 1) : (ListenerUtil.mutListener.listen(24451) ? (idx / 1) : (ListenerUtil.mutListener.listen(24450) ? (idx * 1) : (ListenerUtil.mutListener.listen(24449) ? (idx - 1) : (idx + 1))))) == table.length()))))))) {</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24463)) {</span>
                    // overflow
<span class="nc" id="L598">                    guid = table.substring(0, 1) + _incGuid(guid.substring(1));</span>
                }
            } else {
<span class="nc bnc" id="L601" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24462)) {</span>
<span class="nc bnc" id="L602" title="All 8 branches missed.">                    guid = table.substring((ListenerUtil.mutListener.listen(24461) ? (idx % 1) : (ListenerUtil.mutListener.listen(24460) ? (idx / 1) : (ListenerUtil.mutListener.listen(24459) ? (idx * 1) : (ListenerUtil.mutListener.listen(24458) ? (idx - 1) : (idx + 1)))))) + guid.substring(1);</span>
                }
            }
        }
<span class="nc" id="L606">        return guid;</span>
    }

    public static Object[] jsonArray2Objects(JSONArray array) {
<span class="nc" id="L610">        Object[] o = new Object[array.length()];</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24471)) {</span>
            {
<span class="nc" id="L613">                long _loopCounter647 = 0;</span>
<span class="nc bnc" id="L614" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(24470) ? (i &gt;= array.length()) : (ListenerUtil.mutListener.listen(24469) ? (i &lt;= array.length()) : (ListenerUtil.mutListener.listen(24468) ? (i &gt; array.length()) : (ListenerUtil.mutListener.listen(24467) ? (i != array.length()) : (ListenerUtil.mutListener.listen(24466) ? (i == array.length()) : (i &lt; array.length())))))); i++) {</span>
<span class="nc" id="L615">                    ListenerUtil.loopListener.listen(&quot;_loopCounter647&quot;, ++_loopCounter647);</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24465)) {</span>
<span class="nc" id="L617">                        o[i] = array.get(i);</span>
                    }
                }
            }
        }
<span class="nc" id="L622">        return o;</span>
    }

    public static String joinFields(String[] list) {
<span class="nc" id="L626">        StringBuilder result = new StringBuilder(128);</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24482)) {</span>
            {
<span class="nc" id="L629">                long _loopCounter648 = 0;</span>
<span class="nc bnc" id="L630" title="All 70 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(24481) ? (i &gt;= (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1)))))) : (ListenerUtil.mutListener.listen(24480) ? (i &lt;= (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1)))))) : (ListenerUtil.mutListener.listen(24479) ? (i &gt; (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1)))))) : (ListenerUtil.mutListener.listen(24478) ? (i != (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1)))))) : (ListenerUtil.mutListener.listen(24477) ? (i == (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1)))))) : (i &lt; (ListenerUtil.mutListener.listen(24476) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24475) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24474) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24473) ? (list.length + 1) : (list.length - 1))))))))))); i++) {</span>
<span class="nc" id="L631">                    ListenerUtil.loopListener.listen(&quot;_loopCounter648&quot;, ++_loopCounter648);</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24472)) {</span>
<span class="nc" id="L633">                        result.append(list[i]).append(&quot;\u001f&quot;);</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24493)) {</span>
<span class="nc bnc" id="L639" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(24487) ? (list.length &gt;= 0) : (ListenerUtil.mutListener.listen(24486) ? (list.length &lt;= 0) : (ListenerUtil.mutListener.listen(24485) ? (list.length &lt; 0) : (ListenerUtil.mutListener.listen(24484) ? (list.length != 0) : (ListenerUtil.mutListener.listen(24483) ? (list.length == 0) : (list.length &gt; 0))))))) {</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24492)) {</span>
<span class="nc bnc" id="L641" title="All 8 branches missed.">                    result.append(list[(ListenerUtil.mutListener.listen(24491) ? (list.length % 1) : (ListenerUtil.mutListener.listen(24490) ? (list.length / 1) : (ListenerUtil.mutListener.listen(24489) ? (list.length * 1) : (ListenerUtil.mutListener.listen(24488) ? (list.length + 1) : (list.length - 1)))))]);</span>
                }
            }
        }
<span class="nc" id="L645">        return result.toString();</span>
    }

    public static String[] splitFields(String fields) {
        // -1 ensures that we don't drop empty fields at the ends
<span class="fc" id="L650">        return fields.split(FIELD_SEPARATOR, -1);</span>
    }

    /**
     * SHA1 checksum.
     * Equivalent to python sha1.hexdigest()
     *
     * @param data the string to generate hash from
     * @return A string of length 40 containing the hexadecimal representation of the MD5 checksum of data.
     */
    @SuppressWarnings(&quot;CharsetObjectCanBeUsed&quot;)
    public static String checksum(String data) {
<span class="fc" id="L662">        String result = &quot;&quot;;</span>
<span class="pc bpc" id="L663" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24510)) {</span>
<span class="pc bpc" id="L664" title="1 of 2 branches missed.">            if (data != null) {</span>
                MessageDigest md;
<span class="fc" id="L666">                byte[] digest = null;</span>
                try {
<span class="fc" id="L668">                    md = MessageDigest.getInstance(&quot;SHA1&quot;);</span>
<span class="pc bpc" id="L669" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24497)) {</span>
<span class="fc" id="L670">                        digest = md.digest(data.getBytes(&quot;UTF-8&quot;));</span>
                    }
<span class="nc" id="L672">                } catch (NoSuchAlgorithmException e) {</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24494)) {</span>
<span class="nc" id="L674">                        Timber.e(e, &quot;Utils.checksum: No such algorithm.&quot;);</span>
                    }
<span class="nc" id="L676">                    throw new RuntimeException(e);</span>
<span class="nc" id="L677">                } catch (UnsupportedEncodingException e) {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24495)) {</span>
<span class="nc" id="L679">                        Timber.e(e, &quot;Utils.checksum :: UnsupportedEncodingException&quot;);</span>
                    }
<span class="nc bnc" id="L681" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24496)) {</span>
<span class="nc" id="L682">                        e.printStackTrace();</span>
                    }
<span class="fc" id="L684">                }</span>
<span class="fc" id="L685">                BigInteger biginteger = new BigInteger(1, digest);</span>
<span class="pc bpc" id="L686" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24498)) {</span>
<span class="fc" id="L687">                    result = biginteger.toString(16);</span>
                }
<span class="pc bpc" id="L689" title="1 of 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24509)) {</span>
                    // not 32.
<span class="pc bpc" id="L691" title="16 of 22 branches missed.">                    if ((ListenerUtil.mutListener.listen(24503) ? (result.length() &gt;= 40) : (ListenerUtil.mutListener.listen(24502) ? (result.length() &lt;= 40) : (ListenerUtil.mutListener.listen(24501) ? (result.length() &gt; 40) : (ListenerUtil.mutListener.listen(24500) ? (result.length() != 40) : (ListenerUtil.mutListener.listen(24499) ? (result.length() == 40) : (result.length() &lt; 40))))))) {</span>
<span class="nc" id="L692">                        String zeroes = &quot;0000000000000000000000000000000000000000&quot;;</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24508)) {</span>
<span class="nc bnc" id="L694" title="All 8 branches missed.">                            result = zeroes.substring(0, (ListenerUtil.mutListener.listen(24507) ? (zeroes.length() % result.length()) : (ListenerUtil.mutListener.listen(24506) ? (zeroes.length() / result.length()) : (ListenerUtil.mutListener.listen(24505) ? (zeroes.length() * result.length()) : (ListenerUtil.mutListener.listen(24504) ? (zeroes.length() + result.length()) : (zeroes.length() - result.length())))))) + result;</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L700">        return result;</span>
    }

    /**
     * Optimized in case of sortIdx = 0
     * @param fields Fields of a note
     * @param sortIdx An index of the field
     * @return The field at sortIdx, without html media, and the csum of the first field.
     */
    public static Pair&lt;String, Long&gt; sfieldAndCsum(String[] fields, int sortIdx) {
<span class="fc" id="L710">        String firstStripped = stripHTMLMedia(fields[0]);</span>
<span class="pc bpc" id="L711" title="16 of 22 branches missed.">        String sortStripped = ((ListenerUtil.mutListener.listen(24515) ? (sortIdx &gt;= 0) : (ListenerUtil.mutListener.listen(24514) ? (sortIdx &lt;= 0) : (ListenerUtil.mutListener.listen(24513) ? (sortIdx &gt; 0) : (ListenerUtil.mutListener.listen(24512) ? (sortIdx &lt; 0) : (ListenerUtil.mutListener.listen(24511) ? (sortIdx != 0) : (sortIdx == 0))))))) ? firstStripped : stripHTMLMedia(fields[sortIdx]);</span>
<span class="fc" id="L712">        return new Pair&lt;&gt;(sortStripped, fieldChecksumWithoutHtmlMedia(firstStripped));</span>
    }

    /**
     * @param data the string to generate hash from.
     * @return 32 bit unsigned number from first 8 digits of sha1 hash
     */
    public static long fieldChecksum(String data) {
<span class="nc" id="L720">        return fieldChecksumWithoutHtmlMedia(stripHTMLMedia(data));</span>
    }

    /**
     * @param data the string to generate hash from. Html media should be removed
     * @return 32 bit unsigned number from first 8 digits of sha1 hash
     */
    public static long fieldChecksumWithoutHtmlMedia(String data) {
<span class="fc" id="L728">        return Long.valueOf(checksum(data).substring(0, 8), 16);</span>
    }

    /**
     * Generate the SHA1 checksum of a file.
     * @param file The file to be checked
     * @return A string of length 32 containing the hexadecimal representation of the SHA1 checksum of the file's contents.
     */
    public static String fileChecksum(String file) {
<span class="nc" id="L737">        byte[] buffer = new byte[1024];</span>
<span class="nc" id="L738">        byte[] digest = null;</span>
        try {
<span class="nc" id="L740">            InputStream fis = new FileInputStream(file);</span>
<span class="nc" id="L741">            MessageDigest md = MessageDigest.getInstance(&quot;SHA1&quot;);</span>
<span class="nc" id="L742">            int numRead = 0;</span>
<span class="nc bnc" id="L743" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24532)) {</span>
                {
<span class="nc" id="L745">                    long _loopCounter649 = 0;</span>
                    do {
<span class="nc" id="L747">                        ListenerUtil.loopListener.listen(&quot;_loopCounter649&quot;, ++_loopCounter649);</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24519)) {</span>
<span class="nc" id="L749">                            numRead = fis.read(buffer);</span>
                        }
<span class="nc bnc" id="L751" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24526)) {</span>
<span class="nc bnc" id="L752" title="All 22 branches missed.">                            if ((ListenerUtil.mutListener.listen(24524) ? (numRead &gt;= 0) : (ListenerUtil.mutListener.listen(24523) ? (numRead &lt;= 0) : (ListenerUtil.mutListener.listen(24522) ? (numRead &lt; 0) : (ListenerUtil.mutListener.listen(24521) ? (numRead != 0) : (ListenerUtil.mutListener.listen(24520) ? (numRead == 0) : (numRead &gt; 0))))))) {</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24525)) {</span>
<span class="nc" id="L754">                                    md.update(buffer, 0, numRead);</span>
                                }
                            }
                        }
<span class="nc bnc" id="L758" title="All 22 branches missed.">                    } while ((ListenerUtil.mutListener.listen(24531) ? (numRead &gt;= -1) : (ListenerUtil.mutListener.listen(24530) ? (numRead &lt;= -1) : (ListenerUtil.mutListener.listen(24529) ? (numRead &gt; -1) : (ListenerUtil.mutListener.listen(24528) ? (numRead &lt; -1) : (ListenerUtil.mutListener.listen(24527) ? (numRead == -1) : (numRead != -1)))))));</span>
                }
            }
<span class="nc bnc" id="L761" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24533)) {</span>
<span class="nc" id="L762">                fis.close();</span>
            }
<span class="nc bnc" id="L764" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24534)) {</span>
<span class="nc" id="L765">                digest = md.digest();</span>
            }
<span class="nc" id="L767">        } catch (FileNotFoundException e) {</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24516)) {</span>
<span class="nc" id="L769">                Timber.e(e, &quot;Utils.fileChecksum: File not found.&quot;);</span>
            }
<span class="nc" id="L771">        } catch (NoSuchAlgorithmException e) {</span>
<span class="nc bnc" id="L772" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24517)) {</span>
<span class="nc" id="L773">                Timber.e(e, &quot;Utils.fileChecksum: No such algorithm.&quot;);</span>
            }
<span class="nc" id="L775">        } catch (IOException e) {</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24518)) {</span>
<span class="nc" id="L777">                Timber.e(e, &quot;Utils.fileChecksum: IO exception.&quot;);</span>
            }
<span class="nc" id="L779">        }</span>
<span class="nc" id="L780">        BigInteger biginteger = new BigInteger(1, digest);</span>
<span class="nc" id="L781">        String result = biginteger.toString(16);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24545)) {</span>
            // pad with zeros to length of 40 - SHA1 is 160bit long
<span class="nc bnc" id="L784" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(24539) ? (result.length() &gt;= 40) : (ListenerUtil.mutListener.listen(24538) ? (result.length() &lt;= 40) : (ListenerUtil.mutListener.listen(24537) ? (result.length() &gt; 40) : (ListenerUtil.mutListener.listen(24536) ? (result.length() != 40) : (ListenerUtil.mutListener.listen(24535) ? (result.length() == 40) : (result.length() &lt; 40))))))) {</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24544)) {</span>
<span class="nc bnc" id="L786" title="All 8 branches missed.">                    result = &quot;0000000000000000000000000000000000000000&quot;.substring(0, (ListenerUtil.mutListener.listen(24543) ? (40 % result.length()) : (ListenerUtil.mutListener.listen(24542) ? (40 / result.length()) : (ListenerUtil.mutListener.listen(24541) ? (40 * result.length()) : (ListenerUtil.mutListener.listen(24540) ? (40 + result.length()) : (40 - result.length())))))) + result;</span>
                }
            }
        }
<span class="nc" id="L790">        return result;</span>
    }

    public static String fileChecksum(File file) {
<span class="nc" id="L794">        return fileChecksum(file.getAbsolutePath());</span>
    }

    /**
     * Converts an InputStream to a String.
     * @param is InputStream to convert
     * @return String version of the InputStream
     */
    public static String convertStreamToString(InputStream is) {
<span class="nc" id="L803">        String contentOfMyInputStream = &quot;&quot;;</span>
        try {
<span class="nc" id="L805">            BufferedReader rd = new BufferedReader(new InputStreamReader(is), 4096);</span>
            String line;
<span class="nc" id="L807">            StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24548)) {</span>
                {
<span class="nc" id="L810">                    long _loopCounter650 = 0;</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                    while ((line = rd.readLine()) != null) {</span>
<span class="nc" id="L812">                        ListenerUtil.loopListener.listen(&quot;_loopCounter650&quot;, ++_loopCounter650);</span>
<span class="nc bnc" id="L813" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24547)) {</span>
<span class="nc" id="L814">                            sb.append(line);</span>
                        }
                    }
                }
            }
<span class="nc bnc" id="L819" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24549)) {</span>
<span class="nc" id="L820">                rd.close();</span>
            }
<span class="nc bnc" id="L822" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24550)) {</span>
<span class="nc" id="L823">                contentOfMyInputStream = sb.toString();</span>
            }
<span class="nc" id="L825">        } catch (Exception e) {</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24546)) {</span>
<span class="nc" id="L827">                e.printStackTrace();</span>
            }
<span class="nc" id="L829">        }</span>
<span class="nc" id="L830">        return contentOfMyInputStream;</span>
    }

    public static void unzipAllFiles(ZipFile zipFile, String targetDirectory) throws IOException {
<span class="nc" id="L834">        List&lt;String&gt; entryNames = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L835">        Enumeration&lt;ZipArchiveEntry&gt; i = zipFile.getEntries();</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24552)) {</span>
            {
<span class="nc" id="L838">                long _loopCounter651 = 0;</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">                while (i.hasMoreElements()) {</span>
<span class="nc" id="L840">                    ListenerUtil.loopListener.listen(&quot;_loopCounter651&quot;, ++_loopCounter651);</span>
<span class="nc" id="L841">                    ZipArchiveEntry e = i.nextElement();</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24551)) {</span>
<span class="nc" id="L843">                        entryNames.add(e.getName());</span>
                    }
<span class="nc" id="L845">                }</span>
            }
        }
<span class="nc bnc" id="L848" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24553)) {</span>
<span class="nc" id="L849">            unzipFiles(zipFile, targetDirectory, entryNames.toArray(new String[0]), null);</span>
        }
<span class="nc" id="L851">    }</span>

    /**
     * @param zipFile A zip file
     * @param targetDirectory Directory in which to unzip some of the zipped field
     * @param zipEntries files of the zip folder to unzip
     * @param zipEntryToFilenameMap Renaming rules from name in zip file to name in the device
     * @throws IOException if the directory can't be created
     */
    public static void unzipFiles(ZipFile zipFile, String targetDirectory, @NonNull String[] zipEntries, @Nullable Map&lt;String, String&gt; zipEntryToFilenameMap) throws IOException {
<span class="fc" id="L861">        File dir = new File(targetDirectory);</span>
<span class="pc bpc" id="L862" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24555)) {</span>
<span class="pc bpc" id="L863" title="7 of 10 branches missed.">            if ((ListenerUtil.mutListener.listen(24554) ? (!dir.exists() || !dir.mkdirs()) : (!dir.exists() &amp;&amp; !dir.mkdirs()))) {</span>
<span class="nc" id="L864">                throw new IOException(&quot;Failed to create target directory: &quot; + targetDirectory);</span>
            }
        }
<span class="pc bpc" id="L867" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24557)) {</span>
<span class="pc bpc" id="L868" title="1 of 2 branches missed.">            if (zipEntryToFilenameMap == null) {</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24556)) {</span>
<span class="nc" id="L870">                    zipEntryToFilenameMap = new HashMap&lt;&gt;(0);</span>
                }
            }
        }
<span class="pc bpc" id="L874" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24566)) {</span>
            {
<span class="fc" id="L876">                long _loopCounter652 = 0;</span>
<span class="fc bfc" id="L877" title="All 2 branches covered.">                for (String requestedEntry : zipEntries) {</span>
<span class="fc" id="L878">                    ListenerUtil.loopListener.listen(&quot;_loopCounter652&quot;, ++_loopCounter652);</span>
<span class="fc" id="L879">                    ZipArchiveEntry ze = zipFile.getEntry(requestedEntry);</span>
<span class="pc bpc" id="L880" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24565)) {</span>
<span class="pc bpc" id="L881" title="1 of 2 branches missed.">                        if (ze != null) {</span>
<span class="fc" id="L882">                            String name = ze.getName();</span>
<span class="pc bpc" id="L883" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24559)) {</span>
<span class="fc bfc" id="L884" title="All 2 branches covered.">                                if (zipEntryToFilenameMap.containsKey(name)) {</span>
<span class="pc bpc" id="L885" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24558)) {</span>
<span class="fc" id="L886">                                        name = zipEntryToFilenameMap.get(name);</span>
                                    }
                                }
                            }
<span class="fc" id="L890">                            File destFile = new File(dir, name);</span>
<span class="pc bpc" id="L891" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24561)) {</span>
<span class="pc bpc" id="L892" title="1 of 2 branches missed.">                                if (!isInside(destFile, dir)) {</span>
<span class="nc bnc" id="L893" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24560)) {</span>
<span class="nc" id="L894">                                        Timber.e(&quot;Refusing to decompress invalid path: %s&quot;, destFile.getCanonicalPath());</span>
                                    }
<span class="nc" id="L896">                                    throw new IOException(&quot;File is outside extraction target directory.&quot;);</span>
                                }
                            }
<span class="pc bpc" id="L899" title="1 of 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24564)) {</span>
<span class="pc bpc" id="L900" title="1 of 2 branches missed.">                                if (!ze.isDirectory()) {</span>
<span class="pc bpc" id="L901" title="1 of 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24562)) {</span>
<span class="fc" id="L902">                                        Timber.i(&quot;uncompress %s&quot;, name);</span>
                                    }
<span class="fc" id="L904">                                    try (InputStream zis = zipFile.getInputStream(ze)) {</span>
<span class="pc bpc" id="L905" title="1 of 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(24563)) {</span>
<span class="fc" id="L906">                                            writeToFile(zis, destFile.getAbsolutePath());</span>
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="fc" id="L916">    }</span>

    /**
     * Checks to see if a given file path resides inside a given directory.
     * Useful for protection against path traversal attacks prior to creating the file
     * @param file the file with an uncertain filesystem location
     * @param dir the directory that should contain the file
     * @return true if the file path is inside the directory
     * @exception IOException if there are security or filesystem issues determining the paths
     */
    public static boolean isInside(@NonNull File file, @NonNull File dir) throws IOException {
<span class="fc" id="L927">        return file.getCanonicalPath().startsWith(dir.getCanonicalPath());</span>
    }

    /**
     * Given a ZipFile, iterate through the ZipEntries to determine the total uncompressed size
     * TODO warning: vulnerable to resource exhaustion attack if entries contain spoofed sizes
     *
     * @param zipFile ZipFile of unknown total uncompressed size
     * @return total uncompressed size of zipFile
     */
    public static long calculateUncompressedSize(ZipFile zipFile) {
<span class="fc" id="L938">        long totalUncompressedSize = 0;</span>
<span class="fc" id="L939">        Enumeration&lt;ZipArchiveEntry&gt; e = zipFile.getEntries();</span>
<span class="pc bpc" id="L940" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24568)) {</span>
            {
<span class="fc" id="L942">                long _loopCounter653 = 0;</span>
<span class="fc bfc" id="L943" title="All 2 branches covered.">                while (e.hasMoreElements()) {</span>
<span class="fc" id="L944">                    ListenerUtil.loopListener.listen(&quot;_loopCounter653&quot;, ++_loopCounter653);</span>
<span class="fc" id="L945">                    ZipArchiveEntry ze = e.nextElement();</span>
<span class="pc bpc" id="L946" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24567)) {</span>
<span class="fc" id="L947">                        totalUncompressedSize += ze.getSize();</span>
                    }
<span class="fc" id="L949">                }</span>
            }
        }
<span class="fc" id="L952">        return totalUncompressedSize;</span>
    }

    /**
     * Determine available storage space
     *
     * @param path the filesystem path you need free space information on
     * @return long indicating the bytes available for that path
     */
    public static long determineBytesAvailable(String path) {
<span class="fc" id="L962">        return new StatFs(path).getAvailableBytes();</span>
    }

    /**
     * Calls {@link #writeToFileImpl(InputStream, String)} and handles IOExceptions
     * Does not close the provided stream
     * @throws IOException Rethrows exception after a set number of retries
     */
    public static void writeToFile(InputStream source, String destination) throws IOException {
        // sometimes this fails and works on retries (hardware issue?)
<span class="fc" id="L972">        final int retries = 5;</span>
<span class="fc" id="L973">        int retryCnt = 0;</span>
<span class="fc" id="L974">        boolean success = false;</span>
<span class="pc bpc" id="L975" title="1 of 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24587)) {</span>
            {
<span class="fc" id="L977">                long _loopCounter654 = 0;</span>
<span class="pc bpc" id="L978" title="41 of 50 branches missed.">                while ((ListenerUtil.mutListener.listen(24586) ? (!success || (ListenerUtil.mutListener.listen(24585) ? (retryCnt++ &gt;= retries) : (ListenerUtil.mutListener.listen(24584) ? (retryCnt++ &lt;= retries) : (ListenerUtil.mutListener.listen(24583) ? (retryCnt++ &gt; retries) : (ListenerUtil.mutListener.listen(24582) ? (retryCnt++ != retries) : (ListenerUtil.mutListener.listen(24581) ? (retryCnt++ == retries) : (retryCnt++ &lt; retries))))))) : (!success &amp;&amp; (ListenerUtil.mutListener.listen(24585) ? (retryCnt++ &gt;= retries) : (ListenerUtil.mutListener.listen(24584) ? (retryCnt++ &lt;= retries) : (ListenerUtil.mutListener.listen(24583) ? (retryCnt++ &gt; retries) : (ListenerUtil.mutListener.listen(24582) ? (retryCnt++ != retries) : (ListenerUtil.mutListener.listen(24581) ? (retryCnt++ == retries) : (retryCnt++ &lt; retries))))))))) {</span>
<span class="fc" id="L979">                    ListenerUtil.loopListener.listen(&quot;_loopCounter654&quot;, ++_loopCounter654);</span>
                    try {
<span class="pc bpc" id="L981" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24579)) {</span>
<span class="fc" id="L982">                            writeToFileImpl(source, destination);</span>
                        }
<span class="pc bpc" id="L984" title="1 of 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24580)) {</span>
<span class="fc" id="L985">                            success = true;</span>
                        }
<span class="nc" id="L987">                    } catch (IOException e) {</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">                        if (!ListenerUtil.mutListener.listen(24578)) {</span>
<span class="nc bnc" id="L989" title="All 22 branches missed.">                            if ((ListenerUtil.mutListener.listen(24573) ? (retryCnt &gt;= retries) : (ListenerUtil.mutListener.listen(24572) ? (retryCnt &lt;= retries) : (ListenerUtil.mutListener.listen(24571) ? (retryCnt &gt; retries) : (ListenerUtil.mutListener.listen(24570) ? (retryCnt &lt; retries) : (ListenerUtil.mutListener.listen(24569) ? (retryCnt != retries) : (retryCnt == retries))))))) {</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24577)) {</span>
<span class="nc" id="L991">                                    Timber.e(&quot;IOException while writing to file, out of retries.&quot;);</span>
                                }
<span class="nc" id="L993">                                throw e;</span>
                            } else {
<span class="nc bnc" id="L995" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24574)) {</span>
<span class="nc" id="L996">                                    Timber.e(&quot;IOException while writing to file, retrying...&quot;);</span>
                                }
                                try {
<span class="nc bnc" id="L999" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24576)) {</span>
<span class="nc" id="L1000">                                        Thread.sleep(200);</span>
                                    }
<span class="nc" id="L1002">                                } catch (InterruptedException e1) {</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24575)) {</span>
<span class="nc" id="L1004">                                        e1.printStackTrace();</span>
                                    }
<span class="nc" id="L1006">                                }</span>
                            }
                        }
<span class="pc" id="L1009">                    }</span>
                }
            }
        }
<span class="fc" id="L1013">    }</span>

    /**
     * Utility method to write to a file.
     * Throws the exception, so we can report it in syncing log
     */
    private static void writeToFileImpl(InputStream source, String destination) throws IOException {
<span class="fc" id="L1020">        File f = new File(destination);</span>
        try {
<span class="pc bpc" id="L1022" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24588)) {</span>
<span class="fc" id="L1023">                Timber.d(&quot;Creating new file... = %s&quot;, destination);</span>
            }
<span class="pc bpc" id="L1025" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24589)) {</span>
<span class="fc" id="L1026">                f.createNewFile();</span>
            }
            @SuppressLint(&quot;DirectSystemCurrentTimeMillisUsage&quot;)
<span class="fc" id="L1029">            long startTimeMillis = System.currentTimeMillis();</span>
<span class="fc" id="L1030">            long sizeBytes = CompatHelper.getCompat().copyFile(source, destination);</span>
            @SuppressLint(&quot;DirectSystemCurrentTimeMillisUsage&quot;)
<span class="fc" id="L1032">            long endTimeMillis = System.currentTimeMillis();</span>
<span class="pc bpc" id="L1033" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24590)) {</span>
<span class="fc" id="L1034">                Timber.d(&quot;Finished writeToFile!&quot;);</span>
            }
<span class="pc bpc" id="L1036" title="40 of 48 branches missed.">            long durationSeconds = (ListenerUtil.mutListener.listen(24598) ? (((ListenerUtil.mutListener.listen(24594) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24593) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24592) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24591) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))) % 1000) : (ListenerUtil.mutListener.listen(24597) ? (((ListenerUtil.mutListener.listen(24594) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24593) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24592) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24591) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))) * 1000) : (ListenerUtil.mutListener.listen(24596) ? (((ListenerUtil.mutListener.listen(24594) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24593) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24592) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24591) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))) - 1000) : (ListenerUtil.mutListener.listen(24595) ? (((ListenerUtil.mutListener.listen(24594) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24593) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24592) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24591) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))) + 1000) : (((ListenerUtil.mutListener.listen(24594) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24593) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24592) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24591) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))) / 1000)))));</span>
<span class="pc bpc" id="L1037" title="4 of 8 branches missed.">            long sizeKb = (ListenerUtil.mutListener.listen(24602) ? (sizeBytes % 1024) : (ListenerUtil.mutListener.listen(24601) ? (sizeBytes * 1024) : (ListenerUtil.mutListener.listen(24600) ? (sizeBytes - 1024) : (ListenerUtil.mutListener.listen(24599) ? (sizeBytes + 1024) : (sizeBytes / 1024)))));</span>
<span class="fc" id="L1038">            long speedKbSec = 0;</span>
<span class="pc bpc" id="L1039" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24621)) {</span>
<span class="pc bpc" id="L1040" title="15 of 22 branches missed.">                if ((ListenerUtil.mutListener.listen(24607) ? (endTimeMillis &gt;= startTimeMillis) : (ListenerUtil.mutListener.listen(24606) ? (endTimeMillis &lt;= startTimeMillis) : (ListenerUtil.mutListener.listen(24605) ? (endTimeMillis &gt; startTimeMillis) : (ListenerUtil.mutListener.listen(24604) ? (endTimeMillis &lt; startTimeMillis) : (ListenerUtil.mutListener.listen(24603) ? (endTimeMillis == startTimeMillis) : (endTimeMillis != startTimeMillis))))))) {</span>
<span class="pc bpc" id="L1041" title="1 of 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24620)) {</span>
<span class="pc bpc" id="L1042" title="76 of 88 branches missed.">                        speedKbSec = (ListenerUtil.mutListener.listen(24619) ? ((ListenerUtil.mutListener.listen(24611) ? (sizeKb % 1000) : (ListenerUtil.mutListener.listen(24610) ? (sizeKb / 1000) : (ListenerUtil.mutListener.listen(24609) ? (sizeKb - 1000) : (ListenerUtil.mutListener.listen(24608) ? (sizeKb + 1000) : (sizeKb * 1000))))) % ((ListenerUtil.mutListener.listen(24615) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24614) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24613) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24612) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis))))))) : (ListenerUtil.mutListener.listen(24618) ? ((ListenerUtil.mutListener.listen(24611) ? (sizeKb % 1000) : (ListenerUtil.mutListener.listen(24610) ? (sizeKb / 1000) : (ListenerUtil.mutListener.listen(24609) ? (sizeKb - 1000) : (ListenerUtil.mutListener.listen(24608) ? (sizeKb + 1000) : (sizeKb * 1000))))) * ((ListenerUtil.mutListener.listen(24615) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24614) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24613) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24612) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis))))))) : (ListenerUtil.mutListener.listen(24617) ? ((ListenerUtil.mutListener.listen(24611) ? (sizeKb % 1000) : (ListenerUtil.mutListener.listen(24610) ? (sizeKb / 1000) : (ListenerUtil.mutListener.listen(24609) ? (sizeKb - 1000) : (ListenerUtil.mutListener.listen(24608) ? (sizeKb + 1000) : (sizeKb * 1000))))) - ((ListenerUtil.mutListener.listen(24615) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24614) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24613) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24612) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis))))))) : (ListenerUtil.mutListener.listen(24616) ? ((ListenerUtil.mutListener.listen(24611) ? (sizeKb % 1000) : (ListenerUtil.mutListener.listen(24610) ? (sizeKb / 1000) : (ListenerUtil.mutListener.listen(24609) ? (sizeKb - 1000) : (ListenerUtil.mutListener.listen(24608) ? (sizeKb + 1000) : (sizeKb * 1000))))) + ((ListenerUtil.mutListener.listen(24615) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24614) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24613) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24612) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis))))))) : ((ListenerUtil.mutListener.listen(24611) ? (sizeKb % 1000) : (ListenerUtil.mutListener.listen(24610) ? (sizeKb / 1000) : (ListenerUtil.mutListener.listen(24609) ? (sizeKb - 1000) : (ListenerUtil.mutListener.listen(24608) ? (sizeKb + 1000) : (sizeKb * 1000))))) / ((ListenerUtil.mutListener.listen(24615) ? (endTimeMillis % startTimeMillis) : (ListenerUtil.mutListener.listen(24614) ? (endTimeMillis / startTimeMillis) : (ListenerUtil.mutListener.listen(24613) ? (endTimeMillis * startTimeMillis) : (ListenerUtil.mutListener.listen(24612) ? (endTimeMillis + startTimeMillis) : (endTimeMillis - startTimeMillis)))))))))));</span>
                    }
                }
            }
<span class="pc bpc" id="L1046" title="1 of 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24622)) {</span>
<span class="fc" id="L1047">                Timber.d(&quot;Utils.writeToFile: Size: %d Kb, Duration: %d s, Speed: %d Kb/s&quot;, sizeKb, durationSeconds, speedKbSec);</span>
            }
<span class="nc" id="L1049">        } catch (IOException e) {</span>
<span class="nc" id="L1050">            throw new IOException(f.getName() + &quot;: &quot; + e.getLocalizedMessage(), e);</span>
<span class="fc" id="L1051">        }</span>
<span class="fc" id="L1052">    }</span>

    /**
     * Indicates whether the specified action can be used as an intent. This method queries the package manager for
     * installed packages that can respond to an intent with the specified action. If no suitable package is found, this
     * method returns false.
     * @param context The application's environment.
     * @param action The Intent action to check for availability.
     * @return True if an Intent with the specified action can be sent and responded to, false otherwise.
     */
    public static boolean isIntentAvailable(Context context, String action) {
<span class="nc" id="L1063">        return isIntentAvailable(context, action, null);</span>
    }

    public static boolean isIntentAvailable(Context context, String action, ComponentName componentName) {
<span class="nc" id="L1067">        final PackageManager packageManager = context.getPackageManager();</span>
<span class="nc" id="L1068">        final Intent intent = new Intent(action);</span>
<span class="nc bnc" id="L1069" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24623)) {</span>
<span class="nc" id="L1070">            intent.setComponent(componentName);</span>
        }
<span class="nc" id="L1072">        List&lt;ResolveInfo&gt; list = packageManager.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);</span>
<span class="nc bnc" id="L1073" title="All 22 branches missed.">        return (ListenerUtil.mutListener.listen(24628) ? (list.size() &gt;= 0) : (ListenerUtil.mutListener.listen(24627) ? (list.size() &lt;= 0) : (ListenerUtil.mutListener.listen(24626) ? (list.size() &lt; 0) : (ListenerUtil.mutListener.listen(24625) ? (list.size() != 0) : (ListenerUtil.mutListener.listen(24624) ? (list.size() == 0) : (list.size() &gt; 0))))));</span>
    }

    /**
     * @param mediaDir media directory path on SD card
     * @return path converted to file URL, properly UTF-8 URL encoded
     */
    public static String getBaseUrl(String mediaDir) {
<span class="nc bnc" id="L1081" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24635)) {</span>
            // with existing slashes
<span class="nc bnc" id="L1083" title="All 50 branches missed.">            if ((ListenerUtil.mutListener.listen(24634) ? ((ListenerUtil.mutListener.listen(24633) ? (mediaDir.length() &gt;= 0) : (ListenerUtil.mutListener.listen(24632) ? (mediaDir.length() &lt;= 0) : (ListenerUtil.mutListener.listen(24631) ? (mediaDir.length() &gt; 0) : (ListenerUtil.mutListener.listen(24630) ? (mediaDir.length() &lt; 0) : (ListenerUtil.mutListener.listen(24629) ? (mediaDir.length() == 0) : (mediaDir.length() != 0)))))) || !&quot;null&quot;.equalsIgnoreCase(mediaDir)) : ((ListenerUtil.mutListener.listen(24633) ? (mediaDir.length() &gt;= 0) : (ListenerUtil.mutListener.listen(24632) ? (mediaDir.length() &lt;= 0) : (ListenerUtil.mutListener.listen(24631) ? (mediaDir.length() &gt; 0) : (ListenerUtil.mutListener.listen(24630) ? (mediaDir.length() &lt; 0) : (ListenerUtil.mutListener.listen(24629) ? (mediaDir.length() == 0) : (mediaDir.length() != 0)))))) &amp;&amp; !&quot;null&quot;.equalsIgnoreCase(mediaDir)))) {</span>
<span class="nc" id="L1084">                Uri mediaDirUri = Uri.fromFile(new File(mediaDir));</span>
<span class="nc" id="L1085">                return mediaDirUri.toString() + &quot;/&quot;;</span>
            }
        }
<span class="nc" id="L1088">        return &quot;&quot;;</span>
    }

    /**
     * Take an array of Long and return an array of long
     *
     * @param array The input with type Long[]
     * @return The output with type long[]
     */
    public static long[] toPrimitive(Collection&lt;Long&gt; array) {
<span class="nc bnc" id="L1098" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24636)) {</span>
<span class="nc bnc" id="L1099" title="All 2 branches missed.">            if (array == null) {</span>
<span class="nc" id="L1100">                return null;</span>
            }
        }
<span class="nc" id="L1103">        long[] results = new long[array.size()];</span>
<span class="nc" id="L1104">        int i = 0;</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24638)) {</span>
            {
<span class="nc" id="L1107">                long _loopCounter655 = 0;</span>
<span class="nc bnc" id="L1108" title="All 2 branches missed.">                for (Long item : array) {</span>
<span class="nc" id="L1109">                    ListenerUtil.loopListener.listen(&quot;_loopCounter655&quot;, ++_loopCounter655);</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24637)) {</span>
<span class="nc" id="L1111">                        results[i++] = item;</span>
                    }
<span class="nc" id="L1113">                }</span>
            }
        }
<span class="nc" id="L1116">        return results;</span>
    }

    /**
     * Returns a String array with two elements:
     * 0 - file name
     * 1 - extension
     */
    public static String[] splitFilename(String filename) {
<span class="nc" id="L1125">        String name = filename;</span>
<span class="nc" id="L1126">        String ext = &quot;&quot;;</span>
<span class="nc" id="L1127">        int dotPosition = filename.lastIndexOf('.');</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24646)) {</span>
<span class="nc bnc" id="L1129" title="All 22 branches missed.">            if ((ListenerUtil.mutListener.listen(24643) ? (dotPosition &gt;= -1) : (ListenerUtil.mutListener.listen(24642) ? (dotPosition &lt;= -1) : (ListenerUtil.mutListener.listen(24641) ? (dotPosition &gt; -1) : (ListenerUtil.mutListener.listen(24640) ? (dotPosition &lt; -1) : (ListenerUtil.mutListener.listen(24639) ? (dotPosition == -1) : (dotPosition != -1))))))) {</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24644)) {</span>
<span class="nc" id="L1131">                    name = filename.substring(0, dotPosition);</span>
                }
<span class="nc bnc" id="L1133" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24645)) {</span>
<span class="nc" id="L1134">                    ext = filename.substring(dotPosition);</span>
                }
            }
        }
<span class="nc" id="L1138">        return new String[] { name, ext };</span>
    }

    /**
     * Returns a list of files for the installed custom fonts.
     */
    public static List&lt;AnkiFont&gt; getCustomFonts(Context context) {
<span class="nc" id="L1145">        String deckPath = CollectionHelper.getCurrentAnkiDroidDirectory(context);</span>
<span class="nc" id="L1146">        String fontsPath = deckPath + &quot;/fonts/&quot;;</span>
<span class="nc" id="L1147">        File fontsDir = new File(fontsPath);</span>
<span class="nc" id="L1148">        int fontsCount = 0;</span>
<span class="nc" id="L1149">        File[] fontsList = null;</span>
<span class="nc bnc" id="L1150" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24650)) {</span>
<span class="nc bnc" id="L1151" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(24647) ? (fontsDir.exists() || fontsDir.isDirectory()) : (fontsDir.exists() &amp;&amp; fontsDir.isDirectory()))) {</span>
<span class="nc bnc" id="L1152" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24648)) {</span>
<span class="nc" id="L1153">                    fontsCount = fontsDir.listFiles().length;</span>
                }
<span class="nc bnc" id="L1155" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24649)) {</span>
<span class="nc" id="L1156">                    fontsList = fontsDir.listFiles();</span>
                }
            }
        }
<span class="nc" id="L1160">        String[] ankiDroidFonts = null;</span>
        try {
<span class="nc bnc" id="L1162" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24652)) {</span>
<span class="nc" id="L1163">                ankiDroidFonts = context.getAssets().list(&quot;fonts&quot;);</span>
            }
<span class="nc" id="L1165">        } catch (IOException e) {</span>
<span class="nc bnc" id="L1166" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24651)) {</span>
<span class="nc" id="L1167">                Timber.e(e, &quot;Error on retrieving ankidroid fonts&quot;);</span>
            }
<span class="nc" id="L1169">        }</span>
<span class="nc" id="L1170">        List&lt;AnkiFont&gt; fonts = new ArrayList&lt;&gt;(fontsCount);</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24662)) {</span>
            {
<span class="nc" id="L1173">                long _loopCounter657 = 0;</span>
<span class="nc bnc" id="L1174" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(24661) ? (i &gt;= fontsCount) : (ListenerUtil.mutListener.listen(24660) ? (i &lt;= fontsCount) : (ListenerUtil.mutListener.listen(24659) ? (i &gt; fontsCount) : (ListenerUtil.mutListener.listen(24658) ? (i != fontsCount) : (ListenerUtil.mutListener.listen(24657) ? (i == fontsCount) : (i &lt; fontsCount)))))); i++) {</span>
<span class="nc" id="L1175">                    ListenerUtil.loopListener.listen(&quot;_loopCounter657&quot;, ++_loopCounter657);</span>
<span class="nc" id="L1176">                    String filePath = fontsList[i].getAbsolutePath();</span>
<span class="nc" id="L1177">                    String filePathExtension = splitFilename(filePath)[1];</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24656)) {</span>
                        {
<span class="nc" id="L1180">                            long _loopCounter656 = 0;</span>
<span class="nc bnc" id="L1181" title="All 2 branches missed.">                            for (String fontExtension : FONT_FILE_EXTENSIONS) {</span>
<span class="nc" id="L1182">                                ListenerUtil.loopListener.listen(&quot;_loopCounter656&quot;, ++_loopCounter656);</span>
<span class="nc bnc" id="L1183" title="All 2 branches missed.">                                if (!ListenerUtil.mutListener.listen(24655)) {</span>
                                    // Go through the list of allowed extensions.
<span class="nc bnc" id="L1185" title="All 2 branches missed.">                                    if (filePathExtension.equalsIgnoreCase(fontExtension)) {</span>
                                        // This looks like a font file.
<span class="nc" id="L1187">                                        AnkiFont font = AnkiFont.createAnkiFont(context, filePath, false);</span>
<span class="nc bnc" id="L1188" title="All 2 branches missed.">                                        if (!ListenerUtil.mutListener.listen(24654)) {</span>
<span class="nc bnc" id="L1189" title="All 2 branches missed.">                                            if (font != null) {</span>
<span class="nc bnc" id="L1190" title="All 2 branches missed.">                                                if (!ListenerUtil.mutListener.listen(24653)) {</span>
<span class="nc" id="L1191">                                                    fonts.add(font);</span>
                                                }
                                            }
                                        }
                                        // No need to look for other file extensions.
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc bnc" id="L1205" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24666)) {</span>
<span class="nc bnc" id="L1206" title="All 2 branches missed.">            if (ankiDroidFonts != null) {</span>
<span class="nc bnc" id="L1207" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24665)) {</span>
                    {
<span class="nc" id="L1209">                        long _loopCounter658 = 0;</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">                        for (String ankiDroidFont : ankiDroidFonts) {</span>
<span class="nc" id="L1211">                            ListenerUtil.loopListener.listen(&quot;_loopCounter658&quot;, ++_loopCounter658);</span>
                            // Assume all files in the assets directory are actually fonts.
<span class="nc" id="L1213">                            AnkiFont font = AnkiFont.createAnkiFont(context, ankiDroidFont, true);</span>
<span class="nc bnc" id="L1214" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24664)) {</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">                                if (font != null) {</span>
<span class="nc bnc" id="L1216" title="All 2 branches missed.">                                    if (!ListenerUtil.mutListener.listen(24663)) {</span>
<span class="nc" id="L1217">                                        fonts.add(font);</span>
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L1226">        return fonts;</span>
    }

    /**
     * Returns a list of apkg-files.
     */
    public static List&lt;File&gt; getImportableDecks(Context context) {
<span class="nc" id="L1233">        String deckPath = CollectionHelper.getCurrentAnkiDroidDirectory(context);</span>
<span class="nc" id="L1234">        File dir = new File(deckPath);</span>
<span class="nc" id="L1235">        List&lt;File&gt; decks = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24669)) {</span>
<span class="nc bnc" id="L1237" title="All 10 branches missed.">            if ((ListenerUtil.mutListener.listen(24667) ? (dir.exists() || dir.isDirectory()) : (dir.exists() &amp;&amp; dir.isDirectory()))) {</span>
<span class="nc bnc" id="L1238" title="All 4 branches missed.">                File[] deckList = dir.listFiles(pathname -&gt; pathname.isFile() &amp;&amp; ImportUtils.isValidPackageName(pathname.getName()));</span>
<span class="nc bnc" id="L1239" title="All 2 branches missed.">                if (!ListenerUtil.mutListener.listen(24668)) {</span>
<span class="nc" id="L1240">                    decks.addAll(Arrays.asList(deckList).subList(0, deckList.length));</span>
                }
            }
        }
<span class="nc" id="L1244">        return decks;</span>
    }

    /**
     * Simply copy a file to another location
     * @param sourceFile The source file
     * @param destFile The destination file, doesn't need to exist yet.
     */
    public static void copyFile(File sourceFile, File destFile) throws IOException {
<span class="nc" id="L1253">        try (FileInputStream source = new FileInputStream(sourceFile)) {</span>
<span class="nc bnc" id="L1254" title="All 2 branches missed.">            if (!ListenerUtil.mutListener.listen(24670)) {</span>
<span class="nc" id="L1255">                writeToFile(source, destFile.getAbsolutePath());</span>
            }
        }
<span class="nc" id="L1258">    }</span>

    /**
     * Like org.json.JSONObject except that it doesn't escape forward slashes
     * The necessity for this method is due to python's 2.7 json.dumps() function that doesn't escape character '/'.
     * The org.json.JSONObject parser accepts both escaped and unescaped forward slashes, so we only need to worry for
     * our output, when we write to the database or syncing.
     *
     * @param json a json object to serialize
     * @return the json serialization of the object
     * @see org.json.JSONObject#toString()
     */
    public static String jsonToString(JSONObject json) {
<span class="fc" id="L1271">        return json.toString().replaceAll(&quot;\\\\/&quot;, &quot;/&quot;);</span>
    }

    /**
     * Like org.json.JSONArray except that it doesn't escape forward slashes
     * The necessity for this method is due to python's 2.7 json.dumps() function that doesn't escape character '/'.
     * The org.json.JSONArray parser accepts both escaped and unescaped forward slashes, so we only need to worry for
     * our output, when we write to the database or syncing.
     *
     * @param json a json object to serialize
     * @return the json serialization of the object
     * @see org.json.JSONArray#toString()
     */
    public static String jsonToString(JSONArray json) {
<span class="nc" id="L1285">        return json.toString().replaceAll(&quot;\\\\/&quot;, &quot;/&quot;);</span>
    }

    /**
     * @return A description of the device, including the model and android version. No commas are present in the
     * returned string.
     */
    public static String platDesc() {
        // AnkiWeb reads this string and uses , and : as delimiters, so we remove them.
<span class="nc" id="L1294">        String model = android.os.Build.MODEL.replace(',', ' ').replace(':', ' ');</span>
<span class="nc" id="L1295">        return String.format(Locale.US, &quot;android:%s:%s&quot;, android.os.Build.VERSION.RELEASE, model);</span>
    }

    /*
     *  Return the input string in the Unicode normalized form. This helps with text comparisons, for example a √º
     *  stored as u plus the dots but typed as a single character compare as the same.
     *
     * @param txt Text to be normalized
     * @return The input text in its NFC normalized form form.
    */
    public static String nfcNormalized(String txt) {
<span class="nc bnc" id="L1306" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24671)) {</span>
<span class="nc bnc" id="L1307" title="All 2 branches missed.">            if (!Normalizer.isNormalized(txt, Normalizer.Form.NFC)) {</span>
<span class="nc" id="L1308">                return Normalizer.normalize(txt, Normalizer.Form.NFC);</span>
            }
        }
<span class="nc" id="L1311">        return txt;</span>
    }

    /**
     * Unescapes all sequences within the given string of text, interpreting them as HTML escaped characters.
     * &lt;p/&gt;
     * Not that this code strips any HTML tags untouched, so if the text contains any HTML tags, they will be ignored.
     *
     * @param htmlText the text to convert
     * @return the unescaped text
     */
    public static String unescape(String htmlText) {
<span class="nc" id="L1323">        return HtmlCompat.fromHtml(htmlText, HtmlCompat.FROM_HTML_MODE_LEGACY).toString();</span>
    }

    /**
     * Return a random float within the range of min and max.
     */
    public static float randomFloatInRange(float min, float max) {
<span class="nc" id="L1330">        Random rand = new Random();</span>
<span class="nc bnc" id="L1331" title="All 248 branches missed.">        return (ListenerUtil.mutListener.listen(24683) ? ((ListenerUtil.mutListener.listen(24679) ? (rand.nextFloat() % ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24678) ? (rand.nextFloat() / ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24677) ? (rand.nextFloat() - ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24676) ? (rand.nextFloat() + ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (rand.nextFloat() * ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))))))) % min) : (ListenerUtil.mutListener.listen(24682) ? ((ListenerUtil.mutListener.listen(24679) ? (rand.nextFloat() % ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24678) ? (rand.nextFloat() / ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24677) ? (rand.nextFloat() - ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24676) ? (rand.nextFloat() + ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (rand.nextFloat() * ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))))))) / min) : (ListenerUtil.mutListener.listen(24681) ? ((ListenerUtil.mutListener.listen(24679) ? (rand.nextFloat() % ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24678) ? (rand.nextFloat() / ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24677) ? (rand.nextFloat() - ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24676) ? (rand.nextFloat() + ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (rand.nextFloat() * ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))))))) * min) : (ListenerUtil.mutListener.listen(24680) ? ((ListenerUtil.mutListener.listen(24679) ? (rand.nextFloat() % ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24678) ? (rand.nextFloat() / ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24677) ? (rand.nextFloat() - ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24676) ? (rand.nextFloat() + ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (rand.nextFloat() * ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))))))) - min) : ((ListenerUtil.mutListener.listen(24679) ? (rand.nextFloat() % ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24678) ? (rand.nextFloat() / ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24677) ? (rand.nextFloat() - ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (ListenerUtil.mutListener.listen(24676) ? (rand.nextFloat() + ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))) : (rand.nextFloat() * ((ListenerUtil.mutListener.listen(24675) ? (max % min) : (ListenerUtil.mutListener.listen(24674) ? (max / min) : (ListenerUtil.mutListener.listen(24673) ? (max * min) : (ListenerUtil.mutListener.listen(24672) ? (max + min) : (max - min))))))))))) + min)))));</span>
    }

    /**
     *       Set usn to 0 in every object.
     *
     *       This method is called during full sync, before uploading, so
     *       during an instant, the value will be zero while the object is
     *       not actually online. This is not a problem because if the sync
     *       fails, a full sync will occur again next time.
     *
     *       @return whether there was a non-zero usn; in this case the list
     *       should be saved before the upload.
     */
    public static boolean markAsUploaded(ArrayList&lt;? extends JSONObject&gt; ar) {
<span class="nc" id="L1346">        boolean changed = false;</span>
<span class="nc bnc" id="L1347" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24687)) {</span>
            {
<span class="nc" id="L1349">                long _loopCounter659 = 0;</span>
<span class="nc bnc" id="L1350" title="All 2 branches missed.">                for (JSONObject obj : ar) {</span>
<span class="nc" id="L1351">                    ListenerUtil.loopListener.listen(&quot;_loopCounter659&quot;, ++_loopCounter659);</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24686)) {</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">                        if (obj.optInt(&quot;usn&quot;, 1) != 0) {</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24684)) {</span>
<span class="nc" id="L1355">                                obj.put(&quot;usn&quot;, 0);</span>
                            }
<span class="nc bnc" id="L1357" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24685)) {</span>
<span class="nc" id="L1358">                                changed = true;</span>
                            }
                        }
                    }
<span class="nc" id="L1362">                }</span>
            }
        }
<span class="nc" id="L1365">        return changed;</span>
    }

    // Similar as Objects.equals. So deprecated starting at API Level 19 where this methods exists.
    public static &lt;T&gt; boolean equals(@Nullable T left, @Nullable T right) {
        // noinspection EqualsReplaceableByObjectsCall
<span class="nc bnc" id="L1371" title="All 26 branches missed.">        return (ListenerUtil.mutListener.listen(24689) ? (left == right &amp;&amp; ((ListenerUtil.mutListener.listen(24688) ? (left != null || left.equals(right)) : (left != null &amp;&amp; left.equals(right))))) : (left == right || ((ListenerUtil.mutListener.listen(24688) ? (left != null || left.equals(right)) : (left != null &amp;&amp; left.equals(right))))));</span>
    }

    /**
     * @param sflds Some fields
     * @return Array with the same elements, trimmed
     */
    @NonNull
    public static String[] trimArray(@NonNull String[] sflds) {
<span class="nc" id="L1380">        int nbField = sflds.length;</span>
<span class="nc" id="L1381">        String[] fields = new String[nbField];</span>
<span class="nc bnc" id="L1382" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24696)) {</span>
            {
<span class="nc" id="L1384">                long _loopCounter660 = 0;</span>
<span class="nc bnc" id="L1385" title="All 22 branches missed.">                for (int i = 0; (ListenerUtil.mutListener.listen(24695) ? (i &gt;= nbField) : (ListenerUtil.mutListener.listen(24694) ? (i &lt;= nbField) : (ListenerUtil.mutListener.listen(24693) ? (i &gt; nbField) : (ListenerUtil.mutListener.listen(24692) ? (i != nbField) : (ListenerUtil.mutListener.listen(24691) ? (i == nbField) : (i &lt; nbField)))))); i++) {</span>
<span class="nc" id="L1386">                    ListenerUtil.loopListener.listen(&quot;_loopCounter660&quot;, ++_loopCounter660);</span>
<span class="nc bnc" id="L1387" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24690)) {</span>
<span class="nc" id="L1388">                        fields[i] = sflds[i].trim();</span>
                    }
                }
            }
        }
<span class="nc" id="L1393">        return fields;</span>
    }

    /**
     * @param fields A map from field name to field value
     * @return The set of non empty field values.
     */
    public static Set&lt;String&gt; nonEmptyFields(Map&lt;String, String&gt; fields) {
<span class="nc" id="L1401">        Set&lt;String&gt; nonempty_fields = new HashSet&lt;&gt;(fields.size());</span>
<span class="nc bnc" id="L1402" title="All 2 branches missed.">        if (!ListenerUtil.mutListener.listen(24700)) {</span>
            {
<span class="nc" id="L1404">                long _loopCounter661 = 0;</span>
<span class="nc bnc" id="L1405" title="All 2 branches missed.">                for (Map.Entry&lt;String, String&gt; kv : fields.entrySet()) {</span>
<span class="nc" id="L1406">                    ListenerUtil.loopListener.listen(&quot;_loopCounter661&quot;, ++_loopCounter661);</span>
<span class="nc" id="L1407">                    String value = kv.getValue();</span>
<span class="nc bnc" id="L1408" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24697)) {</span>
<span class="nc" id="L1409">                        value = Utils.stripHTMLMedia(value).trim();</span>
                    }
<span class="nc bnc" id="L1411" title="All 2 branches missed.">                    if (!ListenerUtil.mutListener.listen(24699)) {</span>
<span class="nc bnc" id="L1412" title="All 2 branches missed.">                        if (!TextUtils.isEmpty(value)) {</span>
<span class="nc bnc" id="L1413" title="All 2 branches missed.">                            if (!ListenerUtil.mutListener.listen(24698)) {</span>
<span class="nc" id="L1414">                                nonempty_fields.add(kv.getKey());</span>
                            }
                        }
                    }
<span class="nc" id="L1418">                }</span>
            }
        }
<span class="nc" id="L1421">        return nonempty_fields;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>